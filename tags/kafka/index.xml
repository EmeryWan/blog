<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kafka on ä¸€å±‚</title><link>https://emerywan.github.io/blog/tags/kafka/</link><description>Recent content in Kafka on ä¸€å±‚</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Sun, 26 Mar 2023 12:14:45 +0800</lastBuildDate><atom:link href="https://emerywan.github.io/blog/tags/kafka/index.xml" rel="self" type="application/rss+xml"/><item><title>Kafka æ“ä½œï¼ˆDoingï¼‰</title><link>https://emerywan.github.io/blog/p/kafka/operation/</link><pubDate>Sun, 26 Mar 2023 12:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/kafka/operation/</guid><description>&lt;img src="https://emerywan.github.io/blog/p/kafka/operation/1.png" alt="Featured image of post Kafka æ“ä½œï¼ˆDoingï¼‰" />&lt;h2 id="å‘½ä»¤è¡Œå·¥å…·">å‘½ä»¤è¡Œå·¥å…·&lt;/h2>
&lt;p>Kafka æä¾›äº†ä¸€äº›åŸºäºè„šæœ¬çš„å‘½åè¡Œå·¥å…· &lt;code>${dir}/bin/xxx.sh&lt;/code>ï¼Œç”¨äºç®¡ç†é›†ç¾¤ã€‚è¿™äº›ç®¡ç†é€šè¿‡ Java ç±»å®ç°ï¼Œé€šè¿‡è„šæœ¬è°ƒç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯åŠ¨ Zookeeper æœåŠ¡ï¼ˆæ–°ç‰ˆå·²å†…ç½®ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bin/zookeeper-server-start.sh config/zeekeeper.properties
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯åŠ¨ Kafka æœåŠ¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bin/kafka-server-start.sh config/server.properties
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ğŸ” æ›´å¤š CLI æ“ä½œï¼š&lt;a class="link" href="https://www.conduktor.io/kafka/kafka-topics-cli-tutorial/" target="_blank" rel="noopener"
>ğŸŒ https://www.conduktor.io/kafka/kafka-topics-cli-tutorial/&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="topic-æ“ä½œ">Topic æ“ä½œ&lt;/h3>
&lt;p>Kafka å¤§éƒ¨åˆ†å‘½ä»¤è¡Œå·¥å…·ç›´æ¥æ“ä½œ Zookeeper ä¸Šçš„å…ƒæ•°æ®ï¼Œå¹¶ä¸ä¼šç›´æ¥è¿æ¥åˆ° Broker ä¸Šï¼Œéœ€è¦ç¡®ä¿æ‰€ä½¿ç”¨çš„å·¥å…·ç‰ˆæœ¬ä¸é›†ç¾¤ä¸­çš„ Broker ç‰ˆæœ¬ç›¸åŒ¹é…ã€‚&lt;/p>
&lt;blockquote>
&lt;p>ğŸ—ï¸&lt;/p>
&lt;p>Kafka 2.2+ ä½¿ç”¨ Kafka çš„ hostname &amp;amp; port è¿›è¡Œæ“ä½œ &lt;code>--bootstrap-server 127.0.0.1:9092&lt;/code>&lt;/p>
&lt;p>æ—§ç‰ˆæœ¬ä½¿ç”¨ Zookeeper çš„ URL &amp;amp; port è¿›è¡Œæ“ä½œ &lt;code>--zookeeper 127.0.0.1:2181&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºä¸»é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2.2 +&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-topics.sh --bootstrap-server localhost:9092 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --create &lt;span class="se">\ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --topic first_topic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --partitions &lt;span class="m">3&lt;/span> &lt;span class="se">\ &lt;/span> &lt;span class="c1"># åˆ†åŒºæ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --replication-factor &lt;span class="m">1&lt;/span> &lt;span class="c1"># å‰¯æœ¬æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># old&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-topics.sh --zookeeper localhost:2181 --topic first_topic --create --partitions &lt;span class="m">3&lt;/span> --replication-factor &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ—å‡ºä¸»é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2.2 + &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-topics.sh --bootstrap-server localhost:9092 --list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¯¦ç»†ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-topics.sh --bootstrap-server localhost:9092 --describe --topic first_topic
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¿®æ”¹ä¸»é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-topics.sh --bootstrap-server localhost:9092 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --alter &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --topic first_topic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --partitions &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç”Ÿäº§--æ¶ˆè´¹">ç”Ÿäº§ &amp;amp; æ¶ˆè´¹&lt;/h3>
&lt;blockquote>
&lt;p>ğŸ—ï¸ Producer&lt;/p>
&lt;p>Kafka 2.5+ ä½¿ç”¨ &lt;code>--bootstrap-server&lt;/code>&lt;/p>
&lt;p>æ—§ç‰ˆæœ¬ Kafka ä½¿ç”¨ &lt;code>--broker-list&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿäº§&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-console-producer.sh --bootstrap-server localhost:9092 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --topic first_topic
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ğŸ—ï¸ Consumer&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>--bootstrap-server&lt;/code>ï¼Œè‡ª v0.10 å¼€å§‹ &lt;code>--zookeeper&lt;/code> å·²è¢«åºŸå¼ƒ&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">kafka-console-consumer.sh --bootstrap-server localhost:9092 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --topic first_topic
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-producer">ğŸ¤² Producer&lt;/h2>
&lt;h3 id="-ç”Ÿäº§è€…">ğŸˆ ç”Ÿäº§è€…&lt;/h3>
&lt;ul>
&lt;li>ğŸ§© &lt;code>ProducerRecord&lt;/code> å¯¹è±¡åŒ…å«ç›®æ ‡ä¸»é¢˜ Topic å’Œéœ€è¦å‘é€çš„å†…å®¹ Valueï¼Œå¯ä»¥å¯ä»¥æŒ‡å®šåˆ†åŒº Partition å’Œé”®å€¼ Keyï¼ˆæ¶ˆæ¯çš„é™„åŠ ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥å†³å®šæ¶ˆæ¯è¢«å†™å…¥å“ªä¸ªåˆ†åŒºï¼Œç›¸åŒ Key çš„æ¶ˆæ¯ä¼šå†™å…¥åŒä¸€ä¸ªåˆ†åŒºï¼‰&lt;/li>
&lt;li>ğŸ§© å‘é€æ¶ˆæ¯æ—¶ï¼Œç”Ÿäº§è€…éœ€è¦å°† &lt;code>ProducerRecord&lt;/code> å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“&lt;/li>
&lt;li>ğŸ§© æ•°æ®è¢«ä¼ é€ç»™åˆ†åŒºå™¨ &lt;code>Partitioner&lt;/code>ï¼Œå¦‚æœæŒ‡å®šäº†åˆ†åŒºï¼Œä¼šç›´æ¥è¿”å›ï¼›æ²¡æœ‰æŒ‡å®šï¼Œæ ¹æ® Key é€‰æ‹©ä¸€ä¸ªåˆ†åŒºï¼›æ²¡æœ‰æŒ‡å®š Keyï¼Œä¼šæ ¹æ® Value è¿›è¡Œæ•£åˆ—ï¼Œæ ¹æ®æ•£åˆ—å€¼æŠŠæ¶ˆæ¯æ˜ å°„åˆ°ç›¸åº”çš„åˆ†åŒº&lt;/li>
&lt;li>ğŸ§© è¿™æ¡è®°å½•é€‰å¥½åˆ†åŒºåï¼Œä¼šè¢«æ·»åŠ åˆ°ä¸€ä¸ªè®°å½•æ‰¹æ¬¡ä¸­ï¼Œè¿™ä¸ªæ‰¹æ¬¡çš„æ‰€æœ‰æ¶ˆæ¯ä¼šè¢«å‘é€åˆ°ç›¸åŒçš„ä¸»é¢˜å’Œåˆ†åŒºä¸Šï¼ˆæ‰¹å¤„ç†ï¼‰ï¼Œç‹¬ç«‹çš„ &lt;code>Processer&lt;/code> çº¿ç¨‹ä¼šè´Ÿè´£æŠŠè¿™äº›æ•°æ®å‘é€åˆ°å¯¹åº”çš„ broker ä¸Š&lt;/li>
&lt;li>ğŸ§© Broker æ”¶åˆ°æ¶ˆæ¯æ—¶ä¼šè¿”å›ä¸€ä¸ªå“åº”
&lt;ul>
&lt;li>æ¶ˆæ¯æˆåŠŸå†™å…¥ Kafkaï¼Œè¿”å›ä¸€ä¸ª &lt;code>RecordMetaData&lt;/code> å¯¹è±¡ï¼ŒåŒ…å«ä¸»é¢˜å’Œåˆ†åŒºçš„ä¿¡æ¯&lt;/li>
&lt;li>å†™å…¥å¤±è´¥ï¼Œä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œç”Ÿäº§è€…æ”¶åˆ°é”™è¯¯ä¹‹åä¼šå°è¯•é‡æ–°å‘é€ï¼Œå¤šæ¬¡å¤±è´¥ç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/operation/producer.webp"
width="780"
height="678"
srcset="https://emerywan.github.io/blog/blog/p/kafka/operation/producer_huebfba9d061e763283d9c37fc8487b94d_24528_480x0_resize_q75_h2_box_2.webp 480w, https://emerywan.github.io/blog/blog/p/kafka/operation/producer_huebfba9d061e763283d9c37fc8487b94d_24528_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="115"
data-flex-basis="276px"
>&lt;/p>
&lt;h4 id="é‡è¦é…ç½®">é‡è¦é…ç½®&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>&lt;code>acks&lt;/code>&lt;/p>
&lt;p>æŒ‡å®šäº†å¿…é¡»è¦æœ‰å¤šå°‘ä¸ªåˆ†åŒºå‰¯æœ¬æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿäº§è€…æ‰ä¼šä»»åŠ¡æ¶ˆæ¯å†™å…¥æ—¶æˆåŠŸçš„&lt;/p>
&lt;ul>
&lt;li>&lt;code>acks=0&lt;/code> ä¸ä¼šç­‰å¾…ä»»åŠ¡æ¥è‡ªæœåŠ¡å™¨çš„å“åº”ã€‚è¾¾åˆ°æœ€é«˜çš„ååé‡ï¼Œæ— æ³•å¾—çŸ¥æ¶ˆæ¯çŠ¶æ€ã€‚&lt;/li>
&lt;li>&lt;code>acks=1&lt;/code> åªè¦ Partition Leader æ”¶åˆ°å“åº”ã€‚æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼ŒLeaderå®•æœºåï¼Œä¸€ä¸ªæœªåŒæ­¥çš„Flloweræˆä¸ºæ–°çš„Leaderã€‚&lt;/li>
&lt;li>&lt;code>acks=all&lt;/code> æ¶ˆæ¯è¦å…¨éƒ¨åŒæ­¥åˆ°æ‰€æœ‰çš„ Leader&amp;amp;Fllowerã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>retries&lt;/code>&lt;/p>
&lt;p>ç”Ÿäº§è€…å¯ä»¥é‡å‘æ¶ˆæ¯çš„æ¬¡æ•°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>max.in.flight.requests.per.connection&lt;/code>&lt;/p>
&lt;p>ç”Ÿäº§è€…åœ¨æ”¶åˆ°æœåŠ¡å™¨å“åº”å‰å¯ä»¥å‘é€å¤šå°‘ä¸ªæ¶ˆæ¯ã€‚&lt;/p>
&lt;p>Kafka å¯ä»¥ä¿è¯åŒä¸€ä¸ªåˆ†åŒºé‡Œçš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œ&lt;code>max.in.flight.requests.per.connection=1&lt;/code>ï¼Œå³ä½¿å‘é€äº†é‡è¯•ï¼Œæ¶ˆæ¯ä¾æ—§æœ‰åºï¼Œä½†æ˜¯ä¼šä¸¥é‡å½±å“ç”Ÿäº§è€…çš„ååé‡ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-åŒæ­¥å‘é€">ğŸˆâ€â¬› åŒæ­¥å‘é€&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">RecordMetadata&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">send&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ &lt;code>send()&lt;/code> æ–¹æ³•å‘é€æ¶ˆæ¯ï¼Œä¼šè¿”å›ä¸€ä¸ª Future å¯¹è±¡ï¼Œè°ƒç”¨ &lt;code>get()&lt;/code> æ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œå°±å¯ä»¥çŸ¥é“æ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç›¸å…³é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">bootstrapServers&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;127.0.0.1:9092&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Properties&lt;/span> &lt;span class="n">properties&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Properties&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProducerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">BOOTSTRAP_SERVERS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">bootstrapServers&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProducerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">KEY_SERIALIZER_CLASS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">StringSerializer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span> &lt;span class="c1">// åºåˆ—åŒ–æ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProducerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">VALUE_SERIALIZER_CLASS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">StringSerializer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åˆ›å»º Producer
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">KafkaProducer&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">producer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">KafkaProducer&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="n">properties&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åˆ›å»ºæ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">producerRecord&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="s">&amp;#34;demo_topic&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;hello world!&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å‘é€æ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">producer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">send&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// get() åŒæ­¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// å‘ç”Ÿäº†æ— æ³•è§£å†³çš„é”™è¯¯ æˆ– é‡è¯•è¶…è¿‡æœ€å¤§æ¬¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å¼‚æ­¥å‘é€">ğŸ… å¼‚æ­¥å‘é€&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">RecordMetadata&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">send&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Callback&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è°ƒç”¨ &lt;code>send()&lt;/code> æ–¹æ³•ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ŒæœåŠ¡å™¨åœ¨è¿”å›å“åº”æ—¶è°ƒç”¨è¯¥å‡½æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">producer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">send&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">producerRecord&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Callback&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">onCompletion&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">RecordMetadata&lt;/span> &lt;span class="n">recordMetadata&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å‘é€å¤±è´¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å¯¹åº”çš„ä¸šåŠ¡å¤„ç†é€»è¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-åºåˆ—åŒ–å™¨">ğŸ† åºåˆ—åŒ–å™¨&lt;/h3>
&lt;p>å¸¸è§çš„åºåˆ—åŒ–&amp;amp;ååºåˆ—åŒ–å™¨æœ‰ Avroã€Thriftã€Protobuf ç­‰ã€‚&lt;/p>
&lt;p>Apache &lt;a class="link" href="https://zhuanlan.zhihu.com/p/370519371" target="_blank" rel="noopener"
>Avro&lt;/a> æ˜¯ä¸€ç§ä¸ç¼–ç¨‹è¯­è¨€æ— å…³çš„åºåˆ—åŒ–æ ¼å¼ã€‚&lt;/p>
&lt;p>Avro é€šè¿‡ä¸è¯­è¨€æ— å…³çš„ schema æ¥å®šä¹‰ï¼Œä½¿ç”¨ JSON æ¥æè¿°ï¼Œæ•°æ®ä¼šè¢«åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶æˆ– JSON æ–‡ä»¶ã€‚&lt;/p>
&lt;p>æ»¡è¶³ Avro å…¼å®¹åŸåˆ™ä¸‹ï¼Œå†™å…¥çš„æ¶ˆæ¯æ”¹åŠ¨ schema å†™å…¥äº†æ–°çš„æ•°æ®ï¼Œè´Ÿè´£è¯»æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºå¯ä»¥ç»§ç»­å¤„ç†è€Œæ— éœ€åšä»»ä½•æ›´æ”¹ã€‚&lt;/p>
&lt;h3 id="-åˆ†åŒº">ğŸ• åˆ†åŒº&lt;/h3>
&lt;p>&lt;code>ProducerRecord&lt;/code> å¯¹è±¡å¯ä»¥åŒ…å« topicã€partitionã€keyã€value ç­‰ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šæŒ‡å®š keyï¼Œä½œä¸ºé™„åŠ æ¶ˆæ¯ï¼Œå†³å®šæ¶ˆæ¯è¯¥è¢«å†™å…¥å“ªä¸ªåˆ†åŒºï¼Œæ‹¥æœ‰ç›¸åŒ key çš„æ¶ˆæ¯ä¼šè¢«å†™å…¥åŒä¸€ä¸ªåˆ†åŒºã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// topic: CustomerCountry
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// key: Laboratory Equipment
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// value: USA
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="s">&amp;#34;CustomerConuntry&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;Laboratory Equipment&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;USA&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åˆ›å»º key-&amp;gt;null çš„æ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="s">&amp;#34;CustomerCountry&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;USA&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“ key ä¸º null æ—¶ï¼ŒKafka ä¼šå¯¹é”®è¿›è¡Œæ•£åˆ—ï¼ˆKafka è‡ªå·±çš„æ•£åˆ—ç®—æ³•ï¼‰ï¼Œç„¶åæ ¹æ®æ•£åˆ—å€¼æ˜ å°„åˆ°ç‰¹æ®Šçš„åˆ†åŒºã€‚&lt;/p>
&lt;h4 id="è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥">è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥&lt;/h4>
&lt;p>é€šè¿‡å®ç° &lt;code>interface Partitioner&lt;/code> å®ç°è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥ï¼Œä¸»è¦åŒ…å«ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>void configure(Map&amp;lt;String, ?&amp;gt; configs)&lt;/code>
&lt;ul>
&lt;li>å®é™…åº”ç”¨ä¸­ï¼Œåº”é€šè¿‡è¯¥æ–¹æ³•ä¼ å…¥ç›¸å…³ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>void partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster)&lt;/code>&lt;/li>
&lt;li>&lt;code>void close()&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">BananaPartitioner&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Partitioner&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">configure&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&amp;gt;&lt;/span> &lt;span class="n">configs&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">partition&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">topic&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">keyBytes&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">valueBytes&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Cluster&lt;/span> &lt;span class="n">cluster&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PartitionInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">partitions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cluster&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">partitionsForTopic&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">topic&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">numPartitions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">partition&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">((&lt;/span>&lt;span class="n">keyBytes&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="o">(!(&lt;/span>&lt;span class="n">key&lt;/span> &lt;span class="n">instanceOf&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">)))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">InvalidRecordException&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;We expect all messages to have customer name as key&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(((&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Banana&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// Banana æ€»æ˜¯è¢«åˆ†é…åˆ°æœ€åä¸€ä¸ªåˆ†åŒº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">numPartitions&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å…¶å®ƒè®°å½•è¢«æ•£åˆ—åˆ°å…¶ä»–åˆ†åŒº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="o">((&lt;/span>&lt;span class="n">Math&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">abs&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">murmur2&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">keyBytes&lt;/span>&lt;span class="o">)))&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">numPartitions&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">close&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-consumer">ğŸ‘Œ Consumer&lt;/h2>
&lt;h3 id="-æ¶ˆè´¹è€…ç»„">ğŸ¦œ æ¶ˆè´¹è€…ç»„&lt;/h3>
&lt;h3 id="-æ¶ˆæ¯è½®è¯¢">ğŸ¦š æ¶ˆæ¯è½®è¯¢&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">bootstrapServers&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;127.0.0.1:9092&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">groupId&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;demo_groupId&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">topic&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;demo_topic&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Properties&lt;/span> &lt;span class="n">properties&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Properties&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">BOOTSTRAP_SERVERS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">bootstrapServers&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">KEY_DESERIALIZER_CLASS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">StringDeserializer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">VALUE_DESERIALIZER_CLASS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">StringDeserializer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">GROUP_ID_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">groupId&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">AUTO_OFFSET_RESET_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;earliest&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åˆ›å»ºæ¶ˆè´¹è€…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">KafkaConsumer&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">consumer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">KafkaConsumer&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="n">properties&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è®¢é˜…ä¸»é¢˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">subscribe&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">topic&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è½®è¯¢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ConsumerRecords&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">records&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">poll&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Duration&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ofMillis&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="o">));&lt;/span> &lt;span class="c1">// 100 -&amp;gt; è¶…æ—¶æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">records&lt;/span>&lt;span class="o">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸šåŠ¡å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Key: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">key&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;, Value: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Partition: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">partition&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;, Offset:&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">offset&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¶ˆæ¯è½®è¯¢æ˜¯æ¶ˆè´¹è€… API çš„æ ¸å¿ƒï¼Œä¸€æ—¦æ¶ˆè´¹è€…è®¢é˜…çš„ä¸»é¢˜ï¼Œè½®è¯¢ä¼šå¤„ç†æ‰€æœ‰çš„ç»†èŠ‚ã€‚
&lt;code>poll()&lt;/code> ä¼šè´Ÿè´£æŸ¥æ‰¾ GroupCordinatorï¼ŒåŠ å…¥ç¾¤ç»„ï¼Œæ¥å—åˆ†é…çš„åˆ†åŒºï¼Œå‘é€å¿ƒè·³å’Œè·å–æ•°æ®ã€‚å¦‚æœå‘ç”Ÿäº†å†å‡è¡¡ï¼Œä¹Ÿæ˜¯è¿™ä¸ªè½®è¯¢æœŸé—´è¿›è¡Œçš„ã€‚&lt;/p>
&lt;p>âš ï¸ æ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…åªèƒ½è¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ã€‚å¦‚æœéœ€è¦å¤šä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ª Patition ä¸­çš„æ¶ˆæ¯ï¼Œå¯ä»¥å°†è¿™ä¸ªæ¶ˆè´¹è€…è·å–çš„ä¸€æ‰¹æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ ExecutorService å¯åŠ¨å¤šä¸ªçº¿ç¨‹å¤„ç†ã€‚&lt;/p>
&lt;h3 id="-åç§»é‡">ğŸ¦‰ åç§»é‡&lt;/h3>
&lt;p>Kafka ä½¿ç”¨åç§»é‡ offset è¿½è¸ªæ¶ˆæ¯åœ¨åˆ†åŒºä¸­çš„ä½ç½®ã€‚&lt;/p>
&lt;p>Consumer å‘ä¸€ä¸ªç‰¹æ®Šçš„ä¸»é¢˜ &lt;code>_consumer_offset&lt;/code> å‘é€æ¶ˆæ¯ï¼Œæ›´æ–°åˆ†åŒºå½“å‰çš„ä½ç½®ã€‚&lt;/p>
&lt;ul>
&lt;li>å¦‚æœæäº¤çš„ offsetã€Œå°äºã€å®¢æˆ·ç«¯å¤„ç†çš„æœ€åä¸€ä¸ªæ¶ˆæ¯åç§»é‡ï¼Œé‚£ä¹ˆã€Œä¸¤ä¸ªåç§»é‡ä¹‹é—´çš„æ¶ˆæ¯ä¼šè¢«é‡å¤å¤„ç†ã€&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/operation/offset1.png"
width="978"
height="422"
srcset="https://emerywan.github.io/blog/blog/p/kafka/operation/offset1_hu7de55e7adbd4de02cc42f3a04ca7fa88_35082_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/operation/offset1_hu7de55e7adbd4de02cc42f3a04ca7fa88_35082_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="231"
data-flex-basis="556px"
>&lt;/p>
&lt;ul>
&lt;li>å¦‚æœæäº¤çš„ offsetã€Œå¤§äºã€å®¢æˆ·ç«¯å¤„ç†çš„æœ€åä¸€ä¸ªæ¶ˆæ¯åç§»é‡ï¼Œé‚£ä¹ˆã€Œä¸¤ä¸ªåç§»é‡ä¹‹é—´çš„æ¶ˆæ¯ä¼šä¸¢å¤±ã€&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/operation/offset2.png"
width="979"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/kafka/operation/offset2_hu389bebeaa08efdc7ddfc7a71cffd3a76_34010_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/operation/offset2_hu389bebeaa08efdc7ddfc7a71cffd3a76_34010_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="201"
data-flex-basis="484px"
>&lt;/p>
&lt;h4 id="è‡ªåŠ¨æäº¤">è‡ªåŠ¨æäº¤&lt;/h4>
&lt;p>å¦‚æœ &lt;code>enable.auto.commit = true&lt;/code>ï¼Œæ¶ˆè´¹è€…ä¼šè‡ªåŠ¨æŠŠä» &lt;code>poll()&lt;/code> æ–¹æ³•æ¥æ”¶åˆ°çš„æœ€å¤§åç§»é‡æäº¤ä¸Šå»ã€‚æäº¤çš„æ—¶é—´é—´éš”ç”± &lt;code>auto.commit.interval.ms&lt;/code> æ§åˆ¶ï¼Œé»˜è®¤ä¸º 5sã€‚&lt;/p>
&lt;p>è‡ªåŠ¨æäº¤å‘ç”Ÿåœ¨æ¯æ¬¡è½®è¯¢æ—¶ï¼Œå¦‚æœæ²¡æœ‰æäº¤åç§»é‡ï¼Œä¼šæŠŠä¸Šä¸€æ¬¡è°ƒç”¨è¿”å›çš„åç§»é‡æäº¤ä¸Šå»ï¼Œã€Œä¸èƒ½ä¿è¯è¿™äº›æ¶ˆæ¯å·²ç»è¢«ä¸šåŠ¡å¤„ç†äº†ã€ã€‚&lt;/p>
&lt;p>âš ï¸ å¦‚æœè®¾ç½®é»˜è®¤æäº¤æ—¶é—´ä¸º 5sï¼Œåœ¨æäº¤å 3s å‘ç”Ÿäº†å†å‡è¡¡ï¼Œä¹‹åçš„æ¶ˆè´¹è€…ä¼šå†æ¬¡è·å–åˆ° 3s å‰æäº¤çš„åç§»é‡ï¼Œè¿™äº›æ¶ˆæ¯ä¼šè¢«é‡å¤å¤„ç†ï¼Œã€Œæ— æ³•é¿å…è¿™ç§æƒ…å†µã€ï¼Œåªèƒ½ç¼©å°æäº¤çš„æ—¶é—´é—´éš”æ›´é¢‘ç¹åœ°æäº¤ offsetï¼Œã€ŒKafka ä¹Ÿæ²¡æœ‰ä¸ºè‡ªåŠ¨æäº¤é¢„ç•™é¿å…é‡å¤å¤„ç†æ¶ˆæ¯çš„æ–¹æ³•ã€ã€‚&lt;/p>
&lt;p>é€‚åˆäºä¸é‡è¦çš„æ¶ˆæ¯åœºæ™¯ï¼Œå¦‚æ—¥å¿—é‡‡é›†ã€‚&lt;/p>
&lt;h4 id="åŒæ­¥æäº¤">åŒæ­¥æäº¤&lt;/h4>
&lt;p>è®¾ç½® &lt;code>auto.commit.offset = false&lt;/code>ï¼Œå¯ä»¥è®©åº”ç”¨ç¨‹åºå†³å®šåœ¨ä»€ä¹ˆæ—¶å€™æäº¤åç§»é‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ConsumerRecords&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">records&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">poll&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">records&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å¤„ç†ä¸šåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitSync&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// æ‰‹åŠ¨æäº¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">CommitFailedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;commit failed&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åªè¦æ²¡æœ‰å‘ç”Ÿä¸å¯æ¢å¤çš„é”™è¯¯ï¼Œ&lt;code>commitSync()&lt;/code> æ–¹æ³•ä¼šã€Œä¸€ç›´å°è¯•ç›´åˆ°æäº¤æˆåŠŸä¸ºæ­¢ã€ã€‚å¦‚æœæäº¤å¤±è´¥ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p>
&lt;h4 id="å¼‚æ­¥æäº¤">å¼‚æ­¥æäº¤&lt;/h4>
&lt;p>ä½¿ç”¨å¼‚æ­¥æäº¤ APIï¼Œåªç®¡å‘é€æäº¤è¯·æ±‚ï¼Œæ— éœ€ç­‰å¾… Broker çš„å“åº”ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitAsync&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åŒæ­¥æäº¤ &lt;code>commitSync()&lt;/code> ä¼šä¸€ç›´é‡è¯•ï¼Œä½†æ˜¯å¼‚æ­¥æäº¤ &lt;code>commitAsync()&lt;/code>ã€Œä¸ä¼šé‡è¯•ã€ã€‚ä¸è¿›è¡Œé‡è¯•ï¼Œæ˜¯å› ä¸ºåœ¨æ”¶åˆ°æœåŠ¡å™¨å“åº”çš„æ—¶å€™ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªæ›´å¤§çš„ offset å·²ç»æäº¤æˆåŠŸã€‚&lt;/p>
&lt;p>å¼‚æ­¥æäº¤åŒæ ·æ”¯æŒå›è°ƒã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitAsync&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">OffsetCommitCallback&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">onComplete&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TopicPartition&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">OffsetAndMetadata&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">offsets&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¼‚æ­¥æäº¤å¤±è´¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ... ä¸šåŠ¡å¤„ç† / é‡è¯•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¼‚æ­¥æäº¤é‡è¯•ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•è°ƒé€’å¢çš„åºåˆ—å·ç»´æŠ¤å¼‚æ­¥æäº¤çš„é¡ºåºã€‚åœ¨è¿›è¡Œé‡è¯•å‰ï¼Œå…ˆæ£€æŸ¥å›è°ƒåºåˆ—å·ä¸ç»´æŠ¤çš„åºåˆ—å·çš„å¤§å°ï¼Œå¦‚æœå›è°ƒåºåˆ—å·è¾ƒå¤§ï¼Œè¯´æ˜æœ‰ä¸€ä¸ªæ–°çš„æäº¤å·²ç»å‘é€ï¼Œä¸åº”è¯¥é‡è¯•ã€‚&lt;/p>
&lt;h4 id="ç»„åˆæäº¤">ç»„åˆæäº¤&lt;/h4>
&lt;p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¶å°”çš„æäº¤å¤±è´¥ä¸è¿›è¡Œé‡è¯•æ²¡æœ‰å¤ªå¤§é—®é¢˜ï¼Œåªè¦åç»­æœ‰æ›´å¤§çš„ offset æˆåŠŸæäº¤ï¼Œå°±ä¸ä¼šæœ‰é—®é¢˜ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œåœ¨æ¶ˆè´¹è€…å…³é—­å‰ï¼Œå¯ä»¥ç»„åˆä½¿ç”¨ä¸¤ç§æäº¤æ–¹å¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// æ¶ˆè´¹æ¶ˆæ¯ä¸šåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comsumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitAsync&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// å¼‚æ­¥æäº¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Unexpected error&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitSync&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// åŒæ­¥ï¼Œä¼šä¸æ–­é‡è¯•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="æäº¤ç‰¹å®šåç§»é‡">æäº¤ç‰¹å®šåç§»é‡&lt;/h4>
&lt;p>æ¯æ¬¡æ¶ˆè´¹è€… &lt;code>poll()&lt;/code> çš„éƒ½æ˜¯ä¸€æ‰¹æ•°æ®ï¼Œ&lt;code>commitSync() / commitAsync()&lt;/code> æ¯æ¬¡æäº¤éƒ½æ˜¯è¿™ä¸ªæ‰¹æ¬¡æœ€åçš„ offsetï¼Œå¦‚æœæƒ³è¦åœ¨æ‰¹æ¬¡ä¸­é—´æäº¤åç§»é‡ï¼Œå¯ä»¥ä¼ å…¥ã€Œå¸Œæœ›æäº¤çš„åˆ†åŒºå’Œåç§»é‡çš„ mapã€ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œæ¶ˆè´¹è€…å¯èƒ½ä¸çŸ¥è¯»å–ä¸€ä¸ªåˆ†åŒºï¼Œè¿™æ ·åšéœ€è¦ã€Œè·Ÿè¸ªæ‰€æœ‰åˆ†åŒºçš„åç§»é‡ã€ï¼Œé€šå¸¸ä¼šä½¿ä»£ç å˜å¾—å¾ˆå¤æ‚ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TopicPartition&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">OffsetAndMetadata&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">currentOffsets&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ConsumerRecords&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">records&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">poll&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// å‡è®¾æ¯ä¸ªæ‰¹æ¬¡ 10000 æ¡æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">records&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸šåŠ¡å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">currentOffsets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">TopicPartition&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">topic&lt;/span>&lt;span class="o">(),&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">partition&lt;/span>&lt;span class="o">()),&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">OffsetAndMetadata&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">offset&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;no metadata&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">1000&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// åœ¨æ¯ä¸ªæ‰¹æ¬¡ä¸­ï¼Œæ²¡å¤„ç† 1000 æ¡æ•°æ®æäº¤ä¸€æ¬¡ offset
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitAsync&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">currentOffsets&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">count&lt;/span>&lt;span class="o">++;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-ç‰¹å®šoffsetå¼€å§‹å¤„ç†">ğŸ¦© ç‰¹å®šoffsetå¼€å§‹å¤„ç†&lt;/h3>
&lt;h2 id="-connect">ğŸ–‡ï¸ Connect&lt;/h2>
&lt;h2 id="-stream">ğŸ’¦ Stream&lt;/h2>
&lt;!-- raw HTML omitted --></description></item><item><title>Kafka</title><link>https://emerywan.github.io/blog/p/kafka/</link><pubDate>Sat, 04 Mar 2023 11:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/kafka/</guid><description>&lt;img src="https://emerywan.github.io/blog/p/kafka/kafka.webp" alt="Featured image of post Kafka" />&lt;blockquote>
&lt;p>Apache Kafka is an open-source distributed event streaming platform.&lt;/p>
&lt;p>Kafka æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼äº‹ä»¶æµå¹³å°ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="-åŸºæœ¬æ¦‚å¿µ">ğŸ“‘ åŸºæœ¬æ¦‚å¿µ&lt;/h2>
&lt;h3 id="productor--consumer">Productor &amp;amp; Consumer&lt;/h3>
&lt;p>æŠŠæ¶ˆæ¯æ”¾åˆ°é˜Ÿåˆ—é‡Œé¢çš„å«ã€Œç”Ÿäº§è€…ã€ï¼›ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯çš„å«ã€Œæ¶ˆè´¹è€…ã€ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/productor-consumer.png"
width="1482"
height="182"
srcset="https://emerywan.github.io/blog/blog/p/kafka/productor-consumer_hu2c5c2f226caa4e26dde9bd9923036917_30803_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/productor-consumer_hu2c5c2f226caa4e26dde9bd9923036917_30803_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="814"
data-flex-basis="1954px"
>&lt;/p>
&lt;h3 id="topic">Topic&lt;/h3>
&lt;p>Producer å°†æ¶ˆæ¯å‘é€åˆ°ç‰¹å®šçš„ä¸»é¢˜ &lt;code>Topic&lt;/code>ï¼ŒConsumer é€šè¿‡è®¢é˜…ç‰¹å®šçš„ä¸»é¢˜ &lt;code>Topic&lt;/code> æ¥æ¶ˆè´¹æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>å¹¶éæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½æƒ³è¦å…¨éƒ¨çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…åªå¯¹è‡ªå·±æ„Ÿå…´è¶£çš„ Topic è¿›è¡Œè®¢é˜…ï¼Œä»æŒ‡å®šçš„ Topic æ¥è·å–æ¶ˆæ¯ã€‚
è¿™ä¸ªå‘é€é—®é¢˜ç”± ç”Ÿäº§è€… &lt;code>Product&lt;/code> æ¥è§£å†³ï¼Œç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œé€»è¾‘ä¸Šçš„åˆ†ç±»ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„ &lt;code>Topic&lt;/code>ã€‚ï¼ˆå‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼‰&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/topic.png"
width="1702"
height="464"
srcset="https://emerywan.github.io/blog/blog/p/kafka/topic_huc74fa2ac18b398764e9e6113e92396e7_102693_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/topic_huc74fa2ac18b398764e9e6113e92396e7_102693_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="366"
data-flex-basis="880px"
>&lt;/p>
&lt;h3 id="offset">offset&lt;/h3>
&lt;p>å¤šä¸ªæ¶ˆè´¹è€…å¯èƒ½å¯¹åŒä¸€ä¸ªä¸»é¢˜æ„Ÿå…´è¶£ï¼Œå³å¤šä¸ªæ¶ˆè´¹è€… &lt;code>Consumer&lt;/code> è®¢é˜…åŒä¸€ä¸ªä¸»é¢˜ &lt;code>Topic&lt;/code>ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ¶ˆè´¹é—®é¢˜ç”± æ¶ˆè´¹è€… &lt;code>Consumer&lt;/code> æ¥è§£å†³ã€‚
Kafka å°†æ‰€æœ‰çš„æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œè®©æ¶ˆè´¹è€…å„å–æ‰€éœ€ï¼Œæƒ³å–å“ªä¸ªæ¶ˆæ¯ï¼Œæƒ³ä»€ä¹ˆæ—¶å€™å–éƒ½è¡Œï¼Œåªéœ€è¦ä¼ é€’ä¸€ä¸ªæ¶ˆæ¯çš„ &lt;code>offset&lt;/code> å³å¯ã€‚&lt;/p>
&lt;p>Kafka å°†æ¶ˆæ¯ä»¥æ¶ˆæ¯æ—¥å¿—çš„æ–¹å¼è¿½åŠ å†™åœ¨ç£ç›˜ä¸­ï¼ˆé¡ºåºç£ç›˜ IOï¼‰ã€‚&lt;/p>
&lt;p>&lt;code>offset&lt;/code> è¡¨ç¤ºäº†æ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦ã€‚æ¯ä¸€æ¡æ¶ˆæ¯éƒ½ä¼šæ ¹æ®æ—¶é—´å…ˆåé¡ºåºæœ‰ä¸€ä¸ªé€’å¢çš„åºå·ï¼Œç”¨ offset æ¥è¡¨ç¤ºæ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦åˆ°å“ªäº†ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…ä¼šéƒ½æœ‰è‡ªå·±çš„ offsetã€‚&lt;/p>
&lt;p>æ¯æ¬¡æ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™ï¼Œéƒ½è¦æäº¤è¿™ä¸ª &lt;code>offset&lt;/code>ï¼ŒKafka å¯ä»¥é€‰æ‹©ã€Œè‡ªåŠ¨æäº¤ã€æˆ–è€…ã€Œæ‰‹åŠ¨æäº¤ã€ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/offset.png"
width="1702"
height="882"
srcset="https://emerywan.github.io/blog/blog/p/kafka/offset_hub631ed3146c750d7a1db077a25e92c8f_157136_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/offset_hub631ed3146c750d7a1db077a25e92c8f_157136_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="192"
data-flex-basis="463px"
>&lt;/p>
&lt;h3 id="partition">Partition&lt;/h3>
&lt;p>&lt;code>Partition&lt;/code> æ˜¯ Kafka ã€Œæœ€åŸºæœ¬çš„éƒ¨ç½²å•å…ƒã€ã€‚&lt;/p>
&lt;p>å¯¹äºæµ·é‡æ•°æ®ï¼Œå•æœºçš„å­˜å‚¨å®¹é‡å’Œè¯»å†™æ€§èƒ½è‚¯å®šæœ‰é™ï¼Œä¸€ç§å¸¸è§çš„å­˜å‚¨æ–¹æ¡ˆå°±æ˜¯ã€Œå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¾‹å¦‚åœ¨ MySQL ä¸­ï¼Œå•è¡¨çš„æ•°é‡è¾¾åˆ°å‡ åƒä¸‡ã€ä¸Šäº¿æ—¶ï¼Œä¼šè¿›è¡Œåˆ†åº“ã€åˆ†è¡¨æ“ä½œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¾‹å¦‚åœ¨ Redis ä¸­ï¼Œå½“å•ä¸ªå®ä¾‹çš„æ•°æ®é‡è¾¾åˆ°å‡ åGå¼•å‘æ€§èƒ½ç“¶é¢ˆæ—¶ï¼Œä¼šè¿›è¡Œåˆ†ç‰‡é›†ç¾¤&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨ Kafka ä¸­ï¼ŒåŒæ ·é‡‡å–äº†æ°´å¹³æ‹†åˆ†çš„æ–¹æ¡ˆï¼Œå°†æ‹†åˆ†åçš„æ•°æ®å­é›†ç§°ä¸º &lt;code>Partition&lt;/code> åˆ†åŒºã€‚å„ä¸ªåˆ†åŒºçš„æ•°æ®é›†åˆå³ä¸ºå…¨é‡æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/partition.png"
width="1902"
height="862"
srcset="https://emerywan.github.io/blog/blog/p/kafka/partition_hu6f8e653e05b83b30cced1268a2afdec4_169756_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/partition_hu6f8e653e05b83b30cced1268a2afdec4_169756_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="220"
data-flex-basis="529px"
>&lt;/p>
&lt;p>åˆ†åŒºè·¯ç”±å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºä¸€ä¸ª Hash å‡½æ•°ï¼Œç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªå‡½æ•°çš„è§„åˆ™å†³å®šå‘å¾€çš„åˆ†åŒºã€‚å°†åˆ†åŒºè§„åˆ™è®¾è®¡çš„åˆç†ï¼Œå¯ä»¥å°†æ¶ˆæ¯å‡åŒ€åœ°åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºä¸Šã€‚&lt;/p>
&lt;p>ç”Ÿäº§è€… &lt;code>Productor&lt;/code> å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå…ˆé€šè¿‡ &lt;code>Topic&lt;/code> å¯¹æ¶ˆæ¯è¿›è¡Œé€»è¾‘åˆ†ç±»ï¼Œåœ¨é€šè¿‡ &lt;code>Partition&lt;/code> è¿›ä¸€æ­¥åšç‰©ç†åˆ†ç‰‡ï¼Œæœ€ç»ˆå¤šä¸ª Partition ä¼šå‡åŒ€åœ°åˆ†å¸ƒåœ¨é›†ç¾¤çš„æ¯å°æœºå™¨ä¸Šï¼Œä»è€Œå¾ˆå¥½åœ°è§£å†³äº†å­˜å‚¨æ‰©å±•æ€§é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="broker">Broker&lt;/h3>
&lt;p>ä¸€å° Kafka æœåŠ¡å™¨è¢«ç§°ä¸º &lt;code>Broker&lt;/code>ï¼ŒKafka é›†ç¾¤ç”±å¤šå° Kafka æœåŠ¡å™¨ç»„æˆã€‚&lt;/p>
&lt;p>Kafka æ˜¯ã€Œå¤©ç„¶åˆ†å¸ƒå¼ã€çš„ã€‚&lt;/p>
&lt;p>ä¸€ä¸ª &lt;code>Topic&lt;/code> ä¼šè¢«åˆ†ä¸ºå¤šä¸ª &lt;code>Partition&lt;/code>ï¼Œè¿™äº› Partition ä¼šåˆ†å¸ƒåœ¨ä¸åŒçš„ &lt;code>Broker&lt;/code> ä¸­ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/broker.png"
width="2744"
height="1204"
srcset="https://emerywan.github.io/blog/blog/p/kafka/broker_huddafab0296be063dc2cfa60773db7d44_193217_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/broker_huddafab0296be063dc2cfa60773db7d44_193217_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="227"
data-flex-basis="546px"
>&lt;/p>
&lt;h3 id="leader--follower">leader &amp;amp; follower&lt;/h3>
&lt;p>åœ¨ Kafka é›†ç¾¤ä¸­ï¼Œæ¯å°æœºå™¨éƒ½ä¼šå­˜å‚¨ä¸€äº› Partitionï¼Œä¸ºäº†é˜²æ­¢æœºå™¨å®•æœºæ—¶ï¼Œè¿™éƒ¨åˆ†æ•°æ®æ— æ³•è®¿é—®çš„é—®é¢˜ï¼ˆæŒä¹…åŒ–ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼‰ã€‚
éœ€è¦ Kafka å…·å¤‡æ•…éšœè½¬ç§»èƒ½åŠ›ï¼Œå½“æŸå°æœºå™¨å®•æœºåï¼Œèƒ½å¤Ÿç»§ç»­ä¿è¯æœåŠ¡å¯ç”¨ã€‚&lt;/p>
&lt;p>ä¸ Reids Cluster ç±»ä¼¼ï¼ŒKafka é€šè¿‡ã€ŒPartition å¤šå‰¯æœ¬ã€çš„æ–¹å¼ï¼Œè§£å†³äº†é«˜å¯ç”¨é—®é¢˜ã€‚
åœ¨ Kafka é›†ç¾¤ä¸­ï¼Œæ¯ä¸ª Partition éƒ½æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œä¿å­˜äº†ç›¸åŒçš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å‰¯æœ¬ä¹‹é—´æ˜¯ ã€Œä¸€ä¸»å¤šä»ã€çš„å…³ç³»ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>leader&lt;/code> å‰¯æœ¬è´Ÿè´£è¯»å†™æ•°æ®&lt;/li>
&lt;li>&lt;code>follower&lt;/code> å‰¯æœ¬è´Ÿè´£åŒæ­¥æ¶ˆæ¯ï¼Œåªè´Ÿè´£å¾…å‘½&lt;/li>
&lt;/ul>
&lt;p>å½“ leader å‰¯æœ¬å‘é€æ•…éšœæ—¶ï¼Œé€‰ä¸¾ follower å‰¯æœ¬æˆä¸ºæ–°çš„ leader å¯¹å¤–æä¾›æœåŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/leader_follwer.png"
width="1642"
height="982"
srcset="https://emerywan.github.io/blog/blog/p/kafka/leader_follwer_hud0b2c7f759aaa7a9577276a758bf8076_131159_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/leader_follwer_hud0b2c7f759aaa7a9577276a758bf8076_131159_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="167"
data-flex-basis="401px"
>&lt;/p>
&lt;h3 id="consumer-group">Consumer Group&lt;/h3>
&lt;p>Kafka æ˜¯ä¸ªé«˜å¹¶å‘çš„ç³»ç»Ÿï¼Œæ¶ˆæ¯çš„æ‹‰å–åŒæ ·æ˜¯å¹¶è¡Œçš„ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å»æ¶ˆè´¹ Topic æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>Kafka å¼•å…¥äº†æ¶ˆè´¹è€…ç»„ &lt;code>Consumer Group&lt;/code> çš„æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ¶ˆè´¹è€…ç»„ã€‚ç»„é—´è¿›è¡Œå¹¿æ’­æ¶ˆè´¹ï¼Œç»„å†…è¿›è¡Œé›†ç¾¤æ¶ˆè´¹ã€‚åŒæ—¶é™å®šï¼šã€Œæ¯ä¸ª Partition åªèƒ½ç”±æ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/consumer_group.png"
width="1952"
height="1378"
srcset="https://emerywan.github.io/blog/blog/p/kafka/consumer_group_hu7674cf08adee570cc4acecde56b2e047_315635_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/consumer_group_hu7674cf08adee570cc4acecde56b2e047_315635_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>å½“éœ€è¦åŠ å¿«æ¶ˆæ¯çš„å¤„ç†é€Ÿåº¦ï¼Œï¼ˆå¦‚æ¶ˆè´¹è€…ç»„Bï¼‰åªéœ€è¦å¢åŠ æ–°çš„æ¶ˆè´¹è€…å³å¯ï¼ŒKafka ä¼šä»¥ Patition ä¸ºå•ä½é‡æ–°åšè´Ÿè½½å‡è¡¡ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥æ¶ˆè´¹ Topic çš„å…¨éƒ¨æ•°æ®ï¼Œæ¶ˆè´¹è€…ç»„åœ¨é€»è¾‘ä¸Šæ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚&lt;/p>
&lt;h2 id="-å­˜å‚¨ç»“æ„">ğŸ—³ï¸ å­˜å‚¨ç»“æ„&lt;/h2>
&lt;p>Kafka ä½¿ç”¨ã€Œæ—¥å¿—æ–‡ä»¶ Loggingã€çš„æ–¹å¼æ¥å­˜å‚¨æ¶ˆæ¯ï¼›ä½¿ç”¨ã€Œç¨€ç–å“ˆå¸Œç´¢å¼•ã€æ¥åŠ å¿«æŸ¥è¯¢ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Kafka å­˜å‚¨çš„ä¸»è¦æ˜¯æ¶ˆæ¯æµï¼ˆæ–‡æœ¬ã€è‡ªå®šä¹‰æ ¼å¼ï¼‰ï¼Œå¯¹äº Broker æ¥è¯´ï¼Œåªéœ€è¦å…³æ³¨æ¶ˆæ¯çš„æŠ•é€’ï¼Œæ— éœ€å…³æ³¨å†…å®¹æœ¬èº«&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å†™å…¥æ–¹é¢ï¼Œæ•°æ®é‡çº§éå¸¸å¤§ï¼Œéƒ½æ˜¯æŒ‰é¡ºåºå†™å…¥ï¼ˆé˜Ÿåˆ—ï¼‰ï¼Œä¸”æ— éœ€è€ƒè™‘æ›´æ–°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éœ€æ±‚ç®€å•ï¼Œåªéœ€è¦æŒ‰ç…§ offset æŸ¥è¯¢æ¶ˆæ¯å³å¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä¸ºäº†æ»¡è¶³å…¶å†™å…¥éœ€æ±‚ï¼ˆé‡çº§å¤§ã€ä¸æ›´æ–°ï¼‰ï¼Œé‡‡ç”¨ Append è¿½åŠ æ—¥å¿—çš„æ–¹å¼æœ€ç†æƒ³ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨ã€Œç£ç›˜é¡ºåº IOã€ã€‚&lt;/p>
&lt;p>åœ¨æŸ¥è¯¢æ—¶ï¼Œåªéœ€è¦é€šè¿‡ offset å®šä½æ¶ˆæ¯ï¼Œåœ¨å†…å­˜ä¸­ç»´æŠ¤äº†ä¸€ä¸ªã€Œä» offset åˆ°æ—¥å¿—æ–‡ä»¶çš„åç§»é‡ã€çš„æ˜ å°„å…³ç³»ï¼Œæ¯æ¬¡
æŸ¥è¯¢æ—¶ï¼Œå…ˆæ ¹æ® offset æ‰¾åˆ°æ—¥å¿—æ–‡ä»¶çš„åç§»é‡ï¼Œå³å¯å¿«é€Ÿè¯»å–åˆ°æ—¥å¿—æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å…å“ˆå¸Œç´¢å¼•å¸¸é©»å†…å­˜æ¶ˆè€—è¿‡å¤šç©ºé—´çš„é—®é¢˜ï¼Œå°†æ¶ˆæ¯åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå— blockï¼Œæ¯ä¸ªç´¢å¼•éœ€è¦å®šä½ block å—ä¸­çš„ç¬¬ä¸€æ¡æ¶ˆæ¯çš„ offset å³å¯ï¼ˆç¨€ç–ç´¢å¼•ï¼‰ï¼Œ
ç„¶ååœ¨ block ä¸­é¡ºåºæŸ¥æ‰¾ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/hash.png"
width="702"
height="486"
srcset="https://emerywan.github.io/blog/blog/p/kafka/hash_hu74f0171d0dcbf8a19203c6a91442ff0f_91411_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/hash_hu74f0171d0dcbf8a19203c6a91442ff0f_91411_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="144"
data-flex-basis="346px"
>&lt;/p>
&lt;h2 id="-kafka-çš„é«˜æ€§èƒ½">ğŸ”¥ Kafka çš„é«˜æ€§èƒ½&lt;/h2>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/performance.png"
width="725"
height="662"
srcset="https://emerywan.github.io/blog/blog/p/kafka/performance_hu3423f3489c82f749f8bb253d443fb73a_35239_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/performance_hu3423f3489c82f749f8bb253d443fb73a_35239_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="109"
data-flex-basis="262px"
>&lt;/p>
&lt;h3 id="-ç”Ÿäº§æ¶ˆæ¯">ğŸ“‘ ç”Ÿäº§æ¶ˆæ¯&lt;/h3>
&lt;p>Kafka å®¢æˆ·ç«¯ä¸ä¼ ç»Ÿçš„æ•°æ®åº“æˆ–æ¶ˆæ¯ä¸­é—´ä»¶ä¸åŒï¼Œåœ¨å°†æ¶ˆæ¯å‘é€ç»™ Broker ä¹‹å‰ï¼Œåœ¨ Client ç«¯å…ˆå®Œæˆå¤§é‡çš„å·¥ä½œä¹‹åæ‰å‘é€æ¶ˆæ¯ï¼Œåˆ†æ‘Š Broker çš„è®¡ç®—å‹åŠ›ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ«§ æ‰¹é‡å‘é€&lt;/p>
&lt;p>Kafka é€šè¿‡å¯¹å¤šæ¡æ¶ˆæ¯æŒ‰ç…§åˆ†åŒºè¿›è¡Œåˆ†ç»„ï¼Œæ¯æ¬¡å‘é€ä¸€ä¸ªæ¶ˆæ¯é›†åˆï¼Œä»è€Œå‡å°‘ç½‘ç»œä¼ è¾“çš„å¼€é”€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ«§ æ¶ˆæ¯å‹ç¼©&lt;/p>
&lt;p>åœ¨æ‰¹é‡å‘é€çš„å‰æä¸‹ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œå‹ç¼©ï¼ˆæ•°æ®é‡è¶Šå¤§ï¼Œå‹ç¼©æ•ˆæœæ›´å¥½ï¼‰ã€‚åŒæ—¶å¯¹å¤šæ¡æ¶ˆæ¯è¿›è¡Œå‹ç¼©ï¼Œèƒ½å¤§å¹…å‡å°‘æ•°æ®é‡ï¼Œ
åŒæ—¶å‡å°‘ç½‘ç»œã€ç£ç›˜IOå¼€é”€ã€‚æ¶ˆæ¯æŒä¹…åŒ–åˆ° Broker çš„ç£ç›˜æ—¶ï¼Œä¾æ—§æ˜¯å‹ç¼©çŠ¶æ€ï¼Œæœ€ç»ˆæ˜¯åœ¨ Consumer ç«¯è¿›è¡Œè§£å‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ«§ é«˜æ•ˆåºåˆ—åŒ–&lt;/p>
&lt;p>Kafka çš„ Key å’Œ Valueï¼Œéƒ½æ”¯æŒè‡ªå®šä¹‰ç±»å‹ï¼Œåªéœ€è¦æä¾›ç›¸åº”çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨å³å¯ã€‚å¯ä»¥æ ¹æ®æƒ…å†µé€‰å–å¯¹åº”çš„åºåˆ—åŒ–æ–¹å¼ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ğŸ«§ å†…å­˜æ± å¤ç”¨&lt;/p>
&lt;p>Kafka æå‡ºäº†ã€Œå†…å­˜æ± æœºåˆ¶ã€ï¼Œæé«˜å¤ç”¨ï¼Œå‡å°‘é¢‘ç¹çš„åˆ›å»ºå’Œå›æ”¶ã€‚ï¼ˆæœ¬è´¨ä¸Šä¸è¿æ¥æ± ã€çº¿ç¨‹æ± ä¸€æ ·ï¼‰ã€‚&lt;/p>
&lt;p>Productor åœ¨åˆ›å»ºæ—¶ï¼Œä¼šå ç”¨ä¸€å—å›ºå®šå¤§å°çš„å†…å­˜åŒºåŸŸï¼Œåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå—ï¼ˆä¾‹å¦‚ 16KBï¼‰ã€‚å½“éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å‘é€ Batch æ—¶ï¼Œç›´æ¥ä»å†…å­˜ä¸­å–å‡ºä¸€ä¸ªå—ï¼Œ
ä»ä¸­ä¸æ–­åœ°å†™å…¥æ¶ˆæ¯ï¼ˆå†™æ»¡æˆ–åˆ°æŒ‡å®šé˜ˆå€¼æ—¶é—´æ—¶ï¼‰ï¼Œå°†è¿™ä¸ª Batch å‘é€ç»™ Brokerï¼Œä¹‹åå†…å­˜å—å°±ä¼šå›åˆ°ç¼“å­˜æ± ä¸­ç»§ç»­å¤ç”¨ã€‚
ä¸ä¼šæ¶‰åŠ JVM çš„å†…å­˜å›æ”¶ï¼Œä»¥åº”å¯¹ Kafka çš„é«˜å¹¶å‘åœºæ™¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-å­˜å‚¨æ¶ˆæ¯">ğŸ“‡ å­˜å‚¨æ¶ˆæ¯&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸ«§ IO å¤šè·¯å¤ç”¨&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>1&lt;/code> ä¸ª &lt;code>Acceptor&lt;/code> çº¿ç¨‹ï¼Œå¤„ç†æ–°çš„è¿æ¥ï¼›ä½¿ç”¨ &lt;code>N&lt;/code> ä¸ª &lt;code>Processor&lt;/code> çº¿ç¨‹ï¼Œè¯»å–è¯·æ±‚ï¼›ä½¿ç”¨ &lt;code>M&lt;/code> ä¸ª &lt;code>Handler&lt;/code> çº¿ç¨‹ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p>
&lt;p>&lt;code>1&lt;/code> ä¸ª &lt;code>Acceptor&lt;/code> çº¿ç¨‹ï¼šç”¨äºç›‘å¬ç½‘ç»œå¥—æ¥å­—ï¼Œæ¥å—è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚æ´¾å‘ç»™ Processor çº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚
ä¸ Redis ç›¸åŒï¼ŒIO å¤šè·¯å¤ç”¨å…è®¸å†…æ ¸ä¸­åŒæ—¶ç®¡ç†å¤šä¸ª scoket è¿æ¥ï¼Œå†…æ ¸ä¼šä¸€ç›´ç›‘å¬è¿™äº›è¿æ¥ï¼Œä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šé€šçŸ¥å¤„ç†çº¿ç¨‹ï¼Œè¾¾åˆ°ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¯·æ±‚çš„æ•ˆæœã€‚&lt;/p>
&lt;p>&lt;code>N&lt;/code> ä¸ª &lt;code>Processor&lt;/code> çº¿ç¨‹ï¼šKafka ä¼šç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå°†è¯·æ±‚åˆ†å‘ç»™å¯ç”¨çš„ Processor çº¿ç¨‹å¤„ç†ã€‚ä¸»è¦è´Ÿè´£ä»å¥—æ¥å­—è¯»å–æ¶ˆæ¯ï¼Œè§£æå¤„ç†ï¼Œå¹¶å°†å“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚è¾¾åˆ°æ‰¹é‡æ“ä½œï¼Œæé«˜ååé‡ã€‚&lt;/p>
&lt;p>&lt;code>M&lt;/code> ä¸ª &lt;code>Handler&lt;/code> çº¿ç¨‹ï¼šç»´æŠ¤çš„çº¿ç¨‹æ± ï¼Œè´Ÿè´£è¯»å– Kafka Topic ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶å°†å…¶æäº¤åˆ°å¯¹åº”çš„ Consumer Groupã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ«§ ç£ç›˜é¡ºåº IO&lt;/p>
&lt;p>Kafka é‡‡ç”¨æ—¥å¿—æ–‡ä»¶çš„æ–¹å¼æŒä¹…åŒ–æ—¥å¿—ï¼Œä»¥ Append Only çš„æ–¹å¼è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼Œé¡ºåº IO ä½¿å†™å…¥é€Ÿåº¦éå¸¸å¿«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ«§ Page Cache&lt;/p>
&lt;p>åˆ©ç”¨äº†æ“ä½œç³»ç»Ÿæœ¬èº«çš„ç¼“å­˜æŠ€æœ¯ï¼Œåœ¨è¯»å†™ç£ç›˜æ–‡ä»¶æ—¶ï¼Œå…¶å®æ“ä½œçš„éƒ½æ˜¯å†…å­˜ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™å°† Page Cache ä¸­çš„æ•°æ®çœŸæ­£åˆ·å…¥ç£ç›˜ã€‚&lt;/p>
&lt;p>Page Cache ç¼“å­˜ä¸­ä¿å­˜çš„æ˜¯æœ€è¿‘å¯èƒ½è¢«ä½¿ç”¨çš„ç£ç›˜æ•°æ®ï¼Œå…·æœ‰æ—¶é—´å±€éƒ¨æ€§ï¼ˆæœ€è¿‘è®¿é—®çš„æ•°æ®å¯èƒ½å†æ¬¡è®¿é—®ï¼‰å’Œ ç©ºé—´å±€éƒ¨æ€§ï¼ˆè®¿é—®çš„æ•°æ®çš„å‘¨è¾¹æ•°æ®è¢«è®¿é—®çš„æ¦‚ç‡æé«˜ï¼‰ã€‚
ä½œä¸ºé¡ºåºå†™å…¥çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æœç”Ÿäº§å’Œæ¶ˆè´¹åœ°ç‰¹åˆ«å¿«ï¼Œåˆ©ç”¨ Broker Page Cacheï¼Œç”šè‡³å¯ä»¥ä¸ç»è¿‡ç£ç›˜å®Œæˆæ“ä½œã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ğŸ«§ åˆ†åŒºåˆ†æ®µç»“æ„&lt;/p>
&lt;p>Kafka çš„ Topic ä¼šè¢«åˆ†åŒºä¸ºå¤šä¸ª Partitionï¼Œåœ¨å¤šå° Broker ä¸­ï¼Œä½¿ç”¨å¤šä¸ªæœåŠ¡æ¥æ¥å—æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>åŒæ—¶æ¯ä¸ªåˆ†åŒº Partition ä¼šè¢«åˆ†ä¸ºå¤šä¸ªæ®µ Segment æ¥ç®¡ç†ï¼Œæ¯ä¸ªæ®µå†…éƒ½æ˜¯é¡ºåºå†™ï¼Œé¿å…åˆ†åŒºè¿‡å¤§ï¼Œåˆ©äºç®¡ç†ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¶ˆè´¹æ¶ˆæ¯">ğŸ“® æ¶ˆè´¹æ¶ˆæ¯&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸ«§ ç¨€ç–ç´¢å¼•&lt;/p>
&lt;p>Kafka æŸ¥è¯¢åœºæ™¯éå¸¸ç®€å•ï¼ŒæŒ‰ç…§ offset æŸ¥è¯¢æ¶ˆæ¯å³å¯ã€‚ä¸ºäº†åŠ å¿«è¯»æ“ä½œï¼Œåªéœ€è¦åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ª offset åˆ°æ—¥å¿—æ–‡ä»¶çš„åç§»é‡çš„æ˜ å°„å…³ç³» &lt;code>Map&lt;/code> å³å¯ã€‚
æ¯æ¬¡æŸ¥æ‰¾æ¶ˆæ¯ï¼Œå…ˆä»å“ˆå¸Œè¡¨ä¸­æŸ¥åˆ°æ–‡ä»¶åç§»é‡ï¼Œå†å»è¯»æ—¥å¿—æ–‡ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ«§ mmap&lt;/p>
&lt;p>&lt;code>memory mapped files&lt;/code>&lt;/p>
&lt;p>é‡‡ç”¨ mmap æ˜ å°„ç´¢å¼•æ–‡ä»¶ï¼ŒåŠ å¿«ç´¢å¼•çš„æŸ¥æ‰¾è¿‡ç¨‹ã€‚å°†ç£ç›˜æ–‡ä»¶ä¸å†…å­˜è™šæ‹Ÿåœ°å€åšäº†æ˜ å°„ï¼Œä¸éœ€è¦æ“ä½œç£ç›˜IOï¼Œè¿›ç¨‹å¯ä»¥ä½¿ç”¨æŒ‡é’ˆçš„æ–¹å¼æ“ä½œè¿™ä¸€å—å†…å­˜ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†è„é¡µå†™å…¥åˆ°å¯¹åº”çš„ç£ç›˜æ–‡ä»¶ä¸Šã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ğŸ«§ é›¶æ‹·è´&lt;/p>
&lt;p>é‡‡ç”¨äº†é›¶æ‹·è´ï¼Œå°†æ•°æ®ä»å†…å­˜ä¸­çš„ç¼“å­˜åŒºç›´æ¥æ‹·è´åˆ°ç½‘å¡è®¾å¤‡ï¼Œæ— éœ€ç»è¿‡åº”ç”¨ç¨‹åºï¼Œå‡å°‘äº†æ•°æ®çš„æ‹·è´å’Œå†…æ ¸æ€ä¸ç”¨æˆ·æ€çš„åˆ‡æ¢ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ğŸ«§ æ‰¹é‡æ‹‰å–&lt;/p>
&lt;p>ä¸å‘é€æ¶ˆæ¯å¯¹åº”ï¼Œæ¶ˆè´¹æ¶ˆæ¯ä¹Ÿæ˜¯æ‰¹é‡æ‹‰å–çš„ï¼Œæ¯æ¬¡æ‹‰å–ä¸€ä¸ªæ¶ˆæ¯é›†åˆï¼Œå‡å°‘ç½‘ç»œçš„å¼€é”€ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247490102&amp;amp;idx=1&amp;amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;amp;scene=21#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247490102&amp;idx=1&amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;scene=21#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247490102&amp;amp;idx=1&amp;amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247490102&amp;idx=1&amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491055&amp;amp;idx=1&amp;amp;sn=14bc485f91ec2629cc9e8bf7a36ad8f4&amp;amp;chksm=fc78c2c3cb0f4bd566d5ca2534805839420ad3dc67210bc8f2b7ef05283785b02b8ddef640a8&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491055&amp;idx=1&amp;sn=14bc485f91ec2629cc9e8bf7a36ad8f4&amp;chksm=fc78c2c3cb0f4bd566d5ca2534805839420ad3dc67210bc8f2b7ef05283785b02b8ddef640a8&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491168&amp;amp;idx=1&amp;amp;sn=bd37f96692b3f7cecdaf3172abdb7a8c&amp;amp;chksm=fc78c14ccb0f485a451f70c7ffbf5b05d0f500dfef6321703e7cdebdc0de902d9d77a547d469&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491168&amp;idx=1&amp;sn=bd37f96692b3f7cecdaf3172abdb7a8c&amp;chksm=fc78c14ccb0f485a451f70c7ffbf5b05d0f500dfef6321703e7cdebdc0de902d9d77a547d469&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491507&amp;amp;idx=1&amp;amp;sn=f1bec356c94cd0101809dc11dcf27ba2&amp;amp;chksm=fc78c09fcb0f49898f6cc9b80499aeb871a80f95ab4fbe12c32567cab6a3521a6c33b61dd807&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491507&amp;idx=1&amp;sn=f1bec356c94cd0101809dc11dcf27ba2&amp;chksm=fc78c09fcb0f49898f6cc9b80499aeb871a80f95ab4fbe12c32567cab6a3521a6c33b61dd807&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491763&amp;amp;idx=1&amp;amp;sn=cc60a6ba13e5cf4384e623819c621e0d&amp;amp;chksm=fc7b3f9fcb0cb6897be67103d91854831b71909c0d12385fb52b2f1d011fca5d1844b3892019&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=190#rd" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491763&amp;idx=1&amp;sn=cc60a6ba13e5cf4384e623819c621e0d&amp;chksm=fc7b3f9fcb0cb6897be67103d91854831b71909c0d12385fb52b2f1d011fca5d1844b3892019&amp;cur_album_id=1763234202604388353&amp;scene=190#rd&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>