<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kafka on ä¸€å±‚</title><link>https://emerywan.github.io/blog/tags/kafka/</link><description>Recent content in Kafka on ä¸€å±‚</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Sat, 04 Mar 2023 11:14:45 +0800</lastBuildDate><atom:link href="https://emerywan.github.io/blog/tags/kafka/index.xml" rel="self" type="application/rss+xml"/><item><title>Kafka</title><link>https://emerywan.github.io/blog/p/kafka/</link><pubDate>Sat, 04 Mar 2023 11:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/kafka/</guid><description>&lt;img src="https://emerywan.github.io/blog/p/kafka/kafka.webp" alt="Featured image of post Kafka" />&lt;blockquote>
&lt;p>Apache Kafka is an open-source distributed event streaming platform.&lt;/p>
&lt;p>Kafka æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼äº‹ä»¶æµå¹³å°ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="-åŸºæœ¬æ¦‚å¿µ">ðŸ“‘ åŸºæœ¬æ¦‚å¿µ&lt;/h2>
&lt;h3 id="ç”Ÿäº§è€…--æ¶ˆè´¹è€…">ç”Ÿäº§è€… &amp;amp; æ¶ˆè´¹è€…&lt;/h3>
&lt;p>æŠŠæ¶ˆæ¯æ”¾åˆ°é˜Ÿåˆ—é‡Œé¢çš„å«ã€Œç”Ÿäº§è€…ã€ï¼›ä»Žé˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯çš„å«ã€Œæ¶ˆè´¹è€…ã€ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/productor-consumer.png"
width="1482"
height="182"
srcset="https://emerywan.github.io/blog/blog/p/kafka/productor-consumer_hu2c5c2f226caa4e26dde9bd9923036917_30803_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/productor-consumer_hu2c5c2f226caa4e26dde9bd9923036917_30803_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="814"
data-flex-basis="1954px"
>&lt;/p>
&lt;h3 id="topic">Topic&lt;/h3>
&lt;p>Producer å°†æ¶ˆæ¯å‘é€åˆ°ç‰¹å®šçš„ä¸»é¢˜ &lt;code>Topic&lt;/code>ï¼ŒConsumer é€šè¿‡è®¢é˜…ç‰¹å®šçš„ä¸»é¢˜ &lt;code>Topic&lt;/code> æ¥æ¶ˆè´¹æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>å¹¶éžæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½æƒ³è¦å…¨éƒ¨çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…åªå¯¹è‡ªå·±æ„Ÿå…´è¶£çš„ Topic è¿›è¡Œè®¢é˜…ï¼Œä»ŽæŒ‡å®šçš„ Topic æ¥èŽ·å–æ¶ˆæ¯ã€‚
è¿™ä¸ªå‘é€é—®é¢˜ç”± ç”Ÿäº§è€… &lt;code>Product&lt;/code> æ¥è§£å†³ï¼Œç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œé€»è¾‘ä¸Šçš„åˆ†ç±»ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„ &lt;code>Topic&lt;/code>ã€‚ï¼ˆå‘å¸ƒ-è®¢é˜…æ¨¡åž‹ï¼‰&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/topic.png"
width="1702"
height="464"
srcset="https://emerywan.github.io/blog/blog/p/kafka/topic_huc74fa2ac18b398764e9e6113e92396e7_102693_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/topic_huc74fa2ac18b398764e9e6113e92396e7_102693_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="366"
data-flex-basis="880px"
>&lt;/p>
&lt;h3 id="offset">offset&lt;/h3>
&lt;p>å¤šä¸ªæ¶ˆè´¹è€…å¯èƒ½å¯¹åŒä¸€ä¸ªä¸»é¢˜æ„Ÿå…´è¶£ï¼Œå³å¤šä¸ªæ¶ˆè´¹è€… &lt;code>Consumer&lt;/code> è®¢é˜…åŒä¸€ä¸ªä¸»é¢˜ &lt;code>Topic&lt;/code>ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ¶ˆè´¹é—®é¢˜ç”± æ¶ˆè´¹è€… &lt;code>Consumer&lt;/code> æ¥è§£å†³ã€‚
Kafka å°†æ‰€æœ‰çš„æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œè®©æ¶ˆè´¹è€…å„å–æ‰€éœ€ï¼Œæƒ³å–å“ªä¸ªæ¶ˆæ¯ï¼Œæƒ³ä»€ä¹ˆæ—¶å€™å–éƒ½è¡Œï¼Œåªéœ€è¦ä¼ é€’ä¸€ä¸ªæ¶ˆæ¯çš„ &lt;code>offset&lt;/code> å³å¯ã€‚&lt;/p>
&lt;p>Kafka å°†æ¶ˆæ¯ä»¥æ¶ˆæ¯æ—¥å¿—çš„æ–¹å¼è¿½åŠ å†™åœ¨ç£ç›˜ä¸­ï¼ˆé¡ºåºç£ç›˜ IOï¼‰ã€‚&lt;/p>
&lt;p>&lt;code>offset&lt;/code> è¡¨ç¤ºäº†æ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦ã€‚æ¯ä¸€æ¡æ¶ˆæ¯éƒ½ä¼šæ ¹æ®æ—¶é—´å…ˆåŽé¡ºåºæœ‰ä¸€ä¸ªé€’å¢žçš„åºå·ï¼Œç”¨ offset æ¥è¡¨ç¤ºæ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦åˆ°å“ªäº†ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…ä¼šéƒ½æœ‰è‡ªå·±çš„ offsetã€‚&lt;/p>
&lt;p>æ¯æ¬¡æ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™ï¼Œéƒ½è¦æäº¤è¿™ä¸ª &lt;code>offset&lt;/code>ï¼ŒKafka å¯ä»¥é€‰æ‹©ã€Œè‡ªåŠ¨æäº¤ã€æˆ–è€…ã€Œæ‰‹åŠ¨æäº¤ã€ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/offset.png"
width="1702"
height="882"
srcset="https://emerywan.github.io/blog/blog/p/kafka/offset_hub631ed3146c750d7a1db077a25e92c8f_157136_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/offset_hub631ed3146c750d7a1db077a25e92c8f_157136_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="192"
data-flex-basis="463px"
>&lt;/p>
&lt;h3 id="partition">Partition&lt;/h3>
&lt;p>&lt;code>Partition&lt;/code> æ˜¯ Kafka ã€Œæœ€åŸºæœ¬çš„éƒ¨ç½²å•å…ƒã€ã€‚&lt;/p>
&lt;p>å¯¹äºŽæµ·é‡æ•°æ®ï¼Œå•æœºçš„å­˜å‚¨å®¹é‡å’Œè¯»å†™æ€§èƒ½è‚¯å®šæœ‰é™ï¼Œä¸€ç§å¸¸è§çš„å­˜å‚¨æ–¹æ¡ˆå°±æ˜¯ã€Œå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¾‹å¦‚åœ¨ MySQL ä¸­ï¼Œå•è¡¨çš„æ•°é‡è¾¾åˆ°å‡ åƒä¸‡ã€ä¸Šäº¿æ—¶ï¼Œä¼šè¿›è¡Œåˆ†åº“ã€åˆ†è¡¨æ“ä½œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¾‹å¦‚åœ¨ Redis ä¸­ï¼Œå½“å•ä¸ªå®žä¾‹çš„æ•°æ®é‡è¾¾åˆ°å‡ åGå¼•å‘æ€§èƒ½ç“¶é¢ˆæ—¶ï¼Œä¼šè¿›è¡Œåˆ†ç‰‡é›†ç¾¤&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨ Kafka ä¸­ï¼ŒåŒæ ·é‡‡å–äº†æ°´å¹³æ‹†åˆ†çš„æ–¹æ¡ˆï¼Œå°†æ‹†åˆ†åŽçš„æ•°æ®å­é›†ç§°ä¸º &lt;code>Partition&lt;/code> åˆ†åŒºã€‚å„ä¸ªåˆ†åŒºçš„æ•°æ®é›†åˆå³ä¸ºå…¨é‡æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/partition.png"
width="1902"
height="862"
srcset="https://emerywan.github.io/blog/blog/p/kafka/partition_hu6f8e653e05b83b30cced1268a2afdec4_169756_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/partition_hu6f8e653e05b83b30cced1268a2afdec4_169756_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="220"
data-flex-basis="529px"
>&lt;/p>
&lt;p>åˆ†åŒºè·¯ç”±å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºä¸€ä¸ª Hash å‡½æ•°ï¼Œç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªå‡½æ•°çš„è§„åˆ™å†³å®šå‘å¾€çš„åˆ†åŒºã€‚å°†åˆ†åŒºè§„åˆ™è®¾è®¡çš„åˆç†ï¼Œå¯ä»¥å°†æ¶ˆæ¯å‡åŒ€åœ°åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºä¸Šã€‚&lt;/p>
&lt;p>ç”Ÿäº§è€… &lt;code>Productor&lt;/code> å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå…ˆé€šè¿‡ &lt;code>Topic&lt;/code> å¯¹æ¶ˆæ¯è¿›è¡Œé€»è¾‘åˆ†ç±»ï¼Œåœ¨é€šè¿‡ &lt;code>Partition&lt;/code> è¿›ä¸€æ­¥åšç‰©ç†åˆ†ç‰‡ï¼Œæœ€ç»ˆå¤šä¸ª Partition ä¼šå‡åŒ€åœ°åˆ†å¸ƒåœ¨é›†ç¾¤çš„æ¯å°æœºå™¨ä¸Šï¼Œä»Žè€Œå¾ˆå¥½åœ°è§£å†³äº†å­˜å‚¨æ‰©å±•æ€§é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="broker">Broker&lt;/h3>
&lt;p>ä¸€å° Kafka æœåŠ¡å™¨è¢«ç§°ä¸º &lt;code>Broker&lt;/code>ï¼ŒKafka é›†ç¾¤ç”±å¤šå° Kafka æœåŠ¡å™¨ç»„æˆã€‚&lt;/p>
&lt;p>Kafka æ˜¯ã€Œå¤©ç„¶åˆ†å¸ƒå¼ã€çš„ã€‚&lt;/p>
&lt;p>ä¸€ä¸ª &lt;code>Topic&lt;/code> ä¼šè¢«åˆ†ä¸ºå¤šä¸ª &lt;code>Partition&lt;/code>ï¼Œè¿™äº› Partition ä¼šåˆ†å¸ƒåœ¨ä¸åŒçš„ &lt;code>Broker&lt;/code> ä¸­ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/broker.png"
width="2744"
height="1204"
srcset="https://emerywan.github.io/blog/blog/p/kafka/broker_huddafab0296be063dc2cfa60773db7d44_193217_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/broker_huddafab0296be063dc2cfa60773db7d44_193217_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="227"
data-flex-basis="546px"
>&lt;/p>
&lt;h3 id="leader--follower">leader &amp;amp; follower&lt;/h3>
&lt;p>åœ¨ Kafka é›†ç¾¤ä¸­ï¼Œæ¯å°æœºå™¨éƒ½ä¼šå­˜å‚¨ä¸€äº› Partitionï¼Œä¸ºäº†é˜²æ­¢æœºå™¨å®•æœºæ—¶ï¼Œè¿™éƒ¨åˆ†æ•°æ®æ— æ³•è®¿é—®çš„é—®é¢˜ï¼ˆæŒä¹…åŒ–ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼‰ã€‚
éœ€è¦ Kafka å…·å¤‡æ•…éšœè½¬ç§»èƒ½åŠ›ï¼Œå½“æŸå°æœºå™¨å®•æœºåŽï¼Œèƒ½å¤Ÿç»§ç»­ä¿è¯æœåŠ¡å¯ç”¨ã€‚&lt;/p>
&lt;p>ä¸Ž Reids Cluster ç±»ä¼¼ï¼ŒKafka é€šè¿‡ã€ŒPartition å¤šå‰¯æœ¬ã€çš„æ–¹å¼ï¼Œè§£å†³äº†é«˜å¯ç”¨é—®é¢˜ã€‚
åœ¨ Kafka é›†ç¾¤ä¸­ï¼Œæ¯ä¸ª Partition éƒ½æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œä¿å­˜äº†ç›¸åŒçš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å‰¯æœ¬ä¹‹é—´æ˜¯ ã€Œä¸€ä¸»å¤šä»Žã€çš„å…³ç³»ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>leader&lt;/code> å‰¯æœ¬è´Ÿè´£è¯»å†™æ•°æ®&lt;/li>
&lt;li>&lt;code>follower&lt;/code> å‰¯æœ¬è´Ÿè´£åŒæ­¥æ¶ˆæ¯ï¼Œåªè´Ÿè´£å¾…å‘½&lt;/li>
&lt;/ul>
&lt;p>å½“ leader å‰¯æœ¬å‘é€æ•…éšœæ—¶ï¼Œé€‰ä¸¾ follower å‰¯æœ¬æˆä¸ºæ–°çš„ leader å¯¹å¤–æä¾›æœåŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/leader_follwer.png"
width="1642"
height="982"
srcset="https://emerywan.github.io/blog/blog/p/kafka/leader_follwer_hud0b2c7f759aaa7a9577276a758bf8076_131159_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/leader_follwer_hud0b2c7f759aaa7a9577276a758bf8076_131159_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="167"
data-flex-basis="401px"
>&lt;/p>
&lt;h3 id="æ¶ˆè´¹è€…ç»„">æ¶ˆè´¹è€…ç»„&lt;/h3>
&lt;p>Kafka æ˜¯ä¸ªé«˜å¹¶å‘çš„ç³»ç»Ÿï¼Œæ¶ˆæ¯çš„æ‹‰å–åŒæ ·æ˜¯å¹¶è¡Œçš„ï¼Œå¤šä¸ªæ¶ˆè´¹è€…åŽ»æ¶ˆè´¹ Topic æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>Kafka å¼•å…¥äº†æ¶ˆè´¹è€…ç»„çš„æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ¶ˆè´¹è€…ç»„ã€‚ç»„é—´è¿›è¡Œå¹¿æ’­æ¶ˆè´¹ï¼Œç»„å†…è¿›è¡Œé›†ç¾¤æ¶ˆè´¹ã€‚åŒæ—¶é™å®šï¼šã€Œæ¯ä¸ª Partition åªèƒ½ç”±æ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/consumer_group.png"
width="1952"
height="1378"
srcset="https://emerywan.github.io/blog/blog/p/kafka/consumer_group_hu7674cf08adee570cc4acecde56b2e047_315635_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/consumer_group_hu7674cf08adee570cc4acecde56b2e047_315635_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>å½“éœ€è¦åŠ å¿«æ¶ˆæ¯çš„å¤„ç†é€Ÿåº¦ï¼Œï¼ˆå¦‚æ¶ˆè´¹è€…ç»„Bï¼‰åªéœ€è¦å¢žåŠ æ–°çš„æ¶ˆè´¹è€…å³å¯ï¼ŒKafka ä¼šä»¥ Patition ä¸ºå•ä½é‡æ–°åšè´Ÿè½½å‡è¡¡ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥æ¶ˆè´¹ Topic çš„å…¨éƒ¨æ•°æ®ï¼Œæ¶ˆè´¹è€…ç»„åœ¨é€»è¾‘ä¸Šæ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚&lt;/p>
&lt;h2 id="-å­˜å‚¨ç»“æž„">ðŸ—³ï¸ å­˜å‚¨ç»“æž„&lt;/h2>
&lt;p>Kafka ä½¿ç”¨ã€Œæ—¥å¿—æ–‡ä»¶ Loggingã€çš„æ–¹å¼æ¥å­˜å‚¨æ¶ˆæ¯ï¼›ä½¿ç”¨ã€Œç¨€ç–å“ˆå¸Œç´¢å¼•ã€æ¥åŠ å¿«æŸ¥è¯¢ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Kafka å­˜å‚¨çš„ä¸»è¦æ˜¯æ¶ˆæ¯æµï¼ˆæ–‡æœ¬ã€è‡ªå®šä¹‰æ ¼å¼ï¼‰ï¼Œå¯¹äºŽ Broker æ¥è¯´ï¼Œåªéœ€è¦å…³æ³¨æ¶ˆæ¯çš„æŠ•é€’ï¼Œæ— éœ€å…³æ³¨å†…å®¹æœ¬èº«&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å†™å…¥æ–¹é¢ï¼Œæ•°æ®é‡çº§éžå¸¸å¤§ï¼Œéƒ½æ˜¯æŒ‰é¡ºåºå†™å…¥ï¼ˆé˜Ÿåˆ—ï¼‰ï¼Œä¸”æ— éœ€è€ƒè™‘æ›´æ–°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éœ€æ±‚ç®€å•ï¼Œåªéœ€è¦æŒ‰ç…§ offset æŸ¥è¯¢æ¶ˆæ¯å³å¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä¸ºäº†æ»¡è¶³å…¶å†™å…¥éœ€æ±‚ï¼ˆé‡çº§å¤§ã€ä¸æ›´æ–°ï¼‰ï¼Œé‡‡ç”¨ Append è¿½åŠ æ—¥å¿—çš„æ–¹å¼æœ€ç†æƒ³ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨ã€Œç£ç›˜é¡ºåº IOã€ã€‚&lt;/p>
&lt;p>åœ¨æŸ¥è¯¢æ—¶ï¼Œåªéœ€è¦é€šè¿‡ offset å®šä½æ¶ˆæ¯ï¼Œåœ¨å†…å­˜ä¸­ç»´æŠ¤äº†ä¸€ä¸ªã€Œä»Ž offset åˆ°æ—¥å¿—æ–‡ä»¶çš„åç§»é‡ã€çš„æ˜ å°„å…³ç³»ï¼Œæ¯æ¬¡
æŸ¥è¯¢æ—¶ï¼Œå…ˆæ ¹æ® offset æ‰¾åˆ°æ—¥å¿—æ–‡ä»¶çš„åç§»é‡ï¼Œå³å¯å¿«é€Ÿè¯»å–åˆ°æ—¥å¿—æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å…å“ˆå¸Œç´¢å¼•å¸¸é©»å†…å­˜æ¶ˆè€—è¿‡å¤šç©ºé—´çš„é—®é¢˜ï¼Œå°†æ¶ˆæ¯åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå— blockï¼Œæ¯ä¸ªç´¢å¼•éœ€è¦å®šä½ block å—ä¸­çš„ç¬¬ä¸€æ¡æ¶ˆæ¯çš„ offset å³å¯ï¼ˆç¨€ç–ç´¢å¼•ï¼‰ï¼Œ
ç„¶åŽåœ¨ block ä¸­é¡ºåºæŸ¥æ‰¾ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/hash.png"
width="702"
height="486"
srcset="https://emerywan.github.io/blog/blog/p/kafka/hash_hu74f0171d0dcbf8a19203c6a91442ff0f_91411_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/hash_hu74f0171d0dcbf8a19203c6a91442ff0f_91411_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="144"
data-flex-basis="346px"
>&lt;/p>
&lt;h2 id="-kafka-çš„é«˜æ€§èƒ½">ðŸ”¥ Kafka çš„é«˜æ€§èƒ½&lt;/h2>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/kafka/performance.png"
width="725"
height="662"
srcset="https://emerywan.github.io/blog/blog/p/kafka/performance_hu3423f3489c82f749f8bb253d443fb73a_35239_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/kafka/performance_hu3423f3489c82f749f8bb253d443fb73a_35239_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="109"
data-flex-basis="262px"
>&lt;/p>
&lt;h3 id="-ç”Ÿäº§æ¶ˆæ¯">ðŸ“‘ ç”Ÿäº§æ¶ˆæ¯&lt;/h3>
&lt;p>Kafka å®¢æˆ·ç«¯ä¸Žä¼ ç»Ÿçš„æ•°æ®åº“æˆ–æ¶ˆæ¯ä¸­é—´ä»¶ä¸åŒï¼Œåœ¨å°†æ¶ˆæ¯å‘é€ç»™ Broker ä¹‹å‰ï¼Œåœ¨ Client ç«¯å…ˆå®Œæˆå¤§é‡çš„å·¥ä½œä¹‹åŽæ‰å‘é€æ¶ˆæ¯ï¼Œåˆ†æ‘Š Broker çš„è®¡ç®—åŽ‹åŠ›ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ«§ æ‰¹é‡å‘é€&lt;/p>
&lt;p>Kafka é€šè¿‡å¯¹å¤šæ¡æ¶ˆæ¯æŒ‰ç…§åˆ†åŒºè¿›è¡Œåˆ†ç»„ï¼Œæ¯æ¬¡å‘é€ä¸€ä¸ªæ¶ˆæ¯é›†åˆï¼Œä»Žè€Œå‡å°‘ç½‘ç»œä¼ è¾“çš„å¼€é”€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ æ¶ˆæ¯åŽ‹ç¼©&lt;/p>
&lt;p>åœ¨æ‰¹é‡å‘é€çš„å‰æä¸‹ï¼Œå¯¹æ¶ˆæ¯è¿›è¡ŒåŽ‹ç¼©ï¼ˆæ•°æ®é‡è¶Šå¤§ï¼ŒåŽ‹ç¼©æ•ˆæžœæ›´å¥½ï¼‰ã€‚åŒæ—¶å¯¹å¤šæ¡æ¶ˆæ¯è¿›è¡ŒåŽ‹ç¼©ï¼Œèƒ½å¤§å¹…å‡å°‘æ•°æ®é‡ï¼Œ
åŒæ—¶å‡å°‘ç½‘ç»œã€ç£ç›˜IOå¼€é”€ã€‚æ¶ˆæ¯æŒä¹…åŒ–åˆ° Broker çš„ç£ç›˜æ—¶ï¼Œä¾æ—§æ˜¯åŽ‹ç¼©çŠ¶æ€ï¼Œæœ€ç»ˆæ˜¯åœ¨ Consumer ç«¯è¿›è¡Œè§£åŽ‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ é«˜æ•ˆåºåˆ—åŒ–&lt;/p>
&lt;p>Kafka çš„ Key å’Œ Valueï¼Œéƒ½æ”¯æŒè‡ªå®šä¹‰ç±»åž‹ï¼Œåªéœ€è¦æä¾›ç›¸åº”çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨å³å¯ã€‚å¯ä»¥æ ¹æ®æƒ…å†µé€‰å–å¯¹åº”çš„åºåˆ—åŒ–æ–¹å¼ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ å†…å­˜æ± å¤ç”¨&lt;/p>
&lt;p>Kafka æå‡ºäº†ã€Œå†…å­˜æ± æœºåˆ¶ã€ï¼Œæé«˜å¤ç”¨ï¼Œå‡å°‘é¢‘ç¹çš„åˆ›å»ºå’Œå›žæ”¶ã€‚ï¼ˆæœ¬è´¨ä¸Šä¸Žè¿žæŽ¥æ± ã€çº¿ç¨‹æ± ä¸€æ ·ï¼‰ã€‚&lt;/p>
&lt;p>Productor åœ¨åˆ›å»ºæ—¶ï¼Œä¼šå ç”¨ä¸€å—å›ºå®šå¤§å°çš„å†…å­˜åŒºåŸŸï¼Œåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå—ï¼ˆä¾‹å¦‚ 16KBï¼‰ã€‚å½“éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å‘é€ Batch æ—¶ï¼Œç›´æŽ¥ä»Žå†…å­˜ä¸­å–å‡ºä¸€ä¸ªå—ï¼Œ
ä»Žä¸­ä¸æ–­åœ°å†™å…¥æ¶ˆæ¯ï¼ˆå†™æ»¡æˆ–åˆ°æŒ‡å®šé˜ˆå€¼æ—¶é—´æ—¶ï¼‰ï¼Œå°†è¿™ä¸ª Batch å‘é€ç»™ Brokerï¼Œä¹‹åŽå†…å­˜å—å°±ä¼šå›žåˆ°ç¼“å­˜æ± ä¸­ç»§ç»­å¤ç”¨ã€‚
ä¸ä¼šæ¶‰åŠ JVM çš„å†…å­˜å›žæ”¶ï¼Œä»¥åº”å¯¹ Kafka çš„é«˜å¹¶å‘åœºæ™¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-å­˜å‚¨æ¶ˆæ¯">ðŸ“‡ å­˜å‚¨æ¶ˆæ¯&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ«§ IO å¤šè·¯å¤ç”¨&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>1&lt;/code> ä¸ª &lt;code>Acceptor&lt;/code> çº¿ç¨‹ï¼Œå¤„ç†æ–°çš„è¿žæŽ¥ï¼›ä½¿ç”¨ &lt;code>N&lt;/code> ä¸ª &lt;code>Processor&lt;/code> çº¿ç¨‹ï¼Œè¯»å–è¯·æ±‚ï¼›ä½¿ç”¨ &lt;code>M&lt;/code> ä¸ª &lt;code>Handler&lt;/code> çº¿ç¨‹ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p>
&lt;p>ä¸Ž Redis ç›¸åŒï¼ŒIO å¤šè·¯å¤ç”¨å…è®¸å†…æ ¸ä¸­åŒæ—¶ç®¡ç†å¤šä¸ª scoket è¿žæŽ¥ï¼Œå†…æ ¸ä¼šä¸€ç›´ç›‘å¬è¿™äº›è¿žæŽ¥ï¼Œä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šé€šçŸ¥å¤„ç†çº¿ç¨‹ï¼Œè¾¾åˆ°ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¯·æ±‚çš„æ•ˆæžœã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ ç£ç›˜é¡ºåº IO&lt;/p>
&lt;p>Kafka é‡‡ç”¨æ—¥å¿—æ–‡ä»¶çš„æ–¹å¼æŒä¹…åŒ–æ—¥å¿—ï¼Œä»¥ Append Only çš„æ–¹å¼è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼Œé¡ºåº IO ä½¿å†™å…¥é€Ÿåº¦éžå¸¸å¿«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ Page Cache&lt;/p>
&lt;p>åˆ©ç”¨äº†æ“ä½œç³»ç»Ÿæœ¬èº«çš„ç¼“å­˜æŠ€æœ¯ï¼Œåœ¨è¯»å†™ç£ç›˜æ–‡ä»¶æ—¶ï¼Œå…¶å®žæ“ä½œçš„éƒ½æ˜¯å†…å­˜ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™å°† Page Cache ä¸­çš„æ•°æ®çœŸæ­£åˆ·å…¥ç£ç›˜ã€‚&lt;/p>
&lt;p>Page Cache ç¼“å­˜ä¸­ä¿å­˜çš„æ˜¯æœ€è¿‘å¯èƒ½è¢«ä½¿ç”¨çš„ç£ç›˜æ•°æ®ï¼Œå…·æœ‰æ—¶é—´å±€éƒ¨æ€§ï¼ˆæœ€è¿‘è®¿é—®çš„æ•°æ®å¯èƒ½å†æ¬¡è®¿é—®ï¼‰å’Œ ç©ºé—´å±€éƒ¨æ€§ï¼ˆè®¿é—®çš„æ•°æ®çš„å‘¨è¾¹æ•°æ®è¢«è®¿é—®çš„æ¦‚çŽ‡æžé«˜ï¼‰ã€‚
ä½œä¸ºé¡ºåºå†™å…¥çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æžœç”Ÿäº§å’Œæ¶ˆè´¹åœ°ç‰¹åˆ«å¿«ï¼Œåˆ©ç”¨ Broker Page Cacheï¼Œç”šè‡³å¯ä»¥ä¸ç»è¿‡ç£ç›˜å®Œæˆæ“ä½œã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ åˆ†åŒºåˆ†æ®µç»“æž„&lt;/p>
&lt;p>Kafka çš„ Topic ä¼šè¢«åˆ†åŒºä¸ºå¤šä¸ª Partitionï¼Œåœ¨å¤šå° Broker ä¸­ï¼Œä½¿ç”¨å¤šä¸ªæœåŠ¡æ¥æŽ¥å—æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>åŒæ—¶æ¯ä¸ªåˆ†åŒº Partition ä¼šè¢«åˆ†ä¸ºå¤šä¸ªæ®µ Segment æ¥ç®¡ç†ï¼Œæ¯ä¸ªæ®µå†…éƒ½æ˜¯é¡ºåºå†™ï¼Œé¿å…åˆ†åŒºè¿‡å¤§ï¼Œåˆ©äºŽç®¡ç†ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¶ˆè´¹æ¶ˆæ¯">ðŸ“® æ¶ˆè´¹æ¶ˆæ¯&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ«§ ç¨€ç–ç´¢å¼•&lt;/p>
&lt;p>Kafka æŸ¥è¯¢åœºæ™¯éžå¸¸ç®€å•ï¼ŒæŒ‰ç…§ offset æŸ¥è¯¢æ¶ˆæ¯å³å¯ã€‚ä¸ºäº†åŠ å¿«è¯»æ“ä½œï¼Œåªéœ€è¦åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ª offset åˆ°æ—¥å¿—æ–‡ä»¶çš„åç§»é‡çš„æ˜ å°„å…³ç³» &lt;code>Map&lt;/code> å³å¯ã€‚
æ¯æ¬¡æŸ¥æ‰¾æ¶ˆæ¯ï¼Œå…ˆä»Žå“ˆå¸Œè¡¨ä¸­æŸ¥åˆ°æ–‡ä»¶åç§»é‡ï¼Œå†åŽ»è¯»æ—¥å¿—æ–‡ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ mmap&lt;/p>
&lt;p>memory mapped files&lt;/p>
&lt;p>é‡‡ç”¨ mmap æ˜ å°„ç´¢å¼•æ–‡ä»¶ï¼ŒåŠ å¿«ç´¢å¼•çš„æŸ¥æ‰¾è¿‡ç¨‹ã€‚å°†ç£ç›˜æ–‡ä»¶ä¸Žå†…å­˜è™šæ‹Ÿåœ°å€åšäº†æ˜ å°„ï¼Œä¸éœ€è¦æ“ä½œç£ç›˜IOï¼Œè¿›ç¨‹å¯ä»¥ä½¿ç”¨æŒ‡é’ˆçš„æ–¹å¼æ“ä½œè¿™ä¸€å—å†…å­˜ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†è„é¡µå†™å…¥åˆ°å¯¹åº”çš„ç£ç›˜æ–‡ä»¶ä¸Šã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ é›¶æ‹·è´&lt;/p>
&lt;p>é‡‡ç”¨äº†é›¶æ‹·è´ï¼Œå°†æ•°æ®ä»Žå†…å­˜ä¸­çš„ç¼“å­˜åŒºç›´æŽ¥æ‹·è´åˆ°ç½‘å¡è®¾å¤‡ï¼Œæ— éœ€ç»è¿‡åº”ç”¨ç¨‹åºï¼Œå‡å°‘äº†æ•°æ®çš„æ‹·è´å’Œå†…æ ¸æ€ä¸Žç”¨æˆ·æ€çš„åˆ‡æ¢ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ æ‰¹é‡æ‹‰å–&lt;/p>
&lt;p>ä¸Žå‘é€æ¶ˆæ¯å¯¹åº”ï¼Œæ¶ˆè´¹æ¶ˆæ¯ä¹Ÿæ˜¯æ‰¹é‡æ‹‰å–çš„ï¼Œæ¯æ¬¡æ‹‰å–ä¸€ä¸ªæ¶ˆæ¯é›†åˆï¼Œå‡å°‘ç½‘ç»œçš„å¼€é”€ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247490102&amp;amp;idx=1&amp;amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;amp;scene=21#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247490102&amp;idx=1&amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;scene=21#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247490102&amp;amp;idx=1&amp;amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247490102&amp;idx=1&amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491055&amp;amp;idx=1&amp;amp;sn=14bc485f91ec2629cc9e8bf7a36ad8f4&amp;amp;chksm=fc78c2c3cb0f4bd566d5ca2534805839420ad3dc67210bc8f2b7ef05283785b02b8ddef640a8&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491055&amp;idx=1&amp;sn=14bc485f91ec2629cc9e8bf7a36ad8f4&amp;chksm=fc78c2c3cb0f4bd566d5ca2534805839420ad3dc67210bc8f2b7ef05283785b02b8ddef640a8&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491168&amp;amp;idx=1&amp;amp;sn=bd37f96692b3f7cecdaf3172abdb7a8c&amp;amp;chksm=fc78c14ccb0f485a451f70c7ffbf5b05d0f500dfef6321703e7cdebdc0de902d9d77a547d469&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491168&amp;idx=1&amp;sn=bd37f96692b3f7cecdaf3172abdb7a8c&amp;chksm=fc78c14ccb0f485a451f70c7ffbf5b05d0f500dfef6321703e7cdebdc0de902d9d77a547d469&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491507&amp;amp;idx=1&amp;amp;sn=f1bec356c94cd0101809dc11dcf27ba2&amp;amp;chksm=fc78c09fcb0f49898f6cc9b80499aeb871a80f95ab4fbe12c32567cab6a3521a6c33b61dd807&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491507&amp;idx=1&amp;sn=f1bec356c94cd0101809dc11dcf27ba2&amp;chksm=fc78c09fcb0f49898f6cc9b80499aeb871a80f95ab4fbe12c32567cab6a3521a6c33b61dd807&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491763&amp;amp;idx=1&amp;amp;sn=cc60a6ba13e5cf4384e623819c621e0d&amp;amp;chksm=fc7b3f9fcb0cb6897be67103d91854831b71909c0d12385fb52b2f1d011fca5d1844b3892019&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=190#rd" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491763&amp;idx=1&amp;sn=cc60a6ba13e5cf4384e623819c621e0d&amp;chksm=fc7b3f9fcb0cb6897be67103d91854831b71909c0d12385fb52b2f1d011fca5d1844b3892019&amp;cur_album_id=1763234202604388353&amp;scene=190#rd&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>