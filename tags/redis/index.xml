<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Redis on ä¸€å±‚</title><link>https://blog.letout.cn/tags/redis/</link><description>Recent content in Redis on ä¸€å±‚</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 01 Mar 2023 18:52:45 +0800</lastBuildDate><atom:link href="https://blog.letout.cn/tags/redis/index.xml" rel="self" type="application/rss+xml"/><item><title>Redis å¤åˆ¶</title><link>https://blog.letout.cn/p/redis/replication/</link><pubDate>Wed, 01 Mar 2023 18:52:45 +0800</pubDate><guid>https://blog.letout.cn/p/redis/replication/</guid><description>&lt;img src="https://blog.letout.cn/p/redis/replication/replication.png" alt="Featured image of post Redis å¤åˆ¶" />&lt;h2 id="å»ºç«‹å¤åˆ¶">å»ºç«‹å¤åˆ¶&lt;/h2>
&lt;p>å‚ä¸å¤åˆ¶çš„ Redis å®ä¾‹åˆ’åˆ†ä¸ºï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸»èŠ‚ç‚¹ &lt;code>master&lt;/code>&lt;/li>
&lt;li>ä»èŠ‚ç‚¹ &lt;code>slave&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹ï¼Œæ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ &lt;code>master -&amp;gt; slave&lt;/code>ã€‚&lt;/p>
&lt;p>é€šè¿‡ä¸»ä»å¤åˆ¶ï¼Œå¯ä»¥å®ç°ã€Œè¯»å†™åˆ†ç¦»ã€ï¼Œä¸»æœåŠ¡å™¨è´Ÿè´£ã€Œå†™ã€æ“ä½œï¼Œä»æœåŠ¡å™¨è´Ÿè´£ã€Œè¯»ã€æ“ä½œã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼Œä»èŠ‚ç‚¹ä¹Ÿå¯ä»¥ä½œä¸ºä¸»èŠ‚ç‚¹çš„å¤‡ä»½ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/replication/read-write.png"
width="902"
height="422"
srcset="https://blog.letout.cn/p/redis/replication/read-write_huc9c3964624999041f81d0c7b2328e956_42565_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/replication/read-write_huc9c3964624999041f81d0c7b2328e956_42565_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="213"
data-flex-basis="512px"
>&lt;/p>
&lt;p>åœ¨ä»æœåŠ¡å™¨ä¸­ï¼Œä½¿ç”¨ &lt;code>slaveof&lt;/code> / &lt;code>replicaof&lt;/code> å‘½ä»¤/é…ç½®ï¼Œå»ºç«‹ä¸»ä»æœåŠ¡å…³ç³»ï¼Œä»èŠ‚ç‚¹åªä¼šä¿å­˜ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå…¶ä½™çš„å¤åˆ¶æµç¨‹åœ¨èŠ‚ç‚¹å†…éƒ¨å¼‚æ­¥è¿›è¡Œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é…ç½®æ–‡ä»¶ä¸­è®¾ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">slaveof &lt;span class="o">{&lt;/span>masterHost&lt;span class="o">}&lt;/span> &lt;span class="o">{&lt;/span>masterPort&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯åŠ¨ä»æœåŠ¡æ—¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-server --slaveof &lt;span class="o">{&lt;/span>masterHost&lt;span class="o">}&lt;/span> &lt;span class="o">{&lt;/span>masterPort&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»æœåŠ¡ä¸­ä½¿ç”¨å‘½ä»¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">slaveof &lt;span class="o">{&lt;/span>masterHost&lt;span class="o">}&lt;/span> &lt;span class="o">{&lt;/span>masterPort&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åŒæ­¥åŸç†">åŒæ­¥åŸç†&lt;/h3>
&lt;p>Redis ä½¿ç”¨ &lt;code>psync&lt;/code> å®Œæˆä¸»ä»æ•°æ®çš„åŒæ­¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># runID ä¿å­˜çš„ä¸»æœåŠ¡å™¨çš„ id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># offset åç§»é‡ï¼Œç¬¬ä¸€æ¬¡åŒæ­¥ä¸º -1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">psync &lt;span class="o">{&lt;/span>runID&lt;span class="o">}&lt;/span> &lt;span class="o">{&lt;/span>offset&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>ğŸ‘£ ä¸»æœåŠ¡å™¨ä¼šæ‰§è¡Œ &lt;code>bgsave&lt;/code> å‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œç„¶åæŠŠæ–‡ä»¶å‘é€ç»™ä»æœåŠ¡å™¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ‘£ ä»æœåŠ¡å™¨æ”¶åˆ° RDB æ–‡ä»¶åï¼Œä¼šå…ˆã€Œæ¸…ç©ºå½“å‰çš„æ•°æ®ã€ï¼Œç„¶åè½½å…¥ RDB æ–‡ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ‘£ ä¸»æœåŠ¡å™¨ä¾ç„¶å¯ä»¥æ­£å¸¸å¤„ç†å‘½ä»¤ï¼ˆforkå­è¿›ç¨‹ï¼ŒCOWï¼‰ï¼Œåœ¨å¤åˆ¶æœŸé—´ä¸ºäº†ä¿éšœæ•°æ®çš„ä¸€è‡´æ€§ï¼Œå†™å‘½ä»¤ä¼šè¢«åŒæ—¶è®°å½•åœ¨ ã€Œå¤åˆ¶å®¢æˆ·ç¼“å†²åŒºã€&lt;code>replication buffer&lt;/code> ä¸­ï¼Œä»æœåŠ¡å™¨åŠ è½½å®Œ RDB åï¼Œä¼šè¿è¡Œç¼“å­˜åŒºä¸­è®°å½•çš„å‘½ä»¤ï¼Œä¿éšœæ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="éƒ¨åˆ†å¤åˆ¶">éƒ¨åˆ†å¤åˆ¶&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸ“ƒ å¤åˆ¶åç§»é‡ offset&lt;/p>
&lt;p>å‚ä¸ä¸»ä»çš„èŠ‚ç‚¹éƒ½ä¼šç»´æŠ¤è‡ªèº«çš„å¤åˆ¶åç§»é‡ï¼Œå¤„ç†å®Œã€Œå†™å‘½ä»¤ã€åï¼Œéƒ½ä¼šç´¯è®¡å‘½ä»¤çš„å­—èŠ‚é•¿åº¦ã€‚&lt;/p>
&lt;p>ä»èŠ‚ç‚¹ä¼šæ²¡ç§’ä¸­ä¸ŠæŠ¥è‡ªèº«çš„å¤åˆ¶åç§»é‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>â™’ å¤åˆ¶ç§¯å‹ç¼“å†²åŒº&lt;/p>
&lt;p>replication backlog buffer&lt;/p>
&lt;p>æœ¬è´¨ä¸Šä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„å®šé•¿é˜Ÿåˆ—ï¼ˆé»˜è®¤ä¸¤ä¸ªï¼Œ2 * 1Mï¼‰ï¼Œä¸ MySQL redolog ä¸€æ ·æ˜¯å¾ªç¯å†™å…¥ï¼Œæ–°æ•°æ®ä¼šè¦†ç›–æ—§æ•°æ®ã€‚
ä¸»èŠ‚ç‚¹å“åº”å†™å‘½ä»¤æ—¶ï¼Œå†å‘é€å‘½ä»¤åˆ°ä»èŠ‚ç‚¹æ—¶ï¼ŒåŒæ—¶ä¼šå°†æ•°æ®å†™å…¥å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œç”¨äºéƒ¨åˆ†å¤åˆ¶å‘½ä»¤ä¸¢å¤±æ˜¯çš„æ•°æ®è¡¥æ•‘ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¸»ä»æœåŠ¡å™¨åœ¨å®Œæˆç¬¬ä¸€æ¬¡å…¨é‡å¤åˆ¶ä¹‹åï¼Œä¼šé€šè¿‡é•¿è¿æ¥è¿›è¡Œå‘½ä»¤ä¼ æ’­ã€‚&lt;/p>
&lt;p>ç½‘ç»œæ˜¯ä¸ç¨³å®šçš„ï¼Œä»æœåŠ¡å™¨å¯èƒ½ä¼šæœ‰çŸ­æš‚çš„æ–­å¼€ï¼Œå½“é‡æ–°å»ºç«‹è¿æ¥ä¹‹åï¼Œå¯ä»¥æ ¹æ®æƒ…å†µä½¿ç”¨å¢é‡å¤åˆ¶æ¥åŒæ­¥æ•°æ®ã€‚&lt;/p>
&lt;p>å¢é‡å¤åˆ¶åŒæ ·é‡‡ç”¨äº† &lt;code>psync&lt;/code> æ¥åŒæ­¥ï¼Œé€šè¿‡ offset æ¥å‘ŠçŸ¥ä¸»æœåŠ¡å™¨å½“å‰çš„æ•°æ®çš„åç§»æƒ…å†µã€‚&lt;/p>
&lt;p>å½“ä»æœåŠ¡å™¨çš„åç§»é‡åœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸­æ‰¾åˆ°ï¼Œä¼šè¿›è¡Œéƒ¨åˆ†å¤åˆ¶ï¼›å½“åç§»æ•°æ®è¿‡å¤§ï¼Œå·²è¢«è¦†ç›–æ— æ³•æ‰¾åˆ°æ—¶ï¼Œä¼šé€€åŒ–ä¸ºå…¨é‡å¤åˆ¶ã€‚&lt;/p>
&lt;h3 id="-ä¿æŒè¿æ¥">ğŸ’“ ä¿æŒè¿æ¥&lt;/h3>
&lt;p>ä¸»ä»èŠ‚ç‚¹é—´æœ‰å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸»èŠ‚ç‚¹æ¯ 10s å‘ä»èŠ‚ç‚¹å‘é€ &lt;code>ping&lt;/code> å‘½ä»¤ï¼Œåˆ¤æ–­ä»èŠ‚ç‚¹çš„è¿æ¥çŠ¶æ€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»èŠ‚ç‚¹æ¯ 1s ä¸ŠæŠ¥è‡ªèº« offset æƒ…å†µ&lt;/p>
&lt;ul>
&lt;li>å®æ—¶ç›‘æ§ä»èŠ‚ç‚¹ç½‘ç»œçŠ¶æ€ï¼Œå»¶è¿Ÿæ€§&lt;/li>
&lt;li>åˆ¤æ–­æ•°æ®æ˜¯å¦ä¸¢å¤±&lt;/li>
&lt;li>ä¿éšœä»èŠ‚ç‚¹çš„è¿æ¥æ•°é‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-è¯»å†™åˆ†ç¦»é—®é¢˜">ğŸ“š è¯»å†™åˆ†ç¦»é—®é¢˜&lt;/h2>
&lt;h3 id="-æ•°æ®å»¶è¿Ÿ">ğŸ° æ•°æ®å»¶è¿Ÿ&lt;/h3>
&lt;p>Redis ç”±äºå¼‚æ­¥å¤åˆ¶çš„ç‰¹æ€§ï¼Œå»¶è¿Ÿæ˜¯æ— æ³•é¿å…çš„ï¼Œå–å†³äºå½“å‰çš„ç½‘ç»œæƒ…å†µå’Œå‘½ä»¤é˜»å¡æƒ…å†µã€‚&lt;/p>
&lt;p>é€‚åˆäºä¸šåŠ¡åœºæ™¯å¯¹å»¶è¿Ÿä¸æ•æ„Ÿçš„åœºæ™¯ã€‚æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯è€Œå®šï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Redis é›†ç¾¤åšæ°´å¹³æ‰©å±•çš„æ–¹æ¡ˆã€‚&lt;/p>
&lt;h3 id="-è¿‡æœŸæ•°æ®">ğŸ—‘ï¸ è¿‡æœŸæ•°æ®&lt;/h3>
&lt;p>åœ¨ Redis ä¸­ï¼Œæœ‰ï¼ˆ1ï¼‰å®šæœŸåˆ é™¤ï¼›ï¼ˆ2ï¼‰æƒ°æ€§åˆ é™¤ï¼›ä¸¤ç§åˆ é™¤æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>åœ¨ä»æœåŠ¡å™¨ä¸­ï¼Œä¸ä¼šæ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œä¸»æœåŠ¡å™¨ä¸­æ‰¾åˆ°è¿‡æœŸæ•°æ®ï¼Œä¼šåŒæ­¥ä¸€æ¡ &lt;code>DEL&lt;/code> å‘½ä»¤åˆ°ä»æœåŠ¡å™¨ä¸­ï¼Œåˆ é™¤è¿‡æœŸæ•°æ®ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åœ¨ Redis 3.2-ï¼Œä¼šç›´æ¥è¿”å›è¿‡æœŸæ•°æ®ï¼Œä¸ä¼šè¿›è¡Œæ£€æŸ¥&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ Redis 3.2+ï¼Œåœ¨è¿”å›æ•°æ®å‰ï¼Œä¼šæ£€æŸ¥è¿‡æœŸæ—¶é—´ï¼Œè§£å†³äº†ä»æœåŠ¡å™¨è¯»å–åˆ°è¿‡æœŸæ•°æ®çš„é—®é¢˜&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-èŠ‚ç‚¹æ•…éšœ">ğŸŒ€ èŠ‚ç‚¹æ•…éšœ&lt;/h3>
&lt;p>å½“ä¸»èŠ‚ç‚¹å®•æœºåï¼Œä»èŠ‚ç‚¹æ˜¯æ— æ³•è‡ªåŠ¨å‡çº§ä¸ºä¸»èŠ‚ç‚¹çš„ï¼Œéœ€è¦äººå·¥å¹²é¢„ã€‚&lt;/p>
&lt;p>è€ƒè™‘ä½¿ç”¨ Redis å“¨å…µæ¨¡å¼æˆ–é›†ç¾¤æ–¹æ¡ˆã€‚&lt;/p>
&lt;h2 id="-ç›¸å…³ä¼˜åŒ–">ğŸ‘ ç›¸å…³ä¼˜åŒ–&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>é¿å…å…¨é‡å¤åˆ¶&lt;/p>
&lt;p>ä¸»ä»å¤åˆ¶çš„å…¨é‡å¤åˆ¶æ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€—èµ„æºçš„æ“ä½œï¼Œé™¤äº†ç¬¬ä¸€æ¬¡å¤åˆ¶çš„å…¨é‡å¤åˆ¶ï¼Œéœ€è¦å°½é‡é¿å…å…¨é‡å¤åˆ¶ã€‚&lt;/p>
&lt;p>å¤åˆ¶ç§¯å‹ç¼“å­˜åŒºä¸è¶³ï¼Œä¼šå¯¼è‡´å¤åˆ¶é€€åŒ–ä¸ºå…¨é‡å¤åˆ¶ï¼Œåœ¨è¿ç»´æ—¶ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µå¢åŠ ç¼“å†²åŒºçš„å®¹é‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é¿å…å¤åˆ¶é£æš´&lt;/p>
&lt;p>å¦‚æœä¸€ä¸ªä¸»èŠ‚ç‚¹ä¸ŠæŒ‚è½½äº†å¤šä¸ªä»èŠ‚ç‚¹ï¼Œå¦‚æœåŒæ—¶ä¸å¤šä¸ªä»èŠ‚ç‚¹è¿›è¡Œå…¨é‡åŒæ­¥æ—¶ï¼Œä¼šå‘å¤šä¸ªä»èŠ‚ç‚¹å‘é€RDBæ–‡ä»¶ï¼ˆRedis åšäº†ä¼˜åŒ–å¯å…±äº«ä¸€ä¸ª RDBï¼‰ï¼Œå¯¼è‡´ç½‘ç»œå¸¦å®½çš„ä¸¥é‡æ¶ˆè€—ï¼Œé€ æˆå»¶è¿Ÿé—®é¢˜ã€‚&lt;/p>
&lt;p>å»ºè®®ä½¿ç”¨é“¾çŠ¶/æ ‘çŠ¶ç»“æ„ï¼Œä»èŠ‚ç‚¹æŒ‚è½½åˆ°ä»èŠ‚ç‚¹ä¸Šã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å•æœºå¤åˆ¶é£æš´&lt;/p>
&lt;p>ç”±äº Redis çš„ç“¶é¢ˆä¸åœ¨ CPU ä¸Šï¼Œé€šå¸¸ä¼šåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²å¤šä¸ªå®ä¾‹ã€‚ä¸ºäº†é¿å…ç‰©ç†æœºé—®é¢˜å¯¼è‡´çš„æ•…éšœï¼Œå¯¼è‡´æ¢å¤åå¤§é‡ä»èŠ‚ç‚¹å‘ä¸€å°æœºå™¨è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œåº”è¯¥æŠŠä¸»èŠ‚ç‚¹åˆ†æ•£åˆ°å¤šå°æœºå™¨ä¸Šã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-å“¨å…µæœºåˆ¶">ğŸº å“¨å…µæœºåˆ¶&lt;/h2>
&lt;p>ğŸ˜“ Redis åœ¨ä¸»ä»æ¨¡å¼ä¸‹ï¼Œä¸€æ—¦ä¸»èŠ‚ç‚¹æ•…éšœï¼Œéœ€è¦äººå·¥å¹²é¢„å°†ä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼ŒåŒæ—¶éœ€è¦åœ¨å®¢æˆ·ç«¯é…ç½®æ–°çš„ä¸»èŠ‚ç‚¹åœ°å€ã€‚&lt;/p>
&lt;p>ä¸ºäº†è¾¾åˆ°é«˜å¯ç”¨ï¼Œæä¾›äº†å“¨å…µæ¨¡å¼ &lt;code>Redis Sentinel&lt;/code> è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¾¾åˆ°é«˜å¯ç”¨ã€‚èƒ½å¤Ÿè‡ªåŠ¨å®Œæˆæ•…éšœå‘ç°å’Œæ•…éšœè½¬ç§»ã€‚&lt;/p>
&lt;p>åœ¨å“¨å…µæ¨¡å¼ä¸‹ï¼Œç›¸æ¯”äºå¤åˆ¶æ¨¡å¼ï¼Œåªæ˜¯å¤šäº† Sentinel èŠ‚ç‚¹ï¼Œä¸»ä»æ¨¡å¼ä¸‹çš„ Redis èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•ç‰¹æ®Šå¤„ç†ã€‚
å…¶ä¸­ï¼ŒSentinel èŠ‚ç‚¹æœ¬è´¨ä¸Šæ˜¯ç‰¹æ®Šçš„ Redis èŠ‚ç‚¹ï¼Œåªæ˜¯ä¸ä¼šå­˜å‚¨æ•°æ®ï¼Œåªæ”¯æŒéƒ¨åˆ†å‘½ä»¤ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/replication/sentinel.png"
width="545"
height="732"
srcset="https://blog.letout.cn/p/redis/replication/sentinel_hu9ca24b6840f6afec965ea3fe9eb87fe5_297258_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/replication/sentinel_hu9ca24b6840f6afec965ea3fe9eb87fe5_297258_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="74"
data-flex-basis="178px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ” ç›‘æ§&lt;/p>
&lt;p>Sentinel èŠ‚ç‚¹ä¼šå®šæœŸæ£€æŸ¥ Redis æ•°æ®èŠ‚ç‚¹ï¼Œå…¶ä½™ Sentinel èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ“§ é€šçŸ¥&lt;/p>
&lt;p>Sentinel èŠ‚ç‚¹ä¼šå°†æ•…éšœè½¬ç§»çš„ç»“æœé€šçŸ¥ç»™åº”ç”¨æ–¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ“‡ ä¸»èŠ‚ç‚¹æ•…éšœè½¬ç§»&lt;/p>
&lt;p>å¯ä»¥å®ç°æ•…éšœæ—¶ï¼Œå°†ä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶ç»´æŠ¤æ­£ç¡®çš„ä¸»ä»å…³ç³»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ“‘ é…ç½®æä¾›è€…&lt;/p>
&lt;p>åœ¨å“¨å…µç»“æ„ä¸­ï¼Œå®¢æˆ·ç«¯åˆå§‹åŒ–è¿æ¥çš„æ˜¯å“¨å…µé›†ç¾¤ï¼Œä»ä¸­è·å–ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡">ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡&lt;/h3>
&lt;p>Redis Sentinel é€šè¿‡ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡å¯¹å„ä¸ªèŠ‚ç‚¹å‘ç°å’Œç›‘æ§ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ¯éš” 10sï¼Œæ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹å‘é€ info å‘½ä»¤è·å–æœ€æ–°çš„æ‹“æ‰‘ç»“æ„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¯éš” 2sï¼Œæ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šå‘ Redis æ•°æ®èŠ‚ç‚¹çš„ __sentinel__:hello é¢‘é“ä¸Šå‘é€è¯¥ Sentinel èŠ‚ç‚¹å¯¹äºä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œä»¥åŠå½“å‰ Sentinel èŠ‚ç‚¹çš„ä¿¡æ¯&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¯éš” 1sï¼Œæ¯ä¸ª Sentinel ä¼šå‘å…¶ä»– Sentinel èŠ‚ç‚¹ã€ä¸»èŠ‚ç‚¹ã€ä»èŠ‚ç‚¹å‘é€ ping å‘½ä»¤åˆ¤æ–­æ˜¯å¦å¯è¾¾&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿">ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿&lt;/h3>
&lt;h4 id="ä¸»è§‚ä¸‹çº¿">ä¸»è§‚ä¸‹çº¿&lt;/h4>
&lt;p>â€ä¸€å®¶ä¹‹è¨€â€œ&lt;/p>
&lt;p>Sentinel æ¯ 1s ä¼šå‘å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹å‘é€ &lt;code>ping&lt;/code> è¿›è¡ŒğŸ’“å¿ƒè·³æ£€æµ‹ï¼Œå½“èŠ‚ç‚¹è¶…è¿‡æ—¶é—´æ²¡æœ‰å›å¤ï¼Œå°±ä¼šå¯¹è¯¥èŠ‚ç‚¹åšå¤±è´¥åˆ¤å®šã€‚åªæœ‰è¿™ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ¤å®šç§°ä¸ºã€Œä¸»è§‚ä¸‹çº¿ã€ã€‚&lt;/p>
&lt;h4 id="å®¢è§‚ä¸‹çº¿">å®¢è§‚ä¸‹çº¿&lt;/h4>
&lt;p>å½“ä¸»è§‚ä¸‹çº¿çš„ä¸ºä¸»èŠ‚ç‚¹æ—¶ï¼Œå½“å‰ Sentinel èŠ‚ç‚¹ä¼šè¯¢é—®å…¶ä»–å“¨å…µå¯¹è¯¥ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå½“å¤šæ•°å“¨å…µéƒ½å¯¹ä¸»èŠ‚ç‚¹çš„ä¸‹çº¿åšäº†åŒæ„åˆ¤å®šï¼Œè¶…è¿‡é…ç½®ä¸­çš„ quorum ä¸ªæ•°ï¼Œå°±è¢«æ ‡è®°ä¸º ã€Œå®¢è§‚ä¸‹çº¿ã€ã€‚&lt;/p>
&lt;h3 id="sentinel-é¢†å¯¼é€‰ä¸¾">Sentinel é¢†å¯¼é€‰ä¸¾&lt;/h3>
&lt;p>å½“ç¡®å®šå®¢è§‚ä¸‹çº¿ä¹‹åï¼Œéœ€è¦è¿›è¡Œæ•…éšœè½¬ç§»å·¥ä½œã€‚å®é™…ä¸Šæ•…éšœè½¬ç§»å·¥ä½œåªéœ€è¦ä¸€ä¸ª Sentinel èŠ‚ç‚¹æ¥å®Œæˆå³å¯ï¼Œæ‰€ä»¥éœ€è¦å…ˆåšä¸€ä¸ªé¢†å¯¼è€…é€‰ä¸¾çš„å·¥ä½œã€‚&lt;/p>
&lt;p>Redis ä½¿ç”¨ &lt;a class="link" href="https://raft.github.io/" target="_blank" rel="noopener"
>Raft&lt;/a> ç®—æ³•å®ç°é¢†å¯¼çš„é€‰ä¸¾ã€‚&lt;/p>
&lt;p>æ¯ä¸ªåœ¨çº¿çš„ Redis Sentinel éƒ½æœ‰èµ„æ ¼æˆä¸ºé¢†å¯¼è€…ï¼Œåœ¨ä¸€ä¸ªå“¨å…µç¡®å®šä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿æ—¶ï¼Œä¼šå‘å…¶ä»–çš„èŠ‚ç‚¹å‘é€ &lt;code>sentinel is-master-down-by-addr&lt;/code> å‘½ä»¤ï¼Œ
è¦æ±‚å°†è‡ªå·±è®¾ç½®ä¸ºé¢†å¯¼è€…ã€‚&lt;/p>
&lt;p>æ”¶åˆ°å‘½ä»¤çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åŒæ„è¿‡å…¶ä»–èŠ‚ç‚¹çš„è¯·æ±‚ï¼Œå°±ä¼šåŒæ„è¯¥è¯·æ±‚ï¼Œå¦åˆ™æ‹’ç»ã€‚æ¯ä¸ªå“¨å…µèŠ‚ç‚¹åªæœ‰ä¸€ç¥¨ã€‚&lt;/p>
&lt;p>å½“ä¸€ä¸ªå“¨å…µæ‹¿åˆ° quorum ä¸ªç¥¨æ•°æ—¶ï¼Œå°±æˆä¸ºäº†é¢†å¯¼è€…ï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ¬¡æŠ•ç¥¨ã€‚&lt;/p>
&lt;h3 id="æ•…éšœè½¬ç§»">æ•…éšœè½¬ç§»&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸ‘£ é€‰å–æ–°çš„ä¸»èŠ‚ç‚¹&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ§© è¿‡æ»¤â€œä¸å¥åº·â€èŠ‚ç‚¹ï¼ˆä¸»è§‚ä¸‹çº¿ã€æ‰çº¿ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„èŠ‚ç‚¹ï¼Œå¦åˆ™ç»§ç»­ä¸‹ä¸€æ¡è§„åˆ™&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© é€‰å–offsetæœ€å¤§çš„èŠ‚ç‚¹ï¼Œå¦åˆ™ä¸‹ä¸€æ¡è§„åˆ™&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© é€‰å– runId æœ€å°çš„èŠ‚ç‚¹&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸ‘£ ä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹&lt;/p>
&lt;p>ä»èŠ‚ç‚¹æ‰§è¡Œ &lt;code>slaveof no one&lt;/code> æˆä¸ºä¸»èŠ‚ç‚¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ‘£ å“¨å…µé¢†å¯¼è€…å‘å…¶ä»–ä»èŠ‚ç‚¹å‘é€å‘½åï¼Œæ›´æ¢ä¸»èŠ‚ç‚¹ä¿¡æ¯&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ‘£ å°†ä¸‹çº¿çš„ä¸»èŠ‚ç‚¹æ›´æ–°ä¸ºä»èŠ‚ç‚¹ï¼Œå¹¶ä¿æŒç›‘æ§ï¼Œå½“å†æ¬¡ä¸Šçº¿æ—¶ï¼Œä½œä¸ºä»èŠ‚ç‚¹å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ä¿¡æ¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹&lt;/h3>
&lt;ul>
&lt;li>Sentinel èŠ‚ç‚¹åº”è¯¥éƒ¨ç½²åœ¨å¤šå°ç‰©ç†æœºä¸Š&lt;/li>
&lt;/ul>
&lt;p>Redis çš„ç“¶é¢ˆä¸åœ¨ CPUï¼Œé€šè¿‡ä¸€å°ç‰©ç†æœºä¼šéƒ¨ç½²å¤šä¸ª Redis å®ä¾‹ï¼Œå¦‚æœå“¨å…µå…¨éƒ¨éƒ½åœ¨ä¸€å°ç‰©ç†æœºä¸Šï¼Œå¦‚æœå‡ºç°ç‰©ç†æ•…éšœï¼Œæ‰€æœ‰çš„å®ä¾‹éƒ½ä¼šæ”¶åˆ°å½±å“&lt;/p>
&lt;ul>
&lt;li>è‡³å°‘ä¸‰ä¸ª Sentinel èŠ‚ç‚¹ï¼Œä¸”ä¸ºå¥‡æ•°èŠ‚ç‚¹&lt;/li>
&lt;/ul>
&lt;p>å“¨å…µé¢†å¯¼è€…é€‰ä¸¾æ—¶ï¼Œè‡³å°‘éœ€è¦è·å–ã€Œä¸€åŠ+1ã€ä¸ªæŠ•ç¥¨ã€‚å¥‡æ•°èŠ‚ç‚¹å¯ä»¥åœ¨æ»¡è¶³æ¡ä»¶çš„åŸºç¡€ä¸ŠèŠ‚çœä¸€ä¸ªèŠ‚ç‚¹ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://segmentfault.com/a/1190000039766545" target="_blank" rel="noopener"
>https://segmentfault.com/a/1190000039766545&lt;/a>&lt;/li>
&lt;li>Redis å¼€å‘äºè¿ç»´&lt;/li>
&lt;/ul></description></item><item><title>Redis ç¼“å­˜é—®é¢˜</title><link>https://blog.letout.cn/p/redis/cache-problem/</link><pubDate>Wed, 11 Jan 2023 01:52:45 +0800</pubDate><guid>https://blog.letout.cn/p/redis/cache-problem/</guid><description>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/cache.png" alt="Featured image of post Redis ç¼“å­˜é—®é¢˜" />&lt;h2 id="-ç¼“å­˜é›ªå´©">ğŸŒ¨ï¸ ç¼“å­˜é›ªå´©&lt;/h2>
&lt;p>ä¸ºäº†ä¿è¯ç¼“å­˜ä¸­æ•°æ®ä¸æ•°æ®åº“ä¸­çš„æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé€šå¸¸ Redis ä¸­æ•°æ®ä¼šè®¾ç½®è¿‡æœŸæ—¶é—´ã€‚å¦‚æœï¼ˆ1ï¼‰ç¼“å­˜å±‚åœ¨åŒä¸€æ—¶é—´æœ‰å¤§é‡æ•°æ®å¤±æ•ˆï¼Œæˆ–è€… ï¼ˆ2ï¼‰Redis ç”±äºæŸäº›æƒ…å†µå®•æœºï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚å…¨éƒ¨è®¿é—®æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å®•æœºã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/1.png"
width="1080"
height="660"
srcset="https://blog.letout.cn/p/redis/cache-problem/1_huab116a381b3e5ca6aaa694e3ae424f2c_109299_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/1_huab116a381b3e5ca6aaa694e3ae424f2c_109299_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="392px"
>&lt;/p>
&lt;p>ğŸ’¡ è§£å†³åŠæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ§© ç»™æ•°æ®éšæœºè®¾ç½®è¿‡æœŸæ—¶é—´&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© &lt;a class="link" href="https://www.letout.cn/p/distributed-lock/redis/" target="_blank" rel="noopener"
>äº’æ–¥é”&lt;/a>ï¼Œåªæœ‰ä¸€ä¸ªè¯·æ±‚ä¼šåˆ°æ•°æ®åº“ä¸Šï¼Œå¹¶ä¼šé‡å»ºç¼“å­˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© åŒ Key ç­–ç•¥ï¼Œæœ‰ä¸åŒçš„ Keyï¼Œä½†æœ‰ç›¸åŒçš„ Value&lt;/p>
&lt;ul>
&lt;li>ä¸» Keyï¼šè®¾ç½®è¿‡æœŸæ—¶é—´&lt;/li>
&lt;li>å¤‡ Keyï¼šä¸è®¾ç½®è¿‡æœŸæ—¶é—´&lt;/li>
&lt;li>å½“ä¸» Key è¿‡æœŸåï¼Œå¤§é‡è¯·æ±‚åˆ°è¾¾æ—¶ç›´æ¥è¿”å›å¤‡ Keyï¼Œå¹¶é€šçŸ¥åå°çº¿ç¨‹ï¼Œé‡å»ºä¸» Key&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© è®¾ç½® Key æ°¸ä¸è¿‡æœŸï¼Œåå°æ›´æ–°ç¼“å­˜ï¼ˆå†…å­˜ä¸å¤Ÿæ—¶å¯èƒ½è¢«å†…å­˜æ·˜æ±°ç­–ç•¥æ·˜æ±°ï¼‰&lt;/p>
&lt;ul>
&lt;li>åå°çº¿ç¨‹å®šæ—¶æ›´æ–° æˆ– å®šæ—¶æ£€æµ‹æ˜¯å¦å¤±æ•ˆï¼Œè¿›è¡Œé‡å»º&lt;/li>
&lt;li>ä¸šåŠ¡ä¸Šå‘ç°è¢«æ·˜æ±°ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥é‡å»º&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ç¼“å­˜å‡»ç©¿">âš¡ ç¼“å­˜å‡»ç©¿&lt;/h2>
&lt;p>ç¼“å­˜ä¸­æŸä¸ªçƒ­ç‚¹ Key æ•°æ®è¿‡æœŸäº†ï¼Œæ­¤æ—¶æœ‰å¤§é‡è¯·æ±‚è®¿é—®è¯¥æ•°æ®ï¼Œå¯¼è¿™äº›è¯·æ±‚å…¨éƒ¨éƒ½è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå¯¼è‡´æ•°æ®åº“å®•æœºã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/2.png"
width="707"
height="836"
srcset="https://blog.letout.cn/p/redis/cache-problem/2_hu4d851393f6ce96ed0f1e6e1059c88231_81241_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/2_hu4d851393f6ce96ed0f1e6e1059c88231_81241_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="84"
data-flex-basis="202px"
>&lt;/p>
&lt;p>ğŸ’¡ è§£å†³åŠæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ§© &lt;a class="link" href="https://www.letout.cn/p/distributed-lock/redis/" target="_blank" rel="noopener"
>äº’æ–¥é”&lt;/a>ï¼Œåªæœ‰ä¸€ä¸ªè¯·æ±‚ä¼šåˆ°æ•°æ®åº“ä¸Šï¼Œå¹¶é‡å»ºç¼“å­˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼ˆå†…å­˜ä¸å¤Ÿæ—¶å¯èƒ½è¢«å†…å­˜æ·˜æ±°ç­–ç•¥æ·˜æ±°ï¼‰ï¼Œåå°çº¿ç¨‹æ›´æ–°ç¼“å­˜&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ç¼“å­˜ç©¿é€">ğŸŒªï¸ ç¼“å­˜ç©¿é€&lt;/h2>
&lt;p>è¯·æ±‚çš„æ•°æ®æ—¢ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œä¹Ÿä¸å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œæœ‰å¤§é‡è¿™æ ·çš„è¯·æ±‚ï¼Œä¸ä¼šå‘½ä¸­ç¼“å­˜ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›éå¸¸å¤§ã€‚&lt;/p>
&lt;p>å¯èƒ½æ˜¯ç”±äºï¼ˆ1ï¼‰ä¸šåŠ¡è¯¯æ“ä½œ æˆ– ï¼ˆ2ï¼‰é»‘å®¢çš„æ•…æ„æ”»å‡»&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/3.png"
width="576"
height="836"
srcset="https://blog.letout.cn/p/redis/cache-problem/3_hua47220c88eca814bf161e3c4ed6c3627_76648_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/3_hua47220c88eca814bf161e3c4ed6c3627_76648_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="68"
data-flex-basis="165px"
>&lt;/p>
&lt;p>ğŸ’¡ è§£å†³åŠæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ§© ç¼“å­˜é»˜è®¤å€¼ï¼Œåç»­çš„è¯·æ±‚ç›´æ¥è¿”å›è¯¥é»˜è®¤å€¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå½“å¸ƒéš†è¿‡æ»¤å™¨è¿”å› 0 æ—¶ï¼Œè¯´æ˜æ•°æ®ä¸€å®šä¸åœ¨æ•°æ®åº“ä¸­&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© éæ³•è¯·æ±‚é™åˆ¶ï¼Œåœ¨ä¸šåŠ¡å±‚åˆ¤æ–­æŸ¥è¯¢æ¡ä»¶ï¼Œå¦‚æœæ˜¯æ¶æ„è¯·æ±‚ç›´æ¥æ‹’ç»&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-çƒ­ç‚¹-key-é‡å»º">ğŸ”¥ çƒ­ç‚¹ Key é‡å»º&lt;/h2>
&lt;p>å½“çƒ­ç‚¹ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œåç«¯ä¼šæœ‰å¤§é‡è¯·æ±‚ï¼Œåœ¨é‡å»ºç¼“å­˜æ—¶ï¼Œä¼šé€ æˆåç«¯è´Ÿè½½è¿‡å¤§ï¼Œå¯¼è‡´åº”ç”¨å´©æºƒã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ’¡ ä½¿ç”¨äº’æ–¥é”&lt;/p>
&lt;ul>
&lt;li>åªå…è®¸ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…é‡å»ºç¼“å­˜çš„çº¿ç¨‹æ‰§è¡Œå®Œï¼Œæ‰èƒ½ä»ç¼“å­˜è·å–æ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸ’¡ Key æ°¸ä¸è¿‡æœŸ&lt;/p>
&lt;ul>
&lt;li>åˆ©ç”¨åå°çº¿ç¨‹å»å•ç‹¬æ„å»ºç¼“å­˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ç¼“å­˜ä¸€è‡´æ€§">ğŸ ç¼“å­˜ä¸€è‡´æ€§&lt;/h2>
&lt;h3 id="æ›´æ–°">æ›´æ–°&lt;/h3>
&lt;h4 id="-å…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜">âŒ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜&lt;/h4>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/11.png"
width="893"
height="618"
srcset="https://blog.letout.cn/p/redis/cache-problem/11_hu0a23dc2cab9bf3c3bb634fe5cae7e5fa_53493_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/11_hu0a23dc2cab9bf3c3bb634fe5cae7e5fa_53493_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="144"
data-flex-basis="346px"
>&lt;/p>
&lt;h4 id="-å…ˆæ›´æ–°ç¼“å­˜å†æ›´æ–°æ•°æ®åº“">âŒ å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“&lt;/h4>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/12.png"
width="903"
height="498"
srcset="https://blog.letout.cn/p/redis/cache-problem/12_hub4cf2089e272e09419483674cc55ccc3_51215_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/12_hub4cf2089e272e09419483674cc55ccc3_51215_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="435px"
>&lt;/p>
&lt;h3 id="åˆ é™¤">åˆ é™¤&lt;/h3>
&lt;h4 id="-å…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“">â“ å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“&lt;/h4>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/13.png"
width="903"
height="618"
srcset="https://blog.letout.cn/p/redis/cache-problem/13_hu6883dd3e3299a5dfe5e375db77067d03_50514_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/13_hu6883dd3e3299a5dfe5e375db77067d03_50514_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="146"
data-flex-basis="350px"
>&lt;/p>
&lt;p>å¯ä»¥è€ƒè™‘å»¶è¿ŸåŒåˆ ã€‚åœ¨æ›´æ–°å®Œæ•°æ®åº“åï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´å†åˆ é™¤ä¸€æ¬¡ç¼“å­˜ã€‚&lt;/p>
&lt;h4 id="-å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜">â­• å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜&lt;/h4>
&lt;p>åœ¨å®é™…ä¸­ï¼Œå‡ºç°çš„æ¦‚ç‡éå¸¸ä½ã€‚ç¼“å­˜çš„å†™å…¥è¦è¿œè¿œå¿«äºæ•°æ®åº“çš„å†™å…¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/14.png"
width="1080"
height="660"
srcset="https://blog.letout.cn/p/redis/cache-problem/14_huab116a381b3e5ca6aaa694e3ae424f2c_109299_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/14_huab116a381b3e5ca6aaa694e3ae424f2c_109299_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="392px"
>&lt;/p>
&lt;h3 id="å¼‚æ­¥">å¼‚æ­¥&lt;/h3>
&lt;p>é€šè¿‡ æ›´æ–° + åˆ é™¤ï¼Œæ˜¯ä¸¤ä¸ªä¸åŒçš„æ“ä½œï¼Œä¸å…·å¤‡åŸå­æ€§ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/p>
&lt;ul>
&lt;li>ä¸­é—´ä»¶&lt;/li>
&lt;/ul>
&lt;p>é€šè¿‡ä¸­é—´ä»¶ï¼ˆå¦‚ &lt;a class="link" href="https://github.com/alibaba/canal" target="_blank" rel="noopener"
>Canal -&amp;gt; https://github.com/alibaba/canal&lt;/a> ï¼‰è®¢é˜…æ•°æ®åº“çš„ binlogï¼Œå½“æ›´æ–°å®Œæ•°æ®åº“æ—¶ï¼Œé€šè¿‡ä¸­é—´ä»¶å»åˆ é™¤ç¼“å­˜ã€‚&lt;/p>
&lt;h2 id="-å‚è€ƒ">ğŸ“• å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://xiaolincoding.com/redis/" target="_blank" rel="noopener"
>https://xiaolincoding.com/redis/&lt;/a>&lt;/li>
&lt;li>Redis å¼€å‘ä¸è¿ç»´&lt;/li>
&lt;/ul></description></item><item><title>Redis æŒä¹…åŒ–</title><link>https://blog.letout.cn/p/redis/persistence/</link><pubDate>Fri, 06 Jan 2023 22:07:45 +0800</pubDate><guid>https://blog.letout.cn/p/redis/persistence/</guid><description>&lt;img src="https://blog.letout.cn/p/redis/persistence/cow.png" alt="Featured image of post Redis æŒä¹…åŒ–" />&lt;h2 id="ä¿éšœæ•°æ®ä¸ä¸¢å¤±">ä¿éšœæ•°æ®ä¸ä¸¢å¤±&lt;/h2>
&lt;p>Redis çš„è¯»å†™æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†ä¿è¯å†…å­˜ä¸­çš„æ•°æ®ä¸ä¼šä¸¢å¤±ï¼ŒRedis å®ç°äº†æ•°æ®æŒä¹…åŒ–çš„æœºåˆ¶ï¼ŒæŠŠæ•°æ®å­˜å‚¨åˆ°ç£ç›˜ï¼Œè¿™æ ·åœ¨ Redis é‡å¯å°±èƒ½å¤Ÿä»ç£ç›˜ä¸­æ¢å¤åŸæœ‰çš„æ•°æ®ã€‚&lt;/p>
&lt;ul>
&lt;li>RDB å¿«ç…§&lt;/li>
&lt;li>AOF æ—¥å¿—&lt;/li>
&lt;li>æ··åˆæŒä¹…åŒ–ï¼ˆ4.0+ï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="-rdb-å¿«ç…§">ğŸ“· RDB å¿«ç…§&lt;/h2>
&lt;p>RDB å¿«ç…§å°±æ˜¯è®°å½•æŸä¸€ä¸ªç¬é—´çš„å†…å­˜æ•°æ®ï¼Œè®°å½•çš„æ˜¯å®é™…æ•°æ®ã€‚ï¼ˆå…¨é‡å¤‡ä»½ï¼‰&lt;/p>
&lt;p>å¿«ç…§ï¼Œå°±æ˜¯è®°å½•æŸä¸€ä¸ªç¬é—´ä¸œè¥¿ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬ç»™é£æ™¯æ‹ç…§æ—¶ï¼Œé‚£ä¸€ä¸ªç¬é—´çš„ç”»é¢å’Œä¿¡æ¯å°±è®°å½•åˆ°äº†ä¸€å¼ ç…§ç‰‡ã€‚&lt;/p>
&lt;h3 id="è§¦å‘æ¡ä»¶">è§¦å‘æ¡ä»¶&lt;/h3>
&lt;h4 id="æ‰‹åŠ¨è§¦å‘">æ‰‹åŠ¨è§¦å‘&lt;/h4>
&lt;ul>
&lt;li>saveï¼ˆé˜»å¡ä¸»çº¿ç¨‹ï¼‰&lt;/li>
&lt;li>bgsave&lt;/li>
&lt;/ul>
&lt;h4 id="è¢«åŠ¨è§¦å‘">è¢«åŠ¨è§¦å‘&lt;/h4>
&lt;ul>
&lt;li>æ ¹æ®é…ç½®æ–‡ä»¶é€‰é¡¹æ¯éš”ä¸€æ®µæ—¶é—´è§¦å‘ä¸€æ¬¡ bgsave&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 300 ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è‡³å°‘æ‰§è¡Œäº† 10 æ¬¡æ“ä½œ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">save 300 10
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>ä»èŠ‚ç‚¹æ‰§è¡Œå…¨é‡å¤åˆ¶æ“ä½œï¼Œä¸»èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ‰§è¡Œ bgsave æ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ shutdown å‘½ä»¤ï¼Œæ²¡æœ‰å¼€å¯ AOF æŒä¹…åŒ–åŠŸèƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œ bgsave&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å®ç°æ–¹å¼">å®ç°æ–¹å¼&lt;/h3>
&lt;p>æ‰§è¡Œ bgsave å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ fork() åˆ›å»ºå­è¿›ç¨‹ï¼Œå¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Œæ­¤æ—¶å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å…±äº«åŒä¸€ç‰‡å†…å­˜æ•°æ®ï¼Œbgsave å­è¿›ç¨‹ä¼šæŠŠè¯¥å‰¯æœ¬æ•°æ®å†™å…¥ RDB æ–‡ä»¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/persistence/cow.png"
width="969"
height="707"
srcset="https://blog.letout.cn/p/redis/persistence/cow_huef7edcdd3c38f136e9d4b420711ff934_42621_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/persistence/cow_huef7edcdd3c38f136e9d4b420711ff934_42621_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="137"
data-flex-basis="328px"
>&lt;/p>
&lt;p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒRedis ä¾ç„¶å¯ä»¥ç»§ç»­å¤„ç†æ“ä½œå‘½ä»¤ï¼Œå¦‚æœçˆ¶è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œï¼Œå…³é”®çš„æŠ€æœ¯å°±åœ¨äºå†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼ˆCopy-On-Write, COWï¼‰ï¼Œè¢«ä¿®æ”¹çš„æ•°æ®ä¼šå¤åˆ¶ä¸€ä»½å‰¯æœ¬ã€‚ï¼ˆRDB å¿«ç…§ä¿å­˜çš„æ˜¯åŸæœ¬çš„å†…å­˜æ•°æ®ï¼‰&lt;/p>
&lt;h2 id="-aof-æ—¥å¿—">ğŸ“ƒ AOF æ—¥å¿—&lt;/h2>
&lt;p>Redis åœ¨æ‰§è¡Œå®Œä¸€æ¡å‘½ä»¤åï¼Œä¼šæŠŠè¯¥å‘½ä»¤ä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼ˆä¼šå…ˆå†™åˆ°ç¼“å†²åŒºï¼Œé€‰æ‹©åˆé€‚çš„åˆ·ç›˜æ—¶é—´æ‰ä¼šåˆ°ç£ç›˜ä¸­ï¼‰ã€‚&lt;/p>
&lt;p>å½“ Redis é‡å¯æ—¶ï¼Œä¼šè¯»å– AOF æ—¥å¿—çš„å†…å®¹ï¼Œç„¶åé€ä¸€æ‰§è¡Œè¿›è¡Œæ•°æ®æ¢å¤ã€‚&lt;/p>
&lt;h3 id="åå†™æ—¥å¿—">åå†™æ—¥å¿—&lt;/h3>
&lt;p>Reids æ˜¯å…ˆæ‰§è¡Œå†™æ“ä½œå‘½ä»¤åï¼Œæ‰å°†è¯¥å‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—é‡Œã€‚&lt;/p>
&lt;ul>
&lt;li>ä¼˜ç‚¹
&lt;ul>
&lt;li>é¿å…é¢å¤–çš„æ£€æŸ¥å‘½ä»¤çš„å¼€é”€&lt;/li>
&lt;li>å†™æ—¥å¿—çš„æ“ä½œä¸ä¼šé˜»å¡å½“å‰å‘½ä»¤çš„æ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç¼ºç‚¹
&lt;ul>
&lt;li>æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ã€‚åœ¨æ²¡æœ‰å†™åˆ°å†…å­˜ä¸­æ—¶ï¼Œå‘ç”Ÿå®•æœºï¼Œæœ‰ä¸¢å¤±æ•°æ®çš„é£é™©&lt;/li>
&lt;li>å¯èƒ½é˜»å¡åç»­çš„æ“ä½œã€‚æ‰§è¡Œå‘½ä»¤å’Œå†™ AOF æ—¥å¿—éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå½“æŠŠæ—¥å¿—å†™å…¥åˆ°ç£ç›˜æ—¶ï¼Œä¼šé˜»å¡åç»­çš„æ“ä½œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="å†™å›ç­–ç•¥">å†™å›ç­–ç•¥&lt;/h3>
&lt;p>Redis æ‰§è¡Œå®Œå†™æ“ä½œå‘½ä»¤åï¼Œä¼šå°†å‘½ä»¤è¿½åŠ åˆ° server.aof_buf ç¼“å†²åŒºï¼Œä»€ä¹ˆæ—¶å€™å†™å›åˆ°ç£ç›˜ï¼Œç”±é…ç½®å†³å®šã€‚&lt;/p>
&lt;p>Redis.conf å¯é…ç½®å‚æ•° &lt;code>appendfsync&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Always&lt;/p>
&lt;ul>
&lt;li>æ¯æ¬¡éƒ½å†™å›&lt;/li>
&lt;li>å¯é æ€§é«˜ï¼Œæœ€å¤§ç¨‹åº¦ä¼šä¿è¯æ•°æ®ä¸ä¸¢å¤±&lt;/li>
&lt;li>æ¯ä¸ªå‘½ä»¤éƒ½è¦å†™å›ç¡¬ç›˜ï¼Œæ€§èƒ½å¼€é”€å¤§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Everysec&lt;/p>
&lt;ul>
&lt;li>æ¯ç§’å†™å›&lt;/li>
&lt;li>å®•æœºæ—¶ä¼šä¸¢å¤± 1s å†…çš„æ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>No&lt;/p>
&lt;ul>
&lt;li>ç”±æ“ä½œç³»ç»Ÿå†³å®šå†™å›æ—¶æœº&lt;/li>
&lt;li>å®•æœºæ—¶å¯èƒ½ä¼šä¸¢å¤±å¾ˆå¤šæ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="aof-é‡å†™">AOF é‡å†™&lt;/h3>
&lt;p>AOF æ—¥å¿—æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œéšç€æ‰§è¡Œçš„å†™æ“ä½œå‘½ä»¤è¶Šæ¥è¶Šå¤šï¼Œæ–‡ä»¶çš„å¤§å°ä¼šè¶Šæ¥è¶Šå¤§ã€‚ å¦‚æœå½“ AOF æ—¥å¿—æ–‡ä»¶è¿‡å¤§å°±ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚é‡å¯ Redis åï¼Œéœ€è¦è¯» AOF æ–‡ä»¶çš„å†…å®¹ä»¥æ¢å¤æ•°æ®ï¼Œå¦‚æœæ–‡ä»¶è¿‡å¤§ï¼Œæ•´ä¸ªæ¢å¤çš„è¿‡ç¨‹å°±ä¼šå¾ˆæ…¢ã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å… AOF æ–‡ä»¶è¶Šå†™è¶Šå¤§ï¼Œæä¾›äº† AOF é‡å†™æœºåˆ¶ï¼Œå½“ AOF æ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼åï¼ŒRedis å°±ä¼šå¯ç”¨ AOF é‡å†™æœºåˆ¶ï¼Œæ¥å‹ç¼© AOF æ–‡ä»¶ã€‚&lt;/p>
&lt;p>AOF é‡å†™æ—¶ï¼Œä¼šè¯»å–æ•°æ®åº“ä¸­æ‰€æœ‰çš„é”®å€¼å¯¹ï¼Œç„¶åå°†æ¯ä¸€ä¸ªé”®å€¼å¯¹ç”¨ä¸€æ¡å†™å‘½ä»¤è®°å½•åˆ° æ–°çš„ AOF æ–‡ä»¶ä¸­ï¼Œç­‰åˆ°å…¨éƒ¨è®°å½•å®Œä¹‹åï¼Œå°±å°†æ–°çš„æ–‡ä»¶æ›¿æ¢æ‰æ—§çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;h4 id="å®ç°æ–¹å¼-1">å®ç°æ–¹å¼&lt;/h4>
&lt;p>é€šè¿‡ fork åå°å­è¿›ç¨‹å®Œæˆã€‚ä½¿ç”¨ COW æŠ€æœ¯ï¼Œå…±äº«ç‰©ç†å†…å­˜ã€‚&lt;/p>
&lt;p>åœ¨é‡å†™æœŸé—´ï¼Œä¾æ—§å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œå†™å‘½ä»¤ä¼šåŒæ—¶ä¿å­˜åœ¨ï¼ˆ1ï¼‰AOF ç¼“å­˜åŒº å’Œ ï¼ˆ2ï¼‰AOF é‡å†™ç¼“å­˜åŒºã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/persistence/aof.png"
width="940"
height="1014"
srcset="https://blog.letout.cn/p/redis/persistence/aof_huf07c02c53918ac63e75c29803edc1708_212356_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/persistence/aof_huf07c02c53918ac63e75c29803edc1708_212356_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="92"
data-flex-basis="222px"
>&lt;/p>
&lt;p>æ‰§è¡Œå®Œæˆä¹‹åï¼Œå°† AOF é‡å†™ç¼“å­˜åŒºçš„å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶æ›¿æ¢æ—§çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;h2 id="-æ··åˆæŒä¹…åŒ–">ğŸ—ƒï¸ æ··åˆæŒä¹…åŒ–&lt;/h2>
&lt;p>æ··åˆæŒä¹…åŒ–å·¥ä½œåœ¨ AOF æ—¥å¿—é‡å†™è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>å½“å¼€å¯äº†æ··åˆæŒä¹…åŒ–æ—¶ï¼Œåœ¨ AOF é‡å†™æ—¥å¿—æ—¶ï¼Œ&lt;/p>
&lt;ul>
&lt;li>fork å‡ºæ¥çš„é‡å†™å­è¿›ç¨‹ä¼šå…ˆå°†ä¸ä¸»çº¿ç¨‹å…±äº«çš„å†…å­˜æ•°æ®ä»¥ RDB æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œ&lt;/li>
&lt;li>ä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ä¼šè¢«è®°å½•åœ¨é‡å†™ç¼“å†²åŒºé‡Œï¼Œé‡å†™ç¼“å†²åŒºé‡Œçš„å¢é‡å‘½ä»¤ä¼šä»¥ AOF æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œ&lt;/li>
&lt;li>å†™å…¥å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹å°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/persistence/mix.jpg"
width="325"
height="356"
srcset="https://blog.letout.cn/p/redis/persistence/mix_huce3a57336b77bba5760b97f3c77136cb_10330_480x0_resize_q75_box.jpg 480w, https://blog.letout.cn/p/redis/persistence/mix_huce3a57336b77bba5760b97f3c77136cb_10330_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="91"
data-flex-basis="219px"
>&lt;/p>
&lt;p>ä½¿ç”¨äº†æ··åˆæŒä¹…åŒ–ï¼ŒAOF æ–‡ä»¶çš„å‰åŠéƒ¨åˆ†æ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒååŠéƒ¨åˆ†æ˜¯ AOF æ ¼å¼çš„å¢é‡æ•°æ®ã€‚&lt;/p></description></item><item><title>Redis å¸¸è§æ•°æ®ç»“æ„</title><link>https://blog.letout.cn/p/redis/data-struct/</link><pubDate>Wed, 01 Jun 2022 01:52:45 +0800</pubDate><guid>https://blog.letout.cn/p/redis/data-struct/</guid><description>&lt;img src="https://blog.letout.cn/p/redis/data-struct/redis.jpg" alt="Featured image of post Redis å¸¸è§æ•°æ®ç»“æ„" />&lt;p>Redis æä¾›äº†ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œå¸¸è§çš„æœ‰äº”ç§ï¼š&lt;/p>
&lt;ul>
&lt;li>String å­—ç¬¦ä¸²&lt;/li>
&lt;li>List åˆ—è¡¨&lt;/li>
&lt;li>Hash å“ˆå¸Œ&lt;/li>
&lt;li>Set é›†åˆ&lt;/li>
&lt;li>Zset æœ‰åºé›†åˆ&lt;/li>
&lt;/ul>
&lt;p>éšç€ Redis ç‰ˆæœ¬çš„æ›´æ–°ï¼Œåé¢åˆæ”¯æŒäº†å››ç§æ•°æ®ç±»å‹ï¼š&lt;/p>
&lt;ul>
&lt;li>BitMap (2.2)&lt;/li>
&lt;li>HyperLogLog (2.8)&lt;/li>
&lt;li>GEO (3.2)&lt;/li>
&lt;li>Stream (5.0)&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://try.redis.io/" target="_blank" rel="noopener"
>åœ¨çº¿ Redis ä½“éªŒ â†’ https://try.redis.io/&lt;/a>&lt;/p>
&lt;h2 id="-string">ğŸ¦® String&lt;/h2>
&lt;p>String æ˜¯æœ€åŸºæœ¬çš„ &lt;code>key-value&lt;/code> ç»“æ„ã€‚&lt;code>key&lt;/code> æ˜¯å”¯ä¸€æ ‡è¯†ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ï¼‰ï¼Œ&lt;code>value&lt;/code> æ˜¯å…·ä½“çš„å€¼ï¼ˆæœ€é•¿å¯ä»¥å®¹çº³ 521Mï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/string.webp"
width="1698"
height="724"
srcset="https://blog.letout.cn/p/redis/data-struct/string_hu6be3934e7d6496236c063d8dd99c676c_31658_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/string_hu6be3934e7d6496236c063d8dd99c676c_31658_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="562px"
>&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤">ğŸ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>ğŸ§© åŸºæœ¬æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è®¾ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">get name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">exists name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–å­—ç¬¦ä¸²çš„é•¿åº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">strlen name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">del name
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ§© æ‰¹é‡è®¾ç½®&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰¹é‡è®¾ç½® k-v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mset key1 value1 key2 value2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰¹é‡è·å– k-v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mget key1 key2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ§© è®¡æ•°å™¨ï¼ˆvalue ä¸ºæ•´æ•°ï¼‰&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è®¾ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> num &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">incr num
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">incrby num &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">decr num
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">decrby num &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ§© è¿‡æœŸï¼ˆé»˜è®¤ä¸ºæ°¸ä¸è¿‡æœŸï¼‰&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ ex-&amp;gt;ç§’ px-&amp;gt;æ¯«ç§’&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery ex &lt;span class="m">60&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯¹å·²å­˜åœ¨çš„ key è®¾ç½®è¿‡æœŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">expire name &lt;span class="m">60&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹è¿‡æœŸæ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ttl name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç§»é™¤è¿‡æœŸæ—¶é—´ï¼ˆæ— è¿‡æœŸæ—¶é—´ ttl è¿”å› -1ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persist name
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ§© å­˜åœ¨ä¸ä¸å­˜åœ¨&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># key ä¸å­˜åœ¨æ‰æˆåŠŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery nx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># key å­˜åœ¨æ‰æˆåŠŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery xx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®ç°æ–¹å¼">ğŸ¡ å®ç°æ–¹å¼&lt;/h3>
&lt;p>String çš„åº•å±‚å®ç°æ˜¯è‡ªå®šä¹‰çš„ SDSï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰ã€‚&lt;/p>
&lt;p>ç›¸æ¯”äº C è¯­è¨€çš„å­—ç¬¦ä¸²ï¼š&lt;/p>
&lt;ul>
&lt;li>SDS ä¸ä»…å¯ä»¥ä¿å­˜æ–‡æœ¬ï¼Œè¿˜å¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>SDS çš„ API éƒ½ä¼šä¸€å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼å¤„ç†ä¿å­˜åœ¨ &lt;code>buf[]&lt;/code> æ•°ç»„ä¸­çš„æ•°æ®ã€‚&lt;/p>
&lt;ul>
&lt;li>SDS è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚&lt;/li>
&lt;/ul>
&lt;p>C è¯­è¨€çš„å­—ç¬¦ä¸²ä¸ä¼šè®°å½•è‡ªèº«é•¿åº¦ï¼Œè·å–éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚SDS ç»“æ„ä¸­è®°å½•äº†é•¿åº¦ã€‚&lt;/p>
&lt;ul>
&lt;li>SDS çš„ API æ˜¯å®‰å…¨çš„ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²ä¸ä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚&lt;/li>
&lt;/ul>
&lt;p>SDS åœ¨æ‹¼æ¥å‰ä¼šæ£€æŸ¥ç©ºé—´æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œä¸å¤Ÿçš„è¯ä¼šè‡ªåŠ¨æ‰©å®¹ã€‚&lt;/p>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯">ğŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸ“ ç¼“å­˜å¯¹è±¡&lt;/p>
&lt;ul>
&lt;li>ç›´æ¥ç¼“å­˜ JSONã€‚ &lt;code>SET user:1 '{&amp;quot;name&amp;quot;:&amp;quot;emery&amp;quot;, &amp;quot;age&amp;quot;:18}'&lt;/code>&lt;/li>
&lt;li>åˆ†ç¦»ä¸º user:id ä½œä¸º keyï¼Œç”¨ mset å­˜å‚¨ã€‚ &lt;code>MSET user:1:name emery user:1:age 18 user:2:name lin user:2:age 20&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸ“ å¸¸è§„è®¡æ•°&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Redis å¤„ç†å‘½ä»¤æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥æ‰§è¡Œå‘½ä»¤çš„è¿‡ç¨‹æ˜¯åŸå­çš„ã€‚å¯ä»¥å¯¹è®¿é—®è®¿é—®æ¬¡æ•°ã€ç‚¹èµã€è½¬å‘ã€åº“å­˜æ•°é‡è¿›è¡Œç»Ÿè®¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> aritcle:readcount:1001 &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åŸå­æ“ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">incr aritcle:readcount:1001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ“ &lt;a class="link" href="https://www.letout.cn/p/distributed-lock/redis/" target="_blank" rel="noopener"
>åˆ†å¸ƒå¼é”&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>NX&lt;/code> å‚æ•°å¯ä»¥å®ç°åœ¨ key å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰æ’å…¥æ•°æ®ï¼Œå¯ä»¥ç”¨æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lock_key åˆ†å¸ƒå¼é”çš„ key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># unique_value å®¢æˆ·ç«¯ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># NX åœ¨ lock_key ä¸å­˜åœ¨æ—¶ï¼Œæ‰è¿›è¡Œæ“ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PX æ¯«ç§’ 10000ms -&amp;gt; 10s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> lock_key unique_value NX PX &lt;span class="m">10000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ“ å…±äº« session ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;p>Session ä¿å­˜åœ¨æœåŠ¡ç«¯ï¼Œé€šå¸¸ç”¨äºä¿å­˜ç”¨æˆ·çš„ä¼šè¯çŠ¶æ€ï¼ˆç™»å½•ï¼‰ã€‚&lt;/p>
&lt;p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¤šæ¬¡è¯·æ±‚ä¸ä¸€å®šéƒ½åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© Redis å¯¹ Session ä¿¡æ¯è¿›è¡Œç»Ÿä¸€çš„å­˜å‚¨å’Œç®¡ç†ï¼ŒæœåŠ¡å™¨éƒ½å»åŒä¸€ä¸ª Redis è·å–ç›¸å…³çš„ Session ä¿¡æ¯ï¼Œè¿™æ ·å°±è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ Session å­˜å‚¨çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/session.webp"
width="473"
height="412"
srcset="https://blog.letout.cn/p/redis/data-struct/session_hua9fef675509e88be48c6a316850a3976_17592_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/session_hua9fef675509e88be48c6a316850a3976_17592_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="114"
data-flex-basis="275px"
>&lt;/p>
&lt;h2 id="-list">ğŸ… List&lt;/h2>
&lt;p>List æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œå¯ä»¥ä»å¤´éƒ¨æˆ–å°¾éƒ¨å‘ List ä¸­æ·»åŠ å…ƒç´ ã€‚æœ€å¤§é•¿åº¦ä¸º &lt;code>2^32 - 1&lt;/code>ã€‚&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-1">ğŸ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/list.webp"
width="1936"
height="684"
srcset="https://blog.letout.cn/p/redis/data-struct/list_huc892bbfdf91688e9656244dd3482dcd2_21712_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/list_huc892bbfdf91688e9656244dd3482dcd2_21712_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="283"
data-flex-basis="679px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ’å…¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lpush key value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rpush key value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç§»é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lpop key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rpop key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿”å›æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ï¼ˆä» 0 å¼€å§‹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lrange key start end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå¹¶é˜»å¡ timeout ç§’ï¼ˆå½“ timeout=0 å°±ä¸€ç›´é˜»å¡ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">blpop key timeout
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">brpop key timeout
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®ç°æ–¹å¼-1">ğŸ¡ å®ç°æ–¹å¼&lt;/h3>
&lt;p>Redis List åº•å±‚ç”±ï¼ˆ1ï¼‰å‹ç¼©åˆ—è¡¨ æˆ– ï¼ˆ2ï¼‰åŒå‘é“¾è¡¨ å®ç°ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å‹ç¼©åˆ—è¡¨ï¼š&lt;/p>
&lt;ul>
&lt;li>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å°äº 512 ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± list-max-ziplist-entries é…ç½®ï¼‰ï¼Œ&lt;/li>
&lt;li>åˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äº 64 å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± list-max-ziplist-value é…ç½®ï¼‰ï¼Œ&lt;/li>
&lt;li>Redis ä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>åŒå‘åˆ—è¡¨ï¼šä¸æ»¡è¶³å‹ç¼©åˆ—è¡¨çš„æ¡ä»¶åº•å±‚å°±ä¼šä½¿ç”¨åŒå‘åˆ—è¡¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>å‹ç¼©åˆ—è¡¨&lt;/p>
&lt;p>æ˜¯ Reids ä¸ºäº†èŠ‚çº¦å†…å­˜è€Œå¼€å‘çš„ï¼Œç”±è¿ç»­å†…å­˜å—ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„ï¼Œæœ‰ç‚¹ç±»å‹äºæ•°ç»„ã€‚&lt;/p>
&lt;p>åœ¨è¡¨å¤´æœ‰ä¸‰ä¸ªå­—æ®µï¼š
ï¼ˆ1ï¼‰zlbytesï¼šå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜å­—èŠ‚æ•°ï¼›
ï¼ˆ2ï¼‰zltailï¼šåˆ—è¡¨å°¾çš„åç§»é‡ï¼ˆå°¾éƒ¨è·ç¦»é¦–éƒ¨æœ‰å¤šå°‘ä¸ªå­—èŠ‚ï¼‰ï¼›
ï¼ˆ3ï¼‰zllenï¼šå‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ï¼›&lt;/p>
&lt;p>åœ¨è¡¨å°¾æœ‰ä¸€ä¸ªå­—æ®µï¼š
ï¼ˆ4ï¼‰zlendï¼šåˆ—è¡¨ç»“æŸçš„æ ‡å¿—ï¼ˆå›ºå®šå€¼ 0xFF -&amp;gt; 255ï¼‰ï¼›&lt;/p>
&lt;p>æŸ¥æ‰¾å®šä½ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(1)
æŸ¥æ‰¾å…¶ä»–å…ƒç´ ï¼Œåªèƒ½é€ä¸ªæŸ¥æ‰¾ï¼ŒO(n)ï¼Œæ‰€ä»¥å‹ç¼©åˆ—è¡¨ä¸é€‚åˆä¿å­˜è¿‡å¤šçš„å…ƒç´ ã€‚&lt;/p>
&lt;p>åœ¨ Redisä¸­ï¼ŒListã€Hashã€Zset å¯¹è±¡ï¼Œåœ¨å…ƒç´ æ•°é‡è¾ƒå°‘ï¼Œå…ƒç´ å€¼ä¸å¤§æ—¶ï¼Œä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-1">ğŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ğŸ“ æ¶ˆæ¯é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/list-mq.webp"
width="1642"
height="374"
srcset="https://blog.letout.cn/p/redis/data-struct/list-mq_hu84909a50c09ec905badb1edece873c1a_26948_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/list-mq_hu84909a50c09ec905badb1edece873c1a_26948_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="439"
data-flex-basis="1053px"
>&lt;/p>
&lt;h2 id="-hash">ğŸ¦› Hash&lt;/h2>
&lt;p>Hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆ &lt;code>key-value&lt;/code>ï¼Œç‰¹åˆ«é€‚åˆå­˜å‚¨å¯¹è±¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/hash.webp"
width="1240"
height="888"
srcset="https://blog.letout.cn/p/redis/data-struct/hash_hu502a0c0c4b1bff1d1b5a1b9e04992920_41732_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/hash_hu502a0c0c4b1bff1d1b5a1b9e04992920_41732_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="139"
data-flex-basis="335px"
>&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-2">ğŸ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å­˜å‚¨ä¸€ä¸ª key=people çš„å“ˆå¸Œè¡¨ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hset people name &lt;span class="s2">&amp;#34;Emery&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–å“ˆå¸Œè¡¨ä¸­çš„å€¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hget people name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å­˜å‚¨å¤šä¸ªé”®å€¼å¯¹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmset people name &lt;span class="s2">&amp;#34;Emery&amp;#34;&lt;/span> age &lt;span class="m">18&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰¹é‡è·å–é”®å€¼å¯¹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmget people name age
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤ä¸€ä¸ªå“ˆå¸Œè¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hdel people
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å¾—å“ˆå¸Œè¡¨ä¸­key-valueå¯¹çš„æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hlen people
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„ key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hgetall people
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®ç°æ–¹å¼-2">ğŸ¡ å®ç°æ–¹å¼&lt;/h3>
&lt;p>Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ç”± ï¼ˆ1ï¼‰å‹ç¼©åˆ—è¡¨ æˆ– ï¼ˆ2ï¼‰å“ˆå¸Œè¡¨ å®ç°ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å‹ç¼©åˆ—è¡¨&lt;/p>
&lt;ul>
&lt;li>å…ƒç´ å°äº 512 ä¸ª&lt;/li>
&lt;li>æ‰€æœ‰çš„å€¼å°äº 64 å­—èŠ‚&lt;/li>
&lt;li>ä½¿ç”¨å‹ç¼©åˆ—è¡¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å“ˆå¸Œè¡¨&lt;/p>
&lt;ul>
&lt;li>ä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ä½¿ç”¨ hash è¡¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-2">ğŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ğŸ“ ç¼“å­˜å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/hash-object.webp"
width="1192"
height="840"
srcset="https://blog.letout.cn/p/redis/data-struct/hash-object_huacd74159ecd6ae063f912243dd43d93b_31326_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/hash-object_huacd74159ecd6ae063f912243dd43d93b_31326_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="340px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">hmset uid:10001 name Tom age &lt;span class="m">15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmset uid:10002 name Jerry age &lt;span class="m">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmget uid:10001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ String ç±»å‹ç¼“å­˜ JSON ä¹Ÿæ˜¯ç¼“å­˜å¯¹è±¡çš„ä¸€ç§å‡¡æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­æŸäº›å±æ€§é¢‘ç¹å˜åŒ–ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Hashã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸ›’ è´­ç‰©è½¦
&lt;ul>
&lt;li>ğŸ˜ƒ ç”¨æˆ· id -&amp;gt; key&lt;/li>
&lt;li>ğŸª å•†å“ id -&amp;gt; field&lt;/li>
&lt;li>ğŸ”¢ å•†å“æ•°é‡ -&amp;gt; value&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ å•†å“ cart:{ç”¨æˆ·id} {å•†å“id} 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hset cart:10001 &lt;span class="m">22223&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hincrby cart:10001 &lt;span class="m">22223&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å¾—å•†å“æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hget cart:10001 &lt;span class="m">22223&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤å•†å“&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hdel cart:10001 &lt;span class="m">22223&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–è´­ç‰©è½¦æ‰€æœ‰å•†å“&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hgetall cart:10001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼ŒRedis ä¸­åªå­˜å‚¨äº†å•†å“çš„ id ä¿¡æ¯ï¼Œåœ¨å›æ˜¾å•†å“çš„å…·ä½“ä¿¡æ¯æ—¶ï¼Œå†æ‹¿å•†å“ id æŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“ï¼Œè·å–å®Œæ•´çš„å•†å“ä¿¡æ¯ã€‚&lt;/p>
&lt;h2 id="-set">ğŸ‘ Set&lt;/h2>
&lt;p>Set æ˜¯ä¸€ä¸ªæ— åºå¹¶å”¯ä¸€çš„é›†åˆï¼ˆå­˜å‚¨é¡ºåºä¸ä¼šæŒ‰ç…§æ’å…¥çš„å…ˆåé¡ºåºè¿›è¡Œå­˜å‚¨ï¼‰ã€‚&lt;/p>
&lt;p>é›†åˆä¸­æœ€å¤šå¯ä»¥å­˜å‚¨ &lt;code>2^32 - 1&lt;/code> ä¸ªå…ƒç´ ï¼Œé™¤å¢åˆ æ”¹æŸ¥å¤–ï¼Œè¿˜æ”¯æŒå¤šä¸ªé›†åˆçš„äº¤é›†ã€å¹¶é›†å’Œå·®é›†ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/set.webp"
width="1268"
height="654"
srcset="https://blog.letout.cn/p/redis/data-struct/set_hu834a88f1bdb5e75fecc5121b1cadeb66_29462_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/set_hu834a88f1bdb5e75fecc5121b1cadeb66_29462_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="193"
data-flex-basis="465px"
>&lt;/p>
&lt;p>List ä¸ Set çš„åŒºåˆ«ï¼š&lt;/p>
&lt;ul>
&lt;li>List å¯ä»¥å­˜å‚¨é‡å¤å…ƒç´ ï¼ŒSet ä¸å¯ä»¥&lt;/li>
&lt;li>List æŒ‰ç…§å…ƒç´ æ·»åŠ çš„é¡ºåºå­˜å‚¨å…ƒç´ ï¼ŒSet å­˜å‚¨å…ƒç´ æ˜¯æ— åºçš„&lt;/li>
&lt;/ul>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-3">ğŸ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>ğŸ§© å¸¸ç”¨æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ å…ƒç´ ï¼ˆå·²å­˜åœ¨åˆ™å¿½ç•¥ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd key value1 &lt;span class="o">[&lt;/span>value2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srem key value1 &lt;span class="o">[&lt;/span>value2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–æ‰€æœ‰çš„å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">smembers key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scard key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ¤æ–­æ˜¯å¦å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember key value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»é›†åˆä¸­éšæœºé€‰å– count ä¸ªå…ƒç´ ï¼Œä¸ä»ä¸­åˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srandmember key &lt;span class="o">[&lt;/span>count&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»é›†åˆä¸­éšæœºé€‰å– count ä¸ªå…ƒç´ ï¼Œå¹¶åˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spop key &lt;span class="o">[&lt;/span>count&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ§© è¿ç®—æ“ä½œ&lt;/li>
&lt;/ul>
&lt;p>âš  Set çš„äº¤å¹¶å·®é›†è¿ç®—çš„å¤æ‚åº¦è¾ƒé«˜ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œè®¡ç®—ï¼Œä¼šå¯¼è‡´ Redis å®ä¾‹é˜»å¡ã€‚
åœ¨å®é™…ä¸­ï¼Œæ¨èè·å–æ•°æ®åï¼Œåœ¨å®¢æˆ·ç«¯å»å®Œæˆè®¡ç®—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># äº¤é›†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sinter key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># äº¤é›†å¹¶å­˜å‚¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sinterstore destination key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¹¶é›†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sunion key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sunionstore destination key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å·®é›†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sdiff key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sdiffstore destination key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®ç°æ–¹å¼-3">ğŸ¡ å®ç°æ–¹å¼&lt;/h3>
&lt;p>Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ç”± ï¼ˆ1ï¼‰å“ˆå¸Œè¡¨ æˆ– ï¼ˆ2ï¼‰æ•´æ•°é›†åˆå®ç°ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ•´æ•°é›†åˆ&lt;/p>
&lt;ul>
&lt;li>å…ƒç´ ä¸ªæ•°å°‘äº 512 ä¸ªï¼Œåº•å±‚é‡‡ç”¨æ•´æ•°é›†åˆä½œä¸ºæ•°æ®ç»“æ„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å“ˆå¸Œè¡¨&lt;/p>
&lt;ul>
&lt;li>ä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-3">ğŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;p>Set ä¸»è¦æ˜¯æ— ç»­ï¼Œä¸å¯é‡å¤ï¼Œå¯æ±‚äº¤å¹¶å·®çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸ“ ç‚¹èµ&lt;/li>
&lt;/ul>
&lt;p>Set ç±»å‹å¯ä»¥ä¿è¯ç”¨æˆ·åªèƒ½ç‚¹ä¸€ä¸ªèµã€‚&lt;/p>
&lt;ul>
&lt;li>key -&amp;gt; æ–‡ç«  id&lt;/li>
&lt;li>value -&amp;gt; ç”¨æˆ· id&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ–‡ç«  1 è¢« id ä¸º 1ã€2ã€3 çš„ç”¨æˆ·ç‚¹èµ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd article:1 uid:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd article:1 uid:2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd article:1 uid:3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å–æ¶ˆç‚¹èµ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srem article:1 uid:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å– æ–‡ç«  1 çš„ç‚¹èµç”¨æˆ· id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">smembers article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å– æ–‡ç«  1 çš„ç‚¹èµæ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scard article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ¤æ–­ ç”¨æˆ· 1 æ˜¯å¦å¯¹æ–‡ç«  1 è¿›è¡Œäº†ç‚¹èµ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember article:1 uid:1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ“ å…±åŒå…³æ³¨&lt;/li>
&lt;/ul>
&lt;p>Set æ”¯æŒäº¤é›†è¿ç®—ï¼Œå¯ä»¥ç”¨æ¥è®¡ç®—å…±åŒå…³æ³¨çš„å¥½å‹ï¼Œå…¬ä¼—å·ç­‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># id ä¸º 1ã€2 çš„ç”¨æˆ·å…³æ³¨çš„å…¬ä¼—å·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd uid:1 &lt;span class="m">5&lt;/span> &lt;span class="m">6&lt;/span> &lt;span class="m">7&lt;/span> &lt;span class="m">8&lt;/span> &lt;span class="m">9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd uid:2 &lt;span class="m">7&lt;/span> &lt;span class="m">8&lt;/span> &lt;span class="m">9&lt;/span> &lt;span class="m">10&lt;/span> &lt;span class="m">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–å…±åŒå…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sinter uid:1 uid:2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç»™ uid:2 æ¨è uid:1 å…³æ³¨çš„å…¬ä¼—å·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sdiff uid:1 uid:2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># éªŒè¯æŸä¸ªå…¬ä¼—å·æ˜¯å¦è¢«åŒæ—¶å…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember uid:1 &lt;span class="m">5&lt;/span> &lt;span class="c1"># -&amp;gt; 1 å…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember uid:2 &lt;span class="m">5&lt;/span> &lt;span class="c1"># -&amp;gt; 0 æœªå…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ“ æŠ½å¥–æ´»åŠ¨&lt;/li>
&lt;/ul>
&lt;p>key-&amp;gt;æ´»åŠ¨åï¼Œvalue-&amp;gt;ç”¨æˆ·åï¼Œå­˜å‚¨æŸæ´»åŠ¨ä¸­ä¸­å¥–çš„ç”¨æˆ·å ï¼ŒSet ç±»å‹å› ä¸ºæœ‰å»é‡åŠŸèƒ½ï¼Œå¯ä»¥ä¿è¯åŒä¸€ä¸ªç”¨æˆ·ä¸ä¼šä¸­å¥–ä¸¤æ¬¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sadd lucky Tom Jerry John Sean Marry Lindy Sary Mark
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŠ½å– 1 ä¸ªä¸€ç­‰å¥–ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srangememeber lucky &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŠ½å– 2 ä¸ªäºŒç­‰å¥–ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srangememeber lucky &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸å…è®¸é‡å¤è·å¥–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spop lucky &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-zset">ğŸ¦¥ Zset&lt;/h2>
&lt;p>Zsetï¼ˆæœ‰åºé›†åˆï¼Œä»å°åˆ°å¤§ï¼‰ ç›¸æ¯”äº Set ç±»å‹å¤šäº†ä¸€ä¸ªæ’åºåˆ†å€¼ socreã€‚&lt;/p>
&lt;p>å¯¹äºæœ‰åºé›†åˆ ZSet æ¥è¯´ï¼Œæ¯ä¸ªå­˜å‚¨çš„å…ƒç´ ç”±ä¸¤ä¸ªå€¼ç»„æˆï¼Œä¸€ä¸ªæ˜¯æœ‰åºé›†åˆçš„å…ƒç´ å€¼ï¼Œä¸€ä¸ªæ˜¯æ’åºå€¼ã€‚&lt;/p>
&lt;p>Zset ä¸­å…ƒç´ ä¸èƒ½é‡å¤ï¼Œåˆ†æ•°å€¼å¯ä»¥é‡å¤ï¼Œå¹¶ä¸”å¯ä»¥æ’åºã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/zset.webp"
width="1226"
height="616"
srcset="https://blog.letout.cn/p/redis/data-struct/zset_hudfba1ba2f4862e7afd7997bee0d59f08_21828_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/zset_hudfba1ba2f4862e7afd7997bee0d59f08_21828_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="199"
data-flex-basis="477px"
>&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-4">ğŸ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>ğŸ§© å¸¸ç”¨æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å‘æœ‰åºé›†åˆä¸­åŠ å…¥å¸¦åˆ†å€¼çš„å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zadd key socre number &lt;span class="o">[[&lt;/span>score number&lt;span class="o">]&lt;/span> ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»æœ‰åºé›†åˆä¸­åˆ é™¤å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrem key number &lt;span class="o">[&lt;/span>number ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿”å›æœ‰åºé›†åˆä¸­å…ƒç´ çš„åˆ†æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zscore key number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿”å›æœ‰åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zcard key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸ºæœ‰åºé›†åˆä¸­ member çš„åˆ†å€¼åŠ ä¸Š increment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zincrby key increment member
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ­£åºè·å–æœ‰åºé›†åˆä¸­ start-&amp;gt;end çš„ä¸‹è¡¨å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrange key start end &lt;span class="o">[&lt;/span>withscores&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å€’åºè·å–æœ‰åºé›†åˆä¸­ start-&amp;gt;end çš„ä¸‹æ ‡å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrevrange key start end &lt;span class="o">[&lt;/span>withscores&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®ç°æ–¹å¼-4">ğŸ¡ å®ç°æ–¹å¼&lt;/h3>
&lt;p>æœ‰åºé›†åˆ Zset åº•å±‚ä½¿ç”¨ ï¼ˆ1ï¼‰å‹ç¼©åˆ—è¡¨ æˆ– ï¼ˆ2ï¼‰è·³è¡¨ ä½œä¸ºæ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å‹ç¼©åˆ—è¡¨ï¼šæœ‰åºé›†åˆä¸­å…ƒç´ å°äº 128 ä¸ªï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äº 64 å­—èŠ‚æ—¶ï¼Œä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·³è¡¨ï¼šä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œä½¿ç”¨è°ƒè¡¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-4">ğŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ğŸ“ æ’è¡Œæ¦œ&lt;/li>
&lt;/ul>
&lt;p>ä¾‹å¦‚æ¸¸æˆç§¯åˆ†æ’è¡Œæ¦œï¼Œè§†é¢‘æ’­æ”¾æ’åï¼Œç”µå•†ç³»ç»Ÿä¸­å•†å“çš„é”€é‡æ’åã€‚&lt;/p>
&lt;p>key-&amp;gt;æ’è¡Œæ¦œçš„ç±»å‹ï¼›member-&amp;gt;éœ€æ’è¡Œçš„å†…å®¹ï¼ˆå¦‚æ–‡ç« idï¼‰ï¼›score-&amp;gt;ç‚¹å‡»æ•°ã€ç‚¹èµæ•°ç­‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># emery å‘çš„id=1çš„æ–‡ç« è·å¾—äº† 200 ä¸ªèµ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zadd user:emery:ranking &lt;span class="m">200&lt;/span> arcticle:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç»™æ–‡ç«  1 ç‚¹èµ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zincrby user:emery:ranking &lt;span class="m">1&lt;/span> article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹æŸç¯‡æ–‡ç« çš„ç‚¹èµæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zscore user:emery:ranking article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹ç‚¹èµæ•°æœ€å¤šçš„ 3 ç¯‡æ–‡ç« &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrevrange user:emery:ranking &lt;span class="m">0&lt;/span> &lt;span class="m">2&lt;/span> withscores
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å– 100 èµåˆ° 200 èµçš„æ–‡ç« &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrangebysocre user:emery:ranking &lt;span class="m">100&lt;/span> &lt;span class="m">200&lt;/span> withscores
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ“ å»¶æ—¶é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;p>åˆ©ç”¨ score å­˜å‚¨å»¶æ—¶æ‰§è¡Œçš„æ—¶é—´ï¼Œä½¿ç”¨ zrangebysocre æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œå†è¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="-å‚è€ƒ">ğŸ”— å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://xiaolincoding.com/redis/data_struct/command.html" target="_blank" rel="noopener"
>https://xiaolincoding.com/redis/data_struct/command.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”</title><link>https://blog.letout.cn/p/distributed-lock/redis/</link><pubDate>Wed, 11 May 2022 12:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/distributed-lock/redis/</guid><description>&lt;img src="https://blog.letout.cn/imgs/1.jpeg" alt="Featured image of post ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”" />&lt;h2 id="redis-nx-å®ç°">Redis NX å®ç°&lt;/h2>
&lt;p>åˆ©ç”¨ NX çš„&lt;strong>åŸå­æ€§&lt;/strong>ï¼Œå¤šä¸ªçº¿ç¨‹å¹¶å‘æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¾ç½®æˆåŠŸï¼Œè®¾ç½®æˆåŠŸå³è·å–äº†é”ã€‚&lt;/p>
&lt;p>&lt;strong>å¦‚æœæ²¡æœ‰è·å–é”ï¼Œä¸ä¼šé˜»å¡å½“å‰æ–¹æ³•ï¼Œç›´æ¥è·³è¿‡ä»»åŠ¡ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="è·å–é”">è·å–é”&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set key unique_value NX PX 30000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> product:stock:clothes UUID NX PX &lt;span class="m">30000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>key
&lt;ul>
&lt;li>æ ¹æ®ä¸åŒçš„ä¸šåŠ¡ï¼ŒåŒºåˆ†ä¸åŒçš„é”&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>unique_value
&lt;ul>
&lt;li>ä¿è¯æ¯ä¸ªçº¿ç¨‹çš„éšæœºå€¼éƒ½ä¸åŒï¼Œç”¨äºé‡Šæ”¾é”æ—¶çš„æ ¡éªŒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>NX
&lt;ul>
&lt;li>key ä¸å­˜åœ¨æ—¶è®¾ç½®æˆåŠŸï¼Œkey å­˜åœ¨åˆ™ä¸æˆåŠŸ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>PX
&lt;ul>
&lt;li>è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ã€‚è‹¥å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå¯ä»¥ä¿è¯è¶…æ—¶åï¼Œé”å¯ä»¥è¿‡æœŸå¤±æ•ˆï¼ˆæ¯«ç§’ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="é‡Šæ”¾é”">é‡Šæ”¾é”&lt;/h3>
&lt;p>é‡Šæ”¾é”å°†è¯¥ key åˆ é™¤ï¼Œåœ¨é‡Šæ”¾é”ä¹‹å‰éœ€è¦æ ¡éªŒè®¾ç½®çš„éšæœºæ•°ï¼Œç›¸åŒæ‰è¡¨ç¤ºæ˜¯è¯¥çº¿ç¨‹åŠ çš„é”ï¼Œèƒ½é‡Šæ”¾ã€‚&lt;/p>
&lt;p>éœ€è¦é‡‡ç”¨ LUA è„šæœ¬ï¼Œdel å‘½ä»¤æ²¡æœ‰æä¾›æ ¡éªŒå€¼çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>redis æ‰§è¡Œå‘½ä»¤æ˜¯æŒ‰ç…§ä¸€æ¡æŒ‡ä»¤å®Œæˆä¹‹åï¼Œå†æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œç”¨ lua è„šæœ¬ï¼Œèƒ½ä¿è¯ redis æ‰§è¡Œå®Œè¿™ä¸ªè„šæœ¬æ‰æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œæ‰€ä»¥èƒ½ä¿è¯åˆ¤æ–­ å’Œ åˆ é™¤æ˜¯åŸå­æ€§çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">if&lt;/span> &lt;span class="n">redis.call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;get&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">KEYS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">ARGV&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="kr">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="n">redis.call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;del&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">KEYS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å®ç°">å®ç°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedisLockController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/redisLock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">redisLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è·å–åˆ†å¸ƒå¼é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">RedisCallback&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;)&lt;/span> &lt;span class="n">redisConnection&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Expiration&lt;/span> &lt;span class="n">expiration&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Expiration&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">seconds&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// NX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span> &lt;span class="n">setOption&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ifAbsent&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// éœ€è¦ä½¿ç”¨ redisTemplate ä¸­çš„åºåˆ—åŒ–å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKeySerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisValue&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValueSerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">redisConnection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisKey&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">redisValue&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">expiration&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// è·å–åˆ°äº†é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;è·å–åˆ°äº†é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;if redis.call(\&amp;#34;get\&amp;#34;,KEYS[1])==ARGV[1] then\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn redis.call(\&amp;#34;del\&amp;#34;,KEYS[1])\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;else\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn 0\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;end&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">redisScript&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">of&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Boolean&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisScript&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é‡Šæ”¾é” {}&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ä¸šåŠ¡å®Œæˆ&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;success&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedisLock&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”åç§°ï¼Œä¸åŒä¸šåŠ¡å¯èƒ½é”ä¸åŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">RedisLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">redisTemplate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">expireTime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// value å¯ä»¥ä¸æš´éœ²å‡ºå»ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ä¸ä¸€æ ·çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">UUID&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">randomUUID&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * è·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">getLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è·å–åˆ†å¸ƒå¼é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">RedisCallback&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;)&lt;/span> &lt;span class="n">redisConnection&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Expiration&lt;/span> &lt;span class="n">expiration&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Expiration&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">seconds&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">expireTime&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// NX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span> &lt;span class="n">setOption&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ifAbsent&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç”±äºè¿™é‡Œéœ€è¦æ¥å— byte, ä¸èƒ½æš´åŠ›çš„ä½¿ç”¨ string.getBytes()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// è¦ä½¿ç”¨æ¨¡æ¿é‡Œé¢çš„ key\value åºåˆ—åŒ–å™¨æ¥å®ç°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKeySerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisValue&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValueSerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisConnection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisKey&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">redisValue&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">expiration&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">setOption&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * é‡Šæ”¾é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">unLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// lua è„šæœ¬
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;if redis.call(\&amp;#34;get\&amp;#34;,KEYS[1])==ARGV[1] then\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn redis.call(\&amp;#34;del\&amp;#34;,KEYS[1])\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;else\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn 0\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;end&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">redisScript&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">of&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Boolean&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisScript&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="redisson">Redisson&lt;/h2>
&lt;h3 id="ä¾èµ–é…ç½®">ä¾èµ–é…ç½®&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.redisson&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>redisson-spring-boot-starter&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>3.16.7&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®ç°-1">å®ç°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedissonLockController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedissonClient&lt;/span> &lt;span class="n">redissonClient&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/redissonLock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">redissonLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;æ‰§è¡Œæ–¹æ³•&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;redisson&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redissonClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœæœªè·å¾—é”ï¼Œä¼šé˜»å¡ç­‰å¾…è·å–åˆ°é”ï¼ˆ-1 è¡¨ç¤ºæ²¡æœ‰è¶…æ—¶æ—¶é—´ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;è·å–é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é‡Šæ”¾é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®Œæˆä¸šåŠ¡&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;success&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>