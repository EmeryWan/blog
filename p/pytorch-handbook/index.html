<!doctype html><html lang dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="PyTorch æ˜¯ä»€ä¹ˆï¼Ÿ åŸºäº Python çš„ç§‘å­¦è®¡ç®—åŒ…ï¼ŒæœåŠ¡äºä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼š Numpy çš„æ›¿ä»£å“ï¼Œå¯ä»¥ä½¿ç”¨ GPU çš„å¼ºå¤§è®¡ç®—åŠ› æä¾›æœ€å¤§çš„çµæ´»æ€§å’Œé«˜é€Ÿçš„æ·±åº¦å­¦ä¹ ç ”ç©¶å¹³å° Tensors Tensors ä¸ Numpy ä¸­çš„ ndarrays ç±»"><title>PyTorch ç«é€Ÿä¸Šæ‰‹</title><link rel=canonical href=https://emerywan.github.io/blog/p/pytorch-handbook/><link rel=stylesheet href=/blog/scss/style.min.9fdfe1d69c4486d1a84c3c7b288ce74b0111a02a60a6c12f21c6b7cc02b131b4.css><meta property="og:title" content="PyTorch ç«é€Ÿä¸Šæ‰‹"><meta property="og:description" content="PyTorch æ˜¯ä»€ä¹ˆï¼Ÿ åŸºäº Python çš„ç§‘å­¦è®¡ç®—åŒ…ï¼ŒæœåŠ¡äºä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼š Numpy çš„æ›¿ä»£å“ï¼Œå¯ä»¥ä½¿ç”¨ GPU çš„å¼ºå¤§è®¡ç®—åŠ› æä¾›æœ€å¤§çš„çµæ´»æ€§å’Œé«˜é€Ÿçš„æ·±åº¦å­¦ä¹ ç ”ç©¶å¹³å° Tensors Tensors ä¸ Numpy ä¸­çš„ ndarrays ç±»"><meta property="og:url" content="https://emerywan.github.io/blog/p/pytorch-handbook/"><meta property="og:site_name" content="ä¸€å±‚"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="æ·±åº¦å­¦ä¹ "><meta property="article:tag" content="PyTorch"><meta property="article:published_time" content="2021-04-01T21:14:45+08:00"><meta property="article:modified_time" content="2021-04-01T21:14:45+08:00"><meta property="og:image" content="https://emerywan.github.io/blog/imgs/10.jpeg"><meta name=twitter:title content="PyTorch ç«é€Ÿä¸Šæ‰‹"><meta name=twitter:description content="PyTorch æ˜¯ä»€ä¹ˆï¼Ÿ åŸºäº Python çš„ç§‘å­¦è®¡ç®—åŒ…ï¼ŒæœåŠ¡äºä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼š Numpy çš„æ›¿ä»£å“ï¼Œå¯ä»¥ä½¿ç”¨ GPU çš„å¼ºå¤§è®¡ç®—åŠ› æä¾›æœ€å¤§çš„çµæ´»æ€§å’Œé«˜é€Ÿçš„æ·±åº¦å­¦ä¹ ç ”ç©¶å¹³å° Tensors Tensors ä¸ Numpy ä¸­çš„ ndarrays ç±»"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://emerywan.github.io/blog/imgs/10.jpeg"><link rel="shortcut icon" href=https://emerywan.github.io/blog/imgs/favicon.ico><link rel=preconnect href=https://fonts.proxy.ustclug.org><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.proxy.ustclug.org/css2?family=Noto+Sans+SC&family=Roboto&family=Roboto+Mono&display=swap" rel=stylesheet><style>:root{--sys-font-family:-apple-system, BlinkMacSystemFont, "Roboto", "Noto Sans SC", "Segoe UI", "Droid Sans", "Helvetica Neue", Ubuntu;--zh-font-family:-apple-system, BlinkMacSystemFont, "Roboto", "Noto Sans SC",  "PingFang SC", "Hiragino Sans GB", "Droid Sans Fallback", Ubuntu, "Microsoft YaHei";--code-font-family:"SF Mono", SFMono-Regular, "Roboto Mono", "Ubuntu Mono", Menlo, Monaco, Consolas, "Courier New", monospace;--base-font-family:-apple-system, BlinkMacSystemFont, "Roboto", "Noto Sans SC", var(--sys-font-family), var(--zh-font-family), sans-serif;--article-font-family:-apple-system, BlinkMacSystemFont, "Roboto", "Noto Sans SC", var(--base-font-family);--article-line-height:1.6;--article-font-size:1.6rem}</style></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/blog><img src=/blog/img/avatar_hud10ed4afecf1b63b1391b35c2778f738_36574_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/blog>ä¸€å±‚</a></h1><h2 class=site-description>è¿ç€è¿™å²æœˆçš„é£ã€‚</h2></div></header><ol class=social-menu><li><a href=https://github.com/emerywan target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://emery.letout.cn target=_blank title=Home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-smart-home" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 8.71l-5.333-4.148a2.666 2.666.0 00-3.274.0L5.059 8.71A2.665 2.665.0 004.03 10.815v7.2a2 2 0 002 2h12a2 2 0 002-2v-7.2c0-.823-.38-1.6-1.03-2.105"/><path d="M16 15c-2.21 1.333-5.792 1.333-8 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/blog/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>é¦–é¡µ</span></a></li><li><a href=/blog/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>å…³äº</span></a></li><li><a href=/blog/categories/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg><span>åˆ†ç±»</span></a></li><li><a href=/blog/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>å½’æ¡£</span></a></li><li><a href=/blog/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>æœç´¢</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>ğŸŒ— Dark</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/blog/p/pytorch-handbook/><img src=/blog/imgs/10.jpeg loading=lazy alt="Featured image of post PyTorch ç«é€Ÿä¸Šæ‰‹"></a></div><div class=article-details><header class=article-category><a href=/blog/categories/%E6%8A%80%E6%9C%AF/ style=background-color:#91d5ff;color:#fff>æŠ€æœ¯</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/blog/p/pytorch-handbook/>PyTorch ç«é€Ÿä¸Šæ‰‹</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>04 - 01, 2021</time></div></footer></div></header><section class=article-content><h2 id=pytorch-æ˜¯ä»€ä¹ˆ>PyTorch æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>åŸºäº Python çš„ç§‘å­¦è®¡ç®—åŒ…ï¼ŒæœåŠ¡äºä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼š</p><ul><li>Numpy çš„æ›¿ä»£å“ï¼Œå¯ä»¥ä½¿ç”¨ GPU çš„å¼ºå¤§è®¡ç®—åŠ›</li><li>æä¾›æœ€å¤§çš„çµæ´»æ€§å’Œé«˜é€Ÿçš„æ·±åº¦å­¦ä¹ ç ”ç©¶å¹³å°</li></ul><h2 id=tensors>Tensors</h2><p>Tensors ä¸ Numpy ä¸­çš„ ndarrays ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ PyTorch ä¸­ Tensors å¯ä»¥ä½¿ç”¨ GPU è¿›è¡Œè®¡ç®—ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>__future__</span> <span class=kn>import</span> <span class=n>print_function</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 1 ] åˆ›å»ºä¸€ä¸ª 5x3 çš„çŸ©é˜µï¼Œä½†ä¸åˆå§‹åŒ–ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>empty</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([[0.0000, 0.0000, 0.0000],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0.0000, 0.0000, 0.0000],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0.0000, 0.0000, 0.0000],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0.0000, 0.0000, 0.0000],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0.0000, 0.0000, 0.0000]])</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 2 ] åˆ›å»ºä¸€ä¸ªéšæœºåˆå§‹åŒ–çš„çŸ©ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([[0.6972, 0.0231, 0.3087],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0.2083, 0.6141, 0.6896],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0.7228, 0.9715, 0.5304],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0.7727, 0.1621, 0.9777],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0.6526, 0.6170, 0.2605]])</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 3 ] åˆ›å»ºä¸€ä¸ª 0 å¡«å……çš„çŸ©é˜µï¼Œæ•°æ®ç±»å‹ä¸º longï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>zero</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>torch</span><span class=o>.</span><span class=n>long</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([[0, 0, 0],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0, 0, 0],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0, 0, 0],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0, 0, 0],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [0, 0, 0]])</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 4 ] åˆ›å»ºä¸€ä¸ª tensor ä½¿ç”¨ç°æœ‰æ•°æ®åˆå§‹åŒ–ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>tensor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mf>5.5</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([5.5000, 3.0000])</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 5 ] æ ¹æ®ç°æœ‰çš„ tensor åˆ›å»º tensorã€‚è¿™äº›æ–¹æ³•å°†é‡ç”¨è¾“å…¥ tensor çš„å±æ€§ï¼ˆå¦‚ï¼šdtypeï¼Œé™¤éè®¾ç½®æ–°çš„å€¼è¿›è¡Œè¦†ç›–ï¼‰ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># åˆ©ç”¨ new_* æ–¹æ³•åˆ›å»ºå¯¹è±¡</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>new_ones</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>torch</span><span class=o>.</span><span class=n>double</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([[1., 1., 1.],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [1., 1., 1.],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [1., 1., 1.],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [1., 1., 1.],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [1., 1., 1.]], dtype=torch.float64)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¦†ç›– dtype</span>
</span></span><span class=line><span class=cl><span class=c1># å¯¹è±¡ size ç›¸åŒï¼Œåªæ˜¯ å€¼å’Œç±»å‹ å‘ç”Ÿå˜åŒ–</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([[ 0.5691, -2.0126, -0.4064],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [-0.0863,  0.4692, -1.1209],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [-1.1177, -0.5764, -0.5363],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [-0.4390,  0.6688,  0.0889],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [ 1.3334, -1.1600,  1.8457]])</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 6 ] è·å– sizeï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>size</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=c1># torch.Size([5, 3])</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Tip:</p><p><code>torch.Size</code> è¿”å› <code>tuple</code> ç±»å‹ï¼Œæ”¯æŒ <code>tuple</code> ç±»å‹æ‰€æœ‰çš„æ“ä½œã€‚</p></blockquote><p>[ 7 ] æ“ä½œ</p><p>[ 7.1 ] åŠ æ³•ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([[ 0.7808, -1.4388,  0.3151],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [-0.0076,  1.0716, -0.8465],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [-0.8175,  0.3625, -0.2005],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [ 0.2435,  0.8512,  0.7142],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [ 1.4737, -0.8545,  2.4833]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([[ 0.7808, -1.4388,  0.3151],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [-0.0076,  1.0716, -0.8465],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [-0.8175,  0.3625, -0.2005],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [ 0.2435,  0.8512,  0.7142],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [ 1.4737, -0.8545,  2.4833]])</span>
</span></span></code></pre></td></tr></table></div></div><p>æä¾›è¾“å‡º tensor ä½œä¸ºå‚æ•°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>empty</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>out</span><span class=o>=</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([[ 0.7808, -1.4388,  0.3151],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [-0.0076,  1.0716, -0.8465],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [-0.8175,  0.3625, -0.2005],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [ 0.2435,  0.8512,  0.7142],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [ 1.4737, -0.8545,  2.4833]])</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 7.2 ] æ›¿æ¢ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># add x to y</span>
</span></span><span class=line><span class=cl><span class=n>y</span><span class=o>.</span><span class=n>add_</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([[ 0.7808, -1.4388,  0.3151],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [-0.0076,  1.0716, -0.8465],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [-0.8175,  0.3625, -0.2005],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [ 0.2435,  0.8512,  0.7142],</span>
</span></span><span class=line><span class=cl><span class=c1>#         [ 1.4737, -0.8545,  2.4833]])</span>
</span></span></code></pre></td></tr></table></div></div><p>{% note info %}
<code>_</code> ç»“å°¾çš„æ“ä½œä¼šæ›¿æ¢åŸå˜é‡ã€‚
å¦‚ï¼š<code>x_copy_(y)</code>ï¼Œ<code>x.t_()</code> ä¼šæ”¹å˜ <code>x</code>
{% endnote %}</p><p>[ 7.3 ] ä½¿ç”¨ Numpy ä¸­ç´¢å¼•æ–¹å¼ï¼Œå¯¹ tensor è¿›è¡Œæ“ä½œï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([-2.0126,  0.4692, -0.5764,  0.6688, -1.1600])</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 8 ] <code>torch.view</code> æ”¹å˜ tensor çš„ç»´åº¦å’Œå¤§å° ï¼ˆä¸ Numpy ä¸­ reshape ç±»ä¼¼ï¼‰ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>view</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>z</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>view</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>  <span class=c1># -1 ä»å…¶ä»–ç»´åº¦æ¨æ–­</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>size</span><span class=p>(),</span> <span class=n>y</span><span class=o>.</span><span class=n>size</span><span class=p>(),</span> <span class=n>z</span><span class=o>.</span><span class=n>size</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=c1># torch.Size([4, 4]) torch.Size([16]) torch.Size([2, 8])</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 9 ] å¦‚æœåªæœ‰ä¸€ä¸ªå…ƒç´ çš„ tensorï¼Œä½¿ç”¨ <code>item()</code> è·å– Python æ•°æ®ç±»å‹çš„æ•°å€¼ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>item</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([-0.2368])</span>
</span></span><span class=line><span class=cl><span class=c1># -0.23680149018764496</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=numpy-è½¬æ¢>Numpy è½¬æ¢</h3><p>Torch Tensor ä¸ Numpy æ•°ç»„ä¹‹é—´è¿›è¡Œè½¬æ¢éå¸¸è½»æ¾ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>ones</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>a</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>  <span class=c1># tensor([1., 1., 1., 1., 1.])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>  <span class=c1># [1. 1. 1. 1. 1.]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Torch Tensor ä¸ Numpy æ•°ç»„å…±äº«åº•å±‚å†…å­˜åœ°å€ï¼Œä¿®æ”¹ä¸€ä¸ªä¼šå¯¼è‡´å¦ä¸€ä¸ªçš„å˜åŒ–ã€‚</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span><span class=o>.</span><span class=n>add_</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>  <span class=c1># tensor([2., 2., 2., 2., 2.])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>  <span class=c1># [2. 2. 2. 2. 2.]</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>from_numpy</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>out</span><span class=o>=</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>  <span class=c1># [2. 2. 2. 2. 2.]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>  <span class=c1># tensor([2., 2., 2., 2., 2.], dtype=torch.float64)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Tip:</p><p>æ‰€æœ‰çš„ Tensor ç±»å‹é»˜è®¤éƒ½æ˜¯åŸºäº CPUï¼Œ CharTensor ç±»å‹ä¸æ”¯æŒåˆ° Numpy çš„è£…æ¢ã€‚</p></blockquote><h3 id=cuda-å¼ é‡>CUDA å¼ é‡</h3><p>ä½¿ç”¨ <code>.to()</code> å¯ä»¥å°† Tensor ç§»åŠ¨åˆ°ä»»ä½•è®¾å¤‡ä¸­ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>is_available</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>device</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>device</span><span class=p>(</span><span class=s1>&#39;cuda&#39;</span><span class=p>)</span>  <span class=c1># CUDA è®¾å¤‡å¯¹è±¡</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>ones_like</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>device</span><span class=o>=</span><span class=n>device</span><span class=p>)</span>  <span class=c1># ç›´æ¥ä» GPU åˆ›å»ºå¼ é‡</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>z</span> <span class=o>=</span> <span class=n>x</span> <span class=o>+</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>  <span class=c1># tensor([0.7632], device=&#39;cuda:0&#39;)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>z</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=s1>&#39;cpu&#39;</span><span class=p>,</span> <span class=n>torch</span><span class=o>.</span><span class=n>double</span><span class=p>))</span>  <span class=c1># tensor([0.7632], dtype=torch.float64)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=autograd-è‡ªåŠ¨æ±‚å¯¼>Autograd è‡ªåŠ¨æ±‚å¯¼</h2><p>autograd åŒ…ä¸º Tensor ä¸Šæ‰€æœ‰çš„æ“ä½œæä¾›äº†è‡ªåŠ¨æ±‚å¯¼ã€‚å®ƒæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å®šä¹‰çš„æ¡†æ¶ï¼Œè¿™æ„å‘³ç€åå‘ä¼ æ’­æ˜¯æ ¹æ®ä½ çš„ä»£ç æ¥ç¡®å®šå¦‚ä½•è¿è¡Œï¼Œå¹¶ä¸”æ¯æ¬¡è¿­ä»£å¯ä»¥æ˜¯ä¸åŒçš„ã€‚</p><h3 id=æ­£å‘ä¼ æ’­-åå‘ä¼ æ’­>æ­£å‘ä¼ æ’­ åå‘ä¼ æ’­</h3><p>ç¥ç»ç½‘ç»œï¼ˆNNï¼‰æ˜¯åœ¨æŸäº›è¾“å…¥æ•°æ®ä¸Šæ‰§è¡ŒåµŒå¥—å‡½æ•°çš„é›†åˆã€‚
è¿™äº›å‡½æ•°ç”±å‚æ•°ï¼ˆæƒé‡å’Œåå·®ç»„æˆï¼‰å®šä¹‰ï¼Œå‚æ•°åœ¨ PyTorch ä¸­å­˜å‚¨åœ¨å¼ é‡ä¸­ã€‚</p><p>è®­ç»ƒ NN åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li>æ­£å‘ä¼ æ’­ï¼šåœ¨æ­£å‘ä¼ æ’­ä¸­ï¼ŒNN å¯¹æ­£ç¡®çš„è¾“å‡ºè¿›è¡Œæœ€ä½³çŒœæµ‹ã€‚å®ƒé€šè¿‡æ¯ä¸ªå‡½æ•°è¿è¡Œè¾“å…¥æ•°æ®ä»¥è¿›è¡ŒçŒœæµ‹ã€‚</li><li>åå‘ä¼ æ’­ï¼šåœ¨åå‘ä¼ æ’­ä¸­ï¼ŒNN æ ¹æ®å…¶çŒœæµ‹ä¸­çš„è¯¯å·®è°ƒæ•´å…¶å‚æ•°ã€‚å®ƒé€šè¿‡ä»è¾“å‡ºå‘åéå†ï¼Œæ”¶é›†æœ‰å…³å‚æ•°ï¼ˆæ¢¯åº¦ï¼‰çš„è¯¯å·®å¯¼æ•°å¹¶ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ¥ä¼˜åŒ–å‚æ•°æ¥å®ç°ã€‚</li></ul><p>[ 1 ] æˆ‘ä»¬ä» torchvision åŠ è½½äº†ç»è¿‡é¢„è®­ç»ƒçš„ resnet18 æ¨¡å‹ã€‚åˆ›å»ºä¸€ä¸ªéšæœºæ•°æ®å¼ é‡æ¥è¡¨ç¤ºå…·æœ‰ 3 ä¸ªé€šé“çš„å•ä¸ªå›¾åƒï¼Œé«˜åº¦å’Œå®½åº¦ä¸º 64ï¼Œå…¶å¯¹åº”çš„labelåˆå§‹åŒ–ä¸ºä¸€äº›éšæœºå€¼ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span><span class=o>,</span> <span class=nn>torchvision</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>torchvision</span><span class=o>.</span><span class=n>models</span><span class=o>.</span><span class=n>resnet18</span><span class=p>(</span><span class=n>pretrained</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>labels</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 2 ] æ¥ä¸‹æ¥ï¼Œé€šè¿‡æ¨¡å‹çš„æ¯ä¸€å±‚è¿è¡Œè¾“å…¥æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚<strong>æ­£å‘ä¼ æ’­</strong>ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>prediction</span> <span class=o>=</span> <span class=n>model</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 3 ] ä½¿ç”¨æ¨¡å‹çš„é¢„æµ‹ï¼ˆpredicationï¼‰å’Œç›¸åº”çš„æ ‡ç­¾ï¼ˆlabelsï¼‰æ¥è®¡ç®—è¯¯å·®ï¼ˆlossï¼‰ã€‚
ä¸‹ä¸€æ­¥é€šè¿‡åå‘ä¼ æ’­æ­¤è¯¯å·®ã€‚æˆ‘ä»¬åœ¨ loss tensor ä¸Šè°ƒç”¨ <code>.backward()</code> æ—¶ï¼Œå¼€å§‹åå‘ä¼ æ’­ã€‚Autograd ä¼šä¸ºæ¯ä¸ªæ¨¡å‹å‚æ•°è®¡ç®—æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å‚æ•° <code>.grad</code> å±æ€§ä¸­ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>loss</span> <span class=o>=</span> <span class=p>(</span><span class=n>prediction</span> <span class=o>-</span> <span class=n>labels</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>loss</span><span class=o>.</span><span class=n>backword</span><span class=p>()</span>  <span class=c1># backword pass</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 4 ] æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ è½½ä¸€ä¸ªä¼˜åŒ–å™¨ï¼ˆSDGï¼‰ï¼Œå­¦ä¹ ç‡ä¸º 0.01ï¼ŒåŠ¨é‡ä¸º 0.9ã€‚åœ¨ optim ä¸­æ³¨å†Œæ¨¡å‹çš„æ‰€æœ‰å‚æ•°ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>optim</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>optim</span><span class=o>.</span><span class=n>SDG</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>parameters</span><span class=p>(),</span> <span class=n>lr</span><span class=o>=</span><span class=mf>1e-2</span><span class=p>,</span> <span class=n>momentum</span><span class=o>=</span><span class=mf>0.9</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>[ 5 ] æœ€åï¼Œè°ƒç”¨ <code>.step()</code> å¯åŠ¨æ¢¯åº¦ä¸‹é™ã€‚ä¼˜åŒ–å™¨é€šè¿‡ <code>.grad</code> ä¸­å­˜å‚¨çš„æ¢¯åº¦æ¥è°ƒæ•´æ¯ä¸ªå‚æ•°ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>optim</span><span class=o>.</span><span class=n>step</span><span class=p>()</span>  <span class=c1># gradient descent</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ç¥ç»ç½‘ç»œçš„å¾®åˆ†>ç¥ç»ç½‘ç»œçš„å¾®åˆ†</h3><p>è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ autograd å¦‚ä½•æ”¶é›†æ¢¯åº¦ã€‚
æˆ‘ä»¬åœ¨åˆ›å»º Tensor æ—¶ï¼Œä½¿ç”¨ <code>requires_grad=True</code> å‚æ•°ï¼Œè¡¨ç¤ºå°†è·Ÿè¸ª Tensor çš„æ‰€æœ‰æ“ä½œã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>tensor</span><span class=p>([</span><span class=mf>2.</span><span class=p>,</span> <span class=mf>3.</span><span class=p>],</span> <span class=n>require_grad</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>tensor</span><span class=p>([</span><span class=mf>6.</span><span class=p>,</span> <span class=mf>4.</span><span class=p>],</span> <span class=n>require_grad</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä» tensor a, b åˆ›å»ºå¦ä¸€ä¸ª tensor Q</span>
</span></span><span class=line><span class=cl><span class=n>Q</span> <span class=o>=</span> <span class=mi>3</span><span class=o>*</span><span class=n>a</span><span class=o>**</span><span class=mi>3</span> <span class=o>-</span> <span class=n>b</span><span class=o>**</span><span class=mi>2</span>
</span></span></code></pre></td></tr></table></div></div><p>å‡è®¾ tensor aï¼Œb æ˜¯ç¥ç»ç½‘ç»œçš„å‚æ•°ï¼Œtensor Q æ˜¯è¯¯å·®ã€‚åœ¨ NN è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬æƒ³è¦è·å¾—ç›¸å¯¹äºå‚æ•°çš„è¯¯å·®ï¼Œå³å„è‡ªå¯¹åº”çš„åå¯¼ï¼š</p><p>$$\frac{\partial Q}{\partial a}=9a^2$$</p><p>å½“æˆ‘ä»¬åœ¨ tensor Q ä¸Šè°ƒç”¨ <code>.backward()</code> æ—¶ï¼ŒAutograd å°†è®¡ç®—è¿™äº›æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å„ä¸ªå¼ é‡çš„ <code>.grad</code> å±æ€§ä¸­ã€‚</p><p>æˆ‘ä»¬éœ€è¦åœ¨ <code>Q.backword()</code> ä¸­æ˜¾å¼ä¼ é€’ <code>gradient</code> å‚æ•°ï¼ˆä¸ Q å½¢çŠ¶ç›¸åŒçš„å¼ é‡ï¼Œè¡¨ç¤º Q ç›¸å¯¹æœ¬èº«çš„æ¢¯åº¦ï¼‰ã€‚</p><p>$$\frac{\partial Q}{\partial b}=-2b$$</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>external_grad</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>tensor</span><span class=p>([</span><span class=mf>1.</span><span class=p>,</span> <span class=mf>1.</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>Q</span><span class=o>.</span><span class=n>backward</span><span class=p>(</span><span class=n>gradient</span><span class=o>=</span><span class=n>external_grad</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æœ€åï¼Œæ¢¯åº¦è®°å½•åœ¨ a.grad b.grad ä¸­ï¼ŒæŸ¥çœ‹æ”¶é›†çš„æ¢¯åº¦æ˜¯å¦æ­£ç¡®</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=mi>9</span><span class=o>*</span><span class=n>a</span><span class=o>**</span><span class=mi>2</span> <span class=o>==</span> <span class=n>a</span><span class=o>.</span><span class=n>grad</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([True, True])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=o>*</span><span class=n>b</span> <span class=o>==</span> <span class=n>b</span><span class=o>.</span><span class=n>grad</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([True, True])</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°† Q èšåˆä¸ºä¸€ä¸ªæ ‡é‡ï¼Œç„¶åéšå¼åœ°å‘åè°ƒç”¨ï¼Œå¦‚ï¼š<code>Q.sum().backward()</code>ã€‚</p><h2 id=ç¥ç»ç½‘ç»œ>ç¥ç»ç½‘ç»œ</h2><p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬äº†è§£åˆ° nn åŒ…ä¾èµ– autograd åŒ…æ¥å®šä¹‰æ¨¡å‹å¹¶æ±‚å¯¼ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•å®šä¹‰ä¸€ä¸ªç½‘ç»œã€‚ä¸€ä¸ª nn.Module åŒ…å«ä¸ª layer å’Œä¸€ä¸ª forward(input) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å› outputã€‚</p><p>å¦‚ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹æ‰‹å†™æ•°å­—å›¾åƒè¿›è¡Œåˆ†ç±»çš„å·ç§¯ç¥ç»ç½‘ç»œï¼š</p><p><img src=/blog/p/pytorch-handbook/CNN.png width=759 height=209 srcset="/blog/p/pytorch-handbook/CNN_hufa4266fb90da2cc9816f33e05e560204_9416_480x0_resize_box_3.png 480w, /blog/p/pytorch-handbook/CNN_hufa4266fb90da2cc9816f33e05e560204_9416_1024x0_resize_box_3.png 1024w" loading=lazy alt=CNN class=gallery-image data-flex-grow=363 data-flex-basis=871px></p><p>ç¥ç»ç½‘ç»œçš„å…¸å‹è®­ç»ƒè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å®šä¹‰åŒ…å«ä¸€äº›å¯å­¦ä¹ çš„å‚æ•°ï¼ˆæƒé‡ï¼‰ç¥ç»ç½‘ç»œæ¨¡å‹</li><li>åœ¨æ•°æ®é›†ä¸Šè¿­ä»£</li><li>é€šè¿‡ç¥ç»ç½‘ç»œå¤„ç†è¾“å…¥</li><li>è®¡ç®—æŸå¤±ï¼ˆè¾“å‡ºç»“æœå’Œæ­£ç¡®å€¼çš„å·®å€¼å¤§å°ï¼‰</li><li>å°†æ¢¯åº¦åå‘ä¼ æ’­å›ç½‘ç»œçš„å‚æ•°</li><li>æ›´æ–°ç½‘ç»œçš„å‚æ•°ï¼ˆæ¢¯åº¦ä¸‹é™ï¼‰ï¼šweight = weight - learning_rate * gradient</li></ul><h3 id=å®šä¹‰ç½‘ç»œ>å®šä¹‰ç½‘ç»œ</h3><p>åœ¨æ¨¡å‹ä¸­å¿…é¡»å®šä¹‰ <code>forward()</code>ï¼Œ <code>backword</code>ï¼ˆç”¨æ¥è®¡ç®—æ¢¯åº¦ï¼‰ä¼šè¢« autograd è‡ªåŠ¨åˆ›å»ºã€‚å¯åœ¨ <code>forward()</code> ä¸­ä½¿ç”¨ä»»ä½•é’ˆå¯¹ Tensor çš„æ“ä½œã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch.nn</span> <span class=k>as</span> <span class=nn>nn</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch.nn.functional</span> <span class=k>as</span> <span class=nn>F</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Net</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>(</span><span class=n>Net</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># 1 input image channel, 6 output channels, 3x3 square convolution</span>
</span></span><span class=line><span class=cl>        <span class=c1># kernel</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>conv_1</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>conv_2</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># an affine operation: y = Wx + b</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fc1</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>(</span><span class=mi>16</span> <span class=o>*</span> <span class=mi>6</span> <span class=o>*</span><span class=mi>6</span><span class=p>,</span> <span class=mi>120</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fc2</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>(</span><span class=mi>120</span><span class=p>,</span> <span class=mi>84</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fc3</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>(</span><span class=mi>84</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Max Pooling over a (2, 2) window</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>F</span><span class=o>.</span><span class=n>max_pool2d</span><span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>relu</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>conv1</span><span class=p>(</span><span class=n>x</span><span class=p>)),</span> <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># If the size is a square you can only specify a single number</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>F</span><span class=o>.</span><span class=n>max_pool2d</span><span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>relu</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>conv2</span><span class=p>(</span><span class=n>x</span><span class=p>)),</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>view</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_flat_features</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>F</span><span class=o>.</span><span class=n>relu</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>fc1</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>F</span><span class=o>.</span><span class=n>relu</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>fc2</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>fc3</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>num_flat_features</span><span class=p>(</span><span class=n>sefl</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>size</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>size</span><span class=p>()[</span><span class=mi>1</span><span class=p>:</span> <span class=p>]</span>  <span class=c1># all dimensions except the batch dimension</span>
</span></span><span class=line><span class=cl>        <span class=n>num_features</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>size</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>num_features</span> <span class=o>*=</span> <span class=n>s</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>num_features</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>net</span> <span class=o>=</span> <span class=n>Net</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>net</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># Net(</span>
</span></span><span class=line><span class=cl><span class=c1>#   (conv1): Conv2d(1, 6, kernel_size=(3, 3), stride=(1, 1))</span>
</span></span><span class=line><span class=cl><span class=c1>#   (conv2): Conv2d(6, 16, kernel_size=(3, 3), stride=(1, 1))</span>
</span></span><span class=line><span class=cl><span class=c1>#   (fc1): Linear(in_features=576, out_features=120, bias=True)</span>
</span></span><span class=line><span class=cl><span class=c1>#   (fc2): Linear(in_features=120, out_features=84, bias=True)</span>
</span></span><span class=line><span class=cl><span class=c1>#   (fc3): Linear(in_features=84, out_features=10, bias=True)</span>
</span></span><span class=line><span class=cl><span class=c1># )</span>
</span></span></code></pre></td></tr></table></div></div><p><code>parameters()</code> è¿”å›å¯è¢«å­¦ä¹ çš„å‚æ•°ï¼ˆæƒé‡ï¼‰åˆ—è¡¨å’Œå€¼</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>params</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>net</span><span class=o>.</span><span class=n>parameters</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>params</span><span class=p>))</span>  <span class=c1># 10</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>params</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>size</span><span class=p>())</span>  <span class=c1># conv1 çš„ weight  torch.Size([6, 1, 3, 3])</span>
</span></span></code></pre></td></tr></table></div></div><p>æµ‹è¯•éšæœºè¾“å…¥ 32x32ã€‚æ³¨ï¼šè¿™ä¸ªç½‘ç»œï¼ˆLeNetï¼‰çš„æœŸæœ›çš„è¾“å…¥å¤§å°æ˜¯ 32x32ï¼Œå¦‚æœä½¿ç”¨ MINIST æ•°æ®é›†æ¥è®­ç»ƒè¿™ä¸ªç½‘ç»œï¼Œè¯·æŠŠå›¾ç‰‡å¤§å°é‡æ–°è°ƒæ•´åˆ° 32x32ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>input</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>out</span> <span class=o>=</span> <span class=n>net</span><span class=p>(</span><span class=nb>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>out</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># tensor([[ 0.1120,  0.0713,  0.1014, -0.0696, -0.1210,  0.0084, -0.0206,  0.1366,</span>
</span></span><span class=line><span class=cl><span class=c1>#          -0.0455, -0.0036]], grad_fn=&lt;AddmmBackward&gt;)</span>
</span></span></code></pre></td></tr></table></div></div><p>å°†æ‰€æœ‰çš„å‚æ•°çš„æ¢¯åº¦ç¼“å­˜æ¸…é›¶ï¼Œè¿›è¡Œéšæœºæ¢¯åº¦çš„åå‘ä¼ æ’­ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>net</span><span class=o>.</span><span class=n>zero_grad</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>out</span><span class=o>.</span><span class=n>backward</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Tip:</p><p><code>torch.nn</code> ä»…æ”¯æŒå°æ‰¹é‡è¾“å…¥ã€‚æ•´ä¸ª <code>torch.nn</code> åŒ…éƒ½åªæ”¯æŒå°æ‰¹é‡æ ·æœ¬ï¼Œè€Œä¸æ”¯æŒå•ä¸ªæ ·æœ¬ã€‚
å¦‚ï¼š<code>nn.Conv2d</code>æ¥å—ä¸€ä¸ª4ç»´ Tensorï¼Œåˆ†åˆ«ç»´ sSamples * nChannels * Height * Width ï¼ˆæ ·æœ¬æ•°* é€šé“æ•° * é«˜ * å®½ï¼‰ã€‚å¦‚æœä½ æœ‰å•ä¸ªæ ·æœ¬ï¼Œåªéœ€è¦ä½¿ç”¨ <code>input.unsqueeze(0)</code> æ¥æ·»åŠ å…¶ä»–çš„ç»´æ•°ã€‚</p></blockquote><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº†å¦‚ä½•æ„å»ºä¸€ä¸ªç½‘ç»œï¼Œå›é¡¾ä¸€ä¸‹åˆ°ç›®å‰ä¸ºæ­¢ä½¿ç”¨åˆ°çš„ç±»ã€‚</p><ul><li><p><code>torch.Tensor</code>ï¼š ä¸€ä¸ªå¤šç»´æ•°ç»„ã€‚ æ”¯æŒä½¿ç”¨ backward() è¿›è¡Œè‡ªåŠ¨æ¢¯åº¦è®¡ç®—ï¼Œå¹¶ä¿å­˜å…³äºè¿™ä¸ªå‘é‡çš„æ¢¯åº¦ w.r.t.</p></li><li><p><code>nn.Model</code>ï¼š ç¥ç»ç½‘ç»œæ¨¡å—ã€‚å®ç°å°è£…å‚æ•°ã€ç§»åŠ¨åˆ° GPU ä¸Šè¿è¡Œã€å¯¼å‡ºã€åŠ è½½ç­‰ã€‚</p></li><li><p><code>nn.Parameter</code>ï¼š ä¸€ç§å¼ é‡ã€‚å°†å…¶åˆ†é…ä¸º Model çš„å±æ€§æ—¶ï¼Œè‡ªåŠ¨æ³¨å†Œä¸ºå‚æ•°ã€‚</p></li><li><p><code>autograd.Function</code>ï¼š å®ç°ä¸€ä¸ªè‡ªåŠ¨æ±‚å¯¼æ“ä½œçš„å‰å‘å’Œåå‘å®šä¹‰ã€‚æ¯ä¸ª Tensor æ“ä½œéƒ½ä¼šåˆ›å»ºè‡³å°‘ä¸€ä¸ª Function èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹è¿æ¥åˆ°åˆ›å»º Tensor çš„å‡½æ•°ï¼Œå¹¶ç¼–ç å…¶å†å²è®°å½•ã€‚</p></li></ul><h3 id=æŸå¤±å‡½æ•°>æŸå¤±å‡½æ•°</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>output</span> <span class=o>=</span> <span class=n>net</span><span class=p>(</span><span class=nb>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>target</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>  <span class=c1># ä¾‹å­ï¼šä¸€ä¸ªå‡è®¾çš„ç»“æœ</span>
</span></span><span class=line><span class=cl><span class=n>target</span> <span class=o>=</span> <span class=n>target</span><span class=o>.</span><span class=n>view</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># è®© target ä¸ output çš„å½¢çŠ¶ç›¸åŒ</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>criterion</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>MSELoss</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>loss</span> <span class=o>=</span> <span class=n>criterion</span><span class=p>(</span><span class=n>output</span><span class=p>,</span> <span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>loss</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=åå‘ä¼ æ’­>åå‘ä¼ æ’­</h3><p>è¦å®ç°åå‘ä¼ æ’­è¯¯å·®ï¼Œåªéœ€è¦ <code>loss.backward()</code>ã€‚
ä½†æ˜¯ï¼Œéœ€è¦æ¸…é™¤ç°æœ‰çš„æ¢¯åº¦ï¼Œå¦åˆ™æ¢¯åº¦å°†ç´¯ç§¯åˆ°ç°æœ‰çš„æ¢¯åº¦ä¸­ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>net</span><span class=o>.</span><span class=n>zero_grad</span><span class=p>()</span>  <span class=c1># å°†æ‰€æœ‰çš„æ¢¯åº¦ç¼“å†²å½’é›¶</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>net</span><span class=o>.</span><span class=n>conv1</span><span class=o>.</span><span class=n>bias</span><span class=o>.</span><span class=n>grad</span><span class=p>)</span>  <span class=c1># conv1.bias.grad åå‘ä¼ æ’­å‰  tensor([0., 0., 0., 0., 0., 0.])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>loss</span><span class=o>.</span><span class=n>backward</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>net</span><span class=o>.</span><span class=n>conv1</span><span class=o>.</span><span class=n>bias</span><span class=o>.</span><span class=n>grad</span><span class=p>)</span>  <span class=c1># åå‘ä¼ æ’­å  tensor([0.0111, -0.0064,  0.0053, -0.0047,  0.0026, -0.0153])</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æ›´æ–°æƒé‡>æ›´æ–°æƒé‡</h3><p>åœ¨ä½¿ç”¨ PyTorch æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>torch.optim</code> ä¸­æä¾›çš„æ–¹æ³•è¿›è¡Œæ¢¯åº¦ä¸‹é™ã€‚å¦‚ï¼šSDGï¼ŒNesterov-SDGï¼ŒAdamï¼ŒRMSprop ç­‰ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch.optim</span> <span class=k>as</span> <span class=nn>optim</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ª optimizer</span>
</span></span><span class=line><span class=cl><span class=n>optimizer</span> <span class=o>=</span> <span class=n>optim</span><span class=o>.</span><span class=n>SDG</span><span class=p>(</span><span class=n>net</span><span class=o>.</span><span class=n>parameters</span><span class=p>(),</span> <span class=n>lr</span><span class=o>=</span><span class=mf>0.01</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åœ¨è®­ç»ƒä¸­å¾ªç¯</span>
</span></span><span class=line><span class=cl><span class=n>optimizer</span><span class=o>.</span><span class=n>zero_grad</span><span class=p>()</span>  <span class=c1># å°†æ¢¯åº¦ç¼“å†²åŒºæ¸…é›¶</span>
</span></span><span class=line><span class=cl><span class=n>output</span> <span class=o>=</span> <span class=n>net</span><span class=p>(</span><span class=nb>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>loss</span> <span class=o>=</span> <span class=n>criterion</span><span class=p>(</span><span class=n>output</span><span class=p>,</span> <span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>loass</span><span class=o>.</span><span class=n>backword</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>optimizer</span><span class=o>.</span><span class=n>step</span><span class=p>()</span>  <span class=c1># æ›´æ–°</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=è®­ç»ƒåˆ†ç±»å™¨>è®­ç»ƒåˆ†ç±»å™¨</h2><h3 id=æ•°æ®ä»å“ªé‡Œæ¥>æ•°æ®ä»å“ªé‡Œæ¥ï¼Ÿ</h3><p>é€šå¸¸ï¼Œéœ€è¦å¤„ç†å›¾åƒã€æ–‡æœ¬ã€éŸ³é¢‘æˆ–è§†é¢‘æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å°†æ•°æ®åŠ è½½åˆ° NumPy æ•°ç»„ä¸­çš„æ ‡å‡† Python åŒ…ï¼Œå†å°†è¯¥æ•°å€¼è½¬æ¢ä¸º <code>torch.*Tensor</code>ã€‚</p><ul><li>å¤„ç†å›¾åƒï¼Œå¯ä»¥ä½¿ç”¨ Pillowï¼ŒOpenCV</li><li>å¤„ç†éŸ³é¢‘ï¼Œå¯ä»¥ä½¿ç”¨ SciPyï¼Œlibrosa</li><li>å¤„ç†æ–‡æœ¬ï¼Œå¯åŸºäº Python æˆ– Cython çš„åŸå§‹åŠ è½½ï¼Œæˆ– NLTK å’Œ SpaCy</li></ul><p>å¯¹äºå›¾åƒä»»åŠ¡ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ª <code>torchvision</code> çš„åŒ…ï¼Œå«æœ‰å¸¸è§çš„æ•°æ®é›†ï¼ˆImagenetï¼ŒCIFAR10ï¼ŒMNISTç­‰ï¼‰çš„æ•°æ®åŠ è½½å™¨ï¼Œä»¥åŠç”¨äºå›¾åƒçš„æ•°æ®è½¬æ¢å™¨ï¼ˆtorchvision.datasets å’Œ torch.utils.data.DataLoaderï¼‰ã€‚</p><p>åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œå°†ä½¿ç”¨ CIFAR10 æ•°æ®é›†ã€‚å…¶ä¸­åŒ…å« 10 åˆ†ç±»çš„å›¾åƒï¼šâ€œé£æœºâ€ï¼Œâ€œæ±½è½¦â€ï¼Œâ€œé¸Ÿâ€ï¼Œâ€œçŒ«â€ï¼Œâ€œé¹¿â€ï¼Œâ€œç‹—â€ï¼Œâ€œé’è›™â€ï¼Œâ€œé©¬â€ï¼Œâ€œèˆ¹â€ï¼Œâ€œå¡è½¦â€ã€‚å›¾åƒçš„å°ºå¯¸ä¸º 3 * 32 * 32ï¼Œå³å°ºå¯¸ä¸º 32 * 32 åƒç´ çš„ 3 é€šé“å½©è‰²å›¾åƒã€‚</p><p><img src=/blog/p/pytorch-handbook/CIFAR-10.png width=472 height=369 srcset="/blog/p/pytorch-handbook/CIFAR-10_hubd3e6b51c00827c9a17b1eaa7622a23e_30944_480x0_resize_box_3.png 480w, /blog/p/pytorch-handbook/CIFAR-10_hubd3e6b51c00827c9a17b1eaa7622a23e_30944_1024x0_resize_box_3.png 1024w" loading=lazy alt=CIFAR-10 class=gallery-image data-flex-grow=127 data-flex-basis=306px></p><p>æ¥ä¸‹æ¥ï¼Œä½œä¸ºæ¼”ç¤ºï¼Œå°†æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ­¥éª¤è®­ç»ƒå›¾åƒåˆ†ç±»å™¨ï¼š</p><ul><li>ä½¿ç”¨ <code>torchvision</code> åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10 è®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†</li><li>å®šä¹‰ CNN</li><li>å®šä¹‰æŸå¤±å‡½æ•°</li><li>æ ¹æ®è®­ç»ƒæ•°æ®è®­ç»ƒç½‘ç»œ</li><li>åœ¨æµ‹è¯•æ•°æ®ä¸Šæµ‹è¯•ç½‘ç»œ</li></ul><h3 id=åŠ è½½å¹¶æ ‡å‡†åŒ–-cifar10>åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torchvision</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torchvision.transforms</span> <span class=k>as</span> <span class=nn>transforms</span>
</span></span></code></pre></td></tr></table></div></div><p>torchvision çš„è¾“å‡ºæ˜¯ [0, 1] çš„ PILImage å›¾åƒï¼Œæˆ‘ä»¬è¦æŠŠå®ƒè½¬æ¢ä¸ºå½’ä¸€åŒ–èŒƒå›´ä¸º [-1, 1] çš„å¼ é‡ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>transform</span> <span class=o>=</span> <span class=n>transforms</span><span class=o>.</span><span class=n>Compose</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>transforms</span><span class=o>.</span><span class=n>ToTensor</span><span class=p>(),</span> <span class=n>transforms</span><span class=o>.</span><span class=n>Normalize</span><span class=p>((</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>),</span> <span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>))]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>trainset</span> <span class=o>=</span> <span class=n>torchvision</span><span class=o>.</span><span class=n>datasets</span><span class=o>.</span><span class=n>CIFAR10</span><span class=p>(</span><span class=n>root</span><span class=o>=</span><span class=s1>&#39;./data&#39;</span><span class=p>,</span> <span class=n>train</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>download</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>transform</span><span class=o>=</span><span class=n>transform</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>trainloader</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>utils</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>DataLoader</span><span class=p>(</span><span class=n>trainset</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>shuffle</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>num_workers</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>testset</span> <span class=o>=</span> <span class=n>trochvision</span><span class=o>.</span><span class=n>datasets</span><span class=o>.</span><span class=n>CIFAR10</span><span class=p>(</span><span class=n>root</span><span class=o>=</span><span class=s1>&#39;./data&#39;</span><span class=p>,</span> <span class=n>train</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>download</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>transform</span><span class=o>=</span><span class=n>transform</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>testloader</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>utils</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>DataLoader</span><span class=p>(</span><span class=n>testset</span><span class=p>,</span> <span class=n>barch_size</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>shuffle</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>num_workers</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>classes</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;plane&#39;</span><span class=p>,</span> <span class=s1>&#39;car&#39;</span><span class=p>,</span> <span class=s1>&#39;bird&#39;</span><span class=p>,</span> <span class=s1>&#39;cat&#39;</span><span class=p>,</span> <span class=s1>&#39;deer&#39;</span><span class=p>,</span> <span class=s1>&#39;dog&#39;</span><span class=p>,</span> <span class=s1>&#39;frog&#39;</span><span class=p>,</span> <span class=s1>&#39;horse&#39;</span><span class=p>,</span> <span class=s1>&#39;ship&#39;</span><span class=p>,</span> <span class=s1>&#39;truck&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å®šä¹‰-cnn>å®šä¹‰ CNN</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch.nn</span> <span class=k>as</span> <span class=nn>nn</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch.nn.functional</span> <span class=k>as</span> <span class=nn>F</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Net</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>(</span><span class=n>Net</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># in_channels, out_channels, kernel_size</span>
</span></span><span class=line><span class=cl>        <span class=c1># è¾“å…¥çš„ä¸º 3 é€šé“å›¾åƒï¼Œæå– 6 ä¸ªç‰¹å¾ï¼Œå¾—åˆ° 6 ä¸ª feature mapï¼Œå·ç§¯æ ¸ä¸ºä¸€ä¸ª 5*5 çš„çŸ©é˜µ</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>conv1</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>pool</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>MaxPool2d</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>conv2</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># å·ç§¯å±‚è¾“å‡ºäº† 16 ä¸ª feature mapï¼Œæ¯ä¸ª feature map æ˜¯ 6*6 çš„äºŒç»´æ•°æ®</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fc1</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>(</span><span class=mi>16</span> <span class=o>*</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>120</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fc2</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>(</span><span class=mi>120</span><span class=p>,</span> <span class=mi>84</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fc3</span><span class=p>(</span><span class=mi>84</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>relu</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>conv1</span><span class=p>(</span><span class=n>x</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>pool</span><span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>relu</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>conv2</span><span class=p>(</span><span class=n>x</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>view</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>16</span> <span class=o>*</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>F</span><span class=o>.</span><span class=n>relu</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>fc1</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>F</span><span class=o>.</span><span class=n>relu</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>fc2</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>fc3</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>net</span> <span class=o>=</span> <span class=n>Net</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨>å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</h3><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº¤å‰ç†µä½œä¸ºæŸå¤±å‡½æ•°ï¼Œä½¿ç”¨å¸¦åŠ¨é‡çš„éšæœºæ¢¯åº¦ä¸‹é™ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch.optim</span> <span class=k>as</span> <span class=nn>optim</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>criterion</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>CrossEntropyLoss</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>optimizer</span> <span class=o>=</span> <span class=n>optim</span><span class=o>.</span><span class=n>SDG</span><span class=p>(</span><span class=n>net</span><span class=o>.</span><span class=n>parameters</span><span class=p>(),</span> <span class=n>lr</span><span class=o>=</span><span class=mf>0.001</span><span class=p>,</span> <span class=n>momentum</span><span class=o>=</span><span class=mf>0.9</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=è®­ç»ƒç½‘ç»œ>è®­ç»ƒç½‘ç»œ</h3><p>æ¥ä¸‹æ¥ï¼Œåªéœ€è¦åœ¨è¿­ä»£æ•°æ®ï¼Œå°†æ•°æ®è¾“å…¥ç½‘ç»œä¸­å¹¶ä¼˜åŒ–ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>for</span> <span class=n>epoch</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>running_loss</span> <span class=o>=</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>data</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>trainloader</span><span class=p>,</span> <span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>inputs</span><span class=p>,</span> <span class=n>labels</span> <span class=o>=</span> <span class=n>data</span>  <span class=c1># è·å–è¾“å…¥</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>optimizer</span><span class=o>.</span><span class=n>zero_grad</span><span class=p>()</span>  <span class=c1># å°†æ¢¯åº¦ç¼“å†²åŒºæ¸…é›¶</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>outputs</span> <span class=o>=</span> <span class=n>net</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span>  <span class=c1># æ­£å‘ä¼ æ’­</span>
</span></span><span class=line><span class=cl>        <span class=n>loss</span> <span class=o>=</span> <span class=n>criterion</span><span class=p>(</span><span class=n>outputs</span><span class=p>,</span> <span class=n>lables</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>loss</span><span class=o>.</span><span class=n>backward</span><span class=p>()</span>  <span class=c1># åå‘ä¼ æ’­</span>
</span></span><span class=line><span class=cl>        <span class=n>optimizer</span><span class=o>.</span><span class=n>step</span><span class=p>()</span>  <span class=c1># ä¼˜åŒ–</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>running_loss</span> <span class=o>+=</span> <span class=n>loss</span><span class=o>.</span><span class=n>item</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>2000</span> <span class=o>==</span> <span class=mi>1999</span><span class=p>:</span>  <span class=c1># æ¯ 2000 æ‰¹æ¬¡æ‰“å°ä¸€æ¬¡</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;[]&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>epoch</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=n>running_loss</span> <span class=o>/</span> <span class=mi>2000</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>running_loss</span> <span class=o>=</span> <span class=mf>0.0</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ•°æ®>åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ•°æ®</h3><p>åœ¨ä¸Šé¢çš„è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬è®­ç»ƒäº† 2 æ¬¡ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦æ£€æµ‹ç½‘ç»œæ˜¯å¦ä»æ•°æ®é›†ä¸­å­¦ä¹ åˆ°äº†æœ‰ç”¨çš„ä¸œè¥¿ã€‚é€šè¿‡é¢„æµ‹ç¥ç»ç½‘ç»œè¾“å‡ºçš„ç±»åˆ«æ ‡ç­¾ä¸å®é™…æƒ…å†µæ ‡ç­¾å¯¹æ¯”è¿›è¡Œæ£€æµ‹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>corrent</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>torch</span><span class=o>.</span><span class=n>no_grad</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>testloader</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>images</span><span class=p>,</span> <span class=n>lobels</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>        <span class=n>outputs</span> <span class=o>=</span> <span class=n>net</span><span class=p>(</span><span class=n>images</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>_</span><span class=p>,</span> <span class=n>predicted</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>outputs</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>total</span> <span class=o>+=</span> <span class=n>labels</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>corrent</span> <span class=o>+=</span> <span class=p>(</span><span class=n>predicted</span> <span class=o>==</span> <span class=n>labels</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>item</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Accuracy of the network on the 10000 test images: </span><span class=si>%d</span><span class=s1> </span><span class=si>%%</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=mi>100</span> <span class=o>*</span><span class=n>corrent</span> <span class=o>/</span> <span class=n>total</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1># Accuracy of the network on the 10000 test images: 9%</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨è®­ç»ƒä¸¤æ¬¡çš„ç½‘ç»œä¸­ï¼Œéšæœºé€‰æ‹©çš„æ­£ç¡®ç‡ä¸º 10%ã€‚ç½‘ç»œä¼¼ä¹å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ã€‚</p><p>é‚£è¿™ä¸ªç½‘ç»œï¼Œè¯†åˆ«å“ªä¸€ç±»å¥½ï¼Œå“ªä¸€ç±»ä¸å¥½å‘¢ï¼Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>class_corrent</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=mf>0.</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>class_total</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=mf>0.</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>torch</span><span class=o>.</span><span class=n>no_grad</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>testloader</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>images</span><span class=p>,</span> <span class=n>labels</span> <span class=o>=</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>        <span class=n>outputs</span> <span class=o>=</span> <span class=n>net</span><span class=p>(</span><span class=n>images</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>_</span><span class=p>,</span> <span class=n>predicted</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>outputs</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=p>(</span><span class=n>predicted</span> <span class=o>==</span> <span class=n>labels</span><span class=p>)</span><span class=o>.</span><span class=n>squeeze</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>label</span> <span class=o>=</span> <span class=n>labels</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>class_correct</span><span class=p>[</span><span class=n>label</span><span class=p>]</span> <span class=o>+=</span> <span class=n>c</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>item</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>class_total</span><span class=p>[</span><span class=n>label</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Accuracy of </span><span class=si>%5s</span><span class=s1> : </span><span class=si>%2d</span><span class=s1> </span><span class=si>%%</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>classes</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=mi>100</span> <span class=o>*</span> <span class=n>class_correct</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>/</span> <span class=n>class_total</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Accuracy of plane : 99 %</span>
</span></span><span class=line><span class=cl><span class=c1># Accuracy of   car :  0 %</span>
</span></span><span class=line><span class=cl><span class=c1># Accuracy of  bird :  0 %</span>
</span></span><span class=line><span class=cl><span class=c1># Accuracy of   cat :  0 %</span>
</span></span><span class=line><span class=cl><span class=c1># Accuracy of  deer :  0 %</span>
</span></span><span class=line><span class=cl><span class=c1># Accuracy of   dog :  0 %</span>
</span></span><span class=line><span class=cl><span class=c1># Accuracy of  frog :  0 %</span>
</span></span><span class=line><span class=cl><span class=c1># Accuracy of horse :  0 %</span>
</span></span><span class=line><span class=cl><span class=c1># Accuracy of  ship :  0 %</span>
</span></span><span class=line><span class=cl><span class=c1># Accuracy of truck :  0 %</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=ä½¿ç”¨-gpu>ä½¿ç”¨ GPU</h2><p>ä¸å°† tensor ç§»åˆ° GPU ä¸Šä¸€æ ·ï¼Œç¥ç»ç½‘ç»œä¹Ÿå¯ä»¥ç§»åŠ¨åˆ° GPU ä¸Šã€‚
å¦‚æœå¯ä»¥ä½¿ç”¨ CUDAï¼Œå°†è®¾å¤‡å®šä¹‰ä¸ºç¬¬ä¸€ä¸ª cuda è®¾å¤‡ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>device</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>device</span><span class=p>(</span><span class=s1>&#39;cuda:0&#39;</span> <span class=k>if</span> <span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>is_available</span><span class=p>()</span> <span class=k>else</span> <span class=s1>&#39;cpu&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># cuda:0</span>
</span></span></code></pre></td></tr></table></div></div><p>å¤åˆ¶ nn å’Œ tensor åˆ° GPU ä¸Šã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>net</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>inputs</span><span class=p>,</span> <span class=n>labels</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>),</span> <span class=n>data</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Tip:</p><p>ä½¿ç”¨ <code>.to(device)</code> å¹¶æ²¡æœ‰å¤åˆ¶ nn / tensor åˆ° GPU ä¸Šï¼Œè€Œæ˜¯è¿”å›äº†ä¸€ä¸ª copyã€‚éœ€è¦èµ‹å€¼åˆ°ä¸€ä¸ªæ–°çš„å˜é‡ååœ¨ GPU ä¸Šä½¿ç”¨è¿™ä¸ª nn / tensorã€‚</p></blockquote><h2 id=å‚è€ƒ>å‚è€ƒ</h2><ul><li><a class=link href=https://pytorch.apachecn.org/#/docs/1.7/02 target=_blank rel=noopener>https://pytorch.apachecn.org/#/docs/1.7/02</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/blog/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/>æ·±åº¦å­¦ä¹ </a>
<a href=/blog/tags/pytorch/>PyTorch</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></article><aside class=related-contents--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/blog/p/design-pattern/observer/><div class=article-image><img src=/blog/p/design-pattern/observer/observer.d66f5921d7d3ecf6b53b22504fe1af1d_hua5fe444eaf0979d6378130641051be73_47507_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post è§‚å¯Ÿè€…æ¨¡å¼" data-key=/design-pattern/observer data-hash="md5-1m9ZIdfT7Pa1OyJQT+GvHQ=="></div><div class=article-details><h2 class=article-title>è§‚å¯Ÿè€…æ¨¡å¼</h2></div></a></article><article class=has-image><a href=/blog/p/kafka/><div class=article-image><img src=/blog/p/kafka/kafka.db4908225078178f01f03b9a6e00091d_hu0e688a86da638634e8e15b21ceb1a2b6_8026_250x150_fill_q75_h2_box_smart1_2.webp width=250 height=150 loading=lazy alt="Featured image of post Kafka" data-key=/Kafka data-hash="md5-20kIIlB4F48B8DuabgAJHQ=="></div><div class=article-details><h2 class=article-title>Kafka</h2></div></a></article><article class=has-image><a href=/blog/p/mysql/master-slave-replication/><div class=article-image><img src=/blog/p/mysql/master-slave-replication/copy.aadc4504c6a415278334a163547b1cd3_hu2815b7bcceb4bc2e593bd903d3b2a777_501311_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post MySQL å¤åˆ¶" data-key=/mysql/master-slave-replication data-hash="md5-qtxFBMakFSeDNKFjVHsc0w=="></div><div class=article-details><h2 class=article-title>MySQL å¤åˆ¶</h2></div></a></article><article class=has-image><a href=/blog/p/redis/replication/><div class=article-image><img src=/blog/p/redis/replication/replication.30f627456b5f3b1226d679fcb7c12eaf_hu79bab96584f6667bba9965688b174414_176167_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post Redis å¤åˆ¶" data-key=/redis/replication data-hash="md5-MPYnRWtfOxIm1nn8t8Eurw=="></div><div class=article-details><h2 class=article-title>Redis å¤åˆ¶</h2></div></a></article><article class=has-image><a href=/blog/p/distributed/transaction/><div class=article-image><img src=/blog/p/distributed/transaction/cap.656dd86f9115f93b7182f059d2fa5f8e_hu553ea908437f51f5f9df5986bc7065cb_18394_250x150_fill_q75_h2_box_smart1_2.webp width=250 height=150 loading=lazy alt="Featured image of post åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆDoingï¼‰" data-key=/distributed/transaction data-hash="md5-ZW3Yb5EV+TtxgvBZ0vpfjg=="></div><div class=article-details><h2 class=article-title>åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆDoingï¼‰</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2023 ä¸€å±‚</section><section class=powerby><b><a href=http://beian.miit.gov.cn/ target=_blank rel="nofollow noopener">èµ£ICPå¤‡19004365å·-3</a></b><br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=%s>Stack</a></b> by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a><br></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#pytorch-æ˜¯ä»€ä¹ˆ>PyTorch æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li><a href=#tensors>Tensors</a><ol><li><a href=#numpy-è½¬æ¢>Numpy è½¬æ¢</a></li><li><a href=#cuda-å¼ é‡>CUDA å¼ é‡</a></li></ol></li><li><a href=#autograd-è‡ªåŠ¨æ±‚å¯¼>Autograd è‡ªåŠ¨æ±‚å¯¼</a><ol><li><a href=#æ­£å‘ä¼ æ’­-åå‘ä¼ æ’­>æ­£å‘ä¼ æ’­ åå‘ä¼ æ’­</a></li><li><a href=#ç¥ç»ç½‘ç»œçš„å¾®åˆ†>ç¥ç»ç½‘ç»œçš„å¾®åˆ†</a></li></ol></li><li><a href=#ç¥ç»ç½‘ç»œ>ç¥ç»ç½‘ç»œ</a><ol><li><a href=#å®šä¹‰ç½‘ç»œ>å®šä¹‰ç½‘ç»œ</a></li><li><a href=#æŸå¤±å‡½æ•°>æŸå¤±å‡½æ•°</a></li><li><a href=#åå‘ä¼ æ’­>åå‘ä¼ æ’­</a></li><li><a href=#æ›´æ–°æƒé‡>æ›´æ–°æƒé‡</a></li></ol></li><li><a href=#è®­ç»ƒåˆ†ç±»å™¨>è®­ç»ƒåˆ†ç±»å™¨</a><ol><li><a href=#æ•°æ®ä»å“ªé‡Œæ¥>æ•°æ®ä»å“ªé‡Œæ¥ï¼Ÿ</a></li><li><a href=#åŠ è½½å¹¶æ ‡å‡†åŒ–-cifar10>åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10</a></li><li><a href=#å®šä¹‰-cnn>å®šä¹‰ CNN</a></li><li><a href=#å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨>å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</a></li><li><a href=#è®­ç»ƒç½‘ç»œ>è®­ç»ƒç½‘ç»œ</a></li><li><a href=#åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ•°æ®>åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ•°æ®</a></li></ol></li><li><a href=#ä½¿ç”¨-gpu>ä½¿ç”¨ GPU</a></li><li><a href=#å‚è€ƒ>å‚è€ƒ</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/blog/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>