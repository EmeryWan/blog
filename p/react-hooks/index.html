<!doctype html><html lang dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="React Hooks ç®€ä»‹ Hook å«ä¹‰ ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶ useState ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import React, { useState } from &amp;#39;react&amp;#39;; const Example() { // å£°æ˜äº†ä¸€ä¸ª count çš„ state å˜é‡ï¼Œå¹¶åˆå§‹åŒ–ä¸º 0 // setCount è®¾ç½® state"><title>React Hooks</title><link rel=canonical href=https://emerywan.github.io/blog/p/react-hooks/><link rel=stylesheet href=/blog/scss/style.min.9fdfe1d69c4486d1a84c3c7b288ce74b0111a02a60a6c12f21c6b7cc02b131b4.css><meta property="og:title" content="React Hooks"><meta property="og:description" content="React Hooks ç®€ä»‹ Hook å«ä¹‰ ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶ useState ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import React, { useState } from &amp;#39;react&amp;#39;; const Example() { // å£°æ˜äº†ä¸€ä¸ª count çš„ state å˜é‡ï¼Œå¹¶åˆå§‹åŒ–ä¸º 0 // setCount è®¾ç½® state"><meta property="og:url" content="https://emerywan.github.io/blog/p/react-hooks/"><meta property="og:site_name" content="ä¸€å±‚"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="React"><meta property="article:published_time" content="2021-01-28T21:14:45+08:00"><meta property="article:modified_time" content="2021-01-28T21:14:45+08:00"><meta property="og:image" content="https://emerywan.github.io/blog/imgs/9.jpeg"><meta name=twitter:title content="React Hooks"><meta name=twitter:description content="React Hooks ç®€ä»‹ Hook å«ä¹‰ ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶ useState ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import React, { useState } from &amp;#39;react&amp;#39;; const Example() { // å£°æ˜äº†ä¸€ä¸ª count çš„ state å˜é‡ï¼Œå¹¶åˆå§‹åŒ–ä¸º 0 // setCount è®¾ç½® state"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://emerywan.github.io/blog/imgs/9.jpeg"><link rel="shortcut icon" href=https://emerywan.github.io/blog/imgs/favicon.ico><link rel=preconnect href=https://fonts.proxy.ustclug.org><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.proxy.ustclug.org/css2?family=Noto+Sans+SC&family=Roboto&family=Roboto+Mono&display=swap" rel=stylesheet><style>:root{--sys-font-family:-apple-system, BlinkMacSystemFont, "Roboto", "Noto Sans SC", "Segoe UI", "Droid Sans", "Helvetica Neue", Ubuntu;--zh-font-family:-apple-system, BlinkMacSystemFont, "Roboto", "Noto Sans SC",  "PingFang SC", "Hiragino Sans GB", "Droid Sans Fallback", Ubuntu, "Microsoft YaHei";--code-font-family:"SF Mono", SFMono-Regular, "Roboto Mono", "Ubuntu Mono", Menlo, Monaco, Consolas, "Courier New", monospace;--base-font-family:-apple-system, BlinkMacSystemFont, "Roboto", "Noto Sans SC", var(--sys-font-family), var(--zh-font-family), sans-serif;--article-font-family:-apple-system, BlinkMacSystemFont, "Roboto", "Noto Sans SC", var(--base-font-family);--article-line-height:1.6;--article-font-size:1.6rem}</style></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/blog><img src=/blog/img/avatar_hud10ed4afecf1b63b1391b35c2778f738_36574_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/blog>ä¸€å±‚</a></h1><h2 class=site-description>è¿ç€è¿™å²æœˆçš„é£ã€‚</h2></div></header><ol class=social-menu><li><a href=https://github.com/emerywan target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://emery.letout.cn target=_blank title=Home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-smart-home" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 8.71l-5.333-4.148a2.666 2.666.0 00-3.274.0L5.059 8.71A2.665 2.665.0 004.03 10.815v7.2a2 2 0 002 2h12a2 2 0 002-2v-7.2c0-.823-.38-1.6-1.03-2.105"/><path d="M16 15c-2.21 1.333-5.792 1.333-8 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/blog/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>é¦–é¡µ</span></a></li><li><a href=/blog/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>å…³äº</span></a></li><li><a href=/blog/categories/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg><span>åˆ†ç±»</span></a></li><li><a href=/blog/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>å½’æ¡£</span></a></li><li><a href=/blog/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>æœç´¢</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>ğŸŒ— Dark</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/blog/p/react-hooks/><img src=/blog/imgs/9.jpeg loading=lazy alt="Featured image of post React Hooks"></a></div><div class=article-details><header class=article-category><a href=/blog/categories/%E6%8A%80%E6%9C%AF/ style=background-color:#91d5ff;color:#fff>æŠ€æœ¯</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/blog/p/react-hooks/>React Hooks</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>01 - 28, 2021</time></div></footer></div></header><section class=article-content><h1 id=react-hooks-ç®€ä»‹>React Hooks ç®€ä»‹</h1><h2 id=hook-å«ä¹‰>Hook å«ä¹‰</h2><h1 id=ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶>ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶</h1><h1 id=usestate>useState</h1><h2 id=ä½¿ç”¨>ä½¿ç”¨</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Example</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// å£°æ˜äº†ä¸€ä¸ª count çš„ state å˜é‡ï¼Œå¹¶åˆå§‹åŒ–ä¸º 0
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// setCount è®¾ç½® state å€¼ count çš„æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>count</span><span class=p>,</span> <span class=nx>setCount</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// æ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œå°† count çš„å€¼ +1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>You</span> <span class=nx>clicked</span> <span class=p>{</span><span class=nx>count</span><span class=p>}</span> <span class=nx>times</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>setCount</span><span class=p>(</span><span class=nx>count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)}&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>Click</span> <span class=nx>me</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>Example</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=è¯­æ³•>è¯­æ³•</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// å£°æ˜ä¸€ä¸ª state å˜é‡ï¼Œå¹¶åŒæ—¶åˆå§‹åŒ–
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=p>[</span><span class=nx>state</span><span class=p>,</span> <span class=nx>setState</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=nx>initialState</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>useState è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„<ul><li>state å˜é‡ï¼ŒæŒ‡å‘çŠ¶æ€å½“å‰å€¼</li><li>setState æ›´æ–° state å€¼çš„æ–¹æ³•</li></ul></li><li>initialState çŠ¶æ€åˆå§‹å€¼å¯ä»¥æ˜¯æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ç­‰</li></ul><h2 id=ä¸ç±»ä¸­ä½¿ç”¨-setstate-å¼‚åŒ>ä¸ç±»ä¸­ä½¿ç”¨ <code>setState</code> å¼‚åŒ</h2><ul><li>ç›¸åŒç‚¹<ul><li>åœ¨ä¸€æ¬¡æ¸²æŸ“å‘¨æœŸä¸­è°ƒç”¨å¤šæ¬¡ setStateï¼Œæ•°æ®åªæ”¹å˜ä¸€æ¬¡</li></ul></li><li>ä¸åŒç‚¹<ul><li>ç±»ç»„ä»¶ä¸­ setState ä¸ºåˆå¹¶</li><li>å‡½æ•°ç»„ä»¶ä¸­ setState ä¸ºæ›¿æ¢</li></ul></li></ul><h1 id=useeffect>useEffect</h1><p>useEffect ç”¨æ¥æ‰§è¡Œå‰¯ä½œç”¨ã€‚å¯ä»¥å°† useEffect Hook çœ‹åš <code>componentDidMount, componentDidUpdate, componentWillMount</code> ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„ç»„åˆã€‚</p><p>å¸¸ç”¨åœ¨ï¼š</p><ul><li>æœåŠ¡å™¨è¯·æ±‚</li><li>è®¿é—®å…ƒç´  dom å…ƒç´ </li><li>æœ¬åœ°æŒä¹…åŒ–ç¼“å­˜</li><li>ç»‘å®š/è§£ç»‘äº‹ä»¶</li><li>æ·»åŠ è®¢é˜…</li><li>è®¾ç½®å®šæ—¶å™¨</li><li>è®°å½•æ—¥å¿—</li><li>ç­‰</li></ul><p>useEffect æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¸²æŸ“å®Œæ¯•åæ‰æ‰§è¡Œï¼Œè¯¥å‡½æ•°æœ‰è¦æ±‚ï¼šè¦ä¹ˆè¿”å›ä¸€ä¸ªèƒ½æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¦ä¹ˆå°±ä¸è¿”å›ä»»ä½•å†…å®¹ã€‚</p><h2 id=ä¸éœ€è¦æ¸…é™¤çš„-effect>ä¸éœ€è¦æ¸…é™¤çš„ effect</h2><p>åœ¨ React æ›´æ–° DOM ä¹‹åï¼Œæˆ‘ä»¬æƒ³è¿è¡Œä¸€äº›é¢å¤–çš„ä»£ç ã€‚æ¯”å¦‚å‘é€ç½‘ç»œè¯·æ±‚ï¼Œæ‰‹åŠ¨å˜æ›´ DOMï¼Œè®°å½•æ—¥å¿—ï¼Œè¿™äº›éƒ½æ˜¯å¸¸è§çš„æ— éœ€æ¸…é™¤çš„æ“ä½œã€‚
å› ä¸ºæˆ‘ä»¬åœ¨æ‰§è¡Œå®Œè¿™äº›æ“ä½œä¹‹åï¼Œå°±å¯ä»¥å¿½ç•¥ä»–ä»¬äº†ã€‚</p><p>ä»¥ä¸‹ä¸ºä½¿ç”¨ class å’Œ Hook éƒ½æ˜¯æ€ä¹ˆå®ç°è¿™äº›å‰¯ä½œç”¨çš„å¯¹æ¯”ã€‚</p><h3 id=ä½¿ç”¨ç±»ç»„ä»¶>ä½¿ç”¨ç±»ç»„ä»¶</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=c1>// åœ¨ React æ›´æ–° DOM æ“ä½œåï¼Œç«‹å³æ›´æ–° document çš„ title å±æ€§
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>Example</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>(</span><span class=nx>props</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ç»„ä»¶åŠ è½½æ—¶éœ€è¦æ›´æ–°
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>componentDidMount</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>document</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=sb>`You clicked </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=si>}</span><span class=sb> times`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ç»„ä»¶æ›´æ–°æ—¶éœ€è¦æ›´æ–°
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>componentDidUpdate</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>document</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=sb>`You clicked </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=si>}</span><span class=sb> times`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// åœ¨ render() ä¸èƒ½æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚åº”è¯¥åœ¨ react æ›´æ–° DOM åå†æ‰§è¡Œå‰¯ä½œç”¨ã€‚
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>You</span> <span class=nx>clicked</span> <span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=p>}</span> <span class=nx>times</span><span class=p>.&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>setState</span><span class=p>({</span> <span class=nx>count</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>})}&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>click</span> <span class=nx>me</span><span class=p>.</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ä½¿ç”¨-hook>ä½¿ç”¨ Hook</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span><span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>Example</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>count</span><span class=p>,</span> <span class=nx>setCount</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>   <span class=c1>// ç»è¿‡æ¸²æŸ“æˆ–æ›´æ–°ï¼Œ DOM æ›´æ–°å®Œæ¯•ä¹‹åï¼Œä¼šè¿è¡Œè¯¥ effect
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nb>document</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=sb>`You click </span><span class=si>${</span><span class=nx>count</span><span class=si>}</span><span class=sb> times`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>You</span> <span class=nx>clicked</span> <span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=p>}</span> <span class=nx>times</span><span class=p>.&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>setState</span><span class=p>({</span> <span class=nx>count</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>})}&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>click</span> <span class=nx>me</span><span class=p>.</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åå’Œæ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šæ‰§è¡Œ useEffectã€‚ä¸” React ä¿è¯æ¯æ¬¡è¿è¡Œ effect çš„åŒæ—¶ï¼ŒDOM å·²ç»æ›´æ–°å®Œæ¯•ã€‚</li><li>useEffect æ”¾åœ¨ç»„ä»¶å†…éƒ¨è®©æˆ‘ä»¬å¯ä»¥åœ¨ effect ä¸­ç›´æ¥è®¿é—® state / propsã€‚æˆ‘ä»¬ä¸éœ€è¦ç‰¹æ®Šçš„ API æ¥è¯»å–ã€‚</li><li>ä¸ componentDidMount æˆ– componentDidUpdate ä¸åŒï¼Œä½¿ç”¨ useEffect è°ƒåº¦çš„ effect ä¸ä¼šé˜»å¡æµè§ˆå™¨æ›´æ–°å±å¹•ï¼Œè¿™è®©ä½ çš„åº”ç”¨çœ‹èµ·æ¥å“åº”æ›´å¿«ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œeffect ä¸éœ€è¦åŒæ­¥åœ°æ‰§è¡Œã€‚åœ¨ä¸ªåˆ«æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚æµ‹é‡å¸ƒå±€ï¼‰ï¼Œæœ‰å•ç‹¬çš„ useLayoutEffect Hook ä¾›ä½ ä½¿ç”¨ï¼Œå…¶ API ä¸ useEffect ç›¸åŒã€‚</li></ul><h2 id=éœ€è¦æ¸…é™¤çš„-effect>éœ€è¦æ¸…é™¤çš„ effect</h2><p>æœ‰ä¸€äº›å‰¯ä½œç”¨æ˜¯éœ€è¦æ¸…é™¤çš„ï¼Œå¦‚è®¢é˜…å¤–éƒ¨æ•°æ®æºã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ¸…é™¤å·¥ä½œæ˜¯éå¸¸é‡è¦çš„ï¼Œå¯ä»¥é˜²æ­¢å¼•èµ·å†…å­˜æ³„éœ²ï¼</p><h3 id=ä½¿ç”¨ç±»ç»„ä»¶-1>ä½¿ç”¨ç±»ç»„ä»¶</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>class</span> <span class=nx>FriendStatus</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>(</span><span class=nx>props</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>isOnline</span><span class=o>:</span> <span class=kc>null</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>handleStatusChange</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleStatusChange</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>componentDidMount</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ChatAPI</span><span class=p>.</span><span class=nx>subscribeToFriendStatus</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>friend</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>handleStatusChange</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>componentDidUpdate</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>componentWillUnmount</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åœ¨ç»„ä»¶å¸è½½æ—¶ï¼Œå…³é—­è®¢é˜…çš„æ•°æ®æº
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>ChatAPI</span><span class=p>.</span><span class=nx>unsubscribeFromFriendStatus</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>friend</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>handleStatusChange</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>handleStatusChange</span><span class=p>(</span><span class=nx>status</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>setState</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>isOnline</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>isOnline</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>isOnline</span> <span class=o>===</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=s1>&#39;Loading...&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>isOnline</span> <span class=o>?</span> <span class=s1>&#39;Online&#39;</span> <span class=o>:</span> <span class=s1>&#39;Offline&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ä½¿ç”¨å‡½æ•°ç»„ä»¶>ä½¿ç”¨å‡½æ•°ç»„ä»¶</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span><span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>FriendStatus</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>isOnline</span><span class=p>,</span> <span class=nx>setIsOnline</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>handleStatusChange</span><span class=p>(</span><span class=nx>status</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>setIsOnline</span><span class=p>(</span><span class=nx>status</span><span class=p>.</span><span class=nx>isOnline</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>ChatAPI</span><span class=p>.</span><span class=nx>subscribeToFriendStatus</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>friend</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>handleStatusChange</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// effect å¯é€‰æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¿”å›å‡½æ•°ä¸ä¸€å®šéœ€è¦å‘½å
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=kd>function</span> <span class=nx>cleanup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>ChatAPI</span><span class=p>.</span><span class=nx>unsubscribeFromFriendStatus</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>friend</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>handleStatusChange</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isOnline</span> <span class=o>===</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;Loading...&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>isOnline</span> <span class=o>?</span> <span class=s1>&#39;Online&#39;</span> <span class=o>:</span> <span class=s1>&#39;Offline&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>React ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œæ¸…é™¤æ“ä½œã€‚</li></ul><h2 id=å¤šä¸ª-effect-å®ç°å…³æ³¨ç‚¹åˆ†ç¦»>å¤šä¸ª Effect å®ç°å…³æ³¨ç‚¹åˆ†ç¦»</h2><p>ä½¿ç”¨ Hook çš„å…¶ä¸­ä¸€ä¸ªç›®çš„æ˜¯è¦è§£å†³ï¼š class ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ç»å¸¸åŒ…å«ä¸ç›¸å…³é€»è¾‘ï¼Œç›¸å…³é€»è¾‘åˆåˆ†ç¦»åœ¨å‡ ä¸ªä¸åŒçš„æ–¹æ³•ä¸­ã€‚</p><p>å¦‚ä¸‹ä¸ºä¸Šæ–‡ä¸­è®¡æ•°å™¨å’Œå¥½å‹çŠ¶æ€æŒ‡ç¤ºå™¨é€»è¾‘ç»„åˆåœ¨ä¸€èµ·çš„ç»„ä»¶ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>class</span> <span class=nx>FriendStatusWithCounter</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>(</span><span class=nx>props</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>isOnline</span><span class=o>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>handleStautsChange</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>handleStatusChange</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ç›¸åº”çš„é€»è¾‘è¢«åˆ†é…åœ¨ä¸‰ä¸ªä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>componentDidMount</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// counter
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nb>document</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=sb>`You clicked </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=si>}</span><span class=sb> times`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// friend status
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>ChatAPI</span><span class=p>.</span><span class=nx>subscribeToFriendStatus</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>fried</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>handleStatusChange</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>componentDidUpdate</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>document</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=sb>`You clicked </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=si>}</span><span class=sb> times`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>componentWillUnmount</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ChatAPI</span><span class=p>.</span><span class=nx>unsubscribeFromFriendStatus</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>friend</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>handleStatusChange</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>handleStatusChange</span><span class=p>(</span><span class=nx>status</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>setState</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>isOnline</span><span class=o>:</span> <span class=nx>status</span><span class=p>.</span><span class=nx>isOnline</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è‹¥ä½¿ç”¨ Hookï¼Œå’Œä½¿ç”¨å¤šä¸ª state çš„ Hook ä¸€æ ·ï¼Œé€šè¿‡ä½¿ç”¨å¤šä¸ª effectï¼Œå°†ä¸ç›¸å…³çš„é€»è¾‘åˆ†ç¦»åˆ°ä¸åŒçš„ effect ä¸­ã€‚</p><p>Hook å…è®¸æŒ‰ç…§ä»£ç çš„ç”¨é€”è¿›è¡Œåˆ†ç¦»ï¼Œä¸åŒäºç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚å°†æŒ‰ç…§ effect å£°æ˜çš„é¡ºåºä¾æ¬¡è°ƒç”¨ç»„ä»¶ä¸­çš„æ¯ä¸€ä¸ª effectã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>const</span> <span class=nx>FriendStatusWithCounter</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>count</span><span class=p>,</span> <span class=nx>setCount</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>document</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=sb>`You clicked </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=si>}</span><span class=sb> times`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>isOneline</span><span class=p>,</span> <span class=nx>useIsOneline</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>handleStatusChange</span><span class=p>(</span><span class=nx>status</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>setIsOneline</span><span class=p>(</span><span class=nx>status</span><span class=p>.</span><span class=nx>isOneline</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>ChatAPI</span><span class=p>.</span><span class=nx>subscribeToFriendStatus</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>friend</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>handleStatusChange</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>ChatAPI</span><span class=p>.</span><span class=nx>unsubscribeFromFriendStatus</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>friend</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>handleStatusChange</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=è·³è¿‡-effect-è¿›è¡Œæ€§èƒ½ä¼˜åŒ–>è·³è¿‡ Effect è¿›è¡Œæ€§èƒ½ä¼˜åŒ–</h2><p>åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>componentDidUpdate</code> ä¸­ <code>prevProps</code> å’Œ <code>prevState</code> çš„ props / state çš„å˜åŒ–æ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡ŒæŸäº›å‰¯ä½œç”¨ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>componentDidUpdate</span><span class=p>(</span><span class=nx>prevProps</span><span class=p>,</span> <span class=nx>prevState</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>prevState</span><span class=p>.</span><span class=nx>count</span> <span class=o>!==</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>document</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=sb>`You clicked </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=si>}</span><span class=sb> times`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨ Hook ä¸­ï¼Œå¯ä»¥é€šè¿‡å¯¹ useEffect ä¼ é€’æ•°ç»„ä½œä¸ºç¬¬äºŒå¯é€‰å‚æ•°ï¼Œé€šçŸ¥ React è·³è¿‡å¯¹ effect çš„è°ƒç”¨ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>document</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=sb>`You clicked </span><span class=si>${</span><span class=nx>count</span><span class=si>}</span><span class=sb> times`</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=p>[</span><span class=nx>count</span><span class=p>]);</span>    <span class=c1>// è¡¨ç¤º count æ›´æ”¹æ—¶ä¼šè¿›è¡Œæ›´æ–°
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// {... , [5]}  å½“ count === 5 æ—¶ï¼Œè·³è¿‡ effect
</span></span></span></code></pre></td></tr></table></div></div><ul><li>è‹¥åªæƒ³è¿è¡Œä¸€æ¬¡ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ [] ä½œä¸ºç¬¬äºŒå‚æ•°ã€‚<ul><li>ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ï¼Œeffect å†…éƒ¨çš„ props å’Œ state ä¼šä¸€ç›´æ‹¥æœ‰å…¶åˆå§‹å€¼ã€‚</li></ul></li><li>ä½¿ç”¨è¯¥ä¼˜åŒ–ï¼Œè¯·ç¡®ä¿æ•°ç»„ä¸­åŒ…å«äº†æ‰€æœ‰å¤–éƒ¨ä½œç”¨åŸŸä¸­ä¼šéšæ—¶é—´å˜åŒ–ä¸”åœ¨ effect ä¸­ä½¿ç”¨çš„å˜é‡ï¼Œå¦åˆ™ä»£ç ä¼šç”¨åˆ°å…ˆå‰æ¸²æŸ“ä¸­çš„æ—§å˜é‡ã€‚</li></ul><h2 id=æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ-effect-çš„åŸå› >æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ Effect çš„åŸå› </h2><h1 id=è‡ªå®šä¹‰-hook>è‡ªå®šä¹‰ Hook</h1><p>è‡ªå®šä¹‰ Hook å¯ä»¥å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ã€‚</p><p>ç›®å‰ä¸ºæ­¢ï¼Œåœ¨ React ä¸­æœ‰ä¸¤ç§æµè¡Œçš„æ–¹å¼å…±äº«ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘ï¼š</p><ul><li>render props</li><li>é«˜é˜¶ç»„ä»¶
ä½¿ç”¨ Hook å¯ä»¥åœ¨ä¸å¢åŠ ç»„ä»¶çš„æƒ…å†µä¸‹è§£å†³ç›¸åŒçš„é—®é¢˜ã€‚</li></ul><h2 id=åˆ›å»ºè‡ªå®šä¹‰-hook>åˆ›å»ºè‡ªå®šä¹‰ Hook</h2><p>å½“æˆ‘ä»¬æƒ³åœ¨å‡½æ•°é—´å…±äº«é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæå–åˆ°å¦å¤–ä¸€ä¸ªå‡½æ•°ä¸­ã€‚ç”±äºç»„ä»¶å’Œ Hook éƒ½æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ä¹ŸåŒæ ·ä½¿ç”¨äºè¿™ç§æ–¹å¼ã€‚</p><p>è‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åç§°ä»¥ &ldquo;use&rdquo; å¼€å¤´ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–çš„ Hookã€‚</p><p>ä»¥ä¸‹æ˜¯æ ¹æ®ä¸Šæ–‡ä¸­ <code>FriendStatus</code> å®ä¾‹ï¼Œæ‰€æå–çš„è‡ªå®šä¹‰ Hookã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// åç§°ä¸€å®šä»¥ use å¼€å¤´
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>useFriendStatus</span><span class=p>(</span><span class=nx>friendID</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>isOnline</span><span class=p>,</span> <span class=nx>setIsOnline</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>handleStatusChange</span><span class=p>(</span><span class=nx>status</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>setIsOnline</span><span class=p>(</span><span class=nx>status</span><span class=p>.</span><span class=nx>isOneline</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>ChatAPI</span><span class=p>.</span><span class=nx>subscribeToFriendStatus</span><span class=p>(</span><span class=nx>friendID</span><span class=p>,</span> <span class=nx>handleStatusChange</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>ChatAPI</span><span class=p>.</span><span class=nx>unsubcribeFromFriendStatus</span><span class=p>(</span><span class=nx>friendID</span><span class=p>,</span> <span class=nx>handleStatusChange</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>isOnline</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>useFriendStatus</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨è¿™ä¸ªè‡ªå®šä¹‰ Hook ä¸­ï¼Œæ²¡æœ‰åŒ…å«ä»»ä½•æ–°å†…å®¹ï¼ˆé€»è¾‘ä¸ç»„ä»¶ä¸­çš„å®Œå…¨ä¸€è‡´ï¼‰</p><h2 id=ä½¿ç”¨è‡ªå®šä¹‰-hook>ä½¿ç”¨è‡ªå®šä¹‰ Hook</h2><p>ä¸ç»„ä»¶ä¸€è‡´ï¼Œè¯·ç¡®ä¿åªåœ¨è‡ªå®šä¹‰ Hook çš„é¡¶å±‚æ— æ¡ä»¶åœ°è°ƒç”¨å…¶ä»– Hookã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>FriendStatus</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>isOnline</span> <span class=o>=</span> <span class=nx>useFriendStatus</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>friend</span><span class=p>.</span><span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isOnline</span> <span class=o>===</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;Loading...&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>isOnline</span> <span class=o>?</span> <span class=s1>&#39;Online&#39;</span> <span class=o>:</span> <span class=s1>&#39;Offline&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™æ®µä»£ç ä¸ä¹‹å‰çš„å·¥ä½œæ–¹å¼å®Œå…¨ä¸€æ ·ï¼Œæˆ‘ä»¬åªæ˜¯å°†å‡½æ•°ä¸­éœ€è¦å…±äº«çš„é€»è¾‘æå–åˆ°å•ç‹¬çš„å‡½æ•°ä¸­ã€‚</p><ul><li>è‡ªå®šä¹‰ Hook æ˜¯ä¸€ç§è‡ªç„¶éµå¾ª Hook è®¾è®¡çš„çº¦å®šï¼Œä¸æ˜¯ React çš„ç‰¹æ€§ã€‚</li><li>è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ &ldquo;use&rdquo; å¼€å¤´</li><li>ä¸åŒç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ Hook ä¸ä¼šå…±äº« stateã€‚<ul><li>è‡ªå®šä¹‰ Hook æ˜¯é‡ç”¨çŠ¶æ€é€»è¾‘çš„æœºåˆ¶ï¼ˆä¾‹å¦‚è®¾ç½®ä¸ºè®¢é˜…å¹¶å­˜å‚¨å½“å‰å€¼ï¼‰ï¼Œæ¯æ¬¡ä½¿ç”¨è‡ªå®šä¹‰ Hook æ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰ state å’Œå‰¯ä½œç”¨å®Œå…¨éš”ç¦»ã€‚</li></ul></li></ul><h2 id=åœ¨å¤šä¸ª-hook-ä¹‹é—´ä¼ é€’ä¿¡æ¯>åœ¨å¤šä¸ª Hook ä¹‹é—´ä¼ é€’ä¿¡æ¯</h2><p>ç”±äº Hook æœ¬èº«å°±æ˜¯å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// è¿™æ˜¯ä¸€ä¸ªèŠå¤©æ¶ˆæ¯æ¥æ”¶è€…çš„é€‰æ‹©å™¨ï¼Œå®ƒä¼šæ˜¾ç¤ºå½“å‰é€‰å®šçš„å¥½å‹æ˜¯å¦åœ¨çº¿
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>ChatRecipientPicker</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// å½“å‰é€‰æ‹©çš„å¥½å‹ ID ä¿å­˜åœ¨ recipientID çŠ¶æ€å˜é‡ä¸­
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>recipientID</span><span class=p>,</span> <span class=nx>setRecipientID</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// å½“æ›´æ–° recipientID çŠ¶æ€å˜é‡æ—¶ï¼ŒuseFriendStatus Hook ä¼šå–æ¶ˆè®¢é˜…ä¹‹å‰é€‰ä¸­çš„å¥½å‹ï¼Œå¹¶è®¢é˜…æ–°é€‰ä¸­çš„å¥½å‹çŠ¶æ€
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>isRecipientOnline</span> <span class=o>=</span> <span class=nx>useFriendStatus</span><span class=p>(</span><span class=nx>recipientID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>Circle</span> <span class=nx>color</span><span class=o>=</span><span class=p>{</span><span class=nx>isRecipientOnline</span> <span class=o>?</span> <span class=s1>&#39;green&#39;</span> <span class=o>:</span> <span class=s1>&#39;red&#39;</span><span class=p>}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>select</span>  <span class=c1>// &lt;select&gt; ä¸­é€‰æ‹©å…¶ä»–å¥½å‹æ—¶æ›´æ–° recipientID
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>recipientID</span><span class=p>}</span> 
</span></span><span class=line><span class=cl>        <span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>e</span> <span class=p>=&gt;</span> <span class=nx>setRecipientID</span><span class=p>(</span><span class=nb>Number</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>))}</span>
</span></span><span class=line><span class=cl>      <span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>friendList</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>friend</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>option</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>friend</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span> <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>friend</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=nx>friend</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=err>/option&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/select&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬å°†å½“å‰é€‰æ‹©çš„å¥½å‹ ID ä¿å­˜åœ¨ recipientID çŠ¶æ€å˜é‡ä¸­ï¼Œå¹¶ä¼šåœ¨ç”¨æˆ·ä» &lt;select> ä¸­é€‰æ‹©å…¶ä»–å¥½å‹æ—¶æ›´æ–°è¿™ä¸ª stateã€‚</p><p>ç”±äº useState ä¼šæä¾› recipientID çŠ¶æ€å˜é‡çš„æœ€æ–°å€¼ï¼Œå¯ä»¥å°†å®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™è‡ªå®šä¹‰çš„ useFriendStatus Hookã€‚å½“æˆ‘ä»¬é€‰æ‹©ä¸åŒçš„å¥½å‹å¹¶æ›´æ–° recipientID çŠ¶æ€å˜é‡æ—¶ï¼ŒuseFriendStatus Hook ä¼šå–æ¶ˆè®¢é˜…ä¹‹å‰é€‰ä¸­çš„å¥½å‹ï¼Œå¹¶è®¢é˜…æ–°é€‰ä¸­çš„å¥½å‹çŠ¶æ€ã€‚</p><h1 id=hook-è§„åˆ™>Hook è§„åˆ™</h1><h1 id=é¢å¤–çš„-hook>é¢å¤–çš„ Hook</h1><h1 id=å‚è€ƒ>å‚è€ƒ</h1><ul><li><a class=link href=https://juejin.im/post/6844903814349193229 target=_blank rel=noopener>https://juejin.im/post/6844903814349193229</a></li><li><a class=link href=https://juejin.im/post/6844903985338400782 target=_blank rel=noopener>https://juejin.im/post/6844903985338400782</a></li><li><a class=link href=https://www.ruanyifeng.com/blog/2019/09/react-hooks.html target=_blank rel=noopener>https://www.ruanyifeng.com/blog/2019/09/react-hooks.html</a></li><li><a class=link href=https://zh-hans.reactjs.org/docs/hooks-intro.html target=_blank rel=noopener>https://zh-hans.reactjs.org/docs/hooks-intro.html</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/blog/tags/react/>React</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/blog/p/mysql/innodb/buffer-pool/><div class=article-image><img src=/blog/p/mysql/innodb/buffer-pool/bufferpool.afc31921376eaf2e2d6bba9b82da6f9b_hu9753cf048aa8ef6ecf388c9b29af095f_8518_250x150_fill_q75_h2_box_smart1_2.webp width=250 height=150 loading=lazy alt="Featured image of post InnoDB ç¼“å†²æ±  Buffer Pool" data-key=/mysql/innodb/buffer-pool data-hash="md5-r8MZITdury4ta7qbgtpvmw=="></div><div class=article-details><h2 class=article-title>InnoDB ç¼“å†²æ±  Buffer Pool</h2></div></a></article><article class=has-image><a href=/blog/p/design-pattern/observer/><div class=article-image><img src=/blog/p/design-pattern/observer/observer.d66f5921d7d3ecf6b53b22504fe1af1d_hua5fe444eaf0979d6378130641051be73_47507_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post è§‚å¯Ÿè€…æ¨¡å¼" data-key=/design-pattern/observer data-hash="md5-1m9ZIdfT7Pa1OyJQT+GvHQ=="></div><div class=article-details><h2 class=article-title>è§‚å¯Ÿè€…æ¨¡å¼</h2></div></a></article><article class=has-image><a href=/blog/p/kafka/><div class=article-image><img src=/blog/p/kafka/kafka.db4908225078178f01f03b9a6e00091d_hu0e688a86da638634e8e15b21ceb1a2b6_8026_250x150_fill_q75_h2_box_smart1_2.webp width=250 height=150 loading=lazy alt="Featured image of post Kafka" data-key=/Kafka data-hash="md5-20kIIlB4F48B8DuabgAJHQ=="></div><div class=article-details><h2 class=article-title>Kafka</h2></div></a></article><article class=has-image><a href=/blog/p/distributed/transaction/><div class=article-image><img src=/blog/p/distributed/transaction/cap.656dd86f9115f93b7182f059d2fa5f8e_hu553ea908437f51f5f9df5986bc7065cb_18394_250x150_fill_q75_h2_box_smart1_2.webp width=250 height=150 loading=lazy alt="Featured image of post åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆDoingï¼‰" data-key=/distributed/transaction data-hash="md5-ZW3Yb5EV+TtxgvBZ0vpfjg=="></div><div class=article-details><h2 class=article-title>åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆDoingï¼‰</h2></div></a></article><article class=has-image><a href=/blog/p/mysql/master-slave-replication/><div class=article-image><img src=/blog/p/mysql/master-slave-replication/copy.aadc4504c6a415278334a163547b1cd3_hu2815b7bcceb4bc2e593bd903d3b2a777_501311_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post MySQL å¤åˆ¶" data-key=/mysql/master-slave-replication data-hash="md5-qtxFBMakFSeDNKFjVHsc0w=="></div><div class=article-details><h2 class=article-title>MySQL å¤åˆ¶</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2023 ä¸€å±‚</section><section class=powerby><b><a href=http://beian.miit.gov.cn/ target=_blank rel="nofollow noopener">èµ£ICPå¤‡19004365å·-3</a></b><br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=%s>Stack</a></b> by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a><br></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#hook-å«ä¹‰>Hook å«ä¹‰</a></li></ol><ol><li><a href=#ä½¿ç”¨>ä½¿ç”¨</a></li><li><a href=#è¯­æ³•>è¯­æ³•</a></li><li><a href=#ä¸ç±»ä¸­ä½¿ç”¨-setstate-å¼‚åŒ>ä¸ç±»ä¸­ä½¿ç”¨ <code>setState</code> å¼‚åŒ</a></li></ol><ol><li><a href=#ä¸éœ€è¦æ¸…é™¤çš„-effect>ä¸éœ€è¦æ¸…é™¤çš„ effect</a><ol><li><a href=#ä½¿ç”¨ç±»ç»„ä»¶>ä½¿ç”¨ç±»ç»„ä»¶</a></li><li><a href=#ä½¿ç”¨-hook>ä½¿ç”¨ Hook</a></li></ol></li><li><a href=#éœ€è¦æ¸…é™¤çš„-effect>éœ€è¦æ¸…é™¤çš„ effect</a><ol><li><a href=#ä½¿ç”¨ç±»ç»„ä»¶-1>ä½¿ç”¨ç±»ç»„ä»¶</a></li><li><a href=#ä½¿ç”¨å‡½æ•°ç»„ä»¶>ä½¿ç”¨å‡½æ•°ç»„ä»¶</a></li></ol></li><li><a href=#å¤šä¸ª-effect-å®ç°å…³æ³¨ç‚¹åˆ†ç¦»>å¤šä¸ª Effect å®ç°å…³æ³¨ç‚¹åˆ†ç¦»</a></li><li><a href=#è·³è¿‡-effect-è¿›è¡Œæ€§èƒ½ä¼˜åŒ–>è·³è¿‡ Effect è¿›è¡Œæ€§èƒ½ä¼˜åŒ–</a></li><li><a href=#æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ-effect-çš„åŸå› >æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ Effect çš„åŸå› </a></li></ol><ol><li><a href=#åˆ›å»ºè‡ªå®šä¹‰-hook>åˆ›å»ºè‡ªå®šä¹‰ Hook</a></li><li><a href=#ä½¿ç”¨è‡ªå®šä¹‰-hook>ä½¿ç”¨è‡ªå®šä¹‰ Hook</a></li><li><a href=#åœ¨å¤šä¸ª-hook-ä¹‹é—´ä¼ é€’ä¿¡æ¯>åœ¨å¤šä¸ª Hook ä¹‹é—´ä¼ é€’ä¿¡æ¯</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/blog/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>