<!doctype html><html lang dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="☘️ 通用程序设计 Effective Java 阅读笔记。本章主要讨论了 Java 语言的具体细节。包括： 局部变量 控制结构 类库 数据结构 不是由语言本身提供的机制 优化和命名惯例。 57. 将"><title>通用程序设计</title><link rel=canonical href=https://emerywan.github.io/blog/p/effective-java/general-programming/><link rel=stylesheet href=/blog/scss/style.min.9fdfe1d69c4486d1a84c3c7b288ce74b0111a02a60a6c12f21c6b7cc02b131b4.css><meta property="og:title" content="通用程序设计"><meta property="og:description" content="☘️ 通用程序设计 Effective Java 阅读笔记。本章主要讨论了 Java 语言的具体细节。包括： 局部变量 控制结构 类库 数据结构 不是由语言本身提供的机制 优化和命名惯例。 57. 将"><meta property="og:url" content="https://emerywan.github.io/blog/p/effective-java/general-programming/"><meta property="og:site_name" content="一层"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Effective Java"><meta property="article:published_time" content="2022-03-30T14:02:02+08:00"><meta property="article:modified_time" content="2022-03-30T14:02:02+08:00"><meta property="og:image" content="https://emerywan.github.io/blog/p/effective-java/general-programming/effective-java.png"><meta name=twitter:title content="通用程序设计"><meta name=twitter:description content="☘️ 通用程序设计 Effective Java 阅读笔记。本章主要讨论了 Java 语言的具体细节。包括： 局部变量 控制结构 类库 数据结构 不是由语言本身提供的机制 优化和命名惯例。 57. 将"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://emerywan.github.io/blog/p/effective-java/general-programming/effective-java.png"><link rel="shortcut icon" href=https://emerywan.github.io/blog/imgs/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/blog><img src=/blog/img/avatar_hud10ed4afecf1b63b1391b35c2778f738_36574_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/blog>一层</a></h1><h2 class=site-description>迎着这岁月的风。</h2></div></header><ol class=social-menu><li><a href=https://github.com/emerywan target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.letout.cn target=_blank title=Home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-smart-home" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 8.71l-5.333-4.148a2.666 2.666.0 00-3.274.0L5.059 8.71A2.665 2.665.0 004.03 10.815v7.2a2 2 0 002 2h12a2 2 0 002-2v-7.2c0-.823-.38-1.6-1.03-2.105"/><path d="M16 15c-2.21 1.333-5.792 1.333-8 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/blog/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>首页</span></a></li><li><a href=/blog/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>归档</span></a></li><li><a href=/blog/categories/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg><span>分类</span></a></li><li><a href=/blog/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>关于</span></a></li><li><a href=/blog/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜索</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/blog/p/effective-java/general-programming/><img src=/blog/p/effective-java/general-programming/effective-java_hu8285674e0bb74a2ea271ae0a19ba75ab_128063_800x0_resize_box_3.png srcset="/blog/p/effective-java/general-programming/effective-java_hu8285674e0bb74a2ea271ae0a19ba75ab_128063_800x0_resize_box_3.png 800w, /blog/p/effective-java/general-programming/effective-java_hu8285674e0bb74a2ea271ae0a19ba75ab_128063_1600x0_resize_box_3.png 1600w" width=800 height=573 loading=lazy alt="Featured image of post 通用程序设计"></a></div><div class=article-details><header class=article-category><a href=/blog/categories/%E6%8A%80%E6%9C%AF/ style=background-color:#91d5ff;color:#fff>技术</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/blog/p/effective-java/general-programming/>通用程序设计</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>03 - 30, 2022</time></div></footer></div></header><section class=article-content><h1 id=-通用程序设计>☘️ 通用程序设计</h1><p>Effective Java 阅读笔记。本章主要讨论了 <code>Java</code> 语言的具体细节。包括：</p><ul><li>局部变量</li><li>控制结构</li><li>类库</li><li>数据结构</li><li>不是由语言本身提供的机制</li><li>优化和命名惯例。</li></ul><h2 id=57-将局部变量的作用域最小化>57. 将局部变量的作用域最小化</h2><h3 id=-建议>🌸 建议</h3><ul><li><p>🌱 最小化局部变量的范围，可提高代码的可读性和可维护性，降低出错的可能性。<strong>在第一次使用它的地方声明变量。</strong></p></li><li><p>🍀 每个局部变量声明都应该包含一个初始化表达式。<code>try-catch</code> 语句除外。</p><p>如果一个变量初始化，会抛出一个 checked 异常，必须在 <code>try</code> 中初始化（除非所包含的方法可以抛异常）。</p><p>如果该值必须在 <code>try</code> 块之外使用，那么它必须在 <code>try</code> 块之前声明，此时它还不能“合理地初始化“。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>set</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>set</span> <span class=o>=</span> <span class=n>cons</span><span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>catch</span> <span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>🍀 循环结束后不再需要循环变量，<code>for</code> 循环就优于 <code>while</code> 循环（<code>for</code> 循环允许声明循环变量）。</p></li><li><p>🌱 保持方法小而集中，每个操作都用一个方法来完成。避免一个操作相关的局部变量可能在另一个操作中。</p></li></ul><h3 id=-案例>🌻 案例</h3><ul><li><p>🌾 遍历集合的首选习惯用法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>for</span> <span class=o>(</span><span class=n>Element</span> <span class=n>e</span> <span class=o>:</span> <span class=n>c</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// do something with e
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>💐 需要访问 <code>Iterator</code> / 调用 <code>Iterator</code> 的 <code>remove()</code>，首选 <code>for</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>for</span> <span class=o>(</span><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Element</span><span class=o>&gt;</span> <span class=n>i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=na>iterator</span><span class=o>();</span> <span class=n>i</span><span class=o>.</span><span class=na>hasNext</span><span class=o>();</span> <span class=o>)</span> <span class=o>{</span>  <span class=c1>// i is loop variable
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Element</span> <span class=n>e</span> <span class=o>=</span> <span class=n>i</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=c1>// do something with i and e
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>💐 循环习惯用法：最小化局部变量的范围</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 每次循环都会调用 expensiveComputation()，且返回结果相同
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>,</span> <span class=n>n</span> <span class=o>=</span> <span class=n>expensiveComputation</span><span class=o>();</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>n</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// do something with i
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>它有两个循环变量：i 和 n，都具有完全正确的作用域。第二个变量 n 用于存储第一个变量的极限，避免了每次迭代中冗余计算的成本。
如果循环涉及一个方法调用，并且保证在每次迭代中返回相同的结果，应该使用这个习惯用法。</p></li></ul><h2 id=58-for-each-循环优于传统的-for-循环>58. for-each 循环优于传统的 for 循环</h2><h3 id=-建议-1>🌸 建议</h3><ul><li><p>🌱 <code>for-each</code> 隐藏迭代器或索引变量，可消除混乱和出错。</p></li><li><p>🌱 <code>:</code> 表示 “在&mldr;里面”。使用 <code>for-each</code> 循环不会降低性能。</p></li><li><p>🥀 以下情况不应该使用 <code>for-each</code>：</p><ul><li><p>🌰 破坏性过滤。如果需要遍历一个集合并删除选定元素，需要使用显式的迭代器，以便调用其 <code>remove()</code>。</p></li><li><p>🌰 转换。遍历时需要替换其中元素的值，需要 <code>List</code> 迭代器或数组索引来替换元素的值。</p></li><li><p>🌰 并行迭代。如果需要并行遍历多个集合，那么需要显式地控制迭代器或索引变量，以便所有迭代器或索引变量都可以同步执行。</p></li></ul></li></ul><h3 id=-案例-1>🌻 案例</h3><ul><li><p>💐 使用 <code>Collection.removeIf()</code> 可避免显式的遍历（Java8）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Collection</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span> <span class=kd>extends</span> <span class=n>Iterable</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>default</span> <span class=kt>boolean</span> <span class=nf>removeIf</span><span class=o>(</span><span class=n>Predicate</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>E</span><span class=o>&gt;</span> <span class=n>filter</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Objects</span><span class=o>.</span><span class=na>requireNonNull</span><span class=o>(</span><span class=n>filter</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=n>removed</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span> <span class=n>each</span> <span class=o>=</span> <span class=n>interator</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=o>(</span><span class=n>each</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=o>(</span><span class=n>filter</span><span class=o>.</span><span class=na>test</span><span class=o>(</span><span class=n>each</span><span class=o>.</span><span class=na>next</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>each</span><span class=o>.</span><span class=na>remove</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>removed</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>removed</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h2 id=59-了解并使用库>59. 了解并使用库</h2><h3 id=-建议-2>🌸 建议</h3><p><strong>能用库方法就用库方法。</strong></p><p>具有算法背景的高级工程师花了大量时间设计、实现和测试库方法，然后将库方法展示给该领域的几位专家，以确保库方法是正确的。
这些库方法经过 beta 测试、发布，并被数百万程序员广泛使用了近 20 年。</p><ul><li><p>🌱 使用标准类库的好处：</p><ul><li>🌰 利用编写它的专家的知识和以前使用它的人的经验。</li><li>🌰 不必浪费时间为那些与你的工作无关的问题编写专门的解决方案。</li><li>🌰 随着时间的推移，它们的性能会不断提高，无需付出任何努力。（版本更新）</li><li>🌰 可以将代码放在主干中。这样的代码更容易被开发人员阅读、维护和复用。</li></ul></li><li><p>🌱 在每个主要版本中，都会向库中添加许多特性，了解这些新增特性是值得的。</p></li><li><p>🍀 每个程序员都应该熟悉 <code>java.lang</code>、<code>java.util</code> 和 <code>java.io</code> 的基础知识及其子包。 其他库的知识可以根据需要获得。尤其是：</p><ul><li>🌰 <code>java.util.Collections</code></li><li>🌰 <code>java.util.Streams</code></li><li>🌰 <code>java.util.concurrent</code></li></ul></li><li><p>🍀 如果你在 Java 平台库中找不到你需要的东西，你的下一个选择应该是寻找高质量的第三方库，比如谷歌的优秀的开源 <code>Guava</code> 库。如果你无法在任何适当的库中找到所需的功能，只能自己实现它。</p></li></ul><h3 id=-案例-2>🌻 案例</h3><ul><li><p>💐 从 Java 7 开始，就不应该再使用 Random。</p><ul><li><p>🌰 在大多数情况下，选择的随机数生成器现在是 <code>ThreadLocalRandom</code>。 它能产生更高质量的随机数，而且速度非常快。<code>ThreadLocalRandom.current().nextInt(100)</code></p></li><li><p>🌰 对于 <code>Fork Join Pool</code> 和并行 <code>Stream</code>，使用 <code>SplittableRandom</code>。</p></li></ul><p>假设你想要生成 0 到某个上界之间的随机整数，许多程序员会编写一个类似这样的小方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 有严重缺陷
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>static</span> <span class=n>Random</span> <span class=n>rnd</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=kt>int</span> <span class=nf>random</span><span class=o>(</span><span class=kt>int</span> <span class=n>n</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>Math</span><span class=o>.</span><span class=na>abs</span><span class=o>(</span><span class=n>rad</span><span class=o>.</span><span class=na>nextInt</span><span class=o>())</span> <span class=o>%</span> <span class=n>n</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>它有三个缺点:</p><ul><li>🌩 n 是小的平方数，随机数序列会在相当短的时间内重复</li><li>🌩 如果 n 不是 2 的幂，那么平均而言，一些数字将比其他数字更频繁地返回</li><li>🌩 在极少数情况下会返回超出指定范围的数字 <code>Integer.MAX_VALUE</code></li></ul><p><strong>应该直接使用类库 <code>Ramdom.nextInt(n)</code> ，而不是自己封装</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>int</span> <span class=nf>nextInt</span><span class=o>(</span><span class=kt>int</span> <span class=n>n</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>🌾 Linux <code>curl</code> in Java 9</p></li></ul><p>假设你想编写一个程序来打印命令行中指定的 URL 的内容（这大致是 Linux <code>curl</code> 命令所做的）。在 Java 9 之前，这段代码有点乏味，但是在 Java 9 中，<code>transferTo()</code> 被添加到 <code>InputStream</code> 中。这是一个使用这个新方法执行这项任务的完整程序：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=o>(</span><span class=n>InputStream</span> <span class=n>in</span> <span class=o>=</span> <span class=k>new</span> <span class=n>URL</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]).</span><span class=na>openStream</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>in</span><span class=o>.</span><span class=na>transferTo</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=60-若需要精确答案就应避免使用-float-double>60. 若需要精确答案就应避免使用 float double</h2><h3 id=-建议-3>🌸 建议</h3><ul><li>🌱 <code>float</code> 和 <code>double</code> 类型特别不适合进行货币计算，因为不能将 0.1（或 10 的任意负次幂）精确地表示。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 0.6100000000000001
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=mf>1.03</span> <span class=o>-</span> <span class=mf>0.42</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>🍀 数值不是太大，可以使用 <code>int</code> 或 <code>long</code><ul><li>🌰 如果数值不超过 9 位小数，可以使用 <code>int</code></li><li>🌰 如果不超过 18 位，可以使用 <code>long</code></li><li>🌰 如果数量可能超过 18 位，则使用 <code>BigDecimal</code></li></ul></li></ul><blockquote><p>例如：在微信支付的 <code>Java SDK</code> 中，货币的类型为 <code>int</code>，结算单位为 分；
在支付宝支付的 <code>Java SDK</code> 中，货币的类型为 <code>String</code>，结算单位为 元</p></blockquote><ul><li>🌱 使用 <code>BigDecimal</code> 类型代替 <code>double / float</code>。注意，<strong>使用 <code>BigDecimal</code> 的 <code>String</code> 构造函数而不是它的 <code>double / float</code> 构造函数。</strong></li></ul><h2 id=61-基本数据类型优于包装类>61. 基本数据类型优于包装类</h2><h3 id=-建议-4>🌸 建议</h3><ul><li><p>🌱 Java 类型系统由两部分组成：</p><ul><li>🌰 基本类型（primitive type）：<code>int double boolean</code></li><li>🌰 引用类型（reference type）：<code>String List</code>
每个基本类型都有一个对应的引用类型，称为包装类型。</li></ul></li><li><p>🌱 基本类型和包装类型之间有三个主要区别：</p><ul><li>🌰 基本类型只有它们的值，而包装类型具有与其值不同的标识</li><li>🌰 基本类型只有全功能值，而每个包装类型除了对应的基本类型的所有功能值外，还有一个非功能值，即 <code>null</code></li><li>🌰 基本类型比包装类型更节省时间和空间</li></ul></li><li><p>🍀 要有选择，就应该优先使用基本类型，而不是包装类型。基本类型更简单、更快。</p></li><li><p>🥀 以下情况必须使用包装类型：</p><ul><li>🌰 作为集合中的元素、键和值</li><li>🌰 必须使用包装类型作为类型参数，<code>Java</code> 不允许使用基本类型。如 <code>ThreadLocal&lt;Integer></code></li><li>🌰 进行反射方法调用时，必须使用包装类型</li></ul></li></ul><h3 id=-案例-3>🌻 案例</h3><ul><li><p>🌾 以下三个例子为常见的包装类型问题：</p><ul><li><p>🌩 将 <code>==</code> 操作符应用于包装类型几乎都是错误的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=err>🙅‍♂️</span>
</span></span><span class=line><span class=cl><span class=n>Comparator</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>naturalOrder</span> <span class=o>=(</span><span class=n>i</span><span class=o>,</span> <span class=n>j</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=o>(</span><span class=n>i</span> <span class=o>&lt;</span> <span class=n>j</span><span class=o>)</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=o>(</span><span class=n>i</span> <span class=o>==</span> <span class=n>j</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=mi>1</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><p>表达式 <code>i &lt; j</code> 会使 i 和 j 引用的 <code>Integer</code> 实例自动拆箱。
表达式 <code>i == j</code> 对两个对象引用执行比较，返回 <code>false</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=err>🙆</span>
</span></span><span class=line><span class=cl><span class=n>Comparator</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>naturalOrder</span> <span class=o>=</span> <span class=o>(</span><span class=n>iBoxed</span><span class=o>,</span> <span class=n>jBoxed</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>iBoxed</span><span class=o>,</span> <span class=n>j</span> <span class=o>=</span> <span class=n>jBoxed</span><span class=o>;</span> <span class=c1>// 自动拆箱
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>j</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=o>(</span><span class=n>i</span> <span class=o>==</span> <span class=n>j</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>};</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>🌩 <code>NullPointerException</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Unbelievable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=n>Integer</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>i</span> <span class=o>==</span> <span class=mi>42</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Unbelievable&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>计算表达式 <code>i == 42</code> 时抛出 <code>NullPointerException</code>。空对象引用自动拆箱，将得到一个 <code>NullPointerException</code>。</p></li><li><p>🌩 严重的性能问题</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Long</span> <span class=n>sum</span> <span class=o>=</span> <span class=mi>0</span><span class=n>L</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=o>(</span><span class=kt>long</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>Integer</span><span class=o>.</span><span class=na>MAX_VALUE</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>sum</span> <span class=o>+=</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>sum</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>局部变量 <code>sum</code>，它是包装类型 <code>Long</code>，而不是基本类型 <code>long</code>。变量被反复装箱和拆箱（超出缓存部分时），导致产生明显的性能下降。</p></li></ul></li></ul><h2 id=62-其他类型更合适时应避免使用字符串>62. 其他类型更合适时，应避免使用字符串</h2><h3 id=-建议-5>🌸 建议</h3><ul><li><p>🌱 当存在或可以编写更好的数据类型时，应避免将字符串用来表示对象。</p></li><li><p>🌱 如果使用不当，字符串比其他类型更麻烦、灵活性更差、速度更慢、更容易出错。</p></li><li><p>🍀 字符串不适合代替其他的值类型。</p><ul><li>🌰 如果是数值类型，则应将其转换为适当的数值类型，如 <code>int</code>、<code>float</code> 或 <code>BigInteger</code>。</li><li>🌰 如果是问题的答案，如“是”或“否”这类形式，则应将其转换为适当的 <code>Enum</code> 或 <code>boolean</code>。</li><li>🌰 更一般地，如果有合适的值类型，无论是基本类型还是对象引用，都应该使用它；如果没有，应该写一个。</li></ul></li><li><p>🌱 字符串不适合代替枚举类型。</p></li><li><p>🌱 字符串不适合代替聚合类型。</p><p>如果一个实体有多个组件，将其表示为单个字符串通常是很不合适的。
例如，下面这行代码来自一个真实的系统标识符：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span> <span class=n>compoundKey</span> <span class=o>=</span> <span class=n>className</span> <span class=o>+</span> <span class=s>&#34;#&#34;</span> <span class=o>+</span> <span class=n>i</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div><p>这种方法有很多缺点：如果用于分隔字段 <code>#</code> 的字符出现在其中一个字段中，可能会导致混乱。要访问各个字段，你必须解析字符串。不能提供 <code>equals</code>、<code>toString</code> 或 <code>compareTo</code> 方法，但必须接受 <code>String</code> 提供的行为。
更好的方法是编写一个类来表示聚合，通常是一个私有静态成员类。（Item-24）。</p></li><li><p>🍀 字符串不适合代替 capabilities</p><p>有时，字符串用于授予对某些功能的访问权。</p><p>例如，考虑线程本地变量机制的设计。这样的机制提供了每个线程都有自己的变量值。
这种方法的问题在于：字符串键表示线程本地变量的共享全局名称空间。
为了使这种方法有效，客户端提供的字符串键必须是唯一的：如果两个客户端各自决定为它们的线程本地变量使用相同的名称，它们无意中就会共享一个变量，这通常会导致两个客户端都失败。
而且安全性很差。恶意客户端可以故意使用与另一个客户端相同的字符串密钥来非法访问另一个客户端的数据。</p></li></ul><h2 id=63-当心字符串连接引起的性能问题>63. 当心字符串连接引起的性能问题</h2><h3 id=-建议-6>🌸 建议</h3><ul><li><p>🌱 不要使用字符串连接操作符合并多个字符串，除非性能无关紧要。使用字符串串联运算符 <code>+</code>，重复串联 n 个字符串，需要 n 的平方级时间。</p></li><li><p>🍀 使用 <code>StringBuilder</code> 代替 <code>String</code></p></li></ul><h2 id=64-通过接口引用对象>64. 通过接口引用对象</h2><h3 id=-建议-7>🌸 建议</h3><ul><li><p>🍀 优先使用接口而不是类来引用对象。如果存在合适的接口类型，那么应该使用接口类型声明参数、返回值、变量和字段。</p></li><li><p>🌱 使用接口作为类型的习惯，程序将更加灵活。</p></li><li><p>🥀 以下情况使用 类 来引用对象：</p><ul><li>🌰 没有合适的接口存在<ul><li><code>String</code> 和 <code>BigInteger</code></li></ul></li><li>🌰 框架的基本类型是类，不是接口<ul><li><code>java.io</code></li></ul></li><li>🌰 实现接口的类提供了接口中不存在的额外方法<ul><li><code>PriorityQueue</code> 中实现了 <code>Queue</code> 不存在的 <code>comparator</code></li></ul></li></ul></li></ul><h3 id=-案例-4>🌻 案例</h3><ul><li>🌾 优先使用接口作为类型</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=err>🙆</span>
</span></span><span class=line><span class=cl><span class=n>Set</span><span class=o>&lt;</span><span class=n>Son</span><span class=o>&gt;</span> <span class=n>sonSet</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LinkedHashSet</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>🙅‍♂️</span>
</span></span><span class=line><span class=cl><span class=n>LinkedHashSet</span><span class=o>&lt;</span><span class=n>Son</span><span class=o>&gt;</span> <span class=n>sonSet</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LinkedHashSet</span><span class=o>&lt;&gt;();</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=65-接口优先反射机制>65. 接口优先反射机制</h2><h3 id=-建议-8>🌸 建议</h3><ul><li><p>🌱 核心反射机制 <code>java.lang.reflect</code> 提供对任意类的编程访问。给定一个 Class 对象，可以获得 <code>Constructor</code>、<code>Method</code>、<code>Filed</code> 实例。</p></li><li><p>🌱 通过过调用 <code>Constructor</code>、<code>Method</code>、<code>Filed</code> 实例上的方法，可以构造底层的实例、调用底层类的方法、访问底层类中的字段。</p><ul><li>🌰 <code>Method.invoke()</code></li></ul></li><li><p>🥀 反射允许一个类使用另一个类，即使在编译前者时后者并不存在。然而，这种能力是有代价的：</p><ul><li>🌰 失去了编译时类型检查的所有好处，包括异常检查。</li><li>🌰 执行反射访问所需的代码既笨拙又冗长。写起来很乏味，读起来也很困难。</li><li>🌰 性能降低。</li></ul></li><li><p>🍀 如果你对应用程序是否需要反射有任何疑问，那么它可能不需要。</p></li><li><p>🌱 如果必须用到在编译时无法获取的类，在编译时存在一个适当的接口或超类来，可以用反射方式创建实例，并通过它们的接口或超类正常地访问它们。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Translate the class name into a Class object
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Class</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>cl</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>cl</span> <span class=o>=</span> <span class=o>(</span><span class=n>Class</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>cl</span> <span class=o>=</span> <span class=kc>null</span><span class=o>)</span> <span class=n>Class</span><span class=o>.</span><span class=na>forNmae</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>])</span> <span class=c1>// Unchecked cast
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ClassNotFoundException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>fatalError</span><span class=o>(</span><span class=s>&#34;Class not found.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Get the constructor
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Constructor</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>cons</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>cons</span> <span class=o>=</span> <span class=n>cl</span><span class=o>.</span><span class=na>getDeclaredConstructor</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NoSuchMethodException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>fatalError</span><span class=o>(</span><span class=s>&#34;No parameterless constructor&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Instantiate the set
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>s</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>  <span class=c1>// 🙋‍♂️ use interface
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>s</span> <span class=o>=</span> <span class=n>cons</span><span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IllegalAccessException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>fatalError</span><span class=o>(</span><span class=s>&#34;Constructor not accessible&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InstantiationException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>fatalError</span><span class=o>(</span><span class=s>&#34;Class not instantiable.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InvocationTargetException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>fatalError</span><span class=o>(</span><span class=s>&#34;Constructor threw &#34;</span> <span class=o>+</span> <span class=n>e</span><span class=o>.</span><span class=na>getCause</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ClassCastException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>fatalError</span><span class=o>(</span><span class=s>&#34;Class doesn&#39;t implement Set&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Exercise the set
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>s</span><span class=o>.</span><span class=na>addAll</span><span class=o>(</span><span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=n>args</span><span class=o>).</span><span class=na>subList</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=n>args</span><span class=o>.</span><span class=na>length</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>s</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>🥀 上例中反射机制的缺点</p><ul><li>🌰 产生 6 个运行时异常</li><li>🌰 根据类名生产实例需要 25 行冗长代码，而调用构造器只需要一行。</li></ul></li><li><p>🌱 反射的合法用途（很少）是管理类对运行时可能不存在的其他类、方法或字段的依赖关系。</p></li><li><p>🌱 如果编写的程序必须在编译时处理未知的类，则应该尽可能只使用反射实例化对象，并使用在编译时已知的接口或超类访问对象。</p></li></ul><h2 id=66-谨慎地使用本地方法>66. 谨慎地使用本地方法</h2><h3 id=-建议-9>🌸 建议</h3><ul><li>🌱 非常不建议使用本地方法。JVM 变得更快了，并且 Java 平台的成熟，它提供了对许多以前只能在宿主平台中上找到的特性。</li></ul><blockquote><p>例如，Java 9 中添加的流 API 提供了对 OS 流程的访问。</p></blockquote><ul><li>🥀 使用本地方法有严重的缺点：<ul><li>🌰 本地语言不安全（Item-50），使用本地方法的应用程序不再能免受内存毁坏错误的影响。</li><li>🌰 Java 更依赖于平台，因此使用本地方法的程序的可移植性较差。</li><li>🌰 它们更难调试。</li><li>🌰 如果不小心，本地方法可能会降低性能，因为垃圾收集器无法自动跟踪本地内存使用情况，而且进出本地代码会产生相关的成本。</li><li>🌰 本地方法需要“粘合代码”，这很难阅读，而且编写起来很乏味。</li></ul></li></ul><h2 id=67-谨慎地进行优化>67. 谨慎地进行优化</h2><h3 id=-建议-10>🌸 建议</h3><ul><li><p>🍀 优化弊大于利，尤其是如果过早地进行优化。在此过程中，你可能会生成既不快速也不正确且无法轻松修复的软件。</p></li><li><p>🍀 不要为了性能而牺牲合理的架构。努力编写好的程序，而不是快速的程序。</p></li><li><p>🍀 好的程序体现了信息隐藏的原则：在可能的情况下，它们在单个组件中本地化设计决策，因此可以在不影响系统其余部分的情况下更改单个决策</p></li><li><p>🍀 不优化不意味着在程序完成之前可以忽略性能问题。实现上的问题可以通过以后的优化来解决，但是对于架构缺陷，如果不重写系统，就不可能解决限制性能的问题，特别是在设计API、线路层协议和持久数据格式时。</p></li><li><p>🍀 再多的底层优化也不能弥补算法选择的不足。</p></li></ul><h2 id=68-遵守被广泛认可的命名约定>68. 遵守被广泛认可的命名约定</h2><h3 id=-建议-11>🌸 建议</h3><ul><li><p>🌱 Java 平台有一组完善的命名约定，其中许多约定包含在《The Java Language Specification》</p><ul><li>🌰 typographical 字面约定</li><li>🌰 grammatical 语法约定</li></ul></li><li><p>🌱 字面惯例示例：</p><div class=table-wrapper><table><thead><tr><th style=text-align:center><strong>Identifier Type</strong></th><th style=text-align:center><strong>Example</strong></th></tr></thead><tbody><tr><td style=text-align:center>Package or module</td><td style=text-align:center><code>org.junit.jupiter.api</code>, <code>com.google.common.collect</code></td></tr><tr><td style=text-align:center>Class or Interface</td><td style=text-align:center><code>Stream</code>, <code>FutureTask</code>, <code>LinkedHashMap</code>, <code>HttpClient</code></td></tr><tr><td style=text-align:center>Method or Field</td><td style=text-align:center><code>remove()</code>, <code>groupingBy()</code>, <code>getCrc()</code></td></tr><tr><td style=text-align:center>Constant Field</td><td style=text-align:center>MIN_VALUE, NEGATIVE_INFINITY</td></tr><tr><td style=text-align:center>Local Variable</td><td style=text-align:center>i, denom, houseNum</td></tr><tr><td style=text-align:center>Type Parameter</td><td style=text-align:center>T, E, K, V, X, R, U, V, T1, T2</td></tr></tbody></table></div></li><li><p>🌱 语法命名约定比排版约定更灵活，也更有争议。</p></li></ul></section><footer class=article-footer><section class=article-tags><a href=/blog/tags/effective-java/>Effective Java</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>相关文章</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/blog/p/thread/threadlocal/><div class=article-image><img src=/blog/imgs/19.jpeg loading=lazy data-key=/thread/threadlocal data-hash=/blog/imgs/19.jpeg></div><div class=article-details><h2 class=article-title>ThreadLocal</h2></div></a></article><article class=has-image><a href=/blog/p/java/jvm/memory-area/><div class=article-image><img src=/blog/imgs/27.jpeg loading=lazy data-key=/java/jvm/memory-area data-hash=/blog/imgs/27.jpeg></div><div class=article-details><h2 class=article-title>JVM 内存区域</h2></div></a></article><article class=has-image><a href=/blog/p/java/jvm/garbage-collection/><div class=article-image><img src=/blog/imgs/26.jpeg loading=lazy data-key=/java/jvm/garbage-collection data-hash=/blog/imgs/26.jpeg></div><div class=article-details><h2 class=article-title>JVM 垃圾回收</h2></div></a></article><article class=has-image><a href=/blog/p/java/jvm/memory-model/><div class=article-image><img src=/blog/imgs/28.jpeg loading=lazy data-key=/java/jvm/memory-model data-hash=/blog/imgs/28.jpeg></div><div class=article-details><h2 class=article-title>JVM 内存模型</h2></div></a></article><article class=has-image><a href=/blog/p/java/jvm/classloader/><div class=article-image><img src=/blog/imgs/25.jpeg loading=lazy data-key=/java/jvm/classloader data-hash=/blog/imgs/25.jpeg></div><div class=article-details><h2 class=article-title>类加载器</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2023 一层</section><section class=powerby><b><a href=http://beian.miit.gov.cn/ target=_blank rel="nofollow noopener">赣ICP备19004365号-3</a></b><br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=%s>Stack</a></b> by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a><br></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#57-将局部变量的作用域最小化>57. 将局部变量的作用域最小化</a><ol><li><a href=#-建议>🌸 建议</a></li><li><a href=#-案例>🌻 案例</a></li></ol></li><li><a href=#58-for-each-循环优于传统的-for-循环>58. for-each 循环优于传统的 for 循环</a><ol><li><a href=#-建议-1>🌸 建议</a></li><li><a href=#-案例-1>🌻 案例</a></li></ol></li><li><a href=#59-了解并使用库>59. 了解并使用库</a><ol><li><a href=#-建议-2>🌸 建议</a></li><li><a href=#-案例-2>🌻 案例</a></li></ol></li><li><a href=#60-若需要精确答案就应避免使用-float-double>60. 若需要精确答案就应避免使用 float double</a><ol><li><a href=#-建议-3>🌸 建议</a></li></ol></li><li><a href=#61-基本数据类型优于包装类>61. 基本数据类型优于包装类</a><ol><li><a href=#-建议-4>🌸 建议</a></li><li><a href=#-案例-3>🌻 案例</a></li></ol></li><li><a href=#62-其他类型更合适时应避免使用字符串>62. 其他类型更合适时，应避免使用字符串</a><ol><li><a href=#-建议-5>🌸 建议</a></li></ol></li><li><a href=#63-当心字符串连接引起的性能问题>63. 当心字符串连接引起的性能问题</a><ol><li><a href=#-建议-6>🌸 建议</a></li></ol></li><li><a href=#64-通过接口引用对象>64. 通过接口引用对象</a><ol><li><a href=#-建议-7>🌸 建议</a></li><li><a href=#-案例-4>🌻 案例</a></li></ol></li><li><a href=#65-接口优先反射机制>65. 接口优先反射机制</a><ol><li><a href=#-建议-8>🌸 建议</a></li></ol></li><li><a href=#66-谨慎地使用本地方法>66. 谨慎地使用本地方法</a><ol><li><a href=#-建议-9>🌸 建议</a></li></ol></li><li><a href=#67-谨慎地进行优化>67. 谨慎地进行优化</a><ol><li><a href=#-建议-10>🌸 建议</a></li></ol></li><li><a href=#68-遵守被广泛认可的命名约定>68. 遵守被广泛认可的命名约定</a><ol><li><a href=#-建议-11>🌸 建议</a></li></ol></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/blog/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>