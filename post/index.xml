<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on ä¸€å±‚</title><link>https://www.letout.cn/post/</link><description>Recent content in Posts on ä¸€å±‚</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 03 Aug 2023 12:13:14 +0800</lastBuildDate><atom:link href="https://www.letout.cn/post/index.xml" rel="self" type="application/rss+xml"/><item><title>golang channel</title><link>https://www.letout.cn/p/golang/channel/</link><pubDate>Thu, 03 Aug 2023 12:13:14 +0800</pubDate><guid>https://www.letout.cn/p/golang/channel/</guid><description>&lt;img src="https://www.letout.cn/p/golang/channel/go-channel.png" alt="Featured image of post golang channel" />&lt;h2 id="å›žé¡¾-channel">å›žé¡¾ Channel&lt;/h2>
&lt;p>åœ¨å¾ˆå¤šä¸»æµçš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¤šä¸ªçº¿ç¨‹ä¼ é€’æ•°æ®çš„æ–¹å¼ä¸€èˆ¬éƒ½æ˜¯å…±äº«å†…å­˜ï¼Œä¸ºäº†è§£å†³çº¿ç¨‹ç«žäº‰ï¼Œéœ€è¦é™åˆ¶åŒä¸€æ—¶é—´èƒ½å¤Ÿè¯»å†™è¿™äº›å˜é‡çš„çº¿ç¨‹æ•°é‡ã€‚&lt;/p>
&lt;p>è™½ç„¶åœ¨ Go è¯­è¨€ä¸­ä¹Ÿèƒ½ä½¿ç”¨å…±äº«å†…å­˜åŠ äº’æ–¥é”è¿›è¡Œé€šä¿¡ï¼Œä½†æ˜¯ Go è¯­è¨€æä¾›äº†ä¸€ç§ä¸åŒçš„å¹¶å‘æ¨¡åž‹ï¼Œå³é€šä¿¡é¡ºåºè¿›ç¨‹ã€‚Goroutine ä¹‹é—´ä¼šé€šè¿‡ Channel ä¼ é€’æ•°æ®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">ch&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">chan&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å‘é€æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">ch&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æŽ¥æ”¶æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">ch&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œå…³äºŽ channel çš„å…¶ä»–ä½¿ç”¨å°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-channel">ä¸ºä»€ä¹ˆä½¿ç”¨ Channel&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>é¿å…åç¨‹ç«žäº‰å’Œæ•°æ®å†²çªé—®é¢˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ›´é«˜çº§çš„æŠ½è±¡ï¼Œé™ä½Žå¼€å‘éš¾åº¦ï¼Œå¢žåŠ ç¨‹åºå¯è¯»æ€§&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¨¡å—ä¹‹é—´æ›´å®¹æ˜“è§£è€¦ï¼Œå¢žåŠ æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="channel-åº•å±‚ç»“æž„">Channel åº•å±‚ç»“æž„&lt;/h2>
&lt;p>channel çš„æ•°æ®ç»“æž„æ˜¯ &lt;code>runtime/chan.go&lt;/code> ä¸­çš„ä¸€ä¸ª &lt;code>hchan&lt;/code> ç»“æž„ä½“ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">hchan&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">qcount&lt;/span> &lt;span class="kt">uint&lt;/span> &lt;span class="c1">// channel ä¸­çš„å…ƒç´ ä¸ªæ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">dataqsiz&lt;/span> &lt;span class="kt">uint&lt;/span> &lt;span class="c1">// channel èƒ½å­˜æ”¾çš„å…ƒç´ å®¹é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">buf&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span> &lt;span class="c1">// ç”¨äºŽå­˜æ”¾å…ƒç´ çš„çŽ¯å½¢ç¼“å†²åŒºï¼ŒæŒ‡å‘ç¬¬ä¸€ç¼“å­˜çš„ç¬¬ä¸€ä¸ªæ•°æ®æˆå‘˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">elemsize&lt;/span> &lt;span class="kt">uint16&lt;/span> &lt;span class="c1">// channel å…ƒç´ ç±»åž‹çš„å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">closed&lt;/span> &lt;span class="kt">uint32&lt;/span> &lt;span class="c1">// æ ‡è¯† channel æ˜¯å¦å…³é—­![](
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">elemtype&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">_type&lt;/span> &lt;span class="c1">// channel å…ƒç´ ç±»åž‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">sendx&lt;/span> &lt;span class="kt">uint&lt;/span> &lt;span class="c1">// å‘é€å…ƒç´ è¿›å…¥çŽ¯å½¢ç¼“å†²åŒºçš„ index
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">recvx&lt;/span> &lt;span class="kt">uint&lt;/span> &lt;span class="c1">// æŽ¥æ”¶å…ƒç´ æ‰€å¤„çš„çŽ¯å½¢ç¼“å†²åŒºçš„ index
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">recvq&lt;/span> &lt;span class="nx">waitq&lt;/span> &lt;span class="c1">// ç­‰å¾…æŽ¥æ”¶æ•°æ®çš„åç¨‹é“¾è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">sendq&lt;/span> &lt;span class="nx">waitq&lt;/span> &lt;span class="c1">// ç­‰å¾…å‘é€æ•°æ®çš„åç¨‹é“¾è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">lock&lt;/span> &lt;span class="nx">mutex&lt;/span> &lt;span class="c1">// äº’æ–¥é”ï¼Œä¿æŠ¤ hchan ç»“æž„ä½“æœ¬èº«
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¦‚æ‹¬ä¸€ä¸‹ï¼ŒChannel ä¸»è¦ç”±ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ç»„æˆã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ’¿ ä¸€ä¸ªçŽ¯å½¢ç¼“å­˜ &lt;code>buf&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”— ä¸¤ä¸ªé“¾è¡¨ï¼ˆå‘é€åç¨‹é“¾è¡¨ &lt;code>recvq waitq&lt;/code> / æŽ¥æ”¶åç¨‹é“¾è¡¨ &lt;code>sendq waitq&lt;/code> ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”’ ä¸€ä¸ªä¿æŠ¤ hchan çš„äº’æ–¥é” &lt;code>mutex&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/golang/channel/1.jpg"
width="1464"
height="945"
srcset="https://www.letout.cn/p/golang/channel/1_hu78b1cec7845d67025bf678ce3560df05_214267_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/golang/channel/1_hu78b1cec7845d67025bf678ce3560df05_214267_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="371px"
>&lt;/p>
&lt;h3 id="-çŽ¯å½¢ç¼“å­˜-buf">ðŸ’¿ çŽ¯å½¢ç¼“å­˜ buf&lt;/h3>
&lt;p>åœ¨ &lt;code>hchan&lt;/code> ç»“æž„ä½“ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å­—æ®µç»„æˆäº†ä¸€ä¸ªçŽ¯å½¢ç¼“å­˜åŒºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">qcount&lt;/span> &lt;span class="kt">uint&lt;/span> &lt;span class="c1">// channel ä¸­çš„å…ƒç´ ä¸ªæ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">dataqsiz&lt;/span> &lt;span class="kt">uint&lt;/span> &lt;span class="c1">// channel èƒ½å­˜æ”¾çš„å…ƒç´ å®¹é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">buf&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span> &lt;span class="c1">// ç”¨äºŽå­˜æ”¾å…ƒç´ çš„çŽ¯å½¢ç¼“å†²åŒºï¼ŒæŒ‡å‘ç¬¬ä¸€ç¼“å­˜çš„ç¬¬ä¸€ä¸ªæ•°æ®æˆå‘˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">elemsize&lt;/span> &lt;span class="kt">uint16&lt;/span> &lt;span class="c1">// channel å…ƒç´ ç±»åž‹çš„å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">elemtype&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">_type&lt;/span> &lt;span class="c1">// channel å…ƒç´ ç±»åž‹
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ðŸ’¡ ä½¿ç”¨çŽ¯å½¢ç¼“å­˜åŒºçš„å¥½å¤„ï¼šçŽ¯å½¢åœ°ä½¿ç”¨æ•°æ®ï¼Œç±»ä¼¼äºŽä¸€ä¸ªçŽ¯å½¢é“¾è¡¨ï¼Œå¤§å¹…é™ä½Ž GC çš„å¼€é”€ï¼Œä½¿ç”¨æ—¶ä¸éœ€è¦å›žæ”¶å†…å­˜ã€‚&lt;/p>
&lt;h3 id="-å‘é€æŽ¥æ”¶åç¨‹é“¾è¡¨">ðŸ”— å‘é€/æŽ¥æ”¶åç¨‹é“¾è¡¨&lt;/h3>
&lt;p>åœ¨ &lt;code>hchan&lt;/code> ä¸­ï¼Œé€šè¿‡ &lt;code>recvx&lt;/code> å’Œ &lt;code>revcq&lt;/code> ç»„æˆäº†ä¸€ä¸ªæŽ¥æ”¶é“¾è¡¨ï¼›é€šè¿‡ &lt;code>sendx&lt;/code> å’Œ &lt;code>sendq&lt;/code> ç»„æˆäº†ä¸€ä¸ªå‘é€é“¾è¡¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">sendx&lt;/span> &lt;span class="kt">uint&lt;/span> &lt;span class="c1">// å‘é€å…ƒç´ è¿›å…¥çŽ¯å½¢ç¼“å†²åŒºçš„ indexï¼ˆæ¸¸æ ‡ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">recvx&lt;/span> &lt;span class="kt">uint&lt;/span> &lt;span class="c1">// æŽ¥æ”¶å…ƒç´ æ‰€å¤„çš„çŽ¯å½¢ç¼“å†²åŒºçš„ indexï¼ˆæ¸¸æ ‡ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">recvq&lt;/span> &lt;span class="nx">waitq&lt;/span> &lt;span class="c1">// ç­‰å¾…æŽ¥æ”¶æ•°æ®çš„åç¨‹é“¾è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">sendq&lt;/span> &lt;span class="nx">waitq&lt;/span> &lt;span class="c1">// ç­‰å¾…å‘é€æ•°æ®çš„åç¨‹é“¾è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç­‰å¾…å‘é€å’ŒæŽ¥æ”¶çš„åç¨‹åŒå‘é“¾è¡¨ &lt;code>recvq&lt;/code> &lt;code>sendq&lt;/code> éƒ½æ˜¯ &lt;code>waitq&lt;/code> ç±»åž‹ã€‚&lt;code>waitq&lt;/code> æ˜¯ &lt;code>chan.go&lt;/code> ä¸­å®šä¹‰çš„ç»“æž„ä½“ï¼Œæœ‰ &lt;code>first&lt;/code> å’Œ &lt;code>last&lt;/code> ä¸¤ä¸ªå±žæ€§ï¼Œåˆ†åˆ«æŒ‡å‘é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå’Œæœ€åŽä¸€ä¸ªæˆå‘˜ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">waitq&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">first&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">sudog&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">last&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">sudog&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ª &lt;code>waitq&lt;/code> ä¸­çš„æŒ‡é’ˆéƒ½æ˜¯ &lt;code>sudog&lt;/code> ç±»åž‹ã€‚&lt;code>sudog&lt;/code> æ˜¯åç¨‹çš„ä¸€ä¸ªåŒ…è£…ï¼Œå°†ä¸€ä¸ªåç¨‹åŒ…è£…æˆä¸€ä¸ªèŠ‚ç‚¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">sudog&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">g&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">g&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">next&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">sudog&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">prev&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">sudog&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">elem&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">hchan&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ... å…¶ä»–å±žæ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>g&lt;/code> åŒ…è£…äº†åç¨‹ï¼Œä½¿ç”¨ &lt;code>next&lt;/code> &lt;code>prev&lt;/code> æŒ‡é’ˆï¼Œå°†åç¨‹ä¸²è”æˆä¸€ä¸ªé“¾è¡¨ã€‚&lt;/p>
&lt;p>&lt;code>elem&lt;/code> æ˜¯ &lt;code>unsafe&lt;/code> çš„ä¸‡èƒ½æŒ‡é’ˆï¼Œå­˜å‚¨äº†æƒ³è¦æŽ¥æ”¶å˜é‡çš„æ•°æ®çš„æŒ‡é’ˆã€‚æ¯”å¦‚ &lt;code>i &amp;lt;- ch&lt;/code>ï¼Œè¿™é‡Œ &lt;code>elem&lt;/code> å°±ä¼šå­˜å‚¨è¿™ä¸ªå˜é‡ &lt;code>i&lt;/code> çš„æŒ‡é’ˆã€‚&lt;/p>
&lt;h3 id="-ä¿æŠ¤-hchan-çš„äº’æ–¥é”-mutex">ðŸ”’ ä¿æŠ¤ hchan çš„äº’æ–¥é” &lt;code>mutex&lt;/code>&lt;/h3>
&lt;p>è¿™ä¸ª &lt;code>lock mutex&lt;/code> ç”¨æ¥ä¿æŠ¤ &lt;code>hchan struct&lt;/code> çš„æ‰€æœ‰å­—æ®µï¼Œæ‰€æœ‰åç¨‹æƒ³è¦æ“ä½œ &lt;code>hchan&lt;/code> è¿™ä¸ªç»“æž„ä½“çš„å†…å®¹ï¼Œå°±éœ€è¦åŠ è¿™ä¸ª &lt;code>mutex&lt;/code> é”ã€‚&lt;/p>
&lt;p>å¹¶ä¸æ˜¯ç”¨æ¥æŽ’é˜Ÿå‘é€æ•°æ®ã€æŽ¥æ”¶æ•°æ®çš„ã€‚&lt;/p>
&lt;blockquote>
&lt;p>ä¸ºä»€ä¹ˆ channel çš„å†…éƒ¨æœ‰é”ï¼Œè¿˜èƒ½è¾¾åˆ°é«˜å¹¶å‘é‡å‘¢ï¼Ÿ&lt;/p>
&lt;p>channel çš„äº’æ–¥é”åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä»…ç”¨äºŽä¿æŠ¤å°‘æ•°å…³é”®æ“ä½œï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¯»å†™æ“ä½œéƒ½åŠ é”ï¼Œåªæœ‰åœ¨å†™æ•°æ®/è¯»æ•°æ®çš„ä¸€çž¬é—´éœ€è¦åŠ é”ï¼Œä¸éœ€è¦ä¸€ç›´åŠ é”ã€‚&lt;/p>
&lt;p>ä½¿ç”¨äº†å…¶ä»–ä¸€äº›æŠ€æœ¯æ¥æé«˜ channel çš„æ€§èƒ½ï¼Œæ¯”å¦‚ä½¿ç”¨æ— é”çš„å¾ªçŽ¯é˜Ÿåˆ—å®žçŽ°ç¼“å†²åŒºï¼Œå‡å°‘é”çš„ä½¿ç”¨ã€‚&lt;/p>
&lt;p>Go è¯­è¨€çš„è¿è¡Œæ—¶ç³»ç»Ÿï¼ˆruntimeï¼‰å†…éƒ¨å¯¹é”æœ‰ä¸€äº›ä¼˜åŒ–æŠ€æœ¯ï¼Œå¯ä»¥å‡å°‘äº’æ–¥é”çš„å¼€é”€ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="-channel-å‘é€æ•°æ®åŽŸç†">ðŸ™‹â€â™‚ï¸ channel å‘é€æ•°æ®åŽŸç†&lt;/h2>
&lt;p>å¦‚æžœæˆ‘ä»¬æƒ³å‘ channel ä¸­å‘é€æ•°æ®ï¼Œä¼šä½¿ç”¨ &lt;code>&amp;lt;-&lt;/code> å…³é”®å­—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">ch&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">chan&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å‘é€æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">ch&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ª &lt;code>&amp;lt;-&lt;/code> æ˜¯ go ä¸­çš„â€œè¯­æ³•ç³–â€ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼Œä¼šæŠŠ &lt;code>&amp;lt;-&lt;/code> è½¬æ¢æˆ &lt;code>chansend1()&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// chan.go
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// entry point for c &amp;lt;- x from compiled code.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//go:nosplit
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">chansend1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">hchan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">elem&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">chansend&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">elem&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">getcallerpc&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å‘é€æƒ…å½¢">ðŸ“š å‘é€æƒ…å½¢&lt;/h3>
&lt;p>channel çš„å‘é€æƒ…å½¢å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>âž¡ï¸ ç›´æŽ¥å‘é€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ’¾ æ”¾å…¥ç¼“å­˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ’¤ ä¼‘çœ ç­‰å¾…&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="-ç›´æŽ¥å‘é€">âž¡ï¸ ç›´æŽ¥å‘é€&lt;/h4>
&lt;p>å½“å‘é€æ•°æ®æ—¶ï¼Œåœ¨ &lt;code>hchan&lt;/code> çš„ &lt;code>recvq&lt;/code> ä¸­å­˜åœ¨ä¼‘çœ ç­‰å¾…æŽ¥æ”¶çš„åç¨‹ã€‚ï¼ˆè¿™ä¸ªæ—¶å€™ç¼“å­˜ä¸€å®šä¸ºç©ºï¼Œæˆ–è€…æ²¡æœ‰ç¼“å­˜ï¼Œä¸ç”¨è€ƒè™‘ï¼‰&lt;/p>
&lt;p>ç›´æŽ¥å°†æ•°æ®æ‹·è´ç»™è¯¥åç¨‹çš„æŽ¥æ”¶å˜é‡ï¼Œå¹¶å”¤é†’åœ¨ &lt;code>recvq&lt;/code> ä¸­çš„è¿™ä¸ªç­‰å¾…åç¨‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/golang/channel/2.jpg"
width="1000"
height="680"
srcset="https://www.letout.cn/p/golang/channel/2_hu266b57f27733842b4de3c5ae688ce188_59720_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/golang/channel/2_hu266b57f27733842b4de3c5ae688ce188_59720_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="147"
data-flex-basis="352px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// chan.go
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">chansend&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">hchan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">block&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">callerpc&lt;/span> &lt;span class="kt">uintptr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">sg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">recvq&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">dequeue&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="nx">sg&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Found a waiting receiver. We pass the value we want to send
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// directly to the receiver, bypassing the channel buffer (if any).
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">sg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nf">unlock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">},&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ..
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>åŠ é”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»Žé˜»å¡žåº¦åç¨‹é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ª goroutine çš„å°è£…å¯¹è±¡ sudogï¼Œå¦‚æžœä¸ä¸º nilï¼Œç›´æŽ¥å‘é€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ send æ–¹æ³•ä¸­ï¼Œä¼šåŸºäºŽ memmove æ–¹æ³•ï¼Œç›´æŽ¥å°†å…ƒç´ æ‹·è´äº¤ç»™ sudog å¯¹åº”çš„ goroutine&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ send æ–¹æ³•ä¸­ä¼šå®Œæˆè§£é”åŠ¨ä½œ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="-æ”¾å…¥ç¼“å­˜">ðŸ’¾ æ”¾å…¥ç¼“å­˜&lt;/h4>
&lt;p>å½“æ²¡æœ‰åç¨‹åœ¨ç­‰å¾…æŽ¥æ”¶æ•°æ®ï¼Œä½†æ˜¯è¿˜æœ‰ç¼“å­˜ç©ºé—´ &lt;code>qcount &amp;lt; dataqsiz&lt;/code>ï¼Œå°†æ•°æ®æ”¾å…¥çŽ¯å½¢ç¼“å­˜ï¼Œç»´æŠ¤ç´¢å¼• &lt;code>sendx&lt;/code> &lt;code>qcount&lt;/code>ï¼ŒæˆåŠŸè¿”å›žã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/golang/channel/3.jpg"
width="1000"
height="668"
srcset="https://www.letout.cn/p/golang/channel/3_hu266b57f27733842b4de3c5ae688ce188_49519_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/golang/channel/3_hu266b57f27733842b4de3c5ae688ce188_49519_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="359px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// chan.go
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">chansend&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">hchan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">block&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">callerpc&lt;/span> &lt;span class="kt">uintptr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">qcount&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dataqsiz&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Space is available in the channel buffer. Enqueue the element to send.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">qp&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">chanbuf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">sendx&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">typedmemmove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">elemtype&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">qp&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">sendx&lt;/span>&lt;span class="o">++&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">sendx&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dataqsiz&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">sendx&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">qcount&lt;/span>&lt;span class="o">++&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">unlock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>åŠ é”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°†å½“å‰å…ƒç´ æ·»åŠ åˆ°çŽ¯å½¢ç¼“å†²åŒº &lt;code>sendx&lt;/code> å¯¹åº”çš„ä½ç½®&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç»´æŠ¤ç´¢å¼• &lt;code>sendx++&lt;/code> &lt;code>qcount++&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è§£é”ï¼Œè¿”å›žæˆåŠŸ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="-ç­‰å¾…ä¼‘çœ ">ðŸ’¤ ç­‰å¾…ä¼‘çœ &lt;/h4>
&lt;p>å½“æ²¡æœ‰åç¨‹åœ¨ä¼‘çœ ç­‰å¾…æ•°æ®ï¼Œå¹¶ä¸”ç¼“å­˜å·²ç»æ»¡äº†ï¼ˆæˆ–æ²¡æœ‰ç¼“å­˜ï¼‰ï¼Œå°†è‡ªå·±åŒ…è£…æˆä¸€ä¸ª &lt;code>sudog&lt;/code>ï¼Œæ”¾å…¥ &lt;code>sendq&lt;/code> é˜Ÿåˆ—ï¼Œè§£é”åŽè¿›è¡Œä¼‘çœ ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/golang/channel/4.jpg"
width="1181"
height="764"
srcset="https://www.letout.cn/p/golang/channel/4_hu80309041e5bf5d6f5c3d8c77d1463a3a_68006_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/golang/channel/4_hu80309041e5bf5d6f5c3d8c77d1463a3a_68006_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="370px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">chansend&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">hchan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">block&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">callerpc&lt;/span> &lt;span class="kt">uintptr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Block on the channel.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">gp&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">getg&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">mysg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">acquireSudog&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1">// åŒ…è£…æˆ sudog
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">elem&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">ep&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">g&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">gp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">waiting&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">mysg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">sendq&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">enqueue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mysg&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// å…¥é˜Ÿ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">atomic&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Store8&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">parkingOnChan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">gopark&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">chanparkcommit&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Pointer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">waitReasonChanSend&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">traceEvGoBlockSend&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// ä¼‘çœ ï¼Œä¹‹åŽæ”¹åç¨‹å¡åœ¨è¿™æ®µä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">KeepAlive&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ep&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// someone woke us up.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">mysg&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">waiting&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="c1">// å”¤é†’è¿™ä¸ªåç¨‹ï¼Œåªéœ€è¦ç»´æŠ¤ä¸€ä¸‹æ•°æ®å³å¯ï¼ˆè¯¥åç¨‹è¢«å”¤é†’ï¼Œæ•°æ®å·²ç»æ˜¯è¢«å–èµ°äº†çš„ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">throw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;G waiting list is corrupted&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">waiting&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">activeStackChans&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">closed&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">param&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">releasetime&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">blockevent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">releasetime&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">t0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">releaseSudog&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mysg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">closed&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">closed&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">throw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;chansend: spurious wakeup&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">plainError&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;send on closed channel&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>åŠ é”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æž„é€ å°è£…å½“å‰ goroutine çš„ sudog å¯¹è±¡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®ŒæˆæŒ‡é’ˆæŒ‡å‘ï¼Œå»ºç«‹ sudogã€goroutineã€channel ä¹‹é—´çš„æŒ‡å‘å…³ç³»&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŠŠ sudog æ·»åŠ åˆ°å½“å‰ channel çš„é˜»å¡žå†™åç¨‹é˜Ÿåˆ—ä¸­&lt;/p>
&lt;/li>
&lt;li>
&lt;p>park å½“å‰åç¨‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å€˜è‹¥åç¨‹ä»Ž park ä¸­è¢«å”¤é†’ï¼Œåˆ™å›žæ”¶ sudogï¼ˆsudogèƒ½è¢«å”¤é†’ï¼Œå…¶å¯¹åº”çš„å…ƒç´ å¿…ç„¶å·²ç»è¢«è¯»åç¨‹å–èµ°ï¼Œç»´æŠ¤å…¶ä»–æ•°æ®ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è§£é”&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-chanel-æŽ¥æ”¶æ•°æ®åŽŸç†">ðŸ’â€â™‚ï¸ Chanel æŽ¥æ”¶æ•°æ®åŽŸç†&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">ch&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">chan&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å‘é€æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">ch&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æŽ¥æ”¶æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nx">ch&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æŽ¥æ”¶æ•°æ®çš„ &lt;code>&amp;lt;-&lt;/code> åŒæ ·æ˜¯ go ä¸­çš„â€œè¯­æ³•ç³–â€ã€‚&lt;/p>
&lt;p>åœ¨ç¼–è¯‘é˜¶æ®µï¼Œå¦‚æžœæ˜¯ &lt;code>i &amp;lt;- ch&lt;/code> ä¼šè½¬æ¢æˆ &lt;code>runtime.chanrecv1()&lt;/code>ï¼›å¦‚æžœæ˜¯ &lt;code>i, ok &amp;lt;- ch&lt;/code> ä¼šè½¬åŒ–æˆ &lt;code>runtime.chanrecv2()&lt;/code>ï¼Œä¸¤è€…æœ€ç»ˆéƒ½ä¼šè°ƒç”¨ &lt;code>chanrecv()&lt;/code> æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// entry points for &amp;lt;- c from compiled code.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//go:nosplit
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">chanrecv1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">hchan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">elem&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">chanrecv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">elem&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//go:nosplit
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">chanrecv2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">hchan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">elem&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">received&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">received&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nf">chanrecv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">elem&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-æŽ¥æ”¶æƒ…å½¢">ðŸ“š æŽ¥æ”¶æƒ…å½¢&lt;/h3>
&lt;p>å¯ä»¥å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››å¤§ç±»ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>âž¡ï¸ æŽ¥æ”¶æœ‰é˜»å¡žçš„å‘é€åç¨‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ’¿ æŽ¥æ”¶æ— é˜»å¡žå‘é€åç¨‹ï¼Œä¸”ç¼“å†²åŒºæœ‰å…ƒç´ &lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ’¤ æŽ¥æ”¶æ— é˜»å¡žå‘é€åç¨‹ï¼Œä¸”ç¼“å†²åŒºæ— å…ƒç´ &lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="-æŽ¥æ”¶æœ‰é˜»å¡žçš„å‘é€åç¨‹">âž¡ï¸ æŽ¥æ”¶æœ‰é˜»å¡žçš„å‘é€åç¨‹&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>æ— ç¼“å†²åŒºï¼Œæœ‰åç¨‹åœ¨ &lt;code>sendq&lt;/code> ä¸­ç­‰å¾…å‘é€æ•°æ®ï¼Œç›´æŽ¥å°†æ•°æ®ä»Žå‘é€åç¨‹ä¸­æ‹·è´è¿‡æ¥ï¼Œå†å”¤é†’è¯¥å‘é€åç¨‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœ‰ç¼“å†²åŒºï¼Œè¯»å–ç¼“å†²åŒº &lt;code>recvx&lt;/code> å…ƒç´ ï¼Œå°† &lt;code>sendq&lt;/code> ä¸­çš„ä¸€ä¸ªå‘é€åç¨‹çš„å…ƒç´ å†™å…¥ç¼“å†²åŒºã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¸ºä»€ä¹ˆæœ‰å‘é€åç¨‹é˜»å¡žçš„æ—¶å€™ï¼Œè¿˜æ˜¯è¦ä»Žç¼“å­˜ä¸­èŽ·å–æ•°æ®å‘¢ï¼Ÿ&lt;/p>
&lt;p>ç¼“å­˜åŒºçš„æ•°æ®ä¸€å®šæ¯”ç­‰å¾…å‘é€çš„åç¨‹ä¸­çš„æ•°æ®æ›´æ—©ï¼›å¦‚æžœä¸ä»Žç¼“å­˜ä¸­æŽ¥æ”¶ï¼Œç¼“å­˜ä¸­çš„æ•°æ®å¯èƒ½ä¸€ç›´æ‹¿ä¸èµ°ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/golang/channel/5.jpg"
width="1000"
height="742"
srcset="https://www.letout.cn/p/golang/channel/5_hu266b57f27733842b4de3c5ae688ce188_73103_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/golang/channel/5_hu266b57f27733842b4de3c5ae688ce188_73103_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// chan.go
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">chanrecv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">hchan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">block&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">selected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">received&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Just found waiting sender with not closed.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">sg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">sendq&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">dequeue&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="nx">sg&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">recv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">sg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nf">unlock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">},&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">recv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">hchan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">sg&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">sudog&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">unlockf&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">skip&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dataqsiz&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">ep&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// copy data from sender
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">recvDirect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">elemtype&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">sg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Queue is full. Take the item at the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// head of the queue. Make the sender enqueue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// its item at the tail of the queue. Since the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// queue is full, those are both the same slot.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">qp&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">chanbuf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">recvx&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">ep&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">typedmemmove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">elemtype&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">qp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">typedmemmove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">elemtype&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">qp&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">sg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">elem&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">recvx&lt;/span>&lt;span class="o">++&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">recvx&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dataqsiz&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">recvx&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">sendx&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">recvx&lt;/span> &lt;span class="c1">// c.sendx = (c.sendx+1) % c.dataqsiz
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">elem&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gp&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">sg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">g&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">unlockf&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">param&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Pointer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">sg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">success&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">goready&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">gp&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">skip&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>åŠ é”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»Žé˜»å¡žå‘é€åç¨‹é˜Ÿåˆ—ä¸­èŽ·å–åˆ°ä¸€ä¸ªå‘é€åç¨‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å€˜è‹¥ channel æ— ç¼“å†²åŒºï¼Œåˆ™ç›´æŽ¥è¯»å–å‘é€åç¨‹å…ƒç´ ï¼Œå¹¶å”¤é†’å‘é€åç¨‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å€˜è‹¥ channel æœ‰ç¼“å†²åŒºï¼Œåˆ™è¯»å–ç¼“å†²åŒºå¤´éƒ¨å…ƒç´ ï¼Œå¹¶å°†å‘é€åç¨‹å…ƒç´ å‘é€å…¥ç¼“å†²åŒºå°¾éƒ¨åŽå”¤é†’å‘é€åç¨‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è§£é”ï¼Œè¿”å›ž&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="-æŽ¥æ”¶æ— é˜»å¡žå‘é€åç¨‹ä¸”ç¼“å†²åŒºæœ‰å…ƒç´ ">ðŸ’¿ æŽ¥æ”¶æ— é˜»å¡žå‘é€åç¨‹ï¼Œä¸”ç¼“å†²åŒºæœ‰å…ƒç´ &lt;/h4>
&lt;p>åœ¨ channel ä¸­ï¼Œå¦‚æžœæ²¡æœ‰åç¨‹åœ¨å‘é€é˜Ÿåˆ— &lt;code>sendq&lt;/code> ç­‰å¾…æŽ¥æ”¶ï¼Œåˆ¤æ–­è¯¥ channel ä¸­æœ‰æ— ç¼“å­˜ï¼Œå¦‚æžœæœ‰ï¼Œç›´æŽ¥ä»Žç¼“å­˜ä¸­å–èµ°ä¸€ä¸ªæ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/golang/channel/6.jpg"
width="1000"
height="671"
srcset="https://www.letout.cn/p/golang/channel/6_hu266b57f27733842b4de3c5ae688ce188_50425_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/golang/channel/6_hu266b57f27733842b4de3c5ae688ce188_50425_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="357px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">chanrecv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">hchan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">block&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">selected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">received&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">qcount&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Receive directly from queue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">qp&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">chanbuf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">recvx&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">ep&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">typedmemmove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">elemtype&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">qp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">typedmemclr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">elemtype&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">qp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">recvx&lt;/span>&lt;span class="o">++&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">recvx&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dataqsiz&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">recvx&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">qcount&lt;/span>&lt;span class="o">--&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">unlock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>åŠ é”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>èŽ·å– &lt;code>recvx&lt;/code> å¯¹åº”ä½ç½®çš„å…ƒç´ &lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>recvx++&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>qcount--&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è§£é”ï¼Œè¿”å›ž&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="-æŽ¥æ”¶æ— é˜»å¡žå‘é€åç¨‹ä¸”ç¼“å†²åŒºæ— å…ƒç´ ">ðŸ’¤ æŽ¥æ”¶æ— é˜»å¡žå‘é€åç¨‹ï¼Œä¸”ç¼“å†²åŒºæ— å…ƒç´ &lt;/h4>
&lt;p>åœ¨ channel ä¸­ï¼Œå¦‚æžœåœ¨ &lt;code>sendq&lt;/code> ä¸­æ²¡æœ‰åç¨‹åœ¨ç­‰å¾…å‘é€æ•°æ®ï¼Œå¹¶ä¸” &lt;code>buf&lt;/code> ä¸­æ²¡æœ‰ç¼“å­˜ï¼Œå°†è¯¥æŽ¥æ”¶åç¨‹åŒ…è£…æˆ &lt;code>sudog&lt;/code>ï¼Œå¹¶æ”¾å…¥ç­‰å¾…é˜Ÿåˆ— &lt;code>recvq&lt;/code> ä¸­ï¼Œè¿›è¡Œä¼‘çœ ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ”¾å…¥é˜Ÿåˆ—çš„æŽ¥æ”¶åç¨‹ï¼Œå½“è¢«å”¤é†’æ—¶ï¼Œæ•°æ®å·²ç»æ‹·è´åˆ°ä½ï¼Œä¸éœ€è¦è€ƒè™‘å¦‚ä½•æ‹·è´ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/golang/channel/7.jpg"
width="1106"
height="671"
srcset="https://www.letout.cn/p/golang/channel/7_hu4e8996cd4c4e0e970e0cf1eb006e512e_60652_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/golang/channel/7_hu4e8996cd4c4e0e970e0cf1eb006e512e_60652_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="164"
data-flex-basis="395px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">chanrecv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">hchan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ep&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pointer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">block&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">selected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">received&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gp&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">getg&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">mysg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">acquireSudog&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">elem&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">ep&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">waiting&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">mysg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">g&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">gp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">param&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">recvq&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">enqueue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mysg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">atomic&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Store8&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">parkingOnChan&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">gopark&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">chanparkcommit&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">unsafe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Pointer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lock&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nx">waitReasonChanReceive&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">traceEvGoBlockRecv&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">waiting&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">success&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">param&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">mysg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">releaseSudog&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mysg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>åŠ é”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°è£…å½“å‰æŽ¥æ”¶åç¨‹çš„ &lt;code>sudog&lt;/code> å¯¹è±¡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®ŒæˆæŒ‡é’ˆæŒ‡å‘ï¼Œå»ºç«‹ &lt;code>sudog&lt;/code>ã€&lt;code>goroutine&lt;/code>ã€&lt;code>channel&lt;/code> ä¹‹é—´çš„æŒ‡å‘å…³ç³»&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŠŠ &lt;code>sudog&lt;/code> æ·»åŠ åˆ°å½“å‰ &lt;code>channel&lt;/code> çš„é˜»å¡žè¯»åç¨‹é˜Ÿåˆ—ä¸­&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>park&lt;/code> å½“å‰åç¨‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å€˜è‹¥åç¨‹ä»Ž &lt;code>park&lt;/code> ä¸­è¢«å”¤é†’ï¼Œåˆ™å›žæ”¶ &lt;code>sudog&lt;/code>ï¼ˆ&lt;code>sudog&lt;/code>èƒ½è¢«å”¤é†’ï¼Œå…¶å¯¹åº”çš„å…ƒç´ å¿…ç„¶å·²ç»è¢«å†™å…¥ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è§£é”ï¼Œè¿”å›ž&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒ">ðŸ“–å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://zhuanlan.zhihu.com/p/597232906" target="_blank" rel="noopener"
>https://zhuanlan.zhihu.com/p/597232906&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://juejin.cn/post/7265891728163635215?searchId=202308131806253D2D64A0EC686F660F01" target="_blank" rel="noopener"
>https://juejin.cn/post/7265891728163635215?searchId=202308131806253D2D64A0EC686F660F01&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å›¾ç‰‡å…¨éƒ¨æ¥è‡ªäºŽ &lt;a class="link" href="https://zhuanlan.zhihu.com/p/597232906" target="_blank" rel="noopener"
>https://zhuanlan.zhihu.com/p/597232906&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>æ·±å…¥ Kafka</title><link>https://www.letout.cn/p/kafka/more/</link><pubDate>Fri, 31 Mar 2023 08:08:08 +0800</pubDate><guid>https://www.letout.cn/p/kafka/more/</guid><description>&lt;img src="https://www.letout.cn/p/kafka/more/kafka.webp" alt="Featured image of post æ·±å…¥ Kafka" />&lt;h2 id="-æ·±å…¥-kafa">ðŸ¤¿ æ·±å…¥ Kafa&lt;/h2>
&lt;h3 id="-é›†ç¾¤ä¸ŽæŽ§åˆ¶å™¨">ðŸ›©ï¸ é›†ç¾¤ä¸ŽæŽ§åˆ¶å™¨&lt;/h3>
&lt;p>Kafka ä½¿ç”¨ Zookeeper æ¥ç»´æŠ¤é›†ç¾¤æˆå‘˜çš„ä¿¡æ¯ï¼Œæ¯ä¸ª Broker éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå¯ä»¥åœ¨é…ç½®ä¸­æŒ‡å®šæˆ–éšæœºç”Ÿæˆï¼‰ï¼Œåœ¨ Broker å¯åŠ¨æ—¶ï¼Œé€šè¿‡åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹å°†è‡ªå·±çš„ ID æ³¨å†Œåˆ° Zookeeperã€‚&lt;/p>
&lt;p>æŽ§åˆ¶å™¨æœ¬èº«å°±æ˜¯ä¸€ä¸ª Brokerï¼Œå¤åˆ¶åˆ†åŒºé¢†å¯¼çš„é€‰ä¸¾å·¥ä½œã€‚é›†ç¾¤çš„ç¬¬ä¸€ä¸ªå¯åŠ¨ Broker é€šè¿‡åœ¨ Zookeeper ä¸­åˆ›å»ºä¸€ä¸ª /controller ä¸´æ—¶èŠ‚ç‚¹è®©è‡ªå·±æˆä¸ºæŽ§åˆ¶å™¨ï¼Œå…¶ä»– Broker å¯åŠ¨æ—¶å†å°è¯•åˆ›å»ºï¼Œä¼šæ”¶åˆ°èŠ‚ç‚¹å·²ç»å­˜åœ¨å¼‚å¸¸ï¼Œä¼šåœ¨æŽ§åˆ¶å™¨èŠ‚ç‚¹ä¸Šåˆ›å»º Zookeeper watch å¯¹è±¡ï¼ŒæŽ¥å—èŠ‚ç‚¹å˜æ›´é€šçŸ¥ï¼Œç¡®ä¿é›†ç¾¤ä¸­åªä¼šæœ‰ä¸€ä¸ªæŽ§åˆ¶å™¨å­˜åœ¨ã€‚&lt;/p>
&lt;h3 id="-å¤åˆ¶">âœˆï¸ å¤åˆ¶&lt;/h3>
&lt;p>å¤åˆ¶åŠŸèƒ½å¯ä»¥è®© Kafka åœ¨ä¸ªåˆ«èŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œä»ç„¶ä¿è¯ Kafka çš„å¯ç”¨æ€§å’ŒæŒä¹…æ€§ã€‚&lt;/p>
&lt;p>Kafka ä½¿ç”¨ Topic ç»„ç»‡æ•°æ®ï¼›æ¯ä¸ª Topic è¢«åˆ†ä¸ºè‹¥å¹²ä¸ª Partitionï¼›æ¯ä¸ª Partition æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œè¢«ä¿å­˜åœ¨ Broker ä¸Šã€‚å‰¯æœ¬æœ‰ä¸¤ç§ç±»åž‹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é¦–é¢†å‰¯æœ¬ &lt;code>leader&lt;/code>&lt;/p>
&lt;p>æ¯ä¸ª Partition éƒ½æœ‰ä¸€ä¸ªé¦–é¢†å‰¯æœ¬ã€‚ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œé¦–é¢†å‰¯æœ¬å¤åˆ¶æ‰€æœ‰çš„ ç”Ÿäº§ &amp;amp; æ¶ˆè´¹è¯·æ±‚ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŒæ­¥å‰¯æœ¬ &lt;code>follower&lt;/code>&lt;/p>
&lt;p>åŒæ­¥å‰¯æœ¬ä¸å¤„ç†ä»»ä½•è¯·æ±‚ï¼Œå”¯ä¸€çš„ä»»åŠ¡å°±æ˜¯ä»Ž Leader å¤åˆ¶æ¶ˆæ¯ï¼Œä¿æŒä¸Ž leader ä¸€è‡´çš„çŠ¶æ€ã€‚follower å‘ leader å‘é€èŽ·å–æ•°æ®çš„è¯·æ±‚ï¼ˆä¸Žæ¶ˆè´¹è€…èŽ·å–æ•°æ®çš„è¯·æ±‚ç›¸åŒï¼‰ï¼Œleader å°†æ¶ˆæ¯å“åº”å‘é€ç»™ followerï¼ŒåŒ…å«æŒ‡å®šåç§»é‡çš„æ¶ˆæ¯ï¼ˆæœ‰åºï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-å¤„ç†è¯·æ±‚">ðŸ›« å¤„ç†è¯·æ±‚&lt;/h3>
&lt;p>Broker å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶åšå‡ºå“åº”ï¼Œä¼šæŒ‰ç…§è¯·æ±‚è¾¾åˆ°çš„é¡ºåºè¿›è¡Œå¤„ç†ï¼Œè¿™ç§ã€Œé¡ºåºæ€§ä¿è¯è®© Kafka å…·å¤‡äº†æ¶ˆæ¯é˜Ÿåˆ—çš„ç‰¹æ€§ã€‚ã€&lt;/p>
&lt;p>Broker ä¼šåœ¨å®ƒæ‰€ç›‘å¬çš„æ¯ä¸€ä¸ªç«¯å£ä¸Šè¿è¡Œä¸€ä¸ª &lt;code>Acceptor&lt;/code> çº¿ç¨‹ï¼Œç›‘å¬åˆ°è¾¾çš„è¿žæŽ¥ï¼ˆIOå¤šè·¯å¤ç”¨ï¼‰ï¼›å½“è¯·æ±‚è¾¾åˆ°æ—¶ï¼Œä¼šåˆ©ç”¨ n ä¸ª &lt;code>Processor&lt;/code> çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¤åˆ¶ä»Žå®¢æˆ·ç«¯èŽ·å–è¯·æ±‚æ¶ˆæ¯ï¼Œå¹¶æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ï¼›æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä¼šæœ‰ m ä¸ª &lt;code>Handler&lt;/code> çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/more/thread.png"
width="856"
height="299"
srcset="https://www.letout.cn/p/kafka/more/thread_hua0b819faaccb7b1eb257047290f83afd_30393_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/more/thread_hua0b819faaccb7b1eb257047290f83afd_30393_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="286"
data-flex-basis="687px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å…ƒæ•°æ®è¯·æ±‚&lt;/p>
&lt;p>å®¢æˆ·ç«¯ä½¿ç”¨ã€Œå…ƒæ•°æ®è¯·æ±‚ã€ï¼ŒèŽ·å–æ‰€æœ‰ä¸»é¢˜åˆ—è¡¨ï¼ˆåˆ†åŒºã€é¦–é¢†ã€å‰¯æœ¬ç­‰æ‰€æœ‰ä¿¡æ¯ï¼‰ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯ç¼“å­˜èµ·æ¥ï¼Œä»¥æ­¤çŸ¥é“å‘å“ªé‡Œå‘é€è¯·æ±‚ã€‚&lt;/p>
&lt;p>å…ƒæ•°æ®è¯·æ±‚ä¼šå®šæ—¶/é‡åˆ°é”™è¯¯æ—¶ï¼Œå®šæ—¶åˆ·æ–°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç”Ÿäº§è¯·æ±‚&lt;/p>
&lt;p>Kafka ä½¿ç”¨ &lt;code>acks = 0/1/all&lt;/code> å®¢æˆ·ç«¯é…ç½®ï¼ŒæŒ‡å®šäº†éœ€è¦å¤šå°‘ä¸ª Broker ç¡®è®¤æ‰å¯ä»¥è®¤ä¸ºä¸€ä¸ªæ¶ˆæ¯æ˜¯å†™å…¥æˆåŠŸçš„ã€‚&lt;/p>
&lt;p>æ¶ˆæ¯è¢« Broker å†™å…¥æœ¬åœ°ç£ç›˜ã€‚åœ¨ Linux ç³»ç»Ÿä¸Šï¼Œæ¶ˆæ¯ä¼šè¢«å†™åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ Page Cache é‡Œï¼Œå¹¶ä¸ä¿è¯ä»€ä¹ˆæ˜¯å¦ä¼šè¢«åˆ·æ–°åˆ°ç£ç›˜ä¸Šã€‚Kafka ä¾èµ–å¤åˆ¶åŠŸèƒ½ä¿éšœæ¶ˆæ¯çš„æŒä¹…æ€§ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¶ˆè´¹è¯·æ±‚&lt;/p>
&lt;p>Consumer å‘ Broker å‘é€è¯·æ±‚ï¼Œä»Žä¸»é¢˜åˆ†åŒºé‡ŒèŽ·å–ç‰¹å®šåç§»é‡çš„æ¶ˆæ¯ï¼Œç±»ä¼¼äºŽè¯´ï¼šâ€œè¯·æŠŠä¸»é¢˜ Test åˆ†åŒº 0 åç§»é‡ä»Ž 53 å¼€å§‹çš„æ¶ˆæ¯å‘ç»™æˆ‘â€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…¶ä»–è¯·æ±‚&lt;/p>
&lt;p>åœ¨æ—§ç‰ˆæœ¬çš„ Kafka ä¸­ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨ Zookeeper æ¥è·Ÿè¸ªåç§»é‡ï¼Œåœ¨æ¶ˆè´¹è€…å¯åŠ¨çš„æ—¶å€™ï¼Œé€šè¿‡æ£€æŸ¥ä¿æŒåœ¨ Zookeeper ä¸Šçš„åç§»é‡çŸ¥é“ä»Žå“ªé‡Œå¼€å§‹å¤„ç†æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œåç§»é‡ offset ä¿å­˜åœ¨ç‰¹å®šç‰ˆæœ¬çš„ Kafka ä¸»é¢˜ &lt;code>__consumer_offset&lt;/code> ä¸Šã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ç‰©ç†å­˜å‚¨">ðŸ’º ç‰©ç†å­˜å‚¨&lt;/h3>
&lt;p>Kafka çš„åŸºæœ¬å­˜å‚¨å•å…ƒæ˜¯åˆ†åŒº Partitionã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ–‡ä»¶ç®¡ç†&lt;/p>
&lt;p>ä¿ç•™æ•°æ®æ˜¯ Kafka çš„ä¸€ä¸ªåŸºæœ¬ç‰¹æ€§ï¼ŒKafka ä¸ä¼šä¸€ç›´ä¿ç•™æ•°æ®ï¼Œä¹Ÿä¸ä¼šç­‰åˆ°æ‰€æœ‰çš„æ•°æ®éƒ½æ¶ˆè´¹å®Œæ‰åˆ é™¤ã€‚Kafka å¯ä»¥ä¸ºæ¯ä¸ªä¸»é¢˜é…ç½®æ•°æ®çš„ä¿ç•™æœŸé™ï¼Œè§„å®šæ•°æ®åœ¨åˆ é™¤ä¹‹å‰å¯ä»¥ä¿ç•™å¤šé•¿æ—¶é—´ï¼Œæˆ–è€…æ¸…ç†æ•°æ®ä¹‹å‰å¯ä»¥ä¿ç•™çš„æ•°æ®å¤§å°ã€‚&lt;/p>
&lt;p>Kafka ä¿å­˜çš„æ•°æ®é€šå¸¸éƒ½æ˜¯å¾ˆåºžå¤§çš„ï¼Œåœ¨ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­æŸ¥æ‰¾å’Œåˆ é™¤æ¶ˆå¤±æ˜¯å¾ˆè´¹æ—¶çš„ï¼Œä¹Ÿå¾ˆå®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥ä¼šæŠŠæ¯ä¸ªåˆ†åŒºåˆ†æˆè‹¥å¹²ä¸ªã€Œç‰‡æ®µã€&lt;code>Partition -&amp;gt; Segment&lt;/code>ã€‚
åœ¨ Broker å‘ Partition å†™å…¥æ•°æ®æ—¶ï¼Œå¦‚æžœè¾¾åˆ°ä¸Šé™ï¼Œå°±å…³é—­å½“å‰æ–‡ä»¶ï¼Œå¹¶æ‰“å¼€ä¸€ä¸ªæ–°æ–‡ä»¶ã€‚&lt;/p>
&lt;p>å½“å‰æ­£åœ¨å†™å…¥æ•°æ®çš„ç‰‡æ®µå«åšæ´»è·ƒç‰‡æ®µï¼Œã€Œæ´»è·ƒç‰‡æ®µæ°¸è¿œä¸ä¼šè¢«åˆ é™¤ã€ã€‚ï¼ˆå³ä½¿æ´»è·ƒç‰‡æ®µä¸­çš„æ¶ˆæ¯è¶…è¿‡äº†ä¿ç•™æ—¶é—´ï¼Œç‰‡æ®µåœ¨è¢«å…³é—­ä¹‹å‰æ— æ³•è¢«åˆ é™¤ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ–‡ä»¶æ ¼å¼&lt;/p>
&lt;p>Kafka æŠŠæ¶ˆæ¯å’Œåç§»é‡ä¿å­˜åœ¨æ–‡ä»¶é‡Œï¼Œä¿å­˜åœ¨ç£ç›˜ä¸Šçš„æ•°æ®æ ¼å¼ä¸Žä»Žç”Ÿäº§è€…å‘é€æ¥æˆ–å‘é€ç»™æ¶ˆè´¹è€…çš„æ•°æ®æ ¼å¼æ˜¯ä¸€æ ·çš„ï¼ŒKafka ä¸ä¼šè¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;p>ç”Ÿäº§è€…å‘é€çš„æ˜¯è¢«åŽ‹ç¼©è¿‡çš„æ¶ˆæ¯ï¼ŒåŒä¸€ä¸ªæ‰¹æ¬¡çš„æ¶ˆæ¯ä¼šè¢«åŽ‹ç¼©åœ¨ä¸€èµ·ï¼Œå‘é€ç»™ Brokerï¼Œç„¶åŽ Broker å†å‘é€ç»™æ¶ˆè´¹è€…ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/more/message.png"
width="897"
height="349"
srcset="https://www.letout.cn/p/kafka/more/message_hu5179d63639435460e9b73156324f1016_483489_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/more/message_hu5179d63639435460e9b73156324f1016_483489_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="257"
data-flex-basis="616px"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç´¢å¼•&lt;/p>
&lt;p>Kafka ç»™æ¯ä¸ªåˆ†åŒºéƒ½ç»´æŠ¤äº†ä¸€ä¸ªç¨€ç–çš„å“ˆå¸Œç´¢å¼•ï¼ŒæŠŠåç§»é‡æ˜ å°„åˆ°ç‰‡æ®µæ–‡ä»¶å’Œåç§»é‡åœ¨æ–‡ä»¶é‡Œçš„ä½ç½®ã€‚&lt;/p>
&lt;p>ç´¢å¼•å’Œ Partition ä¸€æ ·è¢«åˆ†ä¸ºç‰‡æ®µï¼Œæ‰€ä»¥åœ¨åˆ é™¤æ¶ˆæ¯æ—¶ï¼Œä¹Ÿä¼šåˆ é™¤ç›¸åº”çš„ç´¢å¼•ã€‚&lt;/p>
&lt;p>Kafka ä¸ä¼šç»´æŠ¤ç´¢å¼•çš„æ ¡éªŒå’Œï¼Œç´¢å¼•å‡ºçŽ°æŸåï¼Œæˆ–åˆ é™¤äº†ç´¢å¼•ï¼ˆå®Œå…¨å®‰å…¨ï¼‰ï¼ŒKafka éƒ½ä¼šè‡ªåŠ¨é‡æ–°ç”Ÿæˆç´¢å¼•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-å¯é æ•°æ®ä¼ é€’">ðŸ‘Œ å¯é æ•°æ®ä¼ é€’&lt;/h2>
&lt;p>Kafka çš„å¯é æ€§å¹¶ä¸æ˜¯å•æ–¹é¢çš„äº‹æƒ…ï¼Œåº”è¯¥ä»Žæ•´ä¸ªç³»ç»Ÿå±‚é¢æ¥è€ƒè™‘å¯é æ€§çš„é—®é¢˜ï¼Œå¦‚åº”ç”¨æž¶æž„ã€ç”Ÿäº§è€…æ¶ˆè´¹è€…çš„é…ç½®ã€ä¸»é¢˜é…ç½®ã€Broker é…ç½®ã€‚&lt;/p>
&lt;p>ç³»ç»Ÿçš„å¯é æ€§éœ€è¦åœ¨è®¸å¤šæ–¹é¢åšå‡ºæƒè¡¡ï¼Œå¦‚å¤æ‚æ€§ã€å¯ç”¨æ€§ã€ç£ç›˜ç©ºé—´ä½¿ç”¨ç­‰ã€‚&lt;/p>
&lt;h3 id="-å¯é æ€§ä¿è¯">ðŸš— å¯é æ€§ä¿è¯&lt;/h3>
&lt;p>å…³ç³»åž‹æ•°æ®åº“ä½¿ç”¨ &lt;code>ACID&lt;/code> æœºåˆ¶æ¥ä¿éšœæ•°æ®çš„å¯é æ€§ã€‚ä¸€ä¸ªç³»ç»Ÿçš„ä¿è¯æœºåˆ¶å¯¹äºŽæž„å»ºå¯é çš„åº”ç”¨ç¨‹åºæ¥è¯´è‡³å…³é‡è¦ã€‚
Kafka å¯ä»¥å†ä»¥ä¸‹æ–¹é¢ä½œå‡ºä¿è¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ›¸ Kafka å¯ä»¥ä¿è¯ åˆ†åŒº Partition æ¶ˆæ¯çš„é¡ºåºã€‚&lt;/p>
&lt;p>ä½¿ç”¨åŒä¸€ä¸ªç”Ÿäº§è€…å¾€åŒä¸€ä¸ªåˆ†åŒºå†™å…¥æ¶ˆæ¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ›¸ åªæœ‰å½“æ¶ˆæ¯è¢«å†™å…¥åˆ†åŒºçš„æ‰€æœ‰åŒæ­¥å‰¯æœ¬æ—¶ï¼ˆä¸ä¸€å®šè¦å†™å…¥ç£ç›˜ï¼‰ï¼Œæ¶ˆæ¯æ‰è¢«è®¤ä¸ºæ˜¯â€œå·²æäº¤â€œçš„ã€‚&lt;/p>
&lt;p>ç”Ÿäº§è€…å¯ä»¥é€‰æ‹©æŽ¥æ”¶ä¸åŒç±»åž‹çš„ç¡®è®¤ï¼ˆacksï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ›¸ åªè¦è¿˜æœ‰ä¸€ä¸ªå‰¯æœ¬æ˜¯æ´»è·ƒçš„ï¼Œå·²æäº¤çš„æ¶ˆæ¯å°±ä¸ä¼šä¸¢å¤±ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ›¸ æ¶ˆè´¹è€…åªèƒ½è¯»å–åˆ°å·²æäº¤çš„æ¶ˆæ¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Kafka çš„ç›¸å…³é…ç½®å‚æ•°ï¼Œå¯¹æ‰€éœ€è¦çš„å¯é æ€§åšå‡ºã€Œæƒè¡¡ã€ï¼šæ¶ˆæ¯çš„ã€Œå¯é æ€§ã€ä¸€è‡´æ€§ã€çš„é‡è¦ç¨‹åº¦ä¸Žã€Œå¯ç”¨æ€§ã€é«˜åžåé‡ã€ä½Žå»¶è¿Ÿã€ç¡¬ä»¶æˆæœ¬ã€çš„é‡è¦æ€§ä¹‹é—´çš„æƒè¡¡ã€‚&lt;/p>
&lt;h3 id="-å¤åˆ¶çš„å¯é ">ðŸš“ å¤åˆ¶çš„å¯é &lt;/h3>
&lt;p>Kafka çš„å¤åˆ¶æœºåˆ¶å’Œåˆ†åŒºå‰¯æœ¬æž¶æž„æ˜¯ Kafka å¯é æ€§ä¿è¯çš„æ ¸å¿ƒã€‚&lt;/p>
&lt;p>æŠŠæ¶ˆæ¯å†™å…¥å¤šä¸ªå‰¯æœ¬å¯ä»¥ä½¿ Kafka åœ¨å‘ç”Ÿå´©æºƒæ—¶ï¼Œä¿è¯æ¶ˆæ¯çš„ã€ŒæŒä¹…æ€§ã€ã€‚&lt;/p>
&lt;p>Kafka çš„ä¸»é¢˜ Topic è¢«åˆ†ä¸ºå¤šä¸ªåˆ†åŒº Partitionï¼Œåˆ†åŒºæ˜¯æœ€åŸºæœ¬çš„æ•°æ®å—ã€‚åˆ†åŒºå¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼ŒåŒ…å«ä¸€ä¸ªé¦–é¢† leader å’Œå¤šä¸ªåŒæ­¥å‰¯æœ¬ followerï¼Œleader è´Ÿè´£è¯»&amp;amp;å†™äº‹ä»¶ï¼Œå…¶ä»–å‰¯æœ¬åªéœ€è¦ä¸Žé¦–é¢†ä¿æŒåŒæ­¥ï¼Œå¹¶åŠæ—¶å¤åˆ¶æœ€æ–°çš„äº‹ä»¶ã€‚&lt;/p>
&lt;h3 id="-broker-çš„å¯é ">ðŸš• Broker çš„å¯é &lt;/h3>
&lt;p>Broker æœ‰ &lt;code>3&lt;/code> ä¸ªé…ç½®å‚æ•°ä¼šå½±å“ Kafka å­˜å‚¨æ¶ˆæ¯çš„å¯é æ€§ã€‚ï¼ˆå¯ä»¥åº”ç”¨åœ¨ broker çº§åˆ«ï¼ŒæŽ§åˆ¶æ‰€æœ‰ä¸»é¢˜çš„è¡Œä¸ºï¼›ä¹Ÿå¯ä»¥å•ç‹¬åº”ç”¨åœ¨ Topic çº§åˆ«ï¼ŒæŽ§åˆ¶å•ä¸ªä¸»é¢˜ï¼‰&lt;/p>
&lt;ul>
&lt;li>
&lt;p>âœ’ï¸ å¤åˆ¶ç³»æ•°&lt;/p>
&lt;ul>
&lt;li>Broker çº§åˆ«ï¼š&lt;code>default.replication.factor&lt;/code>&lt;/li>
&lt;li>Topic çº§åˆ«ï¼š&lt;code>replication.factor&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å¤åˆ¶ç³»æ•°è¡¨ç¤ºè¯¥ Topic çš„ Partition ä¼šè¢«å‡ ä¸ªä¸åŒçš„ Broker å¤åˆ¶ã€‚&lt;/p>
&lt;p>å¦‚æžœå¤åˆ¶ç³»æ•°ä¸º Nï¼Œå½“æœ‰ N-1 ä¸ª Broker å¤±æ•ˆæ—¶ï¼Œä»ç„¶å¯ä»¥ä»Ž Topic è¯»å–æˆ–å†™å…¥æ•°æ®ã€‚&lt;/p>
&lt;p>æ›´é«˜çš„å¤åˆ¶ç³»æ•°èƒ½å¤Ÿå¸¦æ¥æ›´é«˜çš„å¯ç”¨æ€§ã€å¯é æ€§å’Œæ›´å°‘çš„æ•…éšœï¼Œä½†ä¼šå ç”¨æˆå€çš„å­˜å‚¨ç©ºé—´ï¼Œéœ€è¦åœ¨å¯ç”¨æ€§å’Œå­˜å‚¨ç¡¬ä»¶é—´åšå‡ºå¹³è¡¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âœ’ï¸ ä¸å®Œå…¨çš„é¦–é¢†é€‰ä¸¾&lt;/p>
&lt;ul>
&lt;li>åªæœ‰ Broker çº§åˆ«ï¼Œé»˜è®¤ä¸º true ï¼š&lt;code>unclean.leader.election = true&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­æ²¡æœ‰ä¸¢å¤±æ•°æ®ï¼Œè¿™ä¸ªé€‰ä¸¾å°±æ˜¯â€å®Œå…¨â€œçš„ï¼ˆæäº¤çš„æ•°æ®åŒæ—¶å­˜åœ¨äºŽæ‰€æœ‰åŒæ­¥å‰¯æœ¬ä¸Šï¼‰ã€‚&lt;/p>
&lt;p>å¦‚æžœè®¾ç½®ä¸º trueï¼Œå…è®¸ä¸åŒæ­¥çš„å‰¯æœ¬æˆä¸ºé¦–é¢†ï¼Œéœ€è¦æ‰¿æ‹…æ•°æ®ä¸ä¸€è‡´æˆ–ä¸¢å¤±æ•°æ®çš„é£Žé™©ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âœ’ï¸ æœ€å°‘çš„åŒæ­¥å‰¯æœ¬&lt;/p>
&lt;ul>
&lt;li>Broker / Topic çº§åˆ«ï¼š&lt;code>min.insync.replicas&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ¶ˆæ¯åªæœ‰åœ¨è¢«å†™å…¥åˆ°æ‰€æœ‰åŒæ­¥å‰¯æœ¬ä¹‹åŽæ‰è¢«è®¤ä¸ºæ˜¯å·²æäº¤çš„ã€‚&lt;/p>
&lt;p>å½“ä¸æ»¡è¶³æœ€å°‘åŒæ­¥å‰¯æœ¬æ—¶ï¼Œä¼šåœæ­¢æŽ¥å—ç”Ÿäº§è€…è¯·æ±‚ï¼Œå˜æˆåªè¯»çŠ¶æ€ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ç”Ÿäº§è€…çš„å¯é ">ðŸ›º ç”Ÿäº§è€…çš„å¯é &lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ§² å‘é€ç¡®è®¤&lt;/p>
&lt;p>ä¸‰ç§ç¡®è®¤æ¨¡å¼ï¼š&lt;code>acks&lt;/code>: æŒ‡å®šäº†å¿…é¡»è¦æœ‰å¤šå°‘ä¸ªåˆ†åŒºå‰¯æœ¬æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿäº§è€…æ‰ä¼šä»»åŠ¡æ¶ˆæ¯å†™å…¥æ—¶æˆåŠŸçš„&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>acks=0&lt;/code> ä¸ä¼šç­‰å¾…ä»»åŠ¡æ¥è‡ªæœåŠ¡å™¨çš„å“åº”ã€‚è¾¾åˆ°æœ€é«˜çš„åžåé‡ï¼Œæ— æ³•å¾—çŸ¥æ¶ˆæ¯çŠ¶æ€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>acks=1&lt;/code> åªè¦ Partition Leader æ”¶åˆ°å“åº”ã€‚æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼ŒLeaderå®•æœºåŽï¼Œä¸€ä¸ªæœªåŒæ­¥çš„Flloweræˆä¸ºæ–°çš„Leaderã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>acks=all&lt;/code> æ¶ˆæ¯è¦å…¨éƒ¨åŒæ­¥åˆ°æ‰€æœ‰çš„ Leader&amp;amp;Fllowerã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ§² é…ç½®é‡è¯•å‚æ•°&lt;/p>
&lt;p>ç”Ÿäº§è€…å‘ Broker å‘é€æ¶ˆå¤±æ—¶ï¼Œä¼šè¿”å›žä¸€ä¸ªæˆåŠŸ/é”™è¯¯å“åº”ç ã€‚å¦‚æžœ Broker è¿”å›žçš„é”™è¯¯å¯ä»¥é€šè¿‡ã€Œé‡è¯•ã€æ¥è§£å†³ï¼Œç”Ÿäº§è€…ä¼šè‡ªåŠ¨å¤„ç†è¿™äº›é”™è¯¯ã€‚&lt;/p>
&lt;p>é”™è¯¯å“åº”ç å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šï¼ˆ1ï¼‰é‡è¯•ä¹‹åŽå¯ä»¥è§£å†³çš„ï¼Œå¯é‡è¯•é”™è¯¯ &lt;code>LEADER_NOT_AVAILABLE&lt;/code> ï¼ˆ2ï¼‰æ— æ³•é€šè¿‡é‡è¯•è§£å†³çš„ï¼Œä¸å¯é‡è¯•é”™è¯¯ &lt;code>INVALID_CONFIG&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¦‚æžœæƒ³æŠ“ä½å¼‚å¸¸å¹¶å¤šé‡è¯•å‡ æ¬¡ï¼Œå¯ä»¥å°†é‡è¯•æ¬¡æ•°è®¾ç½®å¤šä¸€ç‚¹ï¼Œè®©ç”Ÿäº§è€…é‡è¯•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æžœæƒ³ä¸¢å¼ƒæ•°æ®ï¼Œé‡è¯•å‚æ•°æ¯«æ— æ„ä¹‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æžœæƒ³ä¿å­˜æ¶ˆæ¯åˆ°æŸä¸ªåœ°æ–¹ï¼ŒåŽç»­è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥åœæ­¢é‡è¯•&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>âš ï¸ é‡è¯•ä¼šå¸¦æ¥æ¶ˆæ¯é‡å¤çš„é£Žé™©ï¼Œå¯ä»¥åœ¨åº”ç”¨ä¸­å‘æ¶ˆæ¯ä¸­åŠ å…¥å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºŽæ£€æµ‹é‡å¤æ¶ˆæ¯ï¼ˆæ–°ç‰ˆ Kafka èƒ½å¤Ÿè‡ªåŠ¨å¤„ç†ï¼‰ï¼Œæ¶ˆè´¹è€…åœ¨è¯»å–æ—¶è¿›è¡Œæ¸…ç†ï¼›åœ¨ä¸šåŠ¡ä¸Šä¹Ÿå¯ä»¥å®žçŽ°å¹‚ç­‰ï¼Œå³ä½¿å‡ºçŽ°é‡å¤æ¶ˆæ¯ï¼Œå¯¹ç»“æžœçš„å¤„ç†ä¹Ÿä¸ä¼šé€ æˆè´Ÿé¢å½±å“ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ§² é¢å¤–çš„é”™è¯¯å¤„ç†&lt;/p>
&lt;p>é”™è¯¯å¤„ç†å™¨çš„ä»£ç é€»è¾‘ä¸Žå…·ä½“çš„åº”ç”¨ç¨‹åºåŠå…¶ç›®æ ‡æœ‰å…³ï¼Œæ ¹æ®å…·ä½“çš„æž¶æž„å†³å®šã€‚ï¼ˆä¸¢å¼ƒï¼Ÿè®°å½•é”™è¯¯ï¼Ÿä¿å­˜åˆ°ç£ç›˜ï¼Ÿå›žè°ƒå¦ä¸€ä¸ªåº”ç”¨ï¼Ÿï¼‰&lt;/p>
&lt;p>å¦‚æžœé”™è¯¯å¤„ç†åªæ˜¯ä¸ºäº†é‡è¯•å‘é€æ¶ˆæ¯ï¼Œæœ€å¥½è¿˜æ˜¯ä½¿ç”¨ç”Ÿäº§è€…å†…ç½®çš„é‡è¯•æœºåˆ¶ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¶ˆè´¹è€…çš„å¯é ">ðŸš™ æ¶ˆè´¹è€…çš„å¯é &lt;/h3>
&lt;p>åªæœ‰è¢«å†™å…¥æ‰€æœ‰åŒæ­¥å‰¯æœ¬çš„æ•°æ®ï¼Œå¯¹æ¶ˆè´¹è€…æ‰æ˜¯å¯ç”¨çš„ï¼Œæ¶ˆè´¹è€…å¾—åˆ°çš„æ¶ˆæ¯å·²ç»å…·å¤‡äº†ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>æ¶ˆè´¹è€…éœ€è¦åšçš„æ˜¯è·Ÿè¸ªå“ªäº›æ¶ˆæ¯å·²ç»è¯»å–è¿‡ï¼Œå“ªäº›æ˜¯è¿˜æ²¡æœ‰è¯»å–è¿‡çš„ï¼Œæ˜¯åœ¨è¯»å–æ¶ˆå¤±æ—¶ä¸ä¸¢å¤±æ¶ˆæ¯çš„å…³é”®ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ“ æäº¤é¢‘çŽ‡ï¼ˆæ˜¯æ€§èƒ½å’Œé‡å¤æ¶ˆæ¯ä¹‹é—´çš„æƒè¡¡ï¼‰&lt;/p>
&lt;p>å¯ä»¥åœ¨è½®è¯¢åŽç»´æŠ¤çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªå¾ªçŽ¯é‡Œå¤šæ¬¡æäº¤åç§»é‡ï¼Œå®Œå…¨å–å†³äºŽæ€§èƒ½å’Œé‡å¤å¤„ç†æ¶ˆæ¯ä¹‹é—´åšå‡ºæƒè¡¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ“ æ¶ˆè´¹è€…éœ€è¦é‡è¯•&lt;/p>
&lt;p>åœ¨è¿›è¡Œè½®è¯¢åŽï¼Œæœ‰äº›æ¶ˆæ¯ä¸ä¼šè¢«å®Œå…¨å¤„ç†ï¼Œéœ€è¦ç¨åŽé‡è¯•ã€‚å¦‚è®°å½• #31 å¤„ç†æˆï¼Œè®°å½• #30 å¤„ç†å¤±è´¥ã€‚æäº¤åç§»é‡æ—¶éœ€è¦è¿›è¡Œå¤„ç†ï¼ˆ#31ï¼Ÿ/ #30ï¼‰&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é‡åˆ°å¯é‡è¯•é”™è¯¯æ—¶ï¼Œæäº¤æœ€åŽä¸€ä¸ªå¤„ç†æˆåŠŸçš„åç§»é‡ï¼Œå°†æ²¡æœ‰å¤„ç†å¥½çš„æ¶ˆæ¯ä¿å­˜åˆ°ç¼“å†²åŒºä¸­ï¼Œè°ƒç”¨æ¶ˆè´¹è€…çš„ pause() ç¡®ä¿å…¶ä»–è½®è¯¢ä¸ä¼šèŽ·å–æ•°æ®ï¼ˆåœæ­¢æŽ¥æ”¶æ¶ˆæ¯é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºï¼‰ï¼Œåœ¨ä¿å­˜è½®è¯¢ï¼ˆä¿æŒå¿ƒè·³ï¼‰çš„æƒ…å†µä¸‹å°è¯•é‡æ–°å¤„ç†ã€‚å¦‚æžœé‡è¯•æˆåŠŸæˆ–é‡è¯•æ¬¡æ•°è¾¾åˆ°ä¸Šé™å¹¶å†³å®šæ”¾å¼ƒï¼Œå°†ç»“æžœè®°å½•ä¸‹æ¥ï¼Œä½¿ç”¨ resume() ç»§ç»­ä»Žè½®è¯¢ä¸­èŽ·å–æ•°æ®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é‡åˆ°å¯é‡è¯•é”™è¯¯ï¼ŒæŠŠé”™è¯¯å†™å…¥åˆ°ä¸€ä¸ªå•ç‹¬çš„ä¸»é¢˜ï¼Œç»§ç»­å¤„ç†ä¸šåŠ¡ã€‚ä½¿ç”¨ä¸“é—¨çš„æ¶ˆè´¹è€…ä»Žè¿™ä¸ªå•ç‹¬çš„ä¸»é¢˜ä¸Šè¯»å–æ¶ˆæ¯è¿›è¡Œé‡è¯•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ“ é•¿æ—¶é—´å¤„ç†æ¶ˆæ¯&lt;/p>
&lt;p>æœ‰æ—¶å¤„ç†æ•°æ®éœ€è¦å¾ˆé•¿çš„æ—¶é—´ã€‚ã€Œå³ä½¿ä¸æƒ³èŽ·å–æ›´å¤šçš„æ•°æ®ï¼Œä¹Ÿè¦ä¿æŒè½®è¯¢ï¼Œè¿™æ ·å®¢æˆ·ç«¯æ‰èƒ½å‘ Broker å‘é€å¿ƒè·³ã€‚ã€&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Kafka æ“ä½œï¼ˆDoingï¼‰</title><link>https://www.letout.cn/p/kafka/operation/</link><pubDate>Sun, 26 Mar 2023 08:08:08 +0800</pubDate><guid>https://www.letout.cn/p/kafka/operation/</guid><description>&lt;img src="https://www.letout.cn/p/kafka/operation/1.png" alt="Featured image of post Kafka æ“ä½œï¼ˆDoingï¼‰" />&lt;h2 id="å‘½ä»¤è¡Œå·¥å…·">å‘½ä»¤è¡Œå·¥å…·&lt;/h2>
&lt;p>Kafka æä¾›äº†ä¸€äº›åŸºäºŽè„šæœ¬çš„å‘½åè¡Œå·¥å…· &lt;code>${dir}/bin/xxx.sh&lt;/code>ï¼Œç”¨äºŽç®¡ç†é›†ç¾¤ã€‚è¿™äº›ç®¡ç†é€šè¿‡ Java ç±»å®žçŽ°ï¼Œé€šè¿‡è„šæœ¬è°ƒç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯åŠ¨ Zookeeper æœåŠ¡ï¼ˆæ–°ç‰ˆå·²å†…ç½®ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bin/zookeeper-server-start.sh config/zeekeeper.properties
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯åŠ¨ Kafka æœåŠ¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bin/kafka-server-start.sh config/server.properties
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ðŸ” æ›´å¤š CLI æ“ä½œï¼š&lt;a class="link" href="https://www.conduktor.io/kafka/kafka-topics-cli-tutorial/" target="_blank" rel="noopener"
>ðŸŒ https://www.conduktor.io/kafka/kafka-topics-cli-tutorial/&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="topic-æ“ä½œ">Topic æ“ä½œ&lt;/h3>
&lt;p>Kafka å¤§éƒ¨åˆ†å‘½ä»¤è¡Œå·¥å…·ç›´æŽ¥æ“ä½œ Zookeeper ä¸Šçš„å…ƒæ•°æ®ï¼Œå¹¶ä¸ä¼šç›´æŽ¥è¿žæŽ¥åˆ° Broker ä¸Šï¼Œéœ€è¦ç¡®ä¿æ‰€ä½¿ç”¨çš„å·¥å…·ç‰ˆæœ¬ä¸Žé›†ç¾¤ä¸­çš„ Broker ç‰ˆæœ¬ç›¸åŒ¹é…ã€‚&lt;/p>
&lt;blockquote>
&lt;p>ðŸŽ—ï¸&lt;/p>
&lt;p>Kafka 2.2+ ä½¿ç”¨ Kafka çš„ hostname &amp;amp; port è¿›è¡Œæ“ä½œ &lt;code>--bootstrap-server 127.0.0.1:9092&lt;/code>&lt;/p>
&lt;p>æ—§ç‰ˆæœ¬ä½¿ç”¨ Zookeeper çš„ URL &amp;amp; port è¿›è¡Œæ“ä½œ &lt;code>--zookeeper 127.0.0.1:2181&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºä¸»é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2.2 +&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-topics.sh --bootstrap-server localhost:9092 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --create &lt;span class="se">\ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --topic first_topic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --partitions &lt;span class="m">3&lt;/span> &lt;span class="se">\ &lt;/span> &lt;span class="c1"># åˆ†åŒºæ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --replication-factor &lt;span class="m">1&lt;/span> &lt;span class="c1"># å‰¯æœ¬æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># old&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-topics.sh --zookeeper localhost:2181 --topic first_topic --create --partitions &lt;span class="m">3&lt;/span> --replication-factor &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ—å‡ºä¸»é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2.2 + &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-topics.sh --bootstrap-server localhost:9092 --list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¯¦ç»†ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-topics.sh --bootstrap-server localhost:9092 --describe --topic first_topic
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¿®æ”¹ä¸»é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-topics.sh --bootstrap-server localhost:9092 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --alter &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --topic first_topic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --partitions &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç”Ÿäº§--æ¶ˆè´¹">ç”Ÿäº§ &amp;amp; æ¶ˆè´¹&lt;/h3>
&lt;blockquote>
&lt;p>ðŸŽ—ï¸ Producer&lt;/p>
&lt;p>Kafka 2.5+ ä½¿ç”¨ &lt;code>--bootstrap-server&lt;/code>&lt;/p>
&lt;p>æ—§ç‰ˆæœ¬ Kafka ä½¿ç”¨ &lt;code>--broker-list&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿäº§&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kafka-console-producer.sh --bootstrap-server localhost:9092 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --topic first_topic
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ðŸŽ—ï¸ Consumer&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>--bootstrap-server&lt;/code>ï¼Œè‡ª v0.10 å¼€å§‹ &lt;code>--zookeeper&lt;/code> å·²è¢«åºŸå¼ƒ&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">kafka-console-consumer.sh --bootstrap-server localhost:9092 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --topic first_topic
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-producer">ðŸ¤² Producer&lt;/h2>
&lt;h3 id="-ç”Ÿäº§è€…">ðŸˆ ç”Ÿäº§è€…&lt;/h3>
&lt;ul>
&lt;li>ðŸ§© &lt;code>ProducerRecord&lt;/code> å¯¹è±¡åŒ…å«ç›®æ ‡ä¸»é¢˜ Topic å’Œéœ€è¦å‘é€çš„å†…å®¹ Valueï¼Œå¯ä»¥å¯ä»¥æŒ‡å®šåˆ†åŒº Partition å’Œé”®å€¼ Keyï¼ˆæ¶ˆæ¯çš„é™„åŠ ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥å†³å®šæ¶ˆæ¯è¢«å†™å…¥å“ªä¸ªåˆ†åŒºï¼Œç›¸åŒ Key çš„æ¶ˆæ¯ä¼šå†™å…¥åŒä¸€ä¸ªåˆ†åŒºï¼‰&lt;/li>
&lt;li>ðŸ§© å‘é€æ¶ˆæ¯æ—¶ï¼Œç”Ÿäº§è€…éœ€è¦å°† &lt;code>ProducerRecord&lt;/code> å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“&lt;/li>
&lt;li>ðŸ§© æ•°æ®è¢«ä¼ é€ç»™åˆ†åŒºå™¨ &lt;code>Partitioner&lt;/code>ï¼Œå¦‚æžœæŒ‡å®šäº†åˆ†åŒºï¼Œä¼šç›´æŽ¥è¿”å›žï¼›æ²¡æœ‰æŒ‡å®šï¼Œæ ¹æ® Key é€‰æ‹©ä¸€ä¸ªåˆ†åŒºï¼›æ²¡æœ‰æŒ‡å®š Keyï¼Œä¼šæ ¹æ® Value è¿›è¡Œæ•£åˆ—ï¼Œæ ¹æ®æ•£åˆ—å€¼æŠŠæ¶ˆæ¯æ˜ å°„åˆ°ç›¸åº”çš„åˆ†åŒº&lt;/li>
&lt;li>ðŸ§© è¿™æ¡è®°å½•é€‰å¥½åˆ†åŒºåŽï¼Œä¼šè¢«æ·»åŠ åˆ°ä¸€ä¸ªè®°å½•æ‰¹æ¬¡ä¸­ï¼Œè¿™ä¸ªæ‰¹æ¬¡çš„æ‰€æœ‰æ¶ˆæ¯ä¼šè¢«å‘é€åˆ°ç›¸åŒçš„ä¸»é¢˜å’Œåˆ†åŒºä¸Šï¼ˆæ‰¹å¤„ç†ï¼‰ï¼Œç‹¬ç«‹çš„ &lt;code>Processer&lt;/code> çº¿ç¨‹ä¼šè´Ÿè´£æŠŠè¿™äº›æ•°æ®å‘é€åˆ°å¯¹åº”çš„ broker ä¸Š&lt;/li>
&lt;li>ðŸ§© Broker æ”¶åˆ°æ¶ˆæ¯æ—¶ä¼šè¿”å›žä¸€ä¸ªå“åº”
&lt;ul>
&lt;li>æ¶ˆæ¯æˆåŠŸå†™å…¥ Kafkaï¼Œè¿”å›žä¸€ä¸ª &lt;code>RecordMetaData&lt;/code> å¯¹è±¡ï¼ŒåŒ…å«ä¸»é¢˜å’Œåˆ†åŒºçš„ä¿¡æ¯&lt;/li>
&lt;li>å†™å…¥å¤±è´¥ï¼Œä¼šè¿”å›žä¸€ä¸ªé”™è¯¯ï¼Œç”Ÿäº§è€…æ”¶åˆ°é”™è¯¯ä¹‹åŽä¼šå°è¯•é‡æ–°å‘é€ï¼Œå¤šæ¬¡å¤±è´¥ç›´æŽ¥è¿”å›žé”™è¯¯ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/operation/producer.webp"
width="780"
height="678"
srcset="https://www.letout.cn/p/kafka/operation/producer_huebfba9d061e763283d9c37fc8487b94d_24528_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/kafka/operation/producer_huebfba9d061e763283d9c37fc8487b94d_24528_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="115"
data-flex-basis="276px"
>&lt;/p>
&lt;h4 id="é‡è¦é…ç½®">é‡è¦é…ç½®&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>&lt;code>acks&lt;/code>&lt;/p>
&lt;p>æŒ‡å®šäº†å¿…é¡»è¦æœ‰å¤šå°‘ä¸ªåˆ†åŒºå‰¯æœ¬æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿäº§è€…æ‰ä¼šä»»åŠ¡æ¶ˆæ¯å†™å…¥æ—¶æˆåŠŸçš„&lt;/p>
&lt;ul>
&lt;li>&lt;code>acks=0&lt;/code> ä¸ä¼šç­‰å¾…ä»»åŠ¡æ¥è‡ªæœåŠ¡å™¨çš„å“åº”ã€‚è¾¾åˆ°æœ€é«˜çš„åžåé‡ï¼Œæ— æ³•å¾—çŸ¥æ¶ˆæ¯çŠ¶æ€ã€‚&lt;/li>
&lt;li>&lt;code>acks=1&lt;/code> åªè¦ Partition Leader æ”¶åˆ°å“åº”ã€‚æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼ŒLeaderå®•æœºåŽï¼Œä¸€ä¸ªæœªåŒæ­¥çš„Flloweræˆä¸ºæ–°çš„Leaderã€‚&lt;/li>
&lt;li>&lt;code>acks=all&lt;/code> æ¶ˆæ¯è¦å…¨éƒ¨åŒæ­¥åˆ°æ‰€æœ‰çš„ Leader&amp;amp;Fllowerã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>retries&lt;/code>&lt;/p>
&lt;p>ç”Ÿäº§è€…å¯ä»¥é‡å‘æ¶ˆæ¯çš„æ¬¡æ•°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>max.in.flight.requests.per.connection&lt;/code>&lt;/p>
&lt;p>ç”Ÿäº§è€…åœ¨æ”¶åˆ°æœåŠ¡å™¨å“åº”å‰å¯ä»¥å‘é€å¤šå°‘ä¸ªæ¶ˆæ¯ã€‚&lt;/p>
&lt;p>Kafka å¯ä»¥ä¿è¯åŒä¸€ä¸ªåˆ†åŒºé‡Œçš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œ&lt;code>max.in.flight.requests.per.connection=1&lt;/code>ï¼Œå³ä½¿å‘é€äº†é‡è¯•ï¼Œæ¶ˆæ¯ä¾æ—§æœ‰åºï¼Œä½†æ˜¯ä¼šä¸¥é‡å½±å“ç”Ÿäº§è€…çš„åžåé‡ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-åŒæ­¥å‘é€">ðŸˆâ€â¬› åŒæ­¥å‘é€&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">RecordMetadata&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">send&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ &lt;code>send()&lt;/code> æ–¹æ³•å‘é€æ¶ˆæ¯ï¼Œä¼šè¿”å›žä¸€ä¸ª Future å¯¹è±¡ï¼Œè°ƒç”¨ &lt;code>get()&lt;/code> æ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œå°±å¯ä»¥çŸ¥é“æ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç›¸å…³é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">bootstrapServers&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;127.0.0.1:9092&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Properties&lt;/span> &lt;span class="n">properties&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Properties&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProducerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">BOOTSTRAP_SERVERS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">bootstrapServers&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProducerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">KEY_SERIALIZER_CLASS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">StringSerializer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span> &lt;span class="c1">// åºåˆ—åŒ–æ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProducerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">VALUE_SERIALIZER_CLASS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">StringSerializer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åˆ›å»º Producer
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">KafkaProducer&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">producer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">KafkaProducer&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="n">properties&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åˆ›å»ºæ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">producerRecord&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="s">&amp;#34;demo_topic&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;hello world!&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å‘é€æ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">producer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">send&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// get() åŒæ­¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// å‘ç”Ÿäº†æ— æ³•è§£å†³çš„é”™è¯¯ æˆ– é‡è¯•è¶…è¿‡æœ€å¤§æ¬¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å¼‚æ­¥å‘é€">ðŸ… å¼‚æ­¥å‘é€&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">RecordMetadata&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">send&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Callback&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è°ƒç”¨ &lt;code>send()&lt;/code> æ–¹æ³•ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªå›žè°ƒå‡½æ•°ï¼ŒæœåŠ¡å™¨åœ¨è¿”å›žå“åº”æ—¶è°ƒç”¨è¯¥å‡½æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">producer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">send&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">producerRecord&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Callback&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">onCompletion&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">RecordMetadata&lt;/span> &lt;span class="n">recordMetadata&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å‘é€å¤±è´¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å¯¹åº”çš„ä¸šåŠ¡å¤„ç†é€»è¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-åºåˆ—åŒ–å™¨">ðŸ† åºåˆ—åŒ–å™¨&lt;/h3>
&lt;p>å¸¸è§çš„åºåˆ—åŒ–&amp;amp;ååºåˆ—åŒ–å™¨æœ‰ Avroã€Thriftã€Protobuf ç­‰ã€‚&lt;/p>
&lt;p>Apache &lt;a class="link" href="https://zhuanlan.zhihu.com/p/370519371" target="_blank" rel="noopener"
>Avro&lt;/a> æ˜¯ä¸€ç§ä¸Žç¼–ç¨‹è¯­è¨€æ— å…³çš„åºåˆ—åŒ–æ ¼å¼ã€‚&lt;/p>
&lt;p>Avro é€šè¿‡ä¸Žè¯­è¨€æ— å…³çš„ schema æ¥å®šä¹‰ï¼Œä½¿ç”¨ JSON æ¥æè¿°ï¼Œæ•°æ®ä¼šè¢«åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶æˆ– JSON æ–‡ä»¶ã€‚&lt;/p>
&lt;p>æ»¡è¶³ Avro å…¼å®¹åŽŸåˆ™ä¸‹ï¼Œå†™å…¥çš„æ¶ˆæ¯æ”¹åŠ¨ schema å†™å…¥äº†æ–°çš„æ•°æ®ï¼Œè´Ÿè´£è¯»æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºå¯ä»¥ç»§ç»­å¤„ç†è€Œæ— éœ€åšä»»ä½•æ›´æ”¹ã€‚&lt;/p>
&lt;h3 id="-åˆ†åŒº">ðŸ• åˆ†åŒº&lt;/h3>
&lt;p>&lt;code>ProducerRecord&lt;/code> å¯¹è±¡å¯ä»¥åŒ…å« topicã€partitionã€keyã€value ç­‰ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šæŒ‡å®š keyï¼Œä½œä¸ºé™„åŠ æ¶ˆæ¯ï¼Œå†³å®šæ¶ˆæ¯è¯¥è¢«å†™å…¥å“ªä¸ªåˆ†åŒºï¼Œæ‹¥æœ‰ç›¸åŒ key çš„æ¶ˆæ¯ä¼šè¢«å†™å…¥åŒä¸€ä¸ªåˆ†åŒºã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// topic: CustomerCountry
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// key: Laboratory Equipment
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// value: USA
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="s">&amp;#34;CustomerConuntry&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;Laboratory Equipment&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;USA&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åˆ›å»º key-&amp;gt;null çš„æ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="s">&amp;#34;CustomerCountry&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;USA&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“ key ä¸º null æ—¶ï¼ŒKafka ä¼šå¯¹é”®è¿›è¡Œæ•£åˆ—ï¼ˆKafka è‡ªå·±çš„æ•£åˆ—ç®—æ³•ï¼‰ï¼Œç„¶åŽæ ¹æ®æ•£åˆ—å€¼æ˜ å°„åˆ°ç‰¹æ®Šçš„åˆ†åŒºã€‚&lt;/p>
&lt;h4 id="è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥">è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥&lt;/h4>
&lt;p>é€šè¿‡å®žçŽ° &lt;code>interface Partitioner&lt;/code> å®žçŽ°è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥ï¼Œä¸»è¦åŒ…å«ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>void configure(Map&amp;lt;String, ?&amp;gt; configs)&lt;/code>
&lt;ul>
&lt;li>å®žé™…åº”ç”¨ä¸­ï¼Œåº”é€šè¿‡è¯¥æ–¹æ³•ä¼ å…¥ç›¸å…³ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>void partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster)&lt;/code>&lt;/li>
&lt;li>&lt;code>void close()&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">BananaPartitioner&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Partitioner&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">configure&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&amp;gt;&lt;/span> &lt;span class="n">configs&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">partition&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">topic&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">keyBytes&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">valueBytes&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Cluster&lt;/span> &lt;span class="n">cluster&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PartitionInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">partitions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cluster&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">partitionsForTopic&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">topic&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">numPartitions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">partition&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">((&lt;/span>&lt;span class="n">keyBytes&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="o">(!(&lt;/span>&lt;span class="n">key&lt;/span> &lt;span class="n">instanceOf&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">)))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">InvalidRecordException&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;We expect all messages to have customer name as key&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(((&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Banana&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// Banana æ€»æ˜¯è¢«åˆ†é…åˆ°æœ€åŽä¸€ä¸ªåˆ†åŒº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">numPartitions&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å…¶å®ƒè®°å½•è¢«æ•£åˆ—åˆ°å…¶ä»–åˆ†åŒº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="o">((&lt;/span>&lt;span class="n">Math&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">abs&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">murmur2&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">keyBytes&lt;/span>&lt;span class="o">)))&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">numPartitions&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">close&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-consumer">ðŸ‘Œ Consumer&lt;/h2>
&lt;h3 id="-æ¶ˆè´¹è€…ç»„">ðŸ¦œ æ¶ˆè´¹è€…ç»„&lt;/h3>
&lt;h3 id="-æ¶ˆæ¯è½®è¯¢">ðŸ¦š æ¶ˆæ¯è½®è¯¢&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">bootstrapServers&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;127.0.0.1:9092&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">groupId&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;demo_groupId&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">topic&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;demo_topic&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Properties&lt;/span> &lt;span class="n">properties&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Properties&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">BOOTSTRAP_SERVERS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">bootstrapServers&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">KEY_DESERIALIZER_CLASS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">StringDeserializer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">VALUE_DESERIALIZER_CLASS_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">StringDeserializer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">GROUP_ID_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">groupId&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">properties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerConfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">AUTO_OFFSET_RESET_CONFIG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;earliest&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åˆ›å»ºæ¶ˆè´¹è€…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">KafkaConsumer&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">consumer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">KafkaConsumer&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="n">properties&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è®¢é˜…ä¸»é¢˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">subscribe&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">topic&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è½®è¯¢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ConsumerRecords&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">records&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">poll&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Duration&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ofMillis&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="o">));&lt;/span> &lt;span class="c1">// 100 -&amp;gt; è¶…æ—¶æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">records&lt;/span>&lt;span class="o">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸šåŠ¡å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Key: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">key&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;, Value: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Partition: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">partition&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;, Offset:&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">offset&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¶ˆæ¯è½®è¯¢æ˜¯æ¶ˆè´¹è€… API çš„æ ¸å¿ƒï¼Œä¸€æ—¦æ¶ˆè´¹è€…è®¢é˜…çš„ä¸»é¢˜ï¼Œè½®è¯¢ä¼šå¤„ç†æ‰€æœ‰çš„ç»†èŠ‚ã€‚
&lt;code>poll()&lt;/code> ä¼šè´Ÿè´£æŸ¥æ‰¾ GroupCordinatorï¼ŒåŠ å…¥ç¾¤ç»„ï¼ŒæŽ¥å—åˆ†é…çš„åˆ†åŒºï¼Œå‘é€å¿ƒè·³å’ŒèŽ·å–æ•°æ®ã€‚å¦‚æžœå‘ç”Ÿäº†å†å‡è¡¡ï¼Œä¹Ÿæ˜¯è¿™ä¸ªè½®è¯¢æœŸé—´è¿›è¡Œçš„ã€‚&lt;/p>
&lt;p>âš ï¸ æ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…åªèƒ½è¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ã€‚å¦‚æžœéœ€è¦å¤šä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ª Patition ä¸­çš„æ¶ˆæ¯ï¼Œå¯ä»¥å°†è¿™ä¸ªæ¶ˆè´¹è€…èŽ·å–çš„ä¸€æ‰¹æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ ExecutorService å¯åŠ¨å¤šä¸ªçº¿ç¨‹å¤„ç†ã€‚&lt;/p>
&lt;h3 id="-åç§»é‡">ðŸ¦‰ åç§»é‡&lt;/h3>
&lt;p>Kafka ä½¿ç”¨åç§»é‡ offset è¿½è¸ªæ¶ˆæ¯åœ¨åˆ†åŒºä¸­çš„ä½ç½®ã€‚&lt;/p>
&lt;p>Consumer å‘ä¸€ä¸ªç‰¹æ®Šçš„ä¸»é¢˜ &lt;code>_consumer_offset&lt;/code> å‘é€æ¶ˆæ¯ï¼Œæ›´æ–°åˆ†åŒºå½“å‰çš„ä½ç½®ã€‚&lt;/p>
&lt;ul>
&lt;li>å¦‚æžœæäº¤çš„ offsetã€Œå°äºŽã€å®¢æˆ·ç«¯å¤„ç†çš„æœ€åŽä¸€ä¸ªæ¶ˆæ¯åç§»é‡ï¼Œé‚£ä¹ˆã€Œä¸¤ä¸ªåç§»é‡ä¹‹é—´çš„æ¶ˆæ¯ä¼šè¢«é‡å¤å¤„ç†ã€&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/operation/offset1.png"
width="978"
height="422"
srcset="https://www.letout.cn/p/kafka/operation/offset1_hu7de55e7adbd4de02cc42f3a04ca7fa88_35082_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/operation/offset1_hu7de55e7adbd4de02cc42f3a04ca7fa88_35082_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="231"
data-flex-basis="556px"
>&lt;/p>
&lt;ul>
&lt;li>å¦‚æžœæäº¤çš„ offsetã€Œå¤§äºŽã€å®¢æˆ·ç«¯å¤„ç†çš„æœ€åŽä¸€ä¸ªæ¶ˆæ¯åç§»é‡ï¼Œé‚£ä¹ˆã€Œä¸¤ä¸ªåç§»é‡ä¹‹é—´çš„æ¶ˆæ¯ä¼šä¸¢å¤±ã€&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/operation/offset2.png"
width="979"
height="485"
srcset="https://www.letout.cn/p/kafka/operation/offset2_hu389bebeaa08efdc7ddfc7a71cffd3a76_34010_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/operation/offset2_hu389bebeaa08efdc7ddfc7a71cffd3a76_34010_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="201"
data-flex-basis="484px"
>&lt;/p>
&lt;h4 id="è‡ªåŠ¨æäº¤">è‡ªåŠ¨æäº¤&lt;/h4>
&lt;p>å¦‚æžœ &lt;code>enable.auto.commit = true&lt;/code>ï¼Œæ¶ˆè´¹è€…ä¼šè‡ªåŠ¨æŠŠä»Ž &lt;code>poll()&lt;/code> æ–¹æ³•æŽ¥æ”¶åˆ°çš„æœ€å¤§åç§»é‡æäº¤ä¸ŠåŽ»ã€‚æäº¤çš„æ—¶é—´é—´éš”ç”± &lt;code>auto.commit.interval.ms&lt;/code> æŽ§åˆ¶ï¼Œé»˜è®¤ä¸º 5sã€‚&lt;/p>
&lt;p>è‡ªåŠ¨æäº¤å‘ç”Ÿåœ¨æ¯æ¬¡è½®è¯¢æ—¶ï¼Œå¦‚æžœæ²¡æœ‰æäº¤åç§»é‡ï¼Œä¼šæŠŠä¸Šä¸€æ¬¡è°ƒç”¨è¿”å›žçš„åç§»é‡æäº¤ä¸ŠåŽ»ï¼Œã€Œä¸èƒ½ä¿è¯è¿™äº›æ¶ˆæ¯å·²ç»è¢«ä¸šåŠ¡å¤„ç†äº†ã€ã€‚&lt;/p>
&lt;p>âš ï¸ å¦‚æžœè®¾ç½®é»˜è®¤æäº¤æ—¶é—´ä¸º 5sï¼Œåœ¨æäº¤åŽ 3s å‘ç”Ÿäº†å†å‡è¡¡ï¼Œä¹‹åŽçš„æ¶ˆè´¹è€…ä¼šå†æ¬¡èŽ·å–åˆ° 3s å‰æäº¤çš„åç§»é‡ï¼Œè¿™äº›æ¶ˆæ¯ä¼šè¢«é‡å¤å¤„ç†ï¼Œã€Œæ— æ³•é¿å…è¿™ç§æƒ…å†µã€ï¼Œåªèƒ½ç¼©å°æäº¤çš„æ—¶é—´é—´éš”æ›´é¢‘ç¹åœ°æäº¤ offsetï¼Œã€ŒKafka ä¹Ÿæ²¡æœ‰ä¸ºè‡ªåŠ¨æäº¤é¢„ç•™é¿å…é‡å¤å¤„ç†æ¶ˆæ¯çš„æ–¹æ³•ã€ã€‚&lt;/p>
&lt;p>é€‚åˆäºŽä¸é‡è¦çš„æ¶ˆæ¯åœºæ™¯ï¼Œå¦‚æ—¥å¿—é‡‡é›†ã€‚&lt;/p>
&lt;h4 id="åŒæ­¥æäº¤">åŒæ­¥æäº¤&lt;/h4>
&lt;p>è®¾ç½® &lt;code>auto.commit.offset = false&lt;/code>ï¼Œå¯ä»¥è®©åº”ç”¨ç¨‹åºå†³å®šåœ¨ä»€ä¹ˆæ—¶å€™æäº¤åç§»é‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ConsumerRecords&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">records&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">poll&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">records&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å¤„ç†ä¸šåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitSync&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// æ‰‹åŠ¨æäº¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">CommitFailedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;commit failed&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åªè¦æ²¡æœ‰å‘ç”Ÿä¸å¯æ¢å¤çš„é”™è¯¯ï¼Œ&lt;code>commitSync()&lt;/code> æ–¹æ³•ä¼šã€Œä¸€ç›´å°è¯•ç›´åˆ°æäº¤æˆåŠŸä¸ºæ­¢ã€ã€‚å¦‚æžœæäº¤å¤±è´¥ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p>
&lt;h4 id="å¼‚æ­¥æäº¤">å¼‚æ­¥æäº¤&lt;/h4>
&lt;p>ä½¿ç”¨å¼‚æ­¥æäº¤ APIï¼Œåªç®¡å‘é€æäº¤è¯·æ±‚ï¼Œæ— éœ€ç­‰å¾… Broker çš„å“åº”ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitAsync&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åŒæ­¥æäº¤ &lt;code>commitSync()&lt;/code> ä¼šä¸€ç›´é‡è¯•ï¼Œä½†æ˜¯å¼‚æ­¥æäº¤ &lt;code>commitAsync()&lt;/code>ã€Œä¸ä¼šé‡è¯•ã€ã€‚ä¸è¿›è¡Œé‡è¯•ï¼Œæ˜¯å› ä¸ºåœ¨æ”¶åˆ°æœåŠ¡å™¨å“åº”çš„æ—¶å€™ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªæ›´å¤§çš„ offset å·²ç»æäº¤æˆåŠŸã€‚&lt;/p>
&lt;p>å¼‚æ­¥æäº¤åŒæ ·æ”¯æŒå›žè°ƒã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitAsync&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">OffsetCommitCallback&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">onComplete&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TopicPartition&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">OffsetAndMetadata&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">offsets&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¼‚æ­¥æäº¤å¤±è´¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ... ä¸šåŠ¡å¤„ç† / é‡è¯•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¼‚æ­¥æäº¤é‡è¯•ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•è°ƒé€’å¢žçš„åºåˆ—å·ç»´æŠ¤å¼‚æ­¥æäº¤çš„é¡ºåºã€‚åœ¨è¿›è¡Œé‡è¯•å‰ï¼Œå…ˆæ£€æŸ¥å›žè°ƒåºåˆ—å·ä¸Žç»´æŠ¤çš„åºåˆ—å·çš„å¤§å°ï¼Œå¦‚æžœå›žè°ƒåºåˆ—å·è¾ƒå¤§ï¼Œè¯´æ˜Žæœ‰ä¸€ä¸ªæ–°çš„æäº¤å·²ç»å‘é€ï¼Œä¸åº”è¯¥é‡è¯•ã€‚&lt;/p>
&lt;h4 id="ç»„åˆæäº¤">ç»„åˆæäº¤&lt;/h4>
&lt;p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¶å°”çš„æäº¤å¤±è´¥ä¸è¿›è¡Œé‡è¯•æ²¡æœ‰å¤ªå¤§é—®é¢˜ï¼Œåªè¦åŽç»­æœ‰æ›´å¤§çš„ offset æˆåŠŸæäº¤ï¼Œå°±ä¸ä¼šæœ‰é—®é¢˜ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œåœ¨æ¶ˆè´¹è€…å…³é—­å‰ï¼Œå¯ä»¥ç»„åˆä½¿ç”¨ä¸¤ç§æäº¤æ–¹å¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// æ¶ˆè´¹æ¶ˆæ¯ä¸šåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comsumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitAsync&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// å¼‚æ­¥æäº¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Unexpected error&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitSync&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// åŒæ­¥ï¼Œä¼šä¸æ–­é‡è¯•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="æäº¤ç‰¹å®šåç§»é‡">æäº¤ç‰¹å®šåç§»é‡&lt;/h4>
&lt;p>æ¯æ¬¡æ¶ˆè´¹è€… &lt;code>poll()&lt;/code> çš„éƒ½æ˜¯ä¸€æ‰¹æ•°æ®ï¼Œ&lt;code>commitSync() / commitAsync()&lt;/code> æ¯æ¬¡æäº¤éƒ½æ˜¯è¿™ä¸ªæ‰¹æ¬¡æœ€åŽçš„ offsetï¼Œå¦‚æžœæƒ³è¦åœ¨æ‰¹æ¬¡ä¸­é—´æäº¤åç§»é‡ï¼Œå¯ä»¥ä¼ å…¥ã€Œå¸Œæœ›æäº¤çš„åˆ†åŒºå’Œåç§»é‡çš„ mapã€ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œæ¶ˆè´¹è€…å¯èƒ½ä¸çŸ¥è¯»å–ä¸€ä¸ªåˆ†åŒºï¼Œè¿™æ ·åšéœ€è¦ã€Œè·Ÿè¸ªæ‰€æœ‰åˆ†åŒºçš„åç§»é‡ã€ï¼Œé€šå¸¸ä¼šä½¿ä»£ç å˜å¾—å¾ˆå¤æ‚ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TopicPartition&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">OffsetAndMetadata&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">currentOffsets&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ConsumerRecords&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">records&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">poll&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// å‡è®¾æ¯ä¸ªæ‰¹æ¬¡ 10000 æ¡æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ConsumerRecord&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">record&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">records&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸šåŠ¡å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">currentOffsets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">TopicPartition&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">topic&lt;/span>&lt;span class="o">(),&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">partition&lt;/span>&lt;span class="o">()),&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">OffsetAndMetadata&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">offset&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;no metadata&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">1000&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// åœ¨æ¯ä¸ªæ‰¹æ¬¡ä¸­ï¼Œæ²¡å¤„ç† 1000 æ¡æ•°æ®æäº¤ä¸€æ¬¡ offset
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">consumer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commitAsync&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">currentOffsets&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">count&lt;/span>&lt;span class="o">++;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-ç‰¹å®šoffsetå¼€å§‹å¤„ç†">ðŸ¦© ç‰¹å®šoffsetå¼€å§‹å¤„ç†&lt;/h3>
&lt;p>å¦‚æžœæƒ³è¦ä»Žåˆ†åŒºçš„èµ·å§‹/æœ«å°¾ä½ç½®è¯»å–æ¶ˆæ¯ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨ &lt;code>seekToBeginning(Collection&amp;lt;TopicPartition&amp;gt; tp)&lt;/code> å’Œ &lt;code>seekToEnd(Collection&amp;lt;TopicPartition&amp;gt;)&lt;/code>&lt;/p>
&lt;p>æœ‰æ—¶ï¼Œåœ¨ä¸šåŠ¡ä¸Šéœ€è¦ä»Žç‰¹å®šçš„ offset å¼€å§‹è¯»å–æ¶ˆæ¯ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>seek()&lt;/code> è¿›è¡ŒæŸ¥æ‰¾ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// class KafkaConsumer
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">seek&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">TopicPartition&lt;/span> &lt;span class="n">partition&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">seek&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">TopicPartition&lt;/span> &lt;span class="n">partition&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">OffsetAndMetadata&lt;/span> &lt;span class="n">offsetAndMetadata&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¯”å¦‚åœ¨ä¸€äº›ä¸šåŠ¡ä¸­ï¼Œå¯¹æ‰€æœ‰çš„æ“ä½œéƒ½è¦è¿›è¡Œå¤„ç†ï¼Œä¸èƒ½ä¸¢å¤±æ¶ˆæ¯ï¼Œå¤„ç†æ¶ˆå¤±åŽè¦å°†ç»“æžœè®°å½•åˆ°æ•°æ®åº“ã€NoSQL å­˜å‚¨å¼•æ“Žç­‰åœ°æ–¹ï¼Œéœ€è¦å°†ã€Œä¿å­˜è®°å½•ã€ã€Œåç§»é‡ã€æ”¾åœ¨ä¸€ä¸ªåŽŸå­æ“ä½œé‡Œå®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚å¯ä»¥å°†è®°å½•å’Œåç§»é‡éƒ½ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œç”¨ä¸€ä¸ªäº‹åŠ¡æ“ä½œï¼Œä¿è¯åŽŸå­æ€§ã€‚å½“æ¶ˆè´¹è€…åˆ†é…æ–°åˆ†åŒºæ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ &lt;code>seek()&lt;/code> æŸ¥æ‰¾ä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„æŒ‡å®šoffetäº†ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®å’Œé‡å¤å¤„ç†ã€‚&lt;/p>
&lt;h2 id="-connect">ðŸ–‡ï¸ Connect&lt;/h2>
&lt;h2 id="-stream">ðŸ’¦ Stream&lt;/h2>
&lt;!-- raw HTML omitted --></description></item><item><title>InnoDB ç¼“å†²æ±  Buffer Pool</title><link>https://www.letout.cn/p/mysql/innodb/buffer-pool/</link><pubDate>Tue, 07 Mar 2023 18:02:02 +0800</pubDate><guid>https://www.letout.cn/p/mysql/innodb/buffer-pool/</guid><description>&lt;img src="https://www.letout.cn/p/mysql/innodb/buffer-pool/bufferpool.webp" alt="Featured image of post InnoDB ç¼“å†²æ±  Buffer Pool" />&lt;h2 id="-buffer-pool">ðŸ§Š Buffer Pool&lt;/h2>
&lt;p>MySQL çš„æ•°æ®æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„ï¼Œä¸ºäº†æå‡è¯»å†™æ€§èƒ½ï¼ŒInnoDB è®¾è®¡äº†ä¸€ä¸ªç¼“å­˜æ±  Buffer Poolã€‚&lt;/p>
&lt;p>æœ¬è´¨ä¸Šæ˜¯ InnoDB å‘æ“ä½œç³»ç»Ÿç”³è¯·çš„ä¸€æ®µè¿žç»­å†…å­˜ç©ºé—´ï¼Œå¯ä»¥é€šè¿‡ &lt;code>innodb_buffer_pool_size&lt;/code> æ¥è¿›è¡Œè°ƒæ•´å¤§å°ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å½“è¯»å–æ•°æ®æ—¶ï¼Œå¦‚æžœæ•°æ®å·²ç»åœ¨ Buffer Pool ä¸­ï¼Œä¼šç›´æŽ¥è¿”å›žï¼›å¦‚æžœä¸åœ¨ï¼Œå°±ä¼šå°†æ•°æ®&lt;strong>å®Œæ•´çš„é¡µä¿¡æ¯&lt;/strong>å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå†è¿”å›žç»™å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¼šä¿®æ”¹ Buffer Pool ä¸­çš„ç¼“å­˜é¡µï¼ˆ-&amp;gt; å˜æˆè„é¡µï¼‰ï¼Œåœ¨åˆé€‚çš„æ—¶æœºï¼Œç”±åŽå°çº¿ç¨‹å†™å…¥åˆ°ç£ç›˜ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ç»“æž„">ðŸ§© ç»“æž„&lt;/h3>
&lt;p>Buffer Pool ä¸­çš„è¿žç»­å†…å­˜ï¼Œä¼šè¢«åˆ†å‰²æˆä¸€ä¸ªä¸ªçš„é¡µï¼Œå’Œ InnoDB çš„é¡µå¤§å°ä¸€æ ·ï¼Œéƒ½æ˜¯ &lt;code>16KB&lt;/code>ï¼Œç§°ä¸ºç¼“å­˜é¡µã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/innodb/buffer-pool/cache-page.webp"
width="962"
height="234"
srcset="https://www.letout.cn/p/mysql/innodb/buffer-pool/cache-page_hucd01fda075157d782d9171d9e071f31a_7000_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/mysql/innodb/buffer-pool/cache-page_hucd01fda075157d782d9171d9e071f31a_7000_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="411"
data-flex-basis="986px"
>&lt;/p>
&lt;p>æ¯ä¸€ä¸ªç¼“å­˜é¡µéƒ½ä¼šç”±ä¸€ä¸ªæŽ§åˆ¶å—è¿›è¡Œç®¡ç†ï¼ˆä½äºŽ Buffer Pool çš„æœ€å‰é¢ï¼‰ï¼Œæ¯ä¸ªç¼“å­˜é¡µä¸ŽæŽ§åˆ¶å—ä¸€ä¸€å¯¹åº”ã€‚&lt;/p>
&lt;h3 id="-å†…å®¹">ðŸ§© å†…å®¹&lt;/h3>
&lt;p>åœ¨ Buffer Pool ä¸­ï¼Œä¸»è¦åŒ…æ‹¬äº†å…­éƒ¨åˆ†çš„å†…å®¹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°æ®é¡µ&lt;/li>
&lt;li>ç´¢å¼•é¡µ&lt;/li>
&lt;li>æ’å…¥ç¼“å†²&lt;/li>
&lt;li>undo é¡µ&lt;/li>
&lt;li>è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•&lt;/li>
&lt;li>é”ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/innodb/buffer-pool/bufferpool.webp"
width="812"
height="377"
srcset="https://www.letout.cn/p/mysql/innodb/buffer-pool/bufferpool_hu9753cf048aa8ef6ecf388c9b29af095f_8518_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/mysql/innodb/buffer-pool/bufferpool_hu9753cf048aa8ef6ecf388c9b29af095f_8518_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="215"
data-flex-basis="516px"
>&lt;/p>
&lt;h2 id="-ç®¡ç†-buffer-pool-çš„é“¾è¡¨">ðŸ‘·â€â™‚ï¸ ç®¡ç† Buffer Pool çš„é“¾è¡¨&lt;/h2>
&lt;p>åœ¨ MySQL æœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè¿žç»­çš„ BuuferPool å†…å­˜ç©ºé—´çš„é¡µé¢æœ‰ç©ºé—²çš„ï¼Œä¹Ÿæœ‰éžç©ºé—²çš„ï¼Œä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿçš„æ‰¾åˆ°éœ€è¦çš„é¡µé¢ï¼Œé˜²æ­¢ä¸€ä¸ªä¸€ä¸ªçš„éåŽ†æµªè´¹æ—¶é—´ï¼Œ
InnoDB ä½¿ç”¨äº†è®¸å¤šðŸ”—&lt;strong>é“¾è¡¨&lt;/strong>ç®¡ç† Buffer Pool çš„é¡µï¼ˆç©ºé—²é¡µã€å¹²å‡€é¡µã€è„é¡µï¼‰ã€‚&lt;/p>
&lt;h3 id="-free-é“¾è¡¨----ç®¡ç†ç©ºé—²é¡µ">â›“ï¸ Free é“¾è¡¨ &amp;ndash; ç®¡ç†ç©ºé—²é¡µ&lt;/h3>
&lt;p>ðŸ’¡ ç©ºé—²é¡µï¼šBuffer Pool å†…å­˜ä¸­æœªè¢«ä½¿ç”¨çš„é¡µã€‚&lt;/p>
&lt;p>ä¸ºäº†èƒ½å¿«é€Ÿæ‰¾åˆ°ç©ºé—²çš„ç¼“å­˜é¡µï¼Œä½¿ç”¨ Free ç©ºé—²é“¾è¡¨ç®¡ç†ç©ºé—²é¡µã€‚&lt;/p>
&lt;p>Free é“¾è¡¨çš„èŠ‚ç‚¹æ˜¯ä¸€ä¸ªä¸ªç©ºé—²é¡µæ‰€å¯¹åº”çš„æŽ§åˆ¶å—ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/innodb/buffer-pool/free-list.webp"
width="1217"
height="597"
srcset="https://www.letout.cn/p/mysql/innodb/buffer-pool/free-list_hu2194ab0c933cdf7ef8a007d7c52bad5f_28012_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/mysql/innodb/buffer-pool/free-list_hu2194ab0c933cdf7ef8a007d7c52bad5f_28012_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="203"
data-flex-basis="489px"
>&lt;/p>
&lt;p>å½“éœ€è¦ä»Žç£ç›˜ä¸­åŠ è½½ä¸€ä¸ªé¡µåˆ° Buffer Pool æ—¶ï¼Œå°±ä»Ž Free é“¾è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªç©ºé—²é¡µï¼ŒåŠ è½½æ•°æ®å¹¶æ›´æ”¹æŽ§åˆ¶å—çš„ä¿¡æ¯ï¼Œå¹¶ä»Ž Free é“¾è¡¨ä¸­ç§»é™¤ã€‚&lt;/p>
&lt;h3 id="-flush-é“¾è¡¨----ç®¡ç†è„é¡µ">â›“ï¸ Flush é“¾è¡¨ &amp;ndash; ç®¡ç†è„é¡µ&lt;/h3>
&lt;p>ðŸ’¡ è„é¡µï¼ˆdirty pageï¼‰ï¼šä¿®æ”¹äº†ç¼“å­˜é¡µä¸­çš„æ•°æ®ï¼Œä¸Žç£ç›˜ä¸­çš„é¡µæ•°æ®ä¸ä¸€è‡´ï¼Œç§°ä¸ºè„é¡µã€‚&lt;/p>
&lt;p>è¢«ä¿®æ”¹è¿‡çš„ç¼“å­˜é¡µçš„æŽ§åˆ¶å—ï¼Œä¼šè¢«ä½œä¸ºèŠ‚ç‚¹åŠ å…¥åˆ° Flush é“¾è¡¨ã€‚&lt;/p>
&lt;p>Flush é“¾è¡¨çš„ç»“æž„å’Œ Free é“¾è¡¨å·®ä¸å¤šã€‚åŽå°çº¿ç¨‹ä¼šåœ¨ä¸€å®šçš„æ—¶æœºï¼Œé€šè¿‡éåŽ† Flush é“¾è¡¨ï¼Œå°†è„é¡µå†™å…¥ç£ç›˜ï¼ˆWALï¼‰ã€‚&lt;/p>
&lt;h3 id="-lru-é“¾è¡¨----ç®¡ç†è„é¡µå¹²å‡€é¡µ">â›“ï¸ LRU é“¾è¡¨ &amp;ndash; ç®¡ç†è„é¡µ&amp;amp;å¹²å‡€é¡µ&lt;/h3>
&lt;p>ðŸ’¡ å¹²å‡€é¡µï¼ˆclean pageï¼‰ï¼šåŠ è½½äº†æ•°æ®æœªä½œä¿®æ”¹çš„ç¼“å­˜é¡µã€‚&lt;/p>
&lt;p>ðŸ’¡ è„é¡µï¼ˆdirty pageï¼‰ï¼šåŠ è½½äº†æ•°æ®åšäº†ä¿®æ”¹çš„ç¼“å­˜é¡µã€‚&lt;/p>
&lt;p>Buffer Pool çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œä¸å¯èƒ½å°†æ‰€æœ‰çš„æ•°æ®éƒ½æ”¾åœ¨å†…å­˜ä¸­ï¼ŒinnoDB é€šè¿‡ LRU ç®—æ³•ï¼ˆä¿®æ”¹è¿‡çš„ï¼‰ï¼Œå°†é¢‘ç¹è®¿é—®çš„æ•°æ®åœç•™åœ¨ Buffer Pool ä¸­ã€‚&lt;/p>
&lt;p>ç®€å•çš„ LRU ç®—æ³•åœ¨ MySQL ä¸­å¯èƒ½ä¼šå¯¼è‡´ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ˜µ é¢„è¯»å¤±æ•ˆ&lt;/p>
&lt;p>MySQL ä¼šå°†è¢«åŠ è½½é¡µçš„ä¸´è¿‘é¡µä¸€åŒåŠ è½½åˆ°å†…å­˜ï¼ˆä¸ºäº†å‡å°‘ç£ç›˜ IOï¼‰ï¼Œå¦‚æžœè¿™äº›é¡µæ²¡æœ‰è¢«è®¿é—®ï¼Œè¿™ä¸ªé¢„è¯»ç›¸å½“äºŽæµªè´¹äº†ã€‚&lt;/p>
&lt;p>ï¼ˆé€šè¿‡å°† LRU é“¾è¡¨åˆ’åˆ†ä¸º young åŒºå’Œ old åŒºï¼ŒåŠ è½½çš„æ•°æ®çŽ°æ”¾åˆ° old åŒºåŸŸï¼Œè¢«è®¿é—®åˆ°ä¹‹åŽï¼Œæ‰è¢«åŠ å…¥ young åŒºåŸŸï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¤¢ Buffer Pool æ±¡æŸ“&lt;/p>
&lt;p>ä¸€ä¸ª SQL æ‰«æå¤§é‡çš„æ•°æ®ï¼ˆå¦‚ç´¢å¼•å¤±æ•ˆæ—¶ï¼Œè¿›è¡Œå…¨è¡¨æ‰«ææ¥åˆ¤æ–­æ¡ä»¶ï¼‰ï¼Œç”±äºŽé“¾è¡¨ç©ºé—´æœ‰é™ï¼Œå¯èƒ½ä¼šæŠŠå†…å­˜ä¸­çš„æ‰€æœ‰é¡µå…¨éƒ¨æ›¿æ¢å‡ºåŽ»ï¼Œå¯¼è‡´çƒ­ç‚¹æ•°æ®å…¨éƒ¨å¤±æ•ˆï¼ŒåŽç»­ç¼“å­˜å…¨éƒ¨æ²¡æœ‰å‘½ä¸­ï¼Œå¯¼è‡´å¤§é‡ç£ç›˜ IOã€‚&lt;/p>
&lt;p>ï¼ˆåŠ å¤§æ•°æ®æ”¾å…¥ young åŒºçš„æ¡ä»¶ï¼ŒåŠ è½½åˆ° old åŒºåŸŸçš„æ•°æ®ï¼Œåœç•™æ—¶é—´è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ‰æœ‰èµ„æ ¼æ”¾åˆ° young åŒºåŸŸï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/innodb/buffer-pool/lru-list.webp"
width="842"
height="212"
srcset="https://www.letout.cn/p/mysql/innodb/buffer-pool/lru-list_hub80bcb1068b40da49c3759e6a067b1e3_15066_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/mysql/innodb/buffer-pool/lru-list_hub80bcb1068b40da49c3759e6a067b1e3_15066_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="397"
data-flex-basis="953px"
>&lt;/p>
&lt;p>InnoDB çš„ LRU é“¾è¡¨è¢«åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼šï¼ˆ1ï¼‰çƒ­æ•°æ® young åŒºåŸŸï¼›ï¼ˆ2ï¼‰å†·æ•°æ® old åŒºåŸŸã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ“ƒ é¢„è¯»çš„é¡µåªä¼šåŠ è½½åˆ° old åŒºåŸŸçš„å¤´éƒ¨ï¼Œå½“è¯¥é¡µçœŸæ­£è¢«è®¿é—®çš„æ—¶å€™ï¼Œæ‰ä¼šè¢«ç§»åŠ¨åˆ° young åŒºçš„å¤´éƒ¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>â±ï¸ ç§»åŠ¨åˆ° young åŒºåŸŸçš„æ¡ä»¶é™¤äº†è¢«è®¿é—®å¤–ï¼Œè¿˜éœ€è¦åˆ¤æ–­åœç•™åœ¨ old åŒºåŸŸçš„æ—¶é—´ã€‚ï¼ˆé˜²æ­¢å…¨è¡¨æ‰«ææ—¶ï¼Œè¢«è®¿é—®ä¸€æ¬¡åŽå°±ä¸åœ¨ä½¿ç”¨ï¼‰ã€‚å½“è®¿é—®çš„ç¼“å­˜é¡µå·²ç»åœ¨ old åŒºåŸŸåœç•™æ—¶é—´è¶…è¿‡é˜ˆå€¼ &lt;code>innodb_old_blocks_time=1000ms&lt;/code> æ—¶ï¼Œæ‰ä¼šè¢«æ’å…¥åˆ° young åŒºå¤´éƒ¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-è„é¡µåˆ·ç›˜çš„æ—¶æœº">ðŸ’¿ è„é¡µåˆ·ç›˜çš„æ—¶æœº&lt;/h2>
&lt;p>å½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¼šè®°å½•å¯¹åº”çš„ redo log &amp;amp; bin logï¼ˆWALï¼‰ï¼Œä¿®æ”¹çš„æ˜¯ Buffer Pool ä¸­çš„ç¼“å­˜é¡µï¼Œç„¶åŽå°†å…¶è®¾ç½®ä¸ºè„é¡µå¹¶åŠ å…¥ Flush é“¾è¡¨ï¼Œç”±åŽå°çº¿ç¨‹åˆ·æ–°æ•°æ®åˆ°ç£ç›˜ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æƒ…å†µä¼šä¸»åŠ¨åˆ·æ–°æ•°æ®åˆ°ç£ç›˜ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŽ—ï¸ å½“ redo log æ—¥å¿—å†™æ»¡æ—¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ å½“ Buffer Pool ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šæ·˜æ±°ä¸€äº›ç¼“å­˜é¡µï¼Œå¦‚æžœæ—¶è„é¡µï¼Œä¼šåˆ·å…¥ç£ç›˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ å½“ MySQL è®¤ä¸ºç©ºé—²æ—¶ï¼Œå¼‚æ­¥åœ°å°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ å½“ MySQL ä¸»åŠ¨æ­£å¸¸å…³é—­å‰&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>è§‚å¯Ÿè€…æ¨¡å¼</title><link>https://www.letout.cn/p/design-pattern/observer/</link><pubDate>Mon, 06 Mar 2023 12:02:02 +0800</pubDate><guid>https://www.letout.cn/p/design-pattern/observer/</guid><description>&lt;img src="https://www.letout.cn/p/design-pattern/observer/observer.png" alt="Featured image of post è§‚å¯Ÿè€…æ¨¡å¼" />&lt;p>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§&lt;strong>è¡Œä¸ºåž‹æ¨¡å¼&lt;/strong>ã€‚&lt;/p>
&lt;p>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰å¯¹è±¡é—´çš„ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå…¶ä»–æ‰€æœ‰ä¾èµ–çš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°ã€‚&lt;/p>
&lt;p>è§‚å¯Ÿè€…æ¨¡å¼åˆç§°ä¸ºã€Œå‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€&lt;code>Publish-Subscribe&lt;/code>ï¼Œæ˜¯ä¸€ç§é€šçŸ¥æœºåˆ¶ï¼Œè®©å‘é€é€šçŸ¥çš„ä¸€æ–¹ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰å’ŒæŽ¥æ”¶é€šçŸ¥çš„ä¸€æ–¹ï¼ˆè§‚å¯Ÿè€…ï¼‰å½¼æ­¤åˆ†ç¦»ï¼Œäº’ä¸å½±å“ã€‚&lt;/p>
&lt;p>å¸¸è§çš„åœºæ™¯ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸ”– æ¯”å¦‚ Github çš„ Actionsï¼Œå…¶å®žå°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ç§ä½“çŽ°ï¼Œå½“æˆ‘ä»¬æ ¹æ®è§„åˆ™è¿›è¡Œäº†ä¸€äº› git æ“ä½œåŽï¼ŒGithub Actions ä¼šæ ¹æ®é…ç½®åšä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ç¼–è¯‘/æ£€æŸ¥æ ¼å¼ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-å®žçŽ°æ–¹å¼">ðŸŽˆ å®žçŽ°æ–¹å¼&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>ðŸŽ—ï¸ ã€Œå‘å¸ƒè€…ã€æ·»åŠ è®¢é˜…æœºåˆ¶ï¼Œå¯ä»¥æŽ§åˆ¶å¯¹è±¡è®¢é˜…ä¸Žå–æ¶ˆè®¢é˜…äº‹ä»¶&lt;/p>
&lt;ul>
&lt;li>ä¸€ä¸ªç”¨äºŽå­˜å‚¨è®¢é˜…è€…çš„ &lt;code>List&lt;/code> æˆå‘˜å˜é‡&lt;/li>
&lt;li>ç”¨äºŽæ·»åŠ /åˆ é™¤çš„å…¬æœ‰æ–¹æ³•&lt;/li>
&lt;li>å½“å‘ç”Ÿå‘å¸ƒè€…äº‹ä»¶æ—¶ï¼Œé€šè¿‡éåŽ†è®¢é˜…è€…å¹¶è°ƒç”¨å¯¹è±¡ç‰¹å®šçš„é€šçŸ¥æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/design-pattern/observer/publish.png"
width="470"
height="180"
srcset="https://www.letout.cn/p/design-pattern/observer/publish_hu2c6d1291c57d095b00122414ede351f4_6623_480x0_resize_box_3.png 480w, https://www.letout.cn/p/design-pattern/observer/publish_hu2c6d1291c57d095b00122414ede351f4_6623_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="261"
data-flex-basis="626px"
>&lt;/p>
&lt;ul>
&lt;li>ðŸŽ—ï¸ ã€Œè®¢é˜…è€…ã€å®žçŽ°ç»Ÿä¸€çš„æŽ¥å£ï¼Œå‘å¸ƒè€…ä»…é€šè¿‡è¯¥æŽ¥å£ä¸Žè®¢é˜…è€…äº¤äº’
&lt;ul>
&lt;li>é€šå¸¸ä¼šæœ‰å¯¹å„è®¢é˜…è€…è·Ÿè¸ªä¸€ä¸ªå‘å¸ƒè€…çš„äº‹ä»¶ï¼Œå®žçŽ°ç»Ÿä¸€æŽ¥å£é˜²æ­¢è€¦åˆ&lt;/li>
&lt;li>åœ¨æŽ¥å£ä¸­å£°æ˜Žé€šçŸ¥æ–¹æ³•åŠå…¶å‚æ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>âš  æ³¨æ„äº‹é¡¹ï¼š&lt;/p>
&lt;ul>
&lt;li>é¡ºåºæ‰§è¡Œé€šçŸ¥æ—¶ï¼Œå¯èƒ½ä¼šå› ä¸ºæŸä¸€è§‚å¯Ÿè€…å¯¼è‡´å¡å£³ï¼Œé€šå¸¸ä¼šé‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼æ‰§è¡Œä»»åŠ¡ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-å®žçŽ°">ðŸ› ï¸ å®žçŽ°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Store&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Product&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">products&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¸Œæœ›è®¢é˜…æ–°ä¸Šæž¶çš„å•†å“çš„äºº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ProudctObserver&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">observers&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ArrayList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">addObserver&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProudctObserver&lt;/span> &lt;span class="n">pb&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">observers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">pb&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pubilc&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">removeObserver&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ProductObserver&lt;/span> &lt;span class="n">pb&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">observers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">pb&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å‘å¸ƒæ–°å•†å“
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">addNewProduct&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BigDecimal&lt;/span> &lt;span class="n">price&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Product&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Product&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">price&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">products&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">p&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ðŸ“§ é€šçŸ¥è§‚å¯Ÿè€…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">observers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">o&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">onPublished&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ›´æ–°å•†å“ä»·æ ¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">setProductPrice&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">double&lt;/span> &lt;span class="n">price&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Product&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">products&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">p&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setPrice&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ðŸ“§ é€šçŸ¥è§‚å¯Ÿè€…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">observers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">o&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">onPriceChanged&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è¢«è§‚å¯Ÿè€…å®žçŽ°ç»Ÿä¸€çš„æŽ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">ProductObserver&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">onPublished&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Product&lt;/span> &lt;span class="n">product&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">onPriceChanged&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Product&lt;/span> &lt;span class="n">product&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è§‚å¯Ÿè€…å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Customer&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">ProdcutObserver&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Admin&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">ProductObserver&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// observer è§‚å¯Ÿè€…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Admin&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Admin&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Customer&lt;/span> &lt;span class="n">customer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Customer&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ³¨å†Œè§‚å¯Ÿè€…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">store&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">addObserver&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">admin&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">store&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">addObserver&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">customer&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Kafka</title><link>https://www.letout.cn/p/kafka/</link><pubDate>Sat, 04 Mar 2023 11:14:45 +0800</pubDate><guid>https://www.letout.cn/p/kafka/</guid><description>&lt;img src="https://www.letout.cn/p/kafka/kafka.webp" alt="Featured image of post Kafka" />&lt;blockquote>
&lt;p>Apache Kafka is an open-source distributed event streaming platform.&lt;/p>
&lt;p>Kafka æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼äº‹ä»¶æµå¹³å°ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="-åŸºæœ¬æ¦‚å¿µ">ðŸ“‘ åŸºæœ¬æ¦‚å¿µ&lt;/h2>
&lt;h3 id="productor--consumer">Productor &amp;amp; Consumer&lt;/h3>
&lt;p>æŠŠæ¶ˆæ¯æ”¾åˆ°é˜Ÿåˆ—é‡Œé¢çš„å«ã€Œç”Ÿäº§è€…ã€ï¼›ä»Žé˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯çš„å«ã€Œæ¶ˆè´¹è€…ã€ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/productor-consumer.png"
width="1482"
height="182"
srcset="https://www.letout.cn/p/kafka/productor-consumer_hu2c5c2f226caa4e26dde9bd9923036917_30803_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/productor-consumer_hu2c5c2f226caa4e26dde9bd9923036917_30803_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="814"
data-flex-basis="1954px"
>&lt;/p>
&lt;h3 id="topic">Topic&lt;/h3>
&lt;p>Producer å°†æ¶ˆæ¯å‘é€åˆ°ç‰¹å®šçš„ä¸»é¢˜ &lt;code>Topic&lt;/code>ï¼ŒConsumer é€šè¿‡è®¢é˜…ç‰¹å®šçš„ä¸»é¢˜ &lt;code>Topic&lt;/code> æ¥æ¶ˆè´¹æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>å¹¶éžæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½æƒ³è¦å…¨éƒ¨çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…åªå¯¹è‡ªå·±æ„Ÿå…´è¶£çš„ Topic è¿›è¡Œè®¢é˜…ï¼Œä»ŽæŒ‡å®šçš„ Topic æ¥èŽ·å–æ¶ˆæ¯ã€‚
è¿™ä¸ªå‘é€é—®é¢˜ç”± ç”Ÿäº§è€… &lt;code>Product&lt;/code> æ¥è§£å†³ï¼Œç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œé€»è¾‘ä¸Šçš„åˆ†ç±»ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„ &lt;code>Topic&lt;/code>ã€‚ï¼ˆå‘å¸ƒ-è®¢é˜…æ¨¡åž‹ï¼‰&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/topic.png"
width="1702"
height="464"
srcset="https://www.letout.cn/p/kafka/topic_huc74fa2ac18b398764e9e6113e92396e7_102693_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/topic_huc74fa2ac18b398764e9e6113e92396e7_102693_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="366"
data-flex-basis="880px"
>&lt;/p>
&lt;h3 id="offset">offset&lt;/h3>
&lt;p>å¤šä¸ªæ¶ˆè´¹è€…å¯èƒ½å¯¹åŒä¸€ä¸ªä¸»é¢˜æ„Ÿå…´è¶£ï¼Œå³å¤šä¸ªæ¶ˆè´¹è€… &lt;code>Consumer&lt;/code> è®¢é˜…åŒä¸€ä¸ªä¸»é¢˜ &lt;code>Topic&lt;/code>ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ¶ˆè´¹é—®é¢˜ç”± æ¶ˆè´¹è€… &lt;code>Consumer&lt;/code> æ¥è§£å†³ã€‚
Kafka å°†æ‰€æœ‰çš„æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œè®©æ¶ˆè´¹è€…å„å–æ‰€éœ€ï¼Œæƒ³å–å“ªä¸ªæ¶ˆæ¯ï¼Œæƒ³ä»€ä¹ˆæ—¶å€™å–éƒ½è¡Œï¼Œåªéœ€è¦ä¼ é€’ä¸€ä¸ªæ¶ˆæ¯çš„ &lt;code>offset&lt;/code> å³å¯ã€‚&lt;/p>
&lt;p>Kafka å°†æ¶ˆæ¯ä»¥æ¶ˆæ¯æ—¥å¿—çš„æ–¹å¼è¿½åŠ å†™åœ¨ç£ç›˜ä¸­ï¼ˆé¡ºåºç£ç›˜ IOï¼‰ã€‚&lt;/p>
&lt;p>&lt;code>offset&lt;/code> è¡¨ç¤ºäº†æ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦ã€‚æ¯ä¸€æ¡æ¶ˆæ¯éƒ½ä¼šæ ¹æ®æ—¶é—´å…ˆåŽé¡ºåºæœ‰ä¸€ä¸ªé€’å¢žçš„åºå·ï¼Œç”¨ offset æ¥è¡¨ç¤ºæ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦åˆ°å“ªäº†ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…ä¼šéƒ½æœ‰è‡ªå·±çš„ offsetã€‚&lt;/p>
&lt;p>æ¯æ¬¡æ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™ï¼Œéƒ½è¦æäº¤è¿™ä¸ª &lt;code>offset&lt;/code>ï¼ŒKafka å¯ä»¥é€‰æ‹©ã€Œè‡ªåŠ¨æäº¤ã€æˆ–è€…ã€Œæ‰‹åŠ¨æäº¤ã€ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/offset.png"
width="1702"
height="882"
srcset="https://www.letout.cn/p/kafka/offset_hub631ed3146c750d7a1db077a25e92c8f_157136_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/offset_hub631ed3146c750d7a1db077a25e92c8f_157136_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="192"
data-flex-basis="463px"
>&lt;/p>
&lt;h3 id="partition">Partition&lt;/h3>
&lt;p>&lt;code>Partition&lt;/code> æ˜¯ Kafka ã€Œæœ€åŸºæœ¬çš„éƒ¨ç½²å•å…ƒã€ã€‚&lt;/p>
&lt;p>å¯¹äºŽæµ·é‡æ•°æ®ï¼Œå•æœºçš„å­˜å‚¨å®¹é‡å’Œè¯»å†™æ€§èƒ½è‚¯å®šæœ‰é™ï¼Œä¸€ç§å¸¸è§çš„å­˜å‚¨æ–¹æ¡ˆå°±æ˜¯ã€Œå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¾‹å¦‚åœ¨ MySQL ä¸­ï¼Œå•è¡¨çš„æ•°é‡è¾¾åˆ°å‡ åƒä¸‡ã€ä¸Šäº¿æ—¶ï¼Œä¼šè¿›è¡Œåˆ†åº“ã€åˆ†è¡¨æ“ä½œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¾‹å¦‚åœ¨ Redis ä¸­ï¼Œå½“å•ä¸ªå®žä¾‹çš„æ•°æ®é‡è¾¾åˆ°å‡ åGå¼•å‘æ€§èƒ½ç“¶é¢ˆæ—¶ï¼Œä¼šè¿›è¡Œåˆ†ç‰‡é›†ç¾¤&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨ Kafka ä¸­ï¼ŒåŒæ ·é‡‡å–äº†æ°´å¹³æ‹†åˆ†çš„æ–¹æ¡ˆï¼Œå°†æ‹†åˆ†åŽçš„æ•°æ®å­é›†ç§°ä¸º &lt;code>Partition&lt;/code> åˆ†åŒºã€‚å„ä¸ªåˆ†åŒºçš„æ•°æ®é›†åˆå³ä¸ºå…¨é‡æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/partition.png"
width="1902"
height="862"
srcset="https://www.letout.cn/p/kafka/partition_hu6f8e653e05b83b30cced1268a2afdec4_169756_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/partition_hu6f8e653e05b83b30cced1268a2afdec4_169756_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="220"
data-flex-basis="529px"
>&lt;/p>
&lt;p>åˆ†åŒºè·¯ç”±å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºä¸€ä¸ª Hash å‡½æ•°ï¼Œç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªå‡½æ•°çš„è§„åˆ™å†³å®šå‘å¾€çš„åˆ†åŒºã€‚å°†åˆ†åŒºè§„åˆ™è®¾è®¡çš„åˆç†ï¼Œå¯ä»¥å°†æ¶ˆæ¯å‡åŒ€åœ°åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºä¸Šã€‚&lt;/p>
&lt;p>ç”Ÿäº§è€… &lt;code>Productor&lt;/code> å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå…ˆé€šè¿‡ &lt;code>Topic&lt;/code> å¯¹æ¶ˆæ¯è¿›è¡Œé€»è¾‘åˆ†ç±»ï¼Œåœ¨é€šè¿‡ &lt;code>Partition&lt;/code> è¿›ä¸€æ­¥åšç‰©ç†åˆ†ç‰‡ï¼Œæœ€ç»ˆå¤šä¸ª Partition ä¼šå‡åŒ€åœ°åˆ†å¸ƒåœ¨é›†ç¾¤çš„æ¯å°æœºå™¨ä¸Šï¼Œä»Žè€Œå¾ˆå¥½åœ°è§£å†³äº†å­˜å‚¨æ‰©å±•æ€§é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="broker">Broker&lt;/h3>
&lt;p>ä¸€å° Kafka æœåŠ¡å™¨è¢«ç§°ä¸º &lt;code>Broker&lt;/code>ï¼ŒKafka é›†ç¾¤ç”±å¤šå° Kafka æœåŠ¡å™¨ç»„æˆã€‚&lt;/p>
&lt;p>Kafka æ˜¯ã€Œå¤©ç„¶åˆ†å¸ƒå¼ã€çš„ã€‚&lt;/p>
&lt;p>ä¸€ä¸ª &lt;code>Topic&lt;/code> ä¼šè¢«åˆ†ä¸ºå¤šä¸ª &lt;code>Partition&lt;/code>ï¼Œè¿™äº› Partition ä¼šåˆ†å¸ƒåœ¨ä¸åŒçš„ &lt;code>Broker&lt;/code> ä¸­ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/broker.png"
width="2744"
height="1204"
srcset="https://www.letout.cn/p/kafka/broker_huddafab0296be063dc2cfa60773db7d44_193217_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/broker_huddafab0296be063dc2cfa60773db7d44_193217_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="227"
data-flex-basis="546px"
>&lt;/p>
&lt;h3 id="leader--follower">leader &amp;amp; follower&lt;/h3>
&lt;p>åœ¨ Kafka é›†ç¾¤ä¸­ï¼Œæ¯å°æœºå™¨éƒ½ä¼šå­˜å‚¨ä¸€äº› Partitionï¼Œä¸ºäº†é˜²æ­¢æœºå™¨å®•æœºæ—¶ï¼Œè¿™éƒ¨åˆ†æ•°æ®æ— æ³•è®¿é—®çš„é—®é¢˜ï¼ˆæŒä¹…åŒ–ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼‰ã€‚
éœ€è¦ Kafka å…·å¤‡æ•…éšœè½¬ç§»èƒ½åŠ›ï¼Œå½“æŸå°æœºå™¨å®•æœºåŽï¼Œèƒ½å¤Ÿç»§ç»­ä¿è¯æœåŠ¡å¯ç”¨ã€‚&lt;/p>
&lt;p>ä¸Ž Reids Cluster ç±»ä¼¼ï¼ŒKafka é€šè¿‡ã€ŒPartition å¤šå‰¯æœ¬ã€çš„æ–¹å¼ï¼Œè§£å†³äº†é«˜å¯ç”¨é—®é¢˜ã€‚
åœ¨ Kafka é›†ç¾¤ä¸­ï¼Œæ¯ä¸ª Partition éƒ½æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œä¿å­˜äº†ç›¸åŒçš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å‰¯æœ¬ä¹‹é—´æ˜¯ ã€Œä¸€ä¸»å¤šä»Žã€çš„å…³ç³»ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>leader&lt;/code> å‰¯æœ¬è´Ÿè´£è¯»å†™æ•°æ®&lt;/li>
&lt;li>&lt;code>follower&lt;/code> å‰¯æœ¬è´Ÿè´£åŒæ­¥æ¶ˆæ¯ï¼Œåªè´Ÿè´£å¾…å‘½&lt;/li>
&lt;/ul>
&lt;p>å½“ leader å‰¯æœ¬å‘é€æ•…éšœæ—¶ï¼Œé€‰ä¸¾ follower å‰¯æœ¬æˆä¸ºæ–°çš„ leader å¯¹å¤–æä¾›æœåŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/leader_follwer.png"
width="1642"
height="982"
srcset="https://www.letout.cn/p/kafka/leader_follwer_hud0b2c7f759aaa7a9577276a758bf8076_131159_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/leader_follwer_hud0b2c7f759aaa7a9577276a758bf8076_131159_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="167"
data-flex-basis="401px"
>&lt;/p>
&lt;h3 id="consumer-group">Consumer Group&lt;/h3>
&lt;p>Kafka æ˜¯ä¸ªé«˜å¹¶å‘çš„ç³»ç»Ÿï¼Œæ¶ˆæ¯çš„æ‹‰å–åŒæ ·æ˜¯å¹¶è¡Œçš„ï¼Œå¤šä¸ªæ¶ˆè´¹è€…åŽ»æ¶ˆè´¹ Topic æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>Kafka å¼•å…¥äº†æ¶ˆè´¹è€…ç»„ &lt;code>Consumer Group&lt;/code> çš„æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ¶ˆè´¹è€…ç»„ã€‚ç»„é—´è¿›è¡Œå¹¿æ’­æ¶ˆè´¹ï¼Œç»„å†…è¿›è¡Œé›†ç¾¤æ¶ˆè´¹ã€‚åŒæ—¶é™å®šï¼šã€Œæ¯ä¸ª Partition åªèƒ½ç”±æ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/consumer_group.png"
width="1952"
height="1378"
srcset="https://www.letout.cn/p/kafka/consumer_group_hu7674cf08adee570cc4acecde56b2e047_315635_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/consumer_group_hu7674cf08adee570cc4acecde56b2e047_315635_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>å½“éœ€è¦åŠ å¿«æ¶ˆæ¯çš„å¤„ç†é€Ÿåº¦ï¼Œï¼ˆå¦‚æ¶ˆè´¹è€…ç»„Bï¼‰åªéœ€è¦å¢žåŠ æ–°çš„æ¶ˆè´¹è€…å³å¯ï¼ŒKafka ä¼šä»¥ Patition ä¸ºå•ä½é‡æ–°åšè´Ÿè½½å‡è¡¡ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥æ¶ˆè´¹ Topic çš„å…¨éƒ¨æ•°æ®ï¼Œæ¶ˆè´¹è€…ç»„åœ¨é€»è¾‘ä¸Šæ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚&lt;/p>
&lt;h2 id="-å­˜å‚¨ç»“æž„">ðŸ—³ï¸ å­˜å‚¨ç»“æž„&lt;/h2>
&lt;p>Kafka ä½¿ç”¨ã€Œæ—¥å¿—æ–‡ä»¶ Loggingã€çš„æ–¹å¼æ¥å­˜å‚¨æ¶ˆæ¯ï¼›ä½¿ç”¨ã€Œç¨€ç–å“ˆå¸Œç´¢å¼•ã€æ¥åŠ å¿«æŸ¥è¯¢ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Kafka å­˜å‚¨çš„ä¸»è¦æ˜¯æ¶ˆæ¯æµï¼ˆæ–‡æœ¬ã€è‡ªå®šä¹‰æ ¼å¼ï¼‰ï¼Œå¯¹äºŽ Broker æ¥è¯´ï¼Œåªéœ€è¦å…³æ³¨æ¶ˆæ¯çš„æŠ•é€’ï¼Œæ— éœ€å…³æ³¨å†…å®¹æœ¬èº«&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å†™å…¥æ–¹é¢ï¼Œæ•°æ®é‡çº§éžå¸¸å¤§ï¼Œéƒ½æ˜¯æŒ‰é¡ºåºå†™å…¥ï¼ˆé˜Ÿåˆ—ï¼‰ï¼Œä¸”æ— éœ€è€ƒè™‘æ›´æ–°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éœ€æ±‚ç®€å•ï¼Œåªéœ€è¦æŒ‰ç…§ offset æŸ¥è¯¢æ¶ˆæ¯å³å¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä¸ºäº†æ»¡è¶³å…¶å†™å…¥éœ€æ±‚ï¼ˆé‡çº§å¤§ã€ä¸æ›´æ–°ï¼‰ï¼Œé‡‡ç”¨ Append è¿½åŠ æ—¥å¿—çš„æ–¹å¼æœ€ç†æƒ³ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨ã€Œç£ç›˜é¡ºåº IOã€ã€‚&lt;/p>
&lt;p>åœ¨æŸ¥è¯¢æ—¶ï¼Œåªéœ€è¦é€šè¿‡ offset å®šä½æ¶ˆæ¯ï¼Œåœ¨å†…å­˜ä¸­ç»´æŠ¤äº†ä¸€ä¸ªã€Œä»Ž offset åˆ°æ—¥å¿—æ–‡ä»¶çš„åç§»é‡ã€çš„æ˜ å°„å…³ç³»ï¼Œæ¯æ¬¡
æŸ¥è¯¢æ—¶ï¼Œå…ˆæ ¹æ® offset æ‰¾åˆ°æ—¥å¿—æ–‡ä»¶çš„åç§»é‡ï¼Œå³å¯å¿«é€Ÿè¯»å–åˆ°æ—¥å¿—æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å…å“ˆå¸Œç´¢å¼•å¸¸é©»å†…å­˜æ¶ˆè€—è¿‡å¤šç©ºé—´çš„é—®é¢˜ï¼Œå°†æ¶ˆæ¯åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå— blockï¼Œæ¯ä¸ªç´¢å¼•éœ€è¦å®šä½ block å—ä¸­çš„ç¬¬ä¸€æ¡æ¶ˆæ¯çš„ offset å³å¯ï¼ˆç¨€ç–ç´¢å¼•ï¼‰ï¼Œ
ç„¶åŽåœ¨ block ä¸­é¡ºåºæŸ¥æ‰¾ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/hash.png"
width="702"
height="486"
srcset="https://www.letout.cn/p/kafka/hash_hu74f0171d0dcbf8a19203c6a91442ff0f_91411_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/hash_hu74f0171d0dcbf8a19203c6a91442ff0f_91411_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="144"
data-flex-basis="346px"
>&lt;/p>
&lt;h2 id="-kafka-çš„é«˜æ€§èƒ½">ðŸ”¥ Kafka çš„é«˜æ€§èƒ½&lt;/h2>
&lt;p>&lt;img src="https://www.letout.cn/p/kafka/performance.png"
width="725"
height="662"
srcset="https://www.letout.cn/p/kafka/performance_hu3423f3489c82f749f8bb253d443fb73a_35239_480x0_resize_box_3.png 480w, https://www.letout.cn/p/kafka/performance_hu3423f3489c82f749f8bb253d443fb73a_35239_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="109"
data-flex-basis="262px"
>&lt;/p>
&lt;h3 id="-ç”Ÿäº§æ¶ˆæ¯">ðŸ“‘ ç”Ÿäº§æ¶ˆæ¯&lt;/h3>
&lt;p>Kafka å®¢æˆ·ç«¯ä¸Žä¼ ç»Ÿçš„æ•°æ®åº“æˆ–æ¶ˆæ¯ä¸­é—´ä»¶ä¸åŒï¼Œåœ¨å°†æ¶ˆæ¯å‘é€ç»™ Broker ä¹‹å‰ï¼Œåœ¨ Client ç«¯å…ˆå®Œæˆå¤§é‡çš„å·¥ä½œä¹‹åŽæ‰å‘é€æ¶ˆæ¯ï¼Œåˆ†æ‘Š Broker çš„è®¡ç®—åŽ‹åŠ›ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ«§ æ‰¹é‡å‘é€&lt;/p>
&lt;p>Kafka é€šè¿‡å¯¹å¤šæ¡æ¶ˆæ¯æŒ‰ç…§åˆ†åŒºè¿›è¡Œåˆ†ç»„ï¼Œæ¯æ¬¡å‘é€ä¸€ä¸ªæ¶ˆæ¯é›†åˆï¼Œä»Žè€Œå‡å°‘ç½‘ç»œä¼ è¾“çš„å¼€é”€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ æ¶ˆæ¯åŽ‹ç¼©&lt;/p>
&lt;p>åœ¨æ‰¹é‡å‘é€çš„å‰æä¸‹ï¼Œå¯¹æ¶ˆæ¯è¿›è¡ŒåŽ‹ç¼©ï¼ˆæ•°æ®é‡è¶Šå¤§ï¼ŒåŽ‹ç¼©æ•ˆæžœæ›´å¥½ï¼‰ã€‚åŒæ—¶å¯¹å¤šæ¡æ¶ˆæ¯è¿›è¡ŒåŽ‹ç¼©ï¼Œèƒ½å¤§å¹…å‡å°‘æ•°æ®é‡ï¼Œ
åŒæ—¶å‡å°‘ç½‘ç»œã€ç£ç›˜IOå¼€é”€ã€‚æ¶ˆæ¯æŒä¹…åŒ–åˆ° Broker çš„ç£ç›˜æ—¶ï¼Œä¾æ—§æ˜¯åŽ‹ç¼©çŠ¶æ€ï¼Œæœ€ç»ˆæ˜¯åœ¨ Consumer ç«¯è¿›è¡Œè§£åŽ‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ é«˜æ•ˆåºåˆ—åŒ–&lt;/p>
&lt;p>Kafka çš„ Key å’Œ Valueï¼Œéƒ½æ”¯æŒè‡ªå®šä¹‰ç±»åž‹ï¼Œåªéœ€è¦æä¾›ç›¸åº”çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨å³å¯ã€‚å¯ä»¥æ ¹æ®æƒ…å†µé€‰å–å¯¹åº”çš„åºåˆ—åŒ–æ–¹å¼ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ å†…å­˜æ± å¤ç”¨&lt;/p>
&lt;p>Kafka æå‡ºäº†ã€Œå†…å­˜æ± æœºåˆ¶ã€ï¼Œæé«˜å¤ç”¨ï¼Œå‡å°‘é¢‘ç¹çš„åˆ›å»ºå’Œå›žæ”¶ã€‚ï¼ˆæœ¬è´¨ä¸Šä¸Žè¿žæŽ¥æ± ã€çº¿ç¨‹æ± ä¸€æ ·ï¼‰ã€‚&lt;/p>
&lt;p>Productor åœ¨åˆ›å»ºæ—¶ï¼Œä¼šå ç”¨ä¸€å—å›ºå®šå¤§å°çš„å†…å­˜åŒºåŸŸï¼Œåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå—ï¼ˆä¾‹å¦‚ 16KBï¼‰ã€‚å½“éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å‘é€ Batch æ—¶ï¼Œç›´æŽ¥ä»Žå†…å­˜ä¸­å–å‡ºä¸€ä¸ªå—ï¼Œ
ä»Žä¸­ä¸æ–­åœ°å†™å…¥æ¶ˆæ¯ï¼ˆå†™æ»¡æˆ–åˆ°æŒ‡å®šé˜ˆå€¼æ—¶é—´æ—¶ï¼‰ï¼Œå°†è¿™ä¸ª Batch å‘é€ç»™ Brokerï¼Œä¹‹åŽå†…å­˜å—å°±ä¼šå›žåˆ°ç¼“å­˜æ± ä¸­ç»§ç»­å¤ç”¨ã€‚
ä¸ä¼šæ¶‰åŠ JVM çš„å†…å­˜å›žæ”¶ï¼Œä»¥åº”å¯¹ Kafka çš„é«˜å¹¶å‘åœºæ™¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-å­˜å‚¨æ¶ˆæ¯">ðŸ“‡ å­˜å‚¨æ¶ˆæ¯&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ«§ IO å¤šè·¯å¤ç”¨&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>1&lt;/code> ä¸ª &lt;code>Acceptor&lt;/code> çº¿ç¨‹ï¼Œå¤„ç†æ–°çš„è¿žæŽ¥ï¼›ä½¿ç”¨ &lt;code>N&lt;/code> ä¸ª &lt;code>Processor&lt;/code> çº¿ç¨‹ï¼Œè¯»å–è¯·æ±‚ï¼›ä½¿ç”¨ &lt;code>M&lt;/code> ä¸ª &lt;code>Handler&lt;/code> çº¿ç¨‹ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p>
&lt;p>&lt;code>1&lt;/code> ä¸ª &lt;code>Acceptor&lt;/code> çº¿ç¨‹ï¼šç”¨äºŽç›‘å¬ç½‘ç»œå¥—æŽ¥å­—ï¼ŒæŽ¥å—è¯·æ±‚ï¼Œç„¶åŽå°†è¯·æ±‚æ´¾å‘ç»™ Processor çº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚
ä¸Ž Redis ç›¸åŒï¼ŒIO å¤šè·¯å¤ç”¨å…è®¸å†…æ ¸ä¸­åŒæ—¶ç®¡ç†å¤šä¸ª scoket è¿žæŽ¥ï¼Œå†…æ ¸ä¼šä¸€ç›´ç›‘å¬è¿™äº›è¿žæŽ¥ï¼Œä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šé€šçŸ¥å¤„ç†çº¿ç¨‹ï¼Œè¾¾åˆ°ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¯·æ±‚çš„æ•ˆæžœã€‚&lt;/p>
&lt;p>&lt;code>N&lt;/code> ä¸ª &lt;code>Processor&lt;/code> çº¿ç¨‹ï¼šKafka ä¼šç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå°†è¯·æ±‚åˆ†å‘ç»™å¯ç”¨çš„ Processor çº¿ç¨‹å¤„ç†ã€‚ä¸»è¦è´Ÿè´£ä»Žå¥—æŽ¥å­—è¯»å–æ¶ˆæ¯ï¼Œè§£æžå¤„ç†ï¼Œå¹¶å°†å“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚è¾¾åˆ°æ‰¹é‡æ“ä½œï¼Œæé«˜åžåé‡ã€‚&lt;/p>
&lt;p>&lt;code>M&lt;/code> ä¸ª &lt;code>Handler&lt;/code> çº¿ç¨‹ï¼šç»´æŠ¤çš„çº¿ç¨‹æ± ï¼Œè´Ÿè´£è¯»å– Kafka Topic ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶å°†å…¶æäº¤åˆ°å¯¹åº”çš„ Consumer Groupã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ ç£ç›˜é¡ºåº IO&lt;/p>
&lt;p>Kafka é‡‡ç”¨æ—¥å¿—æ–‡ä»¶çš„æ–¹å¼æŒä¹…åŒ–æ—¥å¿—ï¼Œä»¥ Append Only çš„æ–¹å¼è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼Œé¡ºåº IO ä½¿å†™å…¥é€Ÿåº¦éžå¸¸å¿«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ Page Cache&lt;/p>
&lt;p>åˆ©ç”¨äº†æ“ä½œç³»ç»Ÿæœ¬èº«çš„ç¼“å­˜æŠ€æœ¯ï¼Œåœ¨è¯»å†™ç£ç›˜æ–‡ä»¶æ—¶ï¼Œå…¶å®žæ“ä½œçš„éƒ½æ˜¯å†…å­˜ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™å°† Page Cache ä¸­çš„æ•°æ®çœŸæ­£åˆ·å…¥ç£ç›˜ã€‚&lt;/p>
&lt;p>Page Cache ç¼“å­˜ä¸­ä¿å­˜çš„æ˜¯æœ€è¿‘å¯èƒ½è¢«ä½¿ç”¨çš„ç£ç›˜æ•°æ®ï¼Œå…·æœ‰æ—¶é—´å±€éƒ¨æ€§ï¼ˆæœ€è¿‘è®¿é—®çš„æ•°æ®å¯èƒ½å†æ¬¡è®¿é—®ï¼‰å’Œ ç©ºé—´å±€éƒ¨æ€§ï¼ˆè®¿é—®çš„æ•°æ®çš„å‘¨è¾¹æ•°æ®è¢«è®¿é—®çš„æ¦‚çŽ‡æžé«˜ï¼‰ã€‚
ä½œä¸ºé¡ºåºå†™å…¥çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æžœç”Ÿäº§å’Œæ¶ˆè´¹åœ°ç‰¹åˆ«å¿«ï¼Œåˆ©ç”¨ Broker Page Cacheï¼Œç”šè‡³å¯ä»¥ä¸ç»è¿‡ç£ç›˜å®Œæˆæ“ä½œã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ åˆ†åŒºåˆ†æ®µç»“æž„&lt;/p>
&lt;p>Kafka çš„ Topic ä¼šè¢«åˆ†åŒºä¸ºå¤šä¸ª Partitionï¼Œåœ¨å¤šå° Broker ä¸­ï¼Œä½¿ç”¨å¤šä¸ªæœåŠ¡æ¥æŽ¥å—æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>åŒæ—¶æ¯ä¸ªåˆ†åŒº Partition ä¼šè¢«åˆ†ä¸ºå¤šä¸ªæ®µ Segment æ¥ç®¡ç†ï¼Œæ¯ä¸ªæ®µå†…éƒ½æ˜¯é¡ºåºå†™ï¼Œé¿å…åˆ†åŒºè¿‡å¤§ï¼Œåˆ©äºŽç®¡ç†ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¶ˆè´¹æ¶ˆæ¯">ðŸ“® æ¶ˆè´¹æ¶ˆæ¯&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ«§ ç¨€ç–ç´¢å¼•&lt;/p>
&lt;p>Kafka æŸ¥è¯¢åœºæ™¯éžå¸¸ç®€å•ï¼ŒæŒ‰ç…§ offset æŸ¥è¯¢æ¶ˆæ¯å³å¯ã€‚ä¸ºäº†åŠ å¿«è¯»æ“ä½œï¼Œåªéœ€è¦åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ª offset åˆ°æ—¥å¿—æ–‡ä»¶çš„åç§»é‡çš„æ˜ å°„å…³ç³» &lt;code>Map&lt;/code> å³å¯ã€‚
æ¯æ¬¡æŸ¥æ‰¾æ¶ˆæ¯ï¼Œå…ˆä»Žå“ˆå¸Œè¡¨ä¸­æŸ¥åˆ°æ–‡ä»¶åç§»é‡ï¼Œå†åŽ»è¯»æ—¥å¿—æ–‡ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ mmap&lt;/p>
&lt;p>&lt;code>memory mapped files&lt;/code>&lt;/p>
&lt;p>é‡‡ç”¨ mmap æ˜ å°„ç´¢å¼•æ–‡ä»¶ï¼ŒåŠ å¿«ç´¢å¼•çš„æŸ¥æ‰¾è¿‡ç¨‹ã€‚å°†ç£ç›˜æ–‡ä»¶ä¸Žå†…å­˜è™šæ‹Ÿåœ°å€åšäº†æ˜ å°„ï¼Œä¸éœ€è¦æ“ä½œç£ç›˜IOï¼Œè¿›ç¨‹å¯ä»¥ä½¿ç”¨æŒ‡é’ˆçš„æ–¹å¼æ“ä½œè¿™ä¸€å—å†…å­˜ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†è„é¡µå†™å…¥åˆ°å¯¹åº”çš„ç£ç›˜æ–‡ä»¶ä¸Šã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ é›¶æ‹·è´&lt;/p>
&lt;p>é‡‡ç”¨äº†é›¶æ‹·è´ï¼Œå°†æ•°æ®ä»Žå†…å­˜ä¸­çš„ç¼“å­˜åŒºç›´æŽ¥æ‹·è´åˆ°ç½‘å¡è®¾å¤‡ï¼Œæ— éœ€ç»è¿‡åº”ç”¨ç¨‹åºï¼Œå‡å°‘äº†æ•°æ®çš„æ‹·è´å’Œå†…æ ¸æ€ä¸Žç”¨æˆ·æ€çš„åˆ‡æ¢ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ æ‰¹é‡æ‹‰å–&lt;/p>
&lt;p>ä¸Žå‘é€æ¶ˆæ¯å¯¹åº”ï¼Œæ¶ˆè´¹æ¶ˆæ¯ä¹Ÿæ˜¯æ‰¹é‡æ‹‰å–çš„ï¼Œæ¯æ¬¡æ‹‰å–ä¸€ä¸ªæ¶ˆæ¯é›†åˆï¼Œå‡å°‘ç½‘ç»œçš„å¼€é”€ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247490102&amp;amp;idx=1&amp;amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;amp;scene=21#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247490102&amp;idx=1&amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;scene=21#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247490102&amp;amp;idx=1&amp;amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247490102&amp;idx=1&amp;sn=68d55b3c5ac74038c76d6837b862a11c&amp;chksm=fc78c51acb0f4c0cd5a1d6ceedb9948f82d48791ab789e9edfd6e83e34fbad1ace5749bee203&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491055&amp;amp;idx=1&amp;amp;sn=14bc485f91ec2629cc9e8bf7a36ad8f4&amp;amp;chksm=fc78c2c3cb0f4bd566d5ca2534805839420ad3dc67210bc8f2b7ef05283785b02b8ddef640a8&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491055&amp;idx=1&amp;sn=14bc485f91ec2629cc9e8bf7a36ad8f4&amp;chksm=fc78c2c3cb0f4bd566d5ca2534805839420ad3dc67210bc8f2b7ef05283785b02b8ddef640a8&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491168&amp;amp;idx=1&amp;amp;sn=bd37f96692b3f7cecdaf3172abdb7a8c&amp;amp;chksm=fc78c14ccb0f485a451f70c7ffbf5b05d0f500dfef6321703e7cdebdc0de902d9d77a547d469&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491168&amp;idx=1&amp;sn=bd37f96692b3f7cecdaf3172abdb7a8c&amp;chksm=fc78c14ccb0f485a451f70c7ffbf5b05d0f500dfef6321703e7cdebdc0de902d9d77a547d469&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491507&amp;amp;idx=1&amp;amp;sn=f1bec356c94cd0101809dc11dcf27ba2&amp;amp;chksm=fc78c09fcb0f49898f6cc9b80499aeb871a80f95ab4fbe12c32567cab6a3521a6c33b61dd807&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=189#wechat_redirect" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491507&amp;idx=1&amp;sn=f1bec356c94cd0101809dc11dcf27ba2&amp;chksm=fc78c09fcb0f49898f6cc9b80499aeb871a80f95ab4fbe12c32567cab6a3521a6c33b61dd807&amp;cur_album_id=1763234202604388353&amp;scene=189#wechat_redirect&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;amp;mid=2247491763&amp;amp;idx=1&amp;amp;sn=cc60a6ba13e5cf4384e623819c621e0d&amp;amp;chksm=fc7b3f9fcb0cb6897be67103d91854831b71909c0d12385fb52b2f1d011fca5d1844b3892019&amp;amp;cur_album_id=1763234202604388353&amp;amp;scene=190#rd" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MzU2MTM4NDAwMw==&amp;mid=2247491763&amp;idx=1&amp;sn=cc60a6ba13e5cf4384e623819c621e0d&amp;chksm=fc7b3f9fcb0cb6897be67103d91854831b71909c0d12385fb52b2f1d011fca5d1844b3892019&amp;cur_album_id=1763234202604388353&amp;scene=190#rd&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>åˆ†å¸ƒå¼äº‹åŠ¡</title><link>https://www.letout.cn/p/distributed/transaction/</link><pubDate>Fri, 03 Mar 2023 12:14:45 +0800</pubDate><guid>https://www.letout.cn/p/distributed/transaction/</guid><description>&lt;img src="https://www.letout.cn/p/distributed/transaction/cap.webp" alt="Featured image of post åˆ†å¸ƒå¼äº‹åŠ¡" />&lt;h2 id="äº‹åŠ¡">äº‹åŠ¡&lt;/h2>
&lt;h3 id="æ•°æ®åº“äº‹åŠ¡">æ•°æ®åº“äº‹åŠ¡&lt;/h3>
&lt;p>äº‹åŠ¡ï¼ˆå•æ•°æ®åº“çš„æœ¬åœ°äº‹åŠ¡ï¼‰æ˜¯æŒ‡ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ­£ç¡®æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚&lt;/p>
&lt;p>äº‹åŠ¡é€šå¸¸ä¼šæœ‰ ACID å››å¤§ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>A&lt;/code> åŽŸå­æ€§&lt;/li>
&lt;li>&lt;code>C&lt;/code> ä¸€è‡´æ€§&lt;/li>
&lt;li>&lt;code>I&lt;/code> éš”ç¦»æ€§&lt;/li>
&lt;li>&lt;code>D&lt;/code> æŒä¹…æ€§&lt;/li>
&lt;/ul>
&lt;h3 id="åˆ†å¸ƒå¼äº‹åŠ¡">åˆ†å¸ƒå¼äº‹åŠ¡&lt;/h3>
&lt;p>çŽ°åœ¨çš„å¤§åž‹ä¸šåŠ¡ç³»ç»Ÿé€šå¸¸éƒ½ç”±è‹¥å¹²ä¸ªå­ç³»ç»Ÿæž„æˆï¼Œè¿™äº›å­ç³»ç»Ÿå„è‡ªæ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œä¸€ä¸ªä¸šåŠ¡æµç¨‹éœ€è¦ç”±å¤šä¸ªå­ç³»ç»Ÿå…±åŒå®Œæˆï¼Œè¿™äº›æ“ä½œéœ€è¦è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚&lt;/p>
&lt;p>åˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯è¦ä¿éšœä¸åŒæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼šåœ¨å¤§åž‹çš„ç”µå•†ç³»ç»Ÿä¸­ï¼Œä¸‹å•æ—¶ä¼šï¼šæ‰£å‡åº“å­˜ï¼Œå‡ä¼˜æƒ ï¼Œç”Ÿæˆè®¢å•idç­‰å¤šä¸ªæ­¥éª¤ï¼Œé€šå¸¸è®¢å•æœåŠ¡ä¸Žåº“å­˜ã€ä¼˜æƒ ã€è®¢å•idéƒ½æ˜¯ä¸åŒçš„æœåŠ¡ã€‚
è¿™äº›æ“ä½œæ˜¯å¦æˆåŠŸï¼Œä¾èµ–äºŽå¤šä¸ªç³»ç»Ÿçš„ç»“æžœï¼Œå¯èƒ½æ¶‰åŠä¸‰ä¸ªç³»ç»ŸæœåŠ¡ï¼Œä¸‰ä¸ªæ•°æ®åº“ã€‚æ‰€ä»¥éœ€è¦åœ¨æ•°æ®åº“ä¸Žåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œé€šè¿‡â€œä¸­é—´â€æ–¹æ¡ˆï¼Œå®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡çš„æ”¯æŒã€‚&lt;/p>
&lt;h2 id="ä¸€è‡´æ€§">ä¸€è‡´æ€§&lt;/h2>
&lt;h3 id="-å¼ºä¸€è‡´æ€§">ðŸš‘ å¼ºä¸€è‡´æ€§&lt;/h3>
&lt;p>åœ¨ä»»æ„æ—¶åˆ»ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ¯ä¸€æ¬¡è¯»æ“ä½œï¼Œéƒ½èƒ½èŽ·å–åˆ°æ•°æ®æœ€è¿‘çš„ä¸€æ¬¡å†™æ“ä½œã€‚&lt;/p>
&lt;h3 id="-å¼±ä¸€è‡´æ€§">ðŸšš å¼±ä¸€è‡´æ€§&lt;/h3>
&lt;p>æ•°æ®æ›´æ–°åŽï¼Œèƒ½å¤Ÿå®¹å¿åŽç»­çš„è®¿é—®åªèƒ½è®¿é—®éƒ¨åˆ†æ•°æ®æˆ–å…¨éƒ¨è®¿é—®ä¸åˆ°ã€‚&lt;/p>
&lt;h3 id="-æœ€ç»ˆä¸€è‡´æ€§">ðŸš› æœ€ç»ˆä¸€è‡´æ€§&lt;/h3>
&lt;p>ä¸ä¿è¯ä»»æ„æ—¶åˆ»ä»»æ„èŠ‚ç‚¹ä¸Šçš„åŒä¸€ä»½æ•°æ®éƒ½æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯åœ¨ä¸€æ®µæ—¶å€™ä¹‹åŽï¼ŒèŠ‚ç‚¹çš„æ•°æ®æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚&lt;/p>
&lt;h2 id="-cap">âš™ï¸ CAP&lt;/h2>
&lt;p>CAP å®šç†æŒ‡ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€è‡´æ€§ &lt;code>Consistency&lt;/code>ï¼Œå¯ç”¨æ€§ &lt;code>Availability&lt;/code>ï¼Œåˆ†åŒºå®¹é”™æ€§ &lt;code>Partition tolerance&lt;/code>ï¼Œã€Œæœ€å¤šåªèƒ½æ»¡è¶³ä¸¤é¡¹ã€ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>C - Consistency&lt;/code> ä¸€è‡´æ€§&lt;/p>
&lt;p>æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ã€‚ï¼ˆä»»æ„æ—¶é—´åœ¨ä»»æ„èŠ‚ç‚¹è®¿é—®åˆ°çš„éƒ½æ˜¯æœ€æ–°çš„æ•°æ®ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>A - Availability&lt;/code> å¯ç”¨æ€§&lt;/p>
&lt;p>æœåŠ¡åœ¨ä¸€å®šæ—¶é—´å†…ï¼Œéƒ½ä¼šè¿”å›žä¸€ä¸ªæ˜Žç¡®çš„ç»“æžœï¼ŒæœåŠ¡ä¸€ç›´å¯ç”¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>P - Partition Tolerance&lt;/code> åˆ†åŒºå®¹é”™æ€§&lt;/p>
&lt;p>ä¸€ä¸ªæœåŠ¡åˆ†å¸ƒåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­ï¼Œå¦‚æžœéƒ¨åˆ†ç³»ç»Ÿå®•æœºï¼Œå…¶ä»–ç³»ç»Ÿèƒ½å¤Ÿç»§ç»­æä¾›æœåŠ¡ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ðŸ…¿ï¸ åˆ†åŒºå®¹é”™æ€§æ—¶åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¹æœ¬ï¼Œå¦‚æžœåˆ†åŒºå®¹é”™æ€§ä¸èƒ½æ»¡è¶³ï¼Œé‚£ä½¿ç”¨åˆ†å¸ƒå¼å¼ç³»ç»Ÿå°†å¤±åŽ»æ„ä¹‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/distributed/transaction/cap.webp"
width="501"
height="460"
srcset="https://www.letout.cn/p/distributed/transaction/cap_hu553ea908437f51f5f9df5986bc7065cb_18394_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/distributed/transaction/cap_hu553ea908437f51f5f9df5986bc7065cb_18394_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="108"
data-flex-basis="261px"
>&lt;/p>
&lt;h3 id="cp">CP&lt;/h3>
&lt;p>ä¸€è‡´æ€§ &amp;amp; åˆ†åŒºå®¹å¿æ€§&lt;/p>
&lt;p>ä¼˜å…ˆä¿éšœæ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>å¦‚æ¶‰åŠé‡‘é’±äº¤æ˜“çš„çŽ¯èŠ‚ï¼Œä¿éšœæ•°æ®ä¸èƒ½å‡ºé”™ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h3 id="ap">AP&lt;/h3>
&lt;p>å¯ç”¨æ€§ &amp;amp; åˆ†åŒºå®¹å¿æ€§&lt;/p>
&lt;p>ä¼˜å…ˆä¿éšœç³»ç»Ÿçš„å¯ç”¨ã€‚&lt;/p>
&lt;p>äº’è”ç½‘ä¸­å¤§å¤šæ•°åœºæ™¯éƒ½æ˜¯ä¿éšœç³»ç»Ÿå¯ç”¨ï¼Œå¦‚åœ¨æœ‰å¤§é‡è¯·æ±‚æ—¶ï¼Œä¸€äº›æœåŠ¡å¯ä»¥å…ˆä¸æä¾›ï¼Œå¦‚åœ¨åŒåä¸€æ´»åŠ¨æ—¶ï¼Œé™åˆ¶ç”¨æˆ·æŸ¥è¯¢åŽ†å²è´¦å•ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="-base">ðŸ«§ BASE&lt;/h2>
&lt;p>BASE ç†è®ºæ˜¯æŒ‡ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>BA - Basically Available&lt;/code> åŸºæœ¬å¯ç”¨&lt;/p>
&lt;p>åˆ†å¸ƒå¼ç³»ç»Ÿå‡ºçŽ°æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>S - Soft State&lt;/code> è½¯çŠ¶æ€&lt;/p>
&lt;p>å…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè¿™ä¸ªä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“çš„å¯ç”¨æ€§ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>E - Eventual Consistency&lt;/code> æœ€ç»ˆä¸€è‡´æ€§&lt;/p>
&lt;p>ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ç»è¿‡ä¸€å®šæ—¶é—´åŽï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´æ€§çš„çŠ¶æ€ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>BASE ç†è®ºæœ¬è´¨ä¸Šæ˜¯å¯¹ CAP ç†è®ºçš„å»¶ä¼¸ï¼Œæ˜¯å¯¹ AP çš„è¡¥å……ã€‚&lt;/p>
&lt;p>å¯¹äºŽä¸šåŠ¡ç³»ç»Ÿæ¥è¯´ï¼Œé€šå¸¸é€‰æ‹©ç‰ºç‰²ä¸€è‡´æ€§æ¥æ¢å–ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ã€‚ä½†æ˜¯ä¸æ˜¯å®Œå…¨æ”¾å¼ƒæ•°æ®ä¸€è‡´æ€§ï¼Œè€Œæ˜¯ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥æ¢å–å¼±ä¸€è‡´æ€§ï¼Œé‡‡ç”¨åˆé€‚çš„æ–¹å¼æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚&lt;/p>
&lt;h2 id="åˆ†å¸ƒå¼äº‹åŠ¡å¸¸è§åœºæ™¯">åˆ†å¸ƒå¼äº‹åŠ¡å¸¸è§åœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>é“¶è¡Œè½¬è´¦&lt;/li>
&lt;/ul>
&lt;p>åœ¨é“¶è¡Œè½¬è´¦ä¸­ï¼Œæ‰£ä½™é¢å’Œæ·»åŠ ä½™é¢éœ€è¦åŒæ—¶æˆåŠŸã€‚æ‰£å‡è´¦æˆ·ä½™é¢æˆåŠŸï¼Œå¢žåŠ è´¦æˆ·ä½™é¢å¤±è´¥ï¼›æ‰£å‡è´¦æˆ·ä½™é¢å¤±è´¥ï¼Œå¢žåŠ è´¦æˆ·ä½™é¢æˆåŠŸï¼Œéƒ½æ˜¯ä¸å…è®¸å‘ç”Ÿçš„ã€‚&lt;/p>
&lt;ul>
&lt;li>ä¸‹è®¢å•å’Œæ‰£åº“å­˜&lt;/li>
&lt;/ul>
&lt;p>ä¸‹è®¢å•å’Œæ‰£åº“å­˜éœ€è¦ä¿æŒä¸€è‡´ï¼Œå¦‚æžœå…ˆä¸‹è®¢å•ï¼Œæ‰£åº“å­˜å¤±è´¥ï¼Œé‚£ä¹ˆå°†ä¼šå¯¼è‡´è¶…å–ï¼›å¦‚æžœä¸‹è®¢å•æ²¡æœ‰æˆåŠŸï¼Œæ‰£åº“å­˜æˆåŠŸï¼Œé‚£ä¹ˆä¼šå¯¼è‡´å°‘å–ã€‚&lt;/p>
&lt;ul>
&lt;li>åŒæ­¥è¶…æ—¶&lt;/li>
&lt;/ul>
&lt;p>æœåŠ¡åŒ–çš„ç³»ç»Ÿé—´è°ƒç”¨å¸¸å¸¸å› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´ç³»ç»Ÿé—´è°ƒç”¨è¶…æ—¶ï¼Œç³»ç»ŸAåŒæ­¥è°ƒç”¨ç³»ç»ŸBè¶…æ—¶ï¼Œç³»ç»ŸAå¯ä»¥æ˜Žç¡®å¾—åˆ°è¶…æ—¶åé¦ˆï¼Œä½†æ˜¯æ— æ³•ç¡®å®šç³»ç»ŸBæ˜¯å¦å·²ç»å®Œæˆäº†é¢„å®šçš„åŠŸèƒ½æˆ–è€…æ²¡æœ‰å®Œæˆé¢„å®šçš„åŠŸèƒ½ã€‚äºŽæ˜¯ï¼Œç³»ç»ŸAå°±è¿·èŒ«äº†ï¼Œä¸çŸ¥é“åº”è¯¥ç»§ç»­åšä»€ä¹ˆï¼Œå¦‚ä½•åé¦ˆç»™ä½¿ç”¨æ–¹ã€‚&lt;/p>
&lt;h2 id="ä¸€è‡´æ€§åè®®">ä¸€è‡´æ€§åè®®&lt;/h2>
&lt;p>äº‹åŠ¡ç®¡ç†å™¨ &lt;code>TM - Transaction Manager&lt;/code>ï¼šè´Ÿè´£åè°ƒå’Œç®¡ç†äº‹åŠ¡ï¼ŒæŽ§åˆ¶ç€å…¨å±€äº‹åŠ¡å¹¶ç®¡ç†äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶åè°ƒå„ä¸ª RMã€‚&lt;/p>
&lt;p>èµ„æºç®¡ç†å™¨ &lt;code>RM - Resource Manager&lt;/code>ï¼šäº‹åŠ¡çš„å‚ä¸Žè€…ï¼Œå¯ä»¥æŒ‡ä¸€ä¸ªæ•°æ®åº“å®žä¾‹ï¼Œé€šè¿‡èµ„æºç®¡ç†å™¨å¯¹æ•°æ®åº“è¿›è¡ŒæŽ§åˆ¶ï¼Œå³ä¸€ä¸ªåˆ†æ”¯äº‹åŠ¡ã€‚&lt;/p>
&lt;p>DTP æ¨¡åž‹å®šä¹‰ TM å’Œ RM ä¹‹é—´çš„é€šè®¯æŽ¥å£è§„èŒƒå«åš XAï¼ˆå³æ•°æ®åº“æä¾›çš„ 2PC æŽ¥å£åè®®ï¼‰ï¼ŒåŸºäºŽæ•°æ®åº“çš„ XA åè®®æ¥å®žçŽ°çš„ 2PC ç§°ä¸º XA æ–¹æ¡ˆã€‚&lt;/p>
&lt;h3 id="-2pc">ðŸ¤² 2PC&lt;/h3>
&lt;p>ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰æŠŠåˆ†å¸ƒå¼äº‹åŠ¡åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼šå‡†å¤‡é˜¶æ®µ &lt;code>Prepare&lt;/code>ï¼Œæäº¤é˜¶æ®µ &lt;code>Commit&lt;/code> / å›žæ»šé˜¶æ®µ &lt;code>Rollback&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¬¬ä¸€é˜¶æ®µ &lt;code>prepare&lt;/code>&lt;/p>
&lt;p>æ‰§è¡Œå®žé™…çš„ä¸šåŠ¡æ“ä½œï¼Œä½†ä¸æäº¤äº‹åŠ¡ï¼Œé”å®šèµ„æºã€‚&lt;/p>
&lt;p>äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼ŒTransaction Managerï¼‰å‘æ‰€æœ‰æœ¬åœ°èµ„æºç®¡ç†å™¨ï¼ˆRMï¼ŒResource Managerï¼‰å‘èµ·è¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦æ˜¯å°±ç»ª ready çŠ¶æ€ï¼Œæ‰€æœ‰çš„å‚ä¸Žè€…éƒ½å°†æœ¬åœ°äº‹åŠ¡èƒ½å¦æˆåŠŸçš„ä¿¡æ¯åé¦ˆç»™åè°ƒè€…ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¬¬äºŒé˜¶æ®µ &lt;code>commit / rollback&lt;/code>&lt;/p>
&lt;p>äº‹åŠ¡ç®¡ç†å™¨æ ¹æ®æ‰€æœ‰æœ¬åœ°èµ„æºç®¡ç†å™¨çš„åé¦ˆï¼Œé€šçŸ¥æ‰€æœ‰æœ¬åœ°èµ„æºç®¡ç†å™¨ï¼Œæ­¥è°ƒä¸€è‡´åœ°åœ¨æ‰€æœ‰åˆ†æ”¯ä¸Šæäº¤æˆ–å›žæ»šã€‚&lt;/p>
&lt;p>åªè¦æœ‰ä¸€ä¸ª RM å¤±è´¥ï¼Œå°±ä¼šè¿›è¡Œå›žæ»šæ“ä½œï¼›å¦åˆ™é€šçŸ¥æ‰€æœ‰ RM æäº¤äº‹åŠ¡ã€‚æäº¤äº‹åŠ¡åŽé‡Šæ”¾é”èµ„æºã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/distributed/transaction/2pc.jpg"
width="786"
height="507"
srcset="https://www.letout.cn/p/distributed/transaction/2pc_hua10c08a1522e8116d339a23bf38d0da8_34919_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/distributed/transaction/2pc_hua10c08a1522e8116d339a23bf38d0da8_34919_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="155"
data-flex-basis="372px"
>&lt;/p>
&lt;h4 id="-seata-å®žçŽ°-2pc">âš’ï¸ Seata å®žçŽ° 2PC&lt;/h4>
&lt;p>&lt;a class="link" href="https://github.com/seata/seata" target="_blank" rel="noopener"
>Seata&lt;/a> æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºŽåœ¨å¾®æœåŠ¡æž¶æž„ä¸‹æä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚&lt;/p>
&lt;p>ðŸ“‡ Seata æŠŠä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ç†è§£æˆä¸€ä¸ªã€Œå…¨å±€äº‹åŠ¡ã€å’Œè‹¥å¹²ã€Œåˆ†æ”¯äº‹åŠ¡ã€ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å…¨å±€äº‹åŠ¡ï¼šåè°ƒå„ä¸ªåˆ†æ”¯äº‹åŠ¡è¾¾æˆä¸€è‡´&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ†æ”¯äº‹åŠ¡ï¼šå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå…³ç³»æ•°æ®åº“çš„æœ¬åœ°äº‹åŠ¡&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ðŸ—ƒï¸ Seata å®šä¹‰äº†ä¸‰ä¸ªç»„ä»¶å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>TCï¼ˆTransaction Corinatorï¼‰äº‹åŠ¡åè°ƒå™¨&lt;/p>
&lt;p>ç‹¬ç«‹çš„ä¸­é—´ä»¶ã€‚&lt;/p>
&lt;p>ç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼šæŽ¥æ”¶ TM æŒ‡ä»¤å‘èµ·å…¨å±€äº‹åŠ¡çš„æäº¤ä¸Žå›žæ»šï¼›è´Ÿè´£ä¸Ž RM é€šä¿¡åè°ƒå„ä¸ªåˆ†æ”¯äº‹åŠ¡çš„é€šçŸ¥ä¸Žå›žæ»šã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>TMï¼ˆTransaction Managerï¼‰äº‹åŠ¡ç®¡ç†å™¨&lt;/p>
&lt;p>jaråŒ…ã€‚&lt;/p>
&lt;p>åµŒå…¥åº”ç”¨ç¨‹åºä¸­å·¥ä½œï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œæœ€ç»ˆå‘ TC å‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›žæ»šã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RMï¼ˆResource Managerï¼‰èµ„æºç®¡ç†å™¨&lt;/p>
&lt;p>æŽ§åˆ¶åˆ†æ”¯äº‹åŠ¡ã€‚&lt;/p>
&lt;p>æŽ¥æ”¶ TC çš„æŒ‡ä»¤ï¼Œé©±åŠ¨æœ¬åœ°äº‹åŠ¡çš„æäº¤æˆ–å›žæ»šã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ðŸ“º åœ¨æž¶æž„æ–¹é¢ï¼Œ2PC æ–¹æ¡ˆçš„ RM å®žé™…ä¸Šæ˜¯åœ¨æ•°æ®åº“å±‚é¢ï¼ŒRM æœ¬è´¨ä¸Šæ˜¯æ•°æ®åº“è‡ªèº«é€šè¿‡ XA åè®®å®žçŽ°ï¼›seata ä¸­ RM ä»¥ jar åŒ…çš„å½¢å¼ä½œä¸ºä¸­é—´ä»¶å±‚éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºä¸€ä¾§ã€‚&lt;/p>
&lt;p>ðŸ—³ï¸ åœ¨ä¸¤é˜¶æ®µæäº¤æ–¹é¢ï¼Œ2PC åœ¨ç¬¬äºŒé˜¶æ®µå†³è®® commit / rollbackï¼Œäº‹åŠ¡æ€§èµ„æºé”è¦ä¿æŒåœ¨ç¬¬äºŒé˜¶æ®µå®ŒæˆåŽé‡Šæ”¾ï¼›seata åœ¨ç¬¬ä¸€é˜¶æ®µå°±å°†äº‹åŠ¡æäº¤ï¼ŒçœåŽ»ç¬¬äºŒé˜¶æ®µæŒæœ‰é”çš„æ—¶é—´ï¼Œæé«˜æ•´ä½“æ•ˆçŽ‡ã€‚&lt;/p>
&lt;h5 id="é…ç½®-seata-æœåŠ¡">é…ç½® Seata æœåŠ¡&lt;/h5>
&lt;ul>
&lt;li>å¯åŠ¨ seata ä¸­é—´ä»¶æœåŠ¡&lt;/li>
&lt;li>é…ç½®æœåŠ¡æ³¨å†Œä¸­å¿ƒ&lt;/li>
&lt;li>åœ¨åº”ç”¨é…ç½® regsitry.confã€file.confï¼ˆåœ¨ seata ä¸­æ‹·è´ï¼‰&lt;/li>
&lt;li>ä½¿ç”¨ seata æœåŠ¡ï¼Œéœ€è¦åœ¨åŒæ–¹æ•°æ®åº“ä¸­åˆ›å»º &lt;code>undo log&lt;/code> è¡¨
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">undo_log&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">bigint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AUTO_INCREMENT&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">branch_id&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">bigint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">xid&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">rollback_info&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">longblob&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">log_status&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">log_created&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">log_modified&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">ext&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DEFAULT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">UNIQUE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">ux_undo_log&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">xid&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">branch_id&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ENGINE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">InnoDB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AUTO_INCREMENT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DEFAULT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CHARSET&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">utf8&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h5 id="åˆ›å»ºä»£ç†æ•°æ®æº">åˆ›å»ºä»£ç†æ•°æ®æº&lt;/h5>
&lt;p>æ¯ä¸ª RM é€šè¿‡ DataSourceProxy ä½¿ç”¨ä»£ç†è¿žæŽ¥ã€‚ä¸Ž TC è¿›è¡Œé€šä¿¡äº¤äº’ã€è®°å½• undo_log ç­‰ã€‚&lt;/p>
&lt;p>ç¬¬ä¸€é˜¶æ®µä¸šåŠ¡æ“ä½œç”Ÿæˆå¯¹äºŽçš„ undo_logï¼Œå°† undo_log å’Œä¸šåŠ¡æ•°æ®æ”¾åœ¨ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡æäº¤ï¼ˆundo_log è®°å½•äº†ä¿®æ”¹å‰çš„å€¼ï¼ŒåŒæ—¶æäº¤åŽé‡Šæ”¾é”èµ„æºï¼‰ã€‚&lt;/p>
&lt;p>TM å¼€å¯å…¨å±€äº‹åŠ¡ï¼Œä¼šå°†å…¨å±€äº‹åŠ¡ID &lt;code>XID&lt;/code> æ”¾åœ¨äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶é€šè¿‡è¿œç¨‹è°ƒç”¨ä¼ å…¥ä¸‹æ¸¸çš„å„ä¸ªåˆ†æ”¯äº‹åŠ¡ã€‚&lt;/p>
&lt;p>ç¬¬äºŒé˜¶æ®µï¼ˆ1ï¼‰äº‹åŠ¡æäº¤ï¼ŒTC é€šçŸ¥å„ä¸ªåˆ†æ”¯å®Œæˆäº‹åŠ¡ï¼Œåªéœ€è¦åˆ é™¤å¯¹åº”çš„undo_logï¼ˆç¬¬ä¸€é˜¶æ®µå·²ç»åˆ†æ”¯æäº¤ï¼‰ï¼›ï¼ˆ2ï¼‰äº‹åŠ¡å›žæ»šï¼Œé€šè¿‡ XID å’Œ Branch ID æ‰¾åˆ°å¯¹åº”çš„ undo_log ç”Ÿæˆåå‘ SQL æ‰§è¡Œå³å¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">DatabaseConfiguration&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@ConfigurationProperties&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">prefix&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;spring.datasource.ds0&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">DruidDataSource&lt;/span> &lt;span class="nf">ds0&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DruidDataSource&lt;/span> &lt;span class="n">druidDataSource&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">DruidDataSource&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">druidDataSource&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Primary&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">DataSource&lt;/span> &lt;span class="nf">dataSource&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">DruidDataSource&lt;/span> &lt;span class="n">ds0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DataSourceProxy&lt;/span> &lt;span class="n">pds0&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">DataSourceProxy&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ds0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">pds0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="åŒæ–¹ä¸šåŠ¡å®žçŽ°">åŒæ–¹ä¸šåŠ¡å®žçŽ°&lt;/h5>
&lt;p>&lt;code>@GlobalTransactional&lt;/code> å¼€å¯å…¨å±€äº‹åŠ¡ã€‚&lt;code>GlobalTransactinalInterceptor&lt;/code> ä¼šæ‹¦æˆª &lt;code>@GlobalTransactional&lt;/code> æ³¨è§£çš„æ–¹æ³•ï¼Œç”Ÿæˆå…¨å±€äº‹åŠ¡ID&lt;code>XID&lt;/code>ã€‚&lt;/p>
&lt;p>XID ä¼šåœ¨æ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ä¸­ä¼ é€’ï¼Œåœ¨è¿œç¨‹è°ƒç”¨æ—¶ spring-cloud-alibaba-seata ä¼šæ‹¦æˆª Feign è°ƒç”¨å°† XID ä¼ é€’åˆ°ä¸‹æ¸¸æœåŠ¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è½¬è´¦æ–¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nd">@Service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Sl4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">AccountServiceImpl&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">AccountInfoService&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">AccountInfoDao&lt;/span> &lt;span class="n">accountInfoDao&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">BankClient&lt;/span> &lt;span class="n">bankClinet&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * è½¬è´¦ä¸šåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GlobalTranactional&lt;/span> &lt;span class="c1">// å¼€å¯å…¨å±€äº‹åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">updateAccountBalance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">accountNo&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BigDecimal&lt;/span> &lt;span class="n">amount&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æœ¬è´¦æˆ·æ‰£æ¬¾
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">accountInfoDao&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">updateAccountBalance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">accountNo&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">amount&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç›®æ ‡è´¦æˆ·å¢žåŠ ä½™é¢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">remoteRes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">bankClinet&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">transfer&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">amount&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;fallback&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">remoteRes&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// è¿œç¨‹å¤±è´¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RuntimeException&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;...&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸å›žæ»šäº‹åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ”¶æ¬¾æ–¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å¦ä¸€ä¸ªæœåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">BackController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">AccountInfoService&lt;/span> &lt;span class="n">accountInfoService&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æŽ¥æ”¶è½¬è´¦
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/transfer&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">transfer&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">BigDecimal&lt;/span> &lt;span class="n">amount&lt;/span>&lt;span class="o">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">accountInfoService&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">updateAccountBalance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">amount&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;get:&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">amount&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">AccountInfoServiceImpl&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">AccountInfoService&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">AccountInfoDao&lt;/span> &lt;span class="n">accountInfoDao&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä½œä¸ºäº‹åŠ¡åˆ†æ”¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ä¸éœ€è¦å¼€å¯å…¨å±€äº‹åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Transactional&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">updateAccountBalance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">accountNo&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BigDecimal&lt;/span> &lt;span class="n">amount&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// RootContext.getXID()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;XIDï¼š{}&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">RootContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getXID&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¢žåŠ é‡‘é¢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">accountInfoDao&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">updateAccountBalance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">accountNo&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">amount&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-tcc">ðŸ›ï¸ TCC&lt;/h3>
&lt;p>TCC &lt;code>Try - Confirm - Cancel&lt;/code>&lt;/p>
&lt;p>TCC ç”±æ”¯ä»˜å®å›¢é˜Ÿæå‡ºï¼Œè¢«å¹¿æ³›åº”ç”¨äºŽé‡‘èžç³»ç»Ÿä¸­ã€‚æˆ‘ä»¬ç”¨é“¶è¡Œè´¦æˆ·ä½™é¢è´­ä¹°åŸºé‡‘æ—¶ï¼Œä¼šæ³¨æ„åˆ°é“¶è¡Œè´¦æˆ·ä¸­ç”¨äºŽè´­ä¹°åŸºé‡‘çš„é‚£éƒ¨åˆ†ä½™é¢é¦–å…ˆä¼šè¢«å†»ç»“ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥çŒœæƒ³ï¼Œè¿™ä¸ªè¿‡ç¨‹å¤§æ¦‚å°±æ˜¯ TCC çš„ç¬¬ä¸€é˜¶æ®µã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>T - Try&lt;/code> é˜¶æ®µ&lt;/p>
&lt;p>å°è¯•æ‰§è¡Œã€‚å®Œæˆæ‰€æœ‰çš„ä¸šåŠ¡æ£€æŸ¥ï¼Œã€Œé¢„ç•™å¿…é¡»çš„ä¸šåŠ¡èµ„æºã€ã€‚&lt;/p>
&lt;p>æ˜¯å¯¹ä¸šåŠ¡ç³»ç»Ÿè¿›è¡Œæ£€æŸ¥å’Œèµ„æºé¢„è§ˆï¼Œå¦‚è®¢å•å’Œå­˜å‚¨æ“ä½œï¼Œéœ€è¦æ£€æŸ¥åº“å­˜å‰©ä½™æ•°é‡æ˜¯å¦å¯ç”¨ï¼Œå¹¶è¿›è¡Œèµ„æºé¢„ç•™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>C - Confirm&lt;/code> é˜¶æ®µ&lt;/p>
&lt;p>ç¡®è®¤æ‰§è¡ŒçœŸæ­£çš„ä¸šåŠ¡ã€‚è¯¥é˜¶æ®µä¸ä¼šåšä»»ä½•ä¸šåŠ¡æ£€æŸ¥ï¼Œåªä½¿ç”¨ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºã€‚&lt;/p>
&lt;p>åœ¨ TCC ä¸­ï¼Œé€šå¸¸è®¤ä¸º Try é˜¶æ®µæˆåŠŸåŽï¼ŒConfirm ä¸€å®šä¼šæˆåŠŸï¼Œå¦‚æžœ Confirm é˜¶æ®µå‡ºé”™ï¼Œéœ€è¦è¿›è¡Œé‡è¯•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>C - Cancel&lt;/code> é˜¶æ®µ&lt;/p>
&lt;p>å–æ¶ˆæ‰§è¡Œã€‚é‡Šæ”¾ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºã€‚&lt;/p>
&lt;p>åœ¨ TCC ä¸­ï¼Œè®¤ä¸º Cancel ä¸€å®šä¼šæˆåŠŸï¼Œå¦‚æžœå¤±è´¥ï¼Œéœ€è¦é‡è¯•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åŸºäºŽ TCC å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œéœ€è¦å°†ä¸šåŠ¡ä¸Šçš„æ¯ä¸€ä¸ªå®žçŽ°é€»è¾‘æ‹†åˆ†ä¸º Tryã€Confirmã€Cancel ä¸‰ä¸ªéƒ¨åˆ†ï¼Œç›¸å¯¹æ¥è¯´ä»£ç å®žçŽ°å¤æ‚åº¦è¾ƒé«˜ï¼Œå¯¹ä¸šåŠ¡çš„ä¾µå…¥è¾ƒå¤§å’Œä¸šåŠ¡ç´§è€¦åˆã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/distributed/transaction/tcc.jpg"
width="854"
height="712"
srcset="https://www.letout.cn/p/distributed/transaction/tcc_hu444177640f25c93987cac696f3941268_54943_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/distributed/transaction/tcc_hu444177640f25c93987cac696f3941268_54943_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="119"
data-flex-basis="287px"
>&lt;/p>
&lt;h2 id="åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ">åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ&lt;/h2>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h3 id="å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§">å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§&lt;/h3>
&lt;p>å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé€šè¿‡å¼‚æ­¥æ¶ˆæ¯ä¼ é€’å®žçŽ°æ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œæ“ä½œï¼Œã€Œå‘èµ·æ–¹ã€æ‰§è¡Œå®Œæœ¬åœ°äº‹åŠ¡åŽï¼Œå°†æ“ä½œçš„ç»“æžœä½œä¸ºã€Œæ¶ˆæ¯ã€å‘é€å‡ºåŽ»ï¼›
è¿™äº›æ¶ˆæ¯å¯èƒ½ä¼šæœ‰å»¶è¿Ÿã€é‡å¤ã€ä¸¢å¤±ç­‰ï¼›
ä½†æœ€ç»ˆã€Œäº‹åŠ¡å‚ä¸Žæ–¹ã€ä¸€å®šèƒ½æŽ¥å—åˆ°æ¶ˆæ¯ï¼Œå¹¶æˆåŠŸå¤„ç†äº‹åŠ¡ï¼Œä½¿å¾—æ•°æ®çŠ¶æ€ã€Œæœ€ç»ˆã€è¾¾åˆ°ä¸€è‡´ã€‚&lt;/p>
&lt;h4 id="-æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆ">ðŸ¬ æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆ&lt;/h4>
&lt;p>åˆ©ç”¨äº†ã€Œå„ç³»ç»Ÿçš„æœ¬åœ°äº‹åŠ¡ã€æ¥å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åœ¨ä¸šåŠ¡ç›¸å…³çš„åŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œåˆ›å»ºä¸€å¼ ã€Œæœ¬åœ°æ¶ˆæ¯è¡¨ã€ï¼Œâš™ï¸ æ‰§è¡Œä¸šåŠ¡ç›¸å…³æ“ä½œ &amp;amp; ðŸ“‹ è®°å½•æ¶ˆæ¯åˆ°æ¶ˆæ¯è¡¨æ”¾åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŽå°ä»»åŠ¡å®šæ—¶æ‰«ææœ¬åœ°æ¶ˆæ¯è¡¨ï¼Œå°†æœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œå‘é€ç»™ç›®æ ‡èŠ‚ç‚¹/æ¶ˆæ¯é˜Ÿåˆ—ã€‚ï¼ˆå¤±è´¥é‡è¯•ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç›®æ ‡èŠ‚ç‚¹æŽ¥æ”¶åˆ°æ¶ˆæ¯åŽï¼Œå¯ä»¥å°†æ¶ˆæ¯å†™å…¥ã€Œæœ¬åœ°æ¶ˆæ¯è¡¨ã€ï¼ˆå¯ç”¨æ¥åˆ¤é‡ã€æ˜¯å¦æˆåŠŸå¤„ç†æ¶ˆæ¯ï¼‰ï¼Œ
âš™ï¸ æ‰§è¡Œç›¸å…³ä¸šåŠ¡æ“ä½œ &amp;amp; ðŸ“‹ è®°å½•è¡¨ä¿¡æ¯ &amp;amp; ðŸ‘Œ è¿”å›ž ACK æ“ä½œæ”¾åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æžœç›®æ ‡èŠ‚ç‚¹ä¸­çš„æœ¬åœ°äº‹åŠ¡å¤±è´¥ï¼Œä¼šä¸€ç›´ä¸æ–­é‡è¯•ã€‚å¦‚æžœæ—¶ä¸šåŠ¡å¤±è´¥ï¼Œä¼šå‘æºç³»ç»Ÿå‘èµ·å›žæ»šã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/distributed/transaction/native-message.jpg"
width="1200"
height="554"
srcset="https://www.letout.cn/p/distributed/transaction/native-message_hu24a85cf152ae3fa35fb59282832f4ac6_87554_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/distributed/transaction/native-message_hu24a85cf152ae3fa35fb59282832f4ac6_87554_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="216"
data-flex-basis="519px"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h3 id="æœ€å¤§åŠªåŠ›é€šçŸ¥">æœ€å¤§åŠªåŠ›é€šçŸ¥&lt;/h3>
&lt;p>å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§å…³æ³¨çš„æ˜¯ä¸šåŠ¡è¿‡ç¨‹ä¸­çš„äº‹åŠ¡ä¸€è‡´ï¼Œä»¥å¼‚æ­¥çš„æ–¹æ³•å®Œæˆä¸šåŠ¡ã€‚ï¼ˆæ¶ˆæ¯å¯é æ€§ç”±å‘èµ·æ–¹ä¿éšœï¼‰&lt;/p>
&lt;p>æœ€å¤§åŠªåŠ›é€šçŸ¥å…³æ³¨çš„æ˜¯ä¸šåŠ¡å®ŒæˆåŽçš„é€šçŸ¥äº‹åŠ¡ï¼Œå°†æ‰§è¡Œçš„ç»“æžœå¯é çš„é€šçŸ¥å‡ºåŽ»ã€‚&lt;/p>
&lt;p>å‘èµ·é€šçŸ¥æ–¹é€šè¿‡ä¸€å®šçš„æœºåˆ¶ï¼Œå°½æœ€å¤§çš„åŠªåŠ›å°†æ¶ˆæ¯å¤„ç†çš„ç»“æžœé€šçŸ¥åˆ°æŽ¥æ”¶æ–¹ï¼Œå¦‚æžœé€šçŸ¥å¤±è´¥ï¼Œå‘é€æ–¹ä¼šä¸æ–­åœ°è¿›è¡Œè¶…æ—¶é‡è¯•ï¼Œå¦‚æžœä¸€ç›´ä¸èƒ½é€šçŸ¥åˆ°ï¼ŒæŽ¥æ”¶æ–¹ä¼šä¸»åŠ¨æŸ¥è¯¢å‘é€æ–¹çš„æŽ¥å£ï¼ˆæ¶ˆæ¯çš„å¯é æ€§ç”±äº‹åŠ¡çš„è¢«åŠ¨æ–¹ä¿éšœï¼‰ã€‚&lt;/p>
&lt;p>æœ€å¸¸è§çš„åœºæ™¯å°±æ˜¯æ”¯ä»˜å›žè°ƒï¼Œæ”¯ä»˜æœåŠ¡åˆ°ç¬¬ä¸‰æ–¹æ”¯ä»˜æˆåŠŸåŽï¼Œç¬¬ä¸‰æ–¹æ”¯ä»˜ä¼šæœ‰å›žè°ƒé€šçŸ¥ï¼Œå¦‚æžœå›žè°ƒå¤±è´¥ï¼Œä¼šé€šè¿‡ä¸€å®šçš„é¢‘çŽ‡é‡è¯•ï¼Œå¹¶ä¸”ç¬¬ä¸‰æ–¹æ”¯ä»˜ä¼šæä¾›ä¸»åŠ¨æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€çš„æŽ¥å£ã€‚æ—¢æœ‰å›žè°ƒé€šçŸ¥ï¼Œä¹Ÿæœ‰äº¤æ˜“æŸ¥è¯¢æŽ¥å£ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.jianshu.com/p/1156151e20c8" target="_blank" rel="noopener"
>https://www.jianshu.com/p/1156151e20c8&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://xiaomi-info.github.io/2020/01/02/distributed-transaction/" target="_blank" rel="noopener"
>https://xiaomi-info.github.io/2020/01/02/distributed-transaction/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.csdn.net/u010425776/article/details/79516298" target="_blank" rel="noopener"
>https://blog.csdn.net/u010425776/article/details/79516298&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s/XknegP66mnYboiBx556Kzw" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s/XknegP66mnYboiBx556Kzw&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s/ujRRtdLOeKEHsHrtDRNXGA" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s/ujRRtdLOeKEHsHrtDRNXGA&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>MySQL å¤åˆ¶</title><link>https://www.letout.cn/p/mysql/master-slave-replication/</link><pubDate>Thu, 02 Mar 2023 12:02:02 +0800</pubDate><guid>https://www.letout.cn/p/mysql/master-slave-replication/</guid><description>&lt;img src="https://www.letout.cn/p/mysql/master-slave-replication/copy.png" alt="Featured image of post MySQL å¤åˆ¶" />&lt;h2 id="-ä¸»ä»Žå¤åˆ¶">ðŸ“‘ ä¸»ä»Žå¤åˆ¶&lt;/h2>
&lt;p>ä¸»ä»Žå¤åˆ¶æŒ‡ä¸»æœåŠ¡å™¨ï¼ˆmaster serverï¼‰ä¸Šï¼Œä»»ä½•ä¿®æ”¹å’Œæ•°æ®ç»“æž„å˜æ›´çš„äº‹ä»¶ï¼Œéƒ½ä¼šè¢«å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ &lt;code>bin log&lt;/code> ä¸­ï¼Œä»ŽæœåŠ¡å™¨ï¼ˆslave serverï¼‰è¯»å–ä¸»æœåŠ¡å™¨ä¸Šçš„æ—¥å¿—æ–‡ä»¶ä¸­çš„äº‹ä»¶å˜æ›´ï¼Œå¹¶åœ¨æœ¬åœ°é‡æ”¾æ‰§è¡Œã€‚&lt;/p>
&lt;p>é€šè¿‡ä¸»ä»Žå¤åˆ¶ï¼Œèƒ½å¤Ÿæé«˜æ•°æ®åº“çš„&lt;strong>è¯»&lt;/strong>æ€§èƒ½ã€‚ä¸»åº“å¤åˆ¶å†™ï¼Œä»Žåº“å¤åˆ¶è¯»ã€‚&lt;/p>
&lt;p>å¹¶ä¸é€‚åˆæ¥æ‰©å±•å†™æ“ä½œã€‚ä¾‹å¦‚åœ¨ä¸€ä¸»å¤šä»Žçš„æž¶æž„ä¸­ï¼Œå†™æ“ä½œè¦è¢«æ‰§è¡Œå¤šæ¬¡ï¼Œæ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ä¼šå–å†³äºŽå†™å…¥æœ€æ…¢çš„é‚£ä¸ªã€‚&lt;/p>
&lt;p>ðŸ’¡ å¸¸è§ç”¨é€”ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°æ®å¤‡ä»½&lt;/li>
&lt;li>æ•°æ®åˆ†å‘&lt;/li>
&lt;li>æé«˜è¯»æ€§èƒ½&lt;/li>
&lt;li>é«˜å¯ç”¨å’Œæ•…éšœåˆ‡æ¢&lt;/li>
&lt;/ul>
&lt;h2 id="-å¤åˆ¶åŽŸç†">ðŸ“– å¤åˆ¶åŽŸç†&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>ðŸ‘£ ä¸»åº“ä¸­çš„æ•°æ®å˜æ›´ä¼šè®°å½•åˆ° binlog ä¸­ï¼Œä¸»åº“ä¼šåˆ›å»ºä¸€ä¸ª binlog dump threadï¼Œå°† binlog ä¼ è¾“åˆ°ä»Žåº“&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ‘£ ä»Žåº“åˆ›å»º IO çº¿ç¨‹ï¼Œå°†ä¸»åº“ä¼ æ¥çš„ binlog å†™å…¥åˆ°è‡ªå·±çš„ relay log ä¸­ç»§æ—¥å¿—&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ‘£ ä»Žåº“åˆ›å»º SQL çº¿ç¨‹ï¼Œä»Ž relay log ä¸­è¯»å–æ•°æ®ï¼Œé‡æ”¾åˆ°æ•°æ®åº“ä¸­&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œçš„ IO çº¿ç¨‹ å’Œ SQL çº¿ç¨‹çš„å·¥ä½œæ˜¯è§£è€¦çš„ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/master-slave-replication/copy.png"
width="1080"
height="603"
srcset="https://www.letout.cn/p/mysql/master-slave-replication/copy_hu2815b7bcceb4bc2e593bd903d3b2a777_501311_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/master-slave-replication/copy_hu2815b7bcceb4bc2e593bd903d3b2a777_501311_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="179"
data-flex-basis="429px"
>&lt;/p>
&lt;h2 id="-å¤åˆ¶æ ¼å¼">ðŸŽ« å¤åˆ¶æ ¼å¼&lt;/h2>
&lt;p>MySQL æœ‰ä¸‰ç§æ–¹å¼è®°å½• binlogï¼ŒåŒæ ·åœ¨å¤åˆ¶æ—¶ï¼Œä¹Ÿå¯¹åº”æœ‰ä¸‰ç§å¤åˆ¶æ ¼å¼ã€‚&lt;/p>
&lt;p>ðŸ’¡ å¦‚æžœéœ€è¦å®‰å…¨çš„æ•°æ®å¤åˆ¶æ–¹æ³•ï¼ŒæŽ¨èä½¿ç”¨&lt;strong>åŸºäºŽè¡Œ&lt;/strong>çš„æ ¼å¼å¤åˆ¶ï¼Œé™¤éžæŸäº›åœºæ™¯ä¸‹æ˜Žç¡®éœ€è¦ä¸´æ—¶ä½¿ç”¨åŸºäºŽè¯­å¥çš„æ ¼å¼ã€‚&lt;/p>
&lt;h3 id="-åŸºäºŽè¯­å¥-statement">ðŸ“ƒ åŸºäºŽè¯­å¥ statement&lt;/h3>
&lt;p>é€šè¿‡é‡æ–°æ‰§è¡Œä¸»æœåŠ¡å™¨ä¸­æ‰§è¡Œè¿‡çš„ SQL è¯­å¥æ¥å®Œæˆå¤åˆ¶çš„ã€‚&lt;/p>
&lt;p>ä¼˜ç‚¹ðŸ™‹â€ æ˜¯ç®€å•ç´§å‡‘ï¼Œä¾‹å¦‚æ‰¹é‡æ›´æ–°äº† 1000 æ¡æ•°æ®ï¼Œä¹Ÿåªéœ€è¦ä¸€æ¡è¯­å¥ï¼ŒèŠ‚çº¦ IOã€‚&lt;/p>
&lt;p>ç¼ºç‚¹ðŸ™…â€â™‚ï¸ æ˜¯åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œå¯èƒ½å¯¼è‡´ä¸»ä»Žæ•°æ®ä¸ä¸€è‡´ï¼ˆä¾‹å¦‚ä½¿ç”¨äº† now() è¿™æ ·çš„å‡½æ•°ï¼‰ã€‚&lt;/p>
&lt;h3 id="-åŸºäºŽè¡Œ-row">ðŸ““ åŸºäºŽè¡Œ row&lt;/h3>
&lt;p>åŸºäºŽè¡Œçš„æ—¥å¿—ä¸­ï¼Œè®°å½•äº†è¯¥è¡Œæ•°æ®å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼ŒåŒ…å«è¯¥è¡Œä¿®æ”¹å‰å’Œä¿®æ”¹åŽçš„æƒ…å†µã€‚åœ¨æ‰§è¡Œæ—¶ï¼Œè¿›è¡Œè§£æžï¼Œæ‰¾åˆ°éœ€è¦å˜æ›´çš„è®°å½•è¿›è¡Œæ“ä½œã€‚&lt;/p>
&lt;p>ä¼˜ç‚¹ðŸ™‹ æ˜¯æ•°æ®å…·æœ‰å¼ºç¡®å®šæ€§ã€‚&lt;/p>
&lt;p>ç¼ºç‚¹ðŸ™…â€â™‚ï¸ æ˜¯å¯èƒ½ä¼šå¯¼è‡´æ—¥å¿—ä¸­è®°å½•å¤§é‡æ•°æ®ã€‚æ¯”å¦‚åœ¨æ‰¹é‡æ›´æ–°æ—¶ï¼Œå‡ºçŽ°å¤§é‡çš„è¡Œçš„ä¿®æ”¹ï¼Œä½†æ˜¯è¯­å¥å¯èƒ½åªæœ‰ä¸€æ¡ã€‚&lt;/p>
&lt;h3 id="-æ··åˆæ¨¡å¼-mix">ðŸ–‡ï¸ æ··åˆæ¨¡å¼ mix&lt;/h3>
&lt;p>â€œè¯•å›¾â€ æ··åˆæ¨¡å¼ç»“åˆä»¥ä¸Šä¸¤ç§æ ¼å¼çš„ä¼˜ç‚¹ã€‚ï¼ˆå¯èƒ½ä¼šæœ‰ðŸ˜µ&lt;strong>ä¸ç¨³å®š&lt;/strong>çš„æƒ…å†µï¼‰&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨åŸºäºŽè¯­å¥çš„æ ¼å¼ï¼Œåœ¨æœ‰éœ€è¦æ—¶åˆ‡æ¢åˆ°åŸºäºŽè¡Œçš„æ ¼å¼ã€‚&lt;strong>åœ¨å†™å…¥äº‹ä»¶æ—¶ï¼Œä¼šæœ‰å¾ˆå¤šçš„åˆ¤æ–­æ¡ä»¶&lt;/strong>ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="-å¤åˆ¶æ¨¡å¼">ðŸŽšï¸ å¤åˆ¶æ¨¡å¼&lt;/h2>
&lt;h3 id="-å¼‚æ­¥æ¨¡å¼é»˜è®¤">ðŸŒ‘ å¼‚æ­¥æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰&lt;/h3>
&lt;p>ä¸»åº“ä¸ä¼šä¸»åŠ¨æŽ¨é€ binlog ç»™ä»Žåº“ï¼Œäº‹åŠ¡æ‰§è¡Œå®Œç›´æŽ¥è¿”å›žï¼Œä¸å…³å¿ƒä»Žåº“æ˜¯å¦æŽ¥æ”¶åˆ°æ•°æ®ï¼Œä»Žåº“é€šè¿‡å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œä¸»ä»Žå¤åˆ¶ã€‚&lt;/p>
&lt;h3 id="-åŠåŒæ­¥æ¨¡å¼">ðŸŒ“ åŠåŒæ­¥æ¨¡å¼&lt;/h3>
&lt;p>ä¸»åº“æ‰§è¡Œçš„äº‹åŠ¡ï¼Œç­‰åˆ°è‡³å°‘ä¸€ä¸ªä»Žåº“å°†æ—¥å¿—è®°å½•åˆ°äº† relay log ä¸­ä¹‹åŽï¼Œå†æäº¤ï¼ˆä¸èƒ½ä¿è¯ä»Žåº“æ‰§è¡Œå®Œæˆï¼Œåªèƒ½ä¿è¯ä¸€ä¸ªä»Žåº“æ”¶åˆ°äº†æ—¥å¿—ï¼‰ã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼šå¦‚æžœä»Žåº“åœ¨è¶…æ—¶æ—¶é—´ä¹‹å†…æ²¡æœ‰è¿”å›žï¼Œä¼šé€€åŒ–æˆå¼‚æ­¥æ¨¡å¼ã€‚&lt;/p>
&lt;h3 id="-å…¨åŒæ­¥æ¨¡å¼">ðŸŒ• å…¨åŒæ­¥æ¨¡å¼&lt;/h3>
&lt;p>ä¸»åº“æ‰§è¡Œçš„äº‹åŠ¡ï¼Œç­‰åˆ°æ‰€æœ‰çš„ä»Žåº“éƒ½æ‰§è¡Œå®Œæˆä¹‹åŽï¼Œä¸»åº“æ‰ä¼šæäº¤ï¼Œè¿”å›žæˆåŠŸä¿¡æ¯ç»™å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;p>åœ¨å®žé™…é¡¹ç›®ä¸­ï¼ŒåŸºæœ¬ä¸ä¼šä½¿ç”¨ã€‚ä¼šä¸¥é‡å½±å“æ€§èƒ½ï¼Œåªè¦æœ‰ä¸€ä¸ªä»Žåº“å‘ç”Ÿæ•…éšœï¼Œå°±ä¼šå½±å“ä¸šåŠ¡æ­£å¸¸è¿›è¡Œã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://ost.51cto.com/posts/11721" target="_blank" rel="noopener"
>https://ost.51cto.com/posts/11721&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;amp;mid=2651961330&amp;amp;idx=1&amp;amp;sn=4bdbada3b26d4fc2fc505f7a0f2ad7c4" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651961330&amp;idx=1&amp;sn=4bdbada3b26d4fc2fc505f7a0f2ad7c4&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Redis å¤åˆ¶</title><link>https://www.letout.cn/p/redis/replication/</link><pubDate>Wed, 01 Mar 2023 18:52:45 +0800</pubDate><guid>https://www.letout.cn/p/redis/replication/</guid><description>&lt;img src="https://www.letout.cn/p/redis/replication/replication.png" alt="Featured image of post Redis å¤åˆ¶" />&lt;h2 id="å»ºç«‹å¤åˆ¶">å»ºç«‹å¤åˆ¶&lt;/h2>
&lt;p>å‚ä¸Žå¤åˆ¶çš„ Redis å®žä¾‹è¢«åˆ’åˆ†ä¸ºï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸»èŠ‚ç‚¹ &lt;code>master&lt;/code>&lt;/li>
&lt;li>ä»ŽèŠ‚ç‚¹ &lt;code>slave&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»ŽèŠ‚ç‚¹ï¼Œæ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ &lt;code>master -&amp;gt; slave&lt;/code>ã€‚&lt;/p>
&lt;p>é€šè¿‡ä¸»ä»Žå¤åˆ¶ï¼Œå¯ä»¥å®žçŽ°ã€Œè¯»å†™åˆ†ç¦»ã€ï¼Œä¸»æœåŠ¡å™¨è´Ÿè´£ã€Œå†™ã€æ“ä½œï¼Œä»ŽæœåŠ¡å™¨è´Ÿè´£ã€Œè¯»ã€æ“ä½œã€‚&lt;/p>
&lt;p>åŒæ—¶ï¼Œä»ŽèŠ‚ç‚¹ä¹Ÿå¯ä»¥ä½œä¸ºä¸»èŠ‚ç‚¹çš„å¤‡ä»½ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/replication/read-write.png"
width="902"
height="422"
srcset="https://www.letout.cn/p/redis/replication/read-write_huc9c3964624999041f81d0c7b2328e956_42565_480x0_resize_box_3.png 480w, https://www.letout.cn/p/redis/replication/read-write_huc9c3964624999041f81d0c7b2328e956_42565_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="213"
data-flex-basis="512px"
>&lt;/p>
&lt;p>åœ¨ä»ŽæœåŠ¡å™¨ä¸­ï¼Œä½¿ç”¨ &lt;code>slaveof&lt;/code> / &lt;code>replicaof&lt;/code> å‘½ä»¤/é…ç½®ï¼Œå»ºç«‹ä¸»ä»ŽæœåŠ¡å…³ç³»ï¼Œæ‰§è¡Œå‘½ååŽï¼Œä»ŽèŠ‚ç‚¹åªä¼šä¿å­˜ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå…¶ä½™çš„å¤åˆ¶æµç¨‹åœ¨èŠ‚ç‚¹å†…éƒ¨å¼‚æ­¥è¿›è¡Œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é…ç½®æ–‡ä»¶ä¸­è®¾ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">slaveof &lt;span class="o">{&lt;/span>masterHost&lt;span class="o">}&lt;/span> &lt;span class="o">{&lt;/span>masterPort&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯åŠ¨ä»ŽæœåŠ¡æ—¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-server --slaveof &lt;span class="o">{&lt;/span>masterHost&lt;span class="o">}&lt;/span> &lt;span class="o">{&lt;/span>masterPort&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»ŽæœåŠ¡ä¸­ä½¿ç”¨å‘½ä»¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">slaveof &lt;span class="o">{&lt;/span>masterHost&lt;span class="o">}&lt;/span> &lt;span class="o">{&lt;/span>masterPort&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åŒæ­¥åŽŸç†">åŒæ­¥åŽŸç†&lt;/h3>
&lt;p>Redis å†…éƒ¨ä½¿ç”¨ &lt;code>psync&lt;/code> å®Œæˆä¸»ä»Žæ•°æ®çš„åŒæ­¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># runID ä¿å­˜çš„ä¸»æœåŠ¡å™¨çš„ id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># offset åç§»é‡ï¼Œç¬¬ä¸€æ¬¡åŒæ­¥ä¸º -1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">psync &lt;span class="o">{&lt;/span>runID&lt;span class="o">}&lt;/span> &lt;span class="o">{&lt;/span>offset&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>ðŸ‘£ ä¸»æœåŠ¡å™¨ä¼šæ‰§è¡Œ &lt;code>bgsave&lt;/code> å‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œç„¶åŽæŠŠæ–‡ä»¶å‘é€ç»™ä»ŽæœåŠ¡å™¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ‘£ ä»ŽæœåŠ¡å™¨æ”¶åˆ° RDB æ–‡ä»¶åŽï¼Œä¼šå…ˆã€Œæ¸…ç©ºå½“å‰çš„æ•°æ®ã€ï¼Œç„¶åŽè½½å…¥ RDB æ–‡ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ‘£ åœ¨å¤åˆ¶æœŸé—´ï¼Œä¸»æœåŠ¡å™¨ä¾ç„¶å¯ä»¥æ­£å¸¸å¤„ç†å‘½ä»¤ï¼ˆé€šè¿‡forkå­è¿›ç¨‹ï¼Œä½¿ç”¨ copy-on-wirite COWï¼‰ï¼Œä¸ºäº†ä¿éšœæ•°æ®çš„ä¸€è‡´æ€§ï¼Œå†™å‘½ä»¤ä¼šè¢«åŒæ—¶è®°å½•åœ¨ ã€Œå¤åˆ¶å®¢æˆ·ç«¯ç¼“å†²åŒºã€&lt;code>replication buffer&lt;/code> ä¸­ï¼Œä»ŽæœåŠ¡å™¨åŠ è½½å®Œ RDB åŽï¼Œä¼šç»§ç»­è¿è¡Œç¼“å­˜åŒºä¸­è®°å½•çš„å‘½ä»¤ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="éƒ¨åˆ†å¤åˆ¶">éƒ¨åˆ†å¤åˆ¶&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ“ƒ å¤åˆ¶åç§»é‡ offset&lt;/p>
&lt;p>å‚ä¸Žä¸»ä»Žçš„èŠ‚ç‚¹éƒ½ä¼šç»´æŠ¤è‡ªèº«çš„å¤åˆ¶åç§»é‡ï¼Œå¤„ç†å®Œã€Œå†™å‘½ä»¤ã€åŽï¼Œéƒ½ä¼šç´¯è®¡å‘½ä»¤çš„å­—èŠ‚é•¿åº¦ã€‚&lt;/p>
&lt;p>ä»ŽèŠ‚ç‚¹ä¼šæ¯ç§’é’Ÿä¼šå‘ä¸»èŠ‚ç‚¹ä¸ŠæŠ¥è‡ªèº«çš„å¤åˆ¶åç§»é‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>â™’ å¤åˆ¶ç§¯åŽ‹ç¼“å†²åŒº&lt;/p>
&lt;p>replication backlog buffer&lt;/p>
&lt;p>æœ¬è´¨ä¸Šä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„å®šé•¿é˜Ÿåˆ—ï¼ˆé»˜è®¤ä¸¤ä¸ªï¼Œ2 * 1Mï¼‰ï¼Œä¸Ž MySQL redolog ä¸€æ ·æ˜¯å¾ªçŽ¯å†™å…¥ï¼Œæ–°æ•°æ®ä¼šè¦†ç›–æ—§æ•°æ®ã€‚&lt;/p>
&lt;p>ä¸»èŠ‚ç‚¹å“åº”å†™å‘½ä»¤åŽï¼Œå‘é€å‘½ä»¤åˆ°ä»ŽèŠ‚ç‚¹æ—¶ï¼ŒåŒæ—¶ä¼šå°†æ•°æ®å†™å…¥å¤åˆ¶ç§¯åŽ‹ç¼“å†²åŒºï¼Œç”¨äºŽéƒ¨åˆ†å¤åˆ¶å‘½ä»¤ä¸¢å¤±æ˜¯çš„æ•°æ®è¡¥æ•‘ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¸»ä»ŽæœåŠ¡å™¨åœ¨å®Œæˆç¬¬ä¸€æ¬¡å…¨é‡å¤åˆ¶ä¹‹åŽï¼Œä¼šé€šè¿‡é•¿è¿žæŽ¥è¿›è¡Œå‘½ä»¤ä¼ æ’­ã€‚&lt;/p>
&lt;p>ç”±äºŽç½‘ç»œæ˜¯ä¸ç¨³å®šçš„ï¼Œä»ŽæœåŠ¡å™¨å¯èƒ½ä¼šæœ‰çŸ­æš‚çš„æ–­å¼€ï¼Œå½“é‡æ–°å»ºç«‹è¿žæŽ¥ä¹‹åŽï¼Œå¯ä»¥æ ¹æ®æƒ…å†µä½¿ç”¨å¢žé‡å¤åˆ¶æ¥åŒæ­¥æ•°æ®ï¼Œé¿å…äº†å…¨é‡å¤åˆ¶å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚&lt;/p>
&lt;p>å¢žé‡å¤åˆ¶åŒæ ·é‡‡ç”¨äº† &lt;code>psync&lt;/code> æ¥åŒæ­¥ï¼Œä»ŽæœåŠ¡å™¨é€šè¿‡ offset æ¥å‘ŠçŸ¥ä¸»æœåŠ¡å™¨å½“å‰çš„æ•°æ®åç§»æƒ…å†µã€‚&lt;/p>
&lt;p>å½“ä»ŽæœåŠ¡å™¨çš„åç§»é‡èƒ½å¤Ÿåœ¨å¤åˆ¶ç§¯åŽ‹ç¼“å†²åŒºä¸­æ‰¾åˆ°ï¼Œä¼šè¿›è¡Œéƒ¨åˆ†å¤åˆ¶ï¼›å½“åç§»æ•°æ®è¿‡å¤§ï¼Œå·²è¢«è¦†ç›–æ— æ³•æ‰¾åˆ°æ—¶ï¼Œä¼šé€€åŒ–ä¸ºå…¨é‡å¤åˆ¶ã€‚&lt;/p>
&lt;h3 id="-ä¿æŒè¿žæŽ¥">ðŸ’“ ä¿æŒè¿žæŽ¥&lt;/h3>
&lt;p>ä¸»ä»ŽèŠ‚ç‚¹é—´æœ‰å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸»èŠ‚ç‚¹æ¯ 10s å‘ä»ŽèŠ‚ç‚¹å‘é€ &lt;code>ping&lt;/code> å‘½ä»¤ï¼Œåˆ¤æ–­ä»ŽèŠ‚ç‚¹çš„è¿žæŽ¥çŠ¶æ€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»ŽèŠ‚ç‚¹æ¯ 1s ä¸ŠæŠ¥è‡ªèº« offset æƒ…å†µ&lt;/p>
&lt;ul>
&lt;li>å®žæ—¶ç›‘æŽ§ä»ŽèŠ‚ç‚¹ç½‘ç»œçŠ¶æ€ï¼Œå»¶è¿Ÿæ€§&lt;/li>
&lt;li>åˆ¤æ–­æ•°æ®æ˜¯å¦ä¸¢å¤±&lt;/li>
&lt;li>ä¿éšœä»ŽèŠ‚ç‚¹çš„è¿žæŽ¥æ•°é‡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-è¯»å†™åˆ†ç¦»é—®é¢˜">ðŸ“š è¯»å†™åˆ†ç¦»é—®é¢˜&lt;/h2>
&lt;h3 id="-æ•°æ®å»¶è¿Ÿ">ðŸŽ° æ•°æ®å»¶è¿Ÿ&lt;/h3>
&lt;p>Redis ç”±äºŽå¼‚æ­¥å¤åˆ¶çš„ç‰¹æ€§ï¼Œå»¶è¿Ÿæ˜¯æ— æ³•é¿å…çš„ï¼Œå–å†³äºŽå½“å‰çš„ç½‘ç»œæƒ…å†µå’Œå‘½ä»¤é˜»å¡žæƒ…å†µã€‚&lt;/p>
&lt;p>é€‚åˆäºŽä¸šåŠ¡åœºæ™¯å¯¹å»¶è¿Ÿä¸æ•æ„Ÿçš„åœºæ™¯ã€‚æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯è€Œå®šï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Redis é›†ç¾¤åšæ°´å¹³æ‰©å±•çš„æ–¹æ¡ˆã€‚&lt;/p>
&lt;h3 id="-è¿‡æœŸæ•°æ®">ðŸ—‘ï¸ è¿‡æœŸæ•°æ®&lt;/h3>
&lt;p>åœ¨ Redis ä¸­ï¼Œæœ‰ï¼ˆ1ï¼‰å®šæœŸåˆ é™¤ï¼›ï¼ˆ2ï¼‰æƒ°æ€§åˆ é™¤ï¼›ä¸¤ç§åˆ é™¤æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>åœ¨ä»ŽæœåŠ¡å™¨ä¸­ï¼Œä¸ä¼šä¸»åŠ¨æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œä¸»æœåŠ¡å™¨ä¸­æ‰¾åˆ°è¿‡æœŸæ•°æ®ï¼Œä¼šåŒæ­¥ä¸€æ¡ &lt;code>DEL&lt;/code> å‘½ä»¤åˆ°ä»ŽæœåŠ¡å™¨ä¸­ï¼Œåˆ é™¤è¿‡æœŸæ•°æ®ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åœ¨ Redis 3.2-ï¼Œä»ŽæœåŠ¡å™¨ä¼šç›´æŽ¥è¿”å›žè¿‡æœŸæ•°æ®ï¼Œä¸ä¼šè¿›è¡Œæ£€æŸ¥&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ Redis 3.2+ï¼Œåœ¨è¿”å›žæ•°æ®å‰ï¼Œä¼šæ£€æŸ¥è¿‡æœŸæ—¶é—´ï¼Œè§£å†³äº†ä»ŽæœåŠ¡å™¨è¯»å–åˆ°è¿‡æœŸæ•°æ®çš„é—®é¢˜&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-èŠ‚ç‚¹æ•…éšœ">ðŸŒ€ èŠ‚ç‚¹æ•…éšœ&lt;/h3>
&lt;p>å½“ä¸»èŠ‚ç‚¹å®•æœºåŽï¼Œä»ŽèŠ‚ç‚¹æ˜¯æ— æ³•è‡ªåŠ¨å‡çº§ä¸ºä¸»èŠ‚ç‚¹çš„ï¼Œéœ€è¦äººå·¥å¹²é¢„ã€‚&lt;/p>
&lt;p>è€ƒè™‘ä½¿ç”¨ Redis å“¨å…µæ¨¡å¼æˆ–é›†ç¾¤æ–¹æ¡ˆã€‚&lt;/p>
&lt;h2 id="-ç›¸å…³ä¼˜åŒ–">ðŸ‘ ç›¸å…³ä¼˜åŒ–&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>é¿å…å…¨é‡å¤åˆ¶&lt;/p>
&lt;p>ä¸»ä»Žå¤åˆ¶çš„å…¨é‡å¤åˆ¶æ˜¯ä¸€ä¸ªéžå¸¸æ¶ˆè€—èµ„æºçš„æ“ä½œï¼Œé™¤äº†ç¬¬ä¸€æ¬¡å¤åˆ¶çš„å…¨é‡å¤åˆ¶ï¼Œä¹‹åŽéœ€è¦å°½é‡é¿å…å…¨é‡å¤åˆ¶ã€‚&lt;/p>
&lt;p>å¤åˆ¶ç§¯åŽ‹ç¼“å­˜åŒºä¸è¶³ï¼Œä¼šå¯¼è‡´å¤åˆ¶é€€åŒ–ä¸ºå…¨é‡å¤åˆ¶ï¼Œåœ¨è¿ç»´æ—¶ï¼Œå¯ä»¥æ ¹æ®å®žé™…æƒ…å†µå¢žåŠ ç¼“å†²åŒºçš„å®¹é‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é¿å…å¤åˆ¶é£Žæš´&lt;/p>
&lt;p>å½“ä¸€ä¸ªä¸»èŠ‚ç‚¹ä¸ŠæŒ‚è½½äº†å¤šä¸ªä»ŽèŠ‚ç‚¹ï¼Œå¦‚æžœåŒæ—¶ä¸Žå¤šä¸ªä»ŽèŠ‚ç‚¹è¿›è¡Œå…¨é‡åŒæ­¥æ—¶ï¼Œä¼šå‘å¤šä¸ªä»ŽèŠ‚ç‚¹å‘é€RDBæ–‡ä»¶ï¼ˆRedis åšäº†ä¼˜åŒ–å¯å…±äº«ä¸€ä¸ª RDBï¼‰ï¼Œå¯¼è‡´ç½‘ç»œå¸¦å®½çš„ä¸¥é‡æ¶ˆè€—ï¼Œé€ æˆå»¶è¿Ÿé—®é¢˜ã€‚&lt;/p>
&lt;p>å»ºè®®ä½¿ç”¨é“¾çŠ¶/æ ‘çŠ¶ç»“æž„ï¼Œä»ŽèŠ‚ç‚¹æŒ‚è½½åˆ°ä»ŽèŠ‚ç‚¹ä¸Šã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å•æœºå¤åˆ¶é£Žæš´&lt;/p>
&lt;p>ç”±äºŽ Redis çš„ç“¶é¢ˆä¸åœ¨ CPU ä¸Šï¼Œé€šå¸¸ä¼šåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²å¤šä¸ªå®žä¾‹ã€‚
ä¸ºäº†é¿å…ç‰©ç†æœºé—®é¢˜å¯¼è‡´çš„æ•…éšœï¼Œå¯¼è‡´æ¢å¤åŽå¤§é‡ä»ŽèŠ‚ç‚¹å‘ä¸€å°æœºå™¨è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œéƒ¨ç½²æ—¶åº”è¯¥æŠŠä¸åŒæœåŠ¡çš„ä¸»èŠ‚ç‚¹åˆ†æ•£åˆ°å¤šå°æœºå™¨ä¸Šã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-å“¨å…µæœºåˆ¶">ðŸŽº å“¨å…µæœºåˆ¶&lt;/h2>
&lt;p>Redis åœ¨ä¸»ä»Žæ¨¡å¼ä¸‹ï¼Œä¸€æ—¦ä¸»èŠ‚ç‚¹æ•…éšœðŸ˜“ï¼Œéœ€è¦äººå·¥å¹²é¢„å°†ä»ŽèŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼ŒåŒæ—¶éœ€è¦åœ¨å®¢æˆ·ç«¯é…ç½®æ–°çš„ä¸»èŠ‚ç‚¹åœ°å€ã€‚&lt;/p>
&lt;p>ä¸ºäº†è¾¾åˆ°é«˜å¯ç”¨ï¼Œæä¾›äº†å“¨å…µæ¨¡å¼ &lt;code>Redis Sentinel&lt;/code> è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè‡ªåŠ¨å®Œæˆæ•…éšœå‘çŽ°å’Œæ•…éšœè½¬ç§»ã€‚&lt;/p>
&lt;p>åœ¨å“¨å…µæ¨¡å¼ä¸‹ï¼Œç›¸æ¯”äºŽå¤åˆ¶æ¨¡å¼ï¼Œåªæ˜¯å¤šäº† Sentinel èŠ‚ç‚¹ï¼Œä¸»ä»Žæ¨¡å¼ä¸‹çš„ Redis èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•ç‰¹æ®Šå¤„ç†ã€‚
å…¶ä¸­ï¼ŒSentinel èŠ‚ç‚¹æœ¬è´¨ä¸Šæ˜¯ç‰¹æ®Šçš„ Redis èŠ‚ç‚¹ï¼Œåªæ˜¯ä¸ä¼šå­˜å‚¨æ•°æ®ï¼Œåªæ”¯æŒéƒ¨åˆ†å‘½ä»¤ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/replication/sentinel.png"
width="545"
height="732"
srcset="https://www.letout.cn/p/redis/replication/sentinel_hu9ca24b6840f6afec965ea3fe9eb87fe5_297258_480x0_resize_box_3.png 480w, https://www.letout.cn/p/redis/replication/sentinel_hu9ca24b6840f6afec965ea3fe9eb87fe5_297258_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="74"
data-flex-basis="178px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ” ç›‘æŽ§&lt;/p>
&lt;p>æ¯ä¸ªå“¨å…µèŠ‚ç‚¹ä¼šå®šæœŸæ£€æŸ¥ Redis æ•°æ®èŠ‚ç‚¹ã€å…¶ä½™å“¨å…µèŠ‚ç‚¹æ˜¯å¦å¯è¾¾ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ“§ é€šçŸ¥&lt;/p>
&lt;p>å“¨å…µèŠ‚ç‚¹ä¼šå°†æ•…éšœè½¬ç§»çš„ç»“æžœé€šçŸ¥ç»™åº”ç”¨æ–¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ“‡ ä¸»èŠ‚ç‚¹æ•…éšœè½¬ç§»&lt;/p>
&lt;p>å¯ä»¥å®žçŽ°æ•…éšœæ—¶ï¼Œå°†ä»ŽèŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶ç»´æŠ¤æ­£ç¡®çš„ä¸»ä»Žå…³ç³»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ“‘ é…ç½®æä¾›è€…&lt;/p>
&lt;p>åœ¨å“¨å…µç»“æž„ä¸­ï¼Œå®¢æˆ·ç«¯åˆå§‹åŒ–è¿žæŽ¥çš„æ˜¯å“¨å…µé›†ç¾¤ï¼Œä»Žä¸­èŽ·å–ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿">ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿&lt;/h3>
&lt;h4 id="-ä¸»è§‚ä¸‹çº¿">ðŸ§ ä¸»è§‚ä¸‹çº¿&lt;/h4>
&lt;p>â€ä¸€å®¶ä¹‹è¨€â€œ&lt;/p>
&lt;p>Sentinel æ¯ 1s ä¼šå‘å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹å‘é€ &lt;code>ping&lt;/code> è¿›è¡ŒðŸ’“å¿ƒè·³æ£€æµ‹ï¼Œå½“èŠ‚ç‚¹è¶…è¿‡æ—¶é—´æ²¡æœ‰å›žå¤ï¼Œå°±ä¼šå¯¹è¯¥èŠ‚ç‚¹åšå¤±è´¥åˆ¤å®šã€‚åªæœ‰è¿™ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ¤å®šç§°ä¸ºã€Œä¸»è§‚ä¸‹çº¿ã€ã€‚&lt;/p>
&lt;h4 id="-å®¢è§‚ä¸‹çº¿">ðŸ—³ï¸ å®¢è§‚ä¸‹çº¿&lt;/h4>
&lt;p>å½“ä¸»è§‚ä¸‹çº¿çš„ä¸ºä¸»èŠ‚ç‚¹æ—¶ï¼Œå½“å‰ Sentinel èŠ‚ç‚¹ä¼šè¯¢é—®å…¶ä»–å“¨å…µå¯¹è¯¥ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå½“å¤šæ•°å“¨å…µéƒ½å¯¹ä¸»èŠ‚ç‚¹çš„ä¸‹çº¿åšäº†åŒæ„åˆ¤å®šï¼Œè¶…è¿‡é…ç½®ä¸­çš„ quorum ä¸ªæ•°ï¼Œè¯¥èŠ‚ç‚¹å°±è¢«æ ‡è®°ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ã€‚&lt;/p>
&lt;h3 id="ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡">ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡&lt;/h3>
&lt;p>Redis Sentinel é€šè¿‡ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡å¯¹å„ä¸ªèŠ‚ç‚¹å‘çŽ°å’Œç›‘æŽ§ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ¯éš” 10sï¼Œæ¯ä¸ªå“¨å…µèŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹å’Œä»ŽèŠ‚ç‚¹å‘é€ info å‘½ä»¤èŽ·å–æœ€æ–°çš„æ‹“æ‰‘ç»“æž„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¯éš” 2sï¼Œæ¯ä¸ªå“¨å…µèŠ‚ç‚¹ä¼šå‘ Redis æ•°æ®èŠ‚ç‚¹çš„ __sentinel__:hello é¢‘é“ä¸Šå‘é€è¯¥ Sentinel èŠ‚ç‚¹å¯¹äºŽä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œä»¥åŠå½“å‰ Sentinel èŠ‚ç‚¹çš„ä¿¡æ¯&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¯éš” 1sï¼Œæ¯ä¸ªå“¨å…µä¼šå‘å…¶ä»–å“¨å…µèŠ‚ç‚¹ã€ä¸»èŠ‚ç‚¹ã€ä»ŽèŠ‚ç‚¹å‘é€ ping å‘½ä»¤åˆ¤æ–­æ˜¯å¦å¯è¾¾&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="sentinel-é¢†å¯¼é€‰ä¸¾">Sentinel é¢†å¯¼é€‰ä¸¾&lt;/h3>
&lt;p>å½“ç¡®å®šå®¢è§‚ä¸‹çº¿ä¹‹åŽï¼Œéœ€è¦è¿›è¡Œæ•…éšœè½¬ç§»å·¥ä½œã€‚å®žé™…ä¸Šæ•…éšœè½¬ç§»å·¥ä½œåªéœ€è¦ä¸€ä¸ª Sentinel èŠ‚ç‚¹æ¥å®Œæˆå³å¯ï¼Œæ‰€ä»¥éœ€è¦å…ˆåšä¸€ä¸ªé¢†å¯¼è€…é€‰ä¸¾çš„å·¥ä½œã€‚&lt;/p>
&lt;p>Redis ä½¿ç”¨ &lt;a class="link" href="https://raft.github.io/" target="_blank" rel="noopener"
>Raft&lt;/a> ç®—æ³•å®žçŽ°é¢†å¯¼çš„é€‰ä¸¾ã€‚&lt;/p>
&lt;p>æ¯ä¸ªåœ¨çº¿çš„ Redis Sentinel éƒ½æœ‰èµ„æ ¼æˆä¸ºé¢†å¯¼è€…ï¼Œåœ¨ä¸€ä¸ªå“¨å…µç¡®å®šä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿æ—¶ï¼Œä¼šå‘å…¶ä»–çš„èŠ‚ç‚¹å‘é€ &lt;code>sentinel is-master-down-by-addr&lt;/code> å‘½ä»¤ï¼Œ
è¦æ±‚å°†è‡ªå·±è®¾ç½®ä¸ºé¢†å¯¼è€…ã€‚&lt;/p>
&lt;p>æ”¶åˆ°å‘½ä»¤çš„èŠ‚ç‚¹ï¼Œå¦‚æžœæ²¡æœ‰åŒæ„è¿‡å…¶ä»–èŠ‚ç‚¹çš„è¯·æ±‚ï¼Œå°±ä¼šåŒæ„è¯¥è¯·æ±‚ï¼Œå¦åˆ™æ‹’ç»ã€‚æ¯ä¸ªå“¨å…µèŠ‚ç‚¹åªæœ‰ä¸€ç¥¨ã€‚&lt;/p>
&lt;p>å½“ä¸€ä¸ªå“¨å…µæ‹¿åˆ° quorum ä¸ªç¥¨æ•°æ—¶ï¼Œå°±æˆä¸ºäº†é¢†å¯¼è€…ï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ¬¡æŠ•ç¥¨ã€‚&lt;/p>
&lt;h3 id="-æ•…éšœè½¬ç§»">ðŸŽ¡ æ•…éšœè½¬ç§»&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ‘£ é€‰å–æ–°çš„ä¸»èŠ‚ç‚¹&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ§© è¿‡æ»¤â€œä¸å¥åº·â€èŠ‚ç‚¹ï¼ˆä¸»è§‚ä¸‹çº¿ã€æŽ‰çº¿ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© é€‰æ‹©ã€Œä¼˜å…ˆçº§æœ€é«˜ã€çš„èŠ‚ç‚¹ï¼Œå¦åˆ™ç»§ç»­ä¸‹ä¸€æ¡è§„åˆ™&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© é€‰å–ã€Œoffset æœ€å¤§ã€çš„èŠ‚ç‚¹ï¼Œå¦åˆ™ä¸‹ä¸€æ¡è§„åˆ™&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© é€‰å–ã€ŒrunId æœ€å°ã€çš„èŠ‚ç‚¹ï¼ˆrunId æ˜¯ Redis éšæœºç”Ÿæˆçš„ä¸€ä¸ªidï¼Œåœ¨é›†ç¾¤ä¸­è¿™ä¸ª id ä¼šä¿æŒä¸å˜ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ‘£ ä»ŽèŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹&lt;/p>
&lt;p>ä»ŽèŠ‚ç‚¹å†…éƒ¨æ‰§è¡Œ &lt;code>slaveof no one&lt;/code> æˆä¸ºä¸»èŠ‚ç‚¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ‘£ å“¨å…µé¢†å¯¼è€…å‘å…¶ä»–ä»ŽèŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œæ›´æ¢ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ‘£ å°†ä¸‹çº¿çš„ä¸»èŠ‚ç‚¹æ›´æ–°ä¸ºä»ŽèŠ‚ç‚¹ï¼Œå¹¶ä¿æŒç›‘æŽ§ï¼Œå½“å†æ¬¡ä¸Šçº¿æ—¶ï¼Œå°†ä½œä¸ºä»ŽèŠ‚ç‚¹å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ä¿¡æ¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹&lt;/h3>
&lt;ul>
&lt;li>Sentinel èŠ‚ç‚¹åº”è¯¥éƒ¨ç½²åœ¨å¤šå°ç‰©ç†æœºä¸Š&lt;/li>
&lt;/ul>
&lt;p>Redis çš„ç“¶é¢ˆä¸åœ¨ CPUï¼Œé€šè¿‡ä¸€å°ç‰©ç†æœºä¼šéƒ¨ç½²å¤šä¸ª Redis å®žä¾‹ï¼Œå¦‚æžœå“¨å…µå…¨éƒ¨éƒ½åœ¨ä¸€å°ç‰©ç†æœºä¸Šï¼Œå¦‚æžœå‡ºçŽ°ç‰©ç†æ•…éšœï¼Œæ‰€æœ‰çš„å®žä¾‹éƒ½ä¼šæ”¶åˆ°å½±å“&lt;/p>
&lt;ul>
&lt;li>è‡³å°‘ä¸‰ä¸ª Sentinel èŠ‚ç‚¹ï¼Œä¸”ä¸ºå¥‡æ•°èŠ‚ç‚¹&lt;/li>
&lt;/ul>
&lt;p>å“¨å…µé¢†å¯¼è€…é€‰ä¸¾æ—¶ï¼Œè‡³å°‘éœ€è¦èŽ·å–ã€Œä¸€åŠ + 1ã€ä¸ªæŠ•ç¥¨ã€‚å¥‡æ•°èŠ‚ç‚¹å¯ä»¥åœ¨æ»¡è¶³æ¡ä»¶çš„åŸºç¡€ä¸ŠèŠ‚çœä¸€ä¸ªèŠ‚ç‚¹ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://segmentfault.com/a/1190000039766545" target="_blank" rel="noopener"
>https://segmentfault.com/a/1190000039766545&lt;/a>&lt;/li>
&lt;li>Redis å¼€å‘äºŽè¿ç»´&lt;/li>
&lt;/ul></description></item><item><title>é€‚é…å™¨æ¨¡å¼</title><link>https://www.letout.cn/p/design-pattern/adapter/</link><pubDate>Mon, 20 Feb 2023 20:02:02 +0800</pubDate><guid>https://www.letout.cn/p/design-pattern/adapter/</guid><description>&lt;img src="https://www.letout.cn/p/design-pattern/adapter/adapter.png" alt="Featured image of post é€‚é…å™¨æ¨¡å¼" />&lt;h2 id="-ä»‹ç»">ðŸ“– ä»‹ç»&lt;/h2>
&lt;p>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter / Wrapperï¼‰æ˜¯ä¸€ç§ &lt;strong>ç»“æž„åž‹æ¨¡å¼&lt;/strong>ã€‚&lt;/p>
&lt;p>é€šè¿‡é€‚é…å™¨æ¨¡å¼ï¼Œå¯ä»¥å°†ä¸€ä¸ªç±»Açš„æŽ¥å£ï¼Œè½¬åŒ–æˆä¸€ä¸ªç±»Bï¼Œä»¥æ»¡è¶³ä¸€äº›æ–¹æ³•çš„è°ƒç”¨ã€‚&lt;/p>
&lt;p>å¦‚ç±»Aæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ã€é—ç•™ç±»ç­‰ï¼Œå·²ç»è¢«å…¶ä»–åœ°æ–¹ä½¿ç”¨ï¼Œæ— æ³•æ›´æ”¹ï¼Œé€šè¿‡é€‚é…å™¨æ¨¡å¼çš„æ€æƒ³ï¼Œé€šè¿‡ä¸€ä¸ªä¸­é—´çš„ç±»ï¼Œå°è£…å¤æ‚çš„è½¬åŒ–è¿‡ç¨‹ï¼Œè½¬æ¢ä¸ºéœ€è¦çš„ç±»åž‹ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ”– ç”Ÿæ´»ä¸­çš„æ’åº§ï¼Œå„ä¸ªå›½å®¶æ ‡å‡†ä¸åŒï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªè½¬æŽ¥å™¨ï¼Œé€‚é…ä¸åŒçš„æ’å£&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”– ARM CPU é€‚é… X86 åº”ç”¨çš„è½¬è¯‘&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”– Linux -&amp;gt; Wine / è™šæ‹Ÿæœº -&amp;gt; è¿è¡Œ Windows åº”ç”¨&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-å®žçŽ°æ–¹å¼">ðŸŽˆ å®žçŽ°æ–¹å¼&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>ðŸŽ—ï¸ å®žçŽ°ä¸€ä¸ªä¸­é—´ç±»ï¼Œå®žçŽ°/ç»§æ‰¿ éœ€è¦çš„ç±»åž‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ å°†éœ€è¦è¢«è½¬æ¢çš„ç±»Aï¼Œä½œä¸ºä¸­é—´ç±»çš„æˆå‘˜å¯¹è±¡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ åœ¨ç±»Aä¸­å®žçŽ°ç›¸å…³æ–¹æ³•ï¼Œè¿›è¡Œé€‚é…&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ æœ€åŽï¼Œæ‰€æœ‰çš„ç›¸å…³å·¥ä½œï¼Œéƒ½ä¼šè¢«å§”æ‰˜ç»™ä¸­é—´ç±»&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-java-ä¸­çš„é€‚é…å™¨æ¨¡å¼">â˜• Java ä¸­çš„é€‚é…å™¨æ¨¡å¼&lt;/h2>
&lt;p>å½“æˆ‘ä»¬çŽ°åœ¨çš„æ•°æ®æ˜¯æ•°ç»„ç±»åž‹æ—¶ &lt;code>String[]&lt;/code>ï¼ŒçŽ°åœ¨è°ƒç”¨çš„æ–¹æ³•éœ€è¦ä¼ å…¥ &lt;code>List&amp;lt;String&amp;gt;&lt;/code> å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å·¥å…·ç±»è¿›è¡Œè½¬æ¢ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// String[] ---Arrays.asList()---&amp;gt; List&amp;lt;String&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Arrays.asList() ç›¸å½“äºŽä¸€ä¸ª Adapter
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="o">{&lt;/span>&lt;span class="s">&amp;#34;one&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;two&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;three&amp;#34;&lt;/span>&lt;span class="o">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">dataList&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// è¿™é‡Œçš„ List æ˜¯ä¸€ä¸ªå†…éƒ¨ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-å®žçŽ°">ðŸ› ï¸ å®žçŽ°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">Task&lt;/span> &lt;span class="n">implement&lt;/span> &lt;span class="n">Callable&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">call&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">Exception&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;è¿™æ˜¯ä¸€ä¸ªçŽ°æœ‰çš„ä»»åŠ¡&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;è¿™æ˜¯ä¸€ä¸ªçŽ°æœ‰çš„ä»»åŠ¡&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// çŽ°åœ¨æŸå¤„ï¼Œéœ€è¦ä½¿ç”¨ Thread è¿è¡Œçº¿ç¨‹æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// âš  new Thread(new Runnable()) ä¸èƒ½æŽ¥æ”¶ Callable å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// éœ€è¦ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œå°† Callable -----&amp;gt; Runnable
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Callable&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">task&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Task&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">RunnableAdapter&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">task&lt;/span>&lt;span class="o">)).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 1) å®žçŽ°ç›®æ ‡æŽ¥å£ Runnable
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 2) åœ¨ç›®æ ‡æŽ¥å£ä¸­ï¼ŒæŒæœ‰ Callable å¯¹è±¡ï¼Œå¯¹å…¶è¿›è¡Œé€‚é…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 3) åœ¨ç›®æ ‡æŽ¥å£çš„æ–¹æ³•å†…éƒ¨ï¼Œè°ƒç”¨å¾…è½¬æ¢çš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RunnableAdapter&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">Callable&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">callable&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">RunnableAdapter&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Callable&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">callable&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">callable&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">callable&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">callable&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">call&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RuntimeException&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>è´£ä»»é“¾æ¨¡å¼</title><link>https://www.letout.cn/p/design-pattern/chain-of-responsibility/</link><pubDate>Sun, 19 Feb 2023 20:02:02 +0800</pubDate><guid>https://www.letout.cn/p/design-pattern/chain-of-responsibility/</guid><description>&lt;img src="https://www.letout.cn/p/design-pattern/chain-of-responsibility/chain-of-responsibility.png" alt="Featured image of post è´£ä»»é“¾æ¨¡å¼" />&lt;h2 id="-ä»‹ç»">ðŸ“– ä»‹ç»&lt;/h2>
&lt;p>è´£ä»»é“¾æ¨¡å¼æ˜¯ä¸€ç§&lt;strong>è¡Œä¸ºåž‹æ¨¡å¼&lt;/strong>ã€‚æ˜¯ä¸€ç§å¤„ç†è¯·æ±‚çš„æ¨¡å¼ï¼Œè¯·æ±‚åœ¨é“¾ä¸Šä¼ é€’ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ã€‚å¤„ç†å™¨å¯ä»¥å†³å®šè¯·æ±‚æ˜¯å¦å‘ä¸‹ä¼ é€’ï¼ˆå¦‚æ— æ³•å¤„ç†ï¼Œéœ€è¦äº¤ç»™ä¸‹ä¸€ä¸ªå¤„ç†ï¼‰ï¼Œæˆ–è€…ç›´æŽ¥è¿”å›žï¼ˆå¦‚å¤„ç†å®Œæˆï¼Œè¿”å›žç»“æžœï¼‰ã€‚&lt;/p>
&lt;p>é€šè¿‡è´£ä»»é“¾æ¨¡å¼ï¼Œå¯ä»¥è®©è¯·æ±‚çš„å‘é€è€…å’Œå¤„ç†è¯·æ±‚çš„å¤„ç†å™¨è¿›è¡Œç»“æž„ï¼Œæ¯ä¸ªå¤„ç†å™¨åªå¤„ç†ç‰¹å®šçš„æƒ…å†µï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ·»åŠ /åˆ é™¤å¤„ç†å™¨ã€‚&lt;/p>
&lt;p>å¸¸è§çš„åœºæ™¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ”– ç–«æƒ…æœŸé—´è¯·å‡å‡ºæ ¡ï¼Œå­¦æ ¡é¢†å¯¼çš„å±‚å±‚å®¡æ‰¹ ðŸ˜‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”– å‡»é¼“ä¼ èŠ±æ¸¸æˆ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”– ç¼“å­˜æž¶æž„ï¼Œåœ¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°æ•°æ®ï¼Œå¾€æ•°æ®åº“æ€»æŸ¥æ‰¾&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”– GUI ç¨‹åºå¯¹ç‚¹å‡»æŒ‰é’®çš„å¤„ç†&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-å®žçŽ°æ–¹å¼">ðŸŽˆ å®žçŽ°æ–¹å¼&lt;/h2>
&lt;p>å…³é”®ï¼šæ¯ä¸ªå¤„ç†å™¨éƒ½å®žçŽ°ç»Ÿä¸€çš„æŽ¥å£ï¼Œå†…éƒ¨åŒ…å«ä¸‹ä¸€ä¸ª â­ï¸ å¤„ç†å™¨ next å’Œæœ¬å¤„ç†å™¨çš„ ðŸ”¨å¤„ç†æ–¹å¼ executeã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŽ—ï¸ å£°æ˜Žä¸€ä¸ªå¤„ç†å™¨çš„é€šç”¨æŽ¥å£ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ å…·ä½“çš„å¤„ç†è€…ã€‚å†³å®šæ˜¯å¦å¤„ç†è¯·æ±‚ / è¯·æ±‚æ˜¯å¦ä¼ é€’ç»™ä¸‹ä¸€ä¸ªã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ è´£ä»»é“¾ã€‚&lt;/p>
&lt;ul>
&lt;li>å®žçŽ°æ–¹å¼ä¸€ï¼šðŸ”— åŒ…å«ä¸€ä¸ª Listï¼Œå¯ä»¥ç”¨æ¥æž„å»ºå¤„ç†è¯·æ±‚çš„æ•°æ®ã€‚process æ–¹æ³•å¯¹ List è¿›è¡Œå¾ªçŽ¯ï¼Œå¤„ç†å™¨å¯ä»¥æ‰§è¡Œå°±å¤„ç†ç›¸åº”çš„æ–¹æ³•ï¼Œä¸èƒ½æ‰§è¡Œè¿”å›ž null ä¹‹ç±»ã€‚&lt;/li>
&lt;li>å®žçŽ°æ–¹å¼äºŒï¼šåœ¨å¤„ç†å™¨ä¸­åŒ…å« nextï¼Œä¸ºä¸‹ä¸€ä¸ªå¤„ç†å™¨ï¼Œä¸èƒ½æ‰§è¡Œè°ƒç”¨ next çš„æ–¹æ³•ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å¤„ç†è€…å¯ä»¥å†³å®šæ˜¯å¦æ²¿ç€é“¾ä¼ é€’è¯·æ±‚ï¼Œå¯ä»¥&lt;/p>
&lt;ul>
&lt;li>ï¼ˆ1ï¼‰å¤„ç†ä¸äº†ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ï¼ŒæˆåŠŸåŽç›´æŽ¥è¿”å›žï¼Œä¸€ä¸ªè¯·æ±‚åªèƒ½ä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œï¼›&lt;/li>
&lt;li>ï¼ˆ2ï¼‰æ‰€æœ‰å¤„ç†å™¨éƒ½ä¾æ¬¡æ‰§è¡Œä¸€æ¬¡è¯·æ±‚ï¼Œå®Œæˆç›¸åº”çš„å†…å®¹ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-å®žçŽ°">ðŸ› ï¸ å®žçŽ°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// é€šç”¨æ–¹æ³•å®šä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">Handler&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// true -&amp;gt; å¤„ç†æˆåŠŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// false -&amp;gt; æ‹’ç»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// null -&amp;gt; äº¤ç»™ä¸‹ä¸€ä¸ªå¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">process&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Request&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å…·ä½“å¤„ç†å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="n">ManagerHandler&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Handler&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">process&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Request&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// if () ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">DirectorHandler&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Handler&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">CEOHandler&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Handler&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">HandlerChain&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Handler&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">handlers&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ArrayList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">addHandler&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Handler&lt;/span> &lt;span class="n">handler&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">handlers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">process&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Requst&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Handler&lt;/span> &lt;span class="n">handler&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">handers&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">handler&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">process&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">b&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ ¹æ® true / false æ˜¯å¦è¦ç»“æŸè°ƒç”¨é“¾
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(...)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RuntimeException&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Could not handle request: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>ç­–ç•¥æ¨¡å¼</title><link>https://www.letout.cn/p/design-pattern/strategy/</link><pubDate>Sat, 28 Jan 2023 23:02:02 +0800</pubDate><guid>https://www.letout.cn/p/design-pattern/strategy/</guid><description>&lt;img src="https://www.letout.cn/p/design-pattern/strategy/1.png" alt="Featured image of post ç­–ç•¥æ¨¡å¼" />&lt;h2 id="-ä»‹ç»">ðŸ“– ä»‹ç»&lt;/h2>
&lt;p>ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§&lt;strong>è¡Œä¸ºåž‹æ¨¡å¼&lt;/strong>ã€‚&lt;/p>
&lt;p>ç­–ç•¥æ¨¡å¼æŒ‡å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œæ¯ç§ç®—æ³•éƒ½å°è£…åˆ°ä¸åŒçš„ç±»ä¸­ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥çµæ´»åœ°æ›¿æ¢è¿™äº›çš„ç®—æ³•ï¼ˆæ›¿æ¢æ‰§è¡Œçš„ç­–ç•¥ï¼‰ã€‚&lt;/p>
&lt;p>ðŸ“– å¸¸è§çš„åœºæ™¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ”– æ—…è¡Œçš„å‡ºæ¸¸æ–¹å¼ï¼Œé€‰æ‹©éª‘è‡ªè¡Œè½¦ã€åæ±½è½¦ï¼Œæ¯ä¸€ç§æ—…è¡Œæ–¹å¼éƒ½æ˜¯ä¸€ä¸ªç­–ç•¥ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”– ç”µå•†ç³»ç»Ÿä¸­ï¼Œä¸‹å•æ—¶ï¼Œå¯ä»¥é€‰æ‹©å¤šç§åˆ™æ‰£ç­–ç•¥ï¼ˆæ»¡å‡ï¼Œä¼˜æƒ åˆ¸ï¼Œç§¯åˆ†ï¼‰ï¼›æ”¯ä»˜æ—¶ï¼Œå¯ä»¥é€‰æ‹©å¤šç§æ”¯ä»˜æ–¹å¼ï¼ˆæ”¯ä»˜å®ï¼Œå¾®ä¿¡ï¼Œäº‘é—ªä»˜ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”– ç”¨ç­–ç•¥æ¨¡å¼æ¶ˆé™¤å¤§é‡çš„ &lt;code>if-else&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-å®žçŽ°æ–¹å¼">ðŸŽˆ å®žçŽ°æ–¹å¼&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>ðŸŽ—ï¸ ç­–ç•¥æŽ¥å£ï¼šä½¿ç”¨æŽ¥å£å®šä¹‰å…·ä½“ç­–ç•¥çš„é€šç”¨æŽ¥å£ï¼Œå£°æ˜Žäº†ä¸€ä¸ªä¸Šä¸‹æ–‡ç”¨äºŽæ‰§è¡Œç­–ç•¥çš„æ–¹æ³•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ å…·ä½“ç­–ç•¥ï¼šå®žçŽ°ç­–ç•¥æŽ¥å£ï¼Œå®žçŽ°å…·ä½“çš„ç›¸å…³ç®—æ³•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ å®¢æˆ·ç«¯è°ƒç”¨æ—¶ï¼Œä¼šå°†ä½¿ç”¨å…·ä½“çš„ç­–ç•¥å¯¹è±¡ä¼ é€’ç»™ä¸Šä¸‹æ–‡ï¼Œæ ¹æ®ç­–ç•¥ï¼Œæ‰§è¡Œä¸åŒçš„ç®—æ³•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ðŸ’¡ é‡ç‚¹ï¼šå®žçŽ°åŒä¸€ä¸ªæŽ¥å£ï¼Œé€šè¿‡ä¼ å…¥çš„ç­–ç•¥ï¼Œæ‰§è¡Œä¸åŒçš„ç®—æ³•ã€‚&lt;/p>
&lt;h2 id="-å®žçŽ°">ðŸ› ï¸ å®žçŽ°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç­–ç•¥æŽ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">DiscountStrategy&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–ä¼˜æƒ é‡‘é¢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">BigDecimal&lt;/span> &lt;span class="nf">getDiscount&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">BigDecimal&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ‰“æŠ˜ä¼˜æƒ 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">UserDiscountStrategy&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">DiscountStrategy&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">BigDecimal&lt;/span> &lt;span class="nf">getDiscount&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">BigDecimal&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">multiply&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">BigDecimal&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;0.1&amp;#34;&lt;/span>&lt;span class="o">)).&lt;/span>&lt;span class="na">setScale&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">RoundingMode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">DOWN&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ»¡å‡ä¼˜æƒ 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">OverDiscountStrategy&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">DiscountStrategy&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">BigDecimal&lt;/span> &lt;span class="nf">getDiscount&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">BigDecimal&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">compareTo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">BigDecimal&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">valueOf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">BigDecimal&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">valueOf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">BigDecimal&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ZERO&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç”¨äºŽæ‰§è¡Œç­–ç•¥çš„ä¸Šä¸‹æ–‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">DiscountContext&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æŒæœ‰æŸç§ç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="n">DiscountStrategy&lt;/span> &lt;span class="n">strategy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">UserDiscountStrategy&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">DiscountContext&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">DiscountStrategy&lt;/span> &lt;span class="n">strategy&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">strategy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">strategy&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç”¨äºŽæ›´æ”¹ç­–ç•¥æ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">setStrategy&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">DiscountStrategy&lt;/span> &lt;span class="n">strategy&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">strategy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">strategy&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è®¡ç®—ä»˜æ¬¾é‡‘é¢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="n">BigDecimal&lt;/span> &lt;span class="nf">calculatePrice&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">BigDecimal&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">subtract&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">strategy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDiscount&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">total&lt;/span>&lt;span class="o">)).&lt;/span>&lt;span class="na">setScale&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä½¿ç”¨ç­–ç•¥æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">DiscountContext&lt;/span> &lt;span class="n">context&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">DiscountContext&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">BigDecimal&lt;/span> &lt;span class="n">price&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">BigDecimal&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">valueOf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä½¿ç”¨æ»¡å‡ç­–ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setStrategy&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">OverDiscountStrategy&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">BigDecimal&lt;/span> &lt;span class="n">pay&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">context&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">calculatePrice&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-java-ä¸­çš„ç­–ç•¥æ¨¡å¼">â˜• Java ä¸­çš„ç­–ç•¥æ¨¡å¼&lt;/h2>
&lt;p>ä»¥æŽ’åºä¸ºä¾‹ï¼Œåœ¨ &lt;code>java.util.Arrays&lt;/code> &lt;code>java.util.Collections&lt;/code> å·¥å…·ç±»ä¸­ çš„ &lt;code>sort(XX, Comparator)&lt;/code> æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">sort&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Comparator&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ™®é€šçš„ &lt;code>sort()&lt;/code> é»˜è®¤ä»Žå°åˆ°å¤§è¿›è¡ŒæŽ’åºï¼Œå¦‚æžœæˆ‘ä»¬æƒ³è¦ä»Žå¤§åˆ°å°è¿›è¡ŒæŽ’åºï¼Œå°±æ˜¯è¦æ›´æ”¹æŽ’åºçš„ &lt;strong>ç­–ç•¥&lt;/strong>ï¼Œæˆ‘ä»¬å¯ä»¥å®žçŽ°è¿™ä¸ª &lt;code>Comparator&lt;/code> çš„ &lt;code>int compare(T o1, T o2)&lt;/code> æ–¹æ³•ï¼Œå¹¶ä¼ å…¥ &lt;code>sort()&lt;/code> ä¸­&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sort&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">nums&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">o1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">o2&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">o2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">o1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-å‚è€ƒ">ðŸ”— å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://refactoringguru.cn/design-patterns/strategy" target="_blank" rel="noopener"
>https://refactoringguru.cn/design-patterns/strategy&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.liaoxuefeng.com/wiki/1252599548343744/1281319606681634" target="_blank" rel="noopener"
>https://www.liaoxuefeng.com/wiki/1252599548343744/1281319606681634&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.runoob.com/design-pattern/strategy-pattern.html" target="_blank" rel="noopener"
>https://www.runoob.com/design-pattern/strategy-pattern.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>MySQL è¯­å¥æ˜¯æ€Žä¹ˆæ‰§è¡Œçš„</title><link>https://www.letout.cn/p/mysql/how-execute/</link><pubDate>Wed, 11 Jan 2023 18:30:02 +0800</pubDate><guid>https://www.letout.cn/p/mysql/how-execute/</guid><description>&lt;img src="https://www.letout.cn/p/mysql/how-execute/mysql.webp" alt="Featured image of post MySQL è¯­å¥æ˜¯æ€Žä¹ˆæ‰§è¡Œçš„" />&lt;p>MySQL å¯ä»¥åˆ†ä¸ºï¼š&lt;/p>
&lt;p>ï¼ˆ1ï¼‰Server å±‚ï¼šè´Ÿè´£å»ºç«‹è¿žæŽ¥ï¼Œåˆ†æžå’Œæ‰§è¡ŒSQL&lt;/p>
&lt;p>ï¼ˆ2ï¼‰å­˜å‚¨å¼•æ“Žå±‚ï¼šè´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/how-execute/mysql.webp"
width="1920"
height="1440"
srcset="https://www.letout.cn/p/mysql/how-execute/mysql_hu2e25f96503f96a8e12f0e1c93e28468a_180676_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/mysql/how-execute/mysql_hu2e25f96503f96a8e12f0e1c93e28468a_180676_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
>&lt;/p>
&lt;h2 id="-server-å±‚">ðŸ›Žï¸ Server å±‚&lt;/h2>
&lt;p>Server å±‚è´Ÿè´£å»ºç«‹è¿žæŽ¥ï¼Œåˆ†æžå’Œæ‰§è¡Œ SQLã€‚ä¸»è¦åŒ…æ‹¬ï¼šè¿žæŽ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æžå™¨ã€ä¼˜åŒ–å™¨å’Œæ‰§è¡Œå™¨ç­‰ï¼ŒåŒ…å« MySQL å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡çš„å…¬å…±åŠŸèƒ½ã€‚&lt;/p>
&lt;h3 id="-è¿žæŽ¥å™¨">ðŸ’ è¿žæŽ¥å™¨&lt;/h3>
&lt;p>å½“æˆ‘ä»¬ä½¿ç”¨ MySQL æœåŠ¡è¿žæŽ¥åˆ°æ•°æ®åº“æ—¶ï¼Œé¦–å…ˆå°±æ˜¯é€šè¿‡è¿žæŽ¥å™¨ã€‚&lt;/p>
&lt;p>è¿žæŽ¥å™¨è´Ÿè´£ä¸Žå®¢æˆ·ç«¯å»ºç«‹è¿žæŽ¥ã€èŽ·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿žæŽ¥ã€‚&lt;/p>
&lt;p>é€šå¸¸ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿žæŽ¥æ•°æ®åº“ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mysql -h&lt;span class="nv">$ip&lt;/span> -P&lt;span class="nv">$port&lt;/span> -u&lt;span class="nv">$user&lt;/span> -p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-æŸ¥è¯¢ç¼“å­˜">ðŸ¥ æŸ¥è¯¢ç¼“å­˜&lt;/h3>
&lt;p>ðŸ™…â€â™‚ï¸ MySQL 8.0 å·²ç»ç§»é™¤äº†æŸ¥è¯¢ç¼“å­˜ã€‚æŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­çŽ‡éžå¸¸ä½Žï¼Œé™¤éžéƒ½æ˜¯é™æ€è¡¨ä¸ä¼šæ›´æ–°ï¼Œåªè¦æœ‰ä¸€ä¸ªè¡¨æ›´æ–°äº†æ•°æ®ï¼Œè¿™ä¸ªè¡¨çš„æŸ¥è¯¢ç¼“å­˜å°±ä¼šè¢«æ¸…ç©ºï¼Œæœ‰æ—¶åè€Œä¼šå½±å“æ•°æ®åº“çš„æ•ˆçŽ‡ã€‚&lt;/p>
&lt;p>å®¢æˆ·ç«¯å‘ MySQL å‘é€ SQL è¯­å¥åŽï¼Œå¦‚æžœæ˜¯ &lt;code>select&lt;/code> è¯­å¥ï¼Œä¼šå…ˆåŽ»æŸ¥è¯¢ç¼“å­˜ä¸­æŸ¥æ‰¾è¿™æ¡è¯­å¥æ˜¯å¦è¢«ç¼“å­˜ï¼ˆkey-valueï¼‰ã€‚å¦‚æžœå‘½ä¸­ï¼Œä¼šç›´æŽ¥è¿”å›ž value ç»™å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;h3 id="-åˆ†æžå™¨">ðŸ åˆ†æžå™¨&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>è¯æ³•åˆ†æž&lt;/p>
&lt;p>MySQL ä¼šæ ¹æ®è¾“å…¥çš„å­—ç¬¦ä¸²è¯†åˆ«å‡ºå…³é”®å­—ï¼Œå¦‚ SQL ç±»åž‹ã€è¡¨åã€å­—æ®µåã€where æ¡ä»¶ç­‰ï¼Œæž„å»ºå‡º SQL è¯­æ³•æ ‘ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¯­æ³•åˆ†æž&lt;/p>
&lt;p>æ ¹æ®è¯æ³•åˆ†æžçš„ç»“æžœï¼Œè¯­æ³•è§£æžå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­è¯¥ SQL è¯­å¥æ˜¯å¦æ»¡è¶³ SQL è¯­æ³•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ä¼˜åŒ–å™¨">ðŸ‘ ä¼˜åŒ–å™¨&lt;/h3>
&lt;p>ä¼˜åŒ–å™¨ä¸»è¦è´Ÿè´£å°† SQL æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæ–¹æ¡ˆç¡®å®šä¸‹æ¥ã€‚&lt;/p>
&lt;p>æ¯”å¦‚åœ¨è¡¨ä¸­æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œä¼˜åŒ–å™¨ä¼šåŸºäºŽæŸ¥è¯¢æˆæœ¬çš„è€ƒè™‘ï¼Œé€‰æ‹©ä½¿ç”¨å“ªä¸ªç´¢å¼•ã€‚&lt;/p>
&lt;p>æ¯”å¦‚åˆ¤æ–­èµ°ç´¢å¼•æŸ¥è¯¢å›žè¡¨å’Œå…¨è¡¨æ‰«æçš„ä»£ä»·ï¼Œé€‰æ‹©è¿›è¡Œå›žè¡¨æˆ–å…¨è¡¨æ‰«æã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code>explain&lt;/code> æŸ¥çœ‹ä¸€ä¸ªæ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-æ‰§è¡Œå™¨">ðŸ“ æ‰§è¡Œå™¨&lt;/h3>
&lt;p>é€šè¿‡ä¼˜åŒ–å™¨ç¡®å®šæ‰§è¡Œæ–¹æ¡ˆåŽï¼ŒMySQL å¼€å§‹çœŸæ­£æ‰§è¡Œè¯­å¥äº†ã€‚&lt;/p>
&lt;p>åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œå™¨ä¼šä¸Žå­˜å‚¨å¼•æ“Žè¿›è¡Œäº¤äº’ï¼Œäº¤äº’ä»¥è®°å½•ï¼ˆè¡Œï¼‰ä¸ºå•ä½ã€‚&lt;/p>
&lt;p>å¯¹äºŽè¦è¿›è¡Œå…¨è¡¨æ‰«æçš„æƒ…å†µï¼Œæ‰§è¡Œå™¨ä¼šè°ƒç”¨ InnoDB å¼•æ“ŽæŽ¥å£çš„èŽ·å–è¡¨çš„ç¬¬ä¸€è¡Œï¼Œåˆ¤æ–­æ¡ä»¶æ˜¯å¦ç¬¦åˆï¼Œç¬¦åˆå°±åŠ å…¥åˆ°ç»“æžœé›†ä¸­ã€‚ä¹‹åŽä¸æ–­è°ƒç”¨å¼•æ“ŽæŽ¥å£é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°è¯»å–å®Œè¡¨çš„æœ€åŽä¸€è¡Œã€‚&lt;/p>
&lt;p>å¯¹äºŽè¦ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µï¼Œé€»è¾‘åŒæ ·ç±»ä¼¼ï¼Œä¼šé€šè¿‡ç´¢å¼•èŽ·å–æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€è¡Œï¼Œæ ¹æ®æƒ…å†µæ˜¯å¦è¦å›žè¡¨ã€è¦†ç›–ç´¢å¼•æˆ–ç´¢å¼•ä¸‹æŽ¨ï¼Œå†ä¸æ–­å‘åŽå¾ªçŽ¯èŽ·å–ï¼Œç›´åˆ°ä¸æ»¡è¶³æ¡ä»¶ã€‚&lt;/p>
&lt;h2 id="-å­˜å‚¨å¼•æ“Ž">ðŸ’½ å­˜å‚¨å¼•æ“Ž&lt;/h2>
&lt;p>å­˜å‚¨å¼•æ“Žè´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚&lt;/p>
&lt;p>MySQL å­˜å‚¨å¼•æ“Žçš„æž¶æž„æ¨¡å¼æ˜¯æ’ä»¶å¼çš„ï¼Œæ”¯æŒ InnoDBã€MyISAMã€Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“Žã€‚å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“Žã€‚é€šå¸¸æˆ‘ä»¬ä¼šé€‰æ‹©ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“Žã€‚&lt;/p>
&lt;p>åœ¨ InnoDB å­˜å‚¨å¼•æ“Žä¸­ï¼Œå¦‚æžœæŸ¥è¯¢çš„æ•°æ®åœ¨ &lt;a class="link" href="https://www.letout.cn/p/mysql/innodb/buffer-pool/" target="_blank" rel="noopener"
>BufferPool&lt;/a> ä¸­ï¼Œä¼šç›´æŽ¥è¿”å›žï¼›å¦‚æžœæ²¡æœ‰ä¼šå°†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåœ¨è¿”å›žç»™å®¢æˆ·ç«¯ã€‚&lt;/p></description></item><item><title>Redis ç¼“å­˜é—®é¢˜</title><link>https://www.letout.cn/p/redis/cache-problem/</link><pubDate>Wed, 11 Jan 2023 01:52:45 +0800</pubDate><guid>https://www.letout.cn/p/redis/cache-problem/</guid><description>&lt;img src="https://www.letout.cn/p/redis/cache-problem/cache.png" alt="Featured image of post Redis ç¼“å­˜é—®é¢˜" />&lt;h2 id="-ç¼“å­˜é›ªå´©">ðŸŒ¨ï¸ ç¼“å­˜é›ªå´©&lt;/h2>
&lt;p>ä¸ºäº†ä¿è¯ç¼“å­˜ä¸­æ•°æ®ä¸Žæ•°æ®åº“ä¸­çš„æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé€šå¸¸ Redis ä¸­æ•°æ®ä¼šè®¾ç½®è¿‡æœŸæ—¶é—´ã€‚å¦‚æžœï¼ˆ1ï¼‰ç¼“å­˜å±‚åœ¨åŒä¸€æ—¶é—´æœ‰å¤§é‡æ•°æ®å¤±æ•ˆï¼Œæˆ–è€… ï¼ˆ2ï¼‰Redis ç”±äºŽæŸäº›æƒ…å†µå®•æœºï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚å…¨éƒ¨è®¿é—®æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å®•æœºã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/cache-problem/1.png"
width="1080"
height="660"
srcset="https://www.letout.cn/p/redis/cache-problem/1_huab116a381b3e5ca6aaa694e3ae424f2c_109299_480x0_resize_box_3.png 480w, https://www.letout.cn/p/redis/cache-problem/1_huab116a381b3e5ca6aaa694e3ae424f2c_109299_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="392px"
>&lt;/p>
&lt;p>ðŸ’¡ è§£å†³åŠžæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ§© ç»™æ•°æ®éšæœºè®¾ç½®è¿‡æœŸæ—¶é—´&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© &lt;a class="link" href="https://www.letout.cn/p/distributed-lock/redis/" target="_blank" rel="noopener"
>äº’æ–¥é”&lt;/a>ï¼Œåªæœ‰ä¸€ä¸ªè¯·æ±‚ä¼šåˆ°æ•°æ®åº“ä¸Šï¼Œå¹¶ä¼šé‡å»ºç¼“å­˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© åŒ Key ç­–ç•¥ï¼Œæœ‰ä¸åŒçš„ Keyï¼Œä½†æœ‰ç›¸åŒçš„ Value&lt;/p>
&lt;ul>
&lt;li>ä¸» Keyï¼šè®¾ç½®è¿‡æœŸæ—¶é—´&lt;/li>
&lt;li>å¤‡ Keyï¼šä¸è®¾ç½®è¿‡æœŸæ—¶é—´&lt;/li>
&lt;li>å½“ä¸» Key è¿‡æœŸåŽï¼Œå¤§é‡è¯·æ±‚åˆ°è¾¾æ—¶ç›´æŽ¥è¿”å›žå¤‡ Keyï¼Œå¹¶é€šçŸ¥åŽå°çº¿ç¨‹ï¼Œé‡å»ºä¸» Key&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© è®¾ç½® Key æ°¸ä¸è¿‡æœŸï¼ŒåŽå°æ›´æ–°ç¼“å­˜ï¼ˆå†…å­˜ä¸å¤Ÿæ—¶å¯èƒ½è¢«å†…å­˜æ·˜æ±°ç­–ç•¥æ·˜æ±°ï¼‰&lt;/p>
&lt;ul>
&lt;li>åŽå°çº¿ç¨‹å®šæ—¶æ›´æ–° æˆ– å®šæ—¶æ£€æµ‹æ˜¯å¦å¤±æ•ˆï¼Œè¿›è¡Œé‡å»º&lt;/li>
&lt;li>ä¸šåŠ¡ä¸Šå‘çŽ°è¢«æ·˜æ±°ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥é‡å»º&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ç¼“å­˜å‡»ç©¿">âš¡ ç¼“å­˜å‡»ç©¿&lt;/h2>
&lt;p>ç¼“å­˜ä¸­æŸä¸ªçƒ­ç‚¹ Key æ•°æ®è¿‡æœŸäº†ï¼Œæ­¤æ—¶æœ‰å¤§é‡è¯·æ±‚è®¿é—®è¯¥æ•°æ®ï¼Œå¯¼è¿™äº›è¯·æ±‚å…¨éƒ¨éƒ½è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå¯¼è‡´æ•°æ®åº“å®•æœºã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/cache-problem/2.png"
width="707"
height="836"
srcset="https://www.letout.cn/p/redis/cache-problem/2_hu4d851393f6ce96ed0f1e6e1059c88231_81241_480x0_resize_box_3.png 480w, https://www.letout.cn/p/redis/cache-problem/2_hu4d851393f6ce96ed0f1e6e1059c88231_81241_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="84"
data-flex-basis="202px"
>&lt;/p>
&lt;p>ðŸ’¡ è§£å†³åŠžæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ§© &lt;a class="link" href="https://www.letout.cn/p/distributed-lock/redis/" target="_blank" rel="noopener"
>äº’æ–¥é”&lt;/a>ï¼Œåªæœ‰ä¸€ä¸ªè¯·æ±‚ä¼šåˆ°æ•°æ®åº“ä¸Šï¼Œå¹¶é‡å»ºç¼“å­˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼ˆå†…å­˜ä¸å¤Ÿæ—¶å¯èƒ½è¢«å†…å­˜æ·˜æ±°ç­–ç•¥æ·˜æ±°ï¼‰ï¼ŒåŽå°çº¿ç¨‹æ›´æ–°ç¼“å­˜&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ç¼“å­˜ç©¿é€">ðŸŒªï¸ ç¼“å­˜ç©¿é€&lt;/h2>
&lt;p>è¯·æ±‚çš„æ•°æ®æ—¢ä¸å­˜åœ¨äºŽç¼“å­˜ä¸­ï¼Œä¹Ÿä¸å­˜åœ¨äºŽæ•°æ®åº“ä¸­ï¼Œæœ‰å¤§é‡è¿™æ ·çš„è¯·æ±‚ï¼Œä¸ä¼šå‘½ä¸­ç¼“å­˜ï¼Œç›´æŽ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“åŽ‹åŠ›éžå¸¸å¤§ã€‚&lt;/p>
&lt;p>å¯èƒ½æ˜¯ç”±äºŽï¼ˆ1ï¼‰ä¸šåŠ¡è¯¯æ“ä½œ æˆ– ï¼ˆ2ï¼‰é»‘å®¢çš„æ•…æ„æ”»å‡»&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/cache-problem/3.png"
width="576"
height="836"
srcset="https://www.letout.cn/p/redis/cache-problem/3_hua47220c88eca814bf161e3c4ed6c3627_76648_480x0_resize_box_3.png 480w, https://www.letout.cn/p/redis/cache-problem/3_hua47220c88eca814bf161e3c4ed6c3627_76648_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="68"
data-flex-basis="165px"
>&lt;/p>
&lt;p>ðŸ’¡ è§£å†³åŠžæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ§© ç¼“å­˜é»˜è®¤å€¼ï¼ŒåŽç»­çš„è¯·æ±‚ç›´æŽ¥è¿”å›žè¯¥é»˜è®¤å€¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå½“å¸ƒéš†è¿‡æ»¤å™¨è¿”å›ž 0 æ—¶ï¼Œè¯´æ˜Žæ•°æ®ä¸€å®šä¸åœ¨æ•°æ®åº“ä¸­&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© éžæ³•è¯·æ±‚é™åˆ¶ï¼Œåœ¨ä¸šåŠ¡å±‚åˆ¤æ–­æŸ¥è¯¢æ¡ä»¶ï¼Œå¦‚æžœæ˜¯æ¶æ„è¯·æ±‚ç›´æŽ¥æ‹’ç»&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-çƒ­ç‚¹-key-é‡å»º">ðŸ”¥ çƒ­ç‚¹ Key é‡å»º&lt;/h2>
&lt;p>å½“çƒ­ç‚¹ç¼“å­˜å¤±æ•ˆçš„çž¬é—´ï¼ŒåŽç«¯ä¼šæœ‰å¤§é‡è¯·æ±‚ï¼Œåœ¨é‡å»ºç¼“å­˜æ—¶ï¼Œä¼šé€ æˆåŽç«¯è´Ÿè½½è¿‡å¤§ï¼Œå¯¼è‡´åº”ç”¨å´©æºƒã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ’¡ ä½¿ç”¨äº’æ–¥é”&lt;/p>
&lt;ul>
&lt;li>åªå…è®¸ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…é‡å»ºç¼“å­˜çš„çº¿ç¨‹æ‰§è¡Œå®Œï¼Œæ‰èƒ½ä»Žç¼“å­˜èŽ·å–æ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ’¡ Key æ°¸ä¸è¿‡æœŸ&lt;/p>
&lt;ul>
&lt;li>åˆ©ç”¨åŽå°çº¿ç¨‹åŽ»å•ç‹¬æž„å»ºç¼“å­˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ç¼“å­˜ä¸€è‡´æ€§">ðŸŽ ç¼“å­˜ä¸€è‡´æ€§&lt;/h2>
&lt;h3 id="æ›´æ–°">æ›´æ–°&lt;/h3>
&lt;h4 id="-å…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜">âŒ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜&lt;/h4>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/cache-problem/11.png"
width="893"
height="618"
srcset="https://www.letout.cn/p/redis/cache-problem/11_hu0a23dc2cab9bf3c3bb634fe5cae7e5fa_53493_480x0_resize_box_3.png 480w, https://www.letout.cn/p/redis/cache-problem/11_hu0a23dc2cab9bf3c3bb634fe5cae7e5fa_53493_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="144"
data-flex-basis="346px"
>&lt;/p>
&lt;h4 id="-å…ˆæ›´æ–°ç¼“å­˜å†æ›´æ–°æ•°æ®åº“">âŒ å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“&lt;/h4>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/cache-problem/12.png"
width="903"
height="498"
srcset="https://www.letout.cn/p/redis/cache-problem/12_hub4cf2089e272e09419483674cc55ccc3_51215_480x0_resize_box_3.png 480w, https://www.letout.cn/p/redis/cache-problem/12_hub4cf2089e272e09419483674cc55ccc3_51215_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="435px"
>&lt;/p>
&lt;h3 id="åˆ é™¤">åˆ é™¤&lt;/h3>
&lt;h4 id="-å…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“">â“ å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“&lt;/h4>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/cache-problem/13.png"
width="903"
height="618"
srcset="https://www.letout.cn/p/redis/cache-problem/13_hu6883dd3e3299a5dfe5e375db77067d03_50514_480x0_resize_box_3.png 480w, https://www.letout.cn/p/redis/cache-problem/13_hu6883dd3e3299a5dfe5e375db77067d03_50514_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="146"
data-flex-basis="350px"
>&lt;/p>
&lt;p>å¯ä»¥è€ƒè™‘å»¶è¿ŸåŒåˆ ã€‚åœ¨æ›´æ–°å®Œæ•°æ®åº“åŽï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´å†åˆ é™¤ä¸€æ¬¡ç¼“å­˜ã€‚&lt;/p>
&lt;h4 id="-å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜">â­• å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜&lt;/h4>
&lt;p>åœ¨å®žé™…ä¸­ï¼Œå‡ºçŽ°çš„æ¦‚çŽ‡éžå¸¸ä½Žã€‚ç¼“å­˜çš„å†™å…¥è¦è¿œè¿œå¿«äºŽæ•°æ®åº“çš„å†™å…¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/cache-problem/14.png"
width="1080"
height="660"
srcset="https://www.letout.cn/p/redis/cache-problem/14_huab116a381b3e5ca6aaa694e3ae424f2c_109299_480x0_resize_box_3.png 480w, https://www.letout.cn/p/redis/cache-problem/14_huab116a381b3e5ca6aaa694e3ae424f2c_109299_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="392px"
>&lt;/p>
&lt;h3 id="å¼‚æ­¥">å¼‚æ­¥&lt;/h3>
&lt;p>é€šè¿‡ æ›´æ–° + åˆ é™¤ï¼Œæ˜¯ä¸¤ä¸ªä¸åŒçš„æ“ä½œï¼Œä¸å…·å¤‡åŽŸå­æ€§ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/p>
&lt;ul>
&lt;li>ä¸­é—´ä»¶&lt;/li>
&lt;/ul>
&lt;p>é€šè¿‡ä¸­é—´ä»¶ï¼ˆå¦‚ &lt;a class="link" href="https://github.com/alibaba/canal" target="_blank" rel="noopener"
>Canal -&amp;gt; https://github.com/alibaba/canal&lt;/a> ï¼‰è®¢é˜…æ•°æ®åº“çš„ binlogï¼Œå½“æ›´æ–°å®Œæ•°æ®åº“æ—¶ï¼Œé€šè¿‡ä¸­é—´ä»¶åŽ»åˆ é™¤ç¼“å­˜ã€‚&lt;/p>
&lt;h2 id="-å‚è€ƒ">ðŸ“• å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://xiaolincoding.com/redis/" target="_blank" rel="noopener"
>https://xiaolincoding.com/redis/&lt;/a>&lt;/li>
&lt;li>Redis å¼€å‘ä¸Žè¿ç»´&lt;/li>
&lt;/ul></description></item><item><title>Redis æŒä¹…åŒ–</title><link>https://www.letout.cn/p/redis/persistence/</link><pubDate>Fri, 06 Jan 2023 22:07:45 +0800</pubDate><guid>https://www.letout.cn/p/redis/persistence/</guid><description>&lt;img src="https://www.letout.cn/p/redis/persistence/cow.png" alt="Featured image of post Redis æŒä¹…åŒ–" />&lt;h2 id="ä¿éšœæ•°æ®ä¸ä¸¢å¤±">ä¿éšœæ•°æ®ä¸ä¸¢å¤±&lt;/h2>
&lt;p>Redis çš„è¯»å†™æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†ä¿è¯å†…å­˜ä¸­çš„æ•°æ®ä¸ä¼šä¸¢å¤±ï¼ŒRedis å®žçŽ°äº†æ•°æ®æŒä¹…åŒ–çš„æœºåˆ¶ï¼ŒæŠŠæ•°æ®å­˜å‚¨åˆ°ç£ç›˜ï¼Œè¿™æ ·åœ¨ Redis é‡å¯å°±èƒ½å¤Ÿä»Žç£ç›˜ä¸­æ¢å¤åŽŸæœ‰çš„æ•°æ®ã€‚&lt;/p>
&lt;ul>
&lt;li>RDB å¿«ç…§&lt;/li>
&lt;li>AOF æ—¥å¿—&lt;/li>
&lt;li>æ··åˆæŒä¹…åŒ–ï¼ˆ4.0+ï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="-rdb-å¿«ç…§">ðŸ“· RDB å¿«ç…§&lt;/h2>
&lt;p>RDB å¿«ç…§å°±æ˜¯è®°å½•æŸä¸€ä¸ªçž¬é—´çš„å†…å­˜æ•°æ®ï¼Œè®°å½•çš„æ˜¯å®žé™…æ•°æ®ã€‚ï¼ˆå…¨é‡å¤‡ä»½ï¼‰&lt;/p>
&lt;p>å¿«ç…§ï¼Œå°±æ˜¯è®°å½•æŸä¸€ä¸ªçž¬é—´ä¸œè¥¿ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬ç»™é£Žæ™¯æ‹ç…§æ—¶ï¼Œé‚£ä¸€ä¸ªçž¬é—´çš„ç”»é¢å’Œä¿¡æ¯å°±è®°å½•åˆ°äº†ä¸€å¼ ç…§ç‰‡ã€‚&lt;/p>
&lt;h3 id="è§¦å‘æ¡ä»¶">è§¦å‘æ¡ä»¶&lt;/h3>
&lt;h4 id="æ‰‹åŠ¨è§¦å‘">æ‰‹åŠ¨è§¦å‘&lt;/h4>
&lt;ul>
&lt;li>saveï¼ˆé˜»å¡žä¸»çº¿ç¨‹ï¼‰&lt;/li>
&lt;li>bgsave&lt;/li>
&lt;/ul>
&lt;h4 id="è¢«åŠ¨è§¦å‘">è¢«åŠ¨è§¦å‘&lt;/h4>
&lt;ul>
&lt;li>æ ¹æ®é…ç½®æ–‡ä»¶é€‰é¡¹æ¯éš”ä¸€æ®µæ—¶é—´è§¦å‘ä¸€æ¬¡ bgsave&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 300 ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è‡³å°‘æ‰§è¡Œäº† 10 æ¬¡æ“ä½œ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">save 300 10
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>ä»ŽèŠ‚ç‚¹æ‰§è¡Œå…¨é‡å¤åˆ¶æ“ä½œï¼Œä¸»èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ‰§è¡Œ bgsave æ–‡ä»¶å‘é€ç»™ä»ŽèŠ‚ç‚¹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ shutdown å‘½ä»¤ï¼Œæ²¡æœ‰å¼€å¯ AOF æŒä¹…åŒ–åŠŸèƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œ bgsave&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å®žçŽ°æ–¹å¼">å®žçŽ°æ–¹å¼&lt;/h3>
&lt;p>æ‰§è¡Œ bgsave å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ fork() åˆ›å»ºå­è¿›ç¨‹ï¼Œå¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Œæ­¤æ—¶å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å…±äº«åŒä¸€ç‰‡å†…å­˜æ•°æ®ï¼Œbgsave å­è¿›ç¨‹ä¼šæŠŠè¯¥å‰¯æœ¬æ•°æ®å†™å…¥ RDB æ–‡ä»¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/persistence/cow.png"
width="969"
height="707"
srcset="https://www.letout.cn/p/redis/persistence/cow_huef7edcdd3c38f136e9d4b420711ff934_42621_480x0_resize_box_3.png 480w, https://www.letout.cn/p/redis/persistence/cow_huef7edcdd3c38f136e9d4b420711ff934_42621_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="137"
data-flex-basis="328px"
>&lt;/p>
&lt;p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒRedis ä¾ç„¶å¯ä»¥ç»§ç»­å¤„ç†æ“ä½œå‘½ä»¤ï¼Œå¦‚æžœçˆ¶è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œï¼Œå…³é”®çš„æŠ€æœ¯å°±åœ¨äºŽå†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼ˆCopy-On-Write, COWï¼‰ï¼Œè¢«ä¿®æ”¹çš„æ•°æ®ä¼šå¤åˆ¶ä¸€ä»½å‰¯æœ¬ã€‚ï¼ˆRDB å¿«ç…§ä¿å­˜çš„æ˜¯åŽŸæœ¬çš„å†…å­˜æ•°æ®ï¼‰&lt;/p>
&lt;h2 id="-aof-æ—¥å¿—">ðŸ“ƒ AOF æ—¥å¿—&lt;/h2>
&lt;p>Redis åœ¨æ‰§è¡Œå®Œä¸€æ¡å‘½ä»¤åŽï¼Œä¼šæŠŠè¯¥å‘½ä»¤ä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼ˆä¼šå…ˆå†™åˆ°ç¼“å†²åŒºï¼Œé€‰æ‹©åˆé€‚çš„åˆ·ç›˜æ—¶é—´æ‰ä¼šåˆ°ç£ç›˜ä¸­ï¼‰ã€‚&lt;/p>
&lt;p>å½“ Redis é‡å¯æ—¶ï¼Œä¼šè¯»å– AOF æ—¥å¿—çš„å†…å®¹ï¼Œç„¶åŽé€ä¸€æ‰§è¡Œè¿›è¡Œæ•°æ®æ¢å¤ã€‚&lt;/p>
&lt;h3 id="åŽå†™æ—¥å¿—">åŽå†™æ—¥å¿—&lt;/h3>
&lt;p>Reids æ˜¯å…ˆæ‰§è¡Œå†™æ“ä½œå‘½ä»¤åŽï¼Œæ‰å°†è¯¥å‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—é‡Œã€‚&lt;/p>
&lt;ul>
&lt;li>ä¼˜ç‚¹
&lt;ul>
&lt;li>é¿å…é¢å¤–çš„æ£€æŸ¥å‘½ä»¤çš„å¼€é”€&lt;/li>
&lt;li>å†™æ—¥å¿—çš„æ“ä½œä¸ä¼šé˜»å¡žå½“å‰å‘½ä»¤çš„æ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç¼ºç‚¹
&lt;ul>
&lt;li>æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ã€‚åœ¨æ²¡æœ‰å†™åˆ°å†…å­˜ä¸­æ—¶ï¼Œå‘ç”Ÿå®•æœºï¼Œæœ‰ä¸¢å¤±æ•°æ®çš„é£Žé™©&lt;/li>
&lt;li>å¯èƒ½é˜»å¡žåŽç»­çš„æ“ä½œã€‚æ‰§è¡Œå‘½ä»¤å’Œå†™ AOF æ—¥å¿—éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå½“æŠŠæ—¥å¿—å†™å…¥åˆ°ç£ç›˜æ—¶ï¼Œä¼šé˜»å¡žåŽç»­çš„æ“ä½œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="å†™å›žç­–ç•¥">å†™å›žç­–ç•¥&lt;/h3>
&lt;p>Redis æ‰§è¡Œå®Œå†™æ“ä½œå‘½ä»¤åŽï¼Œä¼šå°†å‘½ä»¤è¿½åŠ åˆ° server.aof_buf ç¼“å†²åŒºï¼Œä»€ä¹ˆæ—¶å€™å†™å›žåˆ°ç£ç›˜ï¼Œç”±é…ç½®å†³å®šã€‚&lt;/p>
&lt;p>Redis.conf å¯é…ç½®å‚æ•° &lt;code>appendfsync&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Always&lt;/p>
&lt;ul>
&lt;li>æ¯æ¬¡éƒ½å†™å›ž&lt;/li>
&lt;li>å¯é æ€§é«˜ï¼Œæœ€å¤§ç¨‹åº¦ä¼šä¿è¯æ•°æ®ä¸ä¸¢å¤±&lt;/li>
&lt;li>æ¯ä¸ªå‘½ä»¤éƒ½è¦å†™å›žç¡¬ç›˜ï¼Œæ€§èƒ½å¼€é”€å¤§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Everysec&lt;/p>
&lt;ul>
&lt;li>æ¯ç§’å†™å›ž&lt;/li>
&lt;li>å®•æœºæ—¶ä¼šä¸¢å¤± 1s å†…çš„æ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>No&lt;/p>
&lt;ul>
&lt;li>ç”±æ“ä½œç³»ç»Ÿå†³å®šå†™å›žæ—¶æœº&lt;/li>
&lt;li>å®•æœºæ—¶å¯èƒ½ä¼šä¸¢å¤±å¾ˆå¤šæ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="aof-é‡å†™">AOF é‡å†™&lt;/h3>
&lt;p>AOF æ—¥å¿—æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œéšç€æ‰§è¡Œçš„å†™æ“ä½œå‘½ä»¤è¶Šæ¥è¶Šå¤šï¼Œæ–‡ä»¶çš„å¤§å°ä¼šè¶Šæ¥è¶Šå¤§ã€‚ å¦‚æžœå½“ AOF æ—¥å¿—æ–‡ä»¶è¿‡å¤§å°±ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚é‡å¯ Redis åŽï¼Œéœ€è¦è¯» AOF æ–‡ä»¶çš„å†…å®¹ä»¥æ¢å¤æ•°æ®ï¼Œå¦‚æžœæ–‡ä»¶è¿‡å¤§ï¼Œæ•´ä¸ªæ¢å¤çš„è¿‡ç¨‹å°±ä¼šå¾ˆæ…¢ã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å… AOF æ–‡ä»¶è¶Šå†™è¶Šå¤§ï¼Œæä¾›äº† AOF é‡å†™æœºåˆ¶ï¼Œå½“ AOF æ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼åŽï¼ŒRedis å°±ä¼šå¯ç”¨ AOF é‡å†™æœºåˆ¶ï¼Œæ¥åŽ‹ç¼© AOF æ–‡ä»¶ã€‚&lt;/p>
&lt;p>AOF é‡å†™æ—¶ï¼Œä¼šè¯»å–æ•°æ®åº“ä¸­æ‰€æœ‰çš„é”®å€¼å¯¹ï¼Œç„¶åŽå°†æ¯ä¸€ä¸ªé”®å€¼å¯¹ç”¨ä¸€æ¡å†™å‘½ä»¤è®°å½•åˆ° æ–°çš„ AOF æ–‡ä»¶ä¸­ï¼Œç­‰åˆ°å…¨éƒ¨è®°å½•å®Œä¹‹åŽï¼Œå°±å°†æ–°çš„æ–‡ä»¶æ›¿æ¢æŽ‰æ—§çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;h4 id="å®žçŽ°æ–¹å¼-1">å®žçŽ°æ–¹å¼&lt;/h4>
&lt;p>é€šè¿‡ fork åŽå°å­è¿›ç¨‹å®Œæˆã€‚ä½¿ç”¨ COW æŠ€æœ¯ï¼Œå…±äº«ç‰©ç†å†…å­˜ã€‚&lt;/p>
&lt;p>åœ¨é‡å†™æœŸé—´ï¼Œä¾æ—§å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œå†™å‘½ä»¤ä¼šåŒæ—¶ä¿å­˜åœ¨ï¼ˆ1ï¼‰AOF ç¼“å­˜åŒº å’Œ ï¼ˆ2ï¼‰AOF é‡å†™ç¼“å­˜åŒºã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/persistence/aof.png"
width="940"
height="1014"
srcset="https://www.letout.cn/p/redis/persistence/aof_huf07c02c53918ac63e75c29803edc1708_212356_480x0_resize_box_3.png 480w, https://www.letout.cn/p/redis/persistence/aof_huf07c02c53918ac63e75c29803edc1708_212356_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="92"
data-flex-basis="222px"
>&lt;/p>
&lt;p>æ‰§è¡Œå®Œæˆä¹‹åŽï¼Œå°† AOF é‡å†™ç¼“å­˜åŒºçš„å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶æ›¿æ¢æ—§çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;h2 id="-æ··åˆæŒä¹…åŒ–">ðŸ—ƒï¸ æ··åˆæŒä¹…åŒ–&lt;/h2>
&lt;p>æ··åˆæŒä¹…åŒ–å·¥ä½œåœ¨ AOF æ—¥å¿—é‡å†™è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>å½“å¼€å¯äº†æ··åˆæŒä¹…åŒ–æ—¶ï¼Œåœ¨ AOF é‡å†™æ—¥å¿—æ—¶ï¼Œ&lt;/p>
&lt;ul>
&lt;li>fork å‡ºæ¥çš„é‡å†™å­è¿›ç¨‹ä¼šå…ˆå°†ä¸Žä¸»çº¿ç¨‹å…±äº«çš„å†…å­˜æ•°æ®ä»¥ RDB æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œ&lt;/li>
&lt;li>ä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ä¼šè¢«è®°å½•åœ¨é‡å†™ç¼“å†²åŒºé‡Œï¼Œé‡å†™ç¼“å†²åŒºé‡Œçš„å¢žé‡å‘½ä»¤ä¼šä»¥ AOF æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œ&lt;/li>
&lt;li>å†™å…¥å®ŒæˆåŽé€šçŸ¥ä¸»è¿›ç¨‹å°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/persistence/mix.jpg"
width="325"
height="356"
srcset="https://www.letout.cn/p/redis/persistence/mix_huce3a57336b77bba5760b97f3c77136cb_10330_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/redis/persistence/mix_huce3a57336b77bba5760b97f3c77136cb_10330_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="91"
data-flex-basis="219px"
>&lt;/p>
&lt;p>ä½¿ç”¨äº†æ··åˆæŒä¹…åŒ–ï¼ŒAOF æ–‡ä»¶çš„å‰åŠéƒ¨åˆ†æ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒåŽåŠéƒ¨åˆ†æ˜¯ AOF æ ¼å¼çš„å¢žé‡æ•°æ®ã€‚&lt;/p></description></item><item><title>ä»£ç†æ¨¡å¼</title><link>https://www.letout.cn/p/design-pattern/proxy/</link><pubDate>Thu, 05 Jan 2023 20:02:02 +0800</pubDate><guid>https://www.letout.cn/p/design-pattern/proxy/</guid><description>&lt;img src="https://www.letout.cn/p/design-pattern/proxy/proxy.png" alt="Featured image of post ä»£ç†æ¨¡å¼" />&lt;h2 id="-ä»‹ç»">ðŸ“– ä»‹ç»&lt;/h2>
&lt;p>ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§&lt;strong>ç»“æž„åž‹æ¨¡å¼&lt;/strong>ã€‚&lt;/p>
&lt;p>ä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†æ–¹ä¾¿è®¿é—®æŸäº›èµ„æºï¼Œä½¿å¯¹è±¡ç±»æ›´åŠ æ˜“ç”¨ã€‚ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†æŽ§åˆ¶è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚&lt;/p>
&lt;p>å¸¸è§çš„åœºæ™¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ”– ä¹°ç«è½¦ç¥¨ä¸ä¸€å®šè¦åŽ»ç«è½¦ç«™ï¼Œä¹Ÿå¯ä»¥åŽ»ä»£å”®ç‚¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”– Windows ä¸­çš„å¿«æ·æ–¹å¼ï¼ŒLinux ä¸­çš„è½¯é“¾æŽ¥ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”– Spring AOPã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”– å¸¸è§çš„ ORM æ¡†æž¶ï¼Œåªè¦å®šä¹‰ç›¸å…³çš„æŽ¥å£ï¼Œè€Œä¸éœ€è¦å†™å®žçŽ°ç±»ï¼Œå°±å¯ä»¥å¯¹ XML æˆ–æ³¨è§£ä¸­çš„ SQL è¯­å¥è¿›è¡Œå¢žåˆ æ”¹æŸ¥æ“ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”– ä¸€äº›ä¸­é—´ä»¶å¦‚ RPC æ¡†æž¶ï¼Œåœ¨æ‹¿åˆ° jar åŒ…ä¸­å¯¹æŽ¥å£çš„æè¿°åŽï¼Œä¸­é—´ä»¶ä¼šå­—æœåŠ¡å¯åŠ¨æ—¶ï¼Œç”Ÿæˆå¯¹åº”çš„ä»£ç†ç±»ã€‚å½“è°ƒç”¨æŽ¥å£æ—¶ï¼Œå®žé™…ä¸Šæ˜¯é€šè¿‡ä»£ç†ç±»å‘å‡ºçš„ Socket ä¿¡æ¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-å®žçŽ°æ–¹å¼">ðŸŽˆ å®žçŽ°æ–¹å¼&lt;/h2>
&lt;p>&lt;img src="https://www.letout.cn/p/design-pattern/proxy/structure.png"
width="1319"
height="630"
srcset="https://www.letout.cn/p/design-pattern/proxy/structure_hu34461378bd86a4cce257496a3fe5af00_116540_480x0_resize_box_3.png 480w, https://www.letout.cn/p/design-pattern/proxy/structure_hu34461378bd86a4cce257496a3fe5af00_116540_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="209"
data-flex-basis="502px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŽ—ï¸ æ–¹æ³•ï¼ˆ1ï¼‰ï¼šæŠ½å–æŽ¥å£ï¼Œä»£ç†å¯¹è±¡å’ŒæœåŠ¡å¯¹è±¡å®žçŽ°åŒä¸€ä¸ªæŽ¥å£ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ æ–¹æ³•ï¼ˆ2ï¼‰ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µéƒ½èƒ½æŠ½å–æŽ¥å£ï¼ˆå¦‚ä»£ç æ”¹åŠ¨å¾ˆå¤§ã€ä¸èƒ½ä¿®æ”¹æœåŠ¡ç±»ï¼‰ï¼Œå¯ä»¥å°†ä»£ç†ç±»ä½œä¸ºæœåŠ¡ç±»çš„å­ç±»ï¼Œè®©ä»£ç†ç±»ç»§æ‰¿æœåŠ¡ç±»çš„æ‰€æœ‰æŽ¥å£ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ åˆ›å»ºä»£ç†ç±»ï¼Œä»£ç†ç±»ä¸­å¿…é¡»åŒ…å«ä¸€ä¸ªæœåŠ¡ç±»çš„æˆå‘˜å˜é‡ï¼Œè´Ÿè´£æœåŠ¡ç±»çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚ï¼ˆå¯é€šè¿‡æž„é€ å‡½æ•°ä¼ å…¥ï¼Œæˆ–åœ¨å†…éƒ¨åˆ›å»ºï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ æ ¹æ®éœ€æ±‚å®žçŽ°ä»£ç†æ–¹æ³•ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä»£ç†æ–¹æ³•ä¼šè°ƒç”¨æœåŠ¡å¯¹è±¡çš„åŒåæ–¹æ³•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ðŸš¦ å¯è€ƒè™‘è®¾è®¡é€‰é¡¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æž„å»ºä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºŽå®¢æˆ·ç«¯åˆ¤æ–­èŽ·å¾—çš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œè¿˜æ˜¯å®žé™…æœåŠ¡å¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»£ç†å¯¹è±¡ä¸­æœåŠ¡å¯¹è±¡å¯ä»¥è€ƒè™‘å»¶è¿Ÿåˆå§‹åŒ–ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-java-ä¸­çš„åŠ¨æ€ä»£ç†">â˜• Java ä¸­çš„åŠ¨æ€ä»£ç†&lt;/h2>
&lt;p>åœ¨ Java æ ‡å‡†åº“ä¸­ï¼Œæä¾›äº†åŠ¨æ€ä»£ç†åŠŸèƒ½ï¼Œå…è®¸åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºä¸€ä¸ªæŽ¥å£çš„å®žä¾‹ã€‚å…¶å®žå°±æ˜¯ JVM åœ¨è¿è¡ŒæœŸé—´ï¼ŒåŠ¨æ€åˆ›å»º class å­—èŠ‚ç å¹¶åŠ è½½çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>åŠ¨æ€ä»£ç†é€šè¿‡ &lt;code>Proxy&lt;/code> åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œç„¶åŽå°†æŽ¥å£æ–¹æ³•â€œä»£ç†â€ç»™ &lt;code>InvocationHandler&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">InvocationHandler&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Object proxy -&amp;gt; ä»£ç†çš„å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Method method -&amp;gt; æ­£åœ¨è°ƒç”¨çš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Object[] args -&amp;gt; æ–¹æ³•çš„å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">proxy&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Method&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">Throwable&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Proxy
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">newProxyInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ClassLoader&lt;/span> &lt;span class="n">loader&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;[]&lt;/span> &lt;span class="n">interfaces&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">InvocationHandler&lt;/span> &lt;span class="n">h&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IllegalArgumentException&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨è¿è¡ŒæœŸé—´åˆ›å»ºä¸€ä¸ª &lt;code>interface&lt;/code> å®žä¾‹çš„æ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å®šä¹‰ä¸€ä¸ª &lt;code>InvocationHandler&lt;/code> å®žä¾‹ï¼Œè´Ÿè´£å®žçŽ°æŽ¥å£çš„æ–¹æ³•è°ƒç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€šè¿‡ &lt;code>Proxy.newProxyInstance()&lt;/code> åˆ›å»º &lt;code>interface&lt;/code> å®žä¾‹&lt;/p>
&lt;ul>
&lt;li>&lt;code>ClassLoader loader&lt;/code> ç±»åŠ è½½å™¨ï¼ˆå¦‚å½“å‰ç±»çš„ç±»åŠ è½½å™¨ï¼š&lt;code>CurrentProxy.class.getClassLoader()&lt;/code>ï¼‰&lt;/li>
&lt;li>&lt;code>Class&amp;lt;?&amp;gt;[] interfaces&lt;/code> éœ€è¦å®žçŽ°çš„æŽ¥å£çš„æ•°ç»„ï¼ˆä»£ç†çš„å¯¹è±¡æ˜¯å®žçŽ°äº†å“ªä¸ªæŽ¥å£ï¼‰&lt;/li>
&lt;li>&lt;code>InvocationHandler h&lt;/code> ç”¨æ¥å¤„ç†æŽ¥å£æ–¹æ³•è°ƒç”¨çš„ &lt;code>InvocationHandler&lt;/code> å®žä¾‹ï¼ˆç”Ÿæˆçš„ä»£ç†å¯¹è±¡ä¸­çš„ä»£ç†æ–¹æ³•ï¼Œéœ€è¦åšä»€ä¹ˆï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>è¿”å›žä¸€ä¸ª &lt;code>Object&lt;/code>ï¼Œå¯å¼ºåˆ¶è½¬åž‹ä¸ºæŽ¥å£ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ¨¡æ‹Ÿç»çºªäººä»£ç†æ­Œæ‰‹çš„åœºæ™¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æŽ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">Star&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">class&lt;/span> &lt;span class="n">Eason&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Star&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// éœ€è¦è¢«ä»£ç†çš„ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ProxyDemo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Star&lt;/span> &lt;span class="nf">createProxy&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Star&lt;/span> &lt;span class="n">star&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// åˆ›å»ºä»£ç†å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Star&lt;/span> &lt;span class="n">starProxy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Star&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">Proxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newProxyInstance&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ProxyDemo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getClassLoader&lt;/span>&lt;span class="o">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">[]{&lt;/span>&lt;span class="n">Star&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">InvocationHandler&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">proxy&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Method&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">Throwable&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ä»£ç†æ–¹æ³•éœ€è¦åšçš„äº‹æƒ…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// æŽ’é™¤ Object ä¸­çš„é€šç”¨æ–¹æ³•ï¼Œä¸è¿›è¡Œä»£ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaringClass&lt;/span>&lt;span class="o">()))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">methodName&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">methodName&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;sing&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">star&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">methodName&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;dance&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">starProxy&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-é€‚åˆåœºæ™¯">ðŸŽ² é€‚åˆåœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>ðŸŽ¨ å»¶è¿Ÿåˆå§‹åŒ–ã€‚å°†å¯¹è±¡çš„åˆå§‹åŒ–å»¶è¿Ÿåˆ°çœŸæ­£æœ‰éœ€è¦çš„æ—¶å€™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ¨ è®¿é—®æŽ§åˆ¶ã€‚ä»£ç†å¯ä»…åœ¨å®¢æˆ·ç«¯å‡­æ®æ»¡è¶³è¦æ±‚æ—¶å°†è¯·æ±‚ä¼ é€’ç»™æœåŠ¡å¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ¨ æœ¬åœ°æ‰§è¡Œè¿œç¨‹æœåŠ¡ ï¼ˆè¿œç¨‹ä»£ç†ï¼‰ã€‚é€‚ç”¨äºŽæœåŠ¡å¯¹è±¡ä½äºŽè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æƒ…å½¢ã€‚ä»£ç†é€šè¿‡ç½‘ç»œä¼ é€’å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰ä¸Žç½‘ç»œç›¸å…³çš„å¤æ‚ç»†èŠ‚ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ¨ è®°å½•æ—¥å¿—è¯·æ±‚ï¼ˆæ—¥å¿—è®°å½•ä»£ç†ï¼‰ã€‚å¦‚éœ€è¦ä¿å­˜å¯¹äºŽæœåŠ¡å¯¹è±¡çš„è¯·æ±‚åŽ†å²è®°å½•æ—¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ¨ ç¼“å­˜è¯·æ±‚ç»“æžœï¼ˆç¼“å­˜ä»£ç†ï¼‰ã€‚ å¦‚å¯å¯¹é‡å¤è¯·æ±‚æ‰€éœ€çš„ç›¸åŒç»“æžœè¿›è¡Œç¼“å­˜ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-å‚è€ƒ">ðŸ”— å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://refactoringguru.cn/design-patterns/proxy" target="_blank" rel="noopener"
>https://refactoringguru.cn/design-patterns/proxy&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://bugstack.cn/md/develop/design-pattern/2020-06-16-%E9%87%8D%E5%AD%A6%20Java%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8A%E5%AE%9E%E6%88%98%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E3%80%8B.html" target="_blank" rel="noopener"
>https://bugstack.cn/md/develop/design-pattern/2020-06-16-%E9%87%8D%E5%AD%A6%20Java%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8A%E5%AE%9E%E6%88%98%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E3%80%8B.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.runoob.com/design-pattern/proxy-pattern.html" target="_blank" rel="noopener"
>https://www.runoob.com/design-pattern/proxy-pattern.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.liaoxuefeng.com/wiki/1252599548343744/1264804593397984" target="_blank" rel="noopener"
>https://www.liaoxuefeng.com/wiki/1252599548343744/1264804593397984&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>MySQL åˆ†åº“åˆ†è¡¨</title><link>https://www.letout.cn/p/mysql/split-database-and-table/</link><pubDate>Thu, 05 Jan 2023 17:02:02 +0800</pubDate><guid>https://www.letout.cn/p/mysql/split-database-and-table/</guid><description>&lt;img src="https://www.letout.cn/imgs/2.jpeg" alt="Featured image of post MySQL åˆ†åº“åˆ†è¡¨" />&lt;h2 id="åŽŸå› ">åŽŸå› &lt;/h2>
&lt;p>éšç€äº’è”ç½‘çš„å‘å±•å’Œç”¨æˆ·è§„æ¨¡çš„è¿…é€Ÿæ‰©å¤§ï¼Œå¯¹ç³»ç»Ÿçš„è¦æ±‚ä¹Ÿè¶Šæ¥è¶Šé«˜ã€‚ä¼ ç»Ÿçš„ MySQL å•åº“å•è¡¨æž¶æž„çš„æ€§èƒ½é—®é¢˜å°±æš´éœ²å‡ºæ¥äº†ã€‚ä¸‹é¢å‡ ä¸ªå› ç´ ä¼šå½±å“æ•°æ®åº“æ€§èƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ•°æ®é‡&lt;/p>
&lt;p>MySQL å•åº“æ•°æ®é‡åœ¨ 5000w ä»¥å†…æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œè¶…è¿‡é˜ˆå€¼åŽæ€§èƒ½ä¼šéšç€æ•°æ®é‡çš„å¢žå¤§è€Œå˜å¼±ã€‚&lt;/p>
&lt;p>MySQL å•è¡¨æ•°æ®é‡æ˜¯ 500w-1000w ä¹‹é—´æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œè¶…è¿‡ 1000w æ€§èƒ½ä¹Ÿä¼šä¸‹é™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç£ç›˜&lt;/p>
&lt;p>å•ä¸ªæœåŠ¡çš„ç£ç›˜ç©ºé—´æ˜¯æœ‰é™åˆ¶çš„ï¼Œå¦‚æžœå¹¶å‘åŽ‹åŠ›ä¸‹ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½è®¿é—®åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œè‚¯å®šä¼šå¯¹ç£ç›˜ IO é€ æˆéžå¸¸å¤§çš„å½±å“ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ•°æ®åº“è¿žæŽ¥&lt;/p>
&lt;p>æ•°æ®åº“è¿žæŽ¥æ˜¯éžå¸¸ç¨€å°‘çš„èµ„æºï¼Œå¦‚æžœä¸€ä¸ªåº“é‡Œæ—¢æœ‰ç”¨æˆ·ã€å•†å“ã€è®¢å•ç›¸å…³çš„æ•°æ®ï¼Œå½“æµ·é‡ç”¨æˆ·åŒæ—¶æ“ä½œæ—¶ï¼Œæ•°æ®åº“è¿žæŽ¥å°±å¾ˆå¯èƒ½æˆä¸ºç“¶é¢ˆã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-åž‚ç›´æ‹†åˆ†">ðŸŸ åž‚ç›´æ‹†åˆ†&lt;/h2>
&lt;p>å½“æˆ‘ä»¬å•ä¸ªåº“å¤ªå¤§æ—¶ï¼Œå¦‚æžœè¡¨çš„æ•°é‡å¤ªå¤šï¼Œåˆ™åº”è¯¥å°†éƒ¨åˆ†è¡¨è¿›è¡Œè¿ç§»ï¼ˆå¦‚æŒ‰ä¸šåŠ¡åŒºåˆ†ï¼‰ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„åž‚ç›´åˆ‡åˆ†ã€‚&lt;/p>
&lt;h3 id="-åž‚ç›´åˆ†åº“">ðŸ  åž‚ç›´åˆ†åº“&lt;/h3>
&lt;p>é’ˆå¯¹ä¸€ä¸ªç³»ç»Ÿä¸­çš„ä¸åŒä¸šåŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œæ¯”å¦‚ç”¨æˆ·ç›¸å…³çš„ä¸€ä¸ªåº“ï¼Œå•†å“ç›¸å…³çš„ä¸€ä¸ªåº“ï¼Œè®¢å•ç›¸å…³çš„ä¸€ä¸ªåº“ã€‚&lt;/p>
&lt;p>åž‚ç›´åˆ†åº“åŽå°†ç”¨æˆ·ã€å•†å“ã€è®¢å•æ”¾åˆ°å¤šä¸ªä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä¸ä¼šé¢ä¸´å•æœºèµ„æºé—®é¢˜ã€‚è¿™ç§åšæ³•ä¸Žâ€œå¾®æœåŠ¡æ²»ç†â€çš„åšæ³•ç›¸ä¼¼ï¼Œæ¯ä¸ªå¾®æœåŠ¡ä½¿ç”¨å•ç‹¬çš„ä¸€ä¸ªæ•°æ®åº“ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/split-database-and-table/1.png"
width="889"
height="437"
srcset="https://www.letout.cn/p/mysql/split-database-and-table/1_hu17247372b6a63b568197ee6dd608ce2e_127169_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/split-database-and-table/1_hu17247372b6a63b568197ee6dd608ce2e_127169_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="203"
data-flex-basis="488px"
>&lt;/p>
&lt;h3 id="-åž‚ç›´åˆ†è¡¨">ðŸ¡ åž‚ç›´åˆ†è¡¨&lt;/h3>
&lt;p>åŸºäºŽåˆ—å­—æ®µè¿›è¡Œçš„ï¼Œâ€œå¤§è¡¨æ‹†å°è¡¨â€ã€‚&lt;/p>
&lt;p>ä¸€èˆ¬æ˜¯è¡¨ä¸­çš„å­—æ®µè¾ƒå¤šï¼Œå°†ä¸å¸¸ç”¨çš„ï¼Œæ•°æ®è¾ƒå¤§ï¼Œé•¿åº¦è¾ƒé•¿ï¼ˆæ¯”å¦‚textç±»åž‹å­—æ®µï¼‰çš„å­—æ®µæ•°æ®æ‹†åˆ†åˆ°â€œæ‰©å±•è¡¨â€œã€‚&lt;/p>
&lt;p>é’ˆå¯¹é‚£ç§å‡ ç™¾åˆ—çš„å¤§è¡¨ï¼Œä¹Ÿé¿å…æŸ¥è¯¢æ—¶ï¼Œæ•°æ®é‡å¤ªå¤§é€ æˆçš„â€œè·¨é¡µâ€é—®é¢˜ã€‚&lt;/p>
&lt;p>MySQL åº•å±‚æ˜¯é€šè¿‡æ•°æ®é¡µå­˜å‚¨çš„ï¼Œä¸€æ¡è®°å½•å ç”¨ç©ºé—´è¿‡å¤§ä¼šå¯¼è‡´è·¨é¡µï¼Œé€ æˆé¢å¤–çš„æ€§èƒ½å¼€é”€ï¼ˆIOæ“ä½œå˜å¤šï¼‰ã€‚&lt;/p>
&lt;p>æ•°æ®ä¹Ÿæ˜¯ä»¥é¡µä¸ºå•ä½åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œé¡µä¸­å­˜å‚¨çš„æ˜¯è¡Œæ•°æ®ï¼Œå¤§å°å›ºå®šï¼Œä¸€è¡Œæ•°æ®å ç”¨ç©ºé—´è¶Šå°ï¼Œé¡µä¸­å­˜å‚¨çš„è¡Œæ•°æ®ä¹Ÿå°±è¶Šå¤šã€‚è¿™æ ·è¡¨ä¸­å­—æ®µé•¿åº¦è¾ƒçŸ­ä¸”è®¿é—®é¢‘çŽ‡è¾ƒé«˜ï¼Œå†…å­˜ä¸­èƒ½åŠ è½½æ›´å¤šçš„æ•°æ®ï¼Œå‘½ä¸­çŽ‡æ›´é«˜ï¼Œå‡å°‘äº†ç£ç›˜IOï¼Œä»Žè€Œæå‡äº†æ•°æ®åº“æ€§èƒ½ã€‚&lt;/p>
&lt;h3 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ä¼˜ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>è§£å†³ä¸šåŠ¡ç³»ç»Ÿå±‚é¢çš„è€¦åˆï¼Œä¸šåŠ¡æ¸…æ™°&lt;/li>
&lt;li>èƒ½å¯¹ä¸åŒä¸šåŠ¡çš„æ•°æ®è¿›è¡Œåˆ†çº§ç®¡ç†ã€ç»´æŠ¤ã€ç›‘æŽ§ã€æ‰©å±•ç­‰&lt;/li>
&lt;li>é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œèƒ½æå‡ä¸€å®šçš„ç£ç›˜ IOï¼Œæ•°æ®åº“è¿žæŽ¥æ•°ï¼Œå•æœºç¡¬ä»¶èµ„æºçš„ç“¶é¢ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>éƒ¨åˆ†è¡¨æ— æ³• join&lt;/li>
&lt;li>åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†å¤æ‚&lt;/li>
&lt;li>è¿˜æ˜¯å­˜åœ¨å•è¡¨æ•°æ®é‡è¿‡å¤§çš„é—®é¢˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-æ°´å¹³æ‹†åˆ†">ðŸ¥ æ°´å¹³æ‹†åˆ†&lt;/h2>
&lt;p>å¦‚æžœæ•°æ®é‡è¡Œæ•°å·¨å¤§ï¼Œå­˜åœ¨å•åº“è¯»å†™ã€å­˜å‚¨æ€§èƒ½ç“¶é¢ˆï¼Œè¿™æ—¶å€™å°±éœ€è¦è¿›è¡Œæ°´å¹³åˆ‡åˆ†äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/split-database-and-table/2.png"
width="809"
height="829"
srcset="https://www.letout.cn/p/mysql/split-database-and-table/2_hu072f01b90be7eeb74f86b6073661bd2d_308676_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/split-database-and-table/2_hu072f01b90be7eeb74f86b6073661bd2d_308676_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="97"
data-flex-basis="234px"
>&lt;/p>
&lt;h3 id="-æ°´å¹³åº“å†…åˆ†è¡¨">ðŸ¤ æ°´å¹³åº“å†…åˆ†è¡¨&lt;/h3>
&lt;p>æ°´å¹³åˆ†è¡¨æ˜¯åŸºäºŽå…¨è¡¨çš„ï¼Œå°†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®æ‹†åˆ†åˆ°å¤šä¸ªè¡¨ä¸­ï¼Œå¯ä»¥å¤§å¤§å‡å°‘å•è¡¨æ•°æ®é‡ï¼Œæå‡æŸ¥è¯¢æ•ˆçŽ‡ã€‚&lt;/p>
&lt;p>åº“å†…åˆ†è¡¨åªæ˜¯è§£å†³äº†å•ä¸€è¡¨æ•°æ®é‡è¿‡å¤§çš„é—®é¢˜ï¼Œæ²¡æœ‰å°†è¡¨åˆ†å¸ƒåˆ°ä¸åŒæœºå™¨çš„åº“ä¸Šï¼Œå¯¹äºŽå‡è½» MySQL æ•°æ®åº“çš„åŽ‹åŠ›æ¥è¯´ï¼Œå¸®åŠ©ä¸æ˜¯å¾ˆå¤§ï¼Œè¿˜æ˜¯ç«žäº‰åŒä¸€ä¸ªç‰©ç†æœºçš„èµ„æºã€‚&lt;/p>
&lt;h3 id="-æ°´å¹³åˆ†åº“åˆ†è¡¨">ðŸ£ æ°´å¹³åˆ†åº“åˆ†è¡¨&lt;/h3>
&lt;p>å°†å•å¼ è¡¨çš„æ•°æ®åˆ‡åˆ†åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸ŠåŽ»ï¼Œæ¯ä¸ªæœåŠ¡å™¨å…·æœ‰ç›¸åŒçš„åº“ä¸Žè¡¨ï¼Œä½†æ˜¯è¡¨ä¸­çš„æ•°æ®ä¸åŒã€‚&lt;/p>
&lt;p>æ°´å¹³åˆ†åº“åˆ†è¡¨èƒ½å¤Ÿæœ‰æ•ˆçš„ç¼“è§£å•æœºå’Œå•åº“çš„æ€§èƒ½ç“¶é¢ˆå’ŒåŽ‹åŠ›ï¼Œçªç ´IOã€è¿žæŽ¥æ•°ã€ç¡¬ä»¶èµ„æºç­‰çš„ç“¶é¢ˆã€‚&lt;/p>
&lt;h3 id="ä¼˜ç¼ºç‚¹-1">ä¼˜ç¼ºç‚¹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ä¼˜ç‚¹&lt;/p>
&lt;ul>
&lt;li>ä¸å­˜åœ¨å•åº“æ•°æ®é‡è¿‡å¤§ï¼Œé«˜å¹¶å‘çš„æ€§èƒ½ç“¶é¢ˆï¼Œæå‡ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œè´Ÿè½½èƒ½åŠ›&lt;/li>
&lt;li>åº”ç”¨ç«¯æ”¹é€ è¾ƒå°ï¼Œä¸éœ€è¦æ‹†åˆ†ä¸šåŠ¡æ¨¡å—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç¼ºç‚¹&lt;/p>
&lt;ul>
&lt;li>è·¨åˆ†ç‰‡çš„äº‹åŠ¡ä¸€è‡´æ€§éš¾ä»¥ä¿è¯&lt;/li>
&lt;li>è·¨åº“çš„ join å…³è”æŸ¥è¯¢æ€§èƒ½è¾ƒå·®&lt;/li>
&lt;li>æ•°æ®å¤šæ¬¡æ‰©å±•éš¾åº¦å’Œç»´æŠ¤é‡æžå¤§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="å¸¸è§åˆ†åº“åˆ†è¡¨çš„ç­–ç•¥">å¸¸è§åˆ†åº“åˆ†è¡¨çš„ç­–ç•¥&lt;/h2>
&lt;h3 id="-æ ¹æ®æ•°å€¼èŒƒå›´åˆ’åˆ†">ðŸ”¢ æ ¹æ®æ•°å€¼èŒƒå›´åˆ’åˆ†&lt;/h3>
&lt;p>æŒ‰ç…§æ—¶é—´åŒºé—´æˆ– ID åŒºé—´è¿›è¡ŒåŒºåˆ†ã€‚å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸ§© æŒ‰æ—¥æœŸå°†ä¸åŒæœˆæˆ–ä¸åŒæ—¥çš„åˆ†æ•£åˆ°ä¸åŒåº“ä¸­&lt;/li>
&lt;li>ðŸ§© æ ¹æ® id åˆ†ï¼Œå°† [0, 1000000] åˆ†åˆ°ç¬¬ä¸€ä¸ªåº“ï¼Œ[1000001, 2000000] åˆ†åˆ°ç¬¬äºŒä¸ªåº“&lt;/li>
&lt;li>ðŸ§© â€œå†·çƒ­æ•°æ®åˆ†ç¦»â€ï¼Œä¸€äº›ä½¿ç”¨è¾ƒå°‘çš„åŽ†å²æ•°æ®è¿ç§»åˆ°å…¶ä»–åº“ä¸­ï¼Œä¸šåŠ¡åŠŸèƒ½ä¸Šåªæä¾›çƒ­ç‚¹æ•°æ®çš„æŸ¥è¯¢&lt;/li>
&lt;/ul>
&lt;p>ä¼˜ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å•è¡¨å¤§å°å¯æŽ§&lt;/li>
&lt;li>å¤©ç„¶ä¾¿äºŽæ°´å¹³æ‰©å±•ï¼Œæ‰©å®¹åªéœ€è¦æ·»åŠ èŠ‚ç‚¹ï¼Œæ— éœ€å¯¹å…¶ä»–åˆ†ç‰‡æ•°æ®è¿›è¡Œè¿ç§»&lt;/li>
&lt;li>åœ¨èŒƒå›´æŸ¥æ‰¾æ—¶ï¼Œè¿žç»­åˆ†ç‰‡å¯ä»¥å¿«é€Ÿè¿›è¡Œå®šä½æŸ¥è¯¢&lt;/li>
&lt;/ul>
&lt;p>ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>çƒ­ç‚¹æ•°æ®æˆä¸ºç“¶é¢ˆã€‚è¿žç»­åˆ†ç‰‡å¯èƒ½å­˜åœ¨çƒ­ç‚¹æ•°æ®ï¼Œå¦‚æŒ‰æ—¶é—´åˆ†ç‰‡æ—¶ï¼Œæœ‰äº›æœ€è¿‘æ—¶é—´çš„åˆ†ç‰‡ä¼šè¢«é¢‘ç¹è¯»å–ï¼Œæœ‰äº›åŽ†å²åˆ†ç‰‡ä¼šå¾ˆå°‘æŸ¥è¯¢&lt;/li>
&lt;/ul>
&lt;h3 id="-æ ¹æ®æ•°å€¼å–æ¨¡">ðŸ§® æ ¹æ®æ•°å€¼å–æ¨¡&lt;/h3>
&lt;p>ä¸€èˆ¬é‡‡ç”¨ hash å–æ¨¡çš„åˆ†ç‰‡æ–¹å¼ã€‚&lt;/p>
&lt;p>å¦‚æ ¹æ®ç”¨æˆ· user_no å­—æ®µå–ä½™ï¼ˆæ ¹æ®æ•°æ®åº“çš„æ•°é‡å–ä½™ï¼‰ï¼Œä½™æ•°ä¸º 0 æ”¾åˆ°ç¬¬ä¸€ä¸ªåº“ï¼Œä½™æ•°ä¸º 1 æ”¾åˆ°ç¬¬äºŒä¸ªåº“ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ï¼ˆåŒä¸€ä¸ªç”¨æˆ·ä¼šå®šä½åˆ°ç›¸åŒçš„æ•°æ®åº“ï¼‰&lt;/p>
&lt;p>ä¼˜ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°æ®åˆ†ç‰‡ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå‡åŒ€ï¼Œä¸å®¹æ˜“å‡ºçŽ°çƒ­ç‚¹å’Œå¹¶å‘è®¿é—®çš„ç“¶é¢ˆã€‚&lt;/li>
&lt;/ul>
&lt;p>ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>åŽæœŸåˆ†ç‰‡æ‰©å®¹æ—¶ï¼Œéœ€è¦è¿ç§»æ—§æ•°æ®ï¼ˆä½¿ç”¨ä¸€è‡´æ€§ hash ç®—æ³•èƒ½è¾ƒå¥½é¿å…ï¼‰&lt;/li>
&lt;li>å®¹æ˜“é‡åˆ°åˆ†ç‰‡æŸ¥è¯¢å¤æ‚é—®é¢˜ï¼Œå¦‚é€šè¿‡ user_no è¿›è¡Œçš„åˆ†åº“åˆ†è¡¨ï¼Œå¦‚æžœæœ‰å¤šæ•°æŸ¥è¯¢æ¡ä»¶ä¸­ä¸åŒ…å« user_no å­—æ®µï¼Œå°±æ— æ³•å®šä½æ•°æ®åº“ï¼Œéœ€è¦åœ¨æ‰€æœ‰çš„æ•°æ®åº“å‘èµ·æŸ¥è¯¢&lt;/li>
&lt;/ul>
&lt;h3 id="-æ ¹æ®åœ°ç†ä½ç½®">ðŸŒ æ ¹æ®åœ°ç†ä½ç½®&lt;/h3>
&lt;p>æ ¹æ®åœ°ç†ä½ç½®ï¼Œå°†ç›¸åŒåœ°åŒºçš„æ”¾åˆ°ä¸€å¼ è¡¨ä¸­ã€‚å¦‚ï¼šåŽå—åŒºä¸€ä¸ªè¡¨ï¼ŒåŽåŒ—åŒºä¸€ä¸ªè¡¨ã€‚&lt;/p>
&lt;h2 id="å¸¸è§åˆ†åº“åˆ†è¡¨çš„é—®é¢˜">å¸¸è§åˆ†åº“åˆ†è¡¨çš„é—®é¢˜&lt;/h2>
&lt;h3 id="äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜">äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>åˆ†å¸ƒå¼äº‹åŠ¡&lt;/p>
&lt;p>åˆ†å¸ƒå¼äº‹åŠ¡èƒ½æœ€å¤§é™åº¦ä¿è¯äº†æ•°æ®åº“æ“ä½œçš„åŽŸå­æ€§ã€‚&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­é—´ä»¶&lt;/li>
&lt;li>ä½¿ç”¨ MySQL è‡ªå¸¦çš„é’ˆå¯¹è·¨åº“çš„äº‹åŠ¡ä¸€è‡´æ€§æ–¹æ¡ˆï¼ˆXAï¼‰ï¼Œæ€§èƒ½è¦æ¯”å•åº“çš„æ…¢ 10 å€å·¦å³ã€‚&lt;/li>
&lt;li>åœ¨ä¸šåŠ¡ä¸Šï¼Œé¿å…è·¨åº“æ“ä½œï¼ˆå¦‚å°†ç”¨æˆ·å’Œå•†å“æ”¾åˆ°åŒä¸€ä¸ªåº“ä¸­ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æœ€ç»ˆä¸€è‡´æ€§&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¸è‹›æ±‚ç³»ç»Ÿçš„å®žæ—¶ä¸€è‡´æ€§ï¼Œåªè¦åœ¨å…è®¸çš„æ—¶é—´æ®µå†…è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§å³å¯ï¼Œå¯é‡‡ç”¨äº‹åŠ¡è¡¥å¿çš„æ–¹å¼ã€‚&lt;/p>
&lt;p>äº‹åŠ¡è¡¥å¿æ˜¯ä¸€ç§äº‹åŽæ£€æŸ¥è¡¥æ•‘çš„æŽªæ–½ï¼Œä¸€äº›å¸¸è§çš„å®žçŽ°æ–¹æ³•æœ‰ï¼šå¯¹æ•°æ®è¿›è¡Œå¯¹è´¦æ£€æŸ¥ï¼ŒåŸºäºŽæ—¥å¿—è¿›è¡Œå¯¹æ¯”ï¼Œå®šæœŸåŒæ ‡å‡†æ•°æ®æ¥æºè¿›è¡ŒåŒæ­¥ç­‰ç­‰ã€‚&lt;/p>
&lt;h3 id="è·¨èŠ‚ç‚¹å…³è”æŸ¥è¯¢-join-é—®é¢˜">è·¨èŠ‚ç‚¹å…³è”æŸ¥è¯¢ join é—®é¢˜&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>å¤šæ¬¡æŸ¥è¯¢è¿›è¡Œæ•°æ®ç»„è£…&lt;/p>
&lt;p>åœ¨ç³»ç»Ÿå±‚é¢ï¼Œåˆ†ä¸¤æ¬¡æŸ¥è¯¢ï¼Œæœ€åŽå°†èŽ·å¾—åˆ°çš„æ•°æ®è¿›è¡Œå­—æ®µæ‹¼è£…ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;ul>
&lt;li>
&lt;p>æ·»åŠ å†—ä½™å­—æ®µ&lt;/p>
&lt;p>ä¸€ç§å…¸åž‹çš„åèŒƒå¼è®¾è®¡ï¼Œåˆ©ç”¨ç©ºé—´æ¢æ—¶é—´ï¼Œä¸ºäº†æ€§èƒ½è€Œé¿å… join æŸ¥è¯¢ã€‚&lt;/p>
&lt;p>ä½†è¿™ç§æ–¹æ³•é€‚ç”¨åœºæ™¯æœ‰é™ï¼Œé€‚ç”¨äºŽä¾èµ–å­—æ®µæ¯”è¾ƒå°‘çš„æƒ…å†µã€‚è€Œå†—ä½™å­—æ®µçš„æ•°æ®ä¸€è‡´æ€§ä¹Ÿè¾ƒéš¾ä¿è¯ï¼Œè¦ç»“åˆå®žé™…ä¸šåŠ¡åœºæ™¯è¿›è¡Œè€ƒè™‘ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;h3 id="è·¨èŠ‚ç‚¹åˆ†é¡µæŽ’åºå‡½æ•°é—®é¢˜">è·¨èŠ‚ç‚¹åˆ†é¡µã€æŽ’åºã€å‡½æ•°é—®é¢˜&lt;/h3>
&lt;p>å…ˆåœ¨ä¸åŒçš„åˆ†ç‰‡èŠ‚ç‚¹ä¸­å°†æ•°æ®è¿›è¡Œæ“ä½œï¼Œåœ¨æœåŠ¡å±‚è¿›è¡Œæ±‡æ€»æ“ä½œï¼Œæœ€ç»ˆè¿”å›žç»™ç”¨æˆ·ã€‚&lt;/p>
&lt;h3 id="ä¸»é”®é—®é¢˜">ä¸»é”®é—®é¢˜&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>UUIDï¼ˆä¸æŽ¨èï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨ Redis ç”Ÿæˆä¸»é”®ï¼ˆincr æ—¶è‡ªå¢žçš„åŽŸå­å‘½ä»¤ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨ Zookeeper ç”Ÿæˆå”¯ä¸€ ID&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é›ªèŠ±ç®—æ³•ç”Ÿæˆ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç™¾åº¦ uidgenerator&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¾Žå›¢ Leaf&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ»´æ»´ TinyID&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ•°æ®è¿ç§»æ‰©å®¹é—®é¢˜">æ•°æ®è¿ç§»ï¼Œæ‰©å®¹é—®é¢˜&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>å¦‚æžœé‡‡ç”¨æ•°å€¼èŒƒå›´åˆ†ç‰‡ï¼Œåªéœ€è¦æ·»åŠ èŠ‚ç‚¹å°±å¯ä»¥è¿›è¡Œæ‰©å®¹äº†ï¼Œä¸éœ€è¦å¯¹åˆ†ç‰‡æ•°æ®è¿ç§»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æžœé‡‡ç”¨çš„æ˜¯æ•°å€¼å–æ¨¡åˆ†ç‰‡ï¼Œé’ˆå¯¹æ•°æ®é‡çš„é€’å¢žï¼Œå¯èƒ½éœ€è¦åŠ¨æ€çš„å¢žåŠ è¡¨ï¼Œå› ä¸ºreHashæœ‰å¯èƒ½å¯¼è‡´æ•°æ®è¿ç§»é—®é¢˜ï¼Œåˆ™è€ƒè™‘åŽæœŸçš„æ‰©å®¹é—®é¢˜å°±ç›¸å¯¹æ¯”è¾ƒéº»çƒ¦ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="è€ƒè™‘åˆ‡åˆ†çš„æƒ…å†µ">è€ƒè™‘åˆ‡åˆ†çš„æƒ…å†µ&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>èƒ½ä¸åˆ‡åˆ†å°±å°½é‡ä¸è¦åˆ‡åˆ†&lt;/p>
&lt;p>ä¸åˆ°ä¸‡ä¸å¾—å·²ä¸ç”¨è½»æ˜“ä½¿ç”¨åˆ†åº“åˆ†è¡¨è¿™ä¸ªå¤§æ‹›ï¼Œé¿å…&amp;quot;è¿‡åº¦è®¾è®¡&amp;quot;å’Œ&amp;quot;è¿‡æ—©ä¼˜åŒ–&amp;quot;ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ•°æ®é‡è¿‡å¤§ï¼Œæ­£å¸¸è¿ç»´å½±å“ä¸šåŠ¡è®¿é—®&lt;/p>
&lt;ul>
&lt;li>å¯¹æ•°æ®åº“å¤‡ä»½ï¼Œå¦‚æžœå•è¡¨å¤ªå¤§ï¼Œå¤‡ä»½æ—¶éœ€è¦å¤§é‡çš„ç£ç›˜ IO å’Œç½‘ç»œ IO&lt;/li>
&lt;li>å¯¹ä¸€ä¸ªå¾ˆå¤§çš„è¡¨è¿›è¡Œ DDL ä¿®æ”¹æ—¶ï¼ŒMySQLä¼šé”ä½å…¨è¡¨ï¼Œè¿™ä¸ªæ—¶é—´ä¼šå¾ˆé•¿ï¼Œè¿™æ®µæ—¶é—´ä¸šåŠ¡ä¸èƒ½è®¿é—®æ­¤è¡¨ï¼Œå½±å“å¾ˆå¤§&lt;/li>
&lt;li>å¤§è¡¨ä¼šç»å¸¸è®¿é—®ä¸Žæ›´æ–°ï¼Œå°±æ›´æœ‰å¯èƒ½å‡ºçŽ°é”ç­‰å¾…&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>éšç€ä¸šåŠ¡å‘å±•ï¼Œæ•°æ®é‡å¿«é€Ÿå¢žé•¿&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®‰å…¨æ€§å’Œå¯ç”¨æ€§&lt;/p>
&lt;ul>
&lt;li>åˆ©ç”¨åž‚ç›´åˆ‡åˆ†ï¼Œä¸€ä¸ªæ•°æ®åº“å‡ºçŽ°é—®é¢˜ï¼Œåªä¼šå½±å“åˆ°éƒ¨åˆ†ä¸šåŠ¡ï¼Œä¸ä¼šä½¿æ‰€æœ‰çš„ä¸šåŠ¡éƒ½ç˜«ç—ªã€‚&lt;/li>
&lt;li>åˆ©ç”¨æ°´å¹³åˆ‡åˆ†ï¼Œå½“ä¸€ä¸ªæ•°æ®åº“å‡ºçŽ°é—®é¢˜æ—¶ï¼Œä¸ä¼šå½±å“åˆ°100%çš„ç”¨æˆ·ï¼Œæ¯ä¸ªåº“åªæ‰¿æ‹…ä¸šåŠ¡çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œè¿™æ ·æ•´ä½“çš„å¯ç”¨æ€§å°±èƒ½æé«˜ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="å¸¸è§åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶">å¸¸è§åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>sharding-jdbc&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MyCat&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://blog.nowcoder.net/n/4309986033e64155a8c836959faf01b8" target="_blank" rel="noopener"
>https://blog.nowcoder.net/n/4309986033e64155a8c836959faf01b8&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>åŠ¨æ‰‹ç»´ä¿®ç½—æŠ€é¼ æ ‡ ðŸ¤­</title><link>https://www.letout.cn/p/fix-logi-mouse/</link><pubDate>Sat, 12 Nov 2022 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/fix-logi-mouse/</guid><description>&lt;img src="https://www.letout.cn/p/fix-logi-mouse/05.png" alt="Featured image of post åŠ¨æ‰‹ç»´ä¿®ç½—æŠ€é¼ æ ‡ ðŸ¤­" />&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>ä¹‹å‰é¼ æŒ‰é”®ä¸€ç›´ä¸çµï¼Œç»å¸¸éœ€è¦æŒ‰å¾ˆå¤šä¸‹ï¼Œæ¢äº†ç”µæ± ä¹‹åŽè¿˜æ˜¯è¿™æ ·ï¼Œç½‘ä¸Šä¸€æœï¼Œç«Ÿç„¶æ˜¯è¿™é¼ æ ‡çš„é€šç—… ðŸ˜“ã€‚çœ‹åˆ°å¾ˆå¤šæ•™æ€Žä¹ˆæ¢é¼ æ ‡å¾®åŠ¨çš„ï¼Œå°±æ‰“ç®—è‡ªå·±è¯•è¯•äº†ã€‚ðŸ˜¤&lt;/p>
&lt;h2 id="-å·¥å…·å‡†å¤‡">ðŸ› ï¸ å·¥å…·å‡†å¤‡&lt;/h2>
&lt;p>æ·˜å®éšä¾¿ä¹°ç„ŠæŽ¥å·¥å…·ä¸€å¥—ï¼š&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/fix-logi-mouse/07.png"
width="747"
height="666"
srcset="https://www.letout.cn/p/fix-logi-mouse/07_hu230206bcd028f2628d907e1698990dc3_223298_480x0_resize_box_3.png 480w, https://www.letout.cn/p/fix-logi-mouse/07_hu230206bcd028f2628d907e1698990dc3_223298_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="112"
data-flex-basis="269px"
>&lt;/p>
&lt;p>ç›¸åŒçš„é¼ æ ‡å¾®åŠ¨ï¼šè¿™ä¸ªä¸è¦ä¹°é”™äº†ï¼Œæ³¨æ„é«˜åº¦ï¼æˆ‘è¿™ä¸ªæ˜¯é»„çš„é‚£ä¸ªï¼Œçœ‹åˆ°ç½‘ä¸ŠåŒæ¬¾æœ‰äº›æ—¶çº¢è‰²çš„ï¼Œå¦‚æžœæ˜¯æ–°æ‰‹æŽ¨èå¤šä¹°å‡ ä¸ªï¼Œä¸å°å¿ƒå¼„åäº†è¿˜å¯æœ‰å¤‡ç”¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/fix-logi-mouse/06.png"
width="740"
height="927"
srcset="https://www.letout.cn/p/fix-logi-mouse/06_hu112ba3385e7e0151f22fcae72c4b4ae4_291824_480x0_resize_box_3.png 480w, https://www.letout.cn/p/fix-logi-mouse/06_hu112ba3385e7e0151f22fcae72c4b4ae4_291824_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="79"
data-flex-basis="191px"
>&lt;/p>
&lt;h3 id="æŽ¨è">æŽ¨è&lt;/h3>
&lt;p>åŠ©ç„Šå‰‚å¯é€‰çš„è¯ï¼Œå®‰åˆ©ä¹°ç„Šæ²¹ðŸ™‹â€è€Œä¸æ˜¯æ¾é¦™ðŸ™…â€ï¼Œæ„Ÿè§‰æ¾ä¸‹è¿™ä¸œè¥¿ä¸é€‚åˆæ–°æ‰‹ç”¨ï¼Œå¾ˆä¸æ–¹ä¾¿æ„Ÿè§‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/fix-logi-mouse/02.png"
width="1219"
height="661"
srcset="https://www.letout.cn/p/fix-logi-mouse/02_hu75550ba33c3ffe7db7aa5f7ae7029655_945321_480x0_resize_box_3.png 480w, https://www.letout.cn/p/fix-logi-mouse/02_hu75550ba33c3ffe7db7aa5f7ae7029655_945321_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="442px"
>&lt;/p>
&lt;h2 id="-è¿‡ç¨‹">ðŸ“š è¿‡ç¨‹&lt;/h2>
&lt;p>æ‹†å¼€è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œåªè¦æŠŠä¸¤é¢—çœ‹å¾—è§çš„èžºä¸å¸æŽ‰ï¼Œå°±å¯ä»¥æŠŠå¤–å£³ç»™å¼€äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/fix-logi-mouse/01.png"
width="766"
height="893"
srcset="https://www.letout.cn/p/fix-logi-mouse/01_hu53453d44ceb54b6652dae9a441b1db5e_780198_480x0_resize_box_3.png 480w, https://www.letout.cn/p/fix-logi-mouse/01_hu53453d44ceb54b6652dae9a441b1db5e_780198_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="85"
data-flex-basis="205px"
>&lt;/p>
&lt;p>åªè¦æŠŠè¿™ä¸¤ä¸ªåœ°æ–¹çš„ç„Šé”¡ç†”åŒ–ï¼Œå°±å¯ä»¥æŠŠæ—§çš„æ‹†ä¸‹æ¥ï¼Œæ¢å¾®åŠ¨å•¦ã€‚ðŸ˜²&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/fix-logi-mouse/03.png"
width="1261"
height="873"
srcset="https://www.letout.cn/p/fix-logi-mouse/03_huaca2ffe580913d2e122e0dd5797f45d4_1319425_480x0_resize_box_3.png 480w, https://www.letout.cn/p/fix-logi-mouse/03_huaca2ffe580913d2e122e0dd5797f45d4_1319425_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="144"
data-flex-basis="346px"
>&lt;/p>
&lt;p>å·¥åŽ‚é‡Œé¢éƒ½æ˜¯ä½¿ç”¨çš„é«˜æ¸©ç„Šé”¡ï¼Œç›´æŽ¥ç”¨ç”µçƒ™é“æ˜¯ä¸èƒ½æŠŠä¸Šé¢çš„ç„Šé”¡ç»™ç›´æŽ¥èžåŒ–çš„ï¼Œâš  å…ˆåŠ ä¸Šä¸€ç‚¹åŠ©ç„Šå‰‚ï¼ˆé‡è¦ï¼ï¼‰ï¼Œ&lt;strong>å†å¾€ä¸ŠåŠ ç„Šä¸€ç‚¹è‡ªå·±ç„Šé”¡&lt;/strong>ï¼Œå°±å¯ä»¥èžåŒ–ä¸Šé¢çš„é«˜æ¸©é”¡äº†ï¼ˆæ„Ÿè§‰æœ‰ç‚¹åƒç›¸ä¼¼ç›¸æº¶ï¼‰ã€‚&lt;/p>
&lt;p>è¿™æ—¶å€™å°±éœ€è¦ç­‰é”¡çƒæ˜¯æ¶²ä½“çš„æ—¶å€™ï¼Œç”¨å¸é”¡æžªæŠŠæ¶²ä½“çš„é”¡çƒç»™å¸æŽ‰ã€‚æˆ‘çš„å¸é”¡æžªä¸çŸ¥é“è¢«ä»€ä¹ˆåŽ‹ç¢Žäº†ï¼Œç”¨å¸é”¡å¸¦æ”¾åˆ°ç”µçƒ™é“ä¸Šæ‹–ä¸€éä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¾ˆç®€å•ï¼Œéšä¾¿åœ¨ç½‘ä¸Šæ‰¾ä¸€ä¸ªç»´ä¿®è§†é¢‘çœ‹çœ‹å°±ä¼šäº†ï¼Œå¸çš„å¾ˆå¹²å‡€ï¼&lt;/p>
&lt;h2 id="-ç»“æžœ">ðŸ’¡ ç»“æžœ&lt;/h2>
&lt;p>æœ€åŽæ¢èµ·æ¥è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼ŒæŠŠæ–°çš„æ’è¿›åŽ»ï¼Œå†ç”¨ç”µçƒ™é“ç„Šä¸ŠåŽ»ä¸¤ç‚¹é”¡ï¼Œå°±å›ºå®šçš„å¾ˆå¥½äº†ã€‚ðŸ‘&lt;/p>
&lt;p>å“ˆå“ˆï¼Œç¬¬ä¸€æ¬¡ç„ŠæŽ¥ï¼Œçœ‹èµ·æ¥æ•ˆæžœéžå¸¸å¥½ã€‚ðŸ˜€&lt;/p>
&lt;p>ä¸»æ¿çœ‹èµ·æ¥æœ‰ç‚¹è„ï¼Œæ²¡æœ‰æ´—ç‰ˆæ°´æ´—ä¸»æ¿ï¼Œå…¶å®žæ²¡æœ‰å½±å“ï¼Œä¸æ´—ä¹Ÿä¸ä¼šå½±å“ç”µæ°”æ€§èƒ½ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/fix-logi-mouse/04.png"
width="1212"
height="800"
srcset="https://www.letout.cn/p/fix-logi-mouse/04_hud083438dbea24b69dfd6acee6b76afad_1328794_480x0_resize_box_3.png 480w, https://www.letout.cn/p/fix-logi-mouse/04_hud083438dbea24b69dfd6acee6b76afad_1328794_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="151"
data-flex-basis="363px"
>&lt;/p>
&lt;p>æœ€åŽå°±æ˜¯è¿™ä¸ªçƒ™é“ï¼Œç«Ÿç„¶ç”¨å‡ ä¸‹å°±å˜å¾—è¿™ä¹ˆè„äº†ã€‚ðŸ˜‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/fix-logi-mouse/05.png"
width="1546"
height="910"
srcset="https://www.letout.cn/p/fix-logi-mouse/05_hu6e2e43df522d586c0a61d755538e45f9_1576731_480x0_resize_box_3.png 480w, https://www.letout.cn/p/fix-logi-mouse/05_hu6e2e43df522d586c0a61d755538e45f9_1576731_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="169"
data-flex-basis="407px"
>&lt;/p></description></item><item><title>ThreadLocal</title><link>https://www.letout.cn/p/thread/threadlocal/</link><pubDate>Fri, 02 Sep 2022 16:02:02 +0800</pubDate><guid>https://www.letout.cn/p/thread/threadlocal/</guid><description>&lt;img src="https://www.letout.cn/imgs/19.jpeg" alt="Featured image of post ThreadLocal" />&lt;h2 id="javalangthreadlocal">java.lang.ThreadLocal&lt;/h2>
&lt;p>ThreadLocal æ˜¯ä¸€ä¸ªåˆ›å»ºçº¿ç¨‹å±€éƒ¨å˜é‡çš„ç±»ã€‚&lt;/p>
&lt;p>é€šå¸¸åˆ›å»ºçš„å…±äº«å˜é‡æ˜¯å¯ä»¥è¢«ä»»ä¸€ä¸ªçº¿ç¨‹è®¿é—®å¹¶ä¿®æ”¹çš„ï¼Œå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä½¿ç”¨ ThreadLocal åˆ›å»ºçš„å˜é‡åªæœ‰å½“å‰çº¿ç¨‹æ‰å¯è®¿é—®ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•ä¿®æ”¹å’Œè®¿é—®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">DateUtils&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">DateFormat&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡å†™ initialValue å¯è®¾ç½®åˆå§‹å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">protected&lt;/span> &lt;span class="n">DateFormat&lt;/span> &lt;span class="nf">initialValue&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SimpleDateFormat&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;yyyy-MM-dd&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DateUtils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">format&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">Date&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åŽŸç†">åŽŸç†&lt;/h2>
&lt;p>æ¯ä¸€ä¸ªçº¿ç¨‹çš„ Thread å¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ª &lt;code>ThreadLocal.ThreadLocalMap&lt;/code> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å­˜å‚¨äº†ä¸€ç»„ä»¥ &lt;code>ThreadLocal.threadLocalHashCode&lt;/code> ä¸ºé”®ï¼Œä»¥æœ¬åœ°çº¿ç¨‹å˜é‡ä¸ºå€¼çš„ &lt;code>Key-Value&lt;/code> å¯¹ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/thread/threadlocal/threadlocalmap.png"
width="561"
height="327"
srcset="https://www.letout.cn/p/thread/threadlocal/threadlocalmap_hu2f3b0d366a0f121060908fa4912e4768_16111_480x0_resize_box_3.png 480w, https://www.letout.cn/p/thread/threadlocal/threadlocalmap_hu2f3b0d366a0f121060908fa4912e4768_16111_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="threadlocalmap"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="411px"
>&lt;/p>
&lt;p>&lt;code>ThreadLocal&lt;/code> å¯¹è±¡å°±æ˜¯å½“å‰çº¿ç¨‹çš„ &lt;code>ThreadLocalMap&lt;/code> çš„è®¿é—®å…¥å£ï¼Œæ¯ä¸€ä¸ª &lt;code>ThreadLocal&lt;/code> å¯¹è±¡éƒ½åŒ…å«äº†ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ &lt;code>threadLocalHashCode&lt;/code> å€¼ï¼Œä½¿ç”¨è¿™ä¸ªå€¼ï¼Œå°±å¯ä»¥åœ¨çº¿ç¨‹ &lt;code>K-V&lt;/code> å€¼å¯¹ä¸­æ‰¾åˆ°å¯¹åº”çš„æœ¬åœ°çº¿ç¨‹å˜é‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Thread&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ThreadLocalMap&lt;/span> &lt;span class="n">threadLocals&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ThreadLocalMap&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Entry&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">WeakReference&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Enrty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">super&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">Enrty&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">table&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="set">set()&lt;/h3>
&lt;ul>
&lt;li>èŽ·å–å½“å‰çº¿ç¨‹&lt;/li>
&lt;li>åˆ©ç”¨å½“å‰çº¿ç¨‹ä½œä¸ºå¥æŸ„ï¼ŒèŽ·å–ä¸€ä¸ª ThreadLocalMap å¯¹è±¡&lt;/li>
&lt;li>å¦‚æžœ ThreadLocalMap å¯¹è±¡ä¸ä¸ºç©ºï¼Œåˆ™è®¾ç½®å€¼ï¼Œå¦åˆ™åˆ›å»ºè¿™ä¸ª ThreadLocalMap å¯¹è±¡å¹¶è®¾ç½®å€¼&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">T&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadLocalMap&lt;/span> &lt;span class="n">map&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">createMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">ThreadLocalMap&lt;/span> &lt;span class="nf">getMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">threadLocals&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="nf">createMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="n">firstValue&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">t&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">threadLocals&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadLocalMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">firstValue&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="get">get()&lt;/h3>
&lt;ul>
&lt;li>èŽ·å–å½“å‰çº¿ç¨‹ï¼Œå¹¶èŽ·å–å½“å‰çº¿ç¨‹çš„ ThreadLocalMap å¯¹è±¡&lt;/li>
&lt;li>å¦‚æžœå½“å‰çº¿ç¨‹çš„ ThreadLocalMap å·²ç»åˆå§‹åŒ–ï¼Œè¿”å›žå½“å‰ ThreadLocal ä¸º Key çš„å€¼&lt;/li>
&lt;li>å¦‚æžœ ThreadLocalMap æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œæˆ–è€…ä¸å­˜åœ¨ä»¥ ThreadLocal ä¸º Key çš„å€¼ï¼Œå°†åˆ›å»ºä¸€ä¸ªæ–°çš„ Valueï¼Œå¹¶è¿”å›ž&lt;/li>
&lt;li>initialValue é»˜è®¤ä¸º nullï¼Œå¯è¿›è¡Œé‡å†™&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ThreadLocal#get
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="nf">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadLocalMap&lt;/span> &lt;span class="n">map&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadLocalMap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getEntry&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@SuppressWarnings&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;unchecked&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">T&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">)&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">setInitialValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ThreadLocal#setInitialValue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">private&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="nf">setInitialValue&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">T&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">initialValue&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// èŽ·å¾—ä¸€ä¸ªåˆå§‹å€¼ï¼Œæœªé‡å†™é»˜è®¤ä¸º null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadLocalMap&lt;/span> &lt;span class="n">map&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">createMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ThreadLocal#initialValue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">protected&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="nf">initialValue&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// é»˜è®¤ä¸º nullï¼Œå¯è¢«é‡å†™
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ThreadLocalMap#createMap
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="nf">createMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="n">firstValue&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">t&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">threadLocals&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadLocalMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">firstValue&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="remove">remove()&lt;/h3>
&lt;ul>
&lt;li>é€šè¿‡è°ƒç”¨ ThreadLocalMap çš„ remove() æ–¹æ³•å®Œæˆç§»é™¤æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">remove&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadLocalMap&lt;/span> &lt;span class="n">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">m&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ThreadLocalMap remove()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">remove&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Entry&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">tab&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">table&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">threadLocalHashCode&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Entry&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tab&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tab&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nextIndex&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">len&lt;/span>&lt;span class="o">)])&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">clear&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">expungeStaleEntry&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å†…å­˜æ³„éœ²">å†…å­˜æ³„éœ²&lt;/h2>
&lt;p>æŒ‡ç¨‹åºç”³è¯·å†…å­˜åŽï¼Œä¸€ç›´æ— æ³•é‡Šæ”¾å·²ç»ç”³è¯·çš„å†…å­˜ã€‚&lt;/p>
&lt;p>ThreadLocalMap ä½¿ç”¨ ThreadLocal çš„å¼±å¼•ç”¨ä½œä¸º keyï¼Œå¦‚æžœä¸€ä¸ª ThreadLocal ä¸å­˜åœ¨å¤–éƒ¨çš„å¼ºå¼•ç”¨æ—¶ï¼Œä¸‹æ¬¡ GC æ—¶ï¼Œè¯¥ key å°±ä¼šè¢«å›žæ”¶ï¼Œä½†æ˜¯ value è¿˜å­˜åœ¨ç€å¼ºå¼•ç”¨ï¼Œå¦‚æžœæ²¡æœ‰æ‰‹åŠ¨åœ° remove() æˆ–è€…çº¿ç¨‹ä¸€ç›´æ²¡æœ‰ç»“æŸï¼ˆä¾‹å¦‚ä½¿ç”¨çº¿ç¨‹æ± ï¼‰ï¼Œvalue å°±ä¼šä¸€ç›´å­˜åœ¨ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/thread/threadlocal/threadlocal.png"
width="691"
height="425"
srcset="https://www.letout.cn/p/thread/threadlocal/threadlocal_hu332fd7c00cd887225a3bcbd94cc1cc52_26526_480x0_resize_box_3.png 480w, https://www.letout.cn/p/thread/threadlocal/threadlocal_hu332fd7c00cd887225a3bcbd94cc1cc52_26526_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="threadlocal"
class="gallery-image"
data-flex-grow="162"
data-flex-basis="390px"
>&lt;/p>
&lt;p>è§£å†³åŠžæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ¯æ¬¡ä½¿ç”¨å®ŒåŽè¿›è¡Œ remove()&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨ set()ã€get() æ—¶ï¼ˆéƒ¨åˆ†ï¼‰ï¼Œæ‰©å®¹ rehash() æ—¶ï¼ˆå…¨é‡ï¼‰ï¼Œä¼šåˆ¤æ–­å¯¹ key=null çš„è¿›è¡Œæ¸…ç†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ä»¥å°† ThreadLocal è®¾ç½®ä¸º staic final&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">rehash&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è¿›è¡Œå…¨é‡æ¸…ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">expungeStaleEntries&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">size&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">threshold&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">threshold&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resize&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">expungeStaleEntries&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Entry&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">tab&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">table&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">len&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Entry&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tab&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">expungeStaleEntry&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>çº¿ç¨‹èµ„æºæŒæœ‰ï¼Œä»£æ›¿å‚æ•°æ˜¾ç¤ºä¼ é€’&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…¨å±€å­˜å‚¨ä¿¡æ¯ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹ç›´æŽ¥èŽ·å–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œè¾¾åˆ°çº¿ç¨‹éš”ç¦»&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>ðŸ”— &lt;a class="link" href="https://www.cnblogs.com/crazymakercircle/p/14491965.html#autoid-h2-2-0-0" target="_blank" rel="noopener"
>https://www.cnblogs.com/crazymakercircle/p/14491965.html#autoid-h2-2-0-0&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>è¿ç§»åšå®¢åˆ° Webify</title><link>https://www.letout.cn/p/hugo-in-webify/</link><pubDate>Mon, 22 Aug 2022 18:14:45 +0800</pubDate><guid>https://www.letout.cn/p/hugo-in-webify/</guid><description>&lt;img src="https://www.letout.cn/imgs/1.jpeg" alt="Featured image of post è¿ç§»åšå®¢åˆ° Webify" />&lt;h2 id="èµ·å› ">èµ·å› &lt;/h2>
&lt;p>ä¹‹å‰åšå®¢éƒ½éƒ¨ç½²åœ¨è…¾è®¯äº‘çš„ CloudBaseï¼Œä»¥æŒ‰é‡æ”¶è´¹çš„æ–¹å¼ï¼Œæ¯ä¸ªæœˆéƒ½æœ‰ä¸€äº›å…è´¹çš„æµç¨‹å’Œ CDNï¼Œæˆ‘çš„åšå®¢å®Œå…¨ç”¨ä¸å®Œï¼Œæ¯æœˆå°±åªéœ€è¦å‡ æ¯›ï¼ŒåŸºæœ¬ä¸ç”¨èŠ±é’±ã€‚ðŸ«£&lt;/p>
&lt;p>é™¤äº†å¶å°”ä¼šæ— æ³•æŽ¨é€æˆåŠŸä¹‹å¤–ï¼Œå›½å†…è®¿é—®é€Ÿåº¦ç›¸å½“å¿«ï¼Œæ¯•ç«Ÿéƒ¨ç½²åœ¨å›½å†…ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-webify/0.png"
width="472"
height="85"
srcset="https://www.letout.cn/p/hugo-in-webify/0_huc20776329d75d184c515505bb9bc6a17_15870_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-webify/0_huc20776329d75d184c515505bb9bc6a17_15870_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="0"
class="gallery-image"
data-flex-grow="555"
data-flex-basis="1332px"
>&lt;/p>
&lt;p>ä½†æ˜¯æœ€è¿‘æ”¹äº†ä»˜è´¹æ–¹å¼ï¼Œå…ˆä¹°å¥—é¤ï¼Œè¶…å‡ºå†è¿›è¡ŒæŒ‰é‡æ”¶è´¹ã€‚ðŸ¤”&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-webify/1.png"
width="1077"
height="854"
srcset="https://www.letout.cn/p/hugo-in-webify/1_hu56ae18acc6ac70d7209e9eb3aa6fad3a_126909_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-webify/1_hu56ae18acc6ac70d7209e9eb3aa6fad3a_126909_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="126"
data-flex-basis="302px"
>&lt;/p>
&lt;p>è™½ç„¶ CloudBase å¯ä»¥éƒ¨ç½²å®Œæ•´çš„é¡¹ç›®ï¼Œä½†æ˜¯æˆ‘åªéœ€è¦æ‰˜ç®¡ä¸€ç‚¹é™æ€é¡µé¢ï¼Œæœ€ä½Žæ­£å¸¸ä»· 39.9 æ¯æœˆï¼Œåˆ°æ—¶å€™ä¹°è¿™ä¸ªå¥—é¤ä¸å¦‚ç›´æŽ¥ä¹°ä¸ªäº‘æœåŠ¡å™¨ã€‚æžœç„¶ç™½å«–æ˜¯ä¸å¯èƒ½ä¸€ç›´ç™½å«–çš„ã€‚ðŸ« &lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-webify/2.png"
width="438"
height="256"
srcset="https://www.letout.cn/p/hugo-in-webify/2_hue69ff45008c2c92db458f250a5d53c45_43271_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-webify/2_hue69ff45008c2c92db458f250a5d53c45_43271_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="410px"
>&lt;/p>
&lt;h2 id="æµç¨‹">æµç¨‹&lt;/h2>
&lt;p>è…¾è®¯äº‘ä¸­è¿˜æœ‰ä¸“é—¨æ‰˜ç®¡é™æ€é¡µé¢çš„æœåŠ¡ Webifyï¼Œç±»ä¼¼äºŽ Github ä¸­çš„é™æ€é¡µé¢æœåŠ¡ï¼Œè´¹ç”¨ç›¸è¾ƒæ¥è¯´æŒºä½Žçš„ï¼Œè¿™é‡Œæ‰“ç®—æŠŠåšå®¢è¿ç§»è¿‡åŽ»ã€‚&lt;/p>
&lt;p>åœ¨éƒ¨ç½²æ¨¡æ¿é‡Œé¢ï¼Œåªæœ‰ä¸€äº›å‰ç«¯æ¡†æž¶ï¼Œæ²¡æœ‰ Hugoï¼Œæ‰€ä»¥è¿™é‡Œåˆ©ç”¨ Github Action ç¼–è¯‘æˆé™æ€é¡µé¢åŽï¼ŒæŽ¨é€åˆ°å…¶ä»–åˆ†æ”¯/ä»“åº“ï¼Œå†æ‰˜ç®¡è¿™äº›é™æ€ä»£ç ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-webify/3.png"
width="327"
height="528"
srcset="https://www.letout.cn/p/hugo-in-webify/3_huaa7d4ed28d1f1de02cf9b29093fabf99_48914_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-webify/3_huaa7d4ed28d1f1de02cf9b29093fabf99_48914_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3"
class="gallery-image"
data-flex-grow="61"
data-flex-basis="148px"
>&lt;/p>
&lt;p>æŽ¨é€åˆ° Github å…¶ä»–åˆ†æ”¯çš„é™æ€é¡µé¢ï¼Œè¿˜å¯ä»¥å†æ‰˜ç®¡ä¸€ä¸ª Github Page åšå¤‡ä»½ã€‚&lt;/p>
&lt;p>æµç¨‹å¤§è‡´ä¸ºï¼š&lt;/p>
&lt;p>&lt;code>Hugo -&amp;gt; Github Action -&amp;gt; é™æ€é¡µé¢ -&amp;gt; è…¾è®¯äº‘ Webify æ‹‰å–é™æ€é¡µé¢ -&amp;gt; éƒ¨ç½²&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ·»åŠ  workflows&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œæ˜¯é€‰æ‹©æŽ¨é€åˆ°å¦å¤–ä¸€ä¸ªä»“åº“ï¼Œå› ä¸ºåœ¨ Webify æœåŠ¡é‡Œï¼Œæ²¡æ‰¾åˆ°æ€Žä¹ˆæ›´æ¢éƒ¨ç½²åˆ†æ”¯ï¼Œç›´æŽ¥ç”¨äº†é»˜è®¤åˆ†æ”¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Webify Pages&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">push&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">branches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">deploy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/checkout@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">submodules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># Fetch Hugo themes (true OR recursive)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-depth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># Fetch all history for .GitInfo and .Lastmod&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Setup Hugo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-hugo@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;latest&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">extended&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æ˜¯å¦éœ€è¦ extended ç‰ˆæœ¬&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Build&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hugo --minify --gc --config config.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-gh-pages@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">deploy_key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.DEPLOY_KEY }} &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å¤–ä»“åº“ä½¿ç”¨ deploy_key&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">external_repository&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">emerywan/blog&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">publish_dir&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">./public&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">publish_branch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ–°å»ºåº”ç”¨&lt;/li>
&lt;/ul>
&lt;p>äº‘äº§å“ - Web åº”ç”¨æ‰˜ç®¡&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-webify/4.png"
width="2316"
height="1230"
srcset="https://www.letout.cn/p/hugo-in-webify/4_huf9354845b150a28a9bbe99c4ce9a2902_136523_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-webify/4_huf9354845b150a28a9bbe99c4ce9a2902_136523_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="4"
class="gallery-image"
data-flex-grow="188"
data-flex-basis="451px"
>&lt;/p>
&lt;p>é€‰æ‹©éœ€è¦æ‰˜ç®¡çš„ä»“åº“å°±å¯ä»¥äº†ï¼Œä¸‹ä¸€æ­¥å°±è¡Œäº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-webify/5.png"
width="571"
height="248"
srcset="https://www.letout.cn/p/hugo-in-webify/5_hu609fa268f17278829789499f6682a8f8_37202_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-webify/5_hu609fa268f17278829789499f6682a8f8_37202_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="5"
class="gallery-image"
data-flex-grow="230"
data-flex-basis="552px"
>&lt;/p>
&lt;p>è‡ªå®šä¹‰åŸŸåï¼Œä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨å…è´¹ CDN çš„ ðŸ«£ ï¼Œåªæ˜¯æ²¡æœ‰ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œè®¾ç½®é˜²ç›—é“¾ä»€ä¹ˆçš„ï¼Œä½œä¸ºå›½å†…çš„æœåŠ¡ï¼Œå·²ç»å¾ˆä¸é”™å•¦ã€‚è¿™ä¸ªå†æ”¹è®¡è´¹æ–¹å¼ï¼Œå°±æ‰“ç®—ç›´æŽ¥ç”¨ Vercel äº†ã€‚ðŸ˜‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-webify/6.png"
width="2458"
height="382"
srcset="https://www.letout.cn/p/hugo-in-webify/6_hu71f99e798b96b20bb419371b96863ee5_50312_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-webify/6_hu71f99e798b96b20bb419371b96863ee5_50312_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6"
class="gallery-image"
data-flex-grow="643"
data-flex-basis="1544px"
>&lt;/p></description></item><item><title>JVM å†…å­˜åŒºåŸŸ</title><link>https://www.letout.cn/p/java/jvm/memory-area/</link><pubDate>Mon, 08 Aug 2022 15:02:02 +0800</pubDate><guid>https://www.letout.cn/p/java/jvm/memory-area/</guid><description>&lt;img src="https://www.letout.cn/p/java/jvm/memory-area/area.png" alt="Featured image of post JVM å†…å­˜åŒºåŸŸ" />&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/memory-area/area.png"
width="1240"
height="583"
srcset="https://www.letout.cn/p/java/jvm/memory-area/area_hu7d264de33d14753fd73bf351bb5dce63_911596_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/memory-area/area_hu7d264de33d14753fd73bf351bb5dce63_911596_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="area"
class="gallery-image"
data-flex-grow="212"
data-flex-basis="510px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ§ çº¿ç¨‹éš”ç¦»&lt;/p>
&lt;ul>
&lt;li>ç¨‹åºè®¡æ•°å™¨&lt;/li>
&lt;li>è™šæ‹Ÿæœºæ ˆ&lt;/li>
&lt;li>æœ¬åœ°æ–¹æ³•æ ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>â˜ºï¸ çº¿ç¨‹å…±äº«&lt;/p>
&lt;ul>
&lt;li>æ–¹æ³•åŒº&lt;/li>
&lt;li>å †&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ç¨‹åºè®¡æ•°å™¨">ðŸŽ‹ ç¨‹åºè®¡æ•°å™¨&lt;/h2>
&lt;p>å½“å‰çº¿ç¨‹æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚&lt;/p>
&lt;p>å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºçŽ° &lt;code>OutOfMemoryError&lt;/code> çš„å†…å­˜åŒºåŸŸï¼Œéšçº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšçº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚&lt;/p>
&lt;h2 id="-è™šæ‹Ÿæœºæ ˆ">ðŸŽ‹ è™šæ‹Ÿæœºæ ˆ&lt;/h2>
&lt;p>æ¯ä¸€æ¬¡æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„æ ˆå¸§è¢«åŽ‹å…¥æ ˆä¸­ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ç»“æŸåŽï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆå¸§è¢«å¼¹å‡ºã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/memory-area/stack.png"
width="1223"
height="184"
srcset="https://www.letout.cn/p/java/jvm/memory-area/stack_huec65210ac7484aa7992e4fd9421e2f2b_282459_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/memory-area/stack_huec65210ac7484aa7992e4fd9421e2f2b_282459_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="stack"
class="gallery-image"
data-flex-grow="664"
data-flex-basis="1595px"
>&lt;/p>
&lt;p>å½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæœ€å¤§æ·±åº¦æ—¶ï¼Œä¼šæŠ›å‡º &lt;code>StackOverFlowError&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å±€éƒ¨å˜é‡è¡¨&lt;/p>
&lt;p>å­˜æ”¾ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§æ•°æ®ç±»åž‹ï¼Œå¯¹è±¡å¼•ç”¨åœ°å€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ“ä½œæ•°æ ˆ&lt;/p>
&lt;p>æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è®¡ç®—ç»“æžœï¼Œè®¡ç®—è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŠ¨æ€é“¾æŽ¥&lt;/p>
&lt;p>æœåŠ¡äºŽä¸€ä¸ªæ–¹æ³•éœ€è¦è°ƒç”¨å…¶ä»–æ–¹æ³•çš„åœºæ™¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ–¹æ³•è¿”å›žåœ°å€&lt;/p>
&lt;ul>
&lt;li>æ­£å¸¸è¿”å›žï¼ˆreturnï¼‰&lt;/li>
&lt;li>å¼‚å¸¸è¿”å›žï¼ˆExceptionï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-æœ¬åœ°æ–¹æ³•æ ˆ">ðŸŽ‹ æœ¬åœ°æ–¹æ³•æ ˆ&lt;/h2>
&lt;p>æœ¬åœ°æ–¹æ³•æ ˆç”¨äºŽè™šæ‹Ÿæœºæ‰§è¡Œ Native æ–¹æ³•ï¼Œå…·ä½“ä¸Žè™šæ‹Ÿæœºæ ˆç±»ä¼¼ã€‚&lt;/p>
&lt;h2 id="-æ–¹æ³•åŒº">ðŸŽ æ–¹æ³•åŒº&lt;/h2>
&lt;p>æ–¹æ³•åŒºæ˜¯ Java è™šæ‹Ÿæœºçš„æŠ½è±¡æ¦‚å¿µã€‚å®žçŽ°æ–¹å¼åœ¨ä¸åŒè™šæ‹Ÿæœºä¸­å¯èƒ½ä¸åŒã€‚&lt;/p>
&lt;ul>
&lt;li>JDK 8 ä¹‹å‰ï¼ŒHotSpot è™šæ‹Ÿæœºä½¿ç”¨æ°¸ä¹…å¸¦å®žçŽ°æ–¹æ³•åŒº&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/memory-area/function-before.png"
width="547"
height="530"
srcset="https://www.letout.cn/p/java/jvm/memory-area/function-before_hucbc502332944514d4c1f41f29f96205d_115360_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/memory-area/function-before_hucbc502332944514d4c1f41f29f96205d_115360_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="before"
class="gallery-image"
data-flex-grow="103"
data-flex-basis="247px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>JDK 8 åŠä¹‹åŽï¼Œä½¿ç”¨å…ƒç©ºé—´ï¼ˆç›´æŽ¥å†…å­˜ï¼‰å®žçŽ°&lt;/p>
&lt;p>å­—ç¬¦ä¸²å¸¸é‡æ± ä¸Žé™æ€å˜é‡è½¬ç§»åˆ°äº†å †ä¸­ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/memory-area/function-after.png"
width="695"
height="524"
srcset="https://www.letout.cn/p/java/jvm/memory-area/function-after_hub8d0c407ad61dc44d980ad0db8ff77fa_132600_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/memory-area/function-after_hub8d0c407ad61dc44d980ad0db8ff77fa_132600_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="after"
class="gallery-image"
data-flex-grow="132"
data-flex-basis="318px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç±»çš„å…ƒä¿¡æ¯&lt;/p>
&lt;p>ç±»åï¼Œè®¿é—®ä¿®é¥°ç¬¦ï¼Œå­—æ®µæè¿°ï¼Œæ–¹æ³•æè¿°ç­‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¿è¡Œæ—¶å¸¸é‡æ± &lt;/p>
&lt;p>å­˜æ”¾ç¼–è¯‘åŽçš„å„ç§å­—é¢é‡ï¼Œç¬¦å·å¼•ç”¨ï¼Œå¸¸é‡ï¼ˆfinalï¼‰æ± è¡¨ç­‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å­—ç¬¦ä¸²å¸¸é‡æ± &lt;/p>
&lt;p>JVM ä¸ºäº†å‡å°‘å­—ç¬¦ä¸²å¯¹å†…å­˜çš„æ¶ˆè€—ï¼Œå¹¶æå‡æ€§èƒ½ï¼Œä¸“é—¨å¼€è¾Ÿçš„åŒºåŸŸ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é™æ€å˜é‡&lt;/p>
&lt;p>ç±»å˜é‡ï¼ˆstaticï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-å †">ðŸŽ å †&lt;/h2>
&lt;p>ç”¨æ¥å­˜æ”¾å’Œç®¡ç†å¯¹è±¡å®žä¾‹ï¼Œå‡ ä¹Žæ‰€æœ‰çš„å¯¹è±¡å®žä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…ã€‚ï¼ˆå­˜åœ¨é€ƒé€¸åˆ†æžï¼Œæ ˆä¸Šåˆ†é…ï¼Œæœ‰äº›å¯¹è±¡ä¸ä¸€å®šåœ¨å †ä¸­ï¼‰&lt;/p>
&lt;p>Java å †æ˜¯åžƒåœ¾å›žæ”¶çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸º GC å †ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>JDK 8 ä¹‹å‰ï¼Œå †è¢«åˆ†ä¸º&lt;/p>
&lt;ul>
&lt;li>æ–°ç”Ÿä»£ï¼ˆEdenã€Survivor0ã€Survivor1ï¼‰&lt;/li>
&lt;li>è€å¹´ä»£&lt;/li>
&lt;li>æ°¸ä¹…ä»£ï¼ˆæ–¹æ³•åŒºä¹Ÿç”±æ°¸ä¹…ä»£å®žçŽ°ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>JDK 8 ä¹‹åŽï¼Œæ°¸ä¹…ä»£è¢«å–æ¶ˆ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯¹è±¡é¦–å…ˆä¼šåœ¨æ–°ç”Ÿä»£çš„ Eden åŒºè¿›è¡Œåˆ†é…ï¼›åœ¨ä¸€æ¬¡åžƒåœ¾å›žæ”¶åŽï¼Œå¦‚æžœå¯¹è±¡è¿˜å­˜æ´»ï¼Œä¼šè¿›å…¥ S0 æˆ– S1ï¼›å½“å¯¹è±¡å¹´é¾„å¢žé•¿åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ 15ï¼‰ï¼Œæˆ–ç´¯ç§¯çš„å¹´é¾„è¶…è¿‡äº† Survivor çš„ä¸€åŠï¼Œä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>å›¾æ¥æºäºŽç½‘ç»œã€‚&lt;/li>
&lt;li>æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº&lt;/li>
&lt;/ul></description></item><item><title>JVM åžƒåœ¾å›žæ”¶</title><link>https://www.letout.cn/p/java/jvm/garbage-collection/</link><pubDate>Sun, 07 Aug 2022 12:02:02 +0800</pubDate><guid>https://www.letout.cn/p/java/jvm/garbage-collection/</guid><description>&lt;img src="https://www.letout.cn/imgs/26.jpeg" alt="Featured image of post JVM åžƒåœ¾å›žæ”¶" />&lt;h2 id="-å¯¹è±¡å­˜æ´»åˆ¤å®š">ðŸŒ´ å¯¹è±¡å­˜æ´»åˆ¤å®š&lt;/h2>
&lt;h3 id="-å¼•ç”¨è®¡æ•°æ³•">ðŸª¨ å¼•ç”¨è®¡æ•°æ³•&lt;/h3>
&lt;p>ç»™æ¯ä¸ªå¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼š&lt;/p>
&lt;ul>
&lt;li>å½“æœ‰åœ°æ–¹å¼•ç”¨è¯¥å¯¹è±¡ï¼Œè®¡æ•°å™¨ &lt;code>+1&lt;/code>&lt;/li>
&lt;li>å½“å¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨ &lt;code>-1&lt;/code>&lt;/li>
&lt;li>å½“è®¡æ•°å™¨ä¸º &lt;code>0&lt;/code> æ—¶ï¼Œè¡¨ç¤ºå¯¹è±¡ä¸å¯ç”¨&lt;/li>
&lt;/ul>
&lt;p>è¯¥æ–¹æ³•ç®€å•é«˜æ•ˆï¼Œä½†ä¸»æµçš„è™šæ‹Ÿæœºéƒ½æ²¡æœ‰é€‰æ‹©è¯¥æ–¹æ³•ç®¡ç†å†…å­˜ï¼Œéš¾ä»¥è§£å†³å¯¹è±¡ä¹‹é—´å¾ªçŽ¯å¼•ç”¨çš„é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="-å¯è¾¾æ€§åˆ†æžæ³•">ðŸª¨ å¯è¾¾æ€§åˆ†æžæ³•&lt;/h3>
&lt;p>é€šè¿‡ä¸€ç³»åˆ—ç§°ä¸º &lt;code>GC Root&lt;/code> çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»Žè¿™äº›èµ·ç‚¹å‘ä¸‹æœç´¢ï¼ŒèŠ‚ç‚¹èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡ä¸Ž &lt;code>GC Root&lt;/code> ä¹‹é—´æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿žçš„è¯ï¼Œè¯´æ˜Žå¯¹è±¡ä¸å¯ç”¨ï¼Œéœ€è¦è¢«å›žæ”¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/garbage-collection/gcroot.png"
width="935"
height="581"
srcset="https://www.letout.cn/p/java/jvm/garbage-collection/gcroot_hud8e4c62b0ef63778b91f8329965428a2_102739_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/garbage-collection/gcroot_hud8e4c62b0ef63778b91f8329965428a2_102739_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="gcroot"
class="gallery-image"
data-flex-grow="160"
data-flex-basis="386px"
>&lt;/p>
&lt;p>å¯ä»¥ä½œä¸º &lt;code>GC Root&lt;/code> çš„å¯¹è±¡ï¼š&lt;/p>
&lt;ul>
&lt;li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­å±€éƒ¨å˜é‡è¡¨ï¼‰å¼•ç”¨çš„å¯¹è±¡&lt;/li>
&lt;li>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡&lt;/li>
&lt;li>ç±»é™æ€å±žæ€§å¼•ç”¨çš„å¯¹è±¡&lt;/li>
&lt;li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡&lt;/li>
&lt;li>æ‰€æœ‰è¢«åŒæ­¥é”ï¼ˆsynchronizedï¼‰æŒæœ‰çš„å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="-åžƒåœ¾å›žæ”¶ç®—æ³•">ðŸŒ´ åžƒåœ¾å›žæ”¶ç®—æ³•&lt;/h2>
&lt;h3 id="-æ ‡è®°-æ¸…é™¤">ðŸªµ æ ‡è®°-æ¸…é™¤&lt;/h3>
&lt;ul>
&lt;li>æ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›žæ”¶çš„å¯¹è±¡&lt;/li>
&lt;li>æ ‡è®°ç»“æŸåŽï¼Œç»Ÿä¸€å›žæ”¶æŽ‰æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/garbage-collection/clear.png"
width="962"
height="488"
srcset="https://www.letout.cn/p/java/jvm/garbage-collection/clear_hu3ebff86a38831b55ce513a2b74335841_65435_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/garbage-collection/clear_hu3ebff86a38831b55ce513a2b74335841_65435_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="clear"
class="gallery-image"
data-flex-grow="197"
data-flex-basis="473px"
>&lt;/p>
&lt;ul>
&lt;li>æ‰§è¡Œæ•ˆçŽ‡ä¸ç¨³å®šï¼Œå¤§éƒ¨åˆ†å¯¹è±¡éœ€è¦å›žæ”¶æ—¶ï¼Œéœ€è¦å¤§é‡æ ‡è®°å’Œæ¸…é™¤æ“ä½œ&lt;/li>
&lt;li>å†…å­˜ç©ºé—´ç¢Žç‰‡åŒ–é—®é¢˜&lt;/li>
&lt;/ul>
&lt;h3 id="-æ ‡è®°-å¤åˆ¶">ðŸªµ æ ‡è®°-å¤åˆ¶&lt;/h3>
&lt;ul>
&lt;li>å°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—&lt;/li>
&lt;li>å½“ä¸€å—å†…å­˜ä½¿ç”¨å®ŒåŽï¼Œå°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—åŽ»&lt;/li>
&lt;li>å°†å·²ç»ä½¿ç”¨çš„ç©ºé—´ä¸€æ¬¡æ€§æ¸…é™¤æŽ‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/garbage-collection/copy.png"
width="955"
height="495"
srcset="https://www.letout.cn/p/java/jvm/garbage-collection/copy_hu6b5a3b19d23e61d87d481fdc4629a5cf_68281_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/garbage-collection/copy_hu6b5a3b19d23e61d87d481fdc4629a5cf_68281_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="copy"
class="gallery-image"
data-flex-grow="192"
data-flex-basis="463px"
>&lt;/p>
&lt;ul>
&lt;li>å¯ç”¨å†…å­˜å˜å°‘ï¼Œæœ‰ç©ºé—´æµªè´¹é—®é¢˜&lt;/li>
&lt;/ul>
&lt;h3 id="-æ ‡è®°-æ•´ç†">ðŸªµ æ ‡è®°-æ•´ç†&lt;/h3>
&lt;ul>
&lt;li>æ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›žæ”¶çš„å¯¹è±¡&lt;/li>
&lt;li>è®©è¿™äº›å­˜æ´»å¯¹è±¡å‘å†…å­˜çš„ä¸€ç«¯ç§»åŠ¨&lt;/li>
&lt;li>ç›´æŽ¥æ¸…é™¤æŽ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/garbage-collection/move.png"
width="944"
height="480"
srcset="https://www.letout.cn/p/java/jvm/garbage-collection/move_hu0eec74bf9ebb0cbf4f6fd4cbe2be3a39_63153_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/garbage-collection/move_hu0eec74bf9ebb0cbf4f6fd4cbe2be3a39_63153_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="move"
class="gallery-image"
data-flex-grow="196"
data-flex-basis="472px"
>&lt;/p>
&lt;h3 id="-åˆ†ä»£æ”¶é›†">ðŸªµ åˆ†ä»£æ”¶é›†&lt;/h3>
&lt;p>æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒï¼Œå°† Java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œä¾æ®å„ä¸ªåŒºåŸŸçš„ç‰¹ç‚¹ï¼Œé€‰æ‹©å›žæ”¶ç®—æ³•ã€‚&lt;/p>
&lt;ul>
&lt;li>åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡æ”¶é›†éƒ½ä¼šæœ‰å¤§é‡çš„å¯¹è±¡æ­»åŽ»ï¼Œé€‰æ‹© &lt;code>æ ‡è®°-å¤åˆ¶&lt;/code> ç®—æ³•&lt;/li>
&lt;li>åœ¨è€å¹´ä»£ä¸­ï¼Œå­˜æ´»å¯¹è±¡çš„å‡ çŽ‡è¾ƒé«˜ï¼Œæ²¡æœ‰é¢å¤–çš„ç©ºé—´è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œé€‰æ‹© &lt;code>æ ‡è®°-æ¸…é™¤&lt;/code> æˆ– &lt;code>æ ‡è®°-æ•´ç†&lt;/code> ç®—æ³•&lt;/li>
&lt;/ul>
&lt;h2 id="-åžƒåœ¾æ”¶é›†æ–¹å¼">ðŸŒ´ åžƒåœ¾æ”¶é›†æ–¹å¼&lt;/h2>
&lt;h3 id="-éƒ¨åˆ†æ”¶é›†">ðŸª¨ éƒ¨åˆ†æ”¶é›†&lt;/h3>
&lt;p>æ”¶é›†å †éƒ¨åˆ†åŒºåŸŸã€‚&lt;code>Partial GC&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ–°ç”Ÿä»£æ”¶é›† &lt;code>Minor GC / Young GC&lt;/code>&lt;/p>
&lt;p>ç›®æ ‡åªæ˜¯æ–°ç”Ÿä»£çš„åžƒåœ¾æ”¶é›†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è€å¹´ä»£æ”¶é›† &lt;code>Major GC / Old GC&lt;/code>&lt;/p>
&lt;p>ç›®æ ‡åªæ˜¯è€å¹´ä»£çš„åžƒåœ¾æ”¶é›†ï¼Œç›®å‰åªæœ‰ CMS æ”¶é›†å™¨ä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ··åˆæ”¶é›† &lt;code>Mixed GC&lt;/code>&lt;/p>
&lt;p>ç›®æ ‡æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£å’Œéƒ¨åˆ†è€å¹´ä»£çš„åžƒåœ¾æ”¶é›†ï¼Œç›®å‰åªæœ‰ G1 æ”¶é›†å™¨ä¼šæœ‰è¿™ç§è¡Œä¸ºã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ•´å †æ”¶é›†">ðŸª¨ æ•´å †æ”¶é›†&lt;/h3>
&lt;p>æ”¶é›†æ•´ä¸ªå †å’Œæ–¹æ³•åŒºã€‚&lt;code>Full GC&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§äºŽè€å¹´ä»£çš„å‰©ä½™ç©ºé—´&lt;/li>
&lt;li>Minor GC åŽï¼Œæ–°ç”Ÿä»£å­˜æ´»å¯¹è±¡è¶…è¿‡äº†è€å¹´ä»£çš„ç©ºé—´ï¼ˆåˆ†é…æ‹…ä¿æœºåˆ¶ï¼‰&lt;/li>
&lt;li>æ‰‹åŠ¨ System.gc()&lt;/li>
&lt;li>ï¼ˆJava 8 ä¹‹å‰ï¼‰æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³&lt;/li>
&lt;/ul>
&lt;h2 id="-åžƒåœ¾æ”¶é›†å™¨">ðŸŒ´ åžƒåœ¾æ”¶é›†å™¨&lt;/h2>
&lt;h3 id="-serial--serial-old">ðŸªµ Serial / Serial Old&lt;/h3>
&lt;p>â€œå•çº¿ç¨‹â€çš„åžƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨è¿›è¡Œåžƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹&lt;code>stop the world&lt;/code>ï¼Œç›´åˆ°æ”¶é›†ç»“æŸã€‚&lt;/p>
&lt;ul>
&lt;li>æ–°ç”Ÿä»£é‡‡ç”¨ æ ‡è®°-å¤åˆ¶ ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨ æ ‡è®°-æ•´ç† ç®—æ³•ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/garbage-collection/serial.png"
width="953"
height="209"
srcset="https://www.letout.cn/p/java/jvm/garbage-collection/serial_hu902bd566aebd83355bfe0e2769bbc345_79667_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/garbage-collection/serial_hu902bd566aebd83355bfe0e2769bbc345_79667_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="serial"
class="gallery-image"
data-flex-grow="455"
data-flex-basis="1094px"
>&lt;/p>
&lt;ul>
&lt;li>ç®€å•é«˜æ•ˆ&lt;/li>
&lt;li>ä¾æ—§æ˜¯çŽ°åœ¨ HotSpot è™šæ‹Ÿæœºè¿è¡Œåœ¨å®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£åžƒåœ¾å›žæ”¶æ–¹å¼&lt;/li>
&lt;/ul>
&lt;h3 id="-parnew">ðŸªµ ParNew&lt;/h3>
&lt;p>Serial çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨å¤šæ¡çº¿ç¨‹è¿›è¡Œåžƒåœ¾å›žæ”¶ã€‚ï¼ˆæ–°ç”Ÿä»£ï¼‰&lt;/p>
&lt;ul>
&lt;li>é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/garbage-collection/parnew.png"
width="960"
height="202"
srcset="https://www.letout.cn/p/java/jvm/garbage-collection/parnew_hub4e3375e7b496e8b6ebc251ec3bf2f26_87679_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/garbage-collection/parnew_hub4e3375e7b496e8b6ebc251ec3bf2f26_87679_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="parnew"
class="gallery-image"
data-flex-grow="475"
data-flex-basis="1140px"
>&lt;/p>
&lt;h3 id="-parallel-scavenge--parallel-old">ðŸªµ Parallel Scavenge / Parallel Old&lt;/h3>
&lt;ul>
&lt;li>åŸºäºŽ æ ‡è®°-å¤åˆ¶ ç®—æ³•å®žçŽ°çš„æ–°ç”Ÿä»£åžƒåœ¾æ”¶é›†å™¨ï¼Œèƒ½å¤Ÿå¹¶è¡Œæ”¶é›†çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼Œç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æŽ§åˆ¶çš„â€œåžåé‡â€ã€‚&lt;/li>
&lt;li>åŸºäºŽ æ ‡è®°-æ•´ç† ç®—æ³•å®žçŽ°çš„è€å¹´ä»£å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/garbage-collection/parallel.png"
width="934"
height="199"
srcset="https://www.letout.cn/p/java/jvm/garbage-collection/parallel_hu519cfc57a4a5c97f5f81fc0feaeb8730_92362_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/garbage-collection/parallel_hu519cfc57a4a5c97f5f81fc0feaeb8730_92362_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="parallel"
class="gallery-image"
data-flex-grow="469"
data-flex-basis="1126px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Java 8 é»˜è®¤çš„æ”¶é›†å™¨ä¸º Parallel Sacvenge + Parallel Old&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åžåé‡ TPS ï¼šç³»ç»Ÿåœ¨å•ä½æ—¶é—´å†…å¤„ç†è¯·æ±‚çš„æ•°é‡&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-cms">ðŸªµ CMS&lt;/h3>
&lt;p>&lt;code>Concurrent Mark Swap&lt;/code> èŽ·å–æœ€çŸ­åœé¡¿æ—¶é—´çš„æ”¶é›†å™¨ã€‚&lt;/p>
&lt;p>æ˜¯ HotSpot è™šæ‹Ÿæœºç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘åžƒåœ¾æ”¶é›†å™¨ï¼Œå®žçŽ°äº†ç”¨æˆ·çº¿ç¨‹å’Œåžƒåœ¾å›žæ”¶çº¿ç¨‹åŒæ—¶å·¥ä½œã€‚åŸºäºŽ æ ‡è®°-æ¸…é™¤ ç®—æ³•çš„ &lt;strong>è€å¹´ä»£&lt;/strong> æ”¶é›†å™¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/garbage-collection/CMS.png"
width="1121"
height="230"
srcset="https://www.letout.cn/p/java/jvm/garbage-collection/CMS_hu7a65fd9981325c5387fcf294cec67078_167761_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/garbage-collection/CMS_hu7a65fd9981325c5387fcf294cec67078_167761_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="CMS"
class="gallery-image"
data-flex-grow="487"
data-flex-basis="1169px"
>&lt;/p>
&lt;p>CMS æ”¶é›†å™¨æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ¾ åˆå§‹æ ‡è®°&lt;/p>
&lt;p>æ ‡è®°ä¸Ž GC Root ç›´æŽ¥å…³è”çš„å¯¹è±¡ã€‚æš‚åœç”¨æˆ·çº¿ç¨‹ï¼ˆstop the worldï¼‰ï¼Œä½†é€Ÿåº¦è¾ƒå¿«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¾ å¹¶å‘æ ‡è®°&lt;/p>
&lt;p>ç”¨æˆ·çº¿ç¨‹å’Œåžƒåœ¾å›žæ”¶çº¿ç¨‹åŒæ—¶å·¥ä½œï¼Œä»Ž GC Root ç›´æŽ¥å…³è”çš„å¯¹è±¡å¼€å§‹éåŽ†ï¼Œæ ¹æ®å¯è¾¾æ€§åˆ†æžï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¾ é‡æ–°æ ‡è®°&lt;/p>
&lt;p>ä¿®æ­£å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œç”±äºŽç¨‹åºç»§ç»­è¿è¡Œï¼Œå¯¼è‡´çš„æ ‡è®°é”™è¯¯ã€‚æš‚åœç”¨æˆ·çº¿ç¨‹ï¼ˆstop the worldï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¾ å¹¶å‘æ¸…é™¤&lt;/p>
&lt;p>å¹¶å‘åœ°æ¸…ç†æœªè¢«æ ‡è®°çš„åŒºåŸŸã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å¯¹ CPU èµ„æºæ•æ„Ÿ&lt;/li>
&lt;li>æ— æ³•å¤„ç†æµ®åŠ¨åžƒåœ¾ï¼šè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›åžƒåœ¾åœ¨å½“æ¬¡æ— æ³•å¤„ç†ï¼Œéœ€è¦ç­‰å¾…ä¸‹æ¬¡åžƒåœ¾å›žæ”¶&lt;/li>
&lt;li>ä¼šäº§ç”Ÿå†…å­˜ç¢Žç‰‡ï¼Œå¯¼è‡´è¿žç»­ç©ºé—´å‡å°‘ï¼Œå¯¼è‡´ Full GC&lt;/li>
&lt;/ul>
&lt;h3 id="-g1">ðŸªµ G1&lt;/h3>
&lt;p>G1 å¼€åˆ›äº†æ”¶é›†å™¨é¢å‘å±€éƒ¨æ”¶é›†çš„è®¾è®¡æ€è·¯å’ŒåŸºäºŽ Region çš„å†…å­˜å¸ƒå±€å½¢å¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/garbage-collection/g1heap.png"
width="902"
height="676"
srcset="https://www.letout.cn/p/java/jvm/garbage-collection/g1heap_huc8187154c5204389b583a76e76e7dffa_88685_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/garbage-collection/g1heap_huc8187154c5204389b583a76e76e7dffa_88685_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="g1heap"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
>&lt;/p>
&lt;p>å°† Java å †åˆ†ä¸º 2048 ä¸ªå¤§å°ç›¸åŒçš„ç‹¬ç«‹ Regionï¼Œæ¯ä¸ª Region çš„å¤§å°ä¾æ®å †ç©ºé—´çš„å¤§å°è€Œå®šï¼Œåœ¨ JVM ç”Ÿå‘½å‘¨æœŸä¸­ä¸ä¼šæ”¹å˜ã€‚&lt;/p>
&lt;p>æ¯ä¸ª Region éƒ½å¯ä»¥æ ¹æ®éœ€è¦ï¼Œä½œä¸ºæ–°ç”Ÿä»£çš„ Eden åŒºï¼ŒSurvivor åŒºï¼Œæˆ–è€…æ˜¯è€å¹´ä»£ï¼›æ–°ç”Ÿä»£å’Œè€å¹´ä»£åœ¨å†…å­˜ä¸­ä¸æ˜¯è¿žç»­çš„ç©ºé—´ï¼Œæ”¶é›†å™¨ä¼šæ ¹æ®åŒºåŸŸçš„ä¸åŒé‡‡å–ä¸åŒçš„ç­–ç•¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/garbage-collection/g1.png"
width="941"
height="209"
srcset="https://www.letout.cn/p/java/jvm/garbage-collection/g1_hu2c13cc7a5d500b4a818a8d3a4dfa26ed_139186_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/garbage-collection/g1_hu2c13cc7a5d500b4a818a8d3a4dfa26ed_139186_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="g1"
class="gallery-image"
data-flex-grow="450"
data-flex-basis="1080px"
>&lt;/p>
&lt;p>Region ä¸­è¿˜ä¼šæœ‰ä¸€ç±»ç‰¹æ®Šçš„å·¨å¤§åŒºåŸŸ Humongousï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨å¤§å¯¹è±¡ã€‚å½“å¯¹è±¡çš„å¤§å°è¶…è¿‡äº†ä¸€ä¸ª Region çš„ä¸€åŠï¼Œå°±è¢«åˆ¤å®šä¸ºå¤§å¯¹è±¡ã€‚&lt;/p>
&lt;p>G1 æ”¶é›†å™¨å›žæ”¶çš„æ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ¾ åˆå§‹æ ‡è®°&lt;/p>
&lt;p>æ ‡è®° GC Root èƒ½å¤Ÿç›´æŽ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œéœ€è¦åœé¡¿çº¿ç¨‹ï¼ˆstop the worldï¼‰ï¼Œè€—æ—¶è¾ƒçŸ­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¾ å¹¶å‘æ ‡è®°&lt;/p>
&lt;p>ä»Ž GC Root å¼€å§‹å¯¹å †ä¸­çš„å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æžï¼Œæ‰¾å‡ºéœ€è¦å›žæ”¶çš„å¯¹è±¡ï¼Œä¸Žç”¨æˆ·çº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¾ æœ€ç»ˆæ ‡è®°&lt;/p>
&lt;p>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿçš„å˜åŠ¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¾ ç­›é€‰å›žæ”¶&lt;/p>
&lt;p>å¯¹å„ä¸ª Region çš„å›žæ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡ŒæŽ’åºï¼Œä¼šé€‰æ‹©ä»·å€¼æœ€å¤§çš„åŒºåŸŸè¿›è¡Œå›žæ”¶ã€‚&lt;/p>
&lt;p>å°†å›žæ”¶çš„ Region ä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œå¤åˆ¶åˆ°ç©ºçš„ Region ä¸­ï¼Œå†æ¸…ç†æŽ‰æ•´ä¸ªæ—§çš„ Region åŒºåŸŸã€‚&lt;/p>
&lt;p>æ¶‰åŠå¯¹è±¡çš„ç§»åŠ¨ï¼Œå¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹ï¼ˆstop the worldï¼‰ï¼Œæœ‰å¤šæ¡åžƒåœ¾æ”¶é›†å™¨å¹¶å‘æ‰§è¡Œã€‚ä½†æ˜¯åªå›žæ”¶ä¸€éƒ¨åˆ†Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æŽ§åˆ¶çš„ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;h2 id="-å¯¹è±¡åˆ†é…å’Œå›žæ”¶åŽŸåˆ™">ðŸŒ´ å¯¹è±¡åˆ†é…å’Œå›žæ”¶åŽŸåˆ™&lt;/h2>
&lt;ul>
&lt;li>ðŸª¨ å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åŒºåˆ†é…&lt;/li>
&lt;/ul>
&lt;p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ Eden åŒºåˆ†é…ï¼Œå½“ Eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå‘èµ·ä¸€æ¬¡ Minor GCã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸª¨ å¤§å¯¹è±¡ç›´æŽ¥è¿›å…¥è€å¹´ä»£&lt;/li>
&lt;/ul>
&lt;p>éœ€è¦å¤§é‡è¿žç»­å†…å­˜ç©ºé—´çš„ Java å¯¹è±¡ï¼ˆæ•°ç»„ï¼Œå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼‰ï¼Œç›´æŽ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œé¿å…åœ¨ Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºä¹‹é—´æ¥å›žå¤åˆ¶ï¼Œäº§ç”Ÿå¤§é‡çš„å†…å­˜å¤åˆ¶æ“ä½œã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸª¨ é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£&lt;/li>
&lt;/ul>
&lt;p>è™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡ä¸€ä¸ªå¯¹è±¡å¹´é¾„è®¡æ•°å™¨ï¼Œæ¯ç»è¿‡ä¸€æ¬¡ MinorGCï¼Œå¹´é¾„å°±ä¼š +1ï¼Œ&lt;/p>
&lt;p>å½“å¹´é¾„å¢žåŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ 15ï¼‰ï¼Œæˆ–æŸä¸ªå¹´é¾„è¶…è¿‡äº† Survivor åŒºçš„ä¸€åŠæ—¶ï¼Œä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸª¨ ç©ºé—´åˆ†é…æ‹…ä¿&lt;/li>
&lt;/ul>
&lt;p>ç¡®ä¿åœ¨ Minor GC ä¹‹å‰ï¼Œè€å¹´ä»£è¿˜æœ‰å®¹çº³æ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„å‰©ä½™ç©ºé—´ã€‚&lt;/p>
&lt;p>è¿›è¡Œä¸€æ¬¡ Minor GC ä¹‹åŽï¼ŒEden åŒºä¸­ä»»ç„¶å­˜åœ¨å¤§é‡å¯¹è±¡ï¼ŒSurvivor ä¸­æ— æ³•å®¹çº³ï¼Œç›´æŽ¥é€åˆ°è€å¹´ä»£ï¼Œè®©è€å¹´ä»£è¿›è¡Œç©ºé—´åˆ†é…æ‹…ä¿ã€‚&lt;/p></description></item><item><title>JVM å†…å­˜æ¨¡åž‹</title><link>https://www.letout.cn/p/java/jvm/memory-model/</link><pubDate>Sun, 07 Aug 2022 06:02:02 +0800</pubDate><guid>https://www.letout.cn/p/java/jvm/memory-model/</guid><description>&lt;img src="https://www.letout.cn/imgs/28.jpeg" alt="Featured image of post JVM å†…å­˜æ¨¡åž‹" />&lt;h2 id="jmm">JMM&lt;/h2>
&lt;p>Java å†…å­˜æ¨¡åž‹ï¼ˆJava Memory Modelï¼‰å±è”½äº†ä¸åŒæ“ä½œç³»ç»Ÿå’Œå„ç§ç¡¬ä»¶çš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œå®žçŽ°äº† Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹ï¼Œéƒ½èƒ½è¾¾åˆ°ä¸€è‡´æ€§çš„è®¿é—®æ•ˆæžœã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/memory-model/JMM.png"
width="613"
height="530"
srcset="https://www.letout.cn/p/java/jvm/memory-model/JMM_hu7e11e9092393e4f5c6cb98b7857d5889_99528_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/memory-model/JMM_hu7e11e9092393e4f5c6cb98b7857d5889_99528_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="JMM"
class="gallery-image"
data-flex-grow="115"
data-flex-basis="277px"
>&lt;/p>
&lt;p>JMM è§„å®šäº†ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å­˜ä¸­&lt;/li>
&lt;li>æ¯æ¡çº¿ç¨‹æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜&lt;/li>
&lt;li>çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»å–ã€èµ‹å€¼ç­‰ï¼‰ï¼Œä¸èƒ½ç›´æŽ¥è¯»å†™ä¸»å­˜ä¸­çš„æ•°æ®ï¼Œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œ&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/memory-model/memory.png"
width="942"
height="383"
srcset="https://www.letout.cn/p/java/jvm/memory-model/memory_hue7fb17d3eb7c4a77bd28c7215dc28c3d_104935_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/memory-model/memory_hue7fb17d3eb7c4a77bd28c7215dc28c3d_104935_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="memory"
class="gallery-image"
data-flex-grow="245"
data-flex-basis="590px"
>&lt;/p>
&lt;h2 id="åŽŸå­æ€§å¯è§æ€§æœ‰åºæ€§">åŽŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§&lt;/h2>
&lt;p>Java å†…å­˜æ¨¡åž‹æ˜¯å›´ç»•ç€åœ¨å¹¶å‘è¿‡ç¨‹ä¸­å¦‚ä½•å¤„ç†åŽŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ä¸‰ä¸ªç‰¹å¾æ¥å»ºç«‹çš„ã€‚&lt;/p>
&lt;h3 id="-åŽŸå­æ€§">ðŸ¥ åŽŸå­æ€§&lt;/h3>
&lt;p>ä¸€æ¬¡æˆ–å¤šæ¬¡æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œä¸”ä¸å—åˆ°ä»»ä½•å¹²æ‰°ï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œã€‚&lt;/p>
&lt;ul>
&lt;li>åˆ©ç”¨é”ï¼Œå¯ä»¥è®©ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ä»£ç å—ã€‚&lt;code>synchronized&lt;/code> &lt;code>Lock&lt;/code>&lt;/li>
&lt;li>åˆ©ç”¨ &lt;code>CAS&lt;/code> åŽŸå­ç±»ï¼Œä¿è¯åŽŸå­æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="-å¯è§æ€§">ðŸ¤ å¯è§æ€§&lt;/h3>
&lt;p>ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>volatile&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>è§„å®šæ¯æ¬¡å†™æ“ä½œï¼Œéƒ½ç«‹å³åŒæ­¥åˆ°ä¸»å­˜ï¼›æ¯æ¬¡è¯»æ“ä½œï¼Œéƒ½ä»Žä¸»å­˜ä¸­è¯»å–ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>synchronized&lt;/code> &lt;code>lock&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œæ‰§è¡Œ unlock ä¹‹å‰ï¼Œå¿…é¡»æŠŠå˜é‡åŒæ­¥å›žä¸»å­˜ä¸­ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>final&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="-æœ‰åºæ€§">ðŸ£ æœ‰åºæ€§&lt;/h3>
&lt;p>æŒ‡ä»¤é‡æŽ’é—®é¢˜ï¼Œä»£ç çš„æ‰§è¡Œé¡ºåºä¸ä¸€å®šã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>volatile&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åŒ…å«ç¦æ­¢æŒ‡ä»¤é‡æŽ’åºçš„è¯­ä¹‰ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>synchronized&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åªæœ‰ä¸€æ¡çº¿ç¨‹èƒ½å¤Ÿè¿›å…¥ä¸´ç•ŒåŒºã€‚&lt;/p>
&lt;h2 id="volatile">volatile&lt;/h2>
&lt;p>Java è™šæ‹Ÿæœºæä¾›çš„è½»é‡çº§å†…å­˜åŒæ­¥æœºåˆ¶ã€‚&lt;/p>
&lt;p>ä½œç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>âœ”ï¸ ä¿éšœäº†æ­¤å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§&lt;/li>
&lt;/ul>
&lt;p>volatile çš„å†™æ“ä½œï¼Œéƒ½ä¼šåˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œå¹¶ä½¿å…¶ä»–çº¿ç¨‹ä¸­çš„ volatile å˜é‡å¤±æ•ˆï¼›volatile çš„è¯»æ“ä½œï¼Œéƒ½ä¼šä»Žä¸»å­˜ä¸­è¯»å–ã€‚&lt;/p>
&lt;ul>
&lt;li>âœ”ï¸ ç¦æ­¢æŒ‡ä»¤é‡æŽ’ä¼˜åŒ–ï¼ˆæœ‰åºæ€§ï¼‰&lt;/li>
&lt;/ul>
&lt;p>é˜²æ­¢å†™æ“ä½œä¹‹å‰çš„ä»£ç ï¼Œé‡æŽ’åˆ°å†™æ“ä½œä¹‹åŽï¼›é˜²æ­¢è¯»æ“ä½œä¹‹åŽçš„ä»£ç ï¼Œé‡æŽ’åˆ°è¯»æ“ä½œä¹‹å‰ã€‚&lt;/p>
&lt;ul>
&lt;li>â—ï¸æ— æ³•ä¿éšœåŽŸå­æ€§&lt;/li>
&lt;/ul>
&lt;p>ä¸€æ¡å­—èŠ‚ç åœ¨æ‰§è¡Œæ—¶ï¼Œæ˜¯éœ€è¦è¿è¡Œå¤šæ¡æŒ‡ä»¤æ‰èƒ½å®žçŽ°ã€‚&lt;/p>
&lt;p>å®žçŽ°æ–¹å¼ï¼šå†…å­˜å±éšœã€‚é‡æŽ’åºæ—¶ï¼Œä¸èƒ½æŠŠåŽé¢çš„æŒ‡ä»¤é‡æŽ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ã€‚&lt;/p>
&lt;p>ä¿è¯ï¼šä¹‹å‰çš„æŒ‡ä»¤ä¸€å®šå…¨éƒ¨æ‰§è¡Œï¼Œä¹‹åŽçš„æŒ‡ä»¤ä¸€å®šéƒ½æ²¡æœ‰æ‰§è¡Œï¼Œå¹¶ä¸”å‰é¢è¯­å¥çš„ç»“æžœå¯¹åŽé¢çš„è¯­å¥å¯è§ã€‚&lt;/p>
&lt;h2 id="happens-before-åŽŸåˆ™">happens-before åŽŸåˆ™&lt;/h2>
&lt;p>å¯¹äºŽä¸¤ä¸ªæ“ä½œ A å’Œ Bï¼Œè¿™ä¸¤ä¸ªæ“ä½œå¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚å¦‚æžœ A happens-before Bï¼ˆA ä¼˜å…ˆäºŽ B æ‰§è¡Œï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ä¿è¯ï¼Œå½“ A æ“ä½œå®ŒåŽï¼ŒA çš„æ“ä½œå¯¹äºŽ B æ“ä½œæ˜¯å¯è§çš„ã€‚&lt;/p>
&lt;p>æŒ‡ä»¤é‡æŽ’æé«˜äº†å¹¶å‘æ€§èƒ½ï¼Œä½†æ˜¯ Java è™šæ‹Ÿæœºä¼šå¯¹æŒ‡ä»¤é‡æŽ’åšä¸€äº›è§„åˆ™é™åˆ¶ï¼Œå¹¶ä¸èƒ½è®©æ‰€æœ‰çš„æŒ‡ä»¤éƒ½éšæ„æ”¹å˜æ‰§è¡Œä½ç½®ã€‚&lt;/p>
&lt;p>Java å†…å­˜æ¨¡åž‹å¤©ç„¶çš„å…ˆè¡Œå‘ç”Ÿå…³ç³»ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¨‹åºé¡ºåºè§„åˆ™&lt;/p>
&lt;p>åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼Œå‰é¢çš„ä»£ç æ“ä½œä¼˜äºŽåŽé¢çš„ä»£ç æ“ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é”å®šè§„åˆ™&lt;/p>
&lt;p>ä¸€ä¸ª unlock æ“ä½œä¼˜äºŽåŽé¢å¯¹äºŽåŒä¸€ä¸ªé”çš„ lock æ“ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>volatile è§„åˆ™&lt;/p>
&lt;p>ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œï¼Œä¼˜äºŽåŽé¢è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¼ é€’è§„åˆ™&lt;/p>
&lt;p>å¦‚æžœ A happens-before Bï¼Œä¸” B happens-before Cï¼Œé‚£ä¹ˆ A happens-before Cã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>çº¿ç¨‹å¯åŠ¨è§„åˆ™&lt;/p>
&lt;p>Thread å¯¹è±¡çš„ start() æ–¹æ³• happens-before çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œã€‚&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>ç±»åŠ è½½å™¨</title><link>https://www.letout.cn/p/java/jvm/classloader/</link><pubDate>Sat, 06 Aug 2022 16:02:02 +0800</pubDate><guid>https://www.letout.cn/p/java/jvm/classloader/</guid><description>&lt;img src="https://www.letout.cn/imgs/25.jpeg" alt="Featured image of post ç±»åŠ è½½å™¨" />&lt;h2 id="ç±»åŠ è½½å™¨">ç±»åŠ è½½å™¨&lt;/h2>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/classloader/menu.png"
width="1707"
height="638"
srcset="https://www.letout.cn/p/java/jvm/classloader/menu_hu8b8ca38d973bcbde05d207eb8795320e_321907_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/classloader/menu_hu8b8ca38d973bcbde05d207eb8795320e_321907_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="menu"
class="gallery-image"
data-flex-grow="267"
data-flex-basis="642px"
>&lt;/p>
&lt;h3 id="-bootstrapclassloader">ðŸ™ˆ BootstrapClassLoader&lt;/h3>
&lt;p>å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œæœ€é¡¶å±‚çš„åŠ è½½ç±»ï¼Œç”± C/C++ å®žçŽ°ã€‚&lt;/p>
&lt;p>è´Ÿè´£åŠ è½½ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>%JAVA_HOME%/lib&lt;/code> ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»&lt;/li>
&lt;li>è¢« &lt;code>-Xbootclasspath&lt;/code> å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="-extensionclassloader">ðŸ™‰ ExtensionClassLoader&lt;/h3>
&lt;p>æ‰©å±•ç±»åŠ è½½å™¨ã€‚&lt;/p>
&lt;p>æ˜¯ä¸€ç§ Java ç³»ç»Ÿç±»åº“çš„æ‰©å±•æœºåˆ¶ã€‚è´Ÿè´£åŠ è½½ &lt;code>%JRE_HOME%/lib/ext&lt;/code> ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»ï¼Œæˆ–è¢« &lt;code>java.ext.dirs&lt;/code> ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„ jar åŒ…ã€‚&lt;/p>
&lt;h3 id="-applicationclassloader">ðŸ™Š ApplicationClassLoader&lt;/h3>
&lt;p>é¢å‘ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½å½“å‰åº”ç”¨ &lt;code>classpath&lt;/code> ä¸‹çš„æ‰€æœ‰ jar åŒ…å’Œç±»ã€‚&lt;/p>
&lt;h2 id="åŒäº²å§”æ´¾æ¨¡åž‹">åŒäº²å§”æ´¾æ¨¡åž‹&lt;/h2>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/classloader/classloader.png"
width="1279"
height="699"
srcset="https://www.letout.cn/p/java/jvm/classloader/classloader_hu2885d6b96687a867396da9eda76d4bf0_289144_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/classloader/classloader_hu2885d6b96687a867396da9eda76d4bf0_289144_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="classloader"
class="gallery-image"
data-flex-grow="182"
data-flex-basis="439px"
>&lt;/p>
&lt;p>æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼Œç”¨ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº†åŒä¸€ä¸ªé™å®šåçš„ç±»ï¼ŒJVM ä¹Ÿä¼šè®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protected&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">loadClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">resolve&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">ClassNotFoundException&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">getClassLoadingLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// (1) åˆ¤æ–­æ˜¯å¦åŠ è½½è¿‡è¯¥ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findLoadedClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">long&lt;/span> &lt;span class="n">t0&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">nanoTime&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">parent&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parent&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">loadClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// (2) parent == null çº¦å®šä¸ºï¼šparnet ä¸º Bootstracp ClassLoader
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findBootstrapClassOrNull&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ClassNotFoundException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ClassNotFoundException thrown if class not found
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// from the non-null parent class loader
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// (3) è¯´æ˜Ž parent åŠ è½½ä¸äº†ï¼Œå½“å‰ loader å°è¯•åŠ è½½ class
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">t1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">nanoTime&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// this is the defining class loader; record the stats
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">sun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">misc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PerfCounter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getParentDelegationTime&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">addTime&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">t0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">misc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PerfCounter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getFindClassTime&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">addElapsedTimeFrom&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">misc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PerfCounter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getFindClasses&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">increment&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">resolve&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resolveClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé™å®šåçš„ç±»åªä¼šè¢«ä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½å¹¶è§£æžä½¿ç”¨ï¼Œåœ¨ç¨‹åºä¸­æ˜¯å”¯ä¸€çš„ï¼Œä¸ä¼šäº§ç”Ÿæ­§ä¹‰ã€‚&lt;/p>
&lt;p>åœ¨åŠ è½½æ—¶ï¼Œé¦–å…ˆä¼šåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ï¼Œå¦‚æžœå·²ç»åŠ è½½ï¼Œä¼šç›´æŽ¥è¿”å›žï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ã€‚&lt;/p>
&lt;p>å°è¯•åŠ è½½æ—¶ï¼Œä¸ä¼šè‡ªå·±è¿›è¡ŒåŠ è½½ï¼Œè€Œæ˜¯å°†è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œå½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œæ‰ä¼šç”±è‡ªå·±å¤„ç†ã€‚&lt;/p></description></item><item><title>ç±»åŠ è½½æœºåˆ¶</title><link>https://www.letout.cn/p/java/jvm/class-loading/</link><pubDate>Sat, 06 Aug 2022 13:02:02 +0800</pubDate><guid>https://www.letout.cn/p/java/jvm/class-loading/</guid><description>&lt;img src="https://www.letout.cn/imgs/24.jpeg" alt="Featured image of post ç±»åŠ è½½æœºåˆ¶" />&lt;h2 id="java-ç±»ç”Ÿå‘½å‘¨æœŸ">Java ç±»ç”Ÿå‘½å‘¨æœŸ&lt;/h2>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/class-loading/life.png"
width="973"
height="331"
srcset="https://www.letout.cn/p/java/jvm/class-loading/life_hue0715323a61c74c3a1d0de4b0a99146c_113100_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/class-loading/life_hue0715323a61c74c3a1d0de4b0a99146c_113100_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="java-class-life"
class="gallery-image"
data-flex-grow="293"
data-flex-basis="705px"
>&lt;/p>
&lt;h2 id="ç±»åŠ è½½è¿‡ç¨‹">ç±»åŠ è½½è¿‡ç¨‹&lt;/h2>
&lt;p>ç±»åŠ è½½ä¸»è¦æœ‰ä¸‰æ­¥ï¼š&lt;code>åŠ è½½ - é“¾æŽ¥ - åˆå§‹åŒ–&lt;/code>ã€‚&lt;/p>
&lt;h3 id="-åŠ è½½">ðŸ¥Ž åŠ è½½&lt;/h3>
&lt;p>åŠ è½½æ˜¯ä¸€ä¸ªè¯»å– Class æ–‡ä»¶ï¼Œå°†å…¶è½¬åŒ–ä¸ºæŸç§é™æ€æ•°æ®ç»“æž„å­˜å‚¨åœ¨æ–¹æ³•åŒºå†…ï¼Œå¹¶åœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªä¾¿äºŽè°ƒç”¨çš„ &lt;code>java.lang.Class&lt;/code> ç±»åž‹çš„å¯¹è±¡çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/class-loading/loading.png"
width="707"
height="335"
srcset="https://www.letout.cn/p/java/jvm/class-loading/loading_hu8b469e8111e2814cd40ca0f04de26462_22328_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/class-loading/loading_hu8b469e8111e2814cd40ca0f04de26462_22328_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="loading"
class="gallery-image"
data-flex-grow="211"
data-flex-basis="506px"
>&lt;/p>
&lt;p>åˆ†ä¸ºä¸‰æ­¥è¿›è¡Œï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>èŽ·å–å®šä¹‰ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼ˆä¸é™åˆ¶ä»Žå“ªé‡ŒèŽ·å–ï¼Œå¯ä»¥ä»Žæ–‡ä»¶ã€ç½‘ç»œã€å³æ—¶ç”Ÿæˆï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°†å­—èŠ‚æµä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æž„ï¼Œè½¬æ¢æˆæ–¹æ³•åŒºä¸­è¿è¡Œæ—¶æ•°æ®ç»“æž„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ &lt;code>java.lang.Class&lt;/code> å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®è®¿é—®å…¥å£&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-é“¾æŽ¥">ðŸ¥Ž é“¾æŽ¥&lt;/h3>
&lt;h4 id="-éªŒè¯">âš¾ï¸ éªŒè¯&lt;/h4>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/class-loading/verify.png"
width="915"
height="390"
srcset="https://www.letout.cn/p/java/jvm/class-loading/verify_hu8c1a3959f1e343b5f02da51e1aaf01f3_138925_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/class-loading/verify_hu8c1a3959f1e343b5f02da51e1aaf01f3_138925_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="verify"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="563px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ–‡ä»¶æ ¼å¼éªŒè¯&lt;/p>
&lt;p>éªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆ Class æ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œèƒ½è¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ã€‚&lt;strong>å‘ç”Ÿåœ¨åŠ è½½é˜¶æ®µ&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…ƒæ•°æ®ã€å­—èŠ‚ç éªŒè¯&lt;/p>
&lt;p>å¯¹å­—èŠ‚ç è¿›è¡Œè¯­æ³•ã€è¯­ä¹‰çš„åˆ†æžï¼Œä¿è¯å…¶ç¬¦åˆ Java è™šæ‹Ÿæœºçš„è§„èŒƒï¼Œä¸ä¼šæœ‰å±å®³è™šæ‹Ÿæœºçš„è¡Œä¸ºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¬¦å·å¼•ç”¨éªŒè¯&lt;/p>
&lt;p>ç¡®ä¿è§£æžè¡Œä¸ºèƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚&lt;strong>å‘ç”Ÿåœ¨è§£æžé˜¶æ®µ&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="-å‡†å¤‡">âš¾ï¸ å‡†å¤‡&lt;/h4>
&lt;p>ä¸ºç±»ä¸­å®šä¹‰çš„å˜é‡ï¼ˆé™æ€å˜é‡ &lt;code>static&lt;/code>ï¼‰åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡é›¶å€¼çš„é˜¶æ®µã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/class-loading/prepare.png"
width="482"
height="260"
srcset="https://www.letout.cn/p/java/jvm/class-loading/prepare_hu58a397643ad84aca2032de9a3ac6155c_29464_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/class-loading/prepare_hu58a397643ad84aca2032de9a3ac6155c_29464_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="prepare"
class="gallery-image"
data-flex-grow="185"
data-flex-basis="444px"
>&lt;/p>
&lt;ul>
&lt;li>&lt;code>static&lt;/code> -&amp;gt; èµ‹é›¶å€¼&lt;/li>
&lt;li>&lt;code>static final&lt;/code> -&amp;gt; èµ‹å®šä¹‰çš„å¸¸é‡å€¼&lt;/li>
&lt;/ul>
&lt;h4 id="-è§£æž">âš¾ï¸ è§£æž&lt;/h4>
&lt;p>è§£æžæ˜¯å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æŽ¥å¼•ç”¨ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¬¦å·å¼•ç”¨ï¼šæè¿°å¼•ç”¨å¯¹è±¡çš„ç¬¦å·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç›´æŽ¥å¼•ç”¨ï¼šæŒ‡å‘ç›®æ ‡å®žé™…åœ°å€çš„æŒ‡é’ˆ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ðŸŽ¾ è§£æžéƒ¨åˆ†æ˜¯çµæ´»çš„ï¼Œå¯ä»¥åœ¨åˆå§‹åŒ–çŽ¯èŠ‚åŽå†è¿›è¡Œï¼Œå®žçŽ°æ‰€è°“çš„â€œåŽæœŸç»‘å®šâ€ã€‚ï¼ˆæ–¹æ³•è°ƒç”¨ç›´åˆ°è¿è¡Œæ—¶æ‰ä¼šè§£æžï¼Œå› ä¸ºæ— æ³•åœ¨ç¼–è¯‘æ—¶ç¡®å®šæ–¹æ³•è°ƒç”¨æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ‰€ä»¥æ–¹æ³•å®šä¹‰å’Œæ–¹æ³•è°ƒç”¨ç›´åˆ°è¿è¡Œæ—¶æ‰ç»‘å®šã€‚ï¼‰&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/class-loading/resolve_1.png"
width="163"
height="370"
srcset="https://www.letout.cn/p/java/jvm/class-loading/resolve_1_hua9ef48196efa3564a4ef1eaa93606c3a_10102_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/class-loading/resolve_1_hua9ef48196efa3564a4ef1eaa93606c3a_10102_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="resolve"
class="gallery-image"
data-flex-grow="44"
data-flex-basis="105px"
>&lt;/p>
&lt;p>å½“ä¸€ä¸ªç±»è¢«ç¼–è¯‘æˆ Class ä¹‹åŽï¼Œå‡è®¾è¿™ä¸ªç±»ç§°ä¸º &lt;code>A&lt;/code>ï¼Œå¹¶ä¸”åœ¨ç±» &lt;code>A&lt;/code> ä¸­å¼•ç”¨äº†ç±» &lt;code>B&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åœ¨ç¼–è¯‘é˜¶æ®µï¼Œ&lt;code>A&lt;/code> æ— æ³•ç¡®å®š &lt;code>B&lt;/code> æ˜¯å¦è¢«ç¼–è¯‘ï¼ˆçŽ°åœ¨ &lt;code>B&lt;/code> ä¸€å®šæœªåŠ è½½ï¼‰ï¼Œæ­¤æ—¶ &lt;code>A&lt;/code> æ— æ³•çŸ¥é“ &lt;code>B&lt;/code> çš„å®žé™…åœ°å€ï¼Œæ‰€æœ‰åœ¨ &lt;code>A.Class&lt;/code> ä¸­ï¼Œä¼šä½¿ç”¨ä¸€ä¸ª&lt;code>å­—ç¬¦ä¸²&lt;/code>ä»£è¡¨ &lt;code>B&lt;/code>ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²è¢«ç§°ä¸º&lt;strong>ç¬¦å·å¼•ç”¨&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨è¿è¡Œé˜¶æ®µï¼Œ&lt;code>A&lt;/code> å‘ç”Ÿäº†åŠ è½½ï¼Œåœ¨è§£æžæ—¶ï¼Œå‘çŽ°å…¶ä¸­çš„ &lt;code>B&lt;/code> è¿˜æœªè¢«åŠ è½½ï¼Œå°±ä¼šè§¦å‘ç±» &lt;code>B&lt;/code> çš„åŠ è½½ï¼Œå°† &lt;code>B&lt;/code> åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­ã€‚æ­¤æ—¶ï¼Œ&lt;code>A&lt;/code> ä¸­çš„ç¬¦å·å¼•ç”¨ä¼šè¢«æ›¿æ¢ä¸º &lt;code>B&lt;/code> ä¸­çš„å®žé™…åœ°å€ï¼ˆä¹Ÿå°±æ˜¯ç›´æŽ¥å¼•ç”¨ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/class-loading/resolve.png"
width="922"
height="538"
srcset="https://www.letout.cn/p/java/jvm/class-loading/resolve_hu45e5622ef4d0eaddcde37871cfee2a7a_117190_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/class-loading/resolve_hu45e5622ef4d0eaddcde37871cfee2a7a_117190_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="resolve"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="411px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é™æ€è§£æž&lt;/p>
&lt;p>ç±» &lt;code>B&lt;/code> æ˜¯å…·ä½“çš„å®žçŽ°ç±»ï¼Œè§£æžçš„å¯¹è±¡ååˆ†æ˜Žç¡®ï¼Œå³ä¼šè¿›è¡Œé™æ€è§£æžã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŠ¨æ€è§£æž&lt;/p>
&lt;p>Java é€šè¿‡åŽæœŸç»‘å®šçš„æ–¹å¼å®žçŽ°å¤šæ€ï¼Œé€šè¿‡åŠ¨æ€è§£æžå®žçŽ°ã€‚&lt;/p>
&lt;p>å¦‚æžœç±» &lt;code>B&lt;/code> æ˜¯æŠ½è±¡ç±»æˆ–è€…æŽ¥å£ï¼Œæœ‰å…·ä½“çš„å®žçŽ°ç±» &lt;code>C&lt;/code>ã€&lt;code>D&lt;/code>ï¼Œå½“å‰å…·ä½“çš„å®žçŽ°æ–¹å¼å¹¶ä¸æ˜Žç¡®ï¼Œæ— æ³•ç¡®å®šä½¿ç”¨å“ªä¸ªå…·ä½“å®žçŽ°ã€‚&lt;/p>
&lt;p>ç›´åˆ°è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†è°ƒç”¨ï¼Œè™šæ‹Ÿæœºè°ƒç”¨æ ˆä¸­ä¼šå¾—åˆ°å…·ä½“ç±»çš„ä¿¡æ¯ï¼Œå†è¿›è¡Œè§£æžï¼Œå°±æœ‰æ˜Žç¡®çš„ç›´æŽ¥å¼•ç”¨ä»£æ›¿ç¬¦å·å¼•ç”¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-åˆå§‹åŒ–">ðŸ¥Ž åˆå§‹åŒ–&lt;/h3>
&lt;p>è™šæ‹ŸæœºçœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­ç¼–å†™çš„ä»£ç ï¼Œå®Œæˆä¸€äº›ä¸»åŠ¨çš„èµ„æºåˆå§‹åŒ–åŠ¨ä½œã€‚&lt;/p>
&lt;p>&lt;strong>æ‰§è¡Œçš„æ˜¯ç±»å±‚é¢çš„åˆå§‹åŒ–ã€‚&lt;/strong> åªæœ‰æ˜¾å¼è°ƒç”¨ new æ‰ä¼šæ‰§è¡Œæž„é€ å‡½æ•°çš„åˆå§‹åŒ–ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/java/jvm/class-loading/init.png"
width="533"
height="388"
srcset="https://www.letout.cn/p/java/jvm/class-loading/init_hud5162327100fcc16da85dffebeccc0e0_46268_480x0_resize_box_3.png 480w, https://www.letout.cn/p/java/jvm/class-loading/init_hud5162327100fcc16da85dffebeccc0e0_46268_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="init"
class="gallery-image"
data-flex-grow="137"
data-flex-basis="329px"
>&lt;/p>
&lt;ul>
&lt;li>ç±»å˜é‡ï¼ˆé™æ€å˜é‡ï¼‰çš„èµ‹å€¼ &lt;code>static&lt;/code>&lt;/li>
&lt;li>é™æ€ä»£ç å— &lt;code>static { }&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="å¦‚ä½•åˆ¤æ–­æ— ç”¨ç±»">å¦‚ä½•åˆ¤æ–­æ— ç”¨ç±»&lt;/h2>
&lt;ul>
&lt;li>è¯¥ç±»çš„æ‰€æœ‰å®žä¾‹å¯¹è±¡å…¨éƒ¨è¢« GCï¼Œåœ¨å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®žä¾‹å¯¹è±¡&lt;/li>
&lt;li>è¯¥ç±»å¯¹åº”çš„ &lt;code>java.lang.Class&lt;/code> å¯¹è±¡ï¼Œåœ¨ä»»ä½•åœ°æ–¹éƒ½æ²¡æœ‰è¢«å¼•ç”¨&lt;/li>
&lt;li>è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›žæ”¶&lt;/li>
&lt;/ul>
&lt;p>æ»¡è¶³ä»¥ä¸Šä¸‰ä¸ªæ¡ä»¶ï¼Œè¯´æ˜Žè¯¥ç±»å¯ä»¥è¢«å›žæ”¶ï¼Œä½†æ˜¯ä¸Žå¯¹è±¡ä¸åŒï¼Œæ— ç”¨ç±»ä¸ä¸€å®šä¼šè¢«å›žæ”¶ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://javaguide.cn/java/jvm/class-loading-process.html" target="_blank" rel="noopener"
>https://javaguide.cn/java/jvm/class-loading-process.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.bilibili.com/video/BV14U4y1L75q/?spm_id_from=333.788" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV14U4y1L75q/?spm_id_from=333.788&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>SQL è¯­å¥ä¼˜åŒ–</title><link>https://www.letout.cn/p/mysql/sql-optimize/</link><pubDate>Fri, 01 Jul 2022 18:02:02 +0800</pubDate><guid>https://www.letout.cn/p/mysql/sql-optimize/</guid><description>&lt;img src="https://www.letout.cn/imgs/20.jpeg" alt="Featured image of post SQL è¯­å¥ä¼˜åŒ–" />&lt;blockquote>
&lt;p>ðŸ”¥ ä¸»è¦æ€è·¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸš€ å¢žåŠ æ•°æ®æ—¶ï¼Œå°½é‡é¡ºåºæ’å…¥&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸš€ åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå°½é‡èµ°ç´¢å¼•æ“ä½œ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="-ä¸»é”®ä¼˜åŒ–">ðŸˆâ€â¬› ä¸»é”®ä¼˜åŒ–&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>â­ æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½Žä¸»é”®çš„é•¿åº¦ï¼Œå‡å°‘ç£ç›˜ IO&lt;/p>
&lt;/li>
&lt;li>
&lt;p>â­ æ’å…¥æ•°æ®å°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨ auto_increment è‡ªå¢žä¸»é”®&lt;/p>
&lt;/li>
&lt;li>
&lt;p>â­ å°½é‡ä¸è¦ä½¿ç”¨ UUID æˆ–å…¶ä»–è‡ªç„¶ä¸»é”®ï¼ˆå¦‚èº«ä»½è¯å·ï¼‰ ä½œä¸ºä¸»é”®&lt;/p>
&lt;/li>
&lt;li>
&lt;p>â­ ä¸šåŠ¡æ“ä½œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨ InnoDB å­˜å‚¨å¼•æ“Žä¸­ï¼Œè¡¨æ•°æ®æ˜¯æ ¹æ®ä¸»é”®é¡ºåºç»„ç»‡å­˜æ”¾çš„ã€‚è¿™ç§å­˜å‚¨æ–¹å¼ä¸ºç´¢å¼•ç»„ç»‡è¡¨ï¼ˆindex organized table IOTï¼‰ã€‚&lt;/p>
&lt;p>æ•°æ®è¡Œæ˜¯è®°å½•åœ¨é€»è¾‘ç»“æž„ page é¡µä¸­çš„ï¼Œè€Œæ¯ä¸€ä¸ªé¡µçš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œé»˜è®¤ 16Kã€‚ä¹Ÿå°±æ„å‘³ç€ï¼Œä¸€ä¸ªé¡µä¸­æ‰€å­˜å‚¨çš„è¡Œä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå¦‚æžœæ’å…¥çš„æ•°æ®è¡Œåœ¨è¯¥é¡µå­˜å‚¨ä¸ä¸‹ï¼Œå°†ä¼šå­˜å‚¨åˆ°ä¸‹ä¸€ä¸ªé¡µä¸­ï¼Œé¡µä¸Žé¡µä¹‹é—´ä¼šé€šè¿‡æŒ‡é’ˆè¿žæŽ¥ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="-insert-ä¼˜åŒ–">ðŸ¦® insert ä¼˜åŒ–&lt;/h2>
&lt;p>ä¸€æ¬¡æ€§å¾€æ•°æ®åº“ä¸­æ’å…¥å¤šæ¡æ•°æ®ï¼Œå¯ä»Žä»¥ä¸‹ä¸‰æ–¹é¢ä¼˜åŒ–ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰¹é‡æ’å…¥æ•°æ®&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ‰‹åŠ¨æŽ§åˆ¶äº‹åŠ¡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">transaction&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">commit&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ä¸»é”®é¡ºåºæ’å…¥&lt;/li>
&lt;/ul>
&lt;p>æ•°æ®åœ¨ B+ æ ‘çš„å¶å­èŠ‚ç‚¹æœ‰åºå­˜æ”¾ï¼Œé¡ºåºæ’å…¥ä¿éšœæ¯æ¬¡æ’å…¥éƒ½æ˜¯åœ¨åŽé¢æ·»åŠ ä¸€æ¡è®°å½•ï¼ˆé¡ºåºç£ç›˜ IOï¼‰ï¼Œä¸éœ€è¦è°ƒæ•´å¶å­èŠ‚ç‚¹ä¸­çš„å†…å®¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ðŸ™…â€â™‚ï¸ ä¸»é”®ä¹±åºæ’å…¥ : 8 1 9 21 88 2 4 15 89 5 7 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ðŸ™‹â€ ä¸»é”®é¡ºåºæ’å…¥ : 1 2 3 4 5 7 8 9 15 21 88 89
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-update-ä¼˜åŒ–">ðŸ¦› update ä¼˜åŒ–&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>ðŸ«§ é˜²æ­¢ç´¢å¼•å¤±æ•ˆ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ«§ é˜²æ­¢å‡çº§ä¸ºè¡¨é”&lt;/p>
&lt;p>InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•åŠ çš„é”ï¼Œå¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™ä¼šä»Žè¡Œé”å‡çº§ä¸ºè¡¨é”ã€‚&lt;/p>
&lt;p>å¼€å¯å¤šä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œ SQL æ—¶ï¼Œé˜²æ­¢è¡Œé”å‡çº§ä¸ºè¡¨é”ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-order-by-ä¼˜åŒ–">ðŸ¦’ order by ä¼˜åŒ–&lt;/h2>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;ul>
&lt;li>
&lt;p>ðŸ€ æ ¹æ®æŽ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å¤šå­—æ®µæŽ’åºæ—¶ï¼Œå°½é‡éµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å°½é‡ä½¿ç”¨ç´¢å¼• / è¦†ç›–ç´¢å¼• &lt;!-- raw HTML omitted -->&lt;/p>
&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="-limit-ä¼˜åŒ–">ðŸŽ limit ä¼˜åŒ–&lt;/h2>
&lt;p>åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œå¦‚æžœè¿›è¡Œ limit åˆ†é¡µæŸ¥è¯¢ï¼Œåœ¨æŸ¥è¯¢æ—¶ï¼Œè¶Šå¾€åŽï¼Œåˆ†é¡µæŸ¥è¯¢æ•ˆçŽ‡è¶Šä½Žã€‚&lt;/p>
&lt;p>å½“åœ¨è¿›è¡Œåˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œå¦‚æžœæ‰§è¡Œ &lt;code>limit 2000000,10&lt;/code> ï¼Œæ­¤æ—¶ MySQL ä¼šæŽ’åºå‰ 2000010 æ¡çš„è®°å½•ï¼Œ
ä»…ä»…è¿”å›ž 2000000 - 2000010 çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¼šè¢«ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æŽ’åºçš„ä»£ä»·éžå¸¸å¤§ã€‚&lt;/p>
&lt;p>ä¼˜åŒ–æ€è·¯:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŽˆ åœ¨ä¸šä½™å…è®¸çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é™åˆ¶é¡µæ•°ã€‚é€šå¸¸ç”¨æˆ·ä¹Ÿä¸ä¼šå‘åŽé¢ç¿»å¾ˆå¤šé¡µã€‚&lt;/p>
&lt;p>ä¾‹å¦‚åœ¨æ·˜å®åŒåä¸€æ—¶ä¸èƒ½æŸ¥è¯¢åŽ†å²è´­ç‰©è®°å½•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽˆ å¯ä»¥é€šè¿‡å…ˆå®šä½æ•°æ®ï¼Œå…ˆåç§»ï¼Œå† limit&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">user&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2000000&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸŽˆ é€šè¿‡è¦†ç›–ç´¢å¼• + å­æŸ¥è¯¢å½¢å¼è¿›è¡Œä¼˜åŒ–&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">user&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">user&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2000000&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- or
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">user&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_sku&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2000000&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;/ul>
&lt;h2 id="-count-ä¼˜åŒ–">ðŸ¦¬ count ä¼˜åŒ–&lt;/h2>
&lt;p>&lt;code>count(*) == count(æ•°å­—) &amp;gt; count(ä¸»é”®) &amp;gt; count(å­—æ®µ)&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>â­ count(ä¸»é”®)&lt;/p>
&lt;ul>
&lt;li>InnoDB å¼•æ“Žä¼šéåŽ†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„ ä¸»é”®id å€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›žç»™æœåŠ¡å±‚ã€‚æœåŠ¡å±‚æ‹¿åˆ°ä¸»é”®åŽï¼ŒæŒ‰è¡Œè¿›è¡Œç´¯åŠ ï¼ˆä¸»é”®ä¸å¯èƒ½ä¸ºnullï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>â­ count(å­—æ®µ)ï¼ˆæ³¨æ„ null çº¦æŸï¼‰&lt;/p>
&lt;ul>
&lt;li>æ²¡æœ‰ not null çº¦æŸ: InnoDB å¼•æ“Žä¼šéåŽ†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›žç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚åˆ¤æ–­æ˜¯å¦ä¸º nullï¼Œä¸ä¸º nullï¼Œå°±è®¡æ•°ç´¯åŠ ã€‚&lt;/li>
&lt;li>æœ‰ not null çº¦æŸï¼šInnoDB å¼•æ“Žä¼šéåŽ†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›žç»™æœåŠ¡å±‚ï¼Œç›´æŽ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>â­ count(æ•°å­—)&lt;/p>
&lt;ul>
&lt;li>InnoDB å¼•æ“ŽéåŽ†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚æœåŠ¡å±‚å¯¹äºŽè¿”å›žçš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­— â€œ1â€ è¿›åŽ»ï¼Œç›´æŽ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>â­ count(*)&lt;/p>
&lt;ul>
&lt;li>InnoDBå¼•æ“Žå¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ï¼ŒæœåŠ¡å±‚ç›´æŽ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>InnoDB å­˜å‚¨å¼•æ“Ž</title><link>https://www.letout.cn/p/mysql/innodb/</link><pubDate>Fri, 01 Jul 2022 13:01:02 +0800</pubDate><guid>https://www.letout.cn/p/mysql/innodb/</guid><description>&lt;img src="https://www.letout.cn/p/mysql/innodb/innodb.webp" alt="Featured image of post InnoDB å­˜å‚¨å¼•æ“Ž" />&lt;h2 id="äº‹åŠ¡">äº‹åŠ¡&lt;/h2>
&lt;p>äº‹åŠ¡æ˜¯ä¸€ç»„é€»è¾‘ä¸Šçš„æ•°æ®åº“æ“ä½œï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>A&lt;/code> åŽŸå­æ€§ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>C&lt;/code> ä¸€è‡´æ€§ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>I&lt;/code> éš”ç¦»æ€§ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹çŽ¯å¢ƒä¸‹è¿è¡Œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>D&lt;/code> æŒä¹…æ€§ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›žæ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/innodb/1.png"
width="869"
height="333"
srcset="https://www.letout.cn/p/mysql/innodb/1_hu3fd49fc1a58d123f3498503f7ff7204f_68265_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/innodb/1_hu3fd49fc1a58d123f3498503f7ff7204f_68265_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="260"
data-flex-basis="626px"
>&lt;/p>
&lt;p>C(ä¸€è‡´æ€§)æ˜¯ç›®çš„ï¼ŒA(åŽŸå­æ€§)ã€I(éš”ç¦»æ€§)ã€D(æŒä¹…æ€§)æ˜¯æ˜¯ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ•°æ®åº“æä¾›çš„æ‰‹æ®µã€‚&lt;/p>
&lt;h2 id="-redo-log">ðŸ”ƒ redo log&lt;/h2>
&lt;p>é‡åšæ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œæŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ã€‚ï¼ˆç‰©ç†æ—¥å¿—ï¼‰&lt;/p>
&lt;p>redo log ç”¨æ¥ä¿éšœæ•°æ®åº“çš„æŒä¹…æ€§ã€‚åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ‰§è¡Œå¢žåˆ æ”¹çš„æ“ä½œæ—¶ï¼ŒInnoDB å¼•æ“Žä¼šå…ˆæ“ä½œç¼“å†²æ±  Buffer Pool ä¸­çš„æ•°æ®ï¼Œå¦‚æžœç¼“å†²åŒºæ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œä¼šé€šè¿‡åŽå°çº¿ç¨‹å°†ç£ç›˜ä¸­çš„æ•°æ®åŠ è½½å‡ºæ¥ï¼Œå­˜æ”¾åœ¨ç¼“å†²åŒºä¸­ï¼Œå†å°†ç¼“å†²æ± ä¸­çš„æ•°æ®ä¿®æ”¹ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/innodb/redolog.png"
width="889"
height="359"
srcset="https://www.letout.cn/p/mysql/innodb/redolog_huec6805565d40a88bf7c70b51e3ee84c7_38212_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/innodb/redolog_huec6805565d40a88bf7c70b51e3ee84c7_38212_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="redolog"
class="gallery-image"
data-flex-grow="247"
data-flex-basis="594px"
>&lt;/p>
&lt;p>ä¿®æ”¹åŽçš„æ•°æ®é¡µæˆ‘ä»¬ç§°ä¸ºè„é¡µï¼Œç¼“å†²åŒºçš„è„é¡µæ•°æ®å¹¶ä¸æ˜¯å®žæ—¶åˆ·æ–°çš„ï¼Œè€Œæ˜¯ä¸€æ®µæ—¶é—´ä¹‹åŽå°†ç¼“å†²åŒºçš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼ˆéšæœºç£ç›˜ IOï¼‰ï¼Œä»Žè€Œä¿è¯ç¼“å†²åŒºä¸Žç£ç›˜çš„æ•°æ®ä¸€è‡´ã€‚&lt;/p>
&lt;p>å¯¹ç¼“å†²åŒºçš„æ•°æ®è¿›è¡Œå¢žåˆ æ”¹ï¼Œä¼šé¦–å…ˆå°†æ“ä½œçš„æ•°æ®é¡µçš„å˜åŒ–ï¼Œè®°å½•åœ¨ redo log buffer ä¸­ã€‚åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œå°† redo log buffer ä¸­çš„æ•°æ®åˆ·æ–°åˆ° redo log ç£ç›˜æ–‡ä»¶ä¸­ï¼ˆé¡ºåºç£ç›˜ IOï¼‰ã€‚&lt;/p>
&lt;p>å¦‚æžœåˆ·æ–°ç¼“å†²åŒºçš„è„é¡µåˆ°ç£ç›˜æ—¶å‘ç”Ÿé”™è¯¯ï¼Œæˆ–è€…å‘ç”Ÿäº†å¼‚å¸¸æ–­ç”µï¼Œå°±å¯ä»¥å€ŸåŠ©äºŽ redo log è¿›è¡Œæ•°æ®æ¢å¤ï¼Œè¿™æ ·å°±ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€‚&lt;/p>
&lt;h2 id="-undo-log">ðŸ”™ undo log&lt;/h2>
&lt;p>å›žæ»šæ—¥å¿—ã€‚è®°å½•æ“ä½œæ•°æ®åº“çš„é€†æ“ä½œï¼Œç”¨äºŽè¿›è¡Œå›žæ»šã€‚&lt;/p>
&lt;p>ä½œç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>æä¾›å›žæ»šæ“ä½œï¼ˆä¿éšœäº‹åŠ¡çš„åŽŸå­æ€§ï¼‰&lt;/li>
&lt;li>å®žçŽ° MVCC æ“ä½œï¼Œæå‡æ•°æ®åº“æ€§èƒ½&lt;/li>
&lt;/ul>
&lt;p>undo log æ˜¯é€»è¾‘æ—¥å¿—ï¼Œåœ¨ InnoDB å­˜å‚¨å¼•æ“Žå¯¹è®°å½•è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¼šæŠŠå›žæ»šéœ€è¦çš„ä¿¡æ¯å…¨éƒ¨è®°å½•åˆ° undo ä¸­ï¼Œå¦‚æžœå‘ç”Ÿå›žæ»šï¼Œå°±ä¼šè¯»å– undo logï¼Œç„¶åŽæ‰§è¡Œä¸Žä¹‹ç›¸åçš„æ“ä½œã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>âž• æ’å…¥æ•°æ®ï¼Œè®°å½•è¿™æ¡æ•°æ®çš„ä¸»é”®ï¼Œå›žæ»šæ—¶æ ¹æ®ä¸»é”®æŠŠè¯¥æ¡è®°å½•åˆ é™¤&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âž– åˆ é™¤æ•°æ®ï¼Œè®°å½•è¿™æ¡æ•°æ®çš„æ‰€æœ‰å†…å®¹ï¼Œå›žæ»šæ—¶å°†è¿™äº›å†…å®¹ç»„æˆçš„è®°å½•æ’å…¥è¡¨ä¸­&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ–‹ï¸ æ›´æ–°æ•°æ®ï¼Œ&lt;/p>
&lt;ul>
&lt;li>æ›´æ–°äº†ä¸»é”®ï¼Œä¼šè®°å½•ä¸¤æ¡ undo logï¼Œä¸€æ¡åˆ é™¤çš„ï¼Œä¸€æ¡æ›´æ–°çš„&lt;/li>
&lt;li>æ²¡æœ‰æ›´æ–°ä¸»é”®ï¼Œè®°å½•è¿™æ¡æ•°æ®æ›´æ–°åˆ—çš„æ—§å€¼ï¼Œå›žæ»šæ—¶å°†æ•°æ®æ›´æ–°ä¸ºæ—§å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-mvcc">ðŸ“” MVCC&lt;/h2>
&lt;p>å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶ï¼ŒåŒä¸€æ¡è®°å½•åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>ä¾èµ–äºŽï¼š&lt;/p>
&lt;ul>
&lt;li>è¡Œçš„éšå¼å­—æ®µ
&lt;ul>
&lt;li>DB_TRX_ID äº‹åŠ¡ id&lt;/li>
&lt;li>DB_ROLL_PTR å›žæ»šæŒ‡é’ˆï¼ˆè®°å½•è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>undo log&lt;/li>
&lt;li>Read View&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/innodb/2.png"
width="447"
height="293"
srcset="https://www.letout.cn/p/mysql/innodb/2_hu6914e1ba0252a0a630b3ee48cb8867a4_30147_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/innodb/2_hu6914e1ba0252a0a630b3ee48cb8867a4_30147_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="152"
data-flex-basis="366px"
>&lt;/p>
&lt;h3 id="å½“å‰è¯»">å½“å‰è¯»&lt;/h3>
&lt;p>è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>&lt;code>update&lt;/code> &lt;code>insert&lt;/code> &lt;code>delete&lt;/code> &lt;code>select ... for update&lt;/code> &lt;code>select ... lock in share mode&lt;/code> éƒ½æ˜¯è¿›è¡Œå½“å‰è¯»ã€‚&lt;/p>
&lt;h3 id="å¿«ç…§è¯»">å¿«ç…§è¯»&lt;/h3>
&lt;p>ç®€å•çš„ä¸åŠ é” &lt;code>select&lt;/code> å°±æ˜¯å¿«ç…§è¯»ã€‚è¯»å–çš„æ˜¯å¿«ç…§ç‰ˆæœ¬ï¼Œé€šè¿‡ MVCC è¿›è¡Œå¹¶å‘æŽ§åˆ¶ã€‚&lt;/p>
&lt;h2 id="-å…³é”®ç‰¹æ€§">ðŸš€ å…³é”®ç‰¹æ€§&lt;/h2>
&lt;p>InnoDB å­˜å‚¨å¼•æ“Žçš„ç‰¹æ€§ï¼Œå¯ä»¥å¸¦æ¥æ›´é«˜çš„æ€§èƒ½å’Œå¯é æ€§ã€‚&lt;/p>
&lt;h3 id="-æ’å…¥ç¼“å†²-insert-buffer">ðŸ§® æ’å…¥ç¼“å†² Insert Buffer&lt;/h3>
&lt;p>å½“æ’å…¥ä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œåœ¨èšç°‡ç´¢å¼•ä¸­ï¼Œé€šå¸¸æ•°æ®éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹é¡ºåºå­˜æ”¾çš„ï¼Œåªéœ€è¦å°†æ’å…¥çš„æ•°æ®æ”¾åˆ°æœ€åŽå³å¯ï¼ˆä¸»é”®é¡ºåºå­˜æ”¾ï¼‰ã€‚&lt;/p>
&lt;p>é€šå¸¸æˆ‘ä»¬éƒ½ä¼šåœ¨ä¸€å¼ è¡¨ä¸Šåˆ›å»ºä¸€äº›äºŒçº§ç´¢å¼•ï¼Œè€Œè¿™äº›äºŒçº§ç´¢å¼•åœ¨æ•°æ®æ’å…¥æ—¶ï¼Œéœ€è¦ç»´æŠ¤ç´¢å¼•æ˜¯ç¦»æ•£çš„ï¼Œç”±äºŽéšæœº IO å°±ä¼šå¯¼è‡´æ’å…¥æ€§èƒ½çš„ä¸‹é™ã€‚&lt;/p>
&lt;p>ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼ŒInnoDB è®¾è®¡äº† &lt;code>Insert Buffer&lt;/code>ã€‚&lt;/p>
&lt;p>äºŒçº§ç´¢å¼•çš„æ›´æ–°æ“ä½œï¼š&lt;/p>
&lt;ul>
&lt;li>å¦‚æžœéœ€è¦æ›´æ–°çš„ç´¢å¼•é¡µåœ¨ Buffer Pool ä¸­ï¼Œåˆ™ç›´æŽ¥æ’å…¥ï¼›&lt;/li>
&lt;li>å¦‚æžœä¸åœ¨ï¼Œåˆ™æ’å…¥ Insert Bufferï¼Œä¹‹åŽä»¥ä¸€å®šçš„é¢‘çŽ‡å’Œæƒ…å†µåœ¨ä¸ŽäºŒçº§ç´¢å¼•åˆå¹¶&lt;/li>
&lt;/ul>
&lt;p>ä½¿ç”¨ Insert Buffer éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>â­ äºŒçº§ç´¢å¼•&lt;/li>
&lt;li>â­ éžå”¯ä¸€ç´¢å¼•&lt;/li>
&lt;/ul>
&lt;p>å¦‚æžœäºŒçº§ç´¢å¼•æ˜¯å”¯ä¸€çš„ï¼Œåœ¨æ’å…¥æ—¶ï¼Œè¿˜éœ€è¦åŽ»ç´¢å¼•é¡µæŸ¥æ‰¾æ”¹ç´¢å¼•æ˜¯å¦å”¯ä¸€ï¼Œè¿™æ ·çš„ç¦»æ•£è¯»å–ä¸¤éƒ¨åˆ†ï¼Œä¼šå¯¼è‡´ Insert Buffer å¤±åŽ»æ„ä¹‰ã€‚&lt;/p>
&lt;p>åŽç»­çš„ç‰ˆæœ¬æä¾›äº†å‡çº§ç‰ˆæœ¬ &lt;code>Change Buffer&lt;/code>ï¼Œå¯¹ Insertã€Deleteã€Update éƒ½è¿›è¡Œç¼“å†²ã€‚&lt;/p>
&lt;h3 id="-ä¸¤æ¬¡å†™-double-write">ðŸ–‹ï¸ ä¸¤æ¬¡å†™ Double Write&lt;/h3>
&lt;p>InnoDB å°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜ä¸­æ—¶ï¼Œçªç„¶å‘ç”Ÿå®•æœºï¼Œåªå†™å…¥äº†ä¸€åŠï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>InnDB ä½¿ç”¨ Double Wirte æœºåˆ¶ï¼Œç»™æ•°æ®æ·»åŠ å‰¯æœ¬ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/innodb/doublewrite.png"
width="1178"
height="730"
srcset="https://www.letout.cn/p/mysql/innodb/doublewrite_hu9ca5738e358d4e9e6de3d859e62edb84_153884_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/innodb/doublewrite_hu9ca5738e358d4e9e6de3d859e62edb84_153884_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="161"
data-flex-basis="387px"
>&lt;/p>
&lt;p>éœ€è¦åˆ·æ–°çš„è„é¡µä¼šè¢«å¤åˆ¶åˆ° Double Write Buffer ä¸­ï¼Œåœ¨éœ€è¦åˆ·ç›˜æ—¶ï¼š&lt;/p>
&lt;ul>
&lt;li>å…ˆåˆ†ä¸¤æ¬¡å†™å…¥ä¸€ä»½åˆ°å…±äº«è¡¨ç©ºé—´çš„ double wirte ç‰©ç†ç£ç›˜ä¸Šï¼ˆé¡ºåºå†™å…¥ï¼‰&lt;/li>
&lt;li>å†å°†æ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸­ï¼ˆéšæœº IOï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="-è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•">ðŸ—‚ï¸ è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•&lt;/h3>
&lt;p>InnoDB å­˜å‚¨å¼•æ“Žä¼šè‡ªåŠ¨æ ¹æ®è®¿é—®çš„é¢‘çŽ‡å’Œæ¨¡å¼ç»™çƒ­ç‚¹æ•°æ®å»ºç«‹ä¸€ä¸ª Hash ç´¢å¼•ï¼ŒåŠ å¿«è¯»è¯·æ±‚ã€‚&lt;/p>
&lt;p>åªèƒ½ä¸ºç­‰å€¼æŸ¥è¯¢å»ºç«‹ï¼ŒèŒƒå›´æŸ¥è¯¢ä¸èƒ½å»ºç«‹ã€‚&lt;/p>
&lt;h3 id="-é¢„è¯»æœºåˆ¶">ðŸ“– é¢„è¯»æœºåˆ¶&lt;/h3>
&lt;p>InnoDB ä¼šå°†æŸ¥è¯¢é¡µçš„é‚»è¿‘é¡µä¸€èµ·è¯»åˆ° &lt;a class="link" href="https://www.letout.cn/p/mysql/innodb/buffer-pool/" target="_blank" rel="noopener"
>Buffer Pool&lt;/a> ä¸­ã€‚&lt;/p>
&lt;p>é€šè¿‡æ”¹è¿›çš„ LRU é“¾è¡¨ï¼ˆç®¡ç†å¹²å‡€é¡µ &amp;amp; è„é¡µçš„é“¾è¡¨ï¼‰ï¼Œè§£å†³äº†é¢„è¯»å¤±æ•ˆçš„é—®é¢˜ã€‚ã€‚&lt;/p></description></item><item><title>MySQL ä¸­çš„æ—¥å¿—</title><link>https://www.letout.cn/p/mysql/log/</link><pubDate>Thu, 30 Jun 2022 18:02:02 +0800</pubDate><guid>https://www.letout.cn/p/mysql/log/</guid><description>&lt;img src="https://www.letout.cn/imgs/19.jpeg" alt="Featured image of post MySQL ä¸­çš„æ—¥å¿—" />&lt;h2 id="-server-å±‚æ—¥å¿—">ðŸ–¥ï¸ Server å±‚æ—¥å¿—&lt;/h2>
&lt;h3 id="é”™è¯¯æ—¥å¿—">é”™è¯¯æ—¥å¿—&lt;/h3>
&lt;p>é”™è¯¯æ—¥å¿—æ˜¯ MySQL ä¸­æœ€é‡è¦çš„æ—¥å¿—ä¹‹ä¸€ï¼Œå®ƒè®°å½•äº†å½“ mysqld å¯åŠ¨å’Œåœæ­¢æ—¶ï¼Œä»¥åŠæœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•ä¸¥é‡é”™è¯¯æ—¶çš„ç›¸å…³ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å½“æ•°æ®åº“å‡ºçŽ°ä»»ä½•æ•…éšœå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨æ—¶ï¼Œå»ºè®®é¦–å…ˆæŸ¥çœ‹æ­¤æ—¥å¿—ã€‚æŸ¥çœ‹æ—¥å¿—ä½ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%log_error%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/mysql/log/errorlog.png"
width="669"
height="214"
srcset="https://www.letout.cn/p/mysql/log/errorlog_huaf2aa946fc0c9a4be25a1e7ae77fcd38_27013_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/log/errorlog_huaf2aa946fc0c9a4be25a1e7ae77fcd38_27013_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="errorlog"
class="gallery-image"
data-flex-grow="312"
data-flex-basis="750px"
>&lt;/p>
&lt;h3 id="æŸ¥è¯¢æ—¥å¿—">æŸ¥è¯¢æ—¥å¿—&lt;/h3>
&lt;p>æŸ¥è¯¢æ—¥å¿—ä¸­è®°å½•äº†å®¢æˆ·ç«¯çš„æ‰€æœ‰æ“ä½œè¯­å¥ã€‚ï¼ˆbinlog ä¸åŒ…å«æŸ¥è¯¢æ•°æ®çš„ SQL è¯­å¥ï¼‰&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢æ—¥å¿—æ˜¯æœªå¼€å¯çš„ã€‚&lt;/p>
&lt;p>å¦‚æžœéœ€è¦å¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼Œå¯ä»¥ä¿®æ”¹MySQLçš„é…ç½®æ–‡ä»¶ /etc/my.cnf æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># è¯¥é€‰é¡¹ç”¨æ¥å¼€å¯æŸ¥è¯¢æ—¥å¿—
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># å¯é€‰å€¼ 0 å…³é—­ 1 å¼€å¯
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">general_log=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶å
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># å¦‚æžœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤çš„æ–‡ä»¶åä¸º host_name.log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">general_log_file=mysql_query.log
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¼€å¯äº†æŸ¥è¯¢æ—¥å¿—ä¹‹åŽï¼Œ/var/lib/mysql/ ç›®å½•ä¸‹å°±ä¼šå‡ºçŽ° mysql_query.log æ–‡ä»¶ã€‚&lt;/p>
&lt;p>æ‰€æœ‰çš„å®¢æˆ·ç«¯çš„å¢žåˆ æ”¹æŸ¥æ“ä½œéƒ½ä¼šè®°å½•åœ¨è¯¥æ—¥å¿—æ–‡ä»¶ä¹‹ä¸­ï¼Œé•¿æ—¶é—´è¿è¡ŒåŽï¼Œè¯¥æ—¥å¿—æ–‡ä»¶å°†ä¼šéžå¸¸å¤§ã€‚&lt;/p>
&lt;h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—">æ…¢æŸ¥è¯¢æ—¥å¿—&lt;/h3>
&lt;p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰§è¡Œæ—¶é—´è¶…è¿‡ &lt;code>long_query_time&lt;/code>&lt;/li>
&lt;li>æ‰«æè®°å½•æ•°å¤§äºŽ &lt;code>min_examined_row_limit&lt;/code>
çš„æ‰€æœ‰çš„SQLè¯­å¥çš„æ—¥å¿—ï¼Œé»˜è®¤æœªå¼€å¯ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚æžœéœ€è¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦åœ¨ MySQL çš„é…ç½®æ–‡ä»¶ /etc/my.cnf ä¸­é…ç½®å¦‚ä¸‹å‚æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># æ…¢æŸ¥è¯¢æ—¥å¿—
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">slow_query_log=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># æ‰§è¡Œæ—¶é—´å‚æ•°
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">long_query_time=2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ä¼šè®°å½•ç®¡ç†è¯­å¥ï¼Œä¹Ÿä¸ä¼šè®°å½•ä¸ä½¿ç”¨ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾çš„æŸ¥è¯¢ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># è®°å½•æ‰§è¡Œè¾ƒæ…¢çš„ç®¡ç†è¯­å¥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">log_slow_admin_statements=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># è®°å½•æ‰§è¡Œè¾ƒæ…¢çš„æœªä½¿ç”¨ç´¢å¼•çš„è¯­å¥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">log_queries_not_using_indexes= 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-bin-log">ðŸ”¢ bin log&lt;/h3>
&lt;p>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin logï¼‰æ˜¯è®°å½•äº†æ‰€æœ‰çš„æ•°æ®åº“è¡¨ç»“æž„å˜æ›´ï¼ˆDDLï¼‰å’Œè¡¨æ•°æ®ä¿®æ”¹ï¼ˆDMLï¼‰çš„æ—¥å¿—ã€‚&lt;/p>
&lt;p>ä½œç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°æ®å½’æ¡£&lt;/li>
&lt;li>ç¾éš¾æ—¶æ•°æ®æ¢å¤&lt;/li>
&lt;li>MySQL ä¸»ä»Žå¤åˆ¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%log_bin%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/mysql/log/binlog.png"
width="602"
height="240"
srcset="https://www.letout.cn/p/mysql/log/binlog_hue4b3570af35eb515872cd8390aac573d_28397_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/log/binlog_hue4b3570af35eb515872cd8390aac573d_28397_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="binlog"
class="gallery-image"
data-flex-grow="250"
data-flex-basis="602px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>log_bin_basename&lt;/p>
&lt;ul>
&lt;li>å½“å‰æ•°æ®åº“æœåŠ¡å™¨çš„binlogæ—¥å¿—çš„åŸºç¡€åç§°(å‰ç¼€)ï¼Œå…·ä½“çš„binlogæ–‡ä»¶åéœ€è¦å†è¯¥basenameçš„åŸºç¡€ä¸ŠåŠ ä¸Šç¼–å·(ç¼–å·ä»Ž000001å¼€å§‹)ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>log_bin_index&lt;/p>
&lt;ul>
&lt;li>binlogçš„ç´¢å¼•æ–‡ä»¶ï¼Œé‡Œé¢è®°å½•äº†å½“å‰æœåŠ¡å™¨å…³è”çš„binlogæ–‡ä»¶æœ‰å“ªäº›ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="binlog-æ ¼å¼">binlog æ ¼å¼&lt;/h4>
&lt;p>MySQL æœåŠ¡å™¨ä¸­æä¾›äº†å¤šç§æ ¼å¼æ¥è®°å½•äºŒè¿›åˆ¶æ—¥å¿—ï¼š&lt;/p>
&lt;p>é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ï¼Œåªéœ€è¦åœ¨ /etc/my.cnf ä¸­é…ç½® binlog_format å‚æ•°å³å¯ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ“ƒ &lt;code>statement&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åŸºäºŽ SQL è¯­å¥çš„æ—¥å¿—è®°å½•ï¼Œè®°å½•çš„æ˜¯ SQL è¯­å¥ï¼Œå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„ SQL éƒ½ä¼šè®°å½•åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ“• &lt;code>row&lt;/code> ï¼ˆé»˜è®¤ï¼‰&lt;/p>
&lt;ul>
&lt;li>åŸºäºŽè¡Œçš„æ—¥å¿—è®°å½•ï¼Œè®°å½•çš„æ˜¯æ¯ä¸€è¡Œçš„æ•°æ®å˜æ›´ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ–‡ï¸ &lt;code>mixed&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ··åˆäº† statememt å’Œ row ä¸¤ç§æ ¼å¼ï¼Œé»˜è®¤é‡‡ç”¨statementï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸º row è¿›è¡Œè®°å½•ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%binlog_format%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/mysql/log/binlogformat.png"
width="432"
height="156"
srcset="https://www.letout.cn/p/mysql/log/binlogformat_hu025aaab383e907dcebf622698b084bf9_13882_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/log/binlogformat_hu025aaab383e907dcebf622698b084bf9_13882_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="binlogformat"
class="gallery-image"
data-flex-grow="276"
data-flex-basis="664px"
>&lt;/p>
&lt;h4 id="æŸ¥çœ‹-bin-log">æŸ¥çœ‹ bin log&lt;/h4>
&lt;p>æ—¥å¿—æ˜¯ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨çš„ï¼Œä¸èƒ½ç›´æŽ¥è¯»å–ï¼Œéœ€è¦é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—æŸ¥è¯¢å·¥å…· &lt;code>mysqlbinlog&lt;/code> æ¥æŸ¥çœ‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mysqlbinlog [å‚æ•°] logfilename
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">å‚æ•°é€‰é¡¹ï¼š
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -d æŒ‡å®šæ•°æ®åº“åç§°ï¼Œåªåˆ—å‡ºæŒ‡å®šçš„æ•°æ®åº“ç›¸å…³æ“ä½œ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -o å¿½ç•¥æŽ‰æ—¥å¿—ä¸­çš„å‰ n è¡Œå‘½ä»¤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v å°†è¡Œäº‹ä»¶(æ•°æ®å˜æ›´)é‡æž„ä¸ºSQLè¯­å¥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -vv å°†è¡Œäº‹ä»¶(æ•°æ®å˜æ›´)é‡æž„ä¸ºSQLè¯­å¥ï¼Œå¹¶è¾“å‡ºæ³¨é‡Šä¿¡æ¯
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="æ¸…ç†-bin-log">æ¸…ç† bin log&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>&lt;code>reset master&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åˆ é™¤å…¨éƒ¨ binlog æ—¥å¿—ï¼Œåˆ é™¤ä¹‹åŽï¼Œæ—¥å¿—ç¼–å·ï¼Œå°†ä»Ž binlog.000001é‡æ–°å¼€å§‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>purge master logs to 'binlog.000005'&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åˆ é™¤ 000005 ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>purge master logs before 'yyyy-mm-dd hh24:mi:ss'&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åˆ é™¤æ—¥å¿—ä¸º &amp;ldquo;yyyy-mm-dd hh24:mi:ss&amp;rdquo; ä¹‹å‰äº§ç”Ÿçš„æ‰€æœ‰æ—¥å¿—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å¯ä»¥åœ¨ mysql çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„è¿‡æœŸæ—¶é—´ï¼Œè®¾ç½®äº†ä¹‹åŽï¼ŒäºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸä¼šè‡ªåŠ¨åˆ é™¤ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%binlog_expire_logs_seconds%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/mysql/log/binlogexpire.png"
width="541"
height="153"
srcset="https://www.letout.cn/p/mysql/log/binlogexpire_hua71c1465b703f02a37880ff6dd450f1c_15632_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/log/binlogexpire_hua71c1465b703f02a37880ff6dd450f1c_15632_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="binlogexpire"
class="gallery-image"
data-flex-grow="353"
data-flex-basis="848px"
>&lt;/p>
&lt;h2 id="-inoodb-å­˜å‚¨å¼•æ“Žæ—¥å¿—">ðŸ’½ InooDB å­˜å‚¨å¼•æ“Žæ—¥å¿—&lt;/h2>
&lt;h3 id="-redo-log-é‡åšæ—¥å¿—">â±ï¸ redo log é‡åšæ—¥å¿—&lt;/h3>
&lt;p>MySQL æ›´æ–°æ•°æ®æ“ä½œçš„éƒ½æ˜¯ Buffer Pool å†…å­˜ä¸­çš„ç¼“å­˜é¡µï¼Œè¢«ä¿®æ”¹è¿‡çš„è„é¡µä¸ä¼šç«‹å³è¢«åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼ˆéšæœºç£ç›˜ IO æ€§èƒ½ä½Žï¼‰ï¼Œä¸ºäº†é˜²æ­¢æ–­ç”µç­‰æƒ…å†µé€ æˆå†…å­˜ä¸­çš„æ•°æ®ä¸¢å¤±ï¼Œåˆ©ç”¨ redo log è®°å½•æ•°æ®é¡µçš„æ›´æ–°æ“ä½œï¼ŒåŽç»­åœ¨åˆé€‚çš„æ—¶é—´å†ä¿®æ”¹ç£ç›˜ä¸­çš„æ•°æ®ã€‚ï¼ˆWAL æŠ€æœ¯ï¼‰&lt;/p>
&lt;p>redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•äº†æ•°æ®é¡µåšäº†ä»€ä¹ˆä¿®æ”¹ã€‚ä¾‹å¦‚ï¼šå¯¹ XXX è¡¨ç©ºé—´ä¸­çš„ YYY æ•°æ®é¡µ ZZZ åç§»é‡çš„åœ°æ–¹åšäº† AAA æ›´æ–°ã€‚&lt;/p>
&lt;p>redo log è®°å½•äº†äº‹åŠ¡å®ŒæˆåŽçš„æ•°æ®çŠ¶æ€ï¼Œå½“äº‹åŠ¡æäº¤æ—¶ï¼Œåªè¦å°† redo log æŒä¹…åŒ–åˆ°ç¡¬ç›˜å³å¯ï¼ˆé¡ºåºç£ç›˜ IOï¼‰ï¼Œä¸éœ€è¦å°† Buffer Pool ä¸­çš„è„é¡µæŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼ˆéšæœºç£ç›˜ IOï¼‰ã€‚&lt;/p>
&lt;p>ä¿è¯äº†äº‹åŠ¡ ACID ç‰¹æ€§ä¸­çš„æŒä¹…æ€§ï¼Œå½“æ•°æ®åº“å‘ç”Ÿæ•…éšœæ—¶ï¼Œå¯ä»¥åˆ©ç”¨ redo log æ¢å¤æ•°æ®ã€‚&lt;/p>
&lt;h4 id="-redo-log-å¾ªçŽ¯å†™">ðŸ”ƒ redo log å¾ªçŽ¯å†™&lt;/h4>
&lt;p>redo log æ˜¯ä¸ºäº†é˜²æ­¢ Buffer Pool ä¸­çš„è„é¡µä¸¢å¤±è€Œè®¾è®¡çš„ã€‚å½“éšç€æœåŠ¡çš„è¿è¡Œï¼ŒBuffer Pool ä¸­çš„è„é¡µåˆ·æ–°åˆ°äº†ç£ç›˜ä¸­ï¼Œredo log ä¸­çš„è®°å½•å°±æ²¡æœ‰ç”¨äº†ï¼Œå¯ä»¥æ“¦é™¤æ—§è®°å½•ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ redo log é‡‡ç”¨äº†å¾ªçŽ¯å†™çš„æ–¹å¼ï¼Œæ•°æ®å†™åˆ°æœ«å°¾åˆä¼šå›žåˆ°æ–‡ä»¶çš„å¼€å¤´ï¼Œæ–°æ•°æ®å¯ä»¥è¦†ç›–æ— ç”¨çš„æ—§æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/log/redo-log.webp"
width="1362"
height="906"
srcset="https://www.letout.cn/p/mysql/log/redo-log_hud436e5fcec2bf61353c634ad67370294_39572_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/mysql/log/redo-log_hud436e5fcec2bf61353c634ad67370294_39572_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="150"
data-flex-basis="360px"
>&lt;/p>
&lt;h4 id="åˆ·ç›˜">åˆ·ç›˜&lt;/h4>
&lt;p>äº§ç”Ÿçš„ redo log å¹¶ä¸æ˜¯ç›´æŽ¥å†™å…¥ç£ç›˜çš„ï¼Œä¼šå…ˆå†™åˆ° redo log buffer ä¸­ï¼ŒåŽç»­å†æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚&lt;/p>
&lt;p>redo log buffer é»˜è®¤å¤§å°ä¸º &lt;code>innodb_log_Buffer_size = 16MB&lt;/code>ï¼Œå¢žåŠ å®ƒçš„å¤§å°ï¼Œå¯ä»¥è®© MySQL å¤„ç†å¤§äº‹åŠ¡ä¸å¿…å†™å…¥åˆ°ç£ç›˜ï¼Œè¿›è€Œæå‡ IO æ€§èƒ½ã€‚&lt;/p>
&lt;p>redo log buffer åˆ·ç›˜æ—¶æœºï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>InnoDB çš„åŽå°çº¿ç¨‹ï¼Œæ¯éš” 1sï¼Œä¼šå°† redo log buffer æŒä¹…åŒ–åˆ°ç£ç›˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>redo log buffer ä¸­è®°å½•çš„å†™å…¥é‡å¤§äºŽè®¾ç½®ç©ºé—´çš„ä¸€åŠæ—¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MySQL æ­£å¸¸å…³é—­æ—¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ï¼Œå°† redo log buffer ä¸­ redo log æŒä¹…åŒ–åˆ°ç£ç›˜ &lt;code>innodb_flush_log_at_trx_commit&lt;/code> æŽ§åˆ¶&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="ä¸¤é˜¶æ®µæäº¤">ä¸¤é˜¶æ®µæäº¤&lt;/h4>
&lt;p>redo log å’Œ bin log æŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼Œæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ“ä½œï¼Œå¯èƒ½ä¼šå‡ºçŽ°åŠæˆåŠŸçš„çŠ¶æ€ï¼Œå¯¼è‡´ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸ä¸€è‡´ã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä¿è¯ä¸¤ä¸ªæ—¥å¿—çš„ä¸€è‡´æ€§ï¼Œä½¿ç”¨äº†â€ä¸¤é˜¶æ®µæäº¤â€œæ¥è§£å†³ã€‚æŠŠå•ä¸ªäº‹åŠ¡çš„æäº¤æ‹†åˆ†æˆäº†ä¸¤ä¸ªé˜¶æ®µï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Prepare å‡†å¤‡é˜¶æ®µ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Commit æäº¤é˜¶æ®µ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å°† redo log å†™å…¥æ‹†æˆäº†ä¸¤ä¸ªæ­¥éª¤ï¼šprepare å’Œ commitï¼Œä¸­é—´å†ç©¿æ’å†™å…¥ bin logã€‚&lt;/p>
&lt;p>&lt;code>redo log prepare -&amp;gt; bin log -&amp;gt; redo log commit&lt;/code>&lt;/p>
&lt;p>å½“ bin log æˆåŠŸæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå°±è¢«è®¤ä¸ºäº‹åŠ¡å·²ç»æ‰§è¡ŒæˆåŠŸï¼ˆå³ä½¿ redo log æ˜¯ prepare ä¹Ÿæ²¡æœ‰å…³ç³»ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/log/prepare-commit.png"
width="887"
height="859"
srcset="https://www.letout.cn/p/mysql/log/prepare-commit_hu761b281e24776a109dc5986da4421988_282489_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/log/prepare-commit_hu761b281e24776a109dc5986da4421988_282489_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="103"
data-flex-basis="247px"
>&lt;/p>
&lt;h3 id="-undo-log-å›žæ»šæ—¥å¿—">ðŸ”™ undo log å›žæ»šæ—¥å¿—&lt;/h3>
&lt;p>undo log æ˜¯ä¸€ç§ç”¨äºŽæ’¤é”€å›žæ»šçš„æ—¥å¿—ã€‚InnoDB æ›´æ–°è®°å½•å‰ï¼Œä¼šå°†æ“ä½œå‰çš„æ•°æ®è®°å½•çš„ undo ä¸­ï¼Œå½“äº‹åŠ¡å›žæ»šæ—¶ï¼Œåˆ©ç”¨ undo log è¿›è¡Œå›žæ»šã€‚&lt;/p>
&lt;p>undo log ä¸»è¦ç”¨äºŽï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŽ—ï¸ å®žçŽ°äº‹åŠ¡å›žæ»šï¼Œä¿éšœäº‹åŠ¡ ACID ä¸­çš„åŽŸå­æ€§&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŽ—ï¸ undo log ä¸Ž ReadView é…åˆï¼Œå®žçŽ° MVCC&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨ InnoDB å­˜å‚¨å¼•æ“Žå¯¹è®°å½•è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¼šæŠŠå›žæ»šéœ€è¦çš„ä¿¡æ¯å…¨éƒ¨è®°å½•åˆ° undo ä¸­ï¼Œå¦‚æžœå‘ç”Ÿå›žæ»šï¼Œå°±ä¼šè¯»å– undo logï¼Œç„¶åŽæ‰§è¡Œä¸Žä¹‹ç›¸åçš„æ“ä½œã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>âž• æ’å…¥æ•°æ®ï¼Œè®°å½•è¿™æ¡æ•°æ®çš„ä¸»é”®ï¼Œå›žæ»šæ—¶æ ¹æ®ä¸»é”®æŠŠè¯¥æ¡è®°å½•åˆ é™¤&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âž– åˆ é™¤æ•°æ®ï¼Œè®°å½•è¿™æ¡æ•°æ®çš„æ‰€æœ‰å†…å®¹ï¼Œå›žæ»šæ—¶å°†è¿™äº›å†…å®¹ç»„æˆçš„è®°å½•æ’å…¥è¡¨ä¸­&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ–‹ï¸ æ›´æ–°æ•°æ®ï¼Œ&lt;/p>
&lt;ul>
&lt;li>æ›´æ–°äº†ä¸»é”®ï¼Œä¼šè®°å½•ä¸¤æ¡ undo logï¼Œä¸€æ¡åˆ é™¤çš„ï¼Œä¸€æ¡æ›´æ–°çš„&lt;/li>
&lt;li>æ²¡æœ‰æ›´æ–°ä¸»é”®ï¼Œè®°å½•è¿™æ¡æ•°æ®æ›´æ–°åˆ—çš„æ—§å€¼ï¼Œå›žæ»šæ—¶å°†æ•°æ®æ›´æ–°ä¸ºæ—§å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="ç‰ˆæœ¬é“¾">ç‰ˆæœ¬é“¾&lt;/h4>
&lt;p>ä¸€æ¡è®°å½•çš„æ¯æ¬¡æ›´æ–°æ“ä½œäº§ç”Ÿçš„ undo log æ ¼å¼éƒ½ä¼šæœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>trx_id äº‹åŠ¡ id&lt;/p>
&lt;p>è®°å½•äº†è¯¥è®°å½•æ˜¯ç”±å“ªä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹çš„ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>roll_pointer å›žæ»šæŒ‡é’ˆ&lt;/p>
&lt;p>å›žæ»šæŒ‡é’ˆå¯ä»¥å°† undo log ä¸²è¿žæˆä¸€ä¸ªé“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨ç§°ä¸ºç‰ˆæœ¬é“¾ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/log/version-link.webp"
width="1140"
height="591"
srcset="https://www.letout.cn/p/mysql/log/version-link_hu0442ac56d20b027197f4981105a2d120_16904_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/mysql/log/version-link_hu0442ac56d20b027197f4981105a2d120_16904_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="192"
data-flex-basis="462px"
>&lt;/p></description></item><item><title>MySQL ç´¢å¼•</title><link>https://www.letout.cn/p/mysql/index/</link><pubDate>Thu, 30 Jun 2022 14:02:02 +0800</pubDate><guid>https://www.letout.cn/p/mysql/index/</guid><description>&lt;img src="https://www.letout.cn/imgs/15.jpeg" alt="Featured image of post MySQL ç´¢å¼•" />&lt;h2 id="ç´¢å¼•">ç´¢å¼•&lt;/h2>
&lt;p>ç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ© MySQL é«˜æ•ˆèŽ·å–æ•°æ®çš„æ•°æ®ç»“æž„ï¼Œæé«˜æŸ¥è¯¢æ•ˆçŽ‡ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¼˜ç‚¹&lt;/p>
&lt;ul>
&lt;li>æé«˜æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦&lt;/li>
&lt;li>é™ä½Žæ•°æ®åº“çš„ IO æˆæœ¬&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç¼ºç‚¹&lt;/p>
&lt;ul>
&lt;li>å ç”¨ç£ç›˜ç©ºé—´&lt;/li>
&lt;li>å¢žåˆ æ”¹éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œæ€§èƒ½å¯èƒ½ä¼šä¸‹é™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="ç´¢å¼•çš„åˆ†ç±»">ç´¢å¼•çš„åˆ†ç±»&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- æŸ¥çœ‹è¡¨ä¸­çš„ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table_name&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¸»é”®ç´¢å¼•">ä¸»é”®ç´¢å¼•&lt;/h3>
&lt;p>å½“ä¸€å¼ è¡¨ï¼ŒæŠŠæŸä¸ªåˆ—è®¾ä¸ºä¸»é”®çš„æ—¶å€™ï¼Œåˆ™è¯¥åˆ—å°±æ˜¯ä¸»é”®ç´¢å¼•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ™®é€šç´¢å¼•">æ™®é€šç´¢å¼•&lt;/h3>
&lt;p>ç”¨è¡¨ä¸­çš„æ™®é€šåˆ—æž„å»ºçš„ç´¢å¼•ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_index_name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_index_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_table&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å”¯ä¸€ç´¢å¼•">å”¯ä¸€ç´¢å¼•&lt;/h3>
&lt;p>ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œå…è®¸æœ‰å¤šä¸ªç©ºå€¼ nullï¼ˆå’Œä¸»é”®ä¸åŒï¼Œä¸»é”®ä¸å…è®¸ä¸ºç©ºï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">unique&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">new_unique_index_name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unique&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">new_unique_index_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_table&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å…¨æ–‡ç´¢å¼•">å…¨æ–‡ç´¢å¼•&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">fulltext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_fulltext_index_content&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç»„åˆç´¢å¼•">ç»„åˆç´¢å¼•&lt;/h3>
&lt;p>ç»„åˆç´¢å¼• / è”åˆç´¢å¼•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_name_age_index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="èšç°‡ç´¢å¼•">èšç°‡ç´¢å¼•&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ç´¢å¼•å’Œæ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œç´¢å¼•ç»“æž„çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ®ï¼Œæ‰¾åˆ°äº†ç´¢å¼•å°±æ‰¾åˆ°äº†æ•°æ®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è®¿é—®æ•°æ®æ›´å¿«ï¼Œèšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªB+æ ‘ä¸Šã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºŽæ’å…¥é¡ºåºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ›´æ–°èšç°‡ç´¢å¼•åˆ—çš„ä»£ä»·å¾ˆé«˜ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/index8.png"
width="722"
height="369"
srcset="https://www.letout.cn/p/mysql/index/index8_hu9d45f79d8b338c019791de22ea52eb90_62479_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/index8_hu9d45f79d8b338c019791de22ea52eb90_62479_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="index8"
class="gallery-image"
data-flex-grow="195"
data-flex-basis="469px"
>&lt;/p>
&lt;h3 id="éžèšç°‡ç´¢å¼•äºŒçº§ç´¢å¼•">éžèšç°‡ç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰&lt;/h3>
&lt;p>å°†æ•°æ®ä¸Žç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æž„çš„å¶å­èŠ‚ç‚¹å…³è”çš„æ˜¯å¯¹åº”çš„ä¸»é”®ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/clustering-index.png"
width="840"
height="571"
srcset="https://www.letout.cn/p/mysql/index/clustering-index_hub32172b742ab96d724c643b42699b935_232051_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/clustering-index_hub32172b742ab96d724c643b42699b935_232051_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="clustering-index"
class="gallery-image"
data-flex-grow="147"
data-flex-basis="353px"
>&lt;/p>
&lt;ul>
&lt;li>äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œè¦å›žè¡¨ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/index9.png"
width="727"
height="389"
srcset="https://www.letout.cn/p/mysql/index/index9_hua49cf0193b83cd4f61e5b4747229532b_46178_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/index9_hua49cf0193b83cd4f61e5b4747229532b_46178_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="index9"
class="gallery-image"
data-flex-grow="186"
data-flex-basis="448px"
>&lt;/p>
&lt;h2 id="ç´¢å¼•çš„ç»“æž„">ç´¢å¼•çš„ç»“æž„&lt;/h2>
&lt;h3 id="b-tree">B Tree&lt;/h3>
&lt;p>B æ ‘æ˜¯ä¸€ç§å¤šå‰å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œå…¶ä¸»è¦ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ ‘çš„èŠ‚ç‚¹ä¸­å­˜å‚¨ç€å¤šä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå†…èŠ‚ç‚¹æœ‰å¤šä¸ªåˆ†å‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å‚¨å­˜æ•°æ®ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸­åŒ…å«é”®å€¼å’Œæ•°æ®ï¼ŒèŠ‚ç‚¹ä¸­çš„é”®å€¼ä»Žå°åˆ°å¤§æŽ’åˆ—ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>çˆ¶èŠ‚ç‚¹å½“ä¸­çš„å…ƒç´ ä¸ä¼šå‡ºçŽ°åœ¨å­èŠ‚ç‚¹ä¸­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ‰€æœ‰çš„å¶å­ç»“ç‚¹éƒ½ä½äºŽåŒä¸€å±‚ï¼Œå¶èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ·±åº¦ï¼Œå¶èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰æŒ‡é’ˆè¿žæŽ¥ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/BTree.png"
width="824"
height="496"
srcset="https://www.letout.cn/p/mysql/index/BTree_hu5a2ea9e01a7974b484f27a03994c1eb9_162577_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/BTree_hu5a2ea9e01a7974b484f27a03994c1eb9_162577_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="BTree"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="398px"
>&lt;/p>
&lt;h3 id="b-tree-1">B+ Tree&lt;/h3>
&lt;p>B+ æ ‘æ˜¯ B æ ‘çš„å‡çº§ç‰ˆã€‚B+ æ ‘åœ¨ç»“æž„ä¸Šå’ŒBæ ‘çš„åŒºåˆ«åœ¨äºŽï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åªæœ‰å¶å­èŠ‚ç‚¹æ‰ä¼šå­˜å‚¨æ•°æ®ï¼Œéžå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ï¼Œç”¨äºŽæŸ¥æ‰¾ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¶å­èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨åŒå‘æŒ‡é’ˆè¿žæŽ¥ï¼Œæœ€åº•å±‚çš„å¶å­èŠ‚ç‚¹å½¢æˆäº†ä¸€ä¸ªåŒå‘æœ‰åºé“¾è¡¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¶å­èŠ‚ç‚¹ä¿å­˜äº†çˆ¶èŠ‚ç‚¹æ‰€æœ‰å…³é”®å­—è®°å½•çš„æŒ‡é’ˆã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/BTree2.png"
width="726"
height="486"
srcset="https://www.letout.cn/p/mysql/index/BTree2_hu9d51150ef65d39ad05b8ca626e16e349_124398_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/BTree2_hu9d51150ef65d39ad05b8ca626e16e349_124398_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="B&amp;#43;Tree"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="358px"
>&lt;/p>
&lt;p>ç›¸æ¯”ä¸Ž B æ ‘ï¼ŒB+ æ ‘æœ‰ä»¥ä¸‹æå‡ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ‰«è¡¨èƒ½åŠ›æ›´å¼ºï¼ˆè¿›è¡Œå…¨è¡¨æ‰«æï¼Œåªéœ€è¦éåŽ†å¶å­èŠ‚ç‚¹å³å¯ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…·æœ‰æ›´å¥½çš„ç£ç›˜è¯»å†™èƒ½åŠ›ï¼ˆéžå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œä½¿æ ‘æ›´çŸ®ï¼ŒIO æ“ä½œæ›´å°‘ï¼Œä¸€æ¬¡ç£ç›˜åŠ è½½æ‰«æèŒƒå›´æ›´å¤§ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŸ¥è¯¢æ•ˆçŽ‡ç¨³å®šï¼ˆæ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼ŒIO æ¬¡æ•°ç¨³å®šï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¢žåˆ æ•°æ®æ•ˆçŽ‡æ›´é«˜ï¼ˆæ•°æ®åœ¨å¶å­èŠ‚ç‚¹ä»¥æœ‰åºé“¾è¡¨å­˜å‚¨ï¼Œå¯æé«˜æ•°æ®å¢žåˆ æ•ˆçŽ‡ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ•°æ®åº“ä¸­ï¼ŒB+ æ ‘çš„é«˜åº¦ä¸€èˆ¬éƒ½åœ¨ 2~4 å±‚ã€‚ç”±äºŽ MySQL çš„ INNODB å¼•æ“Žåœ¨è®¾è®¡æ—¶æ˜¯å°† B+ æ ‘çš„æ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜çš„ï¼Œå› æ­¤åœ¨æŸ¥æ‰¾æŸä¸€é”®å€¼çš„è¡Œè®°å½•æ—¶ï¼Œæœ€å¤šåªéœ€è¦ 1~3 æ¬¡ç£ç›˜IOã€‚&lt;/p>
&lt;h3 id="hash">Hash&lt;/h3>
&lt;p>æ”¯æŒ hash ç´¢å¼•çš„æ˜¯ Memory å­˜å‚¨å¼•æ“Žã€‚é‡‡ç”¨ä¸€å®šçš„ hash ç®—æ³•ï¼Œå°†é”®å€¼æ¢ç®—æˆæ–°çš„ hash å€¼ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ§½ä½ä¸Šï¼Œç„¶åŽå­˜å‚¨åœ¨ hash è¡¨ä¸­ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/hash.png"
width="551"
height="297"
srcset="https://www.letout.cn/p/mysql/index/hash_hu44e081159408b7a12e5ef78d4b9f0b5d_44702_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/hash_hu44e081159408b7a12e5ef78d4b9f0b5d_44702_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="hash"
class="gallery-image"
data-flex-grow="185"
data-flex-basis="445px"
>&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>åªèƒ½ç”¨äºŽå¯¹ç­‰æ¯”è¾ƒï¼ˆ=, inï¼‰ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆbetween, &amp;gt;, &amp;lt;ï¼‰&lt;/li>
&lt;li>æ— æ³•åˆ©ç”¨ç´¢å¼•å®ŒæˆæŽ’åºæ“ä½œ&lt;/li>
&lt;li>æŸ¥è¯¢æ•ˆçŽ‡é«˜ï¼Œé€šå¸¸åªéœ€è¦ä¸€æ¬¡æ£€ç´¢ï¼ˆæ—  hash å†²çªçš„æƒ…å†µï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="åˆ›å»ºç´¢å¼•çš„åŽŸåˆ™">åˆ›å»ºç´¢å¼•çš„åŽŸåˆ™&lt;/h2>
&lt;h3 id="-å»ºè®®åˆ›å»ºç´¢å¼•">ðŸ™† å»ºè®®åˆ›å»ºç´¢å¼•&lt;/h3>
&lt;ul>
&lt;li>âœ… &lt;code>select&lt;/code> è¯­å¥ï¼Œé¢‘ç¹ä½œä¸º &lt;code>where&lt;/code> æ¡ä»¶çš„å­—æ®µ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- index(first_name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">last_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Cools&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- è”åˆç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(first_name, last_name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- æ³¨æ„æ»¡è¶³ï¼šæœ€å·¦å‰ç¼€åŽŸåˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(last_name, first_name) -&amp;gt; where first_name=&amp;#34;Georgi&amp;#34; æ— æ³•ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>âœ… &lt;code>update/delete&lt;/code> è¯­å¥çš„ &lt;code>where&lt;/code> æ¡ä»¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">update&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Jim&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;100001&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">delete&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fitst_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>âœ… éœ€è¦åˆ†ç»„ï¼ŒæŽ’åºçš„å­—æ®µ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">group&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>âœ… ä½¿ç”¨ &lt;code>distinct&lt;/code> çš„å­—æ®µ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">distinct&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>âœ… å­—æ®µéœ€è¦å”¯ä¸€æ€§çº¦æŸ&lt;/p>
&lt;ul>
&lt;li>å”¯ä¸€ç´¢å¼•&lt;/li>
&lt;li>ä¸»é”®ç´¢å¼•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>âœ… å¤šè¡¨æŸ¥è¯¢ï¼Œè¿žæŽ¥å­—æ®µåº”åˆ›å»ºç´¢å¼•&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç±»åž‹åŠ¡å¿…ä¿æŒä¸€è‡´&lt;/strong>ï¼Œé¿å…éšå¼è£…æ¢&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">departments&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;100001&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- employees.emp_no dept_emp.emp_no ç±»åž‹åŠ¡å¿…ä¿æŒä¸€è‡´
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- dept_emp.dept_no departmants.dept_no ç±»åž‹åŠ¡å¿…ä¿æŒä¸€è‡´
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-ä¸å»ºè®®åˆ›å»ºç´¢å¼•">ðŸ™… ä¸å»ºè®®åˆ›å»ºç´¢å¼•&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>âŒ &lt;code>where&lt;/code> å­å¥ä¸­ç”¨ä¸åˆ°çš„å­—æ®µ&lt;/p>
&lt;p>ç´¢å¼•çš„ä½œç”¨æ˜¯å¿«é€Ÿå®šä½åˆ°æƒ³è¦çš„æ•°æ®ï¼Œç”¨ä¸åˆ°å°±æ²¡æœ‰å¿…è¦åˆ›å»ºæ•°æ®äº†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âŒ è¡¨é‡Œçš„è®°å½•éžå¸¸å°‘&lt;/p>
&lt;p>å¦‚åªæœ‰ 100 æ¡æ•°æ®ï¼Œæœ‰æ— å½±å“ä¸å¤§ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âŒ æœ‰å¤§é‡é‡å¤æ•°æ®ï¼Œé€‰æ‹©æ€§ä½Ž&lt;/p>
&lt;p>å¦‚ï¼šæ€§åˆ«å­—æ®µï¼Œå¯¼è‡´å¤§é‡å›žè¡¨ã€‚&lt;/p>
&lt;p>ç´¢å¼•çš„é€‰æ‹©æ€§è¶Šé«˜ï¼ŒæŸ¥è¯¢æ•ˆçŽ‡è¶Šå¥½ï¼Œå¯ä»¥åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­è¿‡æ»¤æ›´å¤šçš„è¡Œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âŒ é¢‘ç¹æ›´æ–°çš„å­—æ®µï¼Œåˆ›å»ºç´¢å¼•è¦è€ƒè™‘ç»´æŠ¤ç´¢å¼•çš„å¼€é”€&lt;/p>
&lt;p>é¢‘ç¹ä¿®æ”¹çš„å­—æ®µï¼Œä¸æŽ¨èåˆ›å»ºç´¢å¼•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="ç´¢å¼•å¤±æ•ˆä¸Žè§£å†³æ–¹æ¡ˆ">ç´¢å¼•å¤±æ•ˆä¸Žè§£å†³æ–¹æ¡ˆ&lt;/h2>
&lt;blockquote>
&lt;p>æ˜¯å¦ä½¿ç”¨ç´¢å¼•å–å†³äºŽ ðŸš€ æŸ¥è¯¢ä»£ä»·&lt;/p>
&lt;p>å³ä½¿å¯ä»¥ä½¿ç”¨ç´¢å¼•æ—¶ï¼Œä½† MySQL è¯„ä¼°åŽï¼Œä¸å¦‚å…¨è¡¨æ‰«æï¼Œä¼šæ”¾å¼ƒä½¿ç”¨ç´¢å¼•&lt;/p>
&lt;/blockquote>
&lt;h3 id="-ç´¢å¼•åˆ—ä¸ç‹¬ç«‹è¿›è¡Œäº†è®¡ç®—æˆ–å˜æˆäº†å‚æ•°">âš ï¸ ç´¢å¼•åˆ—ä¸ç‹¬ç«‹ï¼Œè¿›è¡Œäº†è®¡ç®—æˆ–å˜æˆäº†å‚æ•°&lt;/h3>
&lt;ul>
&lt;li>ç´¢å¼•å­—æ®µè¿›è¡Œäº†è¡¨è¾¾å¼è®¡ç®—&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">form&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100003&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/index1.png"
width="1185"
height="157"
srcset="https://www.letout.cn/p/mysql/index/index1_huaa761d032e691cca90bef5eef1dadb87_81724_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/index1_huaa761d032e691cca90bef5eef1dadb87_81724_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="754"
data-flex-basis="1811px"
>&lt;/p>
&lt;p>åº”äº‹å…ˆè®¡ç®—å¥½è¡¨è¾¾å¼çš„å€¼ï¼Œå†ä¼ å…¥ï¼Œé¿å…åœ¨ SQL &lt;code>where&lt;/code> çš„å·¦ä¾§åšè®¡ç®—ã€‚&lt;/p>
&lt;ul>
&lt;li>ç´¢å¼•å­—æ®µæ˜¯å‡½æ•°çš„å‚æ•°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">substring&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fitst_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Geo&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>äº‹å…ˆè®¡ç®—å¥½å†ä¼ å…¥ã€‚&lt;/p>
&lt;p>æˆ–è€…ä½¿ç”¨ä¸€äº›ç­‰ä»·çš„ SQLã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Geo%&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- first_name éœ€è¦æ˜¯ç´¢å¼•çš„æƒ…å†µä¸‹æœ‰æ•ˆï¼ˆæ ¹æ®å®žé™…åœºæ™¯ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- æ³¨æ„ like ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/index2.png"
width="1169"
height="154"
srcset="https://www.letout.cn/p/mysql/index/index2_hu58e272ce7b5bb61c6085e6a94f631f41_86327_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/index2_hu58e272ce7b5bb61c6085e6a94f631f41_86327_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="759"
data-flex-basis="1821px"
>&lt;/p>
&lt;h3 id="-ä½¿ç”¨äº†å·¦æ¨¡ç³Š">âš ï¸ ä½¿ç”¨äº†å·¦æ¨¡ç³Š&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;%Geo%&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- æ— æ³•ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employee&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Geo%&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- å¯ä»¥ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æžœæ— æ³•é¿å…ï¼Œä¸”æœ‰è¾ƒé«˜éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æœç´¢å¼•æ“Žã€‚&lt;/p>
&lt;h3 id="-or-æŸ¥è¯¢çš„éƒ¨åˆ†å­—æ®µæ²¡æœ‰ç´¢å¼•">âš ï¸ or æŸ¥è¯¢çš„éƒ¨åˆ†å­—æ®µæ²¡æœ‰ç´¢å¼•&lt;/h3>
&lt;p>or çš„å«ä¹‰æ˜¯ä¸¤ä¸ªæ¡ä»¶æ»¡è¶³ä¸€ä¸ªå³å¯ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªæ¡ä»¶åˆ—æœ‰ç´¢å¼•æ˜¯æ— ç”¨çš„ã€‚åªè¦æ¡ä»¶åˆ—ä¸­æœ‰ä¸€ä¸ªä¸æ˜¯ç´¢å¼•åˆ—ï¼Œå°±ä¼šè¿›è¡Œå…¨è¡¨æ‰«æã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">or&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">last_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- å‡è®¾å½“å‰ first_name æœ‰ç´¢å¼•ï¼Œlast_name æ²¡æœ‰ç´¢å¼•ï¼Œè¯¥æ¡ sql æ— æ³•ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(fitst_name)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/index3.png"
width="1148"
height="176"
srcset="https://www.letout.cn/p/mysql/index/index3_hua5c1e2b296fd025c6e1f6de1e5790543_84429_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/index3_hua5c1e2b296fd025c6e1f6de1e5790543_84429_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3"
class="gallery-image"
data-flex-grow="652"
data-flex-basis="1565px"
>&lt;/p>
&lt;p>è§£å†³ï¼šæ ¹æ®å®žé™…ä¸šåŠ¡ï¼Œæ·»åŠ ç›¸åº”çš„ç´¢å¼•ã€‚&lt;/p>
&lt;p>æ·»åŠ ç´¢å¼•åŽï¼Œé¿å…äº†å…¨è¡¨æ‰«æã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/index4.png"
width="1129"
height="139"
srcset="https://www.letout.cn/p/mysql/index/index4_hu903a3bbf3d6eb2ece40fc0c15484c985_86767_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/index4_hu903a3bbf3d6eb2ece40fc0c15484c985_86767_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="4"
class="gallery-image"
data-flex-grow="812"
data-flex-basis="1949px"
>&lt;/p>
&lt;h3 id="-ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŽŸåˆ™çš„æŸ¥è¯¢">âš ï¸ ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŽŸåˆ™çš„æŸ¥è¯¢&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Facello&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- index(last_name, first_name)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/index5.png"
width="1156"
height="155"
srcset="https://www.letout.cn/p/mysql/index/index5_huc69773c1cc30429ec167298f8192f5a8_78720_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/index5_huc69773c1cc30429ec167298f8192f5a8_78720_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="5"
class="gallery-image"
data-flex-grow="745"
data-flex-basis="1789px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Facello&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- æ›´æ¢ç´¢å¼•é¡ºåº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(first_name, last_name)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/index6.png"
width="1144"
height="179"
srcset="https://www.letout.cn/p/mysql/index/index6_huc94bdeb83f55eebd5e2d4f615313b023_79724_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/index6_huc94bdeb83f55eebd5e2d4f615313b023_79724_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6"
class="gallery-image"
data-flex-grow="639"
data-flex-basis="1533px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">last_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- index(first_name, last_name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- MySQL çš„å¼•æ“Žä¸ºæ›´å¥½åˆ©ç”¨å¤åˆç´¢å¼•ï¼Œä¼šåŠ¨æ€è°ƒæ•´å­—æ®µé¡ºåº
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å­—ç¬¦ä¸²æ¡ä»¶æ²¡æœ‰ä½¿ç”¨-">âš ï¸ å­—ç¬¦ä¸²æ¡ä»¶æ²¡æœ‰ä½¿ç”¨ &amp;quot;&amp;quot;&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- è¿™é‡Œ dept_no åœ¨æ•°æ®åº“å®šä¹‰ä¸º varchar
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-éšå¼è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ">âš ï¸ éšå¼è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">departments&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;100001&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- employees.emp_no dept_emp.emp_no ç±»åž‹ä¸ä¸€è‡´æ—¶ä¼šå¯¼è‡´éšå¼è½¬æ¢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- dept_emp de departments.dept_no ç±»åž‹ä¸ä¸€è‡´æ—¶ä¼šå¯¼è‡´éšå¼è½¬æ¢
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="null-æ¡ä»¶æŸ¥è¯¢">null æ¡ä»¶æŸ¥è¯¢&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>æŸ¥è¯¢æ—¶ï¼Œé‡‡ç”¨ &lt;code>is null&lt;/code> &lt;code>is not null&lt;/code> æ¡ä»¶ï¼Œæ ¹æ®è¡¨ä¸­çš„æ•°æ®åˆ†å¸ƒï¼Œ&lt;strong>MySQL ä¼šè‡ªè¡Œåˆ¤æ–­æ˜¯å¦èµ°ç´¢å¼•ï¼Œå¹¶ä¸å›ºå®š&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MySQL å®˜æ–¹å»ºè®®å°½é‡æŠŠå­—æ®µå®šä¹‰ä¸º &lt;code>NOT NULL&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/index/index7.png"
width="821"
height="497"
srcset="https://www.letout.cn/p/mysql/index/index7_hu4d7b4705c5cf93f7dc141b75d9f23067_225180_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/index/index7_hu4d7b4705c5cf93f7dc141b75d9f23067_225180_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="7"
class="gallery-image"
data-flex-grow="165"
data-flex-basis="396px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mobile&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">is&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="mysql-è¯„ä¼°å…¨è¡¨æ‰«ææ›´å¿«">MySQL è¯„ä¼°å…¨è¡¨æ‰«ææ›´å¿«&lt;/h3>
&lt;p>MySQL åœ¨æŸ¥è¯¢æ—¶ï¼Œä¼šè¯„ä¼°ä½¿ç”¨ç´¢å¼•çš„æ•ˆçŽ‡ä¸Žèµ°å…¨è¡¨æ‰«æçš„æ•ˆçŽ‡ï¼Œå¦‚æžœèµ°å…¨è¡¨æ‰«ææ›´å¿«ï¼Œåˆ™æ”¾å¼ƒç´¢å¼•ï¼Œèµ°å…¨è¡¨æ‰«æã€‚&lt;/p>
&lt;p>å› ä¸ºç´¢å¼•æ˜¯ç”¨æ¥ç´¢å¼•å°‘é‡æ•°æ®çš„ï¼Œå¦‚æžœé€šè¿‡ç´¢å¼•æŸ¥è¯¢è¿”å›žå¤§æ‰¹é‡çš„æ•°æ®ï¼Œåˆ™è¿˜ä¸å¦‚èµ°å…¨è¡¨æ‰«ææ¥çš„å¿«ï¼Œæ­¤æ—¶ç´¢å¼•å°±ä¼šå¤±æ•ˆã€‚&lt;/p>
&lt;h2 id="æœ€å·¦å‰ç¼€æ³•åˆ™">æœ€å·¦å‰ç¼€æ³•åˆ™&lt;/h2>
&lt;p>æœ€å·¦å‰ç¼€æ³•åˆ™æŒ‡çš„æ˜¯æŸ¥è¯¢ä»Žç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚&lt;/p>
&lt;p>å¦‚æžœè·³è·ƒæŸä¸€åˆ—ï¼Œç´¢å¼•å°†ä¼šéƒ¨åˆ†å¤±æ•ˆ(åŽé¢çš„å­—æ®µç´¢å¼•å¤±æ•ˆ)ã€‚&lt;/p>
&lt;p>ä¸­é—´ä¸èƒ½è·³è¿‡æŸä¸€åˆ—ï¼Œå¦åˆ™è¯¥åˆ—åŽé¢çš„å­—æ®µç´¢å¼•å°†å¤±æ•ˆã€‚&lt;/p>
&lt;h2 id="èŒƒå›´æŸ¥è¯¢">èŒƒå›´æŸ¥è¯¢&lt;/h2>
&lt;p>è”åˆç´¢å¼•ä¸­ï¼Œå‡ºçŽ°èŒƒå›´æŸ¥è¯¢(&amp;gt;, &amp;lt;)ï¼ŒèŒƒå›´æŸ¥è¯¢å³ä¾§çš„åˆ—ç´¢å¼•å¤±æ•ˆã€‚&lt;/p>
&lt;h2 id="è¦†ç›–ç´¢å¼•">è¦†ç›–ç´¢å¼•&lt;/h2>
&lt;p>å¯¹äºŽç´¢å¼• Xï¼Œ&lt;code>SELECT&lt;/code> çš„å­—æ®µåªéœ€è¦ä»Žç´¢å¼•ä¸­å°±èƒ½èŽ·å¾—ï¼Œè€Œæ— éœ€å›žè¡¨èŽ·å–ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(name, age, pos)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pos&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">staffs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;July&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‰ç¼€ç´¢å¼•">å‰ç¼€ç´¢å¼•&lt;/h2>
&lt;p>å½“å­—æ®µç±»åž‹ä¸ºå­—ç¬¦ä¸²ï¼ˆvarcharï¼Œtextï¼Œlongtextç­‰ï¼‰æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¼šè®©
ç´¢å¼•å˜å¾—å¾ˆå¤§ï¼ŒæŸ¥è¯¢æ—¶ï¼Œæµªè´¹å¤§é‡çš„ç£ç›˜ IOï¼Œ å½±å“æŸ¥è¯¢æ•ˆçŽ‡ã€‚&lt;/p>
&lt;p>å¯ä»¥åªå°†å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å‰ç¼€ï¼Œå»ºç«‹ç´¢å¼•ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§èŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œä»Žè€Œæé«˜ç´¢å¼•æ•ˆçŽ‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- ä¸º email å­—æ®µï¼Œå»ºç«‹ç´¢å¼•é•¿åº¦ä¸º 5 çš„å‰ç¼€ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index_email_5&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="explain">explain&lt;/h2>
&lt;p>æŸ¥çœ‹ SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€‚å­—æ®µå«ä¹‰ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>id&lt;/p>
&lt;ul>
&lt;li>åœ¨ä¸€ä¸ªå¤§çš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œæ¯ä¸ª select å…³é”®å­—éƒ½å¯¹åº”ä¸€ä¸ªå”¯ä¸€ id&lt;/li>
&lt;li>id ç›¸åŒï¼Œæ‰§è¡Œé¡ºåºä»Žä¸Šåˆ°ä¸‹ï¼›id ä¸åŒï¼Œå€¼è¶Šå¤§ï¼Œè¶Šå…ˆæ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>select_type&lt;/p>
&lt;ul>
&lt;li>è¡¨ç¤º select å¯¹åº”çš„æŸ¥è¯¢ç±»åž‹&lt;/li>
&lt;li>SIMPLE (ç®€å• select,ä¸ä½¿ç”¨ union æˆ–å­æŸ¥è¯¢ç­‰)&lt;/li>
&lt;li>PRIMARY (æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†,æœ€å¤–å±‚çš„ select è¢«æ ‡è®°ä¸º PRIMARY)&lt;/li>
&lt;li>UNION (union ä¸­çš„ç¬¬äºŒä¸ªæˆ–åŽé¢çš„ select è¯­å¥)&lt;/li>
&lt;li>SUBQUERY (å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª select)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>table&lt;/p>
&lt;ul>
&lt;li>è¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºŽå“ªå¼ è¡¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>type&lt;/p>
&lt;ul>
&lt;li>MySQL åœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼&lt;/li>
&lt;li>æ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿žæŽ¥ç±»åž‹ä¸ºï¼šNULLã€systemã€constã€eq_refï¼‰ã€refã€rangeã€indexã€allï¼ˆå…¨è¡¨æ‰«æï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>possible_keys&lt;/p>
&lt;ul>
&lt;li>å¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸Šçš„ç´¢å¼•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>key&lt;/p>
&lt;ul>
&lt;li>å®žé™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æžœä¸º NULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>key_len&lt;/p>
&lt;ul>
&lt;li>å®žé™…ä½¿ç”¨ç´¢å¼•çš„é•¿åº¦ï¼ˆè¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éžå®žé™…ä½¿ç”¨é•¿åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ref&lt;/p>
&lt;ul>
&lt;li>ä¸Šè¿°è¡¨çš„è¿žæŽ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºŽæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>rows&lt;/p>
&lt;ul>
&lt;li>MySQL è®¤ä¸ºå¿…é¡»è¦æ‰§è¡ŒæŸ¥è¯¢çš„è¡Œæ•°ï¼Œåœ¨ innodb å¼•æ“Žçš„è¡¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œä¸æ˜¯å‡†ç¡®çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Extra&lt;/p>
&lt;ul>
&lt;li>MySQLè§£å†³æŸ¥è¯¢çš„è¯¦ç»†ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://juejin.cn/post/6936032090546765837" target="_blank" rel="noopener"
>https://juejin.cn/post/6936032090546765837&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Linux ç›®å½•ç»“æž„ä»‹ç»</title><link>https://www.letout.cn/p/linux-dir/</link><pubDate>Thu, 23 Jun 2022 02:02:02 +0800</pubDate><guid>https://www.letout.cn/p/linux-dir/</guid><description>&lt;img src="https://www.letout.cn/imgs/10.jpeg" alt="Featured image of post Linux ç›®å½•ç»“æž„ä»‹ç»" />&lt;p>Linux æ˜¯ä¸€ä¸ªå¼€æºçš„ç³»ç»Ÿï¼Œä½¿å¾— Linux å‘è¡Œç‰ˆæœ¬æœ‰å¾ˆå¤šï¼Œåˆ©ç”¨ Linux å¼€å‘äº§å“çš„å›¢é˜Ÿä¹Ÿæœ‰å¾ˆå¤šï¼Œå¦‚æžœä»»ç”±æ¯ä¸ªäººéƒ½æŒ‰ç…§è‡ªå·±çš„æƒ³æ³•æ¥é…ç½® Linux ç³»ç»Ÿæ–‡ä»¶ç›®å½•ï¼ŒåŽæœŸå¯èƒ½ä¼šäº§ç”Ÿè¯¸å¤šçš„ç®¡ç†é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å…è¯¸å¤šä½¿ç”¨è€…å¯¹ Linux ç³»ç»Ÿç›®å½•ç»“æž„å¤©é©¬è¡Œç©ºï¼ŒLinux åŸºé‡‘ä¼šå‘å¸ƒäº† FHS æ ‡å‡†ã€‚å¤šæ•° Linux å‘è¡Œç‰ˆç³»ç»Ÿéƒ½éµå¾ªè¿™ä¸€æ ‡å‡†ã€‚&lt;/p>
&lt;blockquote>
&lt;p>FHSï¼ˆFilesystem Hierarchy Standardï¼‰ï¼Œæ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡åŒ–æ ‡å‡†ï¼Œè¯¥æ ‡å‡†è§„å®šäº† Linux ç³»ç»Ÿä¸­æ‰€æœ‰ä¸€çº§ç›®å½•ä»¥åŠéƒ¨åˆ†äºŒçº§ç›®å½•ï¼ˆ/usr å’Œ /varï¼‰çš„ç”¨é€”ã€‚å‘å¸ƒæ­¤æ ‡å‡†çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†è®©ç”¨æˆ·æ¸…æ¥šåœ°äº†è§£æ¯ä¸ªç›®å½•åº”è¯¥å­˜æ”¾ä»€ä¹ˆç±»åž‹çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å‡ ä¹Žæ‰€æœ‰çš„ Linux å‘è¡Œç‰ˆéƒ½åŒ…å«ä»¥ä¸‹çš„ç›®å½•ç»“æž„ï¼š&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/directory.png"
width="950"
height="450"
srcset="https://www.letout.cn/p/linux-dir/directory_hua98ec03a363a3999681794ab96f9f09a_36725_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/directory_hua98ec03a363a3999681794ab96f9f09a_36725_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="directory"
class="gallery-image"
data-flex-grow="211"
data-flex-basis="506px"
>&lt;/p>
&lt;p>ä¸åŒçš„å‘è¡Œç‰ˆå¯èƒ½ä¼šæ·»åŠ ä¸€ä¸‹ç‹¬æœ‰çš„ç›®å½•ï¼Œä¾‹å¦‚ Ubuntu ä¸­åŒ…å« &lt;code>/snap&lt;/code> æ¥æ”¾ç½® snap åº”ç”¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/root.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/root_hu18035549831c69e974e5e46a3403bc3f_73150_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/root_hu18035549831c69e974e5e46a3403bc3f_73150_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="root"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="bin">/bin&lt;/h2>
&lt;p>Binary&lt;/p>
&lt;p>äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶çš„å¿«æ·æ–¹å¼ï¼ˆè½¯é“¾æŽ¥ï¼‰ï¼Œå­˜æ”¾ç€å¸¸ç”¨çš„å‘½ä»¤ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚å¸¸ç”¨çš„ &lt;code>ls&lt;/code> &lt;code>cp&lt;/code> &lt;code>cd&lt;/code> ç­‰å‘½ä»¤éƒ½å­˜æ”¾åœ¨è¿™é‡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/bin.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/bin_hu88e8cbe9114805e25899e6212c3f7b45_50694_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/bin_hu88e8cbe9114805e25899e6212c3f7b45_50694_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="bin"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="boot">/boot&lt;/h2>
&lt;p>å¯åŠ¨ Linux æ—¶ä½¿ç”¨çš„ä¸€äº›æ ¸å¿ƒæ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€äº›è¿žæŽ¥æ–‡ä»¶ä»¥åŠé•œåƒæ–‡ä»¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/boot.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/boot_hu918783384ee5a012af8445662a5570f5_99689_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/boot_hu918783384ee5a012af8445662a5570f5_99689_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="boot"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;p>å¦‚æžœæ˜¯ä»¥ UEFI æ–¹å¼å®‰è£…çš„ç³»ç»Ÿï¼Œå…¶ä¸­ &lt;code>efi&lt;/code> æ–‡ä»¶å¤¹ä¸­çš„ä¸º &lt;code>EFI&lt;/code> åˆ†åŒºä¸­çš„å¼•å¯¼ã€‚&lt;/p>
&lt;h2 id="dev">/dev&lt;/h2>
&lt;p>Device&lt;/p>
&lt;p>å­˜æ”¾ç€æ‰€æœ‰çš„è®¾å¤‡æ–‡ä»¶ã€‚åœ¨ Linux ä¸­ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨çš„ï¼ŒåŒ…æ‹¬ç¡¬ä»¶è®¾å¤‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/dev.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/dev_hu5755a852922f274414d0e5a0eab070dd_98725_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/dev_hu5755a852922f274414d0e5a0eab070dd_98725_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="dev"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="etc">/etc&lt;/h2>
&lt;p>Etcetera&lt;/p>
&lt;p>å­˜æ”¾ç¨‹åºçš„é…ç½®ä¿¡æ¯ï¼Œå¤§å¤šæ•°å®‰è£…çš„åº”ç”¨é…ç½®ä¿¡æ¯éƒ½ä¼šåœ¨è¿™é‡Œã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>/etc/apt&lt;/code> apt æºé…ç½®ç›®å½•&lt;/li>
&lt;li>&lt;code>/ect/vim&lt;/code> vim é…ç½®ç›®å½•&lt;/li>
&lt;li>&lt;code>/etc/nginx&lt;/code> nginx é…ç½®ç›®å½•&lt;/li>
&lt;li>&lt;code>/ect/redis&lt;/code> redis é…ç½®ç›®å½•&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/etc.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/etc_hu7a52980e1c04af5a90bf8edab9585ec6_85844_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/etc_hu7a52980e1c04af5a90bf8edab9585ec6_85844_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="etc"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="home">/home&lt;/h2>
&lt;p>ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚&lt;/p>
&lt;p>åœ¨ Linux ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç›®å½•ï¼Œä¸€èˆ¬è¯¥ç›®å½•åæ˜¯ä»¥ç”¨æˆ·çš„è´¦å·å‘½åã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/home.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/home_hud18e334789b3c740b9a20da6a45ce695_61060_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/home_hud18e334789b3c740b9a20da6a45ce695_61060_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="home"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="lib">/lib&lt;/h2>
&lt;p>Library&lt;/p>
&lt;p>ç³»ç»Ÿæœ€åŸºæœ¬çš„åŠ¨æ€è¿žæŽ¥å…±äº«åº“ï¼Œå…¶ä½œç”¨ç±»ä¼¼äºŽ Windows é‡Œçš„ DLL æ–‡ä»¶ã€‚&lt;/p>
&lt;p>å‡ ä¹Žæ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½éœ€è¦ç”¨åˆ°è¿™äº›å…±äº«åº“ã€‚åŒ…å« bin å’Œ sbin ä¸­å¯æ‰§è¡Œæ–‡ä»¶çš„ä¾èµ–ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/lib.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/lib_hub083733446fb3cb4ae55f28313c8182b_83036_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/lib_hub083733446fb3cb4ae55f28313c8182b_83036_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lib"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="media">/media&lt;/h2>
&lt;p>è‡ªåŠ¨æŒ‚è½½çš„è®¾å¤‡ï¼Œæ¯”å¦‚ U ç›˜ï¼Œç§»åŠ¨ç¡¬ç›˜ï¼Œç½‘ç»œè®¾å¤‡ç­‰çš„ç›®å½•ã€‚&lt;/p>
&lt;p>æ¯”å¦‚çŽ°åœ¨æœ‰ä¸€ä¸ª U ç›˜ï¼Œæ’åˆ°ç”µè„‘ä¸Šä¹‹åŽï¼Œç³»ç»Ÿä¼šæŠŠ U ç›˜è‡ªåŠ¨æŒ‚è½½åˆ° &lt;code>/media/$USER&lt;/code> æ–‡ä»¶å¤¹ä¸­ã€‚&lt;/p>
&lt;h2 id="mnt">/mnt&lt;/h2>
&lt;p>æä¾›ç»™ç”¨æˆ·ä¸´æ—¶æ‰‹åŠ¨æŒ‚è½½è®¾å¤‡æ–‡ä»¶å¤¹ï¼Œä¸€èˆ¬æ˜¯ç©ºæ–‡ä»¶å¤¹ã€‚&lt;/p>
&lt;p>æ¯”å¦‚çŽ°åœ¨è¦æ‰‹åŠ¨æŒ‚è½½ä¸€ä¸ªç¡¬ç›˜ï¼Œå¯ç”¨å¦‚ä¸‹æŒ‚è½½åˆ° &lt;code>/mnt&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mount /dev/sdb1 /mnt/disk
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="opt">/opt&lt;/h2>
&lt;p>Optional&lt;/p>
&lt;p>ä¸€äº›ç¬¬ä¸‰æ–¹è½¯ä»¶å®‰è£…çš„ç›®å½•ã€‚&lt;/p>
&lt;p>æ¯”å¦‚ Chrome æµè§ˆå™¨ï¼ŒWPS ç­‰è½¯ä»¶ï¼Œéƒ½ä¼šå®‰è£…åœ¨è¿™é‡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/opt.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/opt_huea96cc753b9c5430ebdf81edcd8754fb_76369_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/opt_huea96cc753b9c5430ebdf81edcd8754fb_76369_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="opt"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="root">/root&lt;/h2>
&lt;p>è¿™æ˜¯ root ç”¨æˆ·çš„å®¶ç›®å½•ã€‚&lt;/p>
&lt;h2 id="proc">/proc&lt;/h2>
&lt;p>Processes&lt;/p>
&lt;p>&lt;code>/proc&lt;/code> æ˜¯ä¸€ç§ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼ˆä¹Ÿå³è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå­˜å‚¨çš„æ˜¯å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œè¿™ä¸ªç›®å½•æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ç›®å½•ï¼Œå®ƒæ˜¯ç³»ç»Ÿå†…å­˜çš„æ˜ å°„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æŽ¥è®¿é—®è¿™ä¸ªç›®å½•æ¥èŽ·å–ç³»ç»Ÿä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/procversion.png"
width="734"
height="476"
srcset="https://www.letout.cn/p/linux-dir/procversion_hua30e25cc62b3a6421f2f9b1383e8ea4d_32573_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/procversion_hua30e25cc62b3a6421f2f9b1383e8ea4d_32573_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="procversion"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="370px"
>&lt;/p>
&lt;p>&lt;code>/proc&lt;/code> é‡Œé¢æœ‰ä¸€å¤§å †æ•°å­—å‘½åçš„æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ•°å­—å…¶å®žæ˜¯ Process IDï¼ˆPIDï¼‰ï¼Œå¯¹åº”ç€è¿è¡Œçš„æœåŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/procps.png"
width="734"
height="476"
srcset="https://www.letout.cn/p/linux-dir/procps_hu3633a821f850bd2d5d2ffca1ae08eb64_38818_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/procps_hu3633a821f850bd2d5d2ffca1ae08eb64_38818_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="procps"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="370px"
>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/proccat.png"
width="734"
height="476"
srcset="https://www.letout.cn/p/linux-dir/proccat_hu433bb9e8c82cee4321d94d03495747e7_47919_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/proccat_hu433bb9e8c82cee4321d94d03495747e7_47919_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="proccat"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="370px"
>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/proc1929.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/proc1929_hue982c12fdacf4a0dd83c56ac9a4d5cac_81321_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/proc1929_hue982c12fdacf4a0dd83c56ac9a4d5cac_81321_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="proc1929"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="sbin">/sbin&lt;/h2>
&lt;p>Superuser Binaries&lt;/p>
&lt;p>è¿™é‡Œå­˜æ”¾çš„æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨çš„ç³»ç»Ÿç®¡ç†ç¨‹åºã€‚&lt;/p>
&lt;p>ä¾‹å¦‚å¸¸è§çš„ &lt;code>groupadd&lt;/code> &lt;code>groupdel&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/sbin.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/sbin_hufd2d26ea46f84ef22af6fb59ef9f4da6_85048_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/sbin_hufd2d26ea46f84ef22af6fb59ef9f4da6_85048_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="sbin"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="srv">/srv&lt;/h2>
&lt;p>Service&lt;/p>
&lt;p>ä¸»è¦ç”¨æ¥å­˜æ”¾æœåŠ¡æ•°æ®ã€‚å¯¹äºŽæ¡Œé¢ç‰ˆ Linux ç³»ç»Ÿï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ä¸€èˆ¬æ˜¯ç©ºçš„ï¼Œä½†æ˜¯å¯¹äºŽ Linux æœåŠ¡å™¨ï¼ŒWeb æœåŠ¡æˆ–è€… FTP æ–‡ä»¶æœåŠ¡çš„èµ„æºå¯ä»¥å­˜æ”¾åœ¨è¿™é‡Œã€‚&lt;/p>
&lt;h2 id="tmp">/tmp&lt;/h2>
&lt;p>Temporary&lt;/p>
&lt;p>å­˜å‚¨ä¸€äº›ç¨‹åºçš„ä¸´æ—¶æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä¸´æ—¶æ–‡ä»¶å¯èƒ½èµ·åˆ°å¾ˆé‡è¦çš„ä½œç”¨ã€‚æ¯”å¦‚æœ‰æ—¶å€™ Word æ–‡æ¡£å´©æºƒäº†ï¼Œå¥½ä¸å®¹æ˜“å†™çš„ä¸œè¥¿å…¨æ²¡äº†ï¼ŒLinux çš„å¾ˆå¤šæ–‡æœ¬ç¼–è¾‘å™¨éƒ½ä¼šåœ¨ &lt;code>/tmp&lt;/code> æ”¾ä¸€ä»½å½“å‰æ–‡æœ¬çš„ copy ä½œä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚æžœä½ çš„ç¼–è¾‘å™¨æ„å¤–å´©æºƒï¼Œæœ‰æœºä¼šåœ¨ &lt;code>/tmp&lt;/code> æ‰¾ä¸€æ‰¾ä¸´æ—¶æ–‡ä»¶æŠ¢æ•‘ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/tmp.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/tmp_hu1b50e9a39b2feae689bf9b3fbfb30a17_96039_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/tmp_hu1b50e9a39b2feae689bf9b3fbfb30a17_96039_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="tmp"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="usr">/usr&lt;/h2>
&lt;p>Unix Shared Resources&lt;/p>
&lt;p>å…±äº«èµ„æºï¼Œè¿™æ˜¯ä¸€ä¸ªéžå¸¸é‡è¦çš„ç›®å½•ï¼Œç”¨æˆ·çš„å¾ˆå¤šåº”ç”¨ç¨‹åºå’Œæ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œç±»ä¼¼äºŽ windows ä¸‹çš„ program files ç›®å½•ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/usr.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/usr_hu2204c3c3a7c106aec9dea68c29029999_46168_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/usr_hu2204c3c3a7c106aec9dea68c29029999_46168_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="usr"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h3 id="usrbin---usrsbin">/usr/bin /usr/sbin&lt;/h3>
&lt;p>ç³»ç»Ÿç”¨æˆ· / è¶…çº§ç®¡ç†å‘˜ ä½¿ç”¨çš„åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;p>åœ¨ Ubuntu ä¸­ï¼Œ&lt;code>/bin&lt;/code> &lt;code>/sbin&lt;/code> å…¶å®žå°±æ˜¯ &lt;code>/usr/bin&lt;/code> &lt;code>/usr/sbin&lt;/code> çš„ä¸€ä¸ªé“¾æŽ¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/usrbin.png"
width="734"
height="476"
srcset="https://www.letout.cn/p/linux-dir/usrbin_hu6a478b7090e2cf503d0d2abd86c3db3e_22476_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/usrbin_hu6a478b7090e2cf503d0d2abd86c3db3e_22476_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="usrbin"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="370px"
>&lt;/p>
&lt;h3 id="usrsrc">/usr/src&lt;/h3>
&lt;p>å†…æ ¸æºä»£ç é»˜è®¤çš„æ”¾ç½®ç›®å½•ã€‚&lt;/p>
&lt;h3 id="usrlib">/usr/lib&lt;/h3>
&lt;p>åŒ…å«æ‰€æœ‰é‚£äº›ç”¨æˆ·ä¸èƒ½ç›´æŽ¥æ‰§è¡Œçš„åº“æ–‡ä»¶ã€‚åŒ…å«ç€æ‰€æœ‰ &amp;lsquo;/usr/bin&amp;rsquo; å’Œ &amp;lsquo;/usr/sbin&amp;rsquo; ç›®å½•ä¸­å¯æ‰§è¡Œå‘½ä»¤ç¨‹åºéœ€è°ƒç”¨çš„äºŒè¿›åˆ¶åº“æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ä½¿ç”¨ &lt;code>apt&lt;/code> å®‰è£… openjdk çš„ç›®å½•åœ¨ &lt;code>/usr/lib/jvm&lt;/code>ã€‚&lt;/p>
&lt;h3 id="usrshare">/usr/share&lt;/h3>
&lt;p>åŒ…å«ç‹¬ç«‹äºŽæž¶æž„çš„å…±äº«æ•°æ®ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ç³»ç»Ÿæ¡Œé¢å›¾æ ‡ç›®å½• &lt;code>/user/share/applications&lt;/code>ã€‚&lt;/p>
&lt;h3 id="usrlocal">/usr/local&lt;/h3>
&lt;p>ç”¨äºŽæœ¬åœ°å®‰è£…è½¯ä»¶çš„ç›®æ ‡ç›®å½•ã€‚ä»Žæºä»£ç å®‰è£…çš„ç”¨æˆ·ç¨‹åºéƒ½å°†å®‰è£…åˆ°è¿™é‡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/usrlocal.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/usrlocal_hu79bfa6340b43e74ca17a031487cf8d3c_78872_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/usrlocal_hu79bfa6340b43e74ca17a031487cf8d3c_78872_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="usrlocal"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="var">/var&lt;/h2>
&lt;p>Variable&lt;/p>
&lt;p>å­˜æ”¾ç€åœ¨ä¸æ–­æ‰©å……ç€çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬ä¹ æƒ¯å°†é‚£äº›ç»å¸¸è¢«ä¿®æ”¹çš„ç›®å½•æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚æ—¥å¿—æ–‡ä»¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/linux-dir/var.png"
width="893"
height="485"
srcset="https://www.letout.cn/p/linux-dir/var_hu71c741f1b1910044aff61d309cf9c7cd_50789_480x0_resize_box_3.png 480w, https://www.letout.cn/p/linux-dir/var_hu71c741f1b1910044aff61d309cf9c7cd_50789_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="var"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://segmentfault.com/a/1190000038497705" target="_blank" rel="noopener"
>https://segmentfault.com/a/1190000038497705&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.runoob.com/linux/linux-system-contents.html" target="_blank" rel="noopener"
>https://www.runoob.com/linux/linux-system-contents.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>æ•°æ®åº“åŸºç¡€æ€»ç»“</title><link>https://www.letout.cn/p/mysql/sql-base/</link><pubDate>Wed, 01 Jun 2022 18:02:02 +0800</pubDate><guid>https://www.letout.cn/p/mysql/sql-base/</guid><description>&lt;img src="https://www.letout.cn/imgs/29.jpeg" alt="Featured image of post æ•°æ®åº“åŸºç¡€æ€»ç»“" />&lt;h2 id="åˆ›å»ºæ•°æ®åº“">åˆ›å»ºæ•°æ®åº“&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">database&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ›å»ºè¡¨">åˆ›å»ºè¡¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">not&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">col1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">not&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">col2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">45&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">col3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ä¿®æ”¹è¡¨">ä¿®æ”¹è¡¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">alter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">add&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">char&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">alter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">drop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">column&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ é™¤è¡¨">åˆ é™¤è¡¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">drop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ’å…¥ä¿¡æ¯">æ’å…¥ä¿¡æ¯&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">col1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;val1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;val2&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ›´æ–°ä¿¡æ¯">æ›´æ–°ä¿¡æ¯&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">update&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ é™¤ä¿¡æ¯">åˆ é™¤ä¿¡æ¯&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">delete&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æŸ¥è¯¢">æŸ¥è¯¢&lt;/h2>
&lt;h3 id="distinct">distinct&lt;/h3>
&lt;p>åŽ»é‡&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">distinct&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="limit">limit&lt;/h3>
&lt;p>é™åˆ¶è¿”å›žçš„è¡Œæ•°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- è¿”å›žå‰5è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- è¿”å›ž 3-5 è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- offset:2, limit:3 è·³è¿‡2è¡Œå–3ä¸ªç»“æžœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">offset&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="asc">asc&lt;/h2>
&lt;p>å‡åºï¼ˆé»˜è®¤ï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">asc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="desc">desc&lt;/h2>
&lt;p>é™åº&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">desc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è¿‡æ»¤">è¿‡æ»¤&lt;/h2>
&lt;p>where&lt;/p>
&lt;ul>
&lt;li>
&lt;p>= ç­‰äºŽ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&amp;lt; å°äºŽ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&amp;gt; å¤§äºŽ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>!= ä¸ç­‰äºŽ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&amp;lt;= å°äºŽç­‰äºŽ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&amp;gt;= å¤§äºŽç­‰äºŽ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>between &amp;hellip; and &amp;hellip; ä¸¤ä¸ªå€¼ä¹‹é—´ï¼ˆå·¦é—­å³é—­åŒºé—´ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>is null ç©ºå€¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>and&lt;/p>
&lt;/li>
&lt;li>
&lt;p>or&lt;/p>
&lt;/li>
&lt;li>
&lt;p>in&lt;/p>
&lt;/li>
&lt;li>
&lt;p>not&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">is&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="é€šé…ç¬¦">é€šé…ç¬¦&lt;/h2>
&lt;ul>
&lt;li>&lt;code>%&lt;/code>
&lt;ul>
&lt;li>åŒ¹é… &amp;gt;= 0 ä¸ªå­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>_&lt;/code>
&lt;ul>
&lt;li>åŒ¹é…ä¸€ä¸ªå­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>[]&lt;/code>
&lt;ul>
&lt;li>åŒ¹é…é›†åˆå†…ä¸­çš„ä»»ä¸€å­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>[^]&lt;/code>
&lt;ul>
&lt;li>ä¸åŒ¹é…é›†åˆå†…çš„ä»»ä¸€å­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- ä¸ä»¥ A B å¼€å¤´çš„ä»»æ„æ–‡æœ¬
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;[^AB]%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- å­¦å·çš„æœ€åŽä¸€ä½ä¸æ˜¯2ã€3ã€5çš„å­¦ç”Ÿä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">å­¦ç”Ÿè¡¨&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">å­¦å·&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%[^235]&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- æŸ¥è¯¢å­¦ç”Ÿè¡¨ä¸­å§“ å¼ ã€æŽã€åˆ˜ çš„å­¦ç”Ÿçš„æƒ…å†µã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">å­¦ç”Ÿè¡¨&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">å§“å&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;[å¼ æŽåˆ˜]%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ†ç»„">åˆ†ç»„&lt;/h2>
&lt;p>GROUP BY&lt;/p>
&lt;p>æŠŠå…·æœ‰ç›¸åŒçš„æ•°æ®å€¼çš„è¡Œï¼Œæ”¾åœ¨åŒä¸€ç»„ä¸­ã€‚&lt;/p>
&lt;p>å¯ä»¥å¯¹åŒä¸€åˆ†ç»„æ•°æ®ï¼Œä½¿ç”¨æ±‡æ€»å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚æ±‚åˆ†ç»„æ•°æ®çš„å¹³å‡å€¼ã€‚&lt;/p>
&lt;p>æŒ‡å®šçš„åˆ†ç»„å­—æ®µï¼Œå¤„ç†èƒ½æŒ‰å­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œä¹Ÿä¼šè‡ªåŠ¨æŒ‰è¯¥å­—æ®µè¿›è¡ŒæŽ’åºã€‚&lt;/p>
&lt;p>HAVING è¿‡æ»¤åˆ†ç»„ã€‚&lt;/p>
&lt;h2 id="å­æŸ¥è¯¢">å­æŸ¥è¯¢&lt;/h2>
&lt;p>å­æŸ¥è¯¢åªèƒ½è¿”å›žä¸€ä¸ªå­—æ®µçš„æ•°æ®ã€‚å¯ä»¥å°†å­æŸ¥è¯¢çš„ç»“æžœä½œä¸º where è¯­å¥çš„è¿‡æ»¤æ¡ä»¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cust_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">cust_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">cust_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">corder_num&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cust_name&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è¿žæŽ¥">è¿žæŽ¥&lt;/h2>
&lt;p>æŠŠä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨çš„è¡Œç»“åˆèµ·æ¥&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mysql/sql-base/sql-join.png"
width="966"
height="760"
srcset="https://www.letout.cn/p/mysql/sql-base/sql-join_hu7ef284e13e9cf28fd7f9189c5de87613_174040_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mysql/sql-base/sql-join_hu7ef284e13e9cf28fd7f9189c5de87613_174040_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="sql-join"
class="gallery-image"
data-flex-grow="127"
data-flex-basis="305px"
>&lt;/p>
&lt;h3 id="join--inner-join">JOIN / INNER JOIN&lt;/h3>
&lt;p>è¡¨ä¸­å­˜åœ¨è‡³å°‘ä¸€ä¸ªåŒ¹é…æ—¶è¿”å›žè¡Œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">data&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">inner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--- inner join å’Œ join æ˜¯ä¸€æ ·çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">data&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="left-join">LEFT JOIN&lt;/h3>
&lt;p>ä»Ž å·¦è¡¨ è¿”å›žæ‰€æœ‰çš„è¡Œï¼Œå³ä½¿å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…ã€‚ï¼ˆæ²¡æœ‰åŒ¹é…æ˜¾ç¤ºç»“æžœä¸º nullï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- è¿”å›žæ‰€æœ‰çš„ç½‘ç«™åŠä»–ä»¬çš„è®¿é—®é‡ï¼ˆå¦‚æžœæœ‰çš„è¯ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- å°† website ä½œä¸ºå·¦è¡¨ï¼Œaccess_log ä½œä¸ºå³è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">desc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="right-join">RIGHT JOIN&lt;/h3>
&lt;p>ä»Žå³è¡¨è¿”å›žæ‰€æœ‰çš„è¡Œï¼Œå³ä½¿åæ ‡æ²¡æœ‰åŒ¹é…ã€‚ï¼ˆå·¦è¡¨æ²¡æœ‰åŒ¹é…æ˜¾ç¤ºç»“æžœä¸º nullï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- è¿”å›žæ‰€æœ‰ç½‘ç«™çš„è®¿é—®è®°å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- åœ¨å·¦è¡¨ä¸­æ²¡æœ‰è®°å½•ï¼Œä¹Ÿä¼šæ˜¾ç¤º null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">desc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="full-joinä¸æ”¯æŒ">FULL JOINï¼ˆä¸æ”¯æŒï¼‰&lt;/h3>
&lt;p>ï¼ˆMySQL ä¸æ”¯æŒï¼Œä½¿ç”¨ union æ‹¼æŽ¥ï¼‰&lt;/p>
&lt;p>å…¨è¿žæŽ¥ã€‚
åªè¦å·¦è¡¨ï¼Œå³è¡¨ï¼Œå…¶ä¸­ä¸€ä¸ªè¡¨å­˜åœ¨åŒ¹é…ï¼Œåˆ™è¿”å›žè¡Œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">full&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">is&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">desc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è‡ªè¿žæŽ¥">è‡ªè¿žæŽ¥&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- æ‰¾å‡ºä¸Ž jim å¤„åœ¨åŒä¸€éƒ¨é—¨çš„æ‰€æœ‰å‘˜å·¥çš„å§“å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employee&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">department&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">department&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employee&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;jim&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employee&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">inner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employee&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">department&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">department&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;jim&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ç»„åˆ">ç»„åˆ&lt;/h2>
&lt;p>union ç»„åˆä¸¤ä¸ªæŸ¥è¯¢ã€‚æ¯ä¸ªæŸ¥è¯¢å¿…é¡»åŒ…å«ç›¸åŒçš„åˆ—ï¼Œè¡¨è¾¾å¼å’Œèšé›†å‡½æ•°ã€‚&lt;/p>
&lt;p>é»˜è®¤åŽ»é™¤ç›¸åŒçš„è¡Œï¼Œå¦‚æžœéœ€è¦ä¿ç•™ç›¸åŒçš„è¡Œï¼Œä½¿ç”¨ union allã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">union&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‡½æ•°">å‡½æ•°&lt;/h2>
&lt;h3 id="è®¡ç®—å­—æ®µ">è®¡ç®—å­—æ®µ&lt;/h3>
&lt;ul>
&lt;li>avg()
&lt;ul>
&lt;li>å¹³å‡å€¼ï¼ˆä¼šå¿½ç•¥ null è¡Œï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>round()
&lt;ul>
&lt;li>round(x) å››èˆäº”å…¥ï¼›round(x, n) ä¿ç•™ n ä½å°æ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>count()
&lt;ul>
&lt;li>è¿”å›žæŸåˆ—çš„è¡Œæ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>max()
&lt;ul>
&lt;li>è¿”å›žæŸåˆ—çš„æœ€å¤§å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>min()
&lt;ul>
&lt;li>è¿”å›žæŸåˆ—çš„æœ€å°å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>sum()
&lt;ul>
&lt;li>æŸåˆ—ä¹‹å’Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ–‡æœ¬å¤„ç†">æ–‡æœ¬å¤„ç†&lt;/h3>
&lt;ul>
&lt;li>left()
&lt;ul>
&lt;li>å·¦è¾¹çš„å­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>right()
&lt;ul>
&lt;li>å³è¾¹çš„å­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>lower()
&lt;ul>
&lt;li>è½¬æ¢æˆå°å†™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>upper()
&lt;ul>
&lt;li>è½¬æ¢æˆå¤§å†™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ltrem()
&lt;ul>
&lt;li>åŽ»é™¤å·¦è¾¹çš„ç©ºæ ¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>rtrem()
&lt;ul>
&lt;li>åŽ»é™¤å³è¾¹çš„ç©ºæ ¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>length()
&lt;ul>
&lt;li>é•¿åº¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>soundex()
&lt;ul>
&lt;li>è½¬æ¢æˆè¯­éŸ³å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ¡ä»¶å‡½æ•°">æ¡ä»¶å‡½æ•°&lt;/h3>
&lt;ul>
&lt;li>&lt;code>if(expr, v1, v2)&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>expr æˆç«‹ï¼Œè¿”å›žç»“æžœ v1ï¼Œå¦åˆ™è¿”å›ž v2ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- SELECT IF(1 &amp;gt; 0,&amp;#39;æ­£ç¡®&amp;#39;,&amp;#39;é”™è¯¯&amp;#39;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- -&amp;gt;æ­£ç¡®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- --
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- å°†ç”¨æˆ·åˆ’åˆ†ä¸º25å²ä»¥ä¸‹å’Œ25å²åŠä»¥ä¸Šä¸¤ä¸ªå¹´é¾„æ®µï¼Œåˆ†åˆ«æŸ¥çœ‹è¿™ä¸¤ä¸ªå¹´é¾„æ®µç”¨æˆ·æ•°é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;25å²åŠä»¥ä¸Š&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;25å²ä»¥ä¸‹&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age_info&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user_profile&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">group&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age_info&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>ifnull(v1, v2)&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>v1 çš„å€¼ä¸ä¸º nullï¼Œè¿”å›ž v1ï¼Œå¦åˆ™è¿”å›ž v2ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ifnull&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">distinct&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Employee&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">desc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SecondHighestSalary&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>case&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- å°†ç”¨æˆ·åˆ’åˆ†ä¸º25å²ä»¥ä¸‹å’Œ25å²åŠä»¥ä¸Šä¸¤ä¸ªå¹´é¾„æ®µï¼Œåˆ†åˆ«æŸ¥çœ‹è¿™ä¸¤ä¸ªå¹´é¾„æ®µç”¨æˆ·æ•°é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">when&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;25å²åŠä»¥ä¸Š&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;25å²ä»¥ä¸‹&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">end&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age_info&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">number&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user_profile&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">group&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age_info&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- å°†ç”¨æˆ·åˆ’åˆ†ä¸º20å²ä»¥ä¸‹ï¼Œ20-24å²ï¼Œ25å²åŠä»¥ä¸Šä¸‰ä¸ªå¹´é¾„æ®µï¼Œåˆ†åˆ«æŸ¥çœ‹ä¸åŒå¹´é¾„æ®µç”¨æˆ·çš„æ˜Žç»†æƒ…å†µ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">device_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">when&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;20å²ä»¥ä¸‹&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">when&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;20-24å²&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">when&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;25å²åŠä»¥ä¸Š&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;å…¶ä»–&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">end&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age_cut&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user_profile&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">update&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Salary&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sex&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">set&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">when&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;m&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;f&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;f&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">end&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted --></description></item><item><title>Redis å¸¸è§æ•°æ®ç»“æž„</title><link>https://www.letout.cn/p/redis/data-struct/</link><pubDate>Wed, 01 Jun 2022 01:52:45 +0800</pubDate><guid>https://www.letout.cn/p/redis/data-struct/</guid><description>&lt;img src="https://www.letout.cn/p/redis/data-struct/redis.jpg" alt="Featured image of post Redis å¸¸è§æ•°æ®ç»“æž„" />&lt;p>Redis æä¾›äº†ä¸°å¯Œçš„æ•°æ®ç±»åž‹ï¼Œå¸¸è§çš„æœ‰äº”ç§ï¼š&lt;/p>
&lt;ul>
&lt;li>String å­—ç¬¦ä¸²&lt;/li>
&lt;li>List åˆ—è¡¨&lt;/li>
&lt;li>Hash å“ˆå¸Œ&lt;/li>
&lt;li>Set é›†åˆ&lt;/li>
&lt;li>Zset æœ‰åºé›†åˆ&lt;/li>
&lt;/ul>
&lt;p>éšç€ Redis ç‰ˆæœ¬çš„æ›´æ–°ï¼ŒåŽé¢åˆæ”¯æŒäº†å››ç§æ•°æ®ç±»åž‹ï¼š&lt;/p>
&lt;ul>
&lt;li>BitMap (2.2)&lt;/li>
&lt;li>HyperLogLog (2.8)&lt;/li>
&lt;li>GEO (3.2)&lt;/li>
&lt;li>Stream (5.0)&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://try.redis.io/" target="_blank" rel="noopener"
>åœ¨çº¿ Redis ä½“éªŒ â†’ https://try.redis.io/&lt;/a>&lt;/p>
&lt;h2 id="-string">ðŸ¦® String&lt;/h2>
&lt;p>String æ˜¯æœ€åŸºæœ¬çš„ &lt;code>key-value&lt;/code> ç»“æž„ã€‚&lt;code>key&lt;/code> æ˜¯å”¯ä¸€æ ‡è¯†ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ï¼‰ï¼Œ&lt;code>value&lt;/code> æ˜¯å…·ä½“çš„å€¼ï¼ˆæœ€é•¿å¯ä»¥å®¹çº³ 521Mï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/data-struct/string.webp"
width="1698"
height="724"
srcset="https://www.letout.cn/p/redis/data-struct/string_hu6be3934e7d6496236c063d8dd99c676c_31658_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/redis/data-struct/string_hu6be3934e7d6496236c063d8dd99c676c_31658_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="562px"
>&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤">ðŸŽ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>ðŸ§© åŸºæœ¬æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è®¾ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">get name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">exists name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å–å­—ç¬¦ä¸²çš„é•¿åº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">strlen name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">del name
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ§© æ‰¹é‡è®¾ç½®&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰¹é‡è®¾ç½® k-v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mset key1 value1 key2 value2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰¹é‡èŽ·å– k-v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mget key1 key2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ§© è®¡æ•°å™¨ï¼ˆvalue ä¸ºæ•´æ•°ï¼‰&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è®¾ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> num &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">incr num
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">incrby num &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">decr num
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">decrby num &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ§© è¿‡æœŸï¼ˆé»˜è®¤ä¸ºæ°¸ä¸è¿‡æœŸï¼‰&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ ex-&amp;gt;ç§’ px-&amp;gt;æ¯«ç§’&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery ex &lt;span class="m">60&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯¹å·²å­˜åœ¨çš„ key è®¾ç½®è¿‡æœŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">expire name &lt;span class="m">60&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹è¿‡æœŸæ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ttl name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç§»é™¤è¿‡æœŸæ—¶é—´ï¼ˆæ— è¿‡æœŸæ—¶é—´ ttl è¿”å›ž -1ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persist name
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ§© å­˜åœ¨ä¸Žä¸å­˜åœ¨&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># key ä¸å­˜åœ¨æ‰æˆåŠŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery nx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># key å­˜åœ¨æ‰æˆåŠŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery xx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®žçŽ°æ–¹å¼">ðŸŽ¡ å®žçŽ°æ–¹å¼&lt;/h3>
&lt;p>String çš„åº•å±‚å®žçŽ°æ˜¯è‡ªå®šä¹‰çš„ SDSï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰ã€‚&lt;/p>
&lt;p>ç›¸æ¯”äºŽ C è¯­è¨€çš„å­—ç¬¦ä¸²ï¼š&lt;/p>
&lt;ul>
&lt;li>SDS ä¸ä»…å¯ä»¥ä¿å­˜æ–‡æœ¬ï¼Œè¿˜å¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>SDS çš„ API éƒ½ä¼šä¸€å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼å¤„ç†ä¿å­˜åœ¨ &lt;code>buf[]&lt;/code> æ•°ç»„ä¸­çš„æ•°æ®ã€‚&lt;/p>
&lt;ul>
&lt;li>SDS èŽ·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚&lt;/li>
&lt;/ul>
&lt;p>C è¯­è¨€çš„å­—ç¬¦ä¸²ä¸ä¼šè®°å½•è‡ªèº«é•¿åº¦ï¼ŒèŽ·å–éœ€è¦éåŽ†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚SDS ç»“æž„ä¸­è®°å½•äº†é•¿åº¦ã€‚&lt;/p>
&lt;ul>
&lt;li>SDS çš„ API æ˜¯å®‰å…¨çš„ï¼Œæ‹¼æŽ¥å­—ç¬¦ä¸²ä¸ä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚&lt;/li>
&lt;/ul>
&lt;p>SDS åœ¨æ‹¼æŽ¥å‰ä¼šæ£€æŸ¥ç©ºé—´æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œä¸å¤Ÿçš„è¯ä¼šè‡ªåŠ¨æ‰©å®¹ã€‚&lt;/p>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯">ðŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ“ ç¼“å­˜å¯¹è±¡&lt;/p>
&lt;ul>
&lt;li>ç›´æŽ¥ç¼“å­˜ JSONã€‚ &lt;code>SET user:1 '{&amp;quot;name&amp;quot;:&amp;quot;emery&amp;quot;, &amp;quot;age&amp;quot;:18}'&lt;/code>&lt;/li>
&lt;li>åˆ†ç¦»ä¸º user:id ä½œä¸º keyï¼Œç”¨ mset å­˜å‚¨ã€‚ &lt;code>MSET user:1:name emery user:1:age 18 user:2:name lin user:2:age 20&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ“ å¸¸è§„è®¡æ•°&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Redis å¤„ç†å‘½ä»¤æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥æ‰§è¡Œå‘½ä»¤çš„è¿‡ç¨‹æ˜¯åŽŸå­çš„ã€‚å¯ä»¥å¯¹è®¿é—®è®¿é—®æ¬¡æ•°ã€ç‚¹èµžã€è½¬å‘ã€åº“å­˜æ•°é‡è¿›è¡Œç»Ÿè®¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> aritcle:readcount:1001 &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åŽŸå­æ“ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">incr aritcle:readcount:1001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ“ &lt;a class="link" href="https://www.letout.cn/p/distributed-lock/redis/" target="_blank" rel="noopener"
>åˆ†å¸ƒå¼é”&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>NX&lt;/code> å‚æ•°å¯ä»¥å®žçŽ°åœ¨ key å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰æ’å…¥æ•°æ®ï¼Œå¯ä»¥ç”¨æ¥å®žçŽ°åˆ†å¸ƒå¼é”ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lock_key åˆ†å¸ƒå¼é”çš„ key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># unique_value å®¢æˆ·ç«¯ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># NX åœ¨ lock_key ä¸å­˜åœ¨æ—¶ï¼Œæ‰è¿›è¡Œæ“ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PX æ¯«ç§’ 10000ms -&amp;gt; 10s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> lock_key unique_value NX PX &lt;span class="m">10000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ“ å…±äº« session ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;p>Session ä¿å­˜åœ¨æœåŠ¡ç«¯ï¼Œé€šå¸¸ç”¨äºŽä¿å­˜ç”¨æˆ·çš„ä¼šè¯çŠ¶æ€ï¼ˆç™»å½•ï¼‰ã€‚&lt;/p>
&lt;p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¤šæ¬¡è¯·æ±‚ä¸ä¸€å®šéƒ½åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© Redis å¯¹ Session ä¿¡æ¯è¿›è¡Œç»Ÿä¸€çš„å­˜å‚¨å’Œç®¡ç†ï¼ŒæœåŠ¡å™¨éƒ½åŽ»åŒä¸€ä¸ª Redis èŽ·å–ç›¸å…³çš„ Session ä¿¡æ¯ï¼Œè¿™æ ·å°±è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ Session å­˜å‚¨çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/data-struct/session.webp"
width="473"
height="412"
srcset="https://www.letout.cn/p/redis/data-struct/session_hua9fef675509e88be48c6a316850a3976_17592_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/redis/data-struct/session_hua9fef675509e88be48c6a316850a3976_17592_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="114"
data-flex-basis="275px"
>&lt;/p>
&lt;h2 id="-list">ðŸ… List&lt;/h2>
&lt;p>List æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæŽ’åºï¼Œå¯ä»¥ä»Žå¤´éƒ¨æˆ–å°¾éƒ¨å‘ List ä¸­æ·»åŠ å…ƒç´ ã€‚æœ€å¤§é•¿åº¦ä¸º &lt;code>2^32 - 1&lt;/code>ã€‚&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-1">ðŸŽ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/data-struct/list.webp"
width="1936"
height="684"
srcset="https://www.letout.cn/p/redis/data-struct/list_huc892bbfdf91688e9656244dd3482dcd2_21712_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/redis/data-struct/list_huc892bbfdf91688e9656244dd3482dcd2_21712_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="283"
data-flex-basis="679px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ’å…¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lpush key value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rpush key value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç§»é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lpop key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rpop key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿”å›žæŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ï¼ˆä»Ž 0 å¼€å§‹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lrange key start end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå¹¶é˜»å¡ž timeout ç§’ï¼ˆå½“ timeout=0 å°±ä¸€ç›´é˜»å¡žï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">blpop key timeout
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">brpop key timeout
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®žçŽ°æ–¹å¼-1">ðŸŽ¡ å®žçŽ°æ–¹å¼&lt;/h3>
&lt;p>Redis List åº•å±‚ç”±ï¼ˆ1ï¼‰åŽ‹ç¼©åˆ—è¡¨ æˆ– ï¼ˆ2ï¼‰åŒå‘é“¾è¡¨ å®žçŽ°ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŽ‹ç¼©åˆ—è¡¨ï¼š&lt;/p>
&lt;ul>
&lt;li>å¦‚æžœåˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å°äºŽ 512 ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± list-max-ziplist-entries é…ç½®ï¼‰ï¼Œ&lt;/li>
&lt;li>åˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äºŽ 64 å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± list-max-ziplist-value é…ç½®ï¼‰ï¼Œ&lt;/li>
&lt;li>Redis ä¼šä½¿ç”¨åŽ‹ç¼©åˆ—è¡¨ä½œä¸º List ç±»åž‹çš„åº•å±‚æ•°æ®ç»“æž„ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>åŒå‘åˆ—è¡¨ï¼šä¸æ»¡è¶³åŽ‹ç¼©åˆ—è¡¨çš„æ¡ä»¶åº•å±‚å°±ä¼šä½¿ç”¨åŒå‘åˆ—è¡¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>åŽ‹ç¼©åˆ—è¡¨&lt;/p>
&lt;p>æ˜¯ Reids ä¸ºäº†èŠ‚çº¦å†…å­˜è€Œå¼€å‘çš„ï¼Œç”±è¿žç»­å†…å­˜å—ç»„æˆçš„é¡ºåºåž‹æ•°æ®ç»“æž„ï¼Œæœ‰ç‚¹ç±»åž‹äºŽæ•°ç»„ã€‚&lt;/p>
&lt;p>åœ¨è¡¨å¤´æœ‰ä¸‰ä¸ªå­—æ®µï¼š
ï¼ˆ1ï¼‰zlbytesï¼šåŽ‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜å­—èŠ‚æ•°ï¼›
ï¼ˆ2ï¼‰zltailï¼šåˆ—è¡¨å°¾çš„åç§»é‡ï¼ˆå°¾éƒ¨è·ç¦»é¦–éƒ¨æœ‰å¤šå°‘ä¸ªå­—èŠ‚ï¼‰ï¼›
ï¼ˆ3ï¼‰zllenï¼šåŽ‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ï¼›&lt;/p>
&lt;p>åœ¨è¡¨å°¾æœ‰ä¸€ä¸ªå­—æ®µï¼š
ï¼ˆ4ï¼‰zlendï¼šåˆ—è¡¨ç»“æŸçš„æ ‡å¿—ï¼ˆå›ºå®šå€¼ 0xFF -&amp;gt; 255ï¼‰ï¼›&lt;/p>
&lt;p>æŸ¥æ‰¾å®šä½ç¬¬ä¸€ä¸ªå’Œæœ€åŽä¸€ä¸ªå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(1)
æŸ¥æ‰¾å…¶ä»–å…ƒç´ ï¼Œåªèƒ½é€ä¸ªæŸ¥æ‰¾ï¼ŒO(n)ï¼Œæ‰€ä»¥åŽ‹ç¼©åˆ—è¡¨ä¸é€‚åˆä¿å­˜è¿‡å¤šçš„å…ƒç´ ã€‚&lt;/p>
&lt;p>åœ¨ Redisä¸­ï¼ŒListã€Hashã€Zset å¯¹è±¡ï¼Œåœ¨å…ƒç´ æ•°é‡è¾ƒå°‘ï¼Œå…ƒç´ å€¼ä¸å¤§æ—¶ï¼Œä¼šä½¿ç”¨åŽ‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æž„ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-1">ðŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ðŸ“ æ¶ˆæ¯é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/data-struct/list-mq.webp"
width="1642"
height="374"
srcset="https://www.letout.cn/p/redis/data-struct/list-mq_hu84909a50c09ec905badb1edece873c1a_26948_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/redis/data-struct/list-mq_hu84909a50c09ec905badb1edece873c1a_26948_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="439"
data-flex-basis="1053px"
>&lt;/p>
&lt;h2 id="-hash">ðŸ¦› Hash&lt;/h2>
&lt;p>Hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆ &lt;code>key-value&lt;/code>ï¼Œç‰¹åˆ«é€‚åˆå­˜å‚¨å¯¹è±¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/data-struct/hash.webp"
width="1240"
height="888"
srcset="https://www.letout.cn/p/redis/data-struct/hash_hu502a0c0c4b1bff1d1b5a1b9e04992920_41732_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/redis/data-struct/hash_hu502a0c0c4b1bff1d1b5a1b9e04992920_41732_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="139"
data-flex-basis="335px"
>&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-2">ðŸŽ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å­˜å‚¨ä¸€ä¸ª key=people çš„å“ˆå¸Œè¡¨ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hset people name &lt;span class="s2">&amp;#34;Emery&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å–å“ˆå¸Œè¡¨ä¸­çš„å€¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hget people name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å­˜å‚¨å¤šä¸ªé”®å€¼å¯¹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmset people name &lt;span class="s2">&amp;#34;Emery&amp;#34;&lt;/span> age &lt;span class="m">18&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰¹é‡èŽ·å–é”®å€¼å¯¹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmget people name age
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤ä¸€ä¸ªå“ˆå¸Œè¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hdel people
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å¾—å“ˆå¸Œè¡¨ä¸­key-valueå¯¹çš„æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hlen people
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„ key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hgetall people
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®žçŽ°æ–¹å¼-2">ðŸŽ¡ å®žçŽ°æ–¹å¼&lt;/h3>
&lt;p>Hash ç±»åž‹çš„åº•å±‚æ•°æ®ç»“æž„ç”± ï¼ˆ1ï¼‰åŽ‹ç¼©åˆ—è¡¨ æˆ– ï¼ˆ2ï¼‰å“ˆå¸Œè¡¨ å®žçŽ°ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŽ‹ç¼©åˆ—è¡¨&lt;/p>
&lt;ul>
&lt;li>å…ƒç´ å°äºŽ 512 ä¸ª&lt;/li>
&lt;li>æ‰€æœ‰çš„å€¼å°äºŽ 64 å­—èŠ‚&lt;/li>
&lt;li>ä½¿ç”¨åŽ‹ç¼©åˆ—è¡¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å“ˆå¸Œè¡¨&lt;/p>
&lt;ul>
&lt;li>ä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ä½¿ç”¨ hash è¡¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-2">ðŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ðŸ“ ç¼“å­˜å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/data-struct/hash-object.webp"
width="1192"
height="840"
srcset="https://www.letout.cn/p/redis/data-struct/hash-object_huacd74159ecd6ae063f912243dd43d93b_31326_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/redis/data-struct/hash-object_huacd74159ecd6ae063f912243dd43d93b_31326_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="340px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">hmset uid:10001 name Tom age &lt;span class="m">15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmset uid:10002 name Jerry age &lt;span class="m">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmget uid:10001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ String ç±»åž‹ç¼“å­˜ JSON ä¹Ÿæ˜¯ç¼“å­˜å¯¹è±¡çš„ä¸€ç§å‡¡æ˜¯ï¼Œå¦‚æžœå¯¹è±¡ä¸­æŸäº›å±žæ€§é¢‘ç¹å˜åŒ–ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Hashã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸ›’ è´­ç‰©è½¦
&lt;ul>
&lt;li>ðŸ˜ƒ ç”¨æˆ· id -&amp;gt; key&lt;/li>
&lt;li>ðŸª å•†å“ id -&amp;gt; field&lt;/li>
&lt;li>ðŸ”¢ å•†å“æ•°é‡ -&amp;gt; value&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ å•†å“ cart:{ç”¨æˆ·id} {å•†å“id} 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hset cart:10001 &lt;span class="m">22223&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hincrby cart:10001 &lt;span class="m">22223&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å¾—å•†å“æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hget cart:10001 &lt;span class="m">22223&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤å•†å“&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hdel cart:10001 &lt;span class="m">22223&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å–è´­ç‰©è½¦æ‰€æœ‰å•†å“&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hgetall cart:10001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨å®žé™…ä¸šåŠ¡ä¸­ï¼ŒRedis ä¸­åªå­˜å‚¨äº†å•†å“çš„ id ä¿¡æ¯ï¼Œåœ¨å›žæ˜¾å•†å“çš„å…·ä½“ä¿¡æ¯æ—¶ï¼Œå†æ‹¿å•†å“ id æŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“ï¼ŒèŽ·å–å®Œæ•´çš„å•†å“ä¿¡æ¯ã€‚&lt;/p>
&lt;h2 id="-set">ðŸ‘ Set&lt;/h2>
&lt;p>Set æ˜¯ä¸€ä¸ªæ— åºå¹¶å”¯ä¸€çš„é›†åˆï¼ˆå­˜å‚¨é¡ºåºä¸ä¼šæŒ‰ç…§æ’å…¥çš„å…ˆåŽé¡ºåºè¿›è¡Œå­˜å‚¨ï¼‰ã€‚&lt;/p>
&lt;p>é›†åˆä¸­æœ€å¤šå¯ä»¥å­˜å‚¨ &lt;code>2^32 - 1&lt;/code> ä¸ªå…ƒç´ ï¼Œé™¤å¢žåˆ æ”¹æŸ¥å¤–ï¼Œè¿˜æ”¯æŒå¤šä¸ªé›†åˆçš„äº¤é›†ã€å¹¶é›†å’Œå·®é›†ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/data-struct/set.webp"
width="1268"
height="654"
srcset="https://www.letout.cn/p/redis/data-struct/set_hu834a88f1bdb5e75fecc5121b1cadeb66_29462_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/redis/data-struct/set_hu834a88f1bdb5e75fecc5121b1cadeb66_29462_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="193"
data-flex-basis="465px"
>&lt;/p>
&lt;p>List ä¸Ž Set çš„åŒºåˆ«ï¼š&lt;/p>
&lt;ul>
&lt;li>List å¯ä»¥å­˜å‚¨é‡å¤å…ƒç´ ï¼ŒSet ä¸å¯ä»¥&lt;/li>
&lt;li>List æŒ‰ç…§å…ƒç´ æ·»åŠ çš„é¡ºåºå­˜å‚¨å…ƒç´ ï¼ŒSet å­˜å‚¨å…ƒç´ æ˜¯æ— åºçš„&lt;/li>
&lt;/ul>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-3">ðŸŽ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>ðŸ§© å¸¸ç”¨æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ å…ƒç´ ï¼ˆå·²å­˜åœ¨åˆ™å¿½ç•¥ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd key value1 &lt;span class="o">[&lt;/span>value2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srem key value1 &lt;span class="o">[&lt;/span>value2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å–æ‰€æœ‰çš„å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">smembers key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å–é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scard key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ¤æ–­æ˜¯å¦å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember key value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»Žé›†åˆä¸­éšæœºé€‰å– count ä¸ªå…ƒç´ ï¼Œä¸ä»Žä¸­åˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srandmember key &lt;span class="o">[&lt;/span>count&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»Žé›†åˆä¸­éšæœºé€‰å– count ä¸ªå…ƒç´ ï¼Œå¹¶åˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spop key &lt;span class="o">[&lt;/span>count&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ§© è¿ç®—æ“ä½œ&lt;/li>
&lt;/ul>
&lt;p>âš  Set çš„äº¤å¹¶å·®é›†è¿ç®—çš„å¤æ‚åº¦è¾ƒé«˜ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œå¦‚æžœç›´æŽ¥æ‰§è¡Œè®¡ç®—ï¼Œä¼šå¯¼è‡´ Redis å®žä¾‹é˜»å¡žã€‚
åœ¨å®žé™…ä¸­ï¼ŒæŽ¨èèŽ·å–æ•°æ®åŽï¼Œåœ¨å®¢æˆ·ç«¯åŽ»å®Œæˆè®¡ç®—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># äº¤é›†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sinter key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># äº¤é›†å¹¶å­˜å‚¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sinterstore destination key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¹¶é›†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sunion key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sunionstore destination key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å·®é›†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sdiff key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sdiffstore destination key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®žçŽ°æ–¹å¼-3">ðŸŽ¡ å®žçŽ°æ–¹å¼&lt;/h3>
&lt;p>Set ç±»åž‹çš„åº•å±‚æ•°æ®ç»“æž„ç”± ï¼ˆ1ï¼‰å“ˆå¸Œè¡¨ æˆ– ï¼ˆ2ï¼‰æ•´æ•°é›†åˆå®žçŽ°ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ•´æ•°é›†åˆ&lt;/p>
&lt;ul>
&lt;li>å…ƒç´ ä¸ªæ•°å°‘äºŽ 512 ä¸ªï¼Œåº•å±‚é‡‡ç”¨æ•´æ•°é›†åˆä½œä¸ºæ•°æ®ç»“æž„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å“ˆå¸Œè¡¨&lt;/p>
&lt;ul>
&lt;li>ä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æž„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-3">ðŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;p>Set ä¸»è¦æ˜¯æ— ç»­ï¼Œä¸å¯é‡å¤ï¼Œå¯æ±‚äº¤å¹¶å·®çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸ“ ç‚¹èµž&lt;/li>
&lt;/ul>
&lt;p>Set ç±»åž‹å¯ä»¥ä¿è¯ç”¨æˆ·åªèƒ½ç‚¹ä¸€ä¸ªèµžã€‚&lt;/p>
&lt;ul>
&lt;li>key -&amp;gt; æ–‡ç«  id&lt;/li>
&lt;li>value -&amp;gt; ç”¨æˆ· id&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ–‡ç«  1 è¢« id ä¸º 1ã€2ã€3 çš„ç”¨æˆ·ç‚¹èµž&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd article:1 uid:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd article:1 uid:2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd article:1 uid:3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å–æ¶ˆç‚¹èµž&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srem article:1 uid:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å– æ–‡ç«  1 çš„ç‚¹èµžç”¨æˆ· id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">smembers article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å– æ–‡ç«  1 çš„ç‚¹èµžæ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scard article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ¤æ–­ ç”¨æˆ· 1 æ˜¯å¦å¯¹æ–‡ç«  1 è¿›è¡Œäº†ç‚¹èµž&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember article:1 uid:1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ“ å…±åŒå…³æ³¨&lt;/li>
&lt;/ul>
&lt;p>Set æ”¯æŒäº¤é›†è¿ç®—ï¼Œå¯ä»¥ç”¨æ¥è®¡ç®—å…±åŒå…³æ³¨çš„å¥½å‹ï¼Œå…¬ä¼—å·ç­‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># id ä¸º 1ã€2 çš„ç”¨æˆ·å…³æ³¨çš„å…¬ä¼—å·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd uid:1 &lt;span class="m">5&lt;/span> &lt;span class="m">6&lt;/span> &lt;span class="m">7&lt;/span> &lt;span class="m">8&lt;/span> &lt;span class="m">9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd uid:2 &lt;span class="m">7&lt;/span> &lt;span class="m">8&lt;/span> &lt;span class="m">9&lt;/span> &lt;span class="m">10&lt;/span> &lt;span class="m">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å–å…±åŒå…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sinter uid:1 uid:2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç»™ uid:2 æŽ¨è uid:1 å…³æ³¨çš„å…¬ä¼—å·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sdiff uid:1 uid:2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># éªŒè¯æŸä¸ªå…¬ä¼—å·æ˜¯å¦è¢«åŒæ—¶å…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember uid:1 &lt;span class="m">5&lt;/span> &lt;span class="c1"># -&amp;gt; 1 å…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember uid:2 &lt;span class="m">5&lt;/span> &lt;span class="c1"># -&amp;gt; 0 æœªå…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ“ æŠ½å¥–æ´»åŠ¨&lt;/li>
&lt;/ul>
&lt;p>key-&amp;gt;æ´»åŠ¨åï¼Œvalue-&amp;gt;ç”¨æˆ·åï¼Œå­˜å‚¨æŸæ´»åŠ¨ä¸­ä¸­å¥–çš„ç”¨æˆ·å ï¼ŒSet ç±»åž‹å› ä¸ºæœ‰åŽ»é‡åŠŸèƒ½ï¼Œå¯ä»¥ä¿è¯åŒä¸€ä¸ªç”¨æˆ·ä¸ä¼šä¸­å¥–ä¸¤æ¬¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sadd lucky Tom Jerry John Sean Marry Lindy Sary Mark
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŠ½å– 1 ä¸ªä¸€ç­‰å¥–ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srangememeber lucky &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŠ½å– 2 ä¸ªäºŒç­‰å¥–ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srangememeber lucky &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸å…è®¸é‡å¤èŽ·å¥–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spop lucky &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-zset">ðŸ¦¥ Zset&lt;/h2>
&lt;p>Zsetï¼ˆæœ‰åºé›†åˆï¼Œä»Žå°åˆ°å¤§ï¼‰ ç›¸æ¯”äºŽ Set ç±»åž‹å¤šäº†ä¸€ä¸ªæŽ’åºåˆ†å€¼ socreã€‚&lt;/p>
&lt;p>å¯¹äºŽæœ‰åºé›†åˆ ZSet æ¥è¯´ï¼Œæ¯ä¸ªå­˜å‚¨çš„å…ƒç´ ç”±ä¸¤ä¸ªå€¼ç»„æˆï¼Œä¸€ä¸ªæ˜¯æœ‰åºé›†åˆçš„å…ƒç´ å€¼ï¼Œä¸€ä¸ªæ˜¯æŽ’åºå€¼ã€‚&lt;/p>
&lt;p>Zset ä¸­å…ƒç´ ä¸èƒ½é‡å¤ï¼Œåˆ†æ•°å€¼å¯ä»¥é‡å¤ï¼Œå¹¶ä¸”å¯ä»¥æŽ’åºã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/redis/data-struct/zset.webp"
width="1226"
height="616"
srcset="https://www.letout.cn/p/redis/data-struct/zset_hudfba1ba2f4862e7afd7997bee0d59f08_21828_480x0_resize_q75_h2_box_2.webp 480w, https://www.letout.cn/p/redis/data-struct/zset_hudfba1ba2f4862e7afd7997bee0d59f08_21828_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="199"
data-flex-basis="477px"
>&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-4">ðŸŽ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>ðŸ§© å¸¸ç”¨æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å‘æœ‰åºé›†åˆä¸­åŠ å…¥å¸¦åˆ†å€¼çš„å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zadd key socre number &lt;span class="o">[[&lt;/span>score number&lt;span class="o">]&lt;/span> ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»Žæœ‰åºé›†åˆä¸­åˆ é™¤å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrem key number &lt;span class="o">[&lt;/span>number ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿”å›žæœ‰åºé›†åˆä¸­å…ƒç´ çš„åˆ†æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zscore key number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿”å›žæœ‰åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zcard key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸ºæœ‰åºé›†åˆä¸­ member çš„åˆ†å€¼åŠ ä¸Š increment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zincrby key increment member
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ­£åºèŽ·å–æœ‰åºé›†åˆä¸­ start-&amp;gt;end çš„ä¸‹è¡¨å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrange key start end &lt;span class="o">[&lt;/span>withscores&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å€’åºèŽ·å–æœ‰åºé›†åˆä¸­ start-&amp;gt;end çš„ä¸‹æ ‡å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrevrange key start end &lt;span class="o">[&lt;/span>withscores&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®žçŽ°æ–¹å¼-4">ðŸŽ¡ å®žçŽ°æ–¹å¼&lt;/h3>
&lt;p>æœ‰åºé›†åˆ Zset åº•å±‚ä½¿ç”¨ ï¼ˆ1ï¼‰åŽ‹ç¼©åˆ—è¡¨ æˆ– ï¼ˆ2ï¼‰è·³è¡¨ ä½œä¸ºæ•°æ®ç»“æž„ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŽ‹ç¼©åˆ—è¡¨ï¼šæœ‰åºé›†åˆä¸­å…ƒç´ å°äºŽ 128 ä¸ªï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äºŽ 64 å­—èŠ‚æ—¶ï¼Œä½¿ç”¨åŽ‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æž„ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·³è¡¨ï¼šä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œä½¿ç”¨è°ƒè¡¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-4">ðŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ðŸ“ æŽ’è¡Œæ¦œ&lt;/li>
&lt;/ul>
&lt;p>ä¾‹å¦‚æ¸¸æˆç§¯åˆ†æŽ’è¡Œæ¦œï¼Œè§†é¢‘æ’­æ”¾æŽ’åï¼Œç”µå•†ç³»ç»Ÿä¸­å•†å“çš„é”€é‡æŽ’åã€‚&lt;/p>
&lt;p>key-&amp;gt;æŽ’è¡Œæ¦œçš„ç±»åž‹ï¼›member-&amp;gt;éœ€æŽ’è¡Œçš„å†…å®¹ï¼ˆå¦‚æ–‡ç« idï¼‰ï¼›score-&amp;gt;ç‚¹å‡»æ•°ã€ç‚¹èµžæ•°ç­‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># emery å‘çš„id=1çš„æ–‡ç« èŽ·å¾—äº† 200 ä¸ªèµž&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zadd user:emery:ranking &lt;span class="m">200&lt;/span> arcticle:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç»™æ–‡ç«  1 ç‚¹èµž&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zincrby user:emery:ranking &lt;span class="m">1&lt;/span> article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹æŸç¯‡æ–‡ç« çš„ç‚¹èµžæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zscore user:emery:ranking article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹ç‚¹èµžæ•°æœ€å¤šçš„ 3 ç¯‡æ–‡ç« &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrevrange user:emery:ranking &lt;span class="m">0&lt;/span> &lt;span class="m">2&lt;/span> withscores
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># èŽ·å– 100 èµžåˆ° 200 èµžçš„æ–‡ç« &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrangebysocre user:emery:ranking &lt;span class="m">100&lt;/span> &lt;span class="m">200&lt;/span> withscores
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ“ å»¶æ—¶é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;p>åˆ©ç”¨ score å­˜å‚¨å»¶æ—¶æ‰§è¡Œçš„æ—¶é—´ï¼Œä½¿ç”¨ zrangebysocre æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œå†è¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="-å‚è€ƒ">ðŸ”— å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://xiaolincoding.com/redis/data_struct/command.html" target="_blank" rel="noopener"
>https://xiaolincoding.com/redis/data_struct/command.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ä½¿ç”¨ ZooKeeper å®žçŽ°åˆ†å¸ƒå¼é”</title><link>https://www.letout.cn/p/distributed/lock/zookeeper/</link><pubDate>Wed, 11 May 2022 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/distributed/lock/zookeeper/</guid><description>&lt;img src="https://www.letout.cn/imgs/2.jpeg" alt="Featured image of post ä½¿ç”¨ ZooKeeper å®žçŽ°åˆ†å¸ƒå¼é”" />&lt;h2 id="ä½¿ç”¨-zookeeper-å®žçŽ°">ä½¿ç”¨ ZooKeeper å®žçŽ°&lt;/h2>
&lt;h3 id="åŽŸç†">åŽŸç†&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>æŒä¹…èŠ‚ç‚¹ï¼ˆçº¢è‰²ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>çž¬æ—¶èŠ‚ç‚¹ï¼ˆé»„è‰²ï¼‰ï¼šä¸å¯å†æœ‰å­èŠ‚ç‚¹ï¼Œä¼šè¯ç»“æŸåŽçž¬æ—¶èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ¶ˆå¤±&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/distributed/lock/zookeeper/node.png"
width="542"
height="618"
srcset="https://www.letout.cn/p/distributed/lock/zookeeper/node_hubb94f897927986ed284f5e5898a8688d_78967_480x0_resize_box_3.png 480w, https://www.letout.cn/p/distributed/lock/zookeeper/node_hubb94f897927986ed284f5e5898a8688d_78967_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="node"
class="gallery-image"
data-flex-grow="87"
data-flex-basis="210px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åˆ©ç”¨ Zookeeper çš„çž¬æ—¶æœ‰åºèŠ‚ç‚¹çš„ç‰¹æ€§ï¼Œå¤šçº¿ç¨‹å¹¶å‘åˆ›å»ºçž¬æ—¶èŠ‚ç‚¹æ—¶ï¼Œå¾—åˆ°æœ‰åºçš„åºåˆ—&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åºå·æœ€å°çš„çº¿ç¨‹èŽ·å¾—é”ï¼Œå…¶ä»–çš„çº¿ç¨‹åˆ™ç›‘å¬è‡ªå·±åºå·çš„å‰ä¸€ä¸ªåºå·ï¼›å½“å‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œåˆ é™¤è‡ªå·±åºå·çš„èŠ‚ç‚¹ï¼›ä¸‹ä¸€ä¸ªåºå·çš„çº¿ç¨‹å¾—åˆ°é€šçŸ¥ï¼Œå°†ç»§ç»­æ‰§è¡Œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå·²ç»ç¡®å®šäº†çº¿ç¨‹çš„æ‰§è¡Œé¡ºåº&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/distributed/lock/zookeeper/thread.png"
width="485"
height="297"
srcset="https://www.letout.cn/p/distributed/lock/zookeeper/thread_hu0d11f519269d68572311b436f0d9b410_73659_480x0_resize_box_3.png 480w, https://www.letout.cn/p/distributed/lock/zookeeper/thread_hu0d11f519269d68572311b436f0d9b410_73659_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="thread"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="391px"
>&lt;/p>
&lt;h3 id="å®žçŽ°">å®žçŽ°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ZkLock&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">AutoCloseable&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Watcher&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">ZooKeeper&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">znode&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// å½“å‰çº¿ç¨‹åˆ›å»ºçš„è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">ZkLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">connectString&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">sessionTimeout&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IOException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">zooKeeper&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ZooKeeper&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">connectString&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">sessionTimeout&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * try-catch-with-resource
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">clode&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">Exception&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">delete&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">znode&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é‡Šæ”¾é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * è§‚å¯Ÿå™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">process&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">WatchedEvent&lt;/span> &lt;span class="n">watchedEvent&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰ä¸€ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤æ—¶ï¼Œå¯å”¤é†’èŽ·å–é”çš„ç­‰å¾…ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹èŽ·å–äº†é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">watchedEvent&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">Event&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">EventType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">NodeDeleted&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">notify&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * èŽ·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">getLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Stat&lt;/span> &lt;span class="n">stat&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">exists&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">stat&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// å½“å‰ä¸šåŠ¡è‹¥æ²¡æœ‰æŒä¹…èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å…ˆåˆ›å»ºä¸€ä¸ªæŒä¹…èŠ‚ç‚¹ï¼Œåœ¨æŒä¹…èŠ‚ç‚¹é‡Œåˆ›å»ºçž¬æ—¶èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getBytes&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">StandardCharsets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">UTF_8&lt;/span>&lt;span class="o">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ZooDefs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Ids&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">OPEN_ACL_UNSAFE&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// å…¬å¼€æƒé™ï¼Œä¸ä½¿ç”¨ç”¨æˆ·åå¯†ç å°±èƒ½è®¿é—®è¿™ä¸ªèŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">CreateMode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PERSISTENT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ›å»ºçž¬æ—¶æœ‰åºèŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">subPath&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;_&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">znode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subPath&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getBytes&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">StandardCharsets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">UTF_8&lt;/span>&lt;span class="o">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ZooDefs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Ids&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">OPEN_ACL_UNSAFE&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CreateMode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">EPHEMERAL_SEQUENTIAL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–è¯¥ä¸šåŠ¡ä¸‹çš„æ‰€æœ‰çž¬æ—¶èŠ‚ç‚¹ï¼Œè¿›è¡Œæ¯”è¾ƒæŽ’åº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">childrenNodes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getChildren&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sort&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">childrenNodes&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æžœåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯å½“å‰åˆ›å»ºçš„èŠ‚ç‚¹ï¼Œç›´æŽ¥èŽ·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">firstNode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">childrenNodes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">znode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">endsWith&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">firstNode&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç­‰å¾…èŽ·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">lastNode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">firstNode&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">childrenNode&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ‰¾åˆ°å½“å‰èŠ‚ç‚¹ï¼Œç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">znode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">endWith&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">exists&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">lastNode&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lastNode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">node&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è®©å½“å‰çº¿ç¨‹é˜»å¡žï¼Œå¹¶ä¸”ä¼šé‡Šæ”¾é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ä¸Šé¢çš„åŒæ­¥ä»£ç å—æ‰ä¼šèŽ·å¾—é”å¹¶æ‰§è¡Œ notify()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">KeeperException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æµ‹è¯•">æµ‹è¯•&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ZkLockController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/zkLock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">zkLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;è¿›å…¥æ–¹æ³•&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ZkLock&lt;/span> &lt;span class="n">zklock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ZkLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;127.0.0.1:2181&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">10000&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">zkLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;order&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;èŽ·å–äº†é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUtil&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ¨¡æ‹Ÿä¸šåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®Œæˆä¸šåŠ¡&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;success&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="curator">Curator&lt;/h2>
&lt;p>&lt;img src="https://www.letout.cn/p/distributed/lock/zookeeper/curator.png"
width="537"
height="87"
srcset="https://www.letout.cn/p/distributed/lock/zookeeper/curator_hu690a82169c4c3fdc258308de88a2c62f_35331_480x0_resize_box_3.png 480w, https://www.letout.cn/p/distributed/lock/zookeeper/curator_hu690a82169c4c3fdc258308de88a2c62f_35331_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="curator"
class="gallery-image"
data-flex-grow="617"
data-flex-basis="1481px"
>&lt;/p>
&lt;h3 id="ä¾èµ–é…ç½®">ä¾èµ–é…ç½®&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.apache.curator&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>curator-recipes&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>4.2.0&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®žçŽ°-1">å®žçŽ°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">DemoTest&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">test&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">zookeeperConnectionString&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;127.0.0.1:2181&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RetryPolicy&lt;/span> &lt;span class="n">retryPolicy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ExponentialBackoffRetry&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CuratorFramework&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">CuratorFrameworkFactory&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newClient&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">zookeeperConnectionString&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">retryPolicy&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">lockPath&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/order&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">InterProcessMutex&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">InterProcessMutex&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">lockPath&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–äº’æ–¥é”ï¼Œé˜»å¡žç›´åˆ°å¯ç”¨ï¼Œæˆ–ç»™å®šæ—¶é—´åˆ°æœŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// åŒä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ acquire() å¯é‡å…¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">acquire&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;èŽ·å–é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¿…é¡»é€šè¿‡ release() é‡Šæ”¾é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">release&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>ä½¿ç”¨ Redis å®žçŽ°åˆ†å¸ƒå¼é”</title><link>https://www.letout.cn/p/distributed/lock/redis/</link><pubDate>Wed, 11 May 2022 12:14:45 +0800</pubDate><guid>https://www.letout.cn/p/distributed/lock/redis/</guid><description>&lt;img src="https://www.letout.cn/imgs/1.jpeg" alt="Featured image of post ä½¿ç”¨ Redis å®žçŽ°åˆ†å¸ƒå¼é”" />&lt;h2 id="redis-nx-å®žçŽ°">Redis NX å®žçŽ°&lt;/h2>
&lt;p>åˆ©ç”¨ NX çš„&lt;strong>åŽŸå­æ€§&lt;/strong>ï¼Œå¤šä¸ªçº¿ç¨‹å¹¶å‘æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¾ç½®æˆåŠŸï¼Œè®¾ç½®æˆåŠŸå³èŽ·å–äº†é”ã€‚&lt;/p>
&lt;p>&lt;strong>å¦‚æžœæ²¡æœ‰èŽ·å–é”ï¼Œä¸ä¼šé˜»å¡žå½“å‰æ–¹æ³•ï¼Œç›´æŽ¥è·³è¿‡ä»»åŠ¡ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="èŽ·å–é”">èŽ·å–é”&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set key unique_value NX PX 30000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> product:stock:clothes UUID NX PX &lt;span class="m">30000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>key
&lt;ul>
&lt;li>æ ¹æ®ä¸åŒçš„ä¸šåŠ¡ï¼ŒåŒºåˆ†ä¸åŒçš„é”&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>unique_value
&lt;ul>
&lt;li>ä¿è¯æ¯ä¸ªçº¿ç¨‹çš„éšæœºå€¼éƒ½ä¸åŒï¼Œç”¨äºŽé‡Šæ”¾é”æ—¶çš„æ ¡éªŒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>NX
&lt;ul>
&lt;li>key ä¸å­˜åœ¨æ—¶è®¾ç½®æˆåŠŸï¼Œkey å­˜åœ¨åˆ™ä¸æˆåŠŸ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>PX
&lt;ul>
&lt;li>è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ã€‚è‹¥å‡ºçŽ°å¼‚å¸¸ï¼Œæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå¯ä»¥ä¿è¯è¶…æ—¶åŽï¼Œé”å¯ä»¥è¿‡æœŸå¤±æ•ˆï¼ˆæ¯«ç§’ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="é‡Šæ”¾é”">é‡Šæ”¾é”&lt;/h3>
&lt;p>é‡Šæ”¾é”å°†è¯¥ key åˆ é™¤ï¼Œåœ¨é‡Šæ”¾é”ä¹‹å‰éœ€è¦æ ¡éªŒè®¾ç½®çš„éšæœºæ•°ï¼Œç›¸åŒæ‰è¡¨ç¤ºæ˜¯è¯¥çº¿ç¨‹åŠ çš„é”ï¼Œèƒ½é‡Šæ”¾ã€‚&lt;/p>
&lt;p>éœ€è¦é‡‡ç”¨ LUA è„šæœ¬ï¼Œdel å‘½ä»¤æ²¡æœ‰æä¾›æ ¡éªŒå€¼çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>redis æ‰§è¡Œå‘½ä»¤æ˜¯æŒ‰ç…§ä¸€æ¡æŒ‡ä»¤å®Œæˆä¹‹åŽï¼Œå†æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œç”¨ lua è„šæœ¬ï¼Œèƒ½ä¿è¯ redis æ‰§è¡Œå®Œè¿™ä¸ªè„šæœ¬æ‰æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œæ‰€ä»¥èƒ½ä¿è¯åˆ¤æ–­ å’Œ åˆ é™¤æ˜¯åŽŸå­æ€§çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">if&lt;/span> &lt;span class="n">redis.call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;get&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">KEYS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">ARGV&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="kr">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="n">redis.call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;del&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">KEYS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å®žçŽ°">å®žçŽ°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedisLockController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/redisLock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">redisLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–åˆ†å¸ƒå¼é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">RedisCallback&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;)&lt;/span> &lt;span class="n">redisConnection&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Expiration&lt;/span> &lt;span class="n">expiration&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Expiration&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">seconds&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// NX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span> &lt;span class="n">setOption&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ifAbsent&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// éœ€è¦ä½¿ç”¨ redisTemplate ä¸­çš„åºåˆ—åŒ–å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKeySerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisValue&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValueSerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">redisConnection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisKey&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">redisValue&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">expiration&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// èŽ·å–åˆ°äº†é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;èŽ·å–åˆ°äº†é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;if redis.call(\&amp;#34;get\&amp;#34;,KEYS[1])==ARGV[1] then\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn redis.call(\&amp;#34;del\&amp;#34;,KEYS[1])\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;else\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn 0\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;end&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">redisScript&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">of&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Boolean&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisScript&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é‡Šæ”¾é” {}&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ä¸šåŠ¡å®Œæˆ&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;success&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedisLock&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”åç§°ï¼Œä¸åŒä¸šåŠ¡å¯èƒ½é”ä¸åŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">RedisLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">redisTemplate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">expireTime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// value å¯ä»¥ä¸æš´éœ²å‡ºåŽ»ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ä¸ä¸€æ ·çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">UUID&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">randomUUID&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * èŽ·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">getLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–åˆ†å¸ƒå¼é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">RedisCallback&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;)&lt;/span> &lt;span class="n">redisConnection&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Expiration&lt;/span> &lt;span class="n">expiration&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Expiration&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">seconds&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">expireTime&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// NX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span> &lt;span class="n">setOption&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ifAbsent&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç”±äºŽè¿™é‡Œéœ€è¦æŽ¥å— byte, ä¸èƒ½æš´åŠ›çš„ä½¿ç”¨ string.getBytes()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// è¦ä½¿ç”¨æ¨¡æ¿é‡Œé¢çš„ key\value åºåˆ—åŒ–å™¨æ¥å®žçŽ°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKeySerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisValue&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValueSerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisConnection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisKey&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">redisValue&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">expiration&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">setOption&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * é‡Šæ”¾é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">unLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// lua è„šæœ¬
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;if redis.call(\&amp;#34;get\&amp;#34;,KEYS[1])==ARGV[1] then\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn redis.call(\&amp;#34;del\&amp;#34;,KEYS[1])\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;else\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn 0\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;end&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">redisScript&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">of&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Boolean&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisScript&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="redisson">Redisson&lt;/h2>
&lt;h3 id="ä¾èµ–é…ç½®">ä¾èµ–é…ç½®&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.redisson&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>redisson-spring-boot-starter&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>3.16.7&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®žçŽ°-1">å®žçŽ°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedissonLockController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedissonClient&lt;/span> &lt;span class="n">redissonClient&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/redissonLock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">redissonLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;æ‰§è¡Œæ–¹æ³•&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;redisson&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redissonClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”è¶…æ—¶æ—¶é—´ï¼Œå¦‚æžœæœªèŽ·å¾—é”ï¼Œä¼šé˜»å¡žç­‰å¾…èŽ·å–åˆ°é”ï¼ˆ-1 è¡¨ç¤ºæ²¡æœ‰è¶…æ—¶æ—¶é—´ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;èŽ·å–é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é‡Šæ”¾é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®Œæˆä¸šåŠ¡&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;success&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - CyclicBarrier å®žçŽ°åŽŸç†</title><link>https://www.letout.cn/p/thread/cyclicbarrier/</link><pubDate>Tue, 03 May 2022 23:02:02 +0800</pubDate><guid>https://www.letout.cn/p/thread/cyclicbarrier/</guid><description>&lt;img src="https://www.letout.cn/imgs/14.jpeg" alt="Featured image of post Java å¹¶å‘ - CyclicBarrier å®žçŽ°åŽŸç†" />&lt;h2 id="åŽŸç†">åŽŸç†&lt;/h2>
&lt;p>&lt;code>CyclicBarrier&lt;/code> é€šè¿‡å¯é‡å…¥é” &lt;code>CyclicBarrier&lt;/code> å®žçŽ°ï¼Œå†…éƒ¨ä½¿ç”¨é™æ€å†…éƒ¨ç±» &lt;code>Generation&lt;/code> ç»´æŠ¤ &lt;code>broken&lt;/code> æ ‡è®°ï¼Œè¡¨ç¤ºå±éšœæ˜¯å¦å¯ç”¨ã€‚&lt;/p>
&lt;p>é€šè¿‡æž„é€ æ–¹æ³•ä¼ å…¥ç­‰å¾…çº¿ç¨‹æ•° &lt;code>parties&lt;/code>ã€‚&lt;/p>
&lt;p>æ¯æ¬¡æœ‰ä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœï¼Œ &lt;code>count - 1&lt;/code>ï¼Œç›´åˆ° &lt;code>count = 0&lt;/code>ï¼Œä¼šé‡Šæ”¾å±éšœï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨ &lt;code>nextGeneration()&lt;/code> å¯¹ &lt;code>count&lt;/code> å’Œ &lt;code>generation&lt;/code> è¿›è¡Œé‡ç½®ï¼Œè¿›è¡Œä¸‹ä¸€è½®å¾ªçŽ¯ã€‚&lt;/p>
&lt;p>æœ‰ä¸‰ç§æƒ…å†µä¼šé€ æˆå±éšœç ´åï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>CyclicBarrier Runnable command æ–¹æ³•æŠ›å‡ºå¼‚å¸¸&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨é‡Šæ”¾æ¡ä»¶è¿˜æœªè¾¾åˆ°æ—¶ï¼ŒæŸä¸ªçº¿ç¨‹æŠ›å‡ºäº†å¼‚å¸¸&lt;/p>
&lt;/li>
&lt;li>
&lt;p>await() ç­‰å¾…è¶…æ—¶&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æºç ">æºç &lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">CyclicBarrier&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å†…éƒ¨ç±»ï¼Œå­˜æ”¾ broken æ ‡è®°ï¼Œè¡¨ç¤ºå±éšœæ˜¯å¦è¢«æŸåï¼ŒæŸååŽæ— æ³•æ­£å¸¸å·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Generation&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">broken&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¯é‡å…¥é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Condition&lt;/span> &lt;span class="n">trip&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newCondition&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å±éšœé˜»æŒ¡çš„çº¿ç¨‹æ•°ï¼Œæž„é€ æ–¹æ³•ä¼ å…¥çš„åˆå§‹åŒ–å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å±éšœé‡Šæ”¾æ—¶æ‰§è¡Œçš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="n">barrierCommand&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰çš„ Generation å¯¹è±¡ï¼Œæ¯ä¸€è½®éƒ½ä¼šæœ‰ä¸€ä¸ªæ–°çš„ Generation å¯¹è±¡ï¼Œå­˜æ”¾ broken æ ‡è®°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="n">Generation&lt;/span> &lt;span class="n">generation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Generation&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰è¿˜éœ€è¦é˜»æŒ¡å‡ ä¸ªçº¿ç¨‹ï¼Œæ¯æ¬¡ -1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¼€å¯ä¸‹ä¸€è½®å±éšœï¼ˆcount==0 æˆ– resetï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">nextGeneration&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">signalAll&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡ç½® count
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">generation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Generation&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç ´åå½“å‰å±éšœï¼Œå˜ä¸ºä¸å¯ç”¨çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ reset æ¢å¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">breakBarrier&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">generation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">signalAll&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">dowait&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">boolean&lt;/span> &lt;span class="n">timed&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">nanos&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeoutException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åŠ é”ï¼Œæœ‰å¤šä¸ªçº¿ç¨‹ä¼šè°ƒç”¨ await() åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥åŒæ­¥æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">Generation&lt;/span> &lt;span class="n">g&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generation&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// å±éšœæ˜¯å¦æŸå
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">interrupted&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">index&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">index&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// è¾¾åˆ°æ¡ä»¶ï¼Œå¯æ‰“ç ´å±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">ranAction&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="n">command&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">barrierCommand&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">command&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// æ‰§è¡Œæ‰“ç ´å±éšœçš„å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">command&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ranAction&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nextGeneration&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// å¼€å¯ä¸‹ä¸€è½®å¾ªçŽ¯ï¼Œé‡Œé¢ä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">ranAction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// (1) å‡å¦‚ command å‡ºçŽ°å¼‚å¸¸ï¼Œç ´åå±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰è¿˜æœªè¾¾åˆ°å†²ç ´å±éšœçš„çš„æ¡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ä¸€ç›´å¾ªçŽ¯ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾æ‰“ç ´å±éšœçš„æ¡ä»¶ï¼Œä¸­æ–­ï¼Œæˆ–è¶…æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(;;)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">timed&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// æœªè¾¾åˆ°è¶…æ—¶æ—¶é—´ï¼Œè¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°è¢«å”¤é†’
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">nanos&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">0L&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nanos&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">awaitNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">nanos&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">ie&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// (2) ç­‰å¾…åˆ°è¾¾æ¡ä»¶æ—¶ï¼Œçº¿ç¨‹è¢«ä¸­æ–­ï¼Œç ´åå±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">generation&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="o">!&lt;/span> &lt;span class="n">g&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">ie&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// We&amp;#39;re about to finish waiting even if we had not
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// been interrupted, so this interrupt is deemed to
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// &amp;#34;belong&amp;#34; to subsequent execution.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">interrupt&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// çº¿ç¨‹è¢«å”¤é†’ä¹‹åŽï¼Œå±éšœè¢«ç ´åï¼Œç›´æŽ¥æŠ›å‡ºå¼‚å¸¸
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">generation&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// è¿”å›žå½“å‰çº¿ç¨‹æ˜¯ç¬¬å‡ ä¸ªåˆ°è¾¾çš„çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">timed&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">nanos&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">0L&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// (3) ç­‰å¾…è¶…æ—¶ï¼Œç ´åå±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">TimeoutException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">CyclicBarrier&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="n">barrierAction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">parties&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">IllegalArgumentException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">parties&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">barrierCommand&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">barrierAction&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">CyclicBarrier&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">parties&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getParties&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¼€å§‹ç­‰å¾… è¿”å›žå½“å‰çº¿ç¨‹æ˜¯ç¬¬å‡ ä¸ªåˆ°è¾¾çš„çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">dowait&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">0L&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">TimeoutException&lt;/span> &lt;span class="n">toe&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Error&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">toe&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// cannot happen
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="n">timeout&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeoutException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">dowait&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">timeout&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ¤æ–­å±éšœæ˜¯å¦è¢«ç ´å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">isBroken&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// éœ€åŠ é”è®¿é—®ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½åœ¨æ‰§è¡Œ dowait()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">generation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡ç½®æ“ä½œ å…ˆç ´åå±éšœï¼Œå†è¿›è¡Œä¸‹ä¸€è½®å¾ªçŽ¯å±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">reset&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// break the current generation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">nextGeneration&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// start a new generation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–ç­‰å¾…çº¿ç¨‹æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getNumberWaiting&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">parties&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - CountDownLatch å®žçŽ°åŽŸç†</title><link>https://www.letout.cn/p/thread/countdownlatch/</link><pubDate>Tue, 03 May 2022 14:02:02 +0800</pubDate><guid>https://www.letout.cn/p/thread/countdownlatch/</guid><description>&lt;img src="https://www.letout.cn/imgs/6.jpeg" alt="Featured image of post Java å¹¶å‘ - CountDownLatch å®žçŽ°åŽŸç†" />&lt;h2 id="åŸºæœ¬å®žçŽ°æ€è·¯">åŸºæœ¬å®žçŽ°æ€è·¯ï¼š&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>åˆ©ç”¨ &lt;strong>å…±äº«é”&lt;/strong> å®žçŽ°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆå§‹åŒ–æ—¶ï¼Œ&lt;code>state=count&lt;/code> å³å·²ç»ä¸Šäº† &lt;code>count&lt;/code> æ¬¡å…±äº«é”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>await()&lt;/code> å³åŠ å…±äº«é”ï¼Œå¿…é¡» &lt;code>state=0&lt;/code> æ—¶æ‰èƒ½åŠ é”æˆåŠŸï¼Œå¦åˆ™æŒ‰ç…§ AQS æœºåˆ¶ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—é˜»å¡ž&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>countDown()&lt;/code> è§£ä¸€æ¬¡é”ï¼Œç›´åˆ°ä¸º &lt;code>0&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æºç ">æºç &lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">CountDownLatch&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å†…éƒ¨ç±»å®žçŽ° AQS
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Sync&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">AbstractQueuedSynchronizer&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">serialVersionUID&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">4982264981922014374L&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Sync&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ä½¿ç”¨ AQS çš„ state ä½œä¸ºè®¡æ•°å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">setState&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getCount&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">getState&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡‡ç”¨ **å…±äº«é”** æœºåˆ¶ï¼Œå› ä¸ºå¯ä»¥è¢«ä¸åŒçš„çº¿ç¨‹ countdown
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">protected&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">tryAcquireShared&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">acquires&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">getState&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">protected&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">tryReleaseShared&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">releases&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¯æ¬¡æ‰§è¡Œå°† state-1ï¼Œç›´åˆ° state=0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(;;)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getState&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">nextc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">compareAndSetState&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">nextc&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="c1">// é€šè¿‡ CAS æ”¹å˜ state çš„å€¼ï¼Œå¤±è´¥ä¼šè¿›è¡Œä¸‹ä¸€è½®å¾ªçŽ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">nextc&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Sync&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">CountDownLatch&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">IllegalArgumentException&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;count &amp;lt; 0&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sync&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Sync&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é€šè¿‡ acquireSharedInterruptibly èŽ·å–å…±äº«é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// è‹¥ state!=0 ä¼šè¢«æŒç»­é˜»å¡ž
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">acquireSharedInterruptibly&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// 1 è¿™é‡Œæ˜¯éšæ„çš„å‚æ•°ï¼Œåœ¨ coutdownlatch ä¸­æ— æ„ä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="n">timeout&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">tryAcquireSharedNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">timeout&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è§£é”ä¸€æ¬¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">countDown&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">releaseShared&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–å½“å‰è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="nf">getCount&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCount&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kd">super&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;[Count = &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCount&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;]&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>ä½¿ç”¨ Github Actions åœ¨è…¾è®¯äº‘ CloudBase éƒ¨ç½² Hugo</title><link>https://www.letout.cn/p/hugo-in-cloudbase/</link><pubDate>Mon, 02 May 2022 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/hugo-in-cloudbase/</guid><description>&lt;img src="https://www.letout.cn/imgs/3.jpeg" alt="Featured image of post ä½¿ç”¨ Github Actions åœ¨è…¾è®¯äº‘ CloudBase éƒ¨ç½² Hugo" />&lt;h2 id="-ä»‹ç»">ðŸŒ± ä»‹ç»&lt;/h2>
&lt;p>è®¸å¤šå¹³å°éƒ½æä¾›äº†å…è´¹çš„é™æ€é¡µé¢æ‰˜ç®¡çš„æœåŠ¡ï¼Œå¦‚ &lt;code>Github Pages&lt;/code>ï¼Œ&lt;code>Vercel&lt;/code>ï¼Œ&lt;code>Netlify&lt;/code>ç­‰ã€‚ä½†åœ¨å›½å†…ç”±äºŽä¸€äº›â€œåŽŸå› â€ï¼Œè¿™äº›å›½å¤–çš„æœåŠ¡åœ¨å›½å†…çš„è®¿é—®å¹¶ä¸ç¨³å®šã€‚&lt;/p>
&lt;p>å›½å†…çš„å…è´¹æ‰˜ç®¡å¹³å°å¦‚ &lt;code>Gitee&lt;/code> é™åˆ¶å¾ˆå¤šï¼Œä¸å¯ä»¥è‡ªå®šä¹‰åŸŸåè€Œä¸”ä¹‹å‰å‡ºçŽ°äº†é˜²ç›—é“¾é—®é¢˜ï¼Œè®¿é—®ä¹Ÿä¸æ˜¯å¾ˆå¿«ï¼Œä¸å¤ªæŽ¨èä½œä¸ºæ‰˜ç®¡å¹³å°ã€‚&lt;/p>
&lt;p>è…¾è®¯äº‘æŽ¨å‡ºçš„äº‘å¼€å‘ &lt;code>CloudBase&lt;/code> ä¹Ÿæœ‰é™æ€é¡µé¢æ‰˜ç®¡æœåŠ¡ã€‚å…¶å®žå®ƒç›¸æ¯”è¿™äº›é™æ€æ‰˜ç®¡å¹³å°ï¼Œæœ‰æ›´å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œç”šè‡³èƒ½å¤Ÿæ­ä¸€æ•´å¥—ç³»ç»Ÿã€‚è™½ç„¶æ˜¯ä»˜è´¹æœåŠ¡ï¼Œä½†æ˜¯åœ¨æŒ‰é‡ä»˜è´¹çš„æƒ…å†µä¸‹èµ„è´¹ä¸æ˜¯å¾ˆé«˜ï¼Œåœ¨åšå®¢è®¿é—®é‡ä¸æ˜¯å¾ˆé«˜çš„æƒ…å†µä¸‹ååˆ†åˆé€‚ã€‚&lt;/p>
&lt;p>ç›®å‰åœ¨è…¾è®¯äº‘ä¸­æš‚æ—¶è¿˜æ²¡æœ‰ &lt;code>Hugo&lt;/code> çš„æ¨¡æ¿ã€‚ç›®å‰æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è¾¾åˆ°è‡ªåŠ¨éƒ¨ç½²çš„åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ° ä½¿ç”¨ &lt;code>Github Actions&lt;/code> ç¼–è¯‘ï¼Œé€šè¿‡ &lt;code>Tencent CloudBase Github Action&lt;/code> è‡ªåŠ¨éƒ¨ç½²åˆ° &lt;code>CloudBase&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ° ä½¿ç”¨ &lt;code>Github Actions&lt;/code> ç¼–è¯‘ï¼ŒæŽ¨é€åˆ° &lt;code>Web åº”ç”¨æ‰˜ç®¡ï¼ˆwebifyï¼‰&lt;/code> çš„ç®€æ˜“é™æ€é¡µé¢æ¨¡æ¿ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ä½¿ç”¨-cloudbase">ðŸ– ä½¿ç”¨ CloudBase&lt;/h2>
&lt;p>&lt;strong>ä½¿ç”¨ CloudBse æ—¶ï¼Œä½¿ç”¨æŒ‰é‡è®¡è´¹çŽ¯å¢ƒä¼šæœ‰ä¸€äº›å…è´¹ç”¨é‡ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="-è…¾è®¯äº‘">â˜ï¸ è…¾è®¯äº‘&lt;/h3>
&lt;h4 id="åˆ›å»ºçŽ¯å¢ƒ">åˆ›å»ºçŽ¯å¢ƒ&lt;/h4>
&lt;p>åœ¨ &lt;code>äº‘å¼€å‘ CloudBase&lt;/code> æ–°å»ºä¸€ä¸ªåº”ç”¨ï¼Œé€‰æ‹© &lt;strong>ç©ºæ¨¡æ¿&lt;/strong>ï¼Œæ ¹æ®è‡ªèº«éœ€æ±‚å¡«å†™ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-cloudbase/new.png"
width="1896"
height="1608"
srcset="https://www.letout.cn/p/hugo-in-cloudbase/new_hu99910b72135936b76933bc6c60d2f8a9_394958_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-cloudbase/new_hu99910b72135936b76933bc6c60d2f8a9_394958_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="new"
class="gallery-image"
data-flex-grow="117"
data-flex-basis="282px"
>&lt;/p>
&lt;p>åˆ›å»ºæˆåŠŸåŽï¼ŒèŽ·å¾— &lt;code>çŽ¯å¢ƒID&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-cloudbase/env_id.png"
width="796"
height="406"
srcset="https://www.letout.cn/p/hugo-in-cloudbase/env_id_hucc29efc322e6de70f5fc042978c8e74b_42486_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-cloudbase/env_id_hucc29efc322e6de70f5fc042978c8e74b_42486_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="env_id"
class="gallery-image"
data-flex-grow="196"
data-flex-basis="470px"
>&lt;/p>
&lt;h4 id="èŽ·å–-api-å¯†é’¥">èŽ·å– API å¯†é’¥&lt;/h4>
&lt;p>ä¸ºéƒ¨ç½²æ–°å»ºä¸€ä¸ªå¯†é’¥å¯¹ã€‚åœ¨ &lt;code>è®¿é—®ç®¡ç† -&amp;gt; ç”¨æˆ·åˆ—è¡¨ -&amp;gt; æ–°å»ºç”¨æˆ· -&amp;gt; è‡ªå®šä¹‰åˆ›å»º -&amp;gt; å¯è®¿é—®èµ„æºå¹¶æŽ¥æ”¶æ¶ˆæ¯&lt;/code>ã€‚&lt;a class="link" href="https://console.cloud.tencent.com/cam" target="_blank" rel="noopener"
>ðŸ”— ä¼ é€é—¨&lt;/a>&lt;/p>
&lt;p>æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæ–°å»ºç”¨æˆ·ååŽé€‰æ‹© &lt;code>ç¼–ç¨‹è®¿é—®&lt;/code>ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-cloudbase/new_user.png"
width="2122"
height="1158"
srcset="https://www.letout.cn/p/hugo-in-cloudbase/new_user_hu5db7ae8d8e85e220ba3039161cacacd8_188871_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-cloudbase/new_user_hu5db7ae8d8e85e220ba3039161cacacd8_188871_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="new_user"
class="gallery-image"
data-flex-grow="183"
data-flex-basis="439px"
>&lt;/p>
&lt;p>åœ¨è‡ªå®šä¹‰ç­–ç•¥ä¸­å‹¾é€‰ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>QcloudAccessForTCBRole&lt;/code>ï¼šæŽˆäºˆäº‘å¼€å‘ï¼ˆTCBï¼‰å¯¹äº‘èµ„æºçš„è®¿é—®æƒé™ï¼›&lt;/li>
&lt;li>&lt;code>QcloudAccessForTCBRoleInAccessCloudBaseRun&lt;/code>ï¼šä¾›äº‘å¼€å‘ï¼ˆTCBï¼‰æœåŠ¡è§’è‰²ï¼ˆTCB_QcsRoleï¼‰è¿›è¡Œå…³è”ï¼Œç”¨äºŽ TCB è®¿é—®å…¶ä»–äº‘æœåŠ¡èµ„æºã€‚åŒ…å«ç§æœ‰ç½‘ç»œ VPCã€äº‘æœåŠ¡å™¨ CVM ç›¸å…³æ“ä½œæƒé™ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-cloudbase/access.png"
width="2048"
height="626"
srcset="https://www.letout.cn/p/hugo-in-cloudbase/access_hu76f892695bd748244f5434357abaf2d0_122725_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-cloudbase/access_hu76f892695bd748244f5434357abaf2d0_122725_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="access"
class="gallery-image"
data-flex-grow="327"
data-flex-basis="785px"
>&lt;/p>
&lt;p>ç‚¹ä¸€ä¸‹ä¸€æ­¥åŽï¼Œæ–°å»ºç”¨æˆ·æˆåŠŸã€‚å¯ä»¥èŽ·å¾— &lt;code>SecretId&lt;/code> å’Œ &lt;code>SecretKey&lt;/code>ã€‚&lt;/p>
&lt;h3 id="-github-actions">âš™ï¸ Github Actions&lt;/h3>
&lt;h4 id="è®¾ç½®-github-secrets">è®¾ç½® Github Secrets&lt;/h4>
&lt;p>åœ¨é¡¹ç›®çš„ &lt;code>Settings -&amp;gt; Secrets -&amp;gt; Actions&lt;/code> ä¸­æ·»åŠ ä¸Šè¿°å¾—åˆ°çš„ &lt;code>ENV_ID&lt;/code>ï¼Œ&lt;code>SECRET_ID&lt;/code>ï¼Œ&lt;code>SECRET_KEY&lt;/code>ï¼ˆåç§°å¯ä»¥è‡ªå®šä¹‰ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-cloudbase/secret.png"
width="1616"
height="366"
srcset="https://www.letout.cn/p/hugo-in-cloudbase/secret_hu55ad514f0e88b8a75da2092c1dc5a21a_68162_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-cloudbase/secret_hu55ad514f0e88b8a75da2092c1dc5a21a_68162_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="secret"
class="gallery-image"
data-flex-grow="441"
data-flex-basis="1059px"
>&lt;/p>
&lt;h4 id="æ·»åŠ -workflows">æ·»åŠ  workflows&lt;/h4>
&lt;p>å¯ä»¥åœ¨ä»“åº“çš„ &lt;code>Actions&lt;/code> ä¸­ &lt;code>new workflow&lt;/code>ï¼Œæˆ–è€…åœ¨é¡¹ç›®ä¸­ &lt;code>.github/workflows&lt;/code> æ·»åŠ ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Tencent CloudBase&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">push&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">branches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-publish&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">publish content to static website&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Checkout&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/checkout@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">submodules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-depth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Setup Hugo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-hugo@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">extended&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Build&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hugo --minify --gc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># ä½¿ç”¨äº‘å¼€å‘ Github Action éƒ¨ç½²&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy to Tencent CloudBase&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TencentCloudBase/cloudbase-action@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">secretId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_SECRET_ID }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">secretKey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_SECRET_KEY }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">envId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_ENV_ID }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ðŸš§ æç¤ºï¼š&lt;/p>
&lt;p>è¿™é‡Œä½¿ç”¨äº† &lt;code>TencentCloudBase/cloudbase-action@v2&lt;/code>ï¼Œéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ  &lt;code>cloudbaserc.json&lt;/code>ã€‚&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;envId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;{{env.ENV_ID}}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// è¿™é‡Œéœ€è¦æ›´æ”¹ä¸ºä½ çš„ çŽ¯å¢ƒIDï¼Œæˆ–è€…åœ¨ .env æ–‡ä»¶ä¸­é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nt">&amp;#34;$schema&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://framework-1258016615.tcloudbaseapp.com/schema/latest.json&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;framework&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;hugo-blog&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;plugins&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;client&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;use&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;@cloudbase/framework-plugin-website&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;inputs&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outputPath&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;public&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ignore&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;.git&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;.github&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;cloudbaserc.js&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ðŸš§ æç¤ºï¼š&lt;/p>
&lt;p>è¿™é‡Œä¹Ÿå¯ä»¥é€‰æ‹© &lt;code> Tencent CloudBase Github Action V1&lt;/code>ã€‚ðŸ™‹â€â™‚ï¸ &lt;strong>ï¼ˆæŽ¨èï¼‰&lt;/strong>&lt;/p>
&lt;p>V2 æ¯” V1 æœ‰æ›´å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚æ‹‰å–ä»£ç åœ¨è…¾è®¯äº‘ç«¯ç¼–è¯‘ï¼Œä½†ç›®å‰æ²¡æœ‰ Hugo æ¨¡æ¿ã€‚æˆ‘ä»¬å·²ç»åœ¨ Github Actions äº§å‡ºäº†é™æ€æ–‡ä»¶ï¼Œç›´æŽ¥æŽ¨é€å³å¯ã€‚æ‰€ä»¥ç›®å‰å¯¹äºŽ hugo æ¥è¯´ï¼Œæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½¿ç”¨ç”šè‡³ V1 æ›´å¿«æ›´ç®€æ´ã€‚&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># å°†ä¸Šè¿° jobs å†…æ›¿æ¢ä¸º&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy to Tencent CloudBase&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TencentCloudBase/cloudbase-action@v1.1.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">secretId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_SECRET_ID }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">secretKey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_SECRET_KEY }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">envId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_ENV_ID }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">staticSrcPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">public&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-ä½¿ç”¨-webify">ðŸ ä½¿ç”¨ webify&lt;/h2>
&lt;p>ä½¿ç”¨ Web åº”ç”¨æ‰˜ç®¡ï¼ˆwebifyï¼‰ä¸»è¦æ˜¯åˆ©ç”¨ &lt;code>Github Actions&lt;/code> ç”Ÿæˆ é™æ€é¡µé¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œå†æ‰˜ç®¡è¿™ä¸ªåˆ†æ”¯çš„å†…å®¹ã€‚&lt;/p>
&lt;h3 id="-åˆ›å»ºæœåŠ¡">â˜ï¸ åˆ›å»ºæœåŠ¡&lt;/h3>
&lt;p>åœ¨ &lt;code>Web åº”ç”¨æ‰˜ç®¡ -&amp;gt; æ–°å»ºåº”ç”¨&lt;/code> æ–°å»ºä¸€ä¸ªç®€æ˜“é™æ€é¡µé¢æ¨¡æ¿ã€‚æ ¹æ®éœ€æ±‚å¡«å†™ä¿¡æ¯ã€‚é€‰æ‹©çº¯é™æ€é¡µé¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-cloudbase/webify.png"
width="2530"
height="1256"
srcset="https://www.letout.cn/p/hugo-in-cloudbase/webify_hu211af589e3a728aa0fd91d8fdf6a5a77_643488_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-cloudbase/webify_hu211af589e3a728aa0fd91d8fdf6a5a77_643488_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="webify"
class="gallery-image"
data-flex-grow="201"
data-flex-basis="483px"
>&lt;/p>
&lt;p>åœ¨ &lt;code>åº”ç”¨åˆ—è¡¨ -&amp;gt; åº”ç”¨è®¾ç½®&lt;/code> ä¸­é…ç½®ä»“åº“ä¿¡æ¯ï¼Œå¹¶æ ¹æ®è‡ªèº«æƒ…å†µé€‰æ‹©é™æ€æ–‡ä»¶çš„éƒ¨ç½²åˆ†æ”¯ã€‚ï¼ˆå¦‚æžœå½“å‰æ²¡æœ‰ç”Ÿæˆé™æ€é¡µé¢çš„åˆ†æ”¯ï¼Œå¯å®ŒæˆåŽé¢æ“ä½œåŽå†è¿›è¡Œæ­¤æ­¥éª¤ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-cloudbase/webify_info.png"
width="1896"
height="1164"
srcset="https://www.letout.cn/p/hugo-in-cloudbase/webify_info_hufa1571ab4508131ee643c8a2551cf3ff_136359_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-cloudbase/webify_info_hufa1571ab4508131ee643c8a2551cf3ff_136359_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="webify_info"
class="gallery-image"
data-flex-grow="162"
data-flex-basis="390px"
>&lt;/p>
&lt;h3 id="-github-actions-1">âš™ï¸ Github Actions&lt;/h3>
&lt;h4 id="è®¾ç½®-github-token">è®¾ç½® Github Token&lt;/h4>
&lt;p>åœ¨ç”¨æˆ·çš„ &lt;code>Settings -&amp;gt; Developer settings -&amp;gt; Personal access tokens -&amp;gt; Generate new token&lt;/code> èŽ·å–ä¸€ä¸ª &lt;code>Repo Token&lt;/code>ã€‚&lt;a class="link" href="https://github.com/settings/tokens" target="_blank" rel="noopener"
>ðŸ”— ä¼ é€é—¨&lt;/a>&lt;/p>
&lt;p>åœ¨é¡¹ç›®çš„ &lt;code>Settings -&amp;gt; Secrets -&amp;gt; Actions&lt;/code> ä¸­æ·»åŠ ä¸Šè¿°å¾—åˆ°çš„ &lt;code>Token&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/hugo-in-cloudbase/access_token.png"
width="1600"
height="598"
srcset="https://www.letout.cn/p/hugo-in-cloudbase/access_token_hu161bb7d01a4edfa7f2231ebb5df9a1e4_123158_480x0_resize_box_3.png 480w, https://www.letout.cn/p/hugo-in-cloudbase/access_token_hu161bb7d01a4edfa7f2231ebb5df9a1e4_123158_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="access_token"
class="gallery-image"
data-flex-grow="267"
data-flex-basis="642px"
>&lt;/p>
&lt;h4 id="æ·»åŠ -workflows-1">æ·»åŠ  workflows&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Tencent CloudBase&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">push&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">branches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-publish&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">publish content to static website&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Checkout&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/checkout@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">submodules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-depth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Setup Hugo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-hugo@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">extended&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Build&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hugo --minify --gc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy to Branch&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-gh-pages@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">github_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.ACCESS_TOKEN }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">keep_files&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">publish_branch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">gh-pages &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æ›´æ”¹ä¸ºä½ æƒ³è¦ç”Ÿæˆçš„åˆ†æ”¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">publich_dir&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">./public&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">commit_message&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ github.event.head_commit.message }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-å‚è€ƒ">â›“ å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>ðŸ”— &lt;a class="link" href="https://blog.wangjunfeng.com/post/hugo-cloudbase/" target="_blank" rel="noopener"
>https://blog.wangjunfeng.com/post/hugo-cloudbase/&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://cloud.tencent.com/document/product/1210/43389" target="_blank" rel="noopener"
>https://cloud.tencent.com/document/product/1210/43389&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://github.com/TencentCloudBase/cloudbase-action" target="_blank" rel="noopener"
>https://github.com/TencentCloudBase/cloudbase-action&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://github.com/TencentCloudBase/cloudbase-action/blob/3354b442713265aa9d7c5bf03b0b8cb0173f546f/README.md" target="_blank" rel="noopener"
>https://github.com/TencentCloudBase/cloudbase-action/blob/3354b442713265aa9d7c5bf03b0b8cb0173f546f/README.md&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>åœ¨ Ubuntu ä¼˜é›…åœ°å®‰è£… zip åº”ç”¨ ðŸ¤”</title><link>https://www.letout.cn/p/ubuntu-software-install/</link><pubDate>Mon, 02 May 2022 02:02:02 +0800</pubDate><guid>https://www.letout.cn/p/ubuntu-software-install/</guid><description>&lt;img src="https://www.letout.cn/imgs/4.jpeg" alt="Featured image of post åœ¨ Ubuntu ä¼˜é›…åœ°å®‰è£… zip åº”ç”¨ ðŸ¤”" />&lt;h2 id="è¯´æ˜Ž">è¯´æ˜Ž&lt;/h2>
&lt;p>Ubuntu æœ‰äº›ç¬¬ä¸‰æ–¹è½¯ä»¶åªæä¾›äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ï¼ˆåŽ‹ç¼©åŒ…æˆ– AppImageï¼‰ï¼Œè€Œä¸æ˜¯å®‰è£…åŒ…æˆ–è€… apt æºï¼Œè¿™æ—¶å€™éœ€è¦æˆ‘ä»¬åŽ»è‡ªå·±è§£åŽ‹æ–‡ä»¶ï¼Œæ”¾åœ¨è‡ªå®šä¹‰ç›®å½•ï¼Œå¹¶è¿›è¡Œé…ç½®ã€‚&lt;/p>
&lt;p>å¹³å¸¸ä½¿ç”¨æ¡Œé¢çŽ¯å¢ƒçš„è¯ï¼Œè¿™æ ·å®‰è£…åŽï¼Œæ›´æ–°è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦çš„ï¼Œä¸€æ›´æ–°å°±è¦ä¿®æ”¹å¾ˆå¤šåœ°æ–¹ã€‚&lt;/p>
&lt;p>è¿™é‡Œä»‹ç»æˆ‘å¹³å¸¸çš„é…ç½®æ–¹å¼ï¼Œæ¯æ¬¡æ›´æ–°åŽï¼Œåªéœ€è¦ä¿®æ”¹è½¯é“¾æŽ¥å³å¯ï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºæ–¹ä¾¿çš„ã€‚&lt;/p>
&lt;h2 id="æ–¹å¼">æ–¹å¼&lt;/h2>
&lt;p>ä»¥ &lt;a class="link" href="https://github.com/Fndroid/clash_for_windows_pkg/releases" target="_blank" rel="noopener"
>cfw&lt;/a> å®‰è£…ä¸ºä¾‹ï¼ŒLinux æä¾› &lt;code>.tar.gz&lt;/code> çš„æ‰§è¡Œæ–‡ä»¶ã€‚&lt;/p>
&lt;p>æˆ‘é€šå¸¸éƒ½æŠŠè¿™æ ·çš„è½¯ä»¶éƒ½ç»Ÿä¸€æ”¾åˆ° &lt;code>~/Applications&lt;/code> ä¸­ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸ•ï¸ é¦–å…ˆåˆ›å»ºä¸€ä¸ªå®‰è£…çš„è½¯ä»¶çš„æ–‡ä»¶å¤¹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mkdir -p ~/Application/clash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸžï¸ å°†ä¸‹è½½çš„æ–‡ä»¶è§£åŽ‹åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">tar -xzvf Clash.for.Windows-0.19.12 -C ~/Application/clash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸœï¸ åˆ›å»ºå¯åŠ¨æ–‡ä»¶çš„è½¯è¿žæŽ¥&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">ln -s ./Clash&lt;span class="se">\ &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="se">\ &lt;/span>Windows-0.19.12-x64-linux/cfw ./clash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¯æ¬¡å¯åŠ¨åº”ç”¨éƒ½ä½¿ç”¨è¿™ä¸ªè½¯é“¾æŽ¥è¿›è¡Œæ“ä½œï¼Œå½“éœ€è¦å‡çº§åº”ç”¨æ—¶ï¼Œåªéœ€è¦åˆ›å»ºæ–°çš„è½¯é“¾æŽ¥ï¼ŒæŒ‡å‘æ–°çš„å¯åŠ¨æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä¸éœ€è¦æ¯æ¬¡å‡çº§ç‰ˆæœ¬ï¼Œéƒ½æ”¹å…¶ä»–åœ°æ–¹ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡æ–‡ä»¶å¤¹å‘½åå¾ˆæ¸…æ¥šåœ°çŸ¥é“å½“å‰ä½¿ç”¨åœ°ç‰ˆæœ¬å·ã€‚ðŸ‘&lt;/p>
&lt;p>æœ€åŽçš„æ•ˆæžœå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ tree . -L 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ clash -&amp;gt; ./Clash for Windows-0.19.12-x64-linux/cfw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ Clash for Windows-0.19.12-x64-linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â””â”€â”€ Clash for Windows-0.19.2-x64-linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ–ï¸ æ·»åŠ æ¡Œé¢å›¾æ ‡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">vim ~/.local/share/applications/clw.desktop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[Desktop Entry]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name=Clash for Linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Icon=/home/emery/Applications/icon/clash_icon.png # æ›¿æ¢ä¸ºè‡ªå·±çš„ç›®å½•
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Comment=Clash for Linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Exec=&amp;#34;/home/emery/Applications/Clash/clash&amp;#34; %u # æ›¿æ¢ä¸ºè‡ªå·±çš„ç›®å½•
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type=Application
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Categories=Network
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Terminal=false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">StartupNotify=true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>åœ¨ Ubuntu ä¸­æ­å»º CUDA çŽ¯å¢ƒ</title><link>https://www.letout.cn/p/cuda/</link><pubDate>Mon, 02 May 2022 02:02:02 +0800</pubDate><guid>https://www.letout.cn/p/cuda/</guid><description>&lt;img src="https://www.letout.cn/imgs/11.jpeg" alt="Featured image of post åœ¨ Ubuntu ä¸­æ­å»º CUDA çŽ¯å¢ƒ" />&lt;h2 id="nvdia-é©±åŠ¨">Nvdia é©±åŠ¨&lt;/h2>
&lt;p>é¦–å…ˆï¼Œè¯·ç¡®ä¿åœ¨ç³»ç»Ÿä¸­å®‰è£…äº†è‹±ä¼Ÿè¾¾æ˜¾å¡é©±åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>nvidia-msi&lt;/code> å‘½ä»¤æŸ¥çœ‹æ˜¾å¡å¯¹åº”ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å¦‚æžœæ²¡æœ‰å®‰è£…é©±åŠ¨ï¼Œå¯ä»¥å‚è€ƒè¯¥ç« èŠ‚ã€‚&lt;a class="link" href="https://www.letout.cn/guide/prepare/driver.html" >ä¼ é€é—¨âž¡ï¸&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/cuda/nvidia-msi.png"
width="734"
height="512"
srcset="https://www.letout.cn/p/cuda/nvidia-msi_hu25fedbd9e105d28334236f2eb0bd81d5_56804_480x0_resize_box_3.png 480w, https://www.letout.cn/p/cuda/nvidia-msi_hu25fedbd9e105d28334236f2eb0bd81d5_56804_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="nvidia-msi"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="344px"
>&lt;/p>
&lt;p>æŽ¨èä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦è½¯ä»¶ &lt;code>è½¯ä»¶å’Œæ›´æ–°&lt;/code> å®‰è£…æ˜¾å¡é©±åŠ¨ã€‚æ‰“å¼€åº”ç”¨åŽï¼Œç‚¹å‡» &lt;code>é™„åŠ é©±åŠ¨&lt;/code> é€‰é¡¹ï¼Œä¼šå¯¹æ‰€æœ‰å¯é€‰çš„é™„åŠ é©±åŠ¨è¿›è¡Œæœç´¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/cuda/nvidia-install.png"
width="877"
height="500"
srcset="https://www.letout.cn/p/cuda/nvidia-install_hud8377b5c2eaf750be9838eb34291d82b_111878_480x0_resize_box_3.png 480w, https://www.letout.cn/p/cuda/nvidia-install_hud8377b5c2eaf750be9838eb34291d82b_111878_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="nvidia-install"
class="gallery-image"
data-flex-grow="175"
data-flex-basis="420px"
>&lt;/p>
&lt;p>å…¶ä¸­ï¼Œ&lt;code>Nouveau&lt;/code> ä¸ºè‹±ä¼Ÿè¾¾æ˜¾å¡å¼€æºé©±åŠ¨ï¼ˆé»˜è®¤å®‰è£…ï¼‰ï¼Œé€‰æ‹©éœ€è¦çš„ &lt;code>NVIDIA drive&lt;/code> é©±åŠ¨é€‰é¡¹ï¼Œç‚¹å‡» &lt;code>åº”ç”¨æ›´æ”¹&lt;/code>ã€‚&lt;/p>
&lt;p>ç­‰å¾…è¿›åº¦æ¡ç»“æŸåŽï¼Œé‡å¯ç”µè„‘ï¼Œå³å®Œæˆäº†æ˜¾å¡é©±åŠ¨çš„å®‰è£…ã€‚&lt;/p>
&lt;h2 id="cuda">CUDA&lt;/h2>
&lt;p>ä½ å¯ä»¥åœ¨ &lt;a class="link" href="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a> çœ‹åˆ°æ˜¾å¡é©±åŠ¨ç‰ˆæœ¬ä¸Ž CUDA ç‰ˆæœ¬çš„å¯¹åº”å…³ç³»ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/cuda/cuda.png"
width="1540"
height="358"
srcset="https://www.letout.cn/p/cuda/cuda_hu06d82653b392e263a912d34e822f7d1a_74559_480x0_resize_box_3.png 480w, https://www.letout.cn/p/cuda/cuda_hu06d82653b392e263a912d34e822f7d1a_74559_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cuda"
class="gallery-image"
data-flex-grow="430"
data-flex-basis="1032px"
>&lt;/p>
&lt;p>ðŸŒ° åœ¨è¿™é‡Œçš„æ˜¾å¡é©±åŠ¨ç‰ˆæœ¬ä¸º &lt;code>470.103.01&lt;/code>ï¼Œæ ¹æ®å¯¹åº”è¡¨å¯çŸ¥ï¼Œæœ€é«˜å¯é€‰çš„ CUDA Toolkit çš„ç‰ˆæœ¬å·ä¸º &lt;code>CUDA 11.4 Update 4&lt;/code>ã€‚&lt;/p>
&lt;p>ä¹‹åŽï¼Œå¯åœ¨å®˜ç½‘ &lt;a class="link" href="https://developer.nvidia.com/cuda-toolkit-archive" target="_blank" rel="noopener"
>è¯¥é¡µé¢&lt;/a> ä¸­ï¼Œé€‰æ‹©å¯¹åº”çš„ CUDA Toolkitã€‚&lt;/p>
&lt;p>å¯æ ¹æ®å½“å‰ç³»ç»ŸçŽ¯å¢ƒï¼Œé€‰æ‹©å¯¹åº”çš„ä¸‹è½½é€‰é¡¹ï¼ˆæŽ¨èä¸‹è½½ &lt;code>.drunfile&lt;/code>ï¼Œ&lt;code>.deb&lt;/code> ä¼šè¦†ç›–ç³»ç»Ÿå®‰è£…çš„æ˜¾å¡é©±åŠ¨ï¼‰ï¼š&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/cuda/cuda-platform.png"
width="2506"
height="894"
srcset="https://www.letout.cn/p/cuda/cuda-platform_hu9bf542e30b48a580f041a55f80ab65bc_245327_480x0_resize_box_3.png 480w, https://www.letout.cn/p/cuda/cuda-platform_hu9bf542e30b48a580f041a55f80ab65bc_245327_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cuda-platform"
class="gallery-image"
data-flex-grow="280"
data-flex-basis="672px"
>&lt;/p>
&lt;p>ä¸‹è½½å®ŒæˆåŽï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">DOWNLOAD_DIR&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x ./cuda_&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>_linux.run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh ./cuda_&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>_linux.run
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>::: warning è­¦å‘Š ðŸš§
æ³¨æ„ï¼šåœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œè¯·å–æ¶ˆå‹¾é€‰å®‰è£…é©±åŠ¨é€‰é¡¹ã€‚
:::&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/cuda/cuda-install.png"
width="734"
height="476"
srcset="https://www.letout.cn/p/cuda/cuda-install_hu423287ac940ffb3bc75497440c5c47d7_30663_480x0_resize_box_3.png 480w, https://www.letout.cn/p/cuda/cuda-install_hu423287ac940ffb3bc75497440c5c47d7_30663_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cuda-install"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="370px"
>&lt;/p>
&lt;p>é…ç½®çŽ¯å¢ƒå˜é‡ï¼Œåœ¨å¯¹åº”é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># bash -&amp;gt; .bashrc / zsh -&amp;gt; .zshrc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">CUDA_HOME&lt;/span>&lt;span class="o">=&lt;/span>/usr/local/cuda-&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">CUDA_HOME&lt;/span>&lt;span class="si">}&lt;/span>/bin:&lt;span class="si">${&lt;/span>&lt;span class="nv">PATH&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="cudnn">cuDNN&lt;/h2>
&lt;p>ä½ å¯ä»¥åœ¨å®˜ç½‘ &lt;a class="link" href="https://developer.nvidia.com/rdp/cudnn-download" target="_blank" rel="noopener"
>æ­¤é“¾æŽ¥&lt;/a> ä¸‹è½½ CUDNNï¼Œéœ€è¦æ³¨å†Œå¼€å‘è€…è´¦å·ï¼Œå¯èƒ½è¿˜éœ€è¦ä¸€ä¸ªâ€œè‰¯å¥½çš„ç½‘ç»œçŽ¯å¢ƒâ€ã€‚&lt;/p>
&lt;p>é€‰æ‹©ä¸Ž CUDA ç›¸å¯¹åº”ç”¨çš„ cuDNNï¼ŒæŽ¨èä¸‹è½½åŽ‹ç¼©åŒ…æ ¼å¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/cuda/cudnn.png"
width="2228"
height="1498"
srcset="https://www.letout.cn/p/cuda/cudnn_hu2d2e598f2ebb22e3f94073a6174ea5e2_332327_480x0_resize_box_3.png 480w, https://www.letout.cn/p/cuda/cudnn_hu2d2e598f2ebb22e3f94073a6174ea5e2_332327_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cudnn"
class="gallery-image"
data-flex-grow="148"
data-flex-basis="356px"
>&lt;/p>
&lt;p>ä¸‹è½½å®ŒæˆåŽï¼Œè§£åŽ‹æ–‡ä»¶å¤¹ï¼Œå¹¶æ ¹æ®ä»¥ä¸‹å‘½ä»¤å¤åˆ¶è§£åŽ‹åŽæ–‡ä»¶å¤¹ä¸­çš„ &lt;code>lib64&lt;/code> &lt;code>include&lt;/code> æ–‡ä»¶å¤¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">tar -xzvf cudnn-linux-&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp cudnn-linux-&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>/lib64/* /usr/local/cuda/lib64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp cudnn-linux-&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>/include/* /usr/local/cuda/include
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¤åˆ¶å®ŒæˆåŽï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ cuDNN ç‰ˆæœ¬ä¿¡æ¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">cat /usr/local/cuda-10.1/include/cudnn.h &lt;span class="p">|&lt;/span> grep CUDNN_MAJOR -A &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - å¹¶å‘å®‰å…¨çš„å®¹å™¨</title><link>https://www.letout.cn/p/thread/collection/</link><pubDate>Fri, 29 Apr 2022 14:02:02 +0800</pubDate><guid>https://www.letout.cn/p/thread/collection/</guid><description>&lt;img src="https://www.letout.cn/imgs/16.jpeg" alt="Featured image of post Java å¹¶å‘ - å¹¶å‘å®‰å…¨çš„å®¹å™¨" />&lt;h2 id="-é—ç•™çš„å®‰å…¨é›†åˆ">ðŸš§ é—ç•™çš„å®‰å…¨é›†åˆ&lt;/h2>
&lt;p>å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>Hashtable&lt;/li>
&lt;li>Vector&lt;/li>
&lt;/ul>
&lt;p>è¿™äº›é›†åˆçš„å®žçŽ°æ–¹å¼ç®€å•ç²—æš´ï¼Œåœ¨æ–¹æ³•ä¸Šç›´æŽ¥ä½¿ç”¨ &lt;code>synchronized&lt;/code> è¿›è¡Œä¿®é¥°ï¼Œåœ¨è¿›è¡Œè¯»å†™ç­‰æ“ä½œæ—¶ï¼Œä¼šé”ä½æ•´ä¸ªå¯¹è±¡ï¼Œå¹¶å‘æ€§èƒ½ä¸å¤ªå¥½ã€‚&lt;/p>
&lt;h2 id="-collections-å®‰å…¨é›†åˆ">ðŸ“¦ Collections å®‰å…¨é›†åˆ&lt;/h2>
&lt;p>å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>Collections.synchronizedCollection(Collection&lt;!-- raw HTML omitted --> c)&lt;/li>
&lt;li>Collections.synchronizedList(List&lt;!-- raw HTML omitted --> list)&lt;/li>
&lt;li>Collections.synchronizedMap(Map&amp;lt;K,V&amp;gt; m)&lt;/li>
&lt;li>Collections.synchronizedSet(Set&lt;!-- raw HTML omitted --> s)&lt;/li>
&lt;li>&amp;hellip;&lt;/li>
&lt;/ul>
&lt;p>ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªçº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆï¼Œè¿”å›žä¸€ä¸ª Collections å†…éƒ¨çš„é™æ€ç±»å¯¹è±¡ï¼Œç”¨äºŽå°†ä¸€ä¸ªä¸å®‰å…¨çš„é›†åˆå˜æˆä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é›†åˆã€‚&lt;/p>
&lt;p>è¯¥æ–¹æ³•ä¼šå°†ä¼ å…¥çš„é›†åˆä½œä¸ºæˆå‘˜å˜é‡ï¼Œæ¯æ¬¡æ“ä½œæ—¶ï¼Œéƒ½ä½¿ç”¨ &lt;code>synchronized&lt;/code> åŠ é”ï¼Œé”ä½ &lt;code>mutex&lt;/code>ï¼ˆMap ä¸­ä¸ºå½“å‰å¯¹è±¡ thisï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">SynchronizedMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;,&lt;/span> &lt;span class="n">Serializable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">serialVersionUID&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1978198479659022715L&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// Backing Map
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">mutex&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// Object on which to synchronize
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SynchronizedMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Objects&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">requireNonNull&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mutex&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SynchronizedMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">mutex&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">mutex&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">mutex&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">size&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">mutex&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>&lt;span class="k">return&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="o">();}&lt;/span> &lt;span class="c1">// æ“ä½œéƒ½ä¼šé”ä½ mutex
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ... å…¶ä»–æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-juc-å®‰å…¨é›†åˆ">ðŸ›  JUC å®‰å…¨é›†åˆ&lt;/h2>
&lt;p>&lt;code>java.util.concurrent&lt;/code> ä¸‹æä¾›çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š&lt;/p>
&lt;ul>
&lt;li>Concurrent ç³»åˆ—ï¼ˆé€‚åˆå†™å¤šçš„åœºæ™¯ï¼Œå†…éƒ¨ä½¿ç”¨ CAS ä¼˜åŒ–ï¼‰&lt;/li>
&lt;li>CopyOnWrite ç³»åˆ—ï¼ˆé€‚åˆäºŽè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼‰&lt;/li>
&lt;li>Blocking ç³»åˆ—ï¼ˆé˜»å¡žé˜Ÿåˆ—ï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="-concurrent">âœ Concurrent&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>ConcurrentHashMap&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>ConcurrentLinkedQueue&lt;/code> / &lt;code>ConcurrentLinkedDeque&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>ConcurrentSkipListMap&lt;/code> / &lt;code>ConcurrentSkipListSet&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-copyonwrite">ðŸ“– CopyOnWrite&lt;/h3>
&lt;ul>
&lt;li>&lt;code>CopyOnWriteArrayList&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>é‡‡ç”¨äº†å†™å…¥æ—¶æ‹·è´çš„æ€æƒ³ï¼Œæ›´æ”¹æ“ä½œä¼šå°†åº•å±‚æ•°ç»„æ‹·è´ä¸€ä»½ï¼Œæ›´æ”¹åœ¨æ–°çš„æ•°ç»„ä¸Šæ‰§è¡Œï¼Œå¹¶å‘æ—¶è¯»å†™æ“ä½œè¾¾åˆ°è¯»å†™åˆ†ç¦»ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">elements&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getArray&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">elements&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">newElements&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">copyOf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">elements&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">len&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">newElements&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setArray&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">newElements&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ›¿æ¢æ•°ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¯»æ“ä½œä¸è¿›è¡ŒåŠ é”ã€‚é€‚åˆäºŽè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SuppressWarnings&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;unchecked&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="n">E&lt;/span> &lt;span class="nf">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">E&lt;/span> &lt;span class="nf">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">getArray&lt;/span>&lt;span class="o">(),&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>CopyOnWriteArraySet&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>CopyOnWriteArraySet&lt;/code> å†…éƒ¨ç”± &lt;code>CopyOnWriteArrayList&lt;/code> å®žçŽ°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">CopyOnWriteArraySet&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">AbstractSet&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">implements&lt;/span> &lt;span class="n">java&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Serializable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">CopyOnWriteArraySet&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">al&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CopyOnWriteArrayList&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-blocking">ðŸš§ Blocking&lt;/h3>
&lt;p>æœ‰ç•Œé˜Ÿåˆ—ï¼šæœ‰å›ºå®šå¤§å°çš„é˜Ÿåˆ—ã€‚&lt;/p>
&lt;p>æ— ç•Œé˜Ÿåˆ—ï¼šæ²¡æœ‰å›ºå®šå¤§å°çš„é˜Ÿåˆ—&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>ArrayBlockingQueue&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æœ‰ç•Œå¸¦ç¼“å†²é˜»å¡žé˜Ÿåˆ—ï¼Œæ•°ç»„å®žçŽ°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>LinkedBlockingQueue&lt;/code>&lt;/p>
&lt;ul>
&lt;li>ç”±ç•Œå¸¦ç¼“å†²é˜»å¡žé˜Ÿåˆ— (Integer.MAX_VALUE)ï¼Œé“¾è¡¨å®žçŽ°ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸Šé™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>LinkedBlockingDeque&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åŒç«¯é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>DelayQueue&lt;/code>&lt;/p>
&lt;ul>
&lt;li>å»¶æ—¶æ— ç•Œé˜»å¡žé˜Ÿåˆ—ï¼Œåªå…è®¸å­˜æ”¾å¯ä»¥å»¶æ—¶çš„å…ƒç´ ï¼Œé˜Ÿåˆ— head æ˜¯æœ€å…ˆåˆ°æœŸçš„ï¼Œå¦‚æžœé˜Ÿåˆ—ä¸­å…ƒç´ æ²¡æœ‰åˆ°æœŸï¼Œå°±ç®—é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ ä¹Ÿä¸èƒ½èŽ·å–åˆ°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>SynchronousQueue&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ²¡æœ‰å®¹é‡çš„åŒæ­¥é˜Ÿåˆ—ï¼Œä¸å­˜å‚¨å…ƒç´ ï¼Œæ¯ä¸€ä¸ª put å¿…é¡»è¦ç­‰å¾…ä¸€ä¸ª take æ“ä½œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>PriorityBlockingQueue&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ— ç•Œä¼˜å…ˆé˜»å¡žé˜Ÿåˆ—ï¼ŒPriorityQueue çš„çº¿ç¨‹å®‰å…¨ç‰ˆï¼Œä¸å…è®¸å­˜æ”¾ null&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">BloockingQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Queue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é˜Ÿåˆ—æ»¡æŠ›å‡ºå¼‚å¸¸
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ— å…ƒç´ æŠ›å‡ºå¼‚å¸¸
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">remove&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">o&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// é˜Ÿåˆ—æ»¡è¿”å›ž false æˆåŠŸæ·»åŠ  true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">offer&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é˜Ÿåˆ—ä¸ºç©ºè¿”å›ž null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">E&lt;/span> &lt;span class="nf">poll&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é˜»å¡žæ—¶ç­‰å¾…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜»å¡žè¿›è¡Œç­‰å¾…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">put&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œé˜»å¡žè¿›è¡Œç­‰å¾…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">E&lt;/span> &lt;span class="nf">take&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="linkedblockingqueue">LinkedBlockingQueue&lt;/h4>
&lt;p>åœ¨ &lt;code>LinkedBlockingQeque&lt;/code> ä¸­ä½¿ç”¨äº† dummy èŠ‚ç‚¹å’Œä¸¤æŠŠé”ï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œå¯ä»¥å…è®¸ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰§è¡Œ &lt;code>put&lt;/code> å’Œ &lt;code>take&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">putLock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">takeLock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>put&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">put&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">NullPointerException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">putLock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">putLock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">AtomicInteger&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">putLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lockInterruptibly&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æžœå®¹é‡å·²æ»¡ï¼Œè¿›è¡Œç­‰å¾…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">capacity&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">notFull&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å®¹é‡æœªæ»¡ï¼Œè¿›è¡Œå…¥é˜Ÿ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">enqueue&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAndIncrement&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å…¥é˜ŸåŽé˜Ÿåˆ—è¿˜æœ‰ç©ºä½, å”¤é†’å…¶ä»– put çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">capacity&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">notFull&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">signal&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// åªå”¤é†’ä¸€ä¸ªï¼Œå‡å°‘ç«žäº‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">putLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æžœé˜Ÿåˆ—ä¸­æœ‰ä¸€ä¸ªå…ƒç´ , å”¤é†’ take çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// notEmpty.signal() è€Œä¸æ˜¯ notEmpty.signalAll()ï¼›å‡å°‘ç«žäº‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">signalNotEmpty&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>take&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">E&lt;/span> &lt;span class="nf">take&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">AtomicInteger&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">takeLock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">takeLock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">takeLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lockInterruptibly&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">notEmpty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dequeue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAndDecrement&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">notEmpty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">signal&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">takeLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æžœé˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªç©ºä½æ—¶, å«é†’ put çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å¦‚æžœæœ‰å¤šä¸ªçº¿ç¨‹è¿›è¡Œå‡ºé˜Ÿ, ç¬¬ä¸€ä¸ªçº¿ç¨‹ c == capacity, åŽç»­çº¿ç¨‹ c &amp;lt; capacity
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">capacity&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// notFull.signal() è€Œä¸æ˜¯ notFull.signalAll()ï¼Œå‡å°‘ç«žäº‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">signalNotFull&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - AQS</title><link>https://www.letout.cn/p/thread/aqs/</link><pubDate>Wed, 13 Apr 2022 14:02:02 +0800</pubDate><guid>https://www.letout.cn/p/thread/aqs/</guid><description>&lt;img src="https://www.letout.cn/imgs/6.jpeg" alt="Featured image of post Java å¹¶å‘ - AQS" />&lt;h2 id="aqs">AQS&lt;/h2>
&lt;p>AQS &lt;code>AbstractQueuedSynchronized&lt;/code> æ˜¯ä¸€ä¸ªç”¨æ¥æž„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æž¶ï¼Œæ˜¯å¯¹ CAS çš„ä¸€ç§å°è£…å’Œä¸°å¯Œï¼ŒAQS å¼•å…¥äº†ç‹¬å é”ï¼Œå…±äº«é”ç­‰æ€§è´¨ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ AQS èƒ½å¤ŸåŸºäºŽ Java APIï¼Œç®€å•é«˜æ•ˆåœ°æž„å»ºå‡ºåº”ç”¨å¹¿æ³›çš„å¤§é‡åŒæ­¥å™¨ï¼Œç”¨äºŽ Java å¤šçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚&lt;/p>
&lt;h2 id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³&lt;/h2>
&lt;p>AQS ä½¿ç”¨ä¸€ä¸ª &lt;code>volatile int state&lt;/code> æˆå‘˜å˜é‡è¡¨ç¤ºåŒæ­¥çŠ¶æ€ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ CAS &lt;code>compareAndSetState&lt;/code> å¯¹è¯¥åŒæ­¥çŠ¶æ€è¿›è¡ŒåŽŸå­æ“ä½œï¼Œå®žçŽ°å¯¹å…¶å€¼çš„ä¿®æ”¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å…±äº«å˜é‡ï¼Œä½¿ç”¨ volatile ä¿éšœå¯è§æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">private&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>AQS é€šè¿‡å†…ç½®çš„ &lt;code>FIFO&lt;/code> åŒå‘é˜Ÿåˆ—æ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†ï¼ŒèŽ·å–èµ„æºçº¿ç¨‹çš„æŽ’é˜Ÿå·¥ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">transient&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="n">Node&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">transient&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="n">Node&lt;/span> &lt;span class="n">tail&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²æ—¶ï¼Œå°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚&lt;/p>
&lt;p>å¦‚æžœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œå°†æš‚æ—¶èŽ·å–ä¸åˆ°é”çš„çº¿ç¨‹æž„é€ æˆä¸€ä¸ª Node åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚&lt;/p>
&lt;h2 id="èµ„æºçš„å…±äº«æ–¹å¼">èµ„æºçš„å…±äº«æ–¹å¼&lt;/h2>
&lt;h3 id="ç‹¬å ">ç‹¬å &lt;/h3>
&lt;p>å½“ä¸€ä¸ªçº¿ç¨‹ä»¥ç‹¬å æ¨¡å¼èŽ·å–é”æ—¶ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ã€‚&lt;/p>
&lt;ul>
&lt;li>ReentrantLock&lt;/li>
&lt;/ul>
&lt;h3 id="å…±äº«">å…±äº«&lt;/h3>
&lt;p>å½“ä¸€ä¸ªçº¿ç¨‹ä»¥å…±äº«æ¨¡å¼èŽ·å–é”æ—¶ï¼Œå…¶ä»–ä¹Ÿæƒ³ä»¥å…±äº«æ¨¡å¼èŽ·å–é”çš„çº¿ç¨‹ä¹Ÿèƒ½å¤Ÿä¸€èµ·è®¿é—®å…±äº«èµ„æºï¼Œä½†å…¶ä»–æƒ³ä»¥ç‹¬å æ¨¡å¼èŽ·å–é”çš„çº¿ç¨‹éœ€è¦ç­‰å¾…ã€‚&lt;/p>
&lt;ul>
&lt;li>CountDownLatch&lt;/li>
&lt;li>CyclicBarrier&lt;/li>
&lt;li>Semaphore&lt;/li>
&lt;/ul>
&lt;h2 id="å®žçŽ°">å®žçŽ°&lt;/h2>
&lt;h3 id="countdownlatch">CountDownLatch&lt;/h3>
&lt;p>&lt;code>CountDownLatch&lt;/code> åŒæ­¥å·¥å…·å…è®¸ä¸€æ¡æˆ–å¤šæ¡çº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹ä¸­çš„ä¸€ç»„æ“ä½œå®ŒæˆåŽï¼Œå†ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;p>&lt;code>CountDownLatch&lt;/code> ä»»åŠ¡åˆ†ä¸º &lt;code>n&lt;/code> ä¸ªå­çº¿ç¨‹æ‰§è¡Œï¼Œ&lt;code>state&lt;/code> å°†è¢«åˆå§‹åŒ–ä¸º &lt;code>n&lt;/code>ï¼Œè¿™ &lt;code>n&lt;/code> ä¸ªçº¿ç¨‹å°†ä¼šå¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒåŽè°ƒç”¨ &lt;code>countDown()&lt;/code> æ–¹æ³•ï¼Œ&lt;code>state&lt;/code> ä¼šé€šè¿‡ &lt;code>CAS - 1&lt;/code>ã€‚å½“æ‰€æœ‰çš„å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œä¹‹åŽï¼Œ&lt;code>state=0&lt;/code>ï¼Œä¼š unpack ä¸»çº¿ç¨‹ï¼Œç»§ç»­åŽç»­åŠ¨ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">SearchTask&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">CountDownLatch&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">SearchTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">CountDownLatch&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">latch&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// **å­çº¿ç¨‹**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å„è‡ªå¯»æ‰¾ç›¸åº”ç›®æ ‡çš„é¾™ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ðŸƒâ€â™‚ï¸ å¼€å§‹å¯»æ‰¾&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å·é¾™ç &amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ThreadLocalRandom&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">current&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">seconds&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ðŸ‘ èŠ±äº†&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;ç§’ï¼Œæ‰¾åˆ°äº†&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å·é¾™ç &amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¯å½“ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œå°±è°ƒç”¨ä¸€æ¬¡ countDown() æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">countDown&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// **ä¸»çº¿ç¨‹**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ç­‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åŽï¼Œæ‰¾åˆ°æ‰€æœ‰é¾™ç ï¼Œå¬å”¤ç¥žé¾™
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">idList&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// state åˆå§‹åŒ–ä¸ºä»»åŠ¡çš„ä¸ªæ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">CountDownLatch&lt;/span> &lt;span class="n">latch&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CountDownLatch&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">idList&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">idList&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span> &lt;span class="n">thread&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">SearchTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">latch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;æ‰¾åˆ°æ‰€æœ‰é¾™ç äº†ï¼å¬å”¤ç¥žé¾™ ðŸ²&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/thread/aqs/countdownlatch.png"
width="605"
height="416"
srcset="https://www.letout.cn/p/thread/aqs/countdownlatch_hu76805997e75031fb962291546eee5c35_69221_480x0_resize_box_3.png 480w, https://www.letout.cn/p/thread/aqs/countdownlatch_hu76805997e75031fb962291546eee5c35_69221_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="countdownlatch"
class="gallery-image"
data-flex-grow="145"
data-flex-basis="349px"
>&lt;/p>
&lt;p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»»åŠ¡åˆ†ä¸º 7 ä¸ªå­çº¿ç¨‹æ‰§è¡Œï¼Œå°† &lt;code>CountDownLatch&lt;/code> çš„å€¼åˆå§‹åŒ–ä¸ºä¸Žçº¿ç¨‹ç›¸åŒçš„æ¬¡æ•°ã€‚ä¸»çº¿ç¨‹é€šè¿‡ &lt;code>await()&lt;/code> ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆã€‚&lt;/p>
&lt;p>è¿™å‡ ä¸ªå­ä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒæˆåŽ &lt;code>countDown()&lt;/code> ä¸€æ¬¡ï¼Œ&lt;code>state&lt;/code> ä¼šé€šè¿‡ CAS æ“ä½œ &lt;code>-1&lt;/code>ã€‚&lt;/p>
&lt;p>ç›´åˆ°æ‰€æœ‰çš„å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åŽï¼Œ&lt;code>state=0&lt;/code>ï¼Œä¸»çº¿ç¨‹ä¼šç»“æŸç­‰å¾…ï¼Œç»§ç»­æ‰§è¡ŒåŽç»­ä»»åŠ¡ã€‚&lt;/p>
&lt;h3 id="cyclicbarrier">CyclicBarrier&lt;/h3>
&lt;p>&lt;code>CyclicBarrier&lt;/code> ç”¨äºŽå¤šä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…å¯¹æ–¹æ‰§è¡Œåˆ°æŸä¸ªçŠ¶æ€åŽï¼Œè¿™äº›çº¿ç¨‹å†ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/thread/aqs/cyclicbarrier.jpg"
width="890"
height="282"
srcset="https://www.letout.cn/p/thread/aqs/cyclicbarrier_hu4bbc637d91d993b0f3842d2bee476984_33199_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/thread/aqs/cyclicbarrier_hu4bbc637d91d993b0f3842d2bee476984_33199_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="cyclicbarrier"
class="gallery-image"
data-flex-grow="315"
data-flex-basis="757px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// CyclicBarrier å¯ä»¥è®¾ç½®å­çº¿ç¨‹å…¨éƒ¨åˆ°è¾¾ barrierï¼Œæ‰§è¡Œçš„ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">CyclicBarrier&lt;/span> &lt;span class="n">barrier&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CyclicBarrier&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ðŸ‘Œ äººå‘˜åˆ°é½ï¼å‡†å¤‡çˆ¬å±±ï¼&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å­çº¿ç¨‹ï¼Œæ¨¡æ‹Ÿ 5 ä¸ªåŒå­¦ç›¸çº¦çˆ¬å±±
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;åŒå­¦&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ðŸ‘‹ &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å‡†å¤‡å‡ºå‘åŽ»é›†åˆç‚¹äº†ã€‚&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ThreadLocalRandom&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">current&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ðŸ¦¶ &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;èŠ±äº† &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; ç§’åˆ°è¾¾é›†åˆç‚¹ã€‚&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ç­‰å¾…æ‰€æœ‰çš„åŒå­¦ï¼ˆå­çº¿ç¨‹ï¼‰è¿è¡Œåˆ°æ­¤å¤„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">barrier&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// å½“ await çš„çº¿ç¨‹è¶³å¤Ÿï¼Œå†ç»§ç»­æ‰§è¡Œçº¿ç¨‹åŽç»­ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">BrokenBarrierException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å’Œå¤§å®¶ä¸€èµ·çˆ¬å±±äº†ã€‚â›°&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">},&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;åŒå­¦&amp;#34;&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/thread/aqs/cyclicbarrier-result.png"
width="576"
height="450"
srcset="https://www.letout.cn/p/thread/aqs/cyclicbarrier-result_huabd0a32719e9e0c5e0894dc282a3eb45_80712_480x0_resize_box_3.png 480w, https://www.letout.cn/p/thread/aqs/cyclicbarrier-result_huabd0a32719e9e0c5e0894dc282a3eb45_80712_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cyclicbarrier result"
class="gallery-image"
data-flex-grow="128"
data-flex-basis="307px"
>&lt;/p>
&lt;p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰ 5 ä¸ªå­çº¿ç¨‹åˆ†åˆ«å¼€å§‹æ‰§è¡Œï¼ˆ5 ä¸ªåŒå­¦ä»Žå®¶é‡Œå‡ºå‘ï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ°è¾¾æŸä¸ªçŠ¶æ€åŽ &lt;code>await()&lt;/code> è¿›è¡Œç­‰å¾…ï¼ˆæ¯ä¸ªåŒå­¦åˆ°è¾¾é›†åˆç‚¹ä¼šç­‰å¾…å…¶ä»–åŒå­¦åˆ°è¾¾ï¼‰ï¼Œå½“çº¿ç¨‹å…¨éƒ¨è¾¾åˆ°ä¹‹åŽï¼Œâ€œå±éšœâ€ä¼šé‡Šæ”¾ï¼Œçº¿ç¨‹å°†ç»§ç»­æ‰§è¡Œï¼ˆäººå‘˜åˆ°é½åŽå¼€å§‹çˆ¬å±±ï¼‰ã€‚&lt;/p>
&lt;blockquote>
&lt;p>CyclicBarrier å¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œå¯ä»¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨é‡ç½®è®¡æ•°ã€‚
ä½¿ç”¨ barrier.reset() ä¼šè¿›è¡Œé‡ç½®ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šæŠ›å‡º BrokenBarrierException&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// CyclicBarrier çš„è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å­çº¿ç¨‹çš„æ•°é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å°†å­çº¿ç¨‹çš„æ•°é‡è®¾ç½®ä¸º &lt;code>10&lt;/code>ï¼Œå¾ªçŽ¯å±éšœè®¾ç½®ä¸º &lt;code>5&lt;/code>ï¼Œå°†ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æžœï¼šæ¯æœ‰ &lt;code>5&lt;/code> ä¸ªï¼Œçº¿ç¨‹åˆ°è¾¾â€œå±éšœâ€ç‚¹ï¼Œå°±ä¼šé‡Šæ”¾ä¸€æ¬¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/thread/aqs/cyclicbarrier-result-2.png"
width="585"
height="811"
srcset="https://www.letout.cn/p/thread/aqs/cyclicbarrier-result-2_hu2373c7ae3a7710cd05edc6f1f466fc13_156183_480x0_resize_box_3.png 480w, https://www.letout.cn/p/thread/aqs/cyclicbarrier-result-2_hu2373c7ae3a7710cd05edc6f1f466fc13_156183_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cyclicbarrier result"
class="gallery-image"
data-flex-grow="72"
data-flex-basis="173px"
>&lt;/p>
&lt;h3 id="semaphore">Semaphore&lt;/h3>
&lt;p>é€šè¿‡ä½¿ç”¨ &lt;code>Semaphore&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šæŸä¸ªèµ„æºåŒä¸€æ—¶é—´èƒ½å¤Ÿè¢«è®¿é—®çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œå®ƒç›¸å½“äºŽå¯¹æŸä¸ªèµ„æºçš„è®¿é—®è¿›è¡Œäº†æµé‡æŽ§åˆ¶ã€‚&lt;/p>
&lt;p>æ˜¯ä¸€ä¸ªå¯ä»¥è¢« n ä¸ªçº¿ç¨‹å ç”¨çš„æŽ’å®ƒé”ï¼Œå¯ä»¥åœ¨æœ€å¼€å§‹è®¾å®š &lt;code>Semaphore&lt;/code> è®¸å¯è¯æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥èŽ·å¾— 1 ä¸ªæˆ–å¤šä¸ªè®¸å¯è¯ï¼Œå½“è®¸å¯è¯è€—å°½æˆ–ä¸è¶³ä»¥ä¾›å…¶ä»–çº¿ç¨‹èŽ·å–æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°†è¢«é˜»å¡žã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Semaphore&lt;/span> &lt;span class="n">semaphore&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Semaphore&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æœ‰ä¸‰ä¸ªè®¸å¯ï¼Œå‡è®¾æ¯ä¸ªçº¿ç¨‹åªèŽ·å–ä¸€ä¸ªè®¸å¯æ—¶ï¼Œæœ€å¤šä¸¤ä¸ªçº¿ç¨‹å¯è®¿é—®èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">semaphore&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">acquire&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// æ— å‚ä¸ºç”³è¯·ä¸€ä¸ªè®¸å¯è¯ï¼Œæ²¡æœ‰è®¸å¯çš„çº¿ç¨‹ä¼šè¿›è¡Œç­‰å¾…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ç”³è¯·è®¸å¯è¯æˆåŠŸ&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ¨¡æ‹Ÿä»»åŠ¡è€—æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">semaphore&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">release&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="reentrantlock">ReentrantLock&lt;/h3>
&lt;p>ç›¸æ¯”äºŽ &lt;code>synchronized&lt;/code>ï¼Œéƒ½æ”¯æŒ âœ¨å¯é‡å…¥ï¼Œè¿˜å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>âœ¨ ç­‰å¾…å¯ä¸­æ–­&lt;/li>
&lt;li>âœ¨ å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´&lt;/li>
&lt;li>âœ¨ å…¬å¹³é”&lt;/li>
&lt;li>âœ¨ æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡&lt;/li>
&lt;/ul>
&lt;p>&lt;code>ReentrantLock&lt;/code> éœ€è¦ä½¿ç”¨ &lt;code>try-finally&lt;/code> æ‰‹åŠ¨åŠ é”å’Œè§£é”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">reentrantLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸´ç•ŒåŒº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reentrantLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/thread/aqs/ReentrantLock.png"
width="636"
height="318"
srcset="https://www.letout.cn/p/thread/aqs/ReentrantLock_hub675906c100b4f2e2501a8eca65fd5f6_112932_480x0_resize_box_3.png 480w, https://www.letout.cn/p/thread/aqs/ReentrantLock_hub675906c100b4f2e2501a8eca65fd5f6_112932_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="ReentrantLock"
class="gallery-image"
data-flex-grow="200"
data-flex-basis="480px"
>&lt;/p>
&lt;p>ReentrantLock é»˜è®¤å®žçŽ°ä¸ºéžå…¬å¹³é”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nf">ReentrantLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">NonfairSync&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="å¯é‡å…¥">å¯é‡å…¥&lt;/h4>
&lt;p>ä¸€ä¸ªçº¿ç¨‹èŽ·å–äº†ðŸ”’ é”ä¹‹åŽï¼Œå¯ä»¥å¤šæ¬¡èŽ·å–åŒä¸€æŠŠé”ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œä¸€ä¸ªå¸¦é”çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­åˆè°ƒç”¨äº†å¦ä¸€ä¸ªéœ€è¦ç›¸åŒé”çš„æ–¹æ³•ï¼Œåˆ™æ”¹çº¿ç¨‹å¯ä»¥ç›´æŽ¥èŽ·å–é”ï¼Œå¹¶æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¯é‡å…¥é”å¯æœ‰æ•ˆåœ°é¿å…æ­»é”ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method1&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">method1&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// ç¬¬ä¸€æ¬¡èŽ·å–ðŸ”’ é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;do something in method 1&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method2&lt;/span>&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">method2&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// ç¬¬äºŒæ¬¡èŽ·å–ðŸ”’ é”ï¼ˆé‡å…¥ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;do something in method 2&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ç­‰å¾…å¯ä¸­æ–­">ç­‰å¾…å¯ä¸­æ–­&lt;/h4>
&lt;p>&lt;code>lock.lockInterruptibly()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ²¡æœ‰ç«žäº‰å°±ä¼šèŽ·å–é”&lt;/li>
&lt;li>æœ‰ç«žäº‰è¿›å…¥é˜»å¡žé˜Ÿåˆ—ï¼Œä½†æ˜¯å¯ä»¥è¢«ä¸­æ–­ï¼ˆthrow InterruptedExceptionï¼‰&lt;/li>
&lt;/ul>
&lt;p>ä½¿ç”¨ &lt;code>lock.lock()&lt;/code>ï¼Œå³ä½¿è¿›è¡Œ &lt;code>interrupt()&lt;/code> ä¹Ÿä¸ä¼šè®©çº¿ç¨‹ç­‰å¾…ä¸­æ–­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span> &lt;span class="n">thread&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lockInterruptibly&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// å°è¯•èŽ·å–å¯ä¸­æ–­é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é”åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­è¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;æˆåŠŸèŽ·å¾—äº†é” ðŸ”’&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ä¸»çº¿ç¨‹èŽ·å–äº†é” ðŸ”’&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ä¸»çº¿ç¨‹æ‰“æ–­ thread&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">interrupt&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="n">finlaly&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è¶…æ—¶æ—¶é—´">è¶…æ—¶æ—¶é—´&lt;/h3>
&lt;ul>
&lt;li>&lt;code>boolean tryLock()&lt;/code>ï¼šèŽ·å–é”å¤±è´¥ï¼Œç«‹å³è¿”å›ž&lt;/li>
&lt;li>&lt;code>boolean tryLock(long timeout, TimeUnit unit)&lt;/code>ï¼šèŽ·å–é”å¤±è´¥ï¼Œç­‰å¾…è¶…æ—¶æ—¶é—´&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Thread&lt;/span> &lt;span class="n">thread&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">tryLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ç­‰å¾… 2s åŽï¼ŒæˆåŠŸèŽ·å–äº†é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;æˆåŠŸèŽ·å–äº†é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="å…¬å¹³é”">å…¬å¹³é”&lt;/h4>
&lt;p>&lt;code>ReentrantLock&lt;/code> é»˜è®¤æ˜¯éžå…¬å¹³é”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nf">ReentrantLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">NonfairSync&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nf">ReentrantLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">boolean&lt;/span> &lt;span class="n">fair&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">fair&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">FairSync&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">NonfairSync&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>å…¬å¹³é”ï¼šèŽ·å–é”çš„çº¿ç¨‹æ ¹æ®è¿›å…¥ç­‰å¾…é˜Ÿåˆ—çš„é¡ºåºèŽ·å–é”&lt;/li>
&lt;li>éžå…¬å¹³é”ï¼šæ–°çº¿ç¨‹å…ˆå°è¯•æ’é˜ŸèŽ·å–é”ï¼Œæ’é˜Ÿå¤±è´¥å†è¿›å…¥ç­‰å¾…é˜Ÿåˆ—æŽ’åºç­‰å¾…&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// èŽ·å–å…¬å¹³é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="å¤šä¸ªæ¡ä»¶å˜é‡">å¤šä¸ªæ¡ä»¶å˜é‡&lt;/h4>
&lt;p>&lt;code>ReentrantLock&lt;/code> æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼Œå¯ä»¥å¯¹ç­‰å¾…çš„çº¿ç¨‹è¿›è¡Œç²¾å‡†å”¤é†’ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>await()&lt;/code>ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾èŽ·å–çš„é”ï¼Œè¿›å…¥å¯¹åº”çš„ conditionObject è¿›è¡Œç­‰å¾…ï¼›è¢« &lt;code>singnal()&lt;/code> å”¤é†’åŽï¼Œçº¿ç¨‹é‡æ–°åŽ»ç«žäº‰é”ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä¸‰ä¸ªçº¿ç¨‹å¾ªçŽ¯æ‰“å° ABC 10 æ¬¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ThreadDemo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="n">Condition&lt;/span> &lt;span class="n">conditionA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newCondition&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="n">Condition&lt;/span> &lt;span class="n">conditionB&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newCondition&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="n">Condition&lt;/span> &lt;span class="n">conditionC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newCondition&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 0-&amp;gt;print A 1-&amp;gt;print B 2-&amp;gt;print C
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">commonState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">MyTread&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">MyThread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">state&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">commonState&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditionA&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">commonState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditionB&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singnal&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">state&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">commonState&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditionB&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;B&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">commonState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditionC&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singnal&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">state&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">commonState&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditoinC&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;C&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">commonState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditionA&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singnal&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">MyThread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">)).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">MyThread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">)).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">MyThread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">)).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="reentrantreadwritelock">ReentrantReadWriteLock&lt;/h3>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://tech.meituan.com/2018/11/15/java-lock.html" target="_blank" rel="noopener"
>https://tech.meituan.com/2018/11/15/java-lock.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>å•ä¾‹æ¨¡å¼</title><link>https://www.letout.cn/p/desgin-pattern/singleton/</link><pubDate>Mon, 11 Apr 2022 18:02:02 +0800</pubDate><guid>https://www.letout.cn/p/desgin-pattern/singleton/</guid><description>&lt;img src="https://www.letout.cn/imgs/8.jpeg" alt="Featured image of post å•ä¾‹æ¨¡å¼" />&lt;p>å•ä¾‹æ¨¡å¼æ‰€è¦å®žçŽ°çš„ç›®æ ‡ï¼šä¿æŒä¸€ä¸ªç±»æœ‰ä¸”åªæœ‰ä¸€ä¸ªå®žä¾‹ã€‚&lt;/p>
&lt;p>å‡ºäºŽæ€§èƒ½çš„è€ƒè™‘ï¼Œä¸å°‘å•ä¾‹æ¨¡å¼éƒ½ä¼šé‡‡ç”¨å»¶è¿ŸåŠ è½½çš„æ–¹å¼ã€‚æ ¹æ®æ˜¯å¦å»¶è¿Ÿåˆ›å»ºå¯¹è±¡ï¼Œå¯ä»¥åˆ†ä¸ºï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ¤© é¥¿æ±‰å¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ˜ª æ‡’æ±‰å¼&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-æ‡’æ±‰å¼">ðŸ˜ª æ‡’æ±‰å¼&lt;/h2>
&lt;h3 id="å•çº¿ç¨‹çš„å•ä¾‹æ¨¡å¼">å•çº¿ç¨‹çš„å•ä¾‹æ¨¡å¼&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æž„é€ å™¨ç§æœ‰ï¼Œå…¶ä»–ç±»æ— æ³•é€šè¿‡ new åˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ›å»ºå¹¶è¿”å›žè¯¥ç±»çš„å”¯ä¸€å®žä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">someService&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸€äº›ä¸šåŠ¡ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-åŠ é”çš„å•ä¾‹æ¨¡å¼">ðŸ”’ åŠ é”çš„å•ä¾‹æ¨¡å¼&lt;/h3>
&lt;p>ä½¿ç”¨ &lt;code>synchronized&lt;/code> åŠ é”å®žçŽ°çº¿ç¨‹å®‰å…¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// public static synchronized getInstance()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Singleton&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ä¸æŽ¨è ðŸ™…â€â™‚ï¸ æ¯æ¬¡åˆ¤ç©ºæ“ä½œï¼Œéƒ½è¦èŽ·å–é”ï¼Œå¼€é”€æžå¤§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ä½¿ç”¨åŒé‡æ£€éªŒåˆ¤æ–­&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Singleton&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ &lt;code>volatile&lt;/code> ä¿®é¥°å®žä¾‹ï¼Œåˆ©ç”¨äº†ä»¥ä¸‹ä¸¤ä¸ªä½œç”¨ï¼š&lt;/p>
&lt;p>(1) ä¿éšœå¯è§æ€§ï¼š&lt;/p>
&lt;p>ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–äº† &lt;code>instance&lt;/code> çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è¯»å–åˆ°ç›¸åº”çš„å€¼ã€‚&lt;/p>
&lt;p>(2) ä¿éšœæœ‰åºæ€§ï¼š&lt;/p>
&lt;p>ä¿éšœä¸€ä¸ªçº¿ç¨‹è¯»å–åˆ°çš„ &lt;code>instance&lt;/code> å¼•ç”¨çš„å®žä¾‹å·²ç»åˆå§‹åŒ–å®Œæ¯•ã€‚&lt;/p>
&lt;p>å¯¹è±¡å®žä¾‹åŒ–ä¼šåˆ†è§£æˆä»¥ä¸‹å‡ ä¸ªå­æ“ä½œï¼š&lt;/p>
&lt;ul>
&lt;li>åˆ†é…å¯¹è±¡æ‰€éœ€çš„ç©ºé—´&lt;/li>
&lt;li>åˆå§‹åŒ– instance å¼•ç”¨çš„å¯¹è±¡&lt;/li>
&lt;li>å°†å¯¹è±¡çš„å¼•ç”¨å†™å…¥å…±äº«å˜é‡&lt;/li>
&lt;/ul>
&lt;p>ç”±äºŽ JVM å…·æœ‰æŒ‡ä»¤é‡æŽ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ &lt;code>1-&amp;gt;3-&amp;gt;2&lt;/code>ã€‚æŒ‡ä»¤é‡æŽ’åœ¨å•çº¿ç¨‹çŽ¯å¢ƒä¸‹ä¸ä¼šå‡ºçŽ°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹èŽ·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®žä¾‹ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼šçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3 åŽï¼Œæ­¤æ—¶ T2 è°ƒç”¨ &lt;code>getInstance()&lt;/code> åŽå‘çŽ° &lt;code>instance&lt;/code> ä¸ä¸ºç©ºï¼Œå› æ­¤ç›´æŽ¥è¿”å›žï¼Œä½†æ­¤æ—¶ &lt;code>instance&lt;/code> è¿˜æœªè¢«åˆå§‹åŒ–ã€‚&lt;/p>
&lt;h3 id="é™æ€å†…éƒ¨ç±»çš„å•ä¾‹æ¨¡å¼">é™æ€å†…éƒ¨ç±»çš„å•ä¾‹æ¨¡å¼&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">InstanceHolder&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// é™æ€å†…éƒ¨ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ä¿å­˜å¤–éƒ¨ç±»çš„å”¯ä¸€å®žä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">INSTANCE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">InstanceHolder&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">INSTANCE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">someService&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getInstance&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">someService&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“å¤–éƒ¨ç±»åŠ è½½æ—¶ï¼Œå†…éƒ¨ç±»ä¸ä¼šåŠ è½½ï¼Œå¹¶ä¸”é™æ€å˜é‡åªä¼šæœ‰é»˜è®¤å€¼ï¼ˆnullï¼‰ã€‚&lt;/p>
&lt;p>ç±»çš„é™æ€å˜é‡è¢«åˆæ¬¡è®¿é—®æ‰ä¼šè§¦å‘ Java è™šæ‹Ÿæœºå¯¹è¯¥ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¼šå˜ä¸ºå…¶åˆå§‹å€¼ã€‚&lt;/p>
&lt;h3 id="æžšä¸¾å•ä¾‹">æžšä¸¾å•ä¾‹&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">INSTANCE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ç§æœ‰æž„é€ å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pubilc&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">someService&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸šåŠ¡ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å­—æ®µ &lt;code>INSTANCE&lt;/code> æ˜¯æžšä¸¾ç±»çš„å”¯ä¸€å®žä¾‹ã€‚åœ¨ &lt;code>Singleton.INSTANCE&lt;/code> åˆæ¬¡è¢«å¼•ç”¨æ—¶æ‰ä¼šè¢«åˆå§‹åŒ–ã€‚&lt;/p>
&lt;h2 id="-é¥¿æ±‰å¼">ðŸ¤© é¥¿æ±‰å¼&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">pubilc&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åœ¨åˆ›å»ºæ—¶ç›´æŽ¥åˆå§‹åŒ–ï¼Œå¤©ç”Ÿçº¿ç¨‹å®‰å…¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pubilc&lt;/span> &lt;span class="n">staitc&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - é”æœºåˆ¶</title><link>https://www.letout.cn/p/thread/lock/</link><pubDate>Mon, 11 Apr 2022 14:02:02 +0800</pubDate><guid>https://www.letout.cn/p/thread/lock/</guid><description>&lt;img src="https://www.letout.cn/imgs/7.jpeg" alt="Featured image of post Java å¹¶å‘ - é”æœºåˆ¶" />&lt;p>åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šå¯¹åŒä¸€ä¸ªèµ„æºè¿›è¡Œäº‰æŠ¢ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡å¼•å…¥&lt;strong>é”æœºåˆ¶&lt;/strong>ðŸ”’ï¼Œä½¿ç”¨ä¸€ç§æŠ½è±¡çš„é”ï¼Œå¯¹èµ„æºè¿›è¡Œé”å®šï¼Œè¾¾åˆ°åŒæ­¥è®¿é—®çš„ç›®çš„ã€‚&lt;/p>
&lt;h2 id="å®žçŽ°">å®žçŽ°&lt;/h2>
&lt;p>Java é‡‡ç”¨äº†ä¸¤ç§å®žçŽ°æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é˜»å¡žåŒæ­¥ï¼ˆðŸ˜¢ æ‚²è§‚é”ï¼‰&lt;/p>
&lt;p>ðŸ“ é€‚åˆäºŽå†™å¤šè¯»å°‘çš„åœºæ™¯ã€‚å…ˆåŠ é”ï¼Œä¿è¯å†™æ“ä½œæ—¶çš„æ•°æ®æ­£ç¡®ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŸºäºŽ &lt;code>Object&lt;/code> çš„ &lt;code>synchronized&lt;/code> å†…éƒ¨é” ðŸ”’&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŸºäºŽ &lt;code>API&lt;/code> ç±»åº“çš„ &lt;code>java.util.concurrent.locks.Lock&lt;/code> ðŸ”’&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>éžé˜»å¡žåŒæ­¥ï¼ˆðŸ˜ ä¹è§‚é”ï¼‰&lt;/p>
&lt;p>ðŸ“– é€‚åˆäºŽè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚ä¸åŠ é”ï¼Œå¯ä»¥å¤§å¹…æé«˜è¯»çš„æ€§èƒ½ã€‚&lt;/p>
&lt;ul>
&lt;li>åŸºäºŽ &lt;code>CAS&lt;/code> çš„ä¹è§‚é”&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-æ‚²è§‚é”">ðŸ˜¢ æ‚²è§‚é”&lt;/h2>
&lt;p>&lt;img src="https://www.letout.cn/p/thread/lock/pessimistic_lock.png"
width="1203"
height="435"
srcset="https://www.letout.cn/p/thread/lock/pessimistic_lock_hu0c6cbd403a1714d2f5c0f487acc85888_127050_480x0_resize_box_3.png 480w, https://www.letout.cn/p/thread/lock/pessimistic_lock_hu0c6cbd403a1714d2f5c0f487acc85888_127050_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="pessimistic"
class="gallery-image"
data-flex-grow="276"
data-flex-basis="663px"
>&lt;/p>
&lt;p>åœ¨ Java ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡ï¼ˆObjectï¼‰ï¼Œéƒ½æ‹¥æœ‰ä¸€æŠŠé”ï¼Œå­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ï¼Œè®°å½•äº†å½“å‰å¯¹è±¡è¢«å“ªä¸ªçº¿ç¨‹æ‰€å ç”¨ã€‚&lt;/p>
&lt;h3 id="-å†…éƒ¨é”-synchronized">ðŸ” å†…éƒ¨é” synchronized&lt;/h3>
&lt;p>&lt;code>synchronized&lt;/code> å…³é”®å­—å¯ä»¥ç”¨æ¥åŒæ­¥çº¿ç¨‹ï¼Œå…¶è¢«ç¼–è¯‘åŽï¼Œä¼šç”Ÿæˆ &lt;code>monitorenter&lt;/code> å’Œ &lt;code>moniterexit&lt;/code> ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼Œç”¨æ¥è¿›è¡Œçº¿ç¨‹çš„åŒæ­¥ã€‚&lt;/p>
&lt;p>è¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤éƒ½éœ€è¦ä¸€ä¸ª &lt;code>reference&lt;/code> ç±»åž‹çš„å‚æ•°æ¥æŒ‡æ˜Žè¦é”å®šå’Œè§£é”çš„å¯¹è±¡ã€‚&lt;/p>
&lt;p>å¦‚æžœ &lt;code>Java&lt;/code> æºç ä¸­çš„ &lt;code>synchronized&lt;/code> æ˜Žç¡®æŒ‡å®šäº†å¯¹è±¡å‚æ•°ï¼Œé‚£å°±ä»¥è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ä½œä¸º &lt;code>reference&lt;/code>ï¼›&lt;/p>
&lt;p>å¦‚æžœæ²¡æœ‰æ˜Žç¡®æŒ‡å®šï¼Œå°±æ ¹æ® &lt;code>synchronized&lt;/code> ä¿®é¥°çš„æ–¹æ³•ç±»åž‹ï¼ˆå®žä¾‹æ–¹æ³•æˆ–ç±»æ–¹æ³•ï¼‰ï¼Œæ¥å†³å®šæ˜¯å–ä»£ç æ‰€åœ¨çš„å¯¹è±¡å®žä¾‹è¿˜æ˜¯å–ç±»åž‹å¯¹åº”çš„ Class å¯¹è±¡æ¥ä½œä¸ºçº¿ç¨‹è¦æŒæœ‰çš„é”ã€‚&lt;/p>
&lt;h4 id="åŠ é”æ–¹å¼">åŠ é”æ–¹å¼&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>å¯¹è±¡é”&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¿®é¥°å®žä¾‹æ–¹æ³•&lt;/p>
&lt;p>&lt;code>pubilc sychronized void method() { ... }&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»£ç å—é”ä½å½“å‰å¯¹è±¡&lt;/p>
&lt;p>&lt;code>synchronized(this)&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç±»é”&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¿®é¥°é™æ€æ–¹æ³•&lt;/p>
&lt;p>&lt;code>public static synchronized void method() { ... }&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»£ç å—é”å®š class å¯¹è±¡&lt;/p>
&lt;p>&lt;code>synchronized(MyClass.class) { ... }&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;code>synchronized&lt;/code> æ˜¯éžå…¬å¹³é”ã€‚ä¸€æŠŠé”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹èŽ·å–ï¼Œæ²¡æœ‰èŽ·å¾—é”çš„çº¿ç¨‹åªèƒ½ç­‰å¾…ã€‚çº¿ç¨‹å¯¹å†…éƒ¨é”çš„ç”³è¯·å’Œé‡Šæ”¾ç”± JVM è´Ÿè´£å®žæ–½ã€‚&lt;/p>
&lt;p>&lt;code>synchronized&lt;/code> æ˜¯å¯é‡å…¥é”ã€‚æŒæœ‰é”çš„å¯¹è±¡ï¼Œå¯ä»¥å¤šæ¬¡èŽ·å¾—é”ã€‚&lt;/p>
&lt;p>&lt;code>synchronized&lt;/code> ä¿®é¥°çš„æ–¹æ³•ï¼Œæ— è®ºæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œè¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šé‡Šæ”¾é”ã€‚&lt;/p>
&lt;h3 id="-jdk-16-å¯¹-synchronized-çš„ä¼˜åŒ–">ðŸŒ¸ JDK 1.6 å¯¹ synchronized çš„ä¼˜åŒ–&lt;/h3>
&lt;p>&lt;code>synchronized&lt;/code> ä¾èµ–äºŽ &lt;code>JVM&lt;/code>ï¼Œä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿåº•å±‚çš„ &lt;code>Mutex Lock&lt;/code> å®žçŽ°ã€‚&lt;/p>
&lt;p>Java ä¸­çš„çº¿ç¨‹éƒ½æ˜¯ä¸Žæ“ä½œç³»ç»Ÿçš„åŽŸç”Ÿçº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„ï¼Œå¦‚æžœè¦é˜»å¡žæˆ–å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦ä¾é æ“ä½œç³»ç»Ÿæ¥å®žçŽ°ã€‚
æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¹‹å‰çš„åˆ‡æ¢ï¼Œéƒ½éœ€è¦ä»Žç”¨æˆ·æ€åˆ°å†…æ ¸å¤ªçš„è½¬æ¢ï¼Œéƒ½æ˜¯å¾ˆè€—æ—¶çš„æ“ä½œï¼Œæ‰€ä»¥ä½¿ç”¨ &lt;code>synchronized&lt;/code> çš„æˆæœ¬è¾ƒé«˜ã€‚&lt;/p>
&lt;p>JDK 1.6 å¯¹é”çš„å®žçŽ°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚ &lt;code>é”ç²—åŒ–&lt;/code>ï¼Œ&lt;code>é”æ¶ˆé™¤&lt;/code>ï¼Œ&lt;code>è½»é‡çº§é”&lt;/code>ï¼Œ&lt;code>åå‘é”&lt;/code>ï¼Œ&lt;code>è‡ªæ—‹é”&lt;/code>ï¼Œ&lt;code>é€‚åº”æ€§è‡ªæ—‹&lt;/code>ç­‰ã€‚
å¹¶ä¸”ï¼Œå¯¹è±¡é”ä¹Ÿå¼•å…¥äº†å››ç§çŠ¶æ€ï¼Œä¼šéšç€ç«žäº‰æƒ…å†µé€æ¸å‡çº§ï¼ˆä¸å¯ä»¥é™çº§ï¼‰ï¼Œæé«˜èŽ·å–é”å’Œé‡Šæ”¾é”çš„æ•ˆçŽ‡ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ— é” -&amp;gt; åå‘é” -&amp;gt; è½»é‡çº§é” -&amp;gt; é‡é‡çº§é”&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>
&lt;p>ðŸ”’ æ— é”çŠ¶æ€&lt;/p>
&lt;p>ä¸å¯¹èµ„æºè¿›è¡Œé”å®š&lt;/p>
&lt;ul>
&lt;li>æŸäº›èµ„æºä¸ä¼šå‡ºçŽ°å¤šçº¿ç¨‹ç«žäº‰çš„æƒ…å†µï¼Œéšæ„å¤šä¸ªçº¿ç¨‹è°ƒç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ”’ åå‘é”&lt;/p>
&lt;ul>
&lt;li>åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹çš„ç«žäº‰ï¼Œæ¯æ¬¡éƒ½æ˜¯åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡èŽ·å–é”ï¼Œé‚£ä¹ˆå¯¹è±¡é”ä¼šâ€œè®°ä½â€è¿™ä¸ªçº¿ç¨‹ï¼Œåªè¦æ˜¯è¿™ä¸ªçº¿ç¨‹è¿‡æ¥ï¼Œå°±ç›´æŽ¥æŠŠé”äº¤å‡ºåŽ»&lt;/p>
&lt;p>å¦‚æžœå¯¹è±¡å‘çŽ°ç›®å‰ä¸æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯æœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç«žäº‰é”ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”’ è½»é‡çº§é”&lt;/p>
&lt;ul>
&lt;li>é€‚åˆåŒæ­¥ä»£ç å—çš„æ‰§è¡Œé€Ÿåº¦éžå¸¸å¿«çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;p>å½“é”å‡çº§ä¸ºè½»é‡çº§é”çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡ CAS è¿›è¡Œè‡ªæ—‹ç­‰å¾…æ¥èŽ·å–é”ï¼Œä¸ä¼šé˜»å¡žï¼Œä»Žè€Œæé«˜æ€§èƒ½ï¼ˆå¹¶ä¸”ä¼šæ ¹æ®ç­‰å¾…æ—¶é—´è°ƒæ•´ CAS çš„æ—¶é—´ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ”’ é‡é‡çº§é”&lt;/p>
&lt;ul>
&lt;li>é€‚åˆåŒæ­¥ä»£ç å—æ‰§è¡Œé€Ÿåº¦è¾ƒé•¿çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;p>å¯¹è±¡é”çŠ¶æ€è¢«æ ‡è®°ä¸ºé‡é‡çº§é”ï¼Œé€šè¿‡ Monitor æ¥å¯¹çº¿ç¨‹è¿›è¡ŒæŽ§åˆ¶&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ä¹è§‚é”-cas">ðŸ˜ ä¹è§‚é” CAS&lt;/h2>
&lt;p>&lt;img src="https://www.letout.cn/p/thread/lock/optimistic_lock.png"
width="1037"
height="468"
srcset="https://www.letout.cn/p/thread/lock/optimistic_lock_hu036037785ffcb4d154b9171a46e6bd40_99684_480x0_resize_box_3.png 480w, https://www.letout.cn/p/thread/lock/optimistic_lock_hu036037785ffcb4d154b9171a46e6bd40_99684_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="optimistic"
class="gallery-image"
data-flex-grow="221"
data-flex-basis="531px"
>&lt;/p>
&lt;p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒåŒæ­¥ä»£ç å—æ‰§è¡Œçš„æ—¶é—´è¿œè¿œå°äºŽçº¿ç¨‹åˆ‡æ¢çš„è€—æ—¶ã€‚æ‰€ä»¥å¸Œæœ›èƒ½å¤Ÿåœ¨ç”¨æˆ·æ€ä¸­å¯¹çº¿ç¨‹çš„åˆ‡æ¢è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·æ•ˆçŽ‡æ›´é«˜ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬è®©çº¿ç¨‹â€œä¹è§‚åœ°â€åå¤å°è¯•èŽ·å–å…±äº«èµ„æºï¼Œå½“å‘çŽ°ç©ºé—²æ—¶ä¾¿è¿›è¡Œä½¿ç”¨ï¼Œå¦åˆ™ç»§ç»­â€œä¹è§‚åœ°â€è¿›è¡Œé‡è¯•ã€‚&lt;/p>
&lt;p>åŸºäºŽä»¥ä¸Šæƒ³æ³•ï¼Œè¯žç”Ÿäº† &lt;code>CAS (Compare And Swap)&lt;/code> ç®—æ³•ï¼šæ¯”è¾ƒå¹¶äº¤æ¢ã€‚&lt;/p>
&lt;p>CASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>éœ€è¦è¯»å†™çš„å†…å­˜å€¼ &lt;code>addr&lt;/code>&lt;/li>
&lt;li>è¿›è¡Œæ¯”è¾ƒçš„å€¼ &lt;code>oldValue&lt;/code>&lt;/li>
&lt;li>è¦å†™å…¥çš„æ–°å€¼ &lt;code>newValue&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">cas&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">oldValue&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">newValue&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* Executes atomically. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">addr&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">old&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span>&lt;span class="n">addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ª &lt;code>cas()&lt;/code> å‡½æ•°çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•åŒæ­¥æŽªæ–½ï¼Œä¼¼ä¹Žè¿˜æ˜¯å­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>å½“ A çº¿ç¨‹æ¯”è¾ƒäº† oldValue çš„å€¼æ˜¯æƒ³è¦çš„ï¼Œä½†æ˜¯è¿™ä¸ªçž¬é—´ï¼ŒB çº¿ç¨‹çªç„¶æŠ¢åˆ°äº†æ—¶é—´ç‰‡ï¼Œæ›´æ”¹äº†å€¼ï¼›ä½†æ˜¯ A çº¿ç¨‹å¹¶ä¸çŸ¥é“ï¼Œå°†å€¼æ”¹æˆäº† newValueï¼Œè¿™å°±å‡ºçŽ°äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒA B ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶èŽ·å¾—äº†èµ„æºã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œ&lt;code>CAS&lt;/code> çš„æ“ä½œå¿…é¡»æ˜¯ &lt;code>åŽŸå­æ€§&lt;/code> çš„ã€‚è¿™ä¸ªåŽŸå­æ“ä½œï¼Œ&lt;strong>ç”±è®¡ç®—æœºå¤„ç†å™¨æŒ‡ä»¤é›†æä¾›ï¼Œç›´æŽ¥ç”±ç¡¬ä»¶ä¿éšœã€‚&lt;/strong>&lt;/p>
&lt;h3 id="java-ä¸­çš„åŽŸå­å˜é‡ç±»">Java ä¸­çš„åŽŸå­å˜é‡ç±»&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>åŸºç¡€æ•°æ®ç±»åž‹&lt;/p>
&lt;ul>
&lt;li>AtomicInteger&lt;/li>
&lt;li>AtomicLong&lt;/li>
&lt;li>AtomicBoolean&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æ•°ç»„ç±»åž‹&lt;/p>
&lt;ul>
&lt;li>AtomicIntegerArray&lt;/li>
&lt;li>AtomicLongArray&lt;/li>
&lt;li>AtomicReferenceArray&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å­—æ®µæ›´æ–°ç±»åž‹&lt;/p>
&lt;ul>
&lt;li>AtomicIntegerFieldUpdater&lt;/li>
&lt;li>AtomicLongFieldUpdater&lt;/li>
&lt;li>AtomicReferenceFieldUpdater&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å¼•ç”¨ç±»åž‹&lt;/p>
&lt;ul>
&lt;li>AtomicReference&lt;/li>
&lt;li>AtomicStampedReference&lt;/li>
&lt;li>AtomicMarkableReference&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">AtomicInteger&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">AtomicInteger&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; : &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">n&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">incrementAndGet&lt;/span>&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">},&lt;/span> &lt;span class="s">&amp;#34;Thread&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>AtomicInteger&lt;/code> ä¸»è¦ç”±ä¸€ä¸ª &lt;code>Unsafe&lt;/code> ç±»åž‹çš„å®žä¾‹ &lt;code>unsafe&lt;/code> å’Œ &lt;code>Long&lt;/code> ç±»åž‹çš„ &lt;code>offset&lt;/code> å®žçŽ°ã€‚&lt;/p>
&lt;p>Java é€šè¿‡ &lt;code>Unsafe&lt;/code> çš„ CAS æ“ä½œæ¥å¯¹ &lt;code>volatile int&lt;/code> å€¼è¿›è¡Œæ›´æ–°ã€‚æ ¹æ® &lt;code>value&lt;/code> åœ¨å¯¹è±¡ä¸­çš„åç§»é‡ï¼ŒCAS æ“ä½œå†…å­˜æ•°æ®ï¼Œæ‰§è¡Œä¸€äº›åº•å±‚ï¼Œå’Œå¹³å°ç›¸å…³çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// setup to use Unsafe.compareAndSwapInt for updates
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Unsafe&lt;/span> &lt;span class="n">unsafe&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Unsafe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getUnsafe&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">valueOffset&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">valueOffset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">unsafe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">objectFieldOffset&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">AtomicInteger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclareFiele&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Error&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¾‹å¦‚ &lt;code>incrementAndGet()&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// AtomicInteger.java
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">incrementAndGet&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">unsafe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAndAddInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">valueOffset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Unsafe.java
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getAndAddInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">delta&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">do&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">v&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getIntVolatile&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">while&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">compareAndSwapInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">delta&lt;/span>&lt;span class="o">));&lt;/span> &lt;span class="c1">// è‡ªæ—‹ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°é…ç½®ï¼Œé»˜è®¤æ˜¯ 10
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">compareAndSwapInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">expected&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¾ªçŽ¯å¼€é”€å¤§&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åªèƒ½å¤„ç†ä¸€ä¸ªå…±äº«å˜é‡&lt;/p>
&lt;ul>
&lt;li>å°è£…æˆå¯¹è±¡ AtomicReference&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ABA&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="aba-é—®é¢˜">ABA é—®é¢˜&lt;/h3>
&lt;p>CAS éœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥å†…å­˜å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šæ›´æ–°å†…å­˜å€¼ã€‚&lt;/p>
&lt;p>å¦‚æžœå†…å­˜å€¼åŽŸæ¥æ˜¯ Aï¼ŒåŽæ¥å˜æˆäº† Bï¼Œç„¶åŽåˆå˜æˆäº† Aï¼Œé‚£ä¹ˆ CAS è¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘çŽ°å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®žé™…ä¸Šæ˜¯æœ‰å˜åŒ–çš„ã€‚&lt;/p>
&lt;p>&lt;code>A -&amp;gt; B -&amp;gt; A&lt;/code>&lt;/p>
&lt;p>å¯ä»¥ä¸ºå…±äº«å˜é‡å¼•å…¥ä¸€ä¸ªä¿®è®¢å·ï¼ˆæ—¶é—´æˆ³ï¼‰ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šæ›´æ–°ç›¸åº”çš„ä¿®è®¢å·ï¼Œåˆ¤æ–­å˜é‡çš„å€¼æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹ç»™ä¿®æ”¹è¿‡ã€‚&lt;code>AtomicStampedReference&lt;/code>&lt;/p>
&lt;p>&lt;code>[A, 0] -&amp;gt; [B, 1] -&amp;gt; [A, 2]&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;World&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// initialRef initialStamp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">AtomicStampedReference&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">reference&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">AtomicStampedReference&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// expectedReference newStamp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">reference&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">attemptStamp&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// å¯¹ç‰ˆæœ¬å·è¿›è¡Œä¿®æ”¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// expectedReference newReference expectedStamp newStamp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">reference&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">compareAndSet&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// CAS æ“ä½œéœ€è¦åŒæ—¶æä¾› é¢„æœŸå€¼ æ–°å€¼ é¢„æœŸç‰ˆæœ¬å· æ–°ç‰ˆæœ¬å·
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://tech.meituan.com/2018/11/15/java-lock.html" target="_blank" rel="noopener"
>https://tech.meituan.com/2018/11/15/java-lock.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.bilibili.com/video/BV1xT4y1A7kA" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1xT4y1A7kA&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Javaå¹¶å‘ - çº¿ç¨‹æ± </title><link>https://www.letout.cn/p/thread/threadpool/</link><pubDate>Wed, 30 Mar 2022 16:02:02 +0800</pubDate><guid>https://www.letout.cn/p/thread/threadpool/</guid><description>&lt;img src="https://www.letout.cn/p/thread/threadpool/1.png" alt="Featured image of post Javaå¹¶å‘ - çº¿ç¨‹æ± " />&lt;h2 id="-åˆ›å»º">ðŸ‘¨â€ðŸ­ åˆ›å»º&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nf">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">corePoolSize&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">maximumPoolSize&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">long&lt;/span> &lt;span class="n">keepAliveTime&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BlockingQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">workQueue&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadFactory&lt;/span> &lt;span class="n">threadFactory&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RejectedExecutionHandler&lt;/span> &lt;span class="n">handler&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>ðŸ§© &lt;code>corePoolSize&lt;/code> æ ¸å¿ƒçº¿ç¨‹æ•°&lt;/p>
&lt;ul>
&lt;li>æ¯æ¬¡å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªå¤šçº¿ç¨‹ä»»åŠ¡ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ¸å¿ƒçº¿ç¨‹ï¼Œæ— è®ºæ˜¯å¦æœ‰ç©ºé—²çº¿ç¨‹ï¼Œç›´åˆ°åˆ›å»ºçš„çº¿ç¨‹æ•°é‡åˆ°è¾¾æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæ‰ä¼šå¼€å§‹å¤ç”¨çº¿ç¨‹èµ„æº&lt;/li>
&lt;li>ä½¿ç”¨ &lt;code>prestartAllCoreThreads()&lt;/code> ç›´æŽ¥åˆå§‹åŒ–å…¨éƒ¨çº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© &lt;code>maximumPoolSize&lt;/code> æœ€å¤§çº¿ç¨‹æ•°&lt;/p>
&lt;ul>
&lt;li>å½“æ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºŽè¿è¡ŒçŠ¶æ€ï¼Œä¸”ç­‰å¾…é˜Ÿåˆ—å·²æ»¡ï¼Œä¼šå¼€å§‹åˆ›å»ºéžæ ¸å¿ƒçº¿ç¨‹ï¼Œä½†ä¸è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© &lt;code>keepAliveTime&lt;/code> çº¿ç¨‹æœ€å¤§ç©ºé—²æ—¶é—´&lt;/p>
&lt;ul>
&lt;li>éžæ ¸å¿ƒçº¿ç¨‹è¶…è¿‡æœ€å¤§ç©ºé—²æ—¶é—´ï¼Œä¼šè‡ªåŠ¨é”€æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© &lt;code>unit&lt;/code> æœ€å¤§ç©ºé—²æ—¶é—´å•ä½&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© &lt;code>workQueue&lt;/code> çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—&lt;/p>
&lt;ul>
&lt;li>æ ¸å¿ƒçº¿ç¨‹æ•°å·²æ»¡æ—¶ï¼Œä¼šå°†ä»»åŠ¡æš‚å­˜åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼Œç›´åˆ°çº¿ç¨‹èµ„æºå¯ç”¨ï¼›å½“ç­‰å¾…é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œä¼šå¼€å§‹åˆ›å»ºéžæ ¸å¿ƒçº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© &lt;code>threadFactory&lt;/code> çº¿ç¨‹åˆ›å»ºçš„å·¥åŽ‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ§© &lt;code>handler&lt;/code> æ‹’ç»ç­–ç•¥&lt;/p>
&lt;ul>
&lt;li>å½“ç­‰å¾…é˜Ÿåˆ—å·²æ»¡ï¼Œå¹¶ä¸”è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ–°çš„ä»»åŠ¡ä¼šè¿›è¡Œæ‹’ç»å¤„ç†&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="çº¿ç¨‹æ± çš„å¤§å°è®¾è®¡">çº¿ç¨‹æ± çš„å¤§å°è®¾è®¡&lt;/h3>
&lt;p>çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡å¤ªå°‘ -&amp;gt; å½“æœ‰å¤§é‡ä»»åŠ¡å¤„ç†æ—¶ï¼Œé˜Ÿåˆ—ä¼šå †ç§¯å¤§é‡ä»»åŠ¡ï¼Œå¯¼è‡´ç›¸åº”å˜æ…¢ã€‚&lt;/p>
&lt;p>çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡å¤ªå¤š -&amp;gt; ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹æŠ¢å  CPU èµ„æºï¼Œå¯¼è‡´é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåè€Œä¼šå¢žåŠ ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼Œå½±å“æ‰§è¡Œæ•ˆçŽ‡ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸ’» CPU å¯†é›†åž‹&lt;/li>
&lt;/ul>
&lt;p>ä¸»è¦æ˜¯æ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼Œç›¸åº”å¾ˆå¿«ï¼ŒCPU åˆ©ç”¨çŽ‡é«˜ã€‚æŽ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•° + 1&lt;/p>
&lt;ul>
&lt;li>ðŸ’½ IO å¯†é›†åž‹&lt;/li>
&lt;/ul>
&lt;p>ä¸»è¦æ˜¯è¿›è¡Œ IO æ“ä½œï¼Œå¦‚ç¡¬ç›˜è¯»å–æ•°æ®ç­‰ï¼ŒIO æ“ä½œæ—¶é—´é•¿ï¼ŒCPU åˆ©ç”¨ä¸é«˜ï¼ŒæŽ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•° = 2 * CPU æ ¸å¿ƒæ•°ã€‚&lt;/p>
&lt;h3 id="æ‹’ç»ç­–ç•¥">æ‹’ç»ç­–ç•¥&lt;/h3>
&lt;p>&lt;img src="https://www.letout.cn/p/thread/threadpool/1.png"
width="645"
height="281"
srcset="https://www.letout.cn/p/thread/threadpool/1_hu09e646313a866764776d5602df0c4035_178519_480x0_resize_box_3.png 480w, https://www.letout.cn/p/thread/threadpool/1_hu09e646313a866764776d5602df0c4035_178519_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="229"
data-flex-basis="550px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>âŒ AbortPolicy&lt;/p>
&lt;ul>
&lt;li>æ‹’ç»ä»»åŠ¡ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ RejectedExecutionException&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>âŒ DiscardPolicy&lt;/p>
&lt;ul>
&lt;li>ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œç›´æŽ¥ä¸¢å¼ƒæ–°ä»»åŠ¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>âŒ DiscardOldestPolicy&lt;/p>
&lt;ul>
&lt;li>ä¸¢å¼ƒæœ€è€çš„ä»»åŠ¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>âŒ CallerRunsPolicy&lt;/p>
&lt;ul>
&lt;li>å°†ä»»åŠ¡äº¤ç»™è°ƒç”¨çº¿ç¨‹æ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="ä½¿ç”¨">ä½¿ç”¨&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// execute æ— è¿”å›žå€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// submit æœ‰è¿”å›žå€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">future&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">submit&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;è¿”å›žå€¼&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">future&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-å¸¸è§çš„çº¿ç¨‹æ± ">ðŸ‘“ å¸¸è§çš„çº¿ç¨‹æ± &lt;/h2>
&lt;h3 id="-newsinglethreadexecutor">ðŸŒŠ newSingleThreadExecutor&lt;/h3>
&lt;ul>
&lt;li>åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± &lt;/li>
&lt;li>å”¯ä¸€çº¿ç¨‹å¯ä»¥ä¿è¯æ‰€æäº¤çš„ä»»åŠ¡é¡ºåºæ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æ ¸å¿ƒçº¿ç¨‹æ•° = æœ€å¤§çº¿ç¨‹æ•° = 1&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="nf">newSingleThreadExecutor&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">FinalizableDelegatedExecutorService&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0L&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MILLISECONDS&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedBlockingQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;()));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-newfixedthreadpool">ðŸŒŠ newFixedThreadPool&lt;/h3>
&lt;ul>
&lt;li>å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± &lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æ ¸å¿ƒçº¿ç¨‹æ•° = æœ€å¤§çº¿ç¨‹æ•° = n&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="nf">newFixedThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">nThreads&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">nThread&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">nThread&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0L&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MILLISECONDS&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedBlockingQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-newcachedthreadpool">ðŸŒŠ newCachedThreadPool&lt;/h3>
&lt;ul>
&lt;li>æ ¹æ®ä»»åŠ¡ä¼šä¸æ–­åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± &lt;/li>
&lt;/ul>
&lt;p>å½“æäº¤æ–°ä»»åŠ¡æ—¶ï¼Œå¦‚æžœçº¿ç¨‹æ± ä¸ºç©ºæˆ–æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTime=60sï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹èµ„æºã€‚é•¿æ—¶é—´ç©ºé—²çš„ CachedThreadPool ä¸ä¼šæŒæœ‰ä»»åŠ¡ä»»ä½•çº¿ç¨‹èµ„æºã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ ¸å¿ƒçº¿ç¨‹æ•° = 0&lt;/p>
&lt;p>æœ€å¤§çº¿ç¨‹æ•° = Integer.MAX_VALUE&lt;/p>
&lt;p>SynchronousQueue ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡žé˜Ÿåˆ—ï¼Œæ¯ä¸€ä¸ª put() éƒ½ä¼šç­‰å¾…ä¸€ä¸ª take() æ“ä½œ&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="nf">newCachedThreadPool&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Integer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MAX_VALUE&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">60L&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">SynchronousQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="scheduledthreadpoolexecutor">ScheduledThreadPoolExecutor&lt;/h2>
&lt;p>&lt;code>ScheduledThreadPoolExecutor&lt;/code> å¯ä»¥ç”¨æ¥æäº¤å®šæ—¶ä»»åŠ¡ï¼Œ&lt;code>extends ThreadPoolExecutor&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ScheduledExecutorService&lt;/span> &lt;span class="nf">newScheduledThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">corePoolSize&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ScheduledThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">corePoolSize&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>ScheduledThreadPoolExecutor&lt;/code> æœ€å¤§çº¿ç¨‹æ± å®¹é‡ä¸º &lt;code>Integer.MAX_VALUE&lt;/code>ï¼›éƒ½æ˜¯é‡‡ç”¨çš„&lt;code>DelayedWorkQueue&lt;/code> ä½œä¸ºç­‰å¾…é˜Ÿåˆ—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ScheduledExecutorService&lt;/span> &lt;span class="n">executor&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newScheduledThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å»¶è¿Ÿ 3 s åŽæ‰§è¡Œä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">schedule&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®šæ—¶ä»»åŠ¡&amp;#34;&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">shutdown&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ScheduledExecutorService&lt;/span> &lt;span class="n">executor&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newScheduledThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å»¶è¿Ÿ 3 s åŽï¼Œæ¯ 1 s æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">scheduleAtFixedRate&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®šæ—¶ä»»åŠ¡&amp;#34;&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="forkjoinpool">ForkJoinPool&lt;/h2>
&lt;blockquote>
&lt;p>Fork -&amp;gt; æ‹†åˆ† Pool -&amp;gt; åˆå¹¶&lt;/p>
&lt;/blockquote>
&lt;p>æŠŠå¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå°ä»»åŠ¡ï¼Œæœ€åŽæ±‡æ€»å¤šä¸ªå°ä»»åŠ¡çš„ç»“æžœï¼Œå¾—åˆ°æ•´å¤§ä»»åŠ¡çš„ç»“æžœã€‚è¿™äº›å°ä»»åŠ¡éƒ½æ˜¯åŒæ—¶è¿›è¡Œï¼Œå¯æé«˜è¿ç®—æ•ˆçŽ‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ForkJoinTask&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">task&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SubTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ForkJoinPool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commonPool&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">task&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">SubTask&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">RecursiveTask&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">SubTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">start&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">end&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">protected&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="nf">compute&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">end&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">125&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ä»»åŠ¡è¶³å¤Ÿå°ï¼Œç›´æŽ¥è®¡ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; å¼€å§‹è®¡ç®— &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;-&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">end&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;çš„å€¼&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä»»åŠ¡å¤ªå¤§ï¼Œæ‹†åˆ†æˆå­ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">SubTask&lt;/span> &lt;span class="n">subTask1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SubTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">end&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subTask1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">fork&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SubTask&lt;/span> &lt;span class="n">subTask2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SubTask&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">end&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subTask2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">fork&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">subTask1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">join&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">subTask2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">join&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å·¥ä½œçªƒå–ï¼š&lt;/p>
&lt;p>å­ä»»åŠ¡ä¼šè¢«æ”¾åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¼šæœ‰å¯¹åº”çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡ã€‚&lt;/p>
&lt;p>è‹¥æŸä¸ªé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è®¡ç®—å®Œæ¯•ï¼Œä½†å…¶ä»–çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­è¿˜æœ‰ä»»åŠ¡ï¼Œä¼šä»Žå…¶ä»–é˜Ÿåˆ—ä¸­â€œçªƒå–â€ä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://segmentfault.com/a/1190000039267451" target="_blank" rel="noopener"
>https://segmentfault.com/a/1190000039267451&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Java å¤šçº¿ç¨‹</title><link>https://www.letout.cn/p/thread/thread/</link><pubDate>Wed, 30 Mar 2022 14:02:02 +0800</pubDate><guid>https://www.letout.cn/p/thread/thread/</guid><description>&lt;img src="https://www.letout.cn/imgs/9.jpeg" alt="Featured image of post Java å¤šçº¿ç¨‹" />&lt;h2 id="-è¿›ç¨‹ä¸Žçº¿ç¨‹">ðŸ­ è¿›ç¨‹ä¸Žçº¿ç¨‹&lt;/h2>
&lt;p>&lt;strong>è¿›ç¨‹&lt;/strong>æ˜¯æŒ‡å†…å­˜ä¸­è¿è¡Œçš„ç¨‹åºï¼Œæ˜¯å‘æ“ä½œç³»ç»Ÿç”³è¯·èµ„æºçš„åŸºæœ¬å•ä½ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€‚&lt;/p>
&lt;p>&lt;strong>çº¿ç¨‹&lt;/strong>æ˜¯è¿›ç¨‹ä¸­å¯ç‹¬ç«‹æ‰§è¡Œçš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æœ¬èº«ä¸å¯ä»¥ç‹¬ç«‹å­˜åœ¨ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ï¼ŒåŒä¸€è¿›ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹ä¸­çš„èµ„æºã€‚&lt;/p>
&lt;h3 id="æ— å¤„ä¸åœ¨çš„çº¿ç¨‹">æ— å¤„ä¸åœ¨çš„çº¿ç¨‹&lt;/h3>
&lt;ul>
&lt;li>main çº¿ç¨‹&lt;/li>
&lt;li>åžƒåœ¾å›žæ”¶çº¿ç¨‹&lt;/li>
&lt;li>Web æœåŠ¡å™¨è¯·æ±‚å¤„ç†çº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;h2 id="-å¹¶å‘ä¸Žå¹¶è¡Œ">ðŸ¹ å¹¶å‘ä¸Žå¹¶è¡Œ&lt;/h2>
&lt;p>&lt;img src="https://www.letout.cn/p/thread/thread/concurrent-and-parallel.jpg"
width="600"
height="451"
srcset="https://www.letout.cn/p/thread/thread/concurrent-and-parallel_hufc79b6e20e4f7d694c9a67d5fcfb6f12_40736_480x0_resize_q75_box.jpg 480w, https://www.letout.cn/p/thread/thread/concurrent-and-parallel_hufc79b6e20e4f7d694c9a67d5fcfb6f12_40736_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="ConcurrentAndParallel"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="319px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¹¶å‘ &lt;code>Concurrent&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æŒ‡åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œäº¤æ›¿çš„å®Œæˆå¤šä¸ªä»»åŠ¡ï¼ˆä¸€ä¸ª CPU æ ¸å¿ƒäº¤æ›¿æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å¹¶è¡Œ &lt;code>Parallel&lt;/code>&lt;/p>
&lt;ul>
&lt;li>é½å¤´å¹¶è¿›åœ°æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼ˆå¤šä¸ª CPU æ ¸å¿ƒåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-åŒæ­¥ä¸Žå¼‚æ­¥">ðŸ¦Š åŒæ­¥ä¸Žå¼‚æ­¥&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>åŒæ­¥&lt;/p>
&lt;ul>
&lt;li>éœ€è¦ç­‰å¾…ç»“æžœè¿”å›žï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å¼‚æ­¥&lt;/p>
&lt;ul>
&lt;li>ä¸éœ€è¦ç­‰å¾…ç»“æžœè¿”å›žï¼Œå°±èƒ½ç»§ç»­è¿è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-çº¿ç¨‹çš„åˆ›å»º">ðŸ» çº¿ç¨‹çš„åˆ›å»º&lt;/h2>
&lt;h3 id="extends-thread">extends Thread&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">MyThread&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Thread&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="implement-runnable">implement Runnable&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">RunnableThread&lt;/span> &lt;span class="n">implement&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">RunnableThread&lt;/span>&lt;span class="o">()).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="implement-callable">implement Callable&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Callable å¯ä»¥æœ‰è¿”å›žå€¼ï¼Œè¿”å›žå€¼é€šè¿‡ &lt;code>FutureTask&lt;/code> è¿›è¡Œå°è£…ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>call() æ–¹æ³•å…è®¸æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">CallbaleThead&lt;/span> &lt;span class="n">implement&lt;/span> &lt;span class="n">Callbale&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="nf">call&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">Exception&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">666&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">FutureTask&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">futureTask&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">FutureTask&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">CallbaleThead&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">futureTask&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">futureTask&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/thread/thread/FutureTask.png"
width="964"
height="706"
srcset="https://www.letout.cn/p/thread/thread/FutureTask_hu6b05634f3a5f84702cb4db413d8bbef5_51410_480x0_resize_box_3.png 480w, https://www.letout.cn/p/thread/thread/FutureTask_hu6b05634f3a5f84702cb4db413d8bbef5_51410_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="FutureTask"
class="gallery-image"
data-flex-grow="136"
data-flex-basis="327px"
>&lt;/p>
&lt;h3 id="çº¿ç¨‹æ± ">çº¿ç¨‹æ± &lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="n">executorService&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newFixThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">executorService&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="n">executorService&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newFixThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">future&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">executorService&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">submit&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">666&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">future&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ">ðŸ¼ çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Thread&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">State&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">NEW&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RUNNABLE&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BLOCKED&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">WAITING&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TIMED_WAITING&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TERMINATED&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ–°å»º &lt;code>New&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åˆ›å»ºåŽå°šæœªå¯åŠ¨ã€‚&lt;/p>
&lt;ul>
&lt;li>å¯è¿è¡Œ &lt;code>Runnable&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å¯èƒ½æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½æ­£åœ¨ç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚&lt;/p>
&lt;ul>
&lt;li>é˜»å¡ž &lt;code>Blocked&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ç­‰å¾…èŽ·å–ä¸€ä¸ªæŽ’å®ƒé”ï¼Œå¦‚æžœå…¶çº¿ç¨‹é‡Šæ”¾äº†é”å°±ä¼šç»“æŸæ­¤çŠ¶æ€ã€‚ï¼ˆæœªèŽ·å–è¿‡é”ï¼‰&lt;/p>
&lt;ul>
&lt;li>æ— é™æœŸç­‰å¾… &lt;code>Waiting&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œå¦åˆ™ä¸ä¼šè¢«åˆ†é… CPU æ—¶é—´ç‰‡ã€‚ï¼ˆèŽ·å–è¿‡é”ï¼Œä½†æ˜¯æ”¾å¼ƒäº†é”ï¼‰&lt;/p>
&lt;ul>
&lt;li>é™æœŸç­‰å¾… &lt;code>Timed Waiting&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ— éœ€ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åŽä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ã€‚&lt;/p>
&lt;ul>
&lt;li>æ­»äº¡ &lt;code>Terminated&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>çº¿ç¨‹ç»“æŸä»»åŠ¡ä¹‹åŽè‡ªå·±ç»“æŸï¼Œæˆ–è€…äº§ç”Ÿäº†å¼‚å¸¸è€Œç»“æŸã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="-å®ˆæŠ¤çº¿ç¨‹">ðŸ¦Š å®ˆæŠ¤çº¿ç¨‹&lt;/h2>
&lt;p>Java ä¸­çš„çº¿ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç”¨æˆ·çº¿ç¨‹ &lt;code>user Thread&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®ˆæŠ¤çº¿ç¨‹ &lt;code>daemon Thread&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Java ç¨‹åºçš„å…¥å£æ˜¯ç”± JVM å¯åŠ¨çš„ main çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œmain çº¿ç¨‹å¯ä»¥å¯åŠ¨å…¶ä»–çº¿ç¨‹ã€‚å½“æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹è¿è¡Œéƒ½ç»“æŸæ—¶ï¼Œç¨‹åºç»ˆæ­¢ï¼Œåªè¦æœ‰ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹æ²¡æœ‰é€€å‡ºï¼Œç¨‹åºå°±ä¸ä¼šç»ˆæ­¢ã€‚&lt;/p>
&lt;p>å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰æ˜¯ä¸€ç§åœ¨åŽå°ä¸ºå…¶ä»–çº¿ç¨‹æœåŠ¡çš„çº¿ç¨‹ã€‚åœ¨ JVM ä¸­ï¼Œåªè¦ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œæ— è®ºå®ˆæŠ¤çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œéƒ½ä¼šé€€å‡ºç¨‹åºã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setDaemon&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>JVM çš„åžƒåœ¾å›žæ”¶çº¿ç¨‹å°±æ˜¯ä¸€ç§å®ˆæŠ¤çº¿ç¨‹ã€‚&lt;/p>
&lt;h2 id="-æŸ¥çœ‹è¿›ç¨‹">ðŸ»â€â„ï¸ æŸ¥çœ‹è¿›ç¨‹&lt;/h2>
&lt;h3 id="linux">Linux&lt;/h3>
&lt;ul>
&lt;li>&lt;code>ps&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>ps -ef&lt;/code> ï¼šæŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹&lt;/p>
&lt;ul>
&lt;li>&lt;code>top&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å‘½ä»¤ä¸‹å¯é€šè¿‡æŒ‰ &lt;code>H&lt;/code> åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºçº¿ç¨‹&lt;/p>
&lt;p>&lt;code>top -H -p 4262&lt;/code> ï¼š æŸ¥çœ‹ PID=4262 è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯&lt;/p>
&lt;h3 id="java">Java&lt;/h3>
&lt;ul>
&lt;li>&lt;code>jps&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹&lt;/p>
&lt;ul>
&lt;li>&lt;code>jstack&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>jstack 4262&lt;/code> ï¼š æŸ¥çœ‹ PID=4262 çš„ Java è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://pdai.tech/md/java/thread/java-thread-x-thread-basic.html#%e5%ae%9e%e7%8e%b0-callable-%e6%8e%a5%e5%8f%a3" target="_blank" rel="noopener"
>https://pdai.tech/md/java/thread/java-thread-x-thread-basic.html#%e5%ae%9e%e7%8e%b0-callable-%e6%8e%a5%e5%8f%a3&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>é€šç”¨ç¨‹åºè®¾è®¡</title><link>https://www.letout.cn/p/effective-java/general-programming/</link><pubDate>Wed, 30 Mar 2022 14:02:02 +0800</pubDate><guid>https://www.letout.cn/p/effective-java/general-programming/</guid><description>&lt;img src="https://www.letout.cn/p/effective-java/general-programming/effective-java.png" alt="Featured image of post é€šç”¨ç¨‹åºè®¾è®¡" />&lt;h1 id="-é€šç”¨ç¨‹åºè®¾è®¡">â˜˜ï¸ é€šç”¨ç¨‹åºè®¾è®¡&lt;/h1>
&lt;p>Effective Java é˜…è¯»ç¬”è®°ã€‚æœ¬ç« ä¸»è¦è®¨è®ºäº† &lt;code>Java&lt;/code> è¯­è¨€çš„å…·ä½“ç»†èŠ‚ã€‚åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>å±€éƒ¨å˜é‡&lt;/li>
&lt;li>æŽ§åˆ¶ç»“æž„&lt;/li>
&lt;li>ç±»åº“&lt;/li>
&lt;li>æ•°æ®ç»“æž„&lt;/li>
&lt;li>ä¸æ˜¯ç”±è¯­è¨€æœ¬èº«æä¾›çš„æœºåˆ¶&lt;/li>
&lt;li>ä¼˜åŒ–å’Œå‘½åæƒ¯ä¾‹ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="57-å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–">57. å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–&lt;/h2>
&lt;h3 id="-å»ºè®®">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± æœ€å°åŒ–å±€éƒ¨å˜é‡çš„èŒƒå›´ï¼Œå¯æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œé™ä½Žå‡ºé”™çš„å¯èƒ½æ€§ã€‚&lt;strong>åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å®ƒçš„åœ°æ–¹å£°æ˜Žå˜é‡ã€‚&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ æ¯ä¸ªå±€éƒ¨å˜é‡å£°æ˜Žéƒ½åº”è¯¥åŒ…å«ä¸€ä¸ªåˆå§‹åŒ–è¡¨è¾¾å¼ã€‚&lt;code>try-catch&lt;/code> è¯­å¥é™¤å¤–ã€‚&lt;/p>
&lt;p>å¦‚æžœä¸€ä¸ªå˜é‡åˆå§‹åŒ–ï¼Œä¼šæŠ›å‡ºä¸€ä¸ª checked å¼‚å¸¸ï¼Œå¿…é¡»åœ¨ &lt;code>try&lt;/code> ä¸­åˆå§‹åŒ–ï¼ˆé™¤éžæ‰€åŒ…å«çš„æ–¹æ³•å¯ä»¥æŠ›å¼‚å¸¸ï¼‰ã€‚&lt;/p>
&lt;p>å¦‚æžœè¯¥å€¼å¿…é¡»åœ¨ &lt;code>try&lt;/code> å—ä¹‹å¤–ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åœ¨ &lt;code>try&lt;/code> å—ä¹‹å‰å£°æ˜Žï¼Œæ­¤æ—¶å®ƒè¿˜ä¸èƒ½â€œåˆç†åœ°åˆå§‹åŒ–â€œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cons&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸ€ å¾ªçŽ¯ç»“æŸåŽä¸å†éœ€è¦å¾ªçŽ¯å˜é‡ï¼Œ&lt;code>for&lt;/code> å¾ªçŽ¯å°±ä¼˜äºŽ &lt;code>while&lt;/code> å¾ªçŽ¯ï¼ˆ&lt;code>for&lt;/code> å¾ªçŽ¯å…è®¸å£°æ˜Žå¾ªçŽ¯å˜é‡ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± ä¿æŒæ–¹æ³•å°è€Œé›†ä¸­ï¼Œæ¯ä¸ªæ“ä½œéƒ½ç”¨ä¸€ä¸ªæ–¹æ³•æ¥å®Œæˆã€‚é¿å…ä¸€ä¸ªæ“ä½œç›¸å…³çš„å±€éƒ¨å˜é‡å¯èƒ½åœ¨å¦ä¸€ä¸ªæ“ä½œä¸­ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹">ðŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ¾ éåŽ†é›†åˆçš„é¦–é€‰ä¹ æƒ¯ç”¨æ³•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Element&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do something with e
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸ’ éœ€è¦è®¿é—® &lt;code>Iterator&lt;/code> / è°ƒç”¨ &lt;code>Iterator&lt;/code> çš„ &lt;code>remove()&lt;/code>ï¼Œé¦–é€‰ &lt;code>for&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// i is loop variable
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Element&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do something with i and e
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸ’ å¾ªçŽ¯ä¹ æƒ¯ç”¨æ³•ï¼šæœ€å°åŒ–å±€éƒ¨å˜é‡çš„èŒƒå›´&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ¯æ¬¡å¾ªçŽ¯éƒ½ä¼šè°ƒç”¨ expensiveComputation()ï¼Œä¸”è¿”å›žç»“æžœç›¸åŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">expensiveComputation&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do something with i
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®ƒæœ‰ä¸¤ä¸ªå¾ªçŽ¯å˜é‡ï¼ši å’Œ nï¼Œéƒ½å…·æœ‰å®Œå…¨æ­£ç¡®çš„ä½œç”¨åŸŸã€‚ç¬¬äºŒä¸ªå˜é‡ n ç”¨äºŽå­˜å‚¨ç¬¬ä¸€ä¸ªå˜é‡çš„æžé™ï¼Œé¿å…äº†æ¯æ¬¡è¿­ä»£ä¸­å†—ä½™è®¡ç®—çš„æˆæœ¬ã€‚
å¦‚æžœå¾ªçŽ¯æ¶‰åŠä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸”ä¿è¯åœ¨æ¯æ¬¡è¿­ä»£ä¸­è¿”å›žç›¸åŒçš„ç»“æžœï¼Œåº”è¯¥ä½¿ç”¨è¿™ä¸ªä¹ æƒ¯ç”¨æ³•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="58-for-each-å¾ªçŽ¯ä¼˜äºŽä¼ ç»Ÿçš„-for-å¾ªçŽ¯">58. for-each å¾ªçŽ¯ä¼˜äºŽä¼ ç»Ÿçš„ for å¾ªçŽ¯&lt;/h2>
&lt;h3 id="-å»ºè®®-1">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± &lt;code>for-each&lt;/code> éšè—è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡ï¼Œå¯æ¶ˆé™¤æ··ä¹±å’Œå‡ºé”™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± &lt;code>:&lt;/code> è¡¨ç¤º â€œåœ¨&amp;hellip;é‡Œé¢â€ã€‚ä½¿ç”¨ &lt;code>for-each&lt;/code> å¾ªçŽ¯ä¸ä¼šé™ä½Žæ€§èƒ½ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¥€ ä»¥ä¸‹æƒ…å†µä¸åº”è¯¥ä½¿ç”¨ &lt;code>for-each&lt;/code>ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ° ç ´åæ€§è¿‡æ»¤ã€‚å¦‚æžœéœ€è¦éåŽ†ä¸€ä¸ªé›†åˆå¹¶åˆ é™¤é€‰å®šå…ƒç´ ï¼Œéœ€è¦ä½¿ç”¨æ˜¾å¼çš„è¿­ä»£å™¨ï¼Œä»¥ä¾¿è°ƒç”¨å…¶ &lt;code>remove()&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ° è½¬æ¢ã€‚éåŽ†æ—¶éœ€è¦æ›¿æ¢å…¶ä¸­å…ƒç´ çš„å€¼ï¼Œéœ€è¦ &lt;code>List&lt;/code> è¿­ä»£å™¨æˆ–æ•°ç»„ç´¢å¼•æ¥æ›¿æ¢å…ƒç´ çš„å€¼ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ° å¹¶è¡Œè¿­ä»£ã€‚å¦‚æžœéœ€è¦å¹¶è¡ŒéåŽ†å¤šä¸ªé›†åˆï¼Œé‚£ä¹ˆéœ€è¦æ˜¾å¼åœ°æŽ§åˆ¶è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡ï¼Œä»¥ä¾¿æ‰€æœ‰è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡éƒ½å¯ä»¥åŒæ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-1">ðŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ’ ä½¿ç”¨ &lt;code>Collection.removeIf()&lt;/code> å¯é¿å…æ˜¾å¼çš„éåŽ†ï¼ˆJava8ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">Collection&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Iterable&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Predicate&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">filter&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Objects&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">requireNonNull&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">removed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">each&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">interator&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">each&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">test&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">each&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">each&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">removed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">removed&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h2 id="59-äº†è§£å¹¶ä½¿ç”¨åº“">59. äº†è§£å¹¶ä½¿ç”¨åº“&lt;/h2>
&lt;h3 id="-å»ºè®®-2">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;p>&lt;strong>èƒ½ç”¨åº“æ–¹æ³•å°±ç”¨åº“æ–¹æ³•ã€‚&lt;/strong>&lt;/p>
&lt;p>å…·æœ‰ç®—æ³•èƒŒæ™¯çš„é«˜çº§å·¥ç¨‹å¸ˆèŠ±äº†å¤§é‡æ—¶é—´è®¾è®¡ã€å®žçŽ°å’Œæµ‹è¯•åº“æ–¹æ³•ï¼Œç„¶åŽå°†åº“æ–¹æ³•å±•ç¤ºç»™è¯¥é¢†åŸŸçš„å‡ ä½ä¸“å®¶ï¼Œä»¥ç¡®ä¿åº“æ–¹æ³•æ˜¯æ­£ç¡®çš„ã€‚
è¿™äº›åº“æ–¹æ³•ç»è¿‡ beta æµ‹è¯•ã€å‘å¸ƒï¼Œå¹¶è¢«æ•°ç™¾ä¸‡ç¨‹åºå‘˜å¹¿æ³›ä½¿ç”¨äº†è¿‘ 20 å¹´ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± ä½¿ç”¨æ ‡å‡†ç±»åº“çš„å¥½å¤„ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° åˆ©ç”¨ç¼–å†™å®ƒçš„ä¸“å®¶çš„çŸ¥è¯†å’Œä»¥å‰ä½¿ç”¨å®ƒçš„äººçš„ç»éªŒã€‚&lt;/li>
&lt;li>ðŸŒ° ä¸å¿…æµªè´¹æ—¶é—´ä¸ºé‚£äº›ä¸Žä½ çš„å·¥ä½œæ— å…³çš„é—®é¢˜ç¼–å†™ä¸“é—¨çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/li>
&lt;li>ðŸŒ° éšç€æ—¶é—´çš„æŽ¨ç§»ï¼Œå®ƒä»¬çš„æ€§èƒ½ä¼šä¸æ–­æé«˜ï¼Œæ— éœ€ä»˜å‡ºä»»ä½•åŠªåŠ›ã€‚ï¼ˆç‰ˆæœ¬æ›´æ–°ï¼‰&lt;/li>
&lt;li>ðŸŒ° å¯ä»¥å°†ä»£ç æ”¾åœ¨ä¸»å¹²ä¸­ã€‚è¿™æ ·çš„ä»£ç æ›´å®¹æ˜“è¢«å¼€å‘äººå‘˜é˜…è¯»ã€ç»´æŠ¤å’Œå¤ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± åœ¨æ¯ä¸ªä¸»è¦ç‰ˆæœ¬ä¸­ï¼Œéƒ½ä¼šå‘åº“ä¸­æ·»åŠ è®¸å¤šç‰¹æ€§ï¼Œäº†è§£è¿™äº›æ–°å¢žç‰¹æ€§æ˜¯å€¼å¾—çš„ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ æ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥ç†Ÿæ‚‰ &lt;code>java.lang&lt;/code>ã€&lt;code>java.util&lt;/code> å’Œ &lt;code>java.io&lt;/code> çš„åŸºç¡€çŸ¥è¯†åŠå…¶å­åŒ…ã€‚ å…¶ä»–åº“çš„çŸ¥è¯†å¯ä»¥æ ¹æ®éœ€è¦èŽ·å¾—ã€‚å°¤å…¶æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° &lt;code>java.util.Collections&lt;/code>&lt;/li>
&lt;li>ðŸŒ° &lt;code>java.util.Streams&lt;/code>&lt;/li>
&lt;li>ðŸŒ° &lt;code>java.util.concurrent&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å¦‚æžœä½ åœ¨ Java å¹³å°åº“ä¸­æ‰¾ä¸åˆ°ä½ éœ€è¦çš„ä¸œè¥¿ï¼Œä½ çš„ä¸‹ä¸€ä¸ªé€‰æ‹©åº”è¯¥æ˜¯å¯»æ‰¾é«˜è´¨é‡çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚è°·æ­Œçš„ä¼˜ç§€çš„å¼€æº &lt;code>Guava&lt;/code> åº“ã€‚å¦‚æžœä½ æ— æ³•åœ¨ä»»ä½•é€‚å½“çš„åº“ä¸­æ‰¾åˆ°æ‰€éœ€çš„åŠŸèƒ½ï¼Œåªèƒ½è‡ªå·±å®žçŽ°å®ƒã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-2">ðŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ’ ä»Ž Java 7 å¼€å§‹ï¼Œå°±ä¸åº”è¯¥å†ä½¿ç”¨ Randomã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ° åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé€‰æ‹©çš„éšæœºæ•°ç”Ÿæˆå™¨çŽ°åœ¨æ˜¯ &lt;code>ThreadLocalRandom&lt;/code>ã€‚ å®ƒèƒ½äº§ç”Ÿæ›´é«˜è´¨é‡çš„éšæœºæ•°ï¼Œè€Œä¸”é€Ÿåº¦éžå¸¸å¿«ã€‚&lt;code>ThreadLocalRandom.current().nextInt(100)&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ° å¯¹äºŽ &lt;code>Fork Join Pool&lt;/code> å’Œå¹¶è¡Œ &lt;code>Stream&lt;/code>ï¼Œä½¿ç”¨ &lt;code>SplittableRandom&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å‡è®¾ä½ æƒ³è¦ç”Ÿæˆ 0 åˆ°æŸä¸ªä¸Šç•Œä¹‹é—´çš„éšæœºæ•´æ•°ï¼Œè®¸å¤šç¨‹åºå‘˜ä¼šç¼–å†™ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„å°æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æœ‰ä¸¥é‡ç¼ºé™·
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">static&lt;/span> &lt;span class="n">Random&lt;/span> &lt;span class="n">rnd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Random&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">random&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">Math&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">abs&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">rad&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®ƒæœ‰ä¸‰ä¸ªç¼ºç‚¹:&lt;/p>
&lt;ul>
&lt;li>ðŸŒ© n æ˜¯å°çš„å¹³æ–¹æ•°ï¼Œéšæœºæ•°åºåˆ—ä¼šåœ¨ç›¸å½“çŸ­çš„æ—¶é—´å†…é‡å¤&lt;/li>
&lt;li>ðŸŒ© å¦‚æžœ n ä¸æ˜¯ 2 çš„å¹‚ï¼Œé‚£ä¹ˆå¹³å‡è€Œè¨€ï¼Œä¸€äº›æ•°å­—å°†æ¯”å…¶ä»–æ•°å­—æ›´é¢‘ç¹åœ°è¿”å›ž&lt;/li>
&lt;li>ðŸŒ© åœ¨æžå°‘æ•°æƒ…å†µä¸‹ä¼šè¿”å›žè¶…å‡ºæŒ‡å®šèŒƒå›´çš„æ•°å­— &lt;code>Integer.MAX_VALUE&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>åº”è¯¥ç›´æŽ¥ä½¿ç”¨ç±»åº“ &lt;code>Ramdom.nextInt(n)&lt;/code> ï¼Œè€Œä¸æ˜¯è‡ªå·±å°è£…&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">nextInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸŒ¾ Linux &lt;code>curl&lt;/code> in Java 9&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å‡è®¾ä½ æƒ³ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥æ‰“å°å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„ URL çš„å†…å®¹ï¼ˆè¿™å¤§è‡´æ˜¯ Linux &lt;code>curl&lt;/code> å‘½ä»¤æ‰€åšçš„ï¼‰ã€‚åœ¨ Java 9 ä¹‹å‰ï¼Œè¿™æ®µä»£ç æœ‰ç‚¹ä¹å‘³ï¼Œä½†æ˜¯åœ¨ Java 9 ä¸­ï¼Œ&lt;code>transferTo()&lt;/code> è¢«æ·»åŠ åˆ° &lt;code>InputStream&lt;/code> ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨è¿™ä¸ªæ–°æ–¹æ³•æ‰§è¡Œè¿™é¡¹ä»»åŠ¡çš„å®Œæ•´ç¨‹åºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IOException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InputStream&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">URL&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">]).&lt;/span>&lt;span class="na">openStream&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">in&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">transferTo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="60-è‹¥éœ€è¦ç²¾ç¡®ç­”æ¡ˆå°±åº”é¿å…ä½¿ç”¨-float-double">60. è‹¥éœ€è¦ç²¾ç¡®ç­”æ¡ˆå°±åº”é¿å…ä½¿ç”¨ float double&lt;/h2>
&lt;h3 id="-å»ºè®®-3">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>ðŸŒ± &lt;code>float&lt;/code> å’Œ &lt;code>double&lt;/code> ç±»åž‹ç‰¹åˆ«ä¸é€‚åˆè¿›è¡Œè´§å¸è®¡ç®—ï¼Œå› ä¸ºä¸èƒ½å°† 0.1ï¼ˆæˆ– 10 çš„ä»»æ„è´Ÿæ¬¡å¹‚ï¼‰ç²¾ç¡®åœ°è¡¨ç¤ºã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 0.6100000000000001
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">03&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">42&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ€ æ•°å€¼ä¸æ˜¯å¤ªå¤§ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>int&lt;/code> æˆ– &lt;code>long&lt;/code>
&lt;ul>
&lt;li>ðŸŒ° å¦‚æžœæ•°å€¼ä¸è¶…è¿‡ 9 ä½å°æ•°ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>int&lt;/code>&lt;/li>
&lt;li>ðŸŒ° å¦‚æžœä¸è¶…è¿‡ 18 ä½ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>long&lt;/code>&lt;/li>
&lt;li>ðŸŒ° å¦‚æžœæ•°é‡å¯èƒ½è¶…è¿‡ 18 ä½ï¼Œåˆ™ä½¿ç”¨ &lt;code>BigDecimal&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>ä¾‹å¦‚ï¼šåœ¨å¾®ä¿¡æ”¯ä»˜çš„ &lt;code>Java SDK&lt;/code> ä¸­ï¼Œè´§å¸çš„ç±»åž‹ä¸º &lt;code>int&lt;/code>ï¼Œç»“ç®—å•ä½ä¸º åˆ†ï¼›
åœ¨æ”¯ä»˜å®æ”¯ä»˜çš„ &lt;code>Java SDK&lt;/code> ä¸­ï¼Œè´§å¸çš„ç±»åž‹ä¸º &lt;code>String&lt;/code>ï¼Œç»“ç®—å•ä½ä¸º å…ƒ&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>ðŸŒ± ä½¿ç”¨ &lt;code>BigDecimal&lt;/code> ç±»åž‹ä»£æ›¿ &lt;code>double / float&lt;/code>ã€‚æ³¨æ„ï¼Œ&lt;strong>ä½¿ç”¨ &lt;code>BigDecimal&lt;/code> çš„ &lt;code>String&lt;/code> æž„é€ å‡½æ•°è€Œä¸æ˜¯å®ƒçš„ &lt;code>double / float&lt;/code> æž„é€ å‡½æ•°ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h2 id="61-åŸºæœ¬æ•°æ®ç±»åž‹ä¼˜äºŽåŒ…è£…ç±»">61. åŸºæœ¬æ•°æ®ç±»åž‹ä¼˜äºŽåŒ…è£…ç±»&lt;/h2>
&lt;h3 id="-å»ºè®®-4">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± Java ç±»åž‹ç³»ç»Ÿç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° åŸºæœ¬ç±»åž‹ï¼ˆprimitive typeï¼‰ï¼š&lt;code>int double boolean&lt;/code>&lt;/li>
&lt;li>ðŸŒ° å¼•ç”¨ç±»åž‹ï¼ˆreference typeï¼‰ï¼š&lt;code>String List&lt;/code>
æ¯ä¸ªåŸºæœ¬ç±»åž‹éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å¼•ç”¨ç±»åž‹ï¼Œç§°ä¸ºåŒ…è£…ç±»åž‹ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± åŸºæœ¬ç±»åž‹å’ŒåŒ…è£…ç±»åž‹ä¹‹é—´æœ‰ä¸‰ä¸ªä¸»è¦åŒºåˆ«ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° åŸºæœ¬ç±»åž‹åªæœ‰å®ƒä»¬çš„å€¼ï¼Œè€ŒåŒ…è£…ç±»åž‹å…·æœ‰ä¸Žå…¶å€¼ä¸åŒçš„æ ‡è¯†&lt;/li>
&lt;li>ðŸŒ° åŸºæœ¬ç±»åž‹åªæœ‰å…¨åŠŸèƒ½å€¼ï¼Œè€Œæ¯ä¸ªåŒ…è£…ç±»åž‹é™¤äº†å¯¹åº”çš„åŸºæœ¬ç±»åž‹çš„æ‰€æœ‰åŠŸèƒ½å€¼å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéžåŠŸèƒ½å€¼ï¼Œå³ &lt;code>null&lt;/code>&lt;/li>
&lt;li>ðŸŒ° åŸºæœ¬ç±»åž‹æ¯”åŒ…è£…ç±»åž‹æ›´èŠ‚çœæ—¶é—´å’Œç©ºé—´&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ è¦æœ‰é€‰æ‹©ï¼Œå°±åº”è¯¥ä¼˜å…ˆä½¿ç”¨åŸºæœ¬ç±»åž‹ï¼Œè€Œä¸æ˜¯åŒ…è£…ç±»åž‹ã€‚åŸºæœ¬ç±»åž‹æ›´ç®€å•ã€æ›´å¿«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¥€ ä»¥ä¸‹æƒ…å†µå¿…é¡»ä½¿ç”¨åŒ…è£…ç±»åž‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° ä½œä¸ºé›†åˆä¸­çš„å…ƒç´ ã€é”®å’Œå€¼&lt;/li>
&lt;li>ðŸŒ° å¿…é¡»ä½¿ç”¨åŒ…è£…ç±»åž‹ä½œä¸ºç±»åž‹å‚æ•°ï¼Œ&lt;code>Java&lt;/code> ä¸å…è®¸ä½¿ç”¨åŸºæœ¬ç±»åž‹ã€‚å¦‚ &lt;code>ThreadLocal&amp;lt;Integer&amp;gt;&lt;/code>&lt;/li>
&lt;li>ðŸŒ° è¿›è¡Œåå°„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¿…é¡»ä½¿ç”¨åŒ…è£…ç±»åž‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-3">ðŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ¾ ä»¥ä¸‹ä¸‰ä¸ªä¾‹å­ä¸ºå¸¸è§çš„åŒ…è£…ç±»åž‹é—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ© å°† &lt;code>==&lt;/code> æ“ä½œç¬¦åº”ç”¨äºŽåŒ…è£…ç±»åž‹å‡ ä¹Žéƒ½æ˜¯é”™è¯¯çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™…&lt;/span>&lt;span class="n">â€&lt;/span>&lt;span class="err">â™‚&lt;/span>&lt;span class="n">ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Comparator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">naturalOrder&lt;/span> &lt;span class="o">=(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¡¨è¾¾å¼ &lt;code>i &amp;lt; j&lt;/code> ä¼šä½¿ i å’Œ j å¼•ç”¨çš„ &lt;code>Integer&lt;/code> å®žä¾‹è‡ªåŠ¨æ‹†ç®±ã€‚
è¡¨è¾¾å¼ &lt;code>i == j&lt;/code> å¯¹ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ‰§è¡Œæ¯”è¾ƒï¼Œè¿”å›ž &lt;code>false&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Comparator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">naturalOrder&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">iBoxed&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">jBoxed&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iBoxed&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">jBoxed&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// è‡ªåŠ¨æ‹†ç®±
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸŒ© &lt;code>NullPointerException&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Unbelievable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">42&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Unbelievable&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è®¡ç®—è¡¨è¾¾å¼ &lt;code>i == 42&lt;/code> æ—¶æŠ›å‡º &lt;code>NullPointerException&lt;/code>ã€‚ç©ºå¯¹è±¡å¼•ç”¨è‡ªåŠ¨æ‹†ç®±ï¼Œå°†å¾—åˆ°ä¸€ä¸ª &lt;code>NullPointerException&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ© ä¸¥é‡çš„æ€§èƒ½é—®é¢˜&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Long&lt;/span> &lt;span class="n">sum&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0L&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">Integer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MAX_VALUE&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å±€éƒ¨å˜é‡ &lt;code>sum&lt;/code>ï¼Œå®ƒæ˜¯åŒ…è£…ç±»åž‹ &lt;code>Long&lt;/code>ï¼Œè€Œä¸æ˜¯åŸºæœ¬ç±»åž‹ &lt;code>long&lt;/code>ã€‚å˜é‡è¢«åå¤è£…ç®±å’Œæ‹†ç®±ï¼ˆè¶…å‡ºç¼“å­˜éƒ¨åˆ†æ—¶ï¼‰ï¼Œå¯¼è‡´äº§ç”Ÿæ˜Žæ˜¾çš„æ€§èƒ½ä¸‹é™ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="62-å…¶ä»–ç±»åž‹æ›´åˆé€‚æ—¶åº”é¿å…ä½¿ç”¨å­—ç¬¦ä¸²">62. å…¶ä»–ç±»åž‹æ›´åˆé€‚æ—¶ï¼Œåº”é¿å…ä½¿ç”¨å­—ç¬¦ä¸²&lt;/h2>
&lt;h3 id="-å»ºè®®-5">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± å½“å­˜åœ¨æˆ–å¯ä»¥ç¼–å†™æ›´å¥½çš„æ•°æ®ç±»åž‹æ—¶ï¼Œåº”é¿å…å°†å­—ç¬¦ä¸²ç”¨æ¥è¡¨ç¤ºå¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å¦‚æžœä½¿ç”¨ä¸å½“ï¼Œå­—ç¬¦ä¸²æ¯”å…¶ä»–ç±»åž‹æ›´éº»çƒ¦ã€çµæ´»æ€§æ›´å·®ã€é€Ÿåº¦æ›´æ…¢ã€æ›´å®¹æ˜“å‡ºé”™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿å…¶ä»–çš„å€¼ç±»åž‹ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° å¦‚æžœæ˜¯æ•°å€¼ç±»åž‹ï¼Œåˆ™åº”å°†å…¶è½¬æ¢ä¸ºé€‚å½“çš„æ•°å€¼ç±»åž‹ï¼Œå¦‚ &lt;code>int&lt;/code>ã€&lt;code>float&lt;/code> æˆ– &lt;code>BigInteger&lt;/code>ã€‚&lt;/li>
&lt;li>ðŸŒ° å¦‚æžœæ˜¯é—®é¢˜çš„ç­”æ¡ˆï¼Œå¦‚â€œæ˜¯â€æˆ–â€œå¦â€è¿™ç±»å½¢å¼ï¼Œåˆ™åº”å°†å…¶è½¬æ¢ä¸ºé€‚å½“çš„ &lt;code>Enum&lt;/code> æˆ– &lt;code>boolean&lt;/code>ã€‚&lt;/li>
&lt;li>ðŸŒ° æ›´ä¸€èˆ¬åœ°ï¼Œå¦‚æžœæœ‰åˆé€‚çš„å€¼ç±»åž‹ï¼Œæ— è®ºæ˜¯åŸºæœ¬ç±»åž‹è¿˜æ˜¯å¯¹è±¡å¼•ç”¨ï¼Œéƒ½åº”è¯¥ä½¿ç”¨å®ƒï¼›å¦‚æžœæ²¡æœ‰ï¼Œåº”è¯¥å†™ä¸€ä¸ªã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿æžšä¸¾ç±»åž‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿èšåˆç±»åž‹ã€‚&lt;/p>
&lt;p>å¦‚æžœä¸€ä¸ªå®žä½“æœ‰å¤šä¸ªç»„ä»¶ï¼Œå°†å…¶è¡¨ç¤ºä¸ºå•ä¸ªå­—ç¬¦ä¸²é€šå¸¸æ˜¯å¾ˆä¸åˆé€‚çš„ã€‚
ä¾‹å¦‚ï¼Œä¸‹é¢è¿™è¡Œä»£ç æ¥è‡ªä¸€ä¸ªçœŸå®žçš„ç³»ç»Ÿæ ‡è¯†ç¬¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">compoundKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">className&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;#&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ç§æ–¹æ³•æœ‰å¾ˆå¤šç¼ºç‚¹ï¼šå¦‚æžœç”¨äºŽåˆ†éš”å­—æ®µ &lt;code>#&lt;/code> çš„å­—ç¬¦å‡ºçŽ°åœ¨å…¶ä¸­ä¸€ä¸ªå­—æ®µä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ··ä¹±ã€‚è¦è®¿é—®å„ä¸ªå­—æ®µï¼Œä½ å¿…é¡»è§£æžå­—ç¬¦ä¸²ã€‚ä¸èƒ½æä¾› &lt;code>equals&lt;/code>ã€&lt;code>toString&lt;/code> æˆ– &lt;code>compareTo&lt;/code> æ–¹æ³•ï¼Œä½†å¿…é¡»æŽ¥å— &lt;code>String&lt;/code> æä¾›çš„è¡Œä¸ºã€‚
æ›´å¥½çš„æ–¹æ³•æ˜¯ç¼–å†™ä¸€ä¸ªç±»æ¥è¡¨ç¤ºèšåˆï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç§æœ‰é™æ€æˆå‘˜ç±»ã€‚ï¼ˆItem-24ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿ capabilities&lt;/p>
&lt;p>æœ‰æ—¶ï¼Œå­—ç¬¦ä¸²ç”¨äºŽæŽˆäºˆå¯¹æŸäº›åŠŸèƒ½çš„è®¿é—®æƒã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œè€ƒè™‘çº¿ç¨‹æœ¬åœ°å˜é‡æœºåˆ¶çš„è®¾è®¡ã€‚è¿™æ ·çš„æœºåˆ¶æä¾›äº†æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å˜é‡å€¼ã€‚
è¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºŽï¼šå­—ç¬¦ä¸²é”®è¡¨ç¤ºçº¿ç¨‹æœ¬åœ°å˜é‡çš„å…±äº«å…¨å±€åç§°ç©ºé—´ã€‚
ä¸ºäº†ä½¿è¿™ç§æ–¹æ³•æœ‰æ•ˆï¼Œå®¢æˆ·ç«¯æä¾›çš„å­—ç¬¦ä¸²é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼šå¦‚æžœä¸¤ä¸ªå®¢æˆ·ç«¯å„è‡ªå†³å®šä¸ºå®ƒä»¬çš„çº¿ç¨‹æœ¬åœ°å˜é‡ä½¿ç”¨ç›¸åŒçš„åç§°ï¼Œå®ƒä»¬æ— æ„ä¸­å°±ä¼šå…±äº«ä¸€ä¸ªå˜é‡ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´ä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½å¤±è´¥ã€‚
è€Œä¸”å®‰å…¨æ€§å¾ˆå·®ã€‚æ¶æ„å®¢æˆ·ç«¯å¯ä»¥æ•…æ„ä½¿ç”¨ä¸Žå¦ä¸€ä¸ªå®¢æˆ·ç«¯ç›¸åŒçš„å­—ç¬¦ä¸²å¯†é’¥æ¥éžæ³•è®¿é—®å¦ä¸€ä¸ªå®¢æˆ·ç«¯çš„æ•°æ®ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="63-å½“å¿ƒå­—ç¬¦ä¸²è¿žæŽ¥å¼•èµ·çš„æ€§èƒ½é—®é¢˜">63. å½“å¿ƒå­—ç¬¦ä¸²è¿žæŽ¥å¼•èµ·çš„æ€§èƒ½é—®é¢˜&lt;/h2>
&lt;h3 id="-å»ºè®®-6">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± ä¸è¦ä½¿ç”¨å­—ç¬¦ä¸²è¿žæŽ¥æ“ä½œç¬¦åˆå¹¶å¤šä¸ªå­—ç¬¦ä¸²ï¼Œé™¤éžæ€§èƒ½æ— å…³ç´§è¦ã€‚ä½¿ç”¨å­—ç¬¦ä¸²ä¸²è”è¿ç®—ç¬¦ &lt;code>+&lt;/code>ï¼Œé‡å¤ä¸²è” n ä¸ªå­—ç¬¦ä¸²ï¼Œéœ€è¦ n çš„å¹³æ–¹çº§æ—¶é—´ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ ä½¿ç”¨ &lt;code>StringBuilder&lt;/code> ä»£æ›¿ &lt;code>String&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="64-é€šè¿‡æŽ¥å£å¼•ç”¨å¯¹è±¡">64. é€šè¿‡æŽ¥å£å¼•ç”¨å¯¹è±¡&lt;/h2>
&lt;h3 id="-å»ºè®®-7">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ€ ä¼˜å…ˆä½¿ç”¨æŽ¥å£è€Œä¸æ˜¯ç±»æ¥å¼•ç”¨å¯¹è±¡ã€‚å¦‚æžœå­˜åœ¨åˆé€‚çš„æŽ¥å£ç±»åž‹ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨æŽ¥å£ç±»åž‹å£°æ˜Žå‚æ•°ã€è¿”å›žå€¼ã€å˜é‡å’Œå­—æ®µã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± ä½¿ç”¨æŽ¥å£ä½œä¸ºç±»åž‹çš„ä¹ æƒ¯ï¼Œç¨‹åºå°†æ›´åŠ çµæ´»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¥€ ä»¥ä¸‹æƒ…å†µä½¿ç”¨ ç±» æ¥å¼•ç”¨å¯¹è±¡ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° æ²¡æœ‰åˆé€‚çš„æŽ¥å£å­˜åœ¨
&lt;ul>
&lt;li>&lt;code>String&lt;/code> å’Œ &lt;code>BigInteger&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ðŸŒ° æ¡†æž¶çš„åŸºæœ¬ç±»åž‹æ˜¯ç±»ï¼Œä¸æ˜¯æŽ¥å£
&lt;ul>
&lt;li>&lt;code>java.io&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ðŸŒ° å®žçŽ°æŽ¥å£çš„ç±»æä¾›äº†æŽ¥å£ä¸­ä¸å­˜åœ¨çš„é¢å¤–æ–¹æ³•
&lt;ul>
&lt;li>&lt;code>PriorityQueue&lt;/code> ä¸­å®žçŽ°äº† &lt;code>Queue&lt;/code> ä¸å­˜åœ¨çš„ &lt;code>comparator&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-4">ðŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>ðŸŒ¾ ä¼˜å…ˆä½¿ç”¨æŽ¥å£ä½œä¸ºç±»åž‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Son&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">sonSet&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedHashSet&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™…&lt;/span>&lt;span class="n">â€&lt;/span>&lt;span class="err">â™‚&lt;/span>&lt;span class="n">ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">LinkedHashSet&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Son&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">sonSet&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedHashSet&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="65-æŽ¥å£ä¼˜å…ˆåå°„æœºåˆ¶">65. æŽ¥å£ä¼˜å…ˆåå°„æœºåˆ¶&lt;/h2>
&lt;h3 id="-å»ºè®®-8">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± æ ¸å¿ƒåå°„æœºåˆ¶ &lt;code>java.lang.reflect&lt;/code> æä¾›å¯¹ä»»æ„ç±»çš„ç¼–ç¨‹è®¿é—®ã€‚ç»™å®šä¸€ä¸ª Class å¯¹è±¡ï¼Œå¯ä»¥èŽ·å¾— &lt;code>Constructor&lt;/code>ã€&lt;code>Method&lt;/code>ã€&lt;code>Filed&lt;/code> å®žä¾‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± é€šè¿‡è¿‡è°ƒç”¨ &lt;code>Constructor&lt;/code>ã€&lt;code>Method&lt;/code>ã€&lt;code>Filed&lt;/code> å®žä¾‹ä¸Šçš„æ–¹æ³•ï¼Œå¯ä»¥æž„é€ åº•å±‚çš„å®žä¾‹ã€è°ƒç”¨åº•å±‚ç±»çš„æ–¹æ³•ã€è®¿é—®åº•å±‚ç±»ä¸­çš„å­—æ®µã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° &lt;code>Method.invoke()&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ¥€ åå°„å…è®¸ä¸€ä¸ªç±»ä½¿ç”¨å¦ä¸€ä¸ªç±»ï¼Œå³ä½¿åœ¨ç¼–è¯‘å‰è€…æ—¶åŽè€…å¹¶ä¸å­˜åœ¨ã€‚ç„¶è€Œï¼Œè¿™ç§èƒ½åŠ›æ˜¯æœ‰ä»£ä»·çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° å¤±åŽ»äº†ç¼–è¯‘æ—¶ç±»åž‹æ£€æŸ¥çš„æ‰€æœ‰å¥½å¤„ï¼ŒåŒ…æ‹¬å¼‚å¸¸æ£€æŸ¥ã€‚&lt;/li>
&lt;li>ðŸŒ° æ‰§è¡Œåå°„è®¿é—®æ‰€éœ€çš„ä»£ç æ—¢ç¬¨æ‹™åˆå†—é•¿ã€‚å†™èµ·æ¥å¾ˆä¹å‘³ï¼Œè¯»èµ·æ¥ä¹Ÿå¾ˆå›°éš¾ã€‚&lt;/li>
&lt;li>ðŸŒ° æ€§èƒ½é™ä½Žã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å¦‚æžœä½ å¯¹åº”ç”¨ç¨‹åºæ˜¯å¦éœ€è¦åå°„æœ‰ä»»ä½•ç–‘é—®ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¸éœ€è¦ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å¦‚æžœå¿…é¡»ç”¨åˆ°åœ¨ç¼–è¯‘æ—¶æ— æ³•èŽ·å–çš„ç±»ï¼Œåœ¨ç¼–è¯‘æ—¶å­˜åœ¨ä¸€ä¸ªé€‚å½“çš„æŽ¥å£æˆ–è¶…ç±»æ¥ï¼Œå¯ä»¥ç”¨åå°„æ–¹å¼åˆ›å»ºå®žä¾‹ï¼Œå¹¶é€šè¿‡å®ƒä»¬çš„æŽ¥å£æˆ–è¶…ç±»æ­£å¸¸åœ°è®¿é—®å®ƒä»¬ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Translate the class name into a Class object
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">cl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">cl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forNmae&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">])&lt;/span> &lt;span class="c1">// Unchecked cast
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ClassNotFoundException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Class not found.&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Get the constructor
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Constructor&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">cons&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cons&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredConstructor&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">NoSuchMethodException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;No parameterless constructor&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Instantiate the set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// ðŸ™‹â€â™‚ï¸ use interface
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cons&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">IllegalAccessException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Constructor not accessible&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InstantiationException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Class not instantiable.&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InvocationTargetException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Constructor threw &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCause&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ClassCastException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Class doesn&amp;#39;t implement Set&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Exercise the set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">addAll&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">subList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸ¥€ ä¸Šä¾‹ä¸­åå°„æœºåˆ¶çš„ç¼ºç‚¹&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° äº§ç”Ÿ 6 ä¸ªè¿è¡Œæ—¶å¼‚å¸¸&lt;/li>
&lt;li>ðŸŒ° æ ¹æ®ç±»åç”Ÿäº§å®žä¾‹éœ€è¦ 25 è¡Œå†—é•¿ä»£ç ï¼Œè€Œè°ƒç”¨æž„é€ å™¨åªéœ€è¦ä¸€è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± åå°„çš„åˆæ³•ç”¨é€”ï¼ˆå¾ˆå°‘ï¼‰æ˜¯ç®¡ç†ç±»å¯¹è¿è¡Œæ—¶å¯èƒ½ä¸å­˜åœ¨çš„å…¶ä»–ç±»ã€æ–¹æ³•æˆ–å­—æ®µçš„ä¾èµ–å…³ç³»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å¦‚æžœç¼–å†™çš„ç¨‹åºå¿…é¡»åœ¨ç¼–è¯‘æ—¶å¤„ç†æœªçŸ¥çš„ç±»ï¼Œåˆ™åº”è¯¥å°½å¯èƒ½åªä½¿ç”¨åå°„å®žä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨åœ¨ç¼–è¯‘æ—¶å·²çŸ¥çš„æŽ¥å£æˆ–è¶…ç±»è®¿é—®å¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="66-è°¨æ…Žåœ°ä½¿ç”¨æœ¬åœ°æ–¹æ³•">66. è°¨æ…Žåœ°ä½¿ç”¨æœ¬åœ°æ–¹æ³•&lt;/h2>
&lt;h3 id="-å»ºè®®-9">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>ðŸŒ± éžå¸¸ä¸å»ºè®®ä½¿ç”¨æœ¬åœ°æ–¹æ³•ã€‚JVM å˜å¾—æ›´å¿«äº†ï¼Œå¹¶ä¸” Java å¹³å°çš„æˆç†Ÿï¼Œå®ƒæä¾›äº†å¯¹è®¸å¤šä»¥å‰åªèƒ½åœ¨å®¿ä¸»å¹³å°ä¸­ä¸Šæ‰¾åˆ°çš„ç‰¹æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>ä¾‹å¦‚ï¼ŒJava 9 ä¸­æ·»åŠ çš„æµ API æä¾›äº†å¯¹ OS æµç¨‹çš„è®¿é—®ã€‚&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>ðŸ¥€ ä½¿ç”¨æœ¬åœ°æ–¹æ³•æœ‰ä¸¥é‡çš„ç¼ºç‚¹ï¼š
&lt;ul>
&lt;li>ðŸŒ° æœ¬åœ°è¯­è¨€ä¸å®‰å…¨ï¼ˆItem-50ï¼‰ï¼Œä½¿ç”¨æœ¬åœ°æ–¹æ³•çš„åº”ç”¨ç¨‹åºä¸å†èƒ½å…å—å†…å­˜æ¯åé”™è¯¯çš„å½±å“ã€‚&lt;/li>
&lt;li>ðŸŒ° Java æ›´ä¾èµ–äºŽå¹³å°ï¼Œå› æ­¤ä½¿ç”¨æœ¬åœ°æ–¹æ³•çš„ç¨‹åºçš„å¯ç§»æ¤æ€§è¾ƒå·®ã€‚&lt;/li>
&lt;li>ðŸŒ° å®ƒä»¬æ›´éš¾è°ƒè¯•ã€‚&lt;/li>
&lt;li>ðŸŒ° å¦‚æžœä¸å°å¿ƒï¼Œæœ¬åœ°æ–¹æ³•å¯èƒ½ä¼šé™ä½Žæ€§èƒ½ï¼Œå› ä¸ºåžƒåœ¾æ”¶é›†å™¨æ— æ³•è‡ªåŠ¨è·Ÿè¸ªæœ¬åœ°å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œè€Œä¸”è¿›å‡ºæœ¬åœ°ä»£ç ä¼šäº§ç”Ÿç›¸å…³çš„æˆæœ¬ã€‚&lt;/li>
&lt;li>ðŸŒ° æœ¬åœ°æ–¹æ³•éœ€è¦â€œç²˜åˆä»£ç â€ï¼Œè¿™å¾ˆéš¾é˜…è¯»ï¼Œè€Œä¸”ç¼–å†™èµ·æ¥å¾ˆä¹å‘³ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="67-è°¨æ…Žåœ°è¿›è¡Œä¼˜åŒ–">67. è°¨æ…Žåœ°è¿›è¡Œä¼˜åŒ–&lt;/h2>
&lt;h3 id="-å»ºè®®-10">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ€ ä¼˜åŒ–å¼Šå¤§äºŽåˆ©ï¼Œå°¤å…¶æ˜¯å¦‚æžœè¿‡æ—©åœ°è¿›è¡Œä¼˜åŒ–ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šç”Ÿæˆæ—¢ä¸å¿«é€Ÿä¹Ÿä¸æ­£ç¡®ä¸”æ— æ³•è½»æ¾ä¿®å¤çš„è½¯ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ ä¸è¦ä¸ºäº†æ€§èƒ½è€Œç‰ºç‰²åˆç†çš„æž¶æž„ã€‚åŠªåŠ›ç¼–å†™å¥½çš„ç¨‹åºï¼Œè€Œä¸æ˜¯å¿«é€Ÿçš„ç¨‹åºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å¥½çš„ç¨‹åºä½“çŽ°äº†ä¿¡æ¯éšè—çš„åŽŸåˆ™ï¼šåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬åœ¨å•ä¸ªç»„ä»¶ä¸­æœ¬åœ°åŒ–è®¾è®¡å†³ç­–ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸å½±å“ç³»ç»Ÿå…¶ä½™éƒ¨åˆ†çš„æƒ…å†µä¸‹æ›´æ”¹å•ä¸ªå†³ç­–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ ä¸ä¼˜åŒ–ä¸æ„å‘³ç€åœ¨ç¨‹åºå®Œæˆä¹‹å‰å¯ä»¥å¿½ç•¥æ€§èƒ½é—®é¢˜ã€‚å®žçŽ°ä¸Šçš„é—®é¢˜å¯ä»¥é€šè¿‡ä»¥åŽçš„ä¼˜åŒ–æ¥è§£å†³ï¼Œä½†æ˜¯å¯¹äºŽæž¶æž„ç¼ºé™·ï¼Œå¦‚æžœä¸é‡å†™ç³»ç»Ÿï¼Œå°±ä¸å¯èƒ½è§£å†³é™åˆ¶æ€§èƒ½çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾è®¡APIã€çº¿è·¯å±‚åè®®å’ŒæŒä¹…æ•°æ®æ ¼å¼æ—¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å†å¤šçš„åº•å±‚ä¼˜åŒ–ä¹Ÿä¸èƒ½å¼¥è¡¥ç®—æ³•é€‰æ‹©çš„ä¸è¶³ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="68-éµå®ˆè¢«å¹¿æ³›è®¤å¯çš„å‘½åçº¦å®š">68. éµå®ˆè¢«å¹¿æ³›è®¤å¯çš„å‘½åçº¦å®š&lt;/h2>
&lt;h3 id="-å»ºè®®-11">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± Java å¹³å°æœ‰ä¸€ç»„å®Œå–„çš„å‘½åçº¦å®šï¼Œå…¶ä¸­è®¸å¤šçº¦å®šåŒ…å«åœ¨ã€ŠThe Java Language Specificationã€‹&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° typographical å­—é¢çº¦å®š&lt;/li>
&lt;li>ðŸŒ° grammatical è¯­æ³•çº¦å®š&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å­—é¢æƒ¯ä¾‹ç¤ºä¾‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">&lt;strong>Identifier Type&lt;/strong>&lt;/th>
&lt;th style="text-align:center">&lt;strong>Example&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">Package or module&lt;/td>
&lt;td style="text-align:center">&lt;code>org.junit.jupiter.api&lt;/code>, &lt;code>com.google.common.collect&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Class or Interface&lt;/td>
&lt;td style="text-align:center">&lt;code>Stream&lt;/code>, &lt;code>FutureTask&lt;/code>, &lt;code>LinkedHashMap&lt;/code>, &lt;code>HttpClient&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Method or Field&lt;/td>
&lt;td style="text-align:center">&lt;code>remove()&lt;/code>, &lt;code>groupingBy()&lt;/code>, &lt;code>getCrc()&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Constant Field&lt;/td>
&lt;td style="text-align:center">MIN_VALUE, NEGATIVE_INFINITY&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Local Variable&lt;/td>
&lt;td style="text-align:center">i, denom, houseNum&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Type Parameter&lt;/td>
&lt;td style="text-align:center">T, E, K, V, X, R, U, V, T1, T2&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± è¯­æ³•å‘½åçº¦å®šæ¯”æŽ’ç‰ˆçº¦å®šæ›´çµæ´»ï¼Œä¹Ÿæ›´æœ‰äº‰è®®ã€‚&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Long Shorter Term Memory</title><link>https://www.letout.cn/p/nlp-in-action/long-short-term-memory/</link><pubDate>Sat, 19 Mar 2022 20:36:14 +0800</pubDate><guid>https://www.letout.cn/p/nlp-in-action/long-short-term-memory/</guid><description>&lt;img src="https://nlp.letout.cn/img/banner.png" alt="Featured image of post Long Shorter Term Memory" />&lt;hr>
&lt;p>&lt;a class="link" href="https://nlp.letout.cn/nlp/long-short-term-memory" target="_blank" rel="noopener"
>ðŸš² è½¬åˆ° https://nlp.letout.cn ðŸ”” Long Shorter Term Memory âž¡ï¸&lt;/a>&lt;/p>
&lt;hr>
&lt;p>è¿™ä¸€èŠ‚ï¼Œå°†ä»‹ç» &lt;code>LSTM (Long Shorter Term Memory)&lt;/code>ï¼Œä»¥åŠç”¨ &lt;code>pytorch&lt;/code> å®žçŽ° &lt;code>LSTM &lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> æ˜¯ä¸€ç§ &lt;code>RNN&lt;/code> æ¨¡åž‹ï¼Œæ˜¯å¯¹ &lt;code>simple RNN&lt;/code> çš„æ”¹è¿›ï¼Œ&lt;code>LSTM&lt;/code> å¯ä»¥é¿å…æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼Œå¯ä»¥æœ‰æ›´é•¿çš„è®°å¿†ã€‚&lt;code>LSTM&lt;/code> çš„è®ºæ–‡åœ¨ 1997 å¹´å‘è¡¨ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Hochreiter and Schmidhuber. Long short-term memory. Neural computation, 1997.&lt;/p>
&lt;/blockquote>
&lt;h2 id="-lstm">ðŸ”– LSTM&lt;/h2>
&lt;p>&lt;code>LSTM&lt;/code> ä¹Ÿæ˜¯ä¸€ç§å¾ªçŽ¯ç¥žç»ç½‘ç»œï¼ŒåŽŸç†è·Ÿ &lt;code>simple RNN&lt;/code> å·®ä¸å¤šï¼Œæ¯å½“è¯»å–ä¸€ä¸ªæ–°çš„è¾“å…¥ $x$ï¼Œå°±ä¼šæ›´æ–°çŠ¶æ€ $h$ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/1.png"
loading="lazy"
alt="1"
>&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> çš„ç»“æž„æ¯” &lt;code>simple RNN&lt;/code> è¦å¤æ‚å¾ˆå¤šï¼Œ&lt;code>simple RNN&lt;/code> åªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µï¼Œ &lt;code>LSTM&lt;/code> æœ‰å››ä¸ªå‚æ•°çŸ©é˜µã€‚æŽ¥ä¸‹æ¥æˆ‘ä»¬å…·ä½“æ¥çœ‹çœ‹ &lt;code>LSTM&lt;/code> çš„å†…éƒ¨ç»“æž„ã€‚&lt;/p>
&lt;h3 id="-ä¼ é€å¸¦">ðŸš  ä¼ é€å¸¦&lt;/h3>
&lt;p>&lt;code>LSTM&lt;/code> æœ€é‡è¦çš„è®¾è®¡æ˜¯è¿™ä¸ªä¼ é€å¸¦ &lt;code>Conveyor belt&lt;/code>ï¼Œå³ä¸ºå‘é‡ $C$ã€‚è¿‡åŽ»çš„ä¿¡æ¯é€šè¿‡ä¼ é€å¸¦ï¼Œç›´æŽ¥é€åˆ°ä¸‹ä¸€ä¸ªæ—¶åˆ»ï¼Œä¸ä¼šå‘ç”Ÿå¤ªå¤§çš„å˜åŒ–ã€‚&lt;code>LSTM&lt;/code> å°±æ˜¯é ä¼ é€å¸¦æ¥é¿å…æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/2.png"
loading="lazy"
alt="2"
>&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> ä¸­æœ‰å¾ˆå¤šä¸ªé—¨ &lt;code>gate&lt;/code>ï¼Œå¯ä»¥æœ‰é€‰æ‹©çš„è®©ä¿¡æ¯é€šè¿‡ã€‚&lt;/p>
&lt;h3 id="-forgate-gate">ðŸšª Forgate Gate&lt;/h3>
&lt;p>é¦–å…ˆä»‹ç» &lt;code>forget gate&lt;/code> é—å¿˜é—¨ã€‚é—å¿˜é—¨ç”± â˜˜ï¸ &lt;code>sigmoid&lt;/code> å‡½æ•°ï¼Œå’Œ ðŸ€ å…ƒç´ ç§¯ &lt;code>element wise multiplication&lt;/code> ä¸¤éƒ¨åˆ†ç»„æˆã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;p>ðŸŒ¼ è¾“å…¥ &lt;code>sigmoid&lt;/code> çš„æ˜¯ä¸€ä¸ªå‘é‡ $a$ï¼Œ&lt;code>sigmoid&lt;/code> ä½œç”¨åˆ°å‘é‡ $a$ çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼ŒæŠŠæ¯ä¸€ä¸ªå…ƒç´ éƒ½åŽ‹åˆ° &lt;code>0&lt;/code> å’Œ &lt;code>1&lt;/code> ä¹‹é—´ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚å‘é‡ $a$ æ˜¯ï¼š&lt;code>[1, 3, 0, -2]&lt;/code>ï¼Œé‚£ä¹ˆï¼Œ&lt;code>sigmoid&lt;/code> å‡½æ•°å°†åˆ†åˆ«ä½œç”¨åœ¨è¿™å››ä¸ªå…ƒç´ ä¸Šã€‚ç„¶åŽåˆ†åˆ«è¾“å‡ºï¼š&lt;code>[0.73, 0.95, 0.5, 0.12]&lt;/code> ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/4.png"
loading="lazy"
alt="4"
>&lt;/p>
&lt;p>è¾“å…¥çš„å‘é‡ $a$ï¼Œä¸Žè¾“å‡ºçš„å‘é‡ $f$ åº”è¯¥æœ‰ç›¸åŒçš„ç»´åº¦ï¼Œè¿™ä¸ªä¾‹å­é‡Œï¼Œå‘é‡ $a$ æ˜¯å››ç»´çš„ï¼Œå‘é‡ $f$ ä¹Ÿä¼šæ˜¯å››ç»´çš„ã€‚&lt;/p>
&lt;p>ðŸŒ¸ ç®—å‡º $f$ å‘é‡ä¹‹åŽï¼Œè®¡ç®—ä¼ é€å¸¦å‘é‡ $c$ ä¸Žé—å¿˜é—¨å‘é‡ $f$ çš„å…ƒç´ ç§¯ã€‚å…ƒç´ ç§¯ &lt;code>element wise multiplication&lt;/code> æ˜¯è¿™æ ·ç®—çš„ï¼š&lt;/p>
&lt;p>$c$ å’Œ $f$ éƒ½æ˜¯å››ç»´çš„å‘é‡ï¼Œå°†å®ƒä»¬çš„æ¯ä¸€ä¸ªå…ƒç´ åˆ†åˆ«ç›¸ä¹˜ã€‚æ‰€ä»¥å…ƒç´ ç§¯çš„ç»“æžœä¹Ÿæ˜¯ä¸ªå››ç»´çš„å‘é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/5.png"
loading="lazy"
alt="5"
>&lt;/p>
&lt;p>è¿™ä¸ªé—å¿˜é—¨ $f$ï¼Œæœ‰é€‰æ‹©çš„è®©ä¼ é€å¸¦ $c$ çš„å€¼é€šè¿‡ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ° å‡å¦‚ $f$ çš„ä¸€ä¸ªå…ƒç´ æ˜¯ $0$ï¼Œé‚£ä¹ˆ $c$ å¯¹åº”çš„å…ƒç´ ä¸èƒ½é€šè¿‡ï¼Œå¯¹åº”çš„è¾“å‡ºæ˜¯ $0$ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ° å‡å¦‚ $f$ çš„ä¸€ä¸ªå…ƒç´ æ˜¯ $1$ï¼Œé‚£ä¹ˆ $c$ å¯¹åº”çš„å…ƒç´ å°±å…¨éƒ¨é€šè¿‡ï¼Œå¯¹åº”çš„è¾“å‡ºæ˜¯ $c$ æœ¬èº«ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>é—å¿˜é—¨ $f$ å…·ä½“æ˜¯è¿™ä¹ˆç®—å‡ºæ¥çš„ï¼šé¦–å…ˆçœ‹è¿™å¼ ç»“æž„å›¾ï¼Œ$f_t$ æ˜¯ä¸Šä¸€ä¸ªçŠ¶æ€ $h_{t-1}$ï¼Œä¸Žå½“å‰è¾“å…¥ $x$ çš„å‡½æ•°ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/6.png"
loading="lazy"
alt="6"
>&lt;/p>
&lt;p>æŠŠçŠ¶æ€ $h_{t-1}$ ä¸Žè¾“å…¥ $x_t$ åšæ‹¼æŽ¥ &lt;code>concatnation&lt;/code>ï¼Œå¾—åˆ°æ›´é«˜ç»´åº¦çš„å‘é‡ã€‚ç„¶åŽè®¡ç®—çŸ©é˜µ $w_f$ ä¸Žè¿™ä¸ªå‘é‡çš„ä¹˜ç§¯ï¼Œå¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œå†ç”¨ &lt;code>sigmoid&lt;/code> å‡½æ•°ï¼Œå¾—åˆ°å‘é‡ $f_t$ï¼Œ$f_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä»‹äºŽ &lt;code>0&lt;/code> å’Œ &lt;code>1&lt;/code> ä¹‹é—´ï¼Œé—å¿˜é—¨æœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µ $w_f$ï¼Œéœ€è¦é€šè¿‡ &lt;strong>åå‘ä¼ æ’­&lt;/strong> ä»Žè®­ç»ƒæ•°æ®é‡Œå­¦ä¹ ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;h3 id="-input-gate">ðŸšª Input Gate&lt;/h3>
&lt;p>åˆšæ‰è®²äº†é—å¿˜é—¨ï¼ŒçŽ°åœ¨æ¥çœ‹ä¸€çœ‹ &lt;code>input gate&lt;/code> è¾“å…¥é—¨ã€‚åœ¨è¿™å¼ ç»“æž„å›¾é‡Œï¼Œè¾“å…¥é—¨ $i_t$ï¼Œä¾èµ–äºŽæ—§çš„çŠ¶æ€å‘é‡ $h_{t-1}$ï¼Œå’Œæ–°çš„è¾“å…¥ $x_t$ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>è¾“å…¥é—¨ $i_t$ çš„è®¡ç®—ç±»ä¼¼äºŽé—å¿˜é—¨ï¼ŒæŠŠæ—§çš„çŠ¶æ€ $h_{t-1}$ï¼Œä¸Žæ–°çš„è¾“å…¥ $x_t$ åšæ‹¼æŽ¥ &lt;code>concatnation&lt;/code>ï¼Œå¾—åˆ°æ›´é«˜ç»´çš„å‘é‡ã€‚&lt;/p>
&lt;p>ç„¶åŽè®¡ç®—çŸ©é˜µ $w_i$ ä¸Žè¿™ä¸ªå‘é‡çš„ä¹˜ç§¯å¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œæœ€åŽä½¿ç”¨æ¿€æ´»å‡½æ•° &lt;code>sigmod&lt;/code>ï¼Œå¾—åˆ°å‘é‡ $i_t$ï¼ˆ$i_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä»‹äºŽ $0$ å’Œ $1$ ä¹‹é—´ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/9.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>è¾“å…¥é—¨ä¹Ÿæœ‰è‡ªå·±çš„å‚æ•°çŸ©é˜µï¼Œè®¡ä½œ $W_i$ï¼Œ$W_i$ ä¹Ÿéœ€è¦ä»Žè®­ç»ƒæ•°æ®ä¸­å­¦ä¹ ã€‚&lt;/p>
&lt;h3 id="-new-value">ðŸ†• New Value&lt;/h3>
&lt;p>è¿˜éœ€è¦è®¡ç®—æ–°çš„è¾“å…¥å€¼ &lt;code>new value&lt;/code> $\widetilde{c}_t$ï¼Œ$\widetilde{c}_t$ æ˜¯ä¸ªå‘é‡ï¼Œè®¡ç®—æ–¹æ³•è·Ÿé—å¿˜é—¨å’Œè¾“å…¥é—¨éƒ½å¾ˆåƒã€‚ä¹Ÿæ˜¯æŠŠæ—§çŠ¶æ€ $h_{t-1}$ï¼Œä¸Žæ–°è¾“å…¥ $x_t$ åšæ‹¼æŽ¥ï¼Œå†ä¹˜åˆ°å‚æ•°çŸ©é˜µä¸Šã€‚&lt;/p>
&lt;p>åŒºåˆ«åœ¨äºŽæ¿€æ´»å‡½æ•°ä¸æ˜¯ &lt;code>sigmoid&lt;/code>ï¼Œè€Œæ˜¯åŒæ›²æ­£åˆ‡å‡½æ•° &lt;code>tanh&lt;/code>ï¼Œæ‰€ä»¥ç®—å‡ºçš„å‘é‡ $\widetilde{c}_t$ çš„å…ƒç´ éƒ½ä»‹äºŽ &lt;code>(-1, +1)&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/10.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>è®¡ç®— &lt;code>new value&lt;/code> $\widetilde{c}_t$ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªå•ç‹¬çš„å‚æ•°çŸ©é˜µçŸ©é˜µ $w_c$ã€‚&lt;/p>
&lt;h3 id="-æ›´æ–°-ä¼ è¾“å¸¦">ðŸš‚ æ›´æ–° ä¼ è¾“å¸¦&lt;/h3>
&lt;p>æˆ‘ä»¬å·²ç»ç®—å‡ºäº†é—å¿˜é—¨ $f_t$ï¼Œè¾“å…¥é—¨ $i_t$ï¼Œä»¥åŠæ–°çš„è¾“å…¥å€¼ $\widetilde{c}_t$ï¼Œæˆ‘ä»¬è¿˜çŸ¥é“ä¼ é€å¸¦æ—§çš„å€¼ $c_{t-1}$ï¼ŒçŽ°åœ¨å¯ä»¥æ›´æ–°ä¼ é€å¸¦ $c$ äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/11.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>1ï¸âƒ£ è®¡ç®—é—å¿˜é—¨ $f_t$ å’Œä¼ é€å¸¦æ—§çš„å€¼ $c_{t-1}$ çš„å…ƒç´ ç§¯ã€‚&lt;/p>
&lt;p>é—å¿˜é—¨ $f_t$ï¼Œå’Œä¼ é€å¸¦ $c_{t-1}$ æ˜¯ç»´åº¦ç›¸åŒçš„å‘é‡ï¼Œç®—å‡ºçš„ä¹˜ç§¯ä¹Ÿæ˜¯ä¸ªå‘é‡ã€‚é—å¿˜é—¨ $f_t$ï¼Œå¯ä»¥é€‰æ‹©æ€§çš„é—å¿˜ $c_{t-1}$ ä¸­çš„ä¸€äº›å…ƒç´ ï¼Œå¦‚æžœ $f_t$ ä¸­çš„ä¸€ä¸ªå…ƒç´ æ˜¯ $0$ï¼Œé‚£ä¹ˆ $c_{t-1}$ ç›¸åº”çš„å…ƒç´ å°±ä¼šè¢«é—å¿˜ã€‚&lt;/p>
&lt;p>ä¸Šä¸€æ­¥é€šè¿‡ ðŸšª é—å¿˜é—¨ é€‰æ‹©æ€§åˆ é™¤æŽ‰äº†ä¼ é€å¸¦ $c_{t-1}$ çš„ä¸€äº›å…ƒç´ ï¼ŒçŽ°åœ¨è¦å¾€ä¼ é€å¸¦ä¸Šæ·»åŠ æ–°çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>2ï¸âƒ£ è®¡ç®—è¾“å…¥é—¨ $i_t$ï¼Œå’Œæ–°çš„è¾“å…¥å€¼ $\widetilde{c}_t$ çš„å…ƒç´ ç§¯ã€‚&lt;/p>
&lt;p>è¾“å…¥é—¨ $i_t$ å’Œæ–°çš„å€¼ $\widetilde{c}_t$ éƒ½æ˜¯ç»´åº¦ç›¸åŒçš„å‘é‡ï¼Œä»–ä»¬çš„ä¹˜ç§¯ä¹Ÿæ˜¯ç»´åº¦ç›¸åŒçš„å‘é‡ï¼ŒæŠŠä¹˜ç§¯åŠ åˆ°ä¼ é€å¸¦ä¸Šï¼Œè¿™æ ·å°±å®Œæˆäº†å¯¹ä¼ é€å¸¦çš„ä¸€è½®æ›´æ–°ã€‚&lt;/p>
&lt;p>ç”¨é—å¿˜é—¨åˆ é™¤äº†ä¼ é€å¸¦ä¸Šçš„ä¸€äº›ä¿¡æ¯ï¼Œç„¶åŽç”¨é—å¿˜é—¨è¾“å…¥åŠ å…¥æ–°çš„ä¿¡æ¯ï¼Œå¾—åˆ°äº†ä¼ é€å¸¦æ–°çš„å€¼ $c_t$ï¼Œåˆ°çŽ°åœ¨ï¼Œå·²ç»æ›´æ–°å®Œä¼ é€å¸¦ $c$ ã€‚&lt;/p>
&lt;h3 id="-output-gate">ðŸšª Output Gate&lt;/h3>
&lt;p>æœ€åŽä¸€æ­¥æ˜¯è®¡ç®— &lt;code>LSTM&lt;/code> çš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯çŠ¶æ€å‘é‡ $h_t$ã€‚&lt;/p>
&lt;p>$h_t$ æ˜¯è¿™ä¹ˆè®¡ç®—çš„ï¼šé¦–å…ˆè®¡ç®—è¾“å‡ºé—¨ $o_t$ï¼Œè¾“å‡ºé—¨ $o_t$ è·Ÿå‰é¢çš„é—å¿˜é—¨ï¼Œè¾“å…¥é—¨çš„è®¡ç®—åŸºæœ¬ä¸€æ ·ã€‚&lt;/p>
&lt;p>æŠŠæ—§çš„çŠ¶æ€ $h_{t-1}$ï¼Œä¸Žæ–°çš„è¾“å…¥ $x_t$ åšæ‹¼æŽ¥ï¼Œå¾—åˆ°æ›´é«˜ç»´çš„å‘é‡ï¼Œç„¶åŽç®—çŸ©é˜µ $W_o$ ä¸Žè¿™ä¸ªå‘é‡çš„ä¹˜ç§¯ï¼Œå¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œæœ€åŽä½¿ç”¨æ¿€æ´»å‡½æ•° &lt;code>sigmod&lt;/code> å¾—åˆ°å‘é‡ $o_t$ã€‚$o_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä»‹äºŽ &lt;code>(0, 1)&lt;/code>ï¼Œè¾“å‡ºé—¨ä¹Ÿæœ‰è‡ªå·±çš„å‚æ•°å‘é‡ $W_o$ï¼Œ$W_o$ ä¹Ÿéœ€è¦ä»Žè®­ç»ƒæ•°æ®ä¸­å­¦ä¹ ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/12.png"
loading="lazy"
alt="12"
>&lt;/p>
&lt;p>çŽ°åœ¨è®¡ç®—çŠ¶æ€å‘é‡ $h_t$ï¼Œå¯¹ä¼ é€å¸¦ $c_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ æ±‚åŒæ›²æ­£åˆ‡&lt;code>tanh&lt;/code>ï¼ŒæŠŠå…ƒç´ å…¨éƒ½åŽ‹åˆ° &lt;code>(-1, +1)&lt;/code> åŒºé—´ã€‚&lt;/p>
&lt;p>ç„¶åŽï¼Œæ±‚è¿™ä¸¤ä¸ªå‘é‡çš„å…ƒç´ ç§¯ï¼Œè¿™ä¸ªçº¢è‰²å‘é‡æ˜¯åˆšåˆšæ±‚å‡ºçš„è¾“å‡ºé—¨ $o_t$ï¼Œè¿™æ ·å°±å¾—åˆ°äº†çŠ¶æ€å‘é‡ $h_t$ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/13.png"
loading="lazy"
alt="13"
>&lt;/p>
&lt;p>çœ‹ä¸€ä¸‹ç»“æž„å›¾ï¼Œ$h_t$ ä»–æœ‰ä¸¤ä»½ &lt;code>copys&lt;/code>ï¼Œ$h_t$ çš„ä¸€ä»½ &lt;code>copy&lt;/code> ä¼ è¾“åˆ°äº†ä¸‹ä¸€æ­¥ï¼Œå¦ä¸€ä»½ &lt;code>copy&lt;/code> æˆäº† &lt;code>LSTM&lt;/code> çš„è¾“å‡ºã€‚&lt;/p>
&lt;p>åˆ°ç¬¬ &lt;code>t&lt;/code> æ­¥ä¸ºæ­¢ï¼Œä¸€å…±æœ‰ &lt;code>t&lt;/code> ä¸ªå‘é‡ $x$ è¢«è¾“å…¥äº† &lt;code>LSTM&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ‰€æœ‰è¿™äº› $x$ å‘é‡çš„ä¿¡æ¯ï¼Œéƒ½ç§¯ç´¯åœ¨äº†çŠ¶æ€ $h_t$ é‡Œé¢ã€‚&lt;/p>
&lt;h2 id="-lstm-çš„å‚æ•°æ•°é‡">ðŸ§® LSTM çš„å‚æ•°æ•°é‡&lt;/h2>
&lt;p>æˆ‘ä»¬æ¥ç®—ä¸€ä¸‹ &lt;code>LSTM&lt;/code> çš„å‚æ•°æ•°é‡ï¼Œ&lt;code>LSTM&lt;/code> æœ‰ â¶ é—å¿˜é—¨ï¼›â· è¾“å…¥é—¨ï¼›â¸ æ–°çš„è¾“å…¥ï¼›â¹ è¾“å‡ºé—¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/14.png"
loading="lazy"
alt="14"
>&lt;/p>
&lt;p>è¿™å››ä¸ªæ¨¡å—éƒ½æœ‰å„è‡ªçš„å‚æ•°çŸ©é˜µ $w$ï¼Œæ‰€ä»¥ä¸€å…±æœ‰ &lt;code>4&lt;/code> ä¸ªå‚æ•°çŸ©é˜µï¼ŒçŸ©é˜µçš„è¡Œæ•°æ˜¯ï¼š$shape(h)$ï¼Œåˆ—æ•°æ˜¯ï¼š $shape(h)+shape(x)$&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œ&lt;code>LSTM&lt;/code> å‚æ•°çš„æ•°é‡æ˜¯ï¼š&lt;/p>
&lt;p>$4 * shape(h) * [ shape(h) + shape(x)]$&lt;/p>
&lt;h2 id="-å®žçŽ°-lstm">ðŸ›  å®žçŽ° LSTM&lt;/h2>
&lt;p>&lt;strong>Doing&lt;/strong>&lt;/p>
&lt;h2 id="-æ€»ç»“">ðŸŽ æ€»ç»“&lt;/h2>
&lt;p>æ€»ç»“ä¸€ä¸‹è¿™ä¸€èŠ‚çš„å†…å®¹ï¼Œè¿™èŠ‚ä»‹ç»äº† &lt;code>LSTM&lt;/code> æ¨¡åž‹å’Œç”¨ &lt;code>PyTorch&lt;/code> çš„å®žçŽ°ã€‚&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> å’Œ &lt;code>simple RNN&lt;/code> ä¸»è¦çš„åŒºåˆ«ï¼Œæ˜¯ç”¨äº†ä¸€æ¡ä¼ é€å¸¦ï¼Œè®©è¿‡åŽ»çš„ä¿¡æ¯å¯ä»¥å¾ˆå®¹æ˜“ä¼ è¾“åˆ°ä¸‹ä¸€æ—¶åˆ»ï¼Œè¿™æ ·å°±æœ‰äº†æ›´é•¿çš„è®°å¿†ã€‚&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> çš„è¡¨çŽ°æ€»æ˜¯æ¯” &lt;code>simple RNN&lt;/code> è¦å¥½ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æƒ³ä½¿ç”¨ &lt;code>RNN&lt;/code> çš„æ—¶å€™å°±ç”¨ ðŸ™‹â€â™‚ï¸ &lt;code>LSTM&lt;/code> æ¨¡åž‹ï¼Œè€Œä¸è¦ç”¨ ðŸ™…â€â™‚ï¸ &lt;code>simple RNN&lt;/code> æ¨¡åž‹ã€‚&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> æœ‰å››ä¸ªç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸšª &lt;code>Forget Gate&lt;/code> é—å¿˜é—¨&lt;/li>
&lt;li>ðŸšª &lt;code>Input Gate&lt;/code> è¾“å…¥é—¨&lt;/li>
&lt;li>ðŸ†• &lt;code>New Value&lt;/code> æ–°çš„è¾“å…¥&lt;/li>
&lt;li>ðŸšª &lt;code>Output Gate&lt;/code> è¾“å‡ºé—¨&lt;/li>
&lt;/ul>
&lt;p>è¿™å››ä¸ªç»„ä»¶å„è‡ªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µï¼Œæ‰€ä»¥ä¸€å…±æœ‰å››ä¸ªå‚æ•°çŸ©é˜µï¼Œ&lt;code>LSTM&lt;/code> å‚æ•°çš„æ•°é‡æ˜¯ï¼š&lt;/p>
&lt;p>$4 * shape(h) * [ shape(h) + shape(x)]$&lt;/p>
&lt;p>ä¸‹ä¸€èŠ‚å°†ä»‹ç»ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>stacked RNN&lt;/code>&lt;/li>
&lt;li>&lt;code>bi-directional RNN&lt;/code>&lt;/li>
&lt;li>é¢„è®­ç»ƒ&lt;/li>
&lt;/ul>
&lt;h2 id="-å‚è€ƒ">â›“ å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>ðŸ”— &lt;a class="link" href="https://github.com/wangshusen/DeepLearning/blob/master/Slides/9_RNN_3.pdf" target="_blank" rel="noopener"
>https://github.com/wangshusen/DeepLearning/blob/master/Slides/9_RNN_3.pdf&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/" target="_blank" rel="noopener"
>https://colah.github.io/posts/2015-08-Understanding-LSTMs/&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://www.youtube.com/watch?v=vTouAvxlphc" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=vTouAvxlphc&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://www.bilibili.com/video/BV1UK4y1d7xa" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1UK4y1d7xa&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>æ–‡æœ¬å¤„ç†ä¸Žè¯åµŒå…¥</title><link>https://www.letout.cn/p/nlp-in-action/text-processing-and-word-embedding/</link><pubDate>Fri, 11 Mar 2022 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/nlp-in-action/text-processing-and-word-embedding/</guid><description>&lt;img src="https://nlp.letout.cn/img/banner.png" alt="Featured image of post æ–‡æœ¬å¤„ç†ä¸Žè¯åµŒå…¥" />&lt;hr>
&lt;p>&lt;a class="link" href="https://nlp.letout.cn/nlp/text-processing-and-word-embedding" target="_blank" rel="noopener"
>ðŸš² è½¬åˆ° https://nlp.letout.cn ðŸ”” æ–‡æœ¬å¤„ç†ä¸Žè¯åµŒå…¥ âž¡ï¸&lt;/a>&lt;/p>
&lt;hr>
&lt;p>æœ¬èŠ‚ä¸»è¦å†…å®¹ä¸º &lt;strong>æ–‡æœ¬å¤„ç†&lt;/strong> &lt;code>Text Processing&lt;/code> å’Œ &lt;strong>è¯åµŒå…¥&lt;/strong> &lt;code>Word Embedding&lt;/code>ã€‚æœ¬èŠ‚å’Œä¸‹é¢ä¸¤èŠ‚å†…å®¹éƒ½ä¼šä½¿ç”¨ IMDb ç”µå½±è¯„è®ºçš„æ•°æ®ï¼Œç”¨æ¥æ­å»ºæœºå™¨å­¦ä¹ æ¨¡åž‹åˆ†æžç”µå½±è¯„è®ºã€‚&lt;/p>
&lt;h2 id="-imdb">ðŸŒ± IMDb&lt;/h2>
&lt;p>&lt;a class="link" href="https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E7%94%B5%E5%BD%B1%E8%B5%84%E6%96%99%E5%BA%93" target="_blank" rel="noopener"
>IMDb&lt;/a> æ˜¯æœ€æœ‰åçš„ç”µå½±è¯„è®ºç½‘ç«™ï¼Œç”¨æˆ·å¯ä»¥åœ¨ IMDb ä¸Šç»™ç”µå½±æ‰“åˆ†ï¼Œ1 åˆ†æ˜¯éžå¸¸è®¨åŽŒï¼Œ10 åˆ†æ˜¯éžå¸¸å–œæ¬¢ï¼Œå¦‚æžœä¹æ„ï¼Œè¿˜å¯ä»¥å†™ä¸€æ®µç”µå½±è¯„è®ºã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/imdb.png"
loading="lazy"
alt="IMDb"
>&lt;/p>
&lt;p>å¦‚æžœä¸ç»™ä½ çœ‹åˆ†æ•°ï¼Œåªç»™ä½ çœ‹è¯„è®ºï¼Œä½ å¤§æ¦‚èƒ½çŒœåˆ°ç”¨æˆ·æ‰“çš„åˆ†æ•°ï¼Œä½†ä½ çš„çŒœæµ‹å¯èƒ½ä¸å¤ªå‡†ç¡®ã€‚å¦‚æžœæ¢ç§æ–¹å¼ï¼Œè®©ä½ åˆ¤æ–­ç”µå½±è¯„è®ºæ˜¯ &lt;strong>æ­£é¢&lt;/strong> &lt;code>positive&lt;/code> çš„è¿˜æ˜¯ &lt;strong>è´Ÿé¢&lt;/strong> &lt;code>negative&lt;/code> çš„ï¼Œä½ åº”è¯¥ä¼šæœ‰å¾ˆé«˜çš„å‡†ç¡®çŽ‡ã€‚æœ‰äººä»Ž IMDb ä¸Šçˆ¬äº† 5 ä¸‡æ¡ç”µå½±è¯„è®ºï¼Œè¿™äº›è¯„è®ºéƒ½æ˜¯å¾ˆæžç«¯çš„ï¼Œéƒ½æ˜¯å¼ºçƒˆçš„å–œæ¬¢ï¼Œæˆ–è€…å¼ºçƒˆåæ„Ÿã€‚è¿™ä¸ªäºŒåˆ†ç±»é—®é¢˜å¯¹äºŽäººæ¥è¯´å¾ˆç®€å•ï¼Œäººè¯»ä¸€ä¸‹ç”µå½±è¯„è®ºå°±èƒ½è½»æ˜“çŸ¥é“è¿™æ˜¯æ­£é¢è¯„ä»·è¿˜æ˜¯è´Ÿé¢è¯„ä»·ï¼Œäººåº”è¯¥èƒ½æœ‰ 100% çš„å‡†ç¡®çŽ‡ï¼Œè¿™ä¸ªæ•°æ®é›†è¢«åˆ†æˆä¸¤åŠï¼Œ2 ä¸‡ 5 åƒæ¡ä½œä¸ºè®­ç»ƒæ•°æ® &lt;code>Train&lt;/code>ï¼Œå¦å¤– 2 ä¸‡ 5 åƒæ¡ä½œä¸ºæµ‹è¯•æ•°æ® &lt;code>Test&lt;/code>ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>ä½ å¯ä»¥åœ¨ä¸‹é¢çš„é“¾æŽ¥ä¸­èŽ·å–åˆ°æ•°æ®é›†ï¼š&lt;a class="link" href="https://ai.stanford.edu/~amaas/data/sentiment/" target="_blank" rel="noopener"
>https://ai.stanford.edu/~amaas/data/sentiment/&lt;/a>&lt;/p>
&lt;h2 id="-æ–‡æœ¬å¤„ç†æ–‡æœ¬å¤„ç†">ðŸ”– æ–‡æœ¬å¤„ç†æ–‡æœ¬å¤„ç†&lt;/h2>
&lt;p>åœ¨è¯åµŒå…¥ &lt;code>Word Embedding&lt;/code> å’Œæ­å»ºæœºå™¨å­¦ä¹ æ¨¡åž‹ä¹‹å‰ï¼Œé¦–å…ˆè¦è¿›è¡Œæ–‡æœ¬å¤„ç†ï¼Œå°†æ–‡æœ¬å˜æˆåºåˆ— &lt;code>Sequence&lt;/code>ï¼Œæ–‡æœ¬å¤„ç†å¾ˆæ— èŠï¼Œä½†æˆ‘ä»¬åº”è¯¥é‡è§†å®ƒï¼Œæ–‡æœ¬å¤„ç†çš„å¥½åï¼Œä¼šç›´æŽ¥å½±å“æœºå™¨å­¦ä¹ æ¨¡åž‹çš„å‡†ç¡®çŽ‡ã€‚&lt;/p>
&lt;h3 id="-tokenization">ðŸš€ Tokenization&lt;/h3>
&lt;p>æ–‡æœ¬å¤„ç†çš„ç¬¬ä¸€æ­¥æ˜¯ &lt;code>Tokenization&lt;/code>ï¼ŒæŠŠæ–‡æœ¬åˆ†å‰²æˆå¾ˆå¤š &lt;code>tokens&lt;/code>ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠæ–‡æœ¬åˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œä¸€ä¸ª &lt;code>token&lt;/code> å°±æ˜¯ä¸€ä¸ªå•è¯ï¼ˆå‡å¦‚ä½ æŠŠæ–‡æœ¬åˆ†å‰²æˆå­—ç¬¦ï¼Œé‚£ä¹ˆä¸€ä¸ª &lt;code>token&lt;/code> å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼‰ï¼Œåšå®Œ &lt;code>Tokenization&lt;/code>ï¼Œä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²å°±è¢«åˆ†å‰²æˆä¸€ä¸ªå¾ˆå¤šå•è¯çš„åˆ—è¡¨ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/1.png"
loading="lazy"
alt="1"
>&lt;/p>
&lt;p>&lt;code>Tokenization&lt;/code> çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯è®²ç©¶å¾ˆå¤šã€‚æ¯”å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° æ˜¯å¦åº”è¯¥æŠŠå¤§å†™å˜æˆå°å†™ï¼Ÿ&lt;/li>
&lt;/ul>
&lt;p>é€šå¸¸æƒ…å†µä¸‹åº”è¯¥æŠŠå¤§å†™å˜æˆå°å†™ï¼Œå¤§å°å†™å•è¯é€šå¸¸æ˜¯ä¸€ä¸ªæ„æ€ï¼›ä½†æœ‰æ—¶å€™ä¼šæ··æ·†å•è¯ï¼ˆApple -&amp;gt; appleï¼‰ï¼Œæ¯”å¦‚ Apple æ˜¯è‹¹æžœå…¬å¸ï¼Œapple æ˜¯æ°´æžœï¼Œå¤§å°å†™çš„ apple å¹¶ä¸æ˜¯ç›¸åŒçš„å•è¯ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° åŽ»é™¤åœç”¨è¯ã€‚&lt;code>stop word&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æœ‰äº›åº”ç”¨ä¼šåŽ»é™¤ stop wordï¼Œå®ƒæ˜¯ theã€aã€of ç­‰æœ€é«˜é¢‘çš„å•è¯ï¼Œè¿™äº›è¯å‡ ä¹Žå‡ºçŽ°åœ¨æ‰€æœ‰çš„å¥å­é‡Œï¼Œå¯¹è¿™ä¸ªäºŒåˆ†ç±»é—®é¢˜å‡ ä¹Žæ˜¯æ²¡æœ‰å¸®åŠ©ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° æ‹¼å†™çº é”™ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç”¨æˆ·å‘ç”µå½±è¯„è®ºçš„æ—¶å€™ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹å¹¶ä¸ä¼šä»”ç»†æ£€æŸ¥ï¼Œæ‰€ä»¥å†™çš„ä¸œè¥¿éš¾å…ä¼šæœ‰æ‹¼å†™é”™è¯¯ï¼Œæ‰€ä»¥åšæ‹¼å†™çº é”™é€šå¸¸æ˜¯æœ‰ç”¨çš„ã€‚&lt;/p>
&lt;p>è¿™é‡Œåªæ˜¯ä¸¾äº†å‡ ä¸ªä¾‹å­ï¼Œå®žé™…ä¸Šåš &lt;code>Tokenization&lt;/code> çš„æ—¶å€™éœ€è¦åšå¤§é‡çš„å·¥ä½œï¼Œ&lt;code>Tokenization&lt;/code> çœ‹ä¼¼ç®€å•ï¼Œä½†å®žé™…ä¸Šå¹¶ä¸å®¹æ˜“ã€‚&lt;/p>
&lt;h3 id="-build-dictionary">ðŸ§° Build Dictionary&lt;/h3>
&lt;p>ç¬¬äºŒæ­¥æ˜¯å»ºç«‹ä¸€ä¸ªå­—å…¸ã€‚å¯ä»¥å…ˆç»Ÿè®¡è¯é¢‘ï¼ŒåŽ»æŽ‰ä¸€äº›ä½Žé¢‘è¯ï¼Œè®©åŽè®©æ¯ä¸ªå•è¯å¯¹åº”ä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ¯”å¦‚è®© &lt;code>the -&amp;gt; 1; cat -&amp;gt; 2; sat -&amp;gt; 3&lt;/code>ã€‚æœ‰äº†è¿™ä¸ªå­—å…¸ï¼Œå°±å¯ä»¥æŠŠæ¯ä¸ªå•è¯å¯¹åº”åˆ°ä¸€ä¸ªæ•´æ•°ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸€å¥è¯å°±å¯ä»¥ç”¨æ­£æ•´æ•°çš„åˆ—è¡¨è¡¨ç¤ºï¼Œè¿™ä¸ªåˆ—è¡¨è¢«ç§°ä¸ºåºåˆ— &lt;code>Sequences&lt;/code>ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/2.png"
loading="lazy"
alt="2"
>&lt;/p>
&lt;p>å¦‚æžœæœ‰å¿…è¦çš„è¯ï¼Œè¿˜å¾—è¿›ä¸€æ­¥åš &lt;code>one-hot encoding&lt;/code>ï¼ŒæŠŠå•è¯è¡¨ç¤ºæˆ &lt;code>one-hot&lt;/code> å‘é‡ã€‚&lt;/p>
&lt;p>åœ¨ç”µå½±è¯„è®ºçš„ä¾‹å­é‡Œï¼Œæ•°æ®æ˜¯ 5 ä¸‡æ¡ç”µå½±è¯„è®ºï¼Œæ¯æ¡ç”µå½±è¯„è®ºå¯ä»¥è¡¨ç¤ºæˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åšå®Œ &lt;code>Tokenization&lt;/code> å’Œ &lt;code>Encoding&lt;/code> åŽï¼Œæ¯æ¡ç”µå½±è¯„è®ºéƒ½ä¼šè½¬æ¢æˆä¸€ä¸ª &lt;code>Sequences&lt;/code>ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ­£æ•´æ•°çš„åˆ—è¡¨ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;p>ç”µå½±è¯„è®ºæœ‰é•¿æœ‰çŸ­ï¼Œæœ‰äººåªèƒ½å†™å‡ ä¸ªå­—çš„è¯„è®ºï¼Œæœ‰äººèƒ½æ´‹æ´‹æ´’æ´’å†™å‡ åƒå­—ï¼Œæ‰€ä»¥å¾—åˆ°çš„è¿™äº› &lt;code>Sequences&lt;/code> çš„é•¿åº¦ä¹Ÿå„ä¸ç›¸åŒã€‚æ¯”å¦‚è¿™ä¸¤æ¡ &lt;code>Sequences&lt;/code> çš„é•¿åº¦åˆ†åˆ«æ˜¯ 52 å’Œ 90ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/4.png"
loading="lazy"
alt="4"
>&lt;/p>
&lt;p>è¿™å°±é€ æˆäº†ä¸€ä¸ªé—®é¢˜ï¼Œè®­ç»ƒæ•°æ®æ²¡æœ‰å¯¹é½ï¼Œæ¯æ¡ &lt;code>Sequences&lt;/code> éƒ½æœ‰ä¸åŒçš„é•¿åº¦ã€‚åšæœºå™¨å­¦ä¹ çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®å­˜å‚¨åˆ°çŸ©é˜µæˆ–è€…å¼ é‡é‡Œï¼Œæ¯æ¡åºåˆ—éƒ½å¾—æœ‰ç›¸åŒçš„é•¿åº¦ï¼Œéœ€è¦æŠŠåºåˆ—å¯¹é½ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/5.png"
loading="lazy"
alt="5"
>&lt;/p>
&lt;p>è§£å†³æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬å¯ä»¥å›ºå®šé•¿åº¦ä¸º $w$ã€‚å‡å¦‚ä¸€ä¸ªåºåˆ—é•¿åº¦å¤ªé•¿ï¼Œè¶…è¿‡äº† $w$ ä¸ªè¯ï¼Œå°±ç æŽ‰å‰é¢çš„è¯ï¼Œåªä¿ç•™æœ€åŽé¢ $w$ä¸ªè¯ï¼ˆå½“ç„¶ä¿ç•™æœ€å‰é¢ $w$ ä¸ªè¯ä¹ŸåŒæ ·å¯ä»¥ï¼‰ï¼›å‡å¦‚ä¸€ä¸ªåºåˆ—å¤ªçŸ­ï¼Œä¸åˆ° $w$ ä¸ªè¯ï¼Œé‚£ä¹ˆå°±åš &lt;code>zero padding&lt;/code> ç”¨ 0 æ¥è¡¥é½ï¼ŒæŠŠé•¿åº¦å¢žåŠ åˆ° $w$ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/6.png"
loading="lazy"
alt="6"
>&lt;/p>
&lt;p>è¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰åºåˆ—çš„é•¿åº¦éƒ½æ˜¯ $w$ï¼Œå¯ä»¥å­˜å‚¨åˆ°ä¸€ä¸ªçŸ©é˜µé‡Œã€‚&lt;/p>
&lt;h2 id="-è¯åµŒå…¥">ðŸ€ï¸ è¯åµŒå…¥&lt;/h2>
&lt;p>æ–‡æœ¬å¤„ç†å·²ç»å®Œæˆäº†ï¼ŒçŽ°åœ¨æ¯ä¸ªè¯éƒ½ç”¨ä¸€ä¸ªæ­£æ•´æ•°æ¥è¡¨ç¤ºï¼Œä¸‹ä¸€æ­¥æ˜¯ &lt;code>Word Embedding&lt;/code>ï¼ŒæŠŠæ¯ä¸ªè¯éƒ½è¡¨ç¤ºä¸ºä¸€ä¸ªä¸€ç»´å‘é‡ã€‚&lt;/p>
&lt;p>çŽ°åœ¨æ¯ä¸ªå•è¯éƒ½ç”¨ä¸€ä¸ªæ•°å­—æ¥è¡¨ç¤ºï¼Œè¯¥æ€Žä¹ˆæŠŠè¿™äº› &lt;code>Categorical&lt;/code> ç‰¹å¾è¡¨ç¤ºä¸ºæ•°å€¼å‘é‡å‘¢ï¼Ÿ&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>æ˜¾ç„¶å¯ä»¥åš &lt;code>one-hot encoding&lt;/code>ï¼Œç”¨ä¸€ä¸ª &lt;code>one-hot&lt;/code> å‘é‡æ¥è¡¨ç¤ºä¸€ä¸ªå•è¯ã€‚&lt;!-- raw HTML omitted -->
æ¯”å¦‚ &lt;code>good: index = 2&lt;/code>ï¼ŒäºŽæ˜¯ä½¿ç”¨æ ‡å‡†æ­£äº¤ç§¯ $e_2$ æ¥è¡¨ç¤ºï¼Œå®ƒçš„ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ï¼Œ$e_2=[0, 1, 0, 0, &amp;hellip;, 0]$&lt;/p>
&lt;p>å‡å¦‚ &lt;code>vocabulary = v&lt;/code>ï¼Œä¹Ÿå°±æ˜¯è¯´å­—å…¸é‡Œä¸€å…±æœ‰ $v$ ä¸ªå•è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦ç»´åº¦ &lt;code>dimension = v&lt;/code> çš„ &lt;code>one-hot&lt;/code> å‘é‡ï¼Œè¦æ˜¯å­—å…¸é‡Œæœ‰ 1 ä¸‡ä¸ªå•è¯ï¼Œé‚£ä¹ˆè¿™äº› &lt;code>one-hot&lt;/code> å‘é‡éƒ½æ˜¯ 1 ä¸‡ç»´çš„ï¼Œè¿™æ ·çš„å‘é‡ç»´åº¦æ˜¯åœ¨å¤ªé«˜äº†ã€‚ä¸‹ä¸€èŠ‚ä»‹ç» RNN çš„æ—¶å€™ä½ ä¼šçœ‹åˆ°ï¼ŒRNN çš„å‚æ•°æ•°é‡æ­£æ¯”äºŽè¾“å…¥å‘é‡çš„ç»´åº¦ï¼Œæˆ‘ä»¬è‚¯å®šä¸æƒ³è®©è¾“å…¥çš„å‘é‡æ˜¯ 1 ä¸‡ç»´çš„ï¼Œå¦åˆ™ä¸€å±‚ RNN å°†ä¼šæœ‰å¥½å‡ åä¸‡ä¸ªå‚æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åš &lt;code>Word Embedding&lt;/code>ï¼ŒæŠŠè¿™äº›é«˜ç»´ &lt;code>one-hot&lt;/code> å‘é‡æ˜ å°„åˆ°ä½Žç»´å‘é‡ã€‚&lt;/p>
&lt;p>å…·ä½“åšæ³•æ˜¯å§ &lt;code>one-hot&lt;/code> å‘é‡ $e_i$ ä¹˜åˆ°å‚æ•°çŸ©é˜µ $P^T$ ä¸Šï¼ŒçŸ©é˜µ $P^T$ çš„å¤§å°æ˜¯ $d*v$ã€‚å…¶ä¸­ $d$ æ˜¯è¯å‘é‡çš„ç»´åº¦ï¼Œç”±ç”¨æˆ·è‡ªå·±å†³å®šï¼›$v$ æ˜¯ &lt;code>vocabulary&lt;/code>ï¼Œè¡¨ç¤ºå­—å…¸é‡Œå•è¯çš„æ•°é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;p>çŸ©é˜µçš„ä¹˜æ³•çš„ç»“æžœè®°åšå‘é‡ $x_i$ï¼Œ$x_i$ å°±æ˜¯ä¸€ä¸ªè¯å‘é‡ï¼Œç»´åº¦æ˜¯ $d*1$ï¼Œå¦‚æžœ &lt;code>one-hot&lt;/code> å‘é‡ $e$ çš„ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯ 1ï¼Œé‚£ä¹ˆ $x_i$ å°±æ˜¯ $P^T$ çŸ©é˜µçš„ç¬¬ä¸‰åˆ—ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ$P^T$ çŸ©é˜µæ¯ä¸€åˆ—éƒ½æ˜¯ä¸€ä¸ªè¯å‘é‡ã€‚&lt;/p>
&lt;p>åŒç†ï¼Œä¸‹é¢è¿™ä¸ªå‚æ•°çŸ©é˜µ $P$ çš„æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªè¯å‘é‡ã€‚è¿™ä¸ªçŸ©é˜µçš„è¡Œæ•°æ˜¯ $v$ï¼Œä¹Ÿå°±æ˜¯ &lt;code>vocabulary&lt;/code>ï¼›æ¯ä¸€è¡Œå¯¹åº”ä¸€ä¸ªå•è¯ï¼ŒçŸ©é˜µçš„åˆ—æ•°æ˜¯ $d$ï¼Œ$d$ æ˜¯ç”¨æˆ·å†³å®šçš„ï¼Œ$d$ çš„å¤§å°ä¼šå½±å“æœºå™¨å­¦ä¹ æ¨¡åž‹çš„è¡¨çŽ°ï¼Œåº”è¯¥ç”¨ äº¤å‰éªŒè¯ &lt;code>Cross Validation&lt;/code> ç”¨æ¥é€‰æ‹©ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ $d$ã€‚&lt;/p>
&lt;p>å­—å…¸é‡Œçš„ç¬¬ä¸€ä¸ªè¯çš„æ˜¯ &lt;code>movie&lt;/code>ï¼Œé‚£ä¹ˆç¬¬ä¸€è¡Œå°±æ˜¯ &lt;code>movie&lt;/code> çš„è¯å‘é‡ï¼›å­—å…¸é‡Œçš„ç¬¬äºŒä¸ªè¯æ˜¯ &lt;code>good&lt;/code>ï¼Œé‚£ä¹ˆç¬¬äºŒè¡Œå°±æ˜¯ &lt;code>good&lt;/code> çš„è¯å‘é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯åˆ¤æ–­ç”µå½±è¯„è®ºæ˜¯æ­£é¢çš„è¿˜æ˜¯è´Ÿé¢çš„ï¼Œè¿™ä¸ªå‚æ•°çŸ©é˜µæ˜¯ä»Žè®­ç»ƒæ•°æ®ä¸­å­¦ä¹ å‡ºæ¥çš„ï¼Œæ‰€ä»¥è¿™äº›è¯å‘é‡éƒ½å¸¦æœ‰æ„Ÿæƒ…è‰²å½©ï¼Œå‡å¦‚è¿™äº›è¯å‘é‡éƒ½æ˜¯äºŒç»´çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å¹³é¢åæ ‡ç³»ä¸­æ ‡å‡ºè¿™äº›è¯å‘é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/9.png"
loading="lazy"
alt="9"
>&lt;/p>
&lt;p>&lt;code>fantastic; good; fun&lt;/code> è¿™äº›è¯å‘é‡éƒ½å¸¦æœ‰æ­£é¢æƒ…æ„Ÿï¼Œæ‰€ä»¥è¿™ä¸‰ä¸ªè¯çš„è¯å‘é‡å­¦å‡ºæ¥éƒ½æ¯”è¾ƒæŽ¥è¿‘ï¼›åŒç†ï¼Œ&lt;code>poor; boring; mediocre&lt;/code> è¿™äº›è¯å¸¦æœ‰è´Ÿé¢æƒ…æ„Ÿï¼Œæ‰€ä»¥å­¦å‡ºæ¥çš„è¯åŒæ ·ä¹Ÿåº”è¯¥æ¯”è¾ƒæŽ¥è¿‘ï¼Œä½†æ˜¯è¿™äº›è¯çš„è¯å‘é‡åº”è¯¥è¿œç¦»æ­£é¢è‰²å½©çš„è¯å‘é‡ã€‚åƒ &lt;code>movie; is&lt;/code> è¿™æ ·çš„ä¸­æ€§è¯ï¼Œæ²¡æœ‰æ„Ÿæƒ…è‰²å½©ï¼Œå®ƒä»¬åº”è¯¥åœ¨ä¸­é—´ã€‚&lt;/p>
&lt;h2 id="-æ€»ç»“">ðŸŽ æ€»ç»“&lt;/h2>
&lt;p>æœ€åŽæ€»ç»“ä¸€ä¸‹è¿™ä¸€ç« çš„å†…å®¹ã€‚&lt;/p>
&lt;p>è¿™ä¸€èŠ‚ä¸ŠåŠéƒ¨åˆ†ï¼Œè¯´æ˜Žäº†æ–‡æœ¬å¤„ç†æ˜¯ä»€ä¹ˆæ ·çš„ã€‚ç»™æˆ‘ä»¬ä¸€æ¡ç”µå½±è¯„è®ºï¼Œé¦–å…ˆåš &lt;code>Tokenization&lt;/code>ï¼ŒæŠŠç”µå½±è¯„è®ºåˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œç„¶åŽæŠŠå¾ˆå¤šå•è¯ç¼–ç æˆæ•°å­—ï¼Œè¿™æ ·ä¸€æ•´æ¡ç”µå½±è¯„è®ºå°±å¯ä»¥å¾ˆå¤šæ­£æ•´æ•°æ¥è¡¨ç¤ºï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ­£æ•´æ•°åºåˆ—å«åš &lt;code>Sequences&lt;/code>ï¼Œå°±æ˜¯ç¥žç»ç½‘ç»œä¸­ &lt;code>Embedding&lt;/code> å±‚çš„è¾“å…¥ã€‚ç”±äºŽç”µå½±è¯„è®ºçš„é•¿çŸ­ä¸ä¸€ï¼Œå¾—åˆ°çš„ &lt;code>Sequence&lt;/code> çš„é•¿çŸ­ä¹Ÿä¸ä¸€æ ·ï¼Œæ²¡åŠžæ³•å­˜å‚¨åœ¨ä¸€ä¸ªçŸ©é˜µé‡Œï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ &lt;code>Alignment&lt;/code> å¯¹é½ã€‚å‡è®¾æœ€å¤§é•¿åº¦ä¸º &lt;code>20&lt;/code>ï¼Œå¦‚æžœé•¿åº¦å¤§äºŽ&lt;code>20&lt;/code>ï¼Œå°±åªä¿ç•™æœ€åŽ &lt;code>20&lt;/code> ä¸ªå•è¯ï¼›å¦‚æžœé•¿åº¦ä¸åˆ° &lt;code>20&lt;/code>ï¼Œå°±ç”¨ &lt;code>0&lt;/code> è¡¥é½ï¼ŒæŠŠé•¿åº¦å¢žåŠ åˆ° &lt;code>20&lt;/code>ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ª &lt;code>Sequences&lt;/code> é•¿åº¦éƒ½ç›¸åŒã€‚&lt;/p></description></item><item><title>RNN</title><link>https://www.letout.cn/p/nlp-in-action/simple-rnn/</link><pubDate>Tue, 08 Mar 2022 20:36:14 +0800</pubDate><guid>https://www.letout.cn/p/nlp-in-action/simple-rnn/</guid><description>&lt;img src="https://nlp.letout.cn/img/banner.png" alt="Featured image of post RNN" />&lt;hr>
&lt;p>&lt;a class="link" href="https://nlp.letout.cn/nlp/simple-rnn" target="_blank" rel="noopener"
>ðŸš² è½¬åˆ° https://nlp.letout.cn ðŸ”” RNN âž¡ï¸&lt;/a>&lt;/p>
&lt;hr>
&lt;p>è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥å­¦ä¹ &lt;strong>å¾ªçŽ¯ç¥žç»ç½‘ç»œ&lt;/strong>&lt;code>Recurrent Neural Networks&lt;/code>ã€‚æœ¬èŠ‚çš„å†…å®¹æ˜¯ &lt;code>Simple RNN&lt;/code>ï¼Œä»¥åŠç”¨ &lt;code>Pytorch&lt;/code> ç¼–ç¨‹å®žçŽ° &lt;code>Simple RNN&lt;/code>ã€‚&lt;/p>
&lt;h2 id="-ç®€ä»‹">ðŸŒ± ç®€ä»‹&lt;/h2>
&lt;p>çŽ°åœ¨ &lt;code>RNN&lt;/code> æ²¡æœ‰ä»¥å‰æµè¡Œï¼Œå°¤å…¶æ˜¯åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸Šï¼Œ&lt;code>RNN&lt;/code> å·²ç»æœ‰ä¸€äº›è¿‡æ—¶äº†ï¼Œå¦‚æžœè®­ç»ƒçš„æ•°æ®è¶³å¤Ÿå¤šï¼Œ&lt;code>RNN&lt;/code> çš„æ•ˆæžœä¸å¦‚ &lt;code>Transformer&lt;/code> æ¨¡åž‹ï¼Œä½†æ˜¯åœ¨å°è§„æ¨¡çš„é—®é¢˜ä¸Šï¼Œ&lt;code>RNN&lt;/code> è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚&lt;/p>
&lt;h2 id="-å¦‚ä½•å»ºæ¨¡æ—¶åºæ•°æ®">ðŸ”– å¦‚ä½•å»ºæ¨¡æ—¶åºæ•°æ®ï¼Ÿ&lt;/h2>
&lt;p>æœºå™¨å­¦ä¹ ä¸­ç»å¸¸ç”¨åˆ°æ–‡æœ¬ã€è¯­éŸ³ç­‰ &lt;strong>æ—¶åºæ•°æ®&lt;/strong>&lt;code>sequential data&lt;/code>ï¼ˆæŒ‰æ—¶é—´é¡ºåºè®°å½•çš„æ•°æ®åˆ—ï¼Œæœ‰é•¿åº¦ä¸å›ºå®šçš„ç‰¹ç‚¹ï¼‰ã€‚&lt;/p>
&lt;p>é¦–å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæ€Žä¹ˆå¯¹è¿™æ ·çš„æ—¶åºæ•°æ®è¿›è¡Œå»ºæ¨¡ï¼Ÿ
åœ¨ä¸Šä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€æ®µæ–‡å­—æ•´ä½“è¾“å…¥åˆ°ä¸€ä¸ªé€»è¾‘å›žå½’ &lt;code>Logistic Regression&lt;/code> æ¨¡åž‹ä¸­ï¼Œè®©æ¨¡åž‹æ¥åšäºŒåˆ†ç±»ï¼Œè¿™å±žäºŽä¸€ä¸ª &lt;code>one-to-one&lt;/code> æ¨¡åž‹ï¼Œä¸€ä¸ªè¾“å…¥å¯¹åº”ä¸€ä¸ªè¾“å‡ºã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/1.png"
loading="lazy"
alt="1"
>&lt;/p>
&lt;p>å…¨è¿žæŽ¥ç¥žç»ç½‘ç»œå’Œå·ç§¯ç¥žç»ç½‘ç»œéƒ½å±žäºŽ &lt;code>one-to-one&lt;/code> æ¨¡åž‹ã€‚&lt;/p>
&lt;p>äººè„‘å¹¶ä¸ä¼šä½¿ç”¨ &lt;code>one-to-one&lt;/code> æ¨¡åž‹å¤„ç†æ—¶åºæ•°æ®ï¼Œä¸ä¼šæŠŠä¸€æ•´æ®µæ–‡å­—å…¨éƒ¨è¾“å…¥åˆ°å¤§è„‘ï¼Œæˆ‘ä»¬åœ¨é˜…è¯»çš„æ—¶å€™ï¼Œä¼šä»Žå·¦åˆ°å³é˜…è¯»ä¸€æ®µæ–‡å­—ï¼Œä¸æ–­åœ°åœ¨å¤§è„‘é‡Œç§¯ç´¯ä¿¡æ¯ï¼Œé˜…è¯»ä¸€æ®µè¯ä¹‹åŽï¼Œä½ è„‘å­é‡Œå°±ç§¯ç´¯äº†ä¸€æ®µæ–‡å­—çš„å¤§æ„ã€‚&lt;/p>
&lt;p>&lt;code>one-to-one&lt;/code> æ¨¡åž‹è¦æ±‚ä¸€ä¸ªè¾“å…¥å¯¹åº”ä¸€ä¸ªè¾“å‡ºï¼Œæ¯”å¦‚ï¼šè¾“å…¥ä¸€å¼ å›¾ç‰‡ï¼Œè¾“å‡ºæ¯ä¸€ç±»çš„æ¦‚çŽ‡å€¼ï¼Œ&lt;code>one-to-one&lt;/code> çš„æ¨¡åž‹æ¯”è¾ƒé€‚åˆè¿™ç±»å›¾ç‰‡é—®é¢˜ï¼Œä½†æ˜¯ä¸å¤ªé€‚åˆæ–‡æœ¬é—®é¢˜ã€‚&lt;/p>
&lt;p>å¯¹äºŽæ–‡æœ¬é—®é¢˜ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„é•¿åº¦å¹¶ä¸å›ºå®šï¼Œä¸€æ®µè¯å¯é•¿å¯çŸ­ï¼Œæ‰€ä»¥è¾“å…¥çš„é•¿åº¦å¹¶ä¸å›ºå®šï¼›è¾“å‡ºçš„é•¿åº¦ä¹Ÿä¸å›ºå®šï¼Œæ¯”å¦‚å°†è‹±è¯­ç¿»è¯‘æˆæ±‰è¯­ï¼Œä¸€å¥è‹±è¯­æœ‰åä¸ªå•è¯ï¼Œç¿»è¯‘æˆæ±‰è¯­å¯èƒ½æœ‰åä¸ªå­—ï¼Œå¯èƒ½æœ‰å…«ä¸ªå­—ï¼Œä¹Ÿå¯èƒ½æ˜¯å››ä¸ªå­—çš„æˆè¯­ï¼Œè¾“å‡ºæ±‰è¯­çš„å­—æ•°å¹¶ä¸å›ºå®šï¼Œç”±äºŽè¾“å…¥å’Œè¾“å‡ºçš„é•¿åº¦ä¸å›ºå®šï¼Œ&lt;code>one-to-one&lt;/code> æ¨¡åž‹å°±ä¸å¤ªé€‚åˆäº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/translation.png"
loading="lazy"
alt="translation"
>&lt;/p>
&lt;p>å¯¹äºŽæ—¶åºæ•°æ®ï¼Œæ›´å¥½çš„æ˜¯ &lt;code>many-to-one&lt;/code> æˆ–è€…æ˜¯ &lt;code>many-to-many&lt;/code> æ¨¡åž‹ï¼Œ&lt;code>RNN&lt;/code> å°±æ˜¯è¿™æ ·çš„æ¨¡åž‹ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„é•¿åº¦éƒ½ä¸å›ºå®šã€‚æ‰€ä»¥ &lt;code>RNN&lt;/code> å¾ˆé€‚åˆè¯­éŸ³ï¼Œæ–‡æœ¬ç­‰æ—¶åºåºåˆ—æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/2.png"
loading="lazy"
alt="2"
>&lt;/p>
&lt;h2 id="-rnn">ðŸ€ï¸ RNN&lt;/h2>
&lt;p>&lt;code>RNN&lt;/code> å’Œè·Ÿäººçš„é˜…è¯»ä¹ æƒ¯å¾ˆç±»ä¼¼ï¼šäººæ¯æ¬¡çœ‹ä¸€ä¸ªè¯ï¼Œä¼šé€æ¸åœ¨å¤§è„‘é‡Œç§¯ç´¯ä¿¡æ¯ï¼›&lt;code>RNN&lt;/code> æ¯çœ‹ä¸€ä¸ªè¯ï¼Œä¼šç”¨çŠ¶æ€å‘é‡ $h$ æ¥ç§¯ç´¯é˜…è¯»è¿‡çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†è¾“å…¥çš„æ¯ä¸ªè¯ç”¨ è¯åµŒå…¥&lt;code>word embedding&lt;/code> å˜æˆä¸€ä¸ªè¯å‘é‡ $x$ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;p>æ¯æ¬¡æŠŠä¸€ä¸ªè¯å‘é‡è¾“å…¥ &lt;code>RNN&lt;/code>ï¼Œå°±ä¼šæ›´æ–°çŠ¶æ€ $h$ ï¼ŒæŠŠæ–°çš„è¾“å…¥ç§¯ç´¯åˆ°çŠ¶æ€ $h$ é‡Œé¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/4.png"
loading="lazy"
alt="4"
>&lt;/p>
&lt;p>åœ¨ $h_0$ä¸­ï¼ŒåŒ…å«äº†ç¬¬ä¸€ä¸ªè¯ &lt;code>the&lt;/code> çš„ä¿¡æ¯ï¼Œåœ¨ $h_1$ é‡Œé¢ï¼ŒåŒ…å«äº†å‰ä¸¤ä¸ª &lt;code>the cat&lt;/code> çš„ä¿¡æ¯ï¼›ä»¥æ­¤ç±»æŽ¨ï¼ŒçŠ¶æ€ $h_2$ åŒ…å« äº†å‰ä¸‰ä¸ªè¯ &lt;code>the cat sat&lt;/code> çš„ä¿¡æ¯ï¼Œæœ€åŽä¸€ä¸ªçŠ¶æ€ $h_t$ åŒ…å«äº†æ•´å¥è¯çš„ä¿¡æ¯ï¼Œå¯ä»¥æŠŠ $h_t$ çœ‹åš &lt;code>RNN&lt;/code> ä»Žæ•´å¥è¯ &lt;code>the cat sat on the mat&lt;/code> æŠ½å–çš„ç‰¹å¾å‘é‡ï¼Œåœ¨æ›´æ–°çŠ¶æ€ $h$ çš„æ—¶å€™ï¼Œéœ€è¦ç”¨åˆ°å‚æ•°çŸ©é˜µ $A$ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/5.png"
loading="lazy"
alt="5"
>&lt;/p>
&lt;p>&lt;strong>æ³¨æ„ï¼šæ•´ä¸ª RNN åªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µ&lt;/strong> $A$ã€‚æ— è®ºè¿™æ¡é“¾æœ‰å¤šé•¿ï¼Œå‚æ•° $A$ åªæœ‰ä¸€ä¸ªï¼Œ$A$ éšæœºåˆå§‹åŒ–ï¼Œç„¶åŽåˆ©ç”¨è®­ç»ƒæ•°æ®æ¥å­¦ä¹  $A$ã€‚ä¸‹é¢é¦–å…ˆè®²è§£ &lt;code>Simple RNN Model&lt;/code>ã€‚&lt;/p>
&lt;h2 id="-simple-rnn">ðŸš€ Simple RNN&lt;/h2>
&lt;p>æˆ‘ä»¬å…·ä½“çœ‹çœ‹ï¼Œ&lt;code>Simple RNN&lt;/code> ç®€å•å¾ªçŽ¯ç¥žç»ç½‘ç»œæ˜¯æ€Žä¹ˆæŠŠè¾“å…¥çš„è¯å‘é‡ $x$ï¼Œç»“åˆåˆ°çŠ¶æ€ $h$ ä¸­çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/6.png"
loading="lazy"
alt="6"
>&lt;/p>
&lt;p>æˆ‘ä»¬å°†ä¸Šä¸€ä¸ªçŠ¶æ€è®°åš $h_t-1$ï¼Œæ–°è¾“å…¥è¯å‘é‡è®°åš $x_t$ï¼Œå°†è¿™ä¸¤ä¸ªå‘é‡åšæ‹¼æŽ¥ &lt;code>concatenation&lt;/code>ï¼Œå¾—åˆ°ä¸€ä¸ªæ›´é«˜ç»´çš„å‘é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>å›¾ä¸­è¿™ä¸ªçŸ©é˜µ $A$ æ˜¯ &lt;code>RNN&lt;/code> çš„æ¨¡åž‹å‚æ•°ï¼Œè¿™é‡Œè®¡ç®—çŸ©é˜µ $A$ å’Œè¿™ä¸ªå‘é‡çš„ä¹˜ç§¯ï¼ˆæ‹¼æŽ¥åŽçš„å‘é‡ï¼‰ï¼ŒçŸ©é˜µå’Œå‘é‡çš„ä¹˜ç§¯æ˜¯ä¸€ä¸ªå‘é‡ï¼Œç„¶åŽä½¿ç”¨æ¿€æ´»å‡½æ•° &lt;code>tanh&lt;/code> ä½œç”¨åœ¨å‘é‡çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œæœ€åŽæŠŠæ¿€æ´»å‡½æ•°çš„è¾“å‡ºè®°åšæ–°çš„çŠ¶æ€ $h_t$ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ¿€æ´»å‡½æ•°å¼ åŒæ›²æ­£åˆ‡å‡½æ•° &lt;code>hyperbolic tangent function&lt;/code>ï¼Œè¾“å…¥æ˜¯ä»»æ„å®žæ•°ï¼Œè¾“å‡ºåœ¨ $(-1, +1)$ ä¹‹é—´ã€‚ç”±äºŽç”¨äº†åŒæ›²æ­£åˆ‡æ¿€æ´»å‡½æ•°ï¼Œå‘é‡ $h_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½åœ¨ $(-1, +1)$ ä¹‹é—´ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/7.png"
loading="lazy"
alt="hyperbolic tangent function"
>&lt;/p>
&lt;p>è¿™ä¸ªç¥žç»ç½‘ç»œçš„ç»“æž„å›¾å¯ä»¥è¿™æ ·ç†è§£ï¼šæ–°çš„çŠ¶æ€ $h_t$ï¼Œæ˜¯æ—§çŠ¶æ€ $h_{t-1}$ å’Œæ–°çš„è¾“å…¥ $x_t$ çš„å‡½æ•°ï¼Œç¥žç»ç½‘ç»œæ¨¡åž‹çš„å‚æ•°æ˜¯ $A$ï¼šæ–°çš„çŠ¶æ€ $h_t$ï¼Œä¾èµ–äºŽå‘é‡ $h_{t-1}$, å‘é‡ $x_t$ ä»¥åŠçŸ©é˜µ $A$ã€‚&lt;/p>
&lt;h3 id="-ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨-tanh-ä½œä¸ºæ¿€æ´»å‡½æ•°">ðŸŽ¨ ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ &lt;code>tanh&lt;/code> ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Ÿ&lt;/h3>
&lt;p>æˆ‘ä»¬æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ &lt;code>tanh&lt;/code> ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Ÿèƒ½å¦å°†è¿™ä¸ªæ¿€æ´»å‡½æ•°åŽ»æŽ‰ï¼ŒåŽ»æŽ‰ä¹‹åŽä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/9.png"
loading="lazy"
alt="9"
>&lt;/p>
&lt;p>é¦–å…ˆæˆ‘ä»¬åšä¸ªç®€åŒ–ï¼Œå‡è®¾è¾“å…¥çš„è¯å‘é‡çš„å…ƒç´ éƒ½æ˜¯ $0$ã€‚å¦‚å›¾ï¼Œè¿™ç­‰åŒäºŽè¾“å…¥çš„è¯å‘é‡ $x_t$ éƒ½åŽ»æŽ‰ï¼ŒæŠŠçŸ©é˜µ $A$ å³è¾¹ä¸€åŠä¹ŸåŽ»æŽ‰ã€‚&lt;/p>
&lt;p>$x_0 = x_1 = &amp;hellip; = x_{100} = 0$&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/10.png"
loading="lazy"
alt="10"
>&lt;/p>
&lt;p>è¿™ä¹ˆä¸€æ¥ï¼Œç¬¬ &lt;code>100&lt;/code> ç»´çš„ç‰¹å¾å‘é‡ $h_{100} = Ah_{99} = A^2h_{98} = &amp;hellip; = A^{100}h_0$ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° å‡è®¾çŸ©é˜µ $A$ æœ€å¤§çš„ç‰¹å¾å€¼ç•¥å°äºŽ &lt;code>1&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ¯”å¦‚ï¼Œæœ€å¤§çš„ç‰¹å¾å€¼ç­‰äºŽ &lt;code>0.9&lt;/code>ã€‚é‚£ä¹ˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p>
&lt;p>$0.9^{100}$ éžå¸¸æŽ¥è¿‘äºŽ &lt;code>0&lt;/code> äº†ï¼Œæ‰€ä»¥çŸ©é˜µ $A^{100}$ éžå¸¸æŽ¥è¿‘äºŽ &lt;code>0&lt;/code>ï¼Œé‚£ä¹ˆæ–°çš„ç‰¹å¾å‘é‡ $h_{100}$ ä¹Ÿå‡ ä¹Žä¹Ÿæ˜¯ä¸€ä¸ªå…¨é›¶çš„å‘é‡ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° å‡è®¾çŸ©é˜µ $A$ æœ€å¤§çš„ç‰¹å¾å€¼ç•¥å¤§äºŽ &lt;code>1&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ¯”å¦‚ï¼Œæœ€å¤§çš„ç‰¹å¾å€¼ç­‰äºŽ &lt;code>1.2&lt;/code>ã€‚&lt;/p>
&lt;p>$1.2^{100}=82817974.522$ï¼Œæ‰€ä»¥çŸ©é˜µ $A^{100}$ çš„å…ƒç´ éƒ½è¶…çº§å¤§ï¼Œ$A^{100}$çš„æ¯ä¸ªå…ƒç´ éƒ½å¾ˆå¤§ï¼Œå‡å¦‚å¾ªçŽ¯çš„æ¬¡æ•°æ›´å¤šä¸€äº›ï¼Œæˆ–è€… $A$ çš„ç‰¹å¾å€¼å†å¤§ä¸€äº›ï¼ŒçŠ¶æ€å‘é‡çš„å€¼å°±ä¼šçˆ†ç‚¸ã€‚&lt;/p>
&lt;p>å‡å¦‚æ²¡æœ‰è¿™ä¸ªæ¿€æ´»å‡½æ•° &lt;code>tanh&lt;/code>ï¼Œæ•°å€¼è®¡ç®—çš„æ—¶å€™å¾ˆæœ‰å¯èƒ½ä¼šå‡ºé—®é¢˜ï¼Œè¦ä¹ˆè®¡ç®—å‡ºçš„ç»“æžœå…¨éƒ¨ç­‰äºŽ &lt;code>0&lt;/code>ï¼Œè¦ä¹ˆçˆ†ç‚¸äº†å…¨éƒ¨æ˜¯ &lt;code>NaN: Not a Number&lt;/code>ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ¿€æ´»å‡½æ•°ï¼Œæ¯æ¬¡æ›´æ–°çŠ¶æ€ $h$ åŽï¼Œéƒ½ä¼šåšä¸€ä¸ªæ ‡å‡†åŒ–æ“ä½œ &lt;code>normalization&lt;/code>ï¼Œè®© $h$ æ¢å¤åˆ° $(-1, +1)$ è¿™ä¸ªåˆé€‚çš„åŒºé—´é‡Œã€‚&lt;/p>
&lt;h3 id="-simple-rnn-æ¨¡åž‹å‚æ•°æ•°é‡">ðŸï¸ Simple RNN æ¨¡åž‹å‚æ•°æ•°é‡&lt;/h3>
&lt;p>æˆ‘ä»¬æ¥æ•°ä¸€ä¸‹ &lt;code>Simple RNN&lt;/code> æœ‰å¤šå°‘ä¸ªæ¨¡åž‹å‚æ•°ã€‚&lt;/p>
&lt;p>å¦‚å›¾ï¼Œå…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªæ‹¼æŽ¥åŽå‘é‡ï¼Œè¿™ä¸ªå‘é‡çš„ç»´åº¦æ˜¯ $h_{t-1}$ çš„ç»´åº¦åŠ ä¸Š $x_t$ çš„ç»´åº¦ï¼š&lt;/p>
&lt;p>æ‰€ä»¥ $A$ ä¸€å®šè¦æœ‰ $shape(h)+shape(x)$ ç»´åº¦è¿™ä¹ˆå¤šåˆ—ï¼š&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/11.png"
loading="lazy"
alt="11"
>&lt;/p>
&lt;p>$A$ çš„è¡Œæ•°ç­‰äºŽ $h$ çš„ç»´åº¦ï¼š&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/12.png"
loading="lazy"
alt="12"
>&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæœ€ç»ˆçŸ©é˜µ $A$ çš„å¤§å°ç­‰äºŽï¼š&lt;/p>
&lt;p>$parameter(A) = shape(h) * [shape(h) + shape(x)]$&lt;/p>
&lt;p>è¿™ä¸ªä¹˜ç§¯ $parameter(A)$ å°±æ˜¯ &lt;code>simple RNN&lt;/code> çš„æœ€ç»ˆçš„å‚æ•°æ•°é‡ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æ¥æ­ä¸€ä¸ªç®€å•çš„ç½‘ç»œã€‚æœ€åº•å±‚æ˜¯ä¸€ä¸ªè¯åµŒå…¥å±‚ &lt;code>Word Embedding Layer&lt;/code>ï¼Œå®ƒå¯ä»¥æŠŠè¯æ˜ å°„ä¸ºè¯å‘é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/13.png"
loading="lazy"
alt="13"
>&lt;/p>
&lt;p>è¯å‘é‡çš„ç»´åº¦ç”±è‡ªå·±è®¾ç½®ï¼ˆè¿™æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨äº¤å‰éªŒè¯ &lt;code>cross validation&lt;/code> é€‰æ‹©æœ€ä½³çš„ç»´åº¦ï¼‰ï¼Œè¿™é‡Œè®¾ç½® $x$ çš„ç»´åº¦æ˜¯ $32$ã€‚&lt;/p>
&lt;p>ç„¶åŽä¸‹ä¸€å±‚æ˜¯ &lt;code>Simple RNN Layer&lt;/code>ï¼Œè¾“å…¥çš„æ˜¯è¯å‘é‡ $x_i$ï¼Œè¾“å‡ºçš„æ˜¯çŠ¶æ€ $h_i$ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/14.png"
loading="lazy"
alt="14"
>&lt;/p>
&lt;p>$h$ çš„ç»´åº¦ä¹Ÿæ˜¯ç”±è‡ªå·±è®¾ç½®ï¼Œæˆ‘ä»¬è®¾ç½® $h$ ç»´åº¦ä¸º $32$ã€‚è¿™é‡Œ $x$ å’Œ $h$ çš„ç»´åº¦éƒ½æ˜¯ $32$ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå·§åˆè€Œå·²ï¼Œ$h$ å’Œ $x$ çš„ç»´åº¦é€šå¸¸ä¸ä¸€æ ·ã€‚&lt;/p>
&lt;p>å‰é¢è¯´è¿‡ï¼ŒçŠ¶æ€å‘é‡ $h$ ä¼šç§¯ç´¯è¾“å…¥çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š$h_0$ åŒ…å«ç¬¬ä¸€ä¸ªå•è¯ &lt;code>I&lt;/code> çš„ä¿¡æ¯ï¼Œ$h_1$ åŒ…å«å‰ä¸¤ä¸ªè¯ &lt;code>I love&lt;/code> çš„ä¿¡æ¯ï¼Œæœ€åŽä¸€ä¸ªçŠ¶æ€ $h_t$ åŒ…å«æ•´å¥è¯ &lt;code>I love the movice so much&lt;/code> çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥ä»Ž &lt;code>PyTorch&lt;/code> ä¸­èŽ·å–æ‰€æœ‰çš„çŠ¶æ€ $h={h_1, h_2, &amp;hellip;, h_t}$ï¼Œä¹Ÿå¯ä»¥åªèŽ·å¾—æœ€åŽä¸€ä¸ªçŠ¶æ€å‘é‡ $h_t$ çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>$h_t$ ç§¯ç´¯äº†æ•´å¥è¯çš„ä¿¡æ¯ï¼Œæ‰€æœ‰é€šå¸¸ä½¿ç”¨ $h_t$ è¿™ä¸€ä¸ªå‘é‡å°±å¤Ÿäº†ï¼Œè¿™é‡Œæˆ‘ä»¬åªä½¿ç”¨ $h_t$ï¼ŒæŠŠå‰é¢çš„æ‰€æœ‰çŠ¶æ€ ${h_1, h_2, &amp;hellip;, h_{t-1}}$ å…¨éƒ¨éƒ½ä¸¢æŽ‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/15.png"
loading="lazy"
alt="15"
>&lt;/p>
&lt;p>$h_t$ ç›¸å½“äºŽä»Žæ–‡æœ¬ä¸­æå–çš„ç‰¹å¾å‘é‡ï¼ŒæŠŠ $h_t$ è¾“å…¥è¿™ä¸ªåˆ†ç±»å™¨ $sigmoid(v^T h_t)$ï¼Œåˆ†ç±»å™¨å°±ä¼šè¾“å‡ºä¸€ä¸ª &lt;code>0&lt;/code> æˆ– &lt;code>1&lt;/code> ä¹‹é—´çš„æ•°å€¼ï¼Œ&lt;code>0&lt;/code> ä»£è¡¨äº†è´Ÿé¢ç”µå½±è¯„ä»·ï¼Œ&lt;code>1&lt;/code> ä»£è¡¨æ­£é¢ç”µå½±è¯„ä»·ã€‚&lt;/p>
&lt;p>ç„¶åŽæˆ‘ä»¬è®¾ç½®è¶…å‚æ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>è®¾ç½® &lt;code>vocabulary = 1000&lt;/code>ï¼Œæ„æ€æ˜¯è¯å…¸é‡Œæœ‰ &lt;code>10000&lt;/code> ä¸ªè¯æ±‡ï¼›&lt;/li>
&lt;li>&lt;code>embedding_dim = 32&lt;/code>ï¼Œæ„æ€æ˜¯è¯å‘é‡ $x$ çš„ç»´åº¦æ˜¯ $32$ï¼›&lt;/li>
&lt;li>&lt;code>word_num = 500&lt;/code>ï¼Œæ„æ€æ˜¯æ¯æ¡ç”µå½±è¯„ä»·æœ‰ &lt;code>500&lt;/code> ä¸ªå•è¯ï¼Œå¦‚æžœè¶…è¿‡ &lt;code>500&lt;/code> ä¸ªå•è¯ï¼Œå°±ä¼šè¢«æˆªæŽ‰ï¼Œåªä¿ç•™ &lt;code>500&lt;/code> ä¸ªï¼Œå¦‚æžœä¸å¤Ÿ &lt;code>500&lt;/code>ï¼Œå°±ç”¨ &lt;code>zero_padding&lt;/code> å°†å¥å­è¡¥æˆé•¿åº¦ä¸º &lt;code>500&lt;/code>ï¼›&lt;/li>
&lt;li>&lt;code>state_dim = 32&lt;/code>ï¼Œæ„æ€æ˜¯çŠ¶æ€ $h$ çš„ç»´åº¦ç­‰äºŽ $32$ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="-pytorch-å®žçŽ°">ðŸ‘©â€ðŸš’ PyTorch å®žçŽ°&lt;/h3>
&lt;p>æŽ¥ä¸‹æ¥å¼€å§‹æ­ç½‘ç»œï¼Œé¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±» &lt;code>Model&lt;/code>ï¼Œæˆ‘ä»¬è®©å®ƒç»§æ‰¿ &lt;code>nn.Model&lt;/code> çˆ¶ç±»ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">nn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Model&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Module&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">vocabulary_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">embedding_dim&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">state_dim&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Model&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vocabulary_size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">vocabulary_size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">embedding_dim&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">embedding_dim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">state_dim&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">state_dim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Embedding&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Embedding&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vocabulary_size&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">embedding_dim&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">RNN&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">RNN&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">embedding_dim&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">state_dim&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">state_dim&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sigmoid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Sigmoid&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transpose&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">embedded&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Embedding&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">h_n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">RNN&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">embedded&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">h_n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">squeeze&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h_n&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dim&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h_n&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sigmoid&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨æž„é€ å‡½æ•° &lt;code>__init__&lt;/code> ä¸­å®šä¹‰æˆ‘ä»¬çš„æ¨¡åž‹ç»“æž„ï¼Œå¹¶é‡è½½ &lt;code>forword&lt;/code> æ–¹æ³•ã€‚&lt;/p>
&lt;p>é¦–å…ˆæ˜¯è¯åµŒå…¥å±‚ &lt;code>nn.Embedding()&lt;/code>ï¼Œå®ƒæ˜¯æŠŠè¯æ˜ å°„æˆå‘é‡ã€‚&lt;/p>
&lt;p>ç„¶åŽæ˜¯ simple RNN å±‚ &lt;code>nn.RNN()&lt;/code>ï¼Œéœ€è¦æŒ‡å®šè¯å‘é‡çš„ç»´åº¦ &lt;code>embedding_dim&lt;/code> å’ŒçŠ¶æ€å‘é‡ $h$ çš„ç»´åº¦ &lt;code>state_dim&lt;/code>ï¼›&lt;/p>
&lt;p>æœ€åŽæ˜¯ä¸€ä¸ªå…¨è¿žæŽ¥å±‚ &lt;code>nn.Linear()&lt;/code>ï¼Œå¹¶ä¸”ä¼šä½¿ç”¨ &lt;code>nn.Sigmoid()&lt;/code> ä½œç”¨äºŽå®ƒçš„ç»“æžœï¼Œè¾“å…¥æœ€åŽä¸€ä¸ªçŠ¶æ€å‘é‡ $h$ï¼Œè¾“å‡ºä¸€ä¸ª &lt;code>0ã€1&lt;/code> ä¹‹é—´çš„æ•°ã€‚&lt;/p>
&lt;p>&lt;code>PyTorch&lt;/code> ä¸­çš„ &lt;code>RNN&lt;/code> ä¼šæœ‰ä¸¤ä¸ªè¿”å›žå€¼ï¼š&lt;code>output&lt;/code>ï¼Œ&lt;code>h_n&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>output&lt;/code> æ˜¯ &lt;code>RNN&lt;/code> æ‰€æœ‰æ—¶åˆ»çš„çŠ¶æ€å‘é‡é›†åˆï¼ˆçŸ©é˜µï¼‰ï¼›&lt;/li>
&lt;li>&lt;code>h_n&lt;/code> æ˜¯ &lt;code>RNN&lt;/code> ä¸­æœ€åŽä¸€ä¸ªçŠ¶æ€å‘é‡ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿™æ˜¯æ¨¡åž‹çš„ä¸€ä¸ªæ¦‚è¦ï¼Œ è¯åµŒå…¥å±‚ &lt;code>Embedding&lt;/code> çš„è¾“å‡ºæ˜¯ä¸€ä¸ª $500*32$ çš„çŸ©é˜µï¼Œ&lt;code>500&lt;/code> çš„æ„æ€æ˜¯æ¯ä¸ªå¥å­æœ‰ $500$ ä¸ªè¯ï¼Œ&lt;code>32&lt;/code> çš„æ„æ€æ˜¯æ¯ä¸ªè¯ç”¨ $32$ ç»´çš„è¯å‘é‡è¡¨ç¤ºã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">==========================================================================================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Layer (type:depth-idx) Output Shape Param #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">==========================================================================================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Model -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€Embedding: 1-1 [500, 1, 32] 320,000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€RNN: 1-2 [500, 1, 32] 2,112
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€Linear: 1-3 [1, 1] 33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€Sigmoid: 1-4 [1, 1] --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">==========================================================================================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total params: 322,145
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Trainable params: 322,145
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>Simple RNN&lt;/code> æ¯ä¸ªçŠ¶æ€çš„è¾“å‡º $h_t$ éƒ½æ˜¯ä¸€ä¸ª &lt;code>32&lt;/code> ç»´çš„å‘é‡ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ RNN çš„å‚æ•°ï¼Œä»–æœ‰ &lt;code>2080&lt;/code> ä¸ªå‚æ•°ï¼Œå®ƒæ˜¯è¿™æ ·ç®—å‡ºæ¥çš„ï¼š&lt;/p>
&lt;p>$shape(h) * (shape(h)+shape(x)) = 32*(32+32)+32 = 2080$&lt;/p>
&lt;p>è¿™æ˜¯çŸ©é˜µ $A$ çš„å¤§å°ï¼ŒåŽé¢çš„ $32$ çš„ç»´åº¦æ¥è‡ª &lt;code>intercept&lt;/code>ï¼Œä¹Ÿå« &lt;code>bias&lt;/code>ï¼Œåç§»é‡ã€‚RNN ä¼šé»˜è®¤ä½¿ç”¨ &lt;code>intercept&lt;/code>ï¼Œä½†è¿™ä¸ªä¸é‡è¦ï¼Œè¿™é‡Œæš‚æ—¶ä¸ç®¡å®ƒã€‚&lt;/p>
&lt;p>å‰©ä¸‹çš„ &lt;code>32&lt;/code> ä¸ªå‚æ•°æ¥è‡ªäºŽæœ€åŽä¸€ä¸ªçŠ¶æ€ï¼Œå› ä¸º &lt;code>PyTorch&lt;/code> ä¸­çš„ &lt;code>RNN&lt;/code> ä¼šåŒæ—¶è¾“å‡ºæ‰€æœ‰æ—¶åˆ»çš„çŠ¶æ€å‘é‡é›†åˆå’Œæœ€åŽä¸€ä¸ªçŠ¶æ€å‘é‡ã€‚&lt;/p>
&lt;h3 id="-è¿è¡Œæ¨¡åž‹">ðŸ§‘â€ðŸ”§ è¿è¡Œæ¨¡åž‹&lt;/h3>
&lt;p>æ­å¥½æ¨¡åž‹ä¹‹åŽï¼Œåˆå§‹åŒ–æ¨¡åž‹ï¼Œç„¶åŽç”¨è®­ç»ƒæ•°æ®æ‹Ÿåˆæ¨¡åž‹ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬æŒ‡å®šç®—æ³•æ˜¯ &lt;code>optim.Adam&lt;/code>ï¼ŒæŸå¤±å‡½æ•°æ˜¯ &lt;code>nn.BCELoss()&lt;/code>ï¼Œè¯„ä»·æ ‡å‡†æ˜¯å‡†ç¡®çŽ‡ &lt;code>accuracy&lt;/code>ã€‚&lt;/p>
&lt;p>ç„¶åŽç”¨è®­ç»ƒæ•°æ®æ‹Ÿåˆæ¨¡åž‹ï¼Œæˆ‘è®©ç®—æ³•è®­ç»ƒ &lt;code>3&lt;/code> ä¸ª &lt;code>epochs&lt;/code>ï¼Œåªè®©ç®—æ³•è¿è¡Œ &lt;code>3&lt;/code> ä¸ª epochsï¼Œæ˜¯å‡ºçŽ°äº†è¿‡æ‹Ÿåˆï¼Œ&lt;code>3&lt;/code> ä¸ª &lt;code>epochs&lt;/code> ä¹‹åŽï¼Œ&lt;code>validate accuracy&lt;/code> ä¼šå˜å·®ã€‚æå‰è®©ç®—æ³•åœæ­¢è¿è¡Œç§°ä¸º &lt;code>early stoping&lt;/code> æå‰ç»ˆæ­¢è®­ç»ƒï¼Œä½¿ &lt;code>validate accuracy&lt;/code> å˜å·®ä¹‹å‰å°±åœæ­¢ã€‚&lt;/p>
&lt;p>æœ€åŽï¼Œç”¨æµ‹è¯•æ•°æ®è¯„ä»·æ¨¡åž‹çš„è¡¨çŽ°ï¼ŒæŠŠæµ‹è¯•æ•°æ®ä½œä¸ºè¾“å…¥ï¼Œè°ƒç”¨ &lt;code>model.evaluate()&lt;/code>ï¼Œè¿”å›ž loss å’Œ accuracyï¼Œæµ‹è¯•çš„ accuracyï¼Œæµ‹è¯•çš„ accuracy æ˜¯ 84.36%ï¼Œæ¯”ä¸Šä¸€èŠ‚ä¸­çš„ é€»è¾‘å›žå½’å¥½å¾ˆå¤šï¼ˆ75%ï¼‰ã€‚&lt;/p>
&lt;p>åˆšæ‰æ­æ¨¡åž‹çš„æ—¶å€™ï¼Œåªä½¿ç”¨äº†RNNæœ€åŽä¸€ä¸ªçŠ¶æ€ $h_t$ï¼ŒæŠŠä¹‹å‰çš„çŠ¶æ€éƒ½ä¸¢æŽ‰äº†ï¼Œæƒ³ç”¨ $h_0$ åˆ° $h_t$ æ‰€æœ‰çŠ¶æ€ä¹Ÿå¯ä»¥ï¼Œä½†å¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬è®© &lt;code>RNN&lt;/code> çš„ç¬¬ä¸€ä¸ªè¾“å‡º &lt;code>output&lt;/code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªçŸ©é˜µï¼ŒçŸ©é˜µæ¯ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªçŠ¶æ€å‘é‡ $h$ã€‚&lt;/p>
&lt;p>å¦‚æžœç”¨æ‰€æœ‰çŠ¶æ€ï¼Œå°±è¦åŠ ä¸€ä¸ª &lt;code>flatten&lt;/code> å±‚ï¼Œå°†çŠ¶æ€çŸ©é˜µå˜æˆä¸€ä¸ªå‘é‡ï¼Œç„¶åŽæŠŠè¿™ä¸ªå‘é‡ä½œä¸ºåˆ†ç±»å™¨çš„è¾“å…¥ï¼Œæ¥åˆ¤æ–­ç”µå½±æ˜¯æ­£é¢çš„ï¼Œè¿˜æ˜¯è´Ÿé¢çš„ã€‚åªè¦æŠŠç½‘ç»œç¨ä½œæ”¹åŠ¨å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">flatten&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">start_dim&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">end_dim&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-simple-rnn-çš„ç¼ºé™·">ðŸ§° simple RNN çš„ç¼ºé™·&lt;/h2>
&lt;p>ä¸‹é¢çœ‹ä¸€ä¸‹ &lt;code>simple RNN&lt;/code> è¿™ç§ç®€å•çš„æ¨¡åž‹æœ‰ä»€ä¹ˆç¼ºé™·ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªæ —å­ ðŸŒ° ï¼ŒçŽ°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œç»™å®šåŠå¥è¯ï¼Œè¦æ±‚é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/16.png"
loading="lazy"
alt="16"
>&lt;/p>
&lt;p>è¾“å…¥æ˜¯ &lt;code>clouds are in the&lt;/code>ï¼Œæ­£ç¡®çš„è¾“å‡ºåº”è¯¥æ˜¯ &lt;code>sky&lt;/code>ï¼Œå¦‚æžœåœ¨å¤§é‡æ–‡æœ¬ä¸­é¢„æµ‹ RNNï¼Œåº”è¯¥æ˜¯æœ‰èƒ½åŠ›åšå‡ºè¿™æ ·çš„é¢„æµ‹çš„ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œ&lt;code>RNN&lt;/code> åªéœ€è¦çœ‹æœ€è¿‘çš„å‡ ä¸ªè¯ï¼Œå°¤å…¶æ˜¯ &lt;code>clouds are&lt;/code>ï¼Œå¹¶ä¸éœ€è¦æ›´å¤šçš„ä¸Šä¸‹æ–‡çœ‹çš„æ›´è¿œã€‚&lt;/p>
&lt;p>è¿™ä¸ªä¾‹å­æ˜¯å¯¹ &lt;code>simple RNN&lt;/code> ååˆ†æœ‰åˆ©ï¼Œ&lt;code>simple RNN&lt;/code> ç‰¹åˆ«æ“…é•¿è¿™ç§ &lt;code>short-term dependence&lt;/code>ï¼Œ&lt;code>simple RNN&lt;/code> ä¸æ“…é•¿çš„æ˜¯ &lt;code>long-term dependence&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>RNN&lt;/code> çš„çŠ¶æ€ $h$ï¼Œå’Œä¹‹å‰æ‰€æœ‰çš„è¾“å…¥ $x$ éƒ½æœ‰å‡½æ•°ä¾èµ–å…³ç³»ï¼Œç…§ç†æ¥è¯´ï¼Œå¦‚æžœæ”¹å˜è¾“å…¥çš„å•è¯ $x_1$ï¼Œæ‰€æœ‰çš„çŠ¶æ€ $h$ éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†å®žé™…ä¸Šï¼Œ&lt;code>simple RNN&lt;/code> å¹¶æ²¡æœ‰è¿™ç§æ€§è´¨ï¼Œæ‰€ä»¥å¾ˆä¸åˆç†ã€‚å¦‚æžœæŠŠç¬¬ &lt;code>100&lt;/code> ä¸ªçŠ¶æ€å‘é‡ $h_{100}$ï¼Œå…³äºŽè¾“å…¥ $x_1$ æ±‚å¯¼ï¼Œä½ ä¼šå‘çŽ°å¯¼æ•°å‡ ä¹Žç­‰äºŽ &lt;code>0&lt;/code>ã€‚&lt;/p>
&lt;p>$\frac{\partial h_{100}}{\partial x_1} \approx 0$&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/17.png"
loading="lazy"
alt="17"
>&lt;/p>
&lt;p>å¯¼æ•°å‡ ä¹Žç­‰äºŽ &lt;code>0&lt;/code> è¯´æ˜Žä»€ä¹ˆå‘¢ï¼Ÿè¯´æ˜Žå½“æˆ‘ä»¬æ”¹å˜ $x_1$æ—¶ï¼Œ$h_{100}$ å‡ ä¹Žä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´çŠ¶æ€ $h_{100}$ å’Œ &lt;code>100&lt;/code> æ­¥ä¹‹å‰çš„è¾“å…¥ $x_1$ å‡ ä¹Žæ²¡æœ‰å…³ç³»ï¼Œè¿™æ˜¾ç„¶ä¸åˆç†ï¼Œè¯´æ˜ŽçŠ¶æ€ $h_{100}$ å‡ ä¹ŽæŠŠå¾ˆå¤šæ­¥ä¹‹å‰çš„è¾“å…¥éƒ½ç»™å¿˜è®°äº†ï¼Œ&lt;code>simple RNN&lt;/code> çš„è¿™ç§é—å¿˜ä¼šç»™åŽç»­æ“ä½œé€ æˆå¾ˆå¤šé—®é¢˜ã€‚&lt;/p>
&lt;p>å†ä¸¾ä¸ªæ —å­ ðŸŒ° ï¼Œè¿™æ˜¯å¾ˆé•¿çš„ä¸€æ®µè¯ï¼Œä¸€å¼€å§‹æ˜¯ &lt;code>I grow up in China when I was a child, ... ...&lt;/code> åˆ°äº†å¾ˆå¤šå¥è¯ä¹‹åŽï¼Œæœ‰è¿™æ ·ä¸€å¥ï¼Œ&lt;code>I speak fluent ...&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/18.png"
loading="lazy"
alt="18"
>&lt;/p>
&lt;p>ä¸‹ä¸€ä¸ªè¯åº”è¯¥æ˜¯ &lt;code>Chinese&lt;/code>ï¼Œæˆ‘å°æ—¶å€™åœ¨ä¸­å›½ï¼Œæ‰€æœ‰ä¼šè¯´æµåˆ©çš„ä¸­æ–‡ï¼Œç„¶è€Œ &lt;code>simple RNN&lt;/code> ä¸å¤ªå¯èƒ½ä¼šåšå‡º &lt;code>Chinese&lt;/code> è¿™ä¸ªæ­£ç¡®çš„é¢„æµ‹ï¼Œå› ä¸º RNN å·²ç»æŠŠå‰æ–‡ç»™å¿˜è®°äº†ã€‚&lt;code>simple RNN&lt;/code> æ“…é•¿çš„æ˜¯ &lt;code>short-term dependence&lt;/code>ï¼ŒRNN çœ‹åˆ°æœ€è¿‘çš„å•è¯æ˜¯ &lt;code>speak fluent&lt;/code>ï¼Œæ‰€ä»¥ RNN çŸ¥é“ä¸‹ä¸€ä¸ªå•è¯å¯èƒ½æ˜¯æŸç§è¯­è¨€ï¼Œå¯èƒ½æ˜¯ &lt;code>Chineseã€Englishã€Frenchã€Japanese&lt;/code> ç­‰ç­‰ï¼Œä½†æ­£ç¡®ç­”æ¡ˆæ˜¯ &lt;code>Chinese&lt;/code>ï¼Œå› ä¸ºä¸Šæ–‡æœ‰ &lt;code>I grow up in china when i was child&lt;/code>ï¼Œsimple RNN å°±åƒé‡‘é±¼ä¸€æ ·è®°å¿†åŠ›åªæœ‰ &lt;code>7&lt;/code> ç§’ï¼Œ&lt;code>RNN&lt;/code> æ ¹æœ¬å°±ä¸è®°å¾—ä¸Šæ–‡æœ‰è¿™å¥è¯ï¼Œæ‰€ä»¥ &lt;code>I speak fluent ...&lt;/code> é¢„æµ‹å•è¯å¯èƒ½æ˜¯ &lt;code>English , French&lt;/code> ç­‰ä»»ä½•ä¸€ç§è¯­è¨€ï¼Œæœªå¿…æ˜¯ &lt;code>Chinese&lt;/code>ã€‚&lt;/p>
&lt;h2 id="-æ€»ç»“">ðŸŽ æ€»ç»“&lt;/h2>
&lt;p>æœ€åŽæ€»ç»“ä¸€ä¸‹è¿™ä¸€èŠ‚çš„å†…å®¹ï¼š&lt;/p>
&lt;p>&lt;code>RNN&lt;/code> æ˜¯ä¸€ç§ç¥žç»ç½‘ç»œï¼Œä½†æ˜¯ä»–çš„ç»“æž„ä¸åŒäºŽå…¨è¿žæŽ¥ç½‘ç»œå’Œå·ç§¯ç½‘ç»œï¼Œ&lt;code>RNN&lt;/code> é€‚ç”¨äºŽæ–‡æœ¬ï¼Œè¯­éŸ³ç­‰æ—¶åºåºåˆ—æ•°æ®ï¼Œ&lt;code>RNN&lt;/code> æŒ‰ç…§é¡ºåºè¯»å–æ¯ä¸€ä¸ªè¯å‘é‡ï¼Œå¹¶ä¸”åœ¨çŠ¶æ€å‘é‡ $h$ ä¸­ç§¯ç´¯çœ‹åˆ°è¿‡å¾—ä¿¡æ¯ï¼Œ$h_0$ ä¸­åŒ…å«äº† $x_0$ çš„ä¿¡æ¯ï¼Œ$h_1$ ä¸­åŒ…å«äº† $x_0$ å’Œ $x_1$ çš„ä¿¡æ¯ï¼Œ$h_t$ ä¸­ç§¯ç´¯äº†ä¹‹å‰æ‰€æœ‰ $x={x_0, x_1, &amp;hellip;, x_t}$ çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/19.png"
loading="lazy"
alt="19"
>&lt;/p>
&lt;p>æœ‰ä¸€ç§é”™è¯¯çš„çœ‹æ³•æ˜¯ $h_t$ ä¸­åªåŒ…å«äº† $x_t$ çš„ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸å¯¹çš„ï¼Œ$h_t$ ä¸­åŒ…å«äº†ä¹‹å‰æ‰€æœ‰è¾“å…¥çš„ä¿¡æ¯ï¼Œå¯ä»¥è®¤ä¸º $h_t$ ä»£è¡¨äº† &lt;code>RNN&lt;/code> ä»Žæ•´ä¸ªåºåˆ—ä¸­æŠ½å–çš„ç‰¹å¾å‘é‡ï¼Œæ‰€æœ‰æˆ‘ä»¬åªéœ€è¦ $h_t$ å°±å¯ä»¥åˆ¤æ–­ç”µå½±è¯„ä»·æ˜¯æ­£é¢çš„è¿˜æ˜¯è´Ÿé¢çš„ã€‚&lt;/p>
&lt;p>&lt;code>simple RNN&lt;/code> æœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µ $A$ï¼Œå®ƒå¯èƒ½è¿˜ä¼šä¸€ä¸ª &lt;code>intercept&lt;/code> å‚æ•°å‘é‡ $b$ï¼Œä¸Šé¢çš„ä»‹ç»ä¸­å¿½ç•¥äº†è¿™ä¸ªå‚æ•°å‘é‡ $b$ï¼Œè¿™ä¸ªå‚æ•°çŸ©é˜µ $A$ çš„ç»´åº¦æ˜¯ï¼š&lt;/p>
&lt;p>$shape(h) * [shape(h) + shape(x)]$&lt;/p>
&lt;p>å‚æ•°çŸ©é˜µ $A$ ä¸€å¼€å§‹éšæœºåˆå§‹åŒ–ï¼Œç„¶åŽä»Žè®­ç»ƒæ•°æ®ä¸Šå­¦ä¹ ã€‚æ³¨æ„ï¼š&lt;code>simple RNN&lt;/code> åªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µï¼Œä¸ç®¡è¿™ä¸ªåºåˆ—æœ‰å¤šé•¿ï¼Œå‚æ•°çŸ©é˜µåªæœ‰ä¸€ä¸ªï¼Œæ‰€æœ‰æ¨¡å—é‡Œçš„å‚æ•°éƒ½æ˜¯ä¸€æ ·çš„ã€‚&lt;/p>
&lt;p>&lt;code>RNN&lt;/code> æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œ&lt;code>RNN&lt;/code> çš„è®°å¿†æ¯”è¾ƒçŸ­ï¼Œä¼šé—å¿˜å¾ˆä¹…ä¹‹å‰çš„è¾“å…¥ $x$ï¼Œå¦‚æžœè¿™ä¸ªæ—¶é—´åºåˆ—å¾ˆé•¿ï¼Œæœ‰å¥½å‡ åæ­¥ï¼Œæœ€ç»ˆ &lt;code>RNN&lt;/code> å°±ä¼šå¿˜è®°äº†ä¹‹å‰çš„è¾“å…¥ã€‚ä¸‹ä¸€èŠ‚å°†ä»‹ç» &lt;code>LSTM&lt;/code>ï¼Œ&lt;code>LSTM&lt;/code> çš„è®°å¿†ä¼šæ¯” &lt;code>simple RNN&lt;/code> é•¿å¾ˆå¤šï¼Œä½†æ˜¯ &lt;code>RNN&lt;/code> ä¹Ÿè¿˜æ˜¯ä¼šæœ‰é—å¿˜çš„é—®é¢˜ã€‚&lt;/p></description></item><item><title>æ•°æ®å¤„ç†åŸºç¡€</title><link>https://www.letout.cn/p/nlp-in-action/data-processing/</link><pubDate>Tue, 01 Mar 2022 02:02:02 +0800</pubDate><guid>https://www.letout.cn/p/nlp-in-action/data-processing/</guid><description>&lt;img src="https://nlp.letout.cn/img/banner.png" alt="Featured image of post æ•°æ®å¤„ç†åŸºç¡€" />&lt;hr>
&lt;p>&lt;a class="link" href="https://nlp.letout.cn/nlp/data-processing" target="_blank" rel="noopener"
>ðŸš² è½¬åˆ° https://nlp.letout.cn ðŸ”” æ•°æ®å¤„ç†åŸºç¡€ âž¡ï¸&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="-ç±»åˆ«ç‰¹å¾">ðŸŒ± ç±»åˆ«ç‰¹å¾&lt;/h2>
&lt;p>æœºå™¨å­¦ä¹ çš„æ•°æ®é€šå¸¸æœ‰ &lt;strong>ç±»åˆ«ç‰¹å¾&lt;/strong> &lt;code>Categorical Features&lt;/code> ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç±»åˆ«ç‰¹å¾ &lt;code>Categorical Features&lt;/code> è½¬åŒ–æˆæœºå™¨å­¦ä¹ æ¨¡åž‹èƒ½ç†è§£çš„æ•°å€¼ç‰¹å¾ï¼Œä¸‹é¢ä½¿ç”¨ä¸€ä¸ªä¾‹å­æ¥å…·ä½“è®²è§£ç±»åˆ«ç‰¹å¾æ•°æ®çš„å¤„ç†ã€‚&lt;/p>
&lt;p>è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªäººçš„æ•°æ®ï¼ŒåŒ…æ‹¬ï¼šå¹´é¾„ã€æ€§åˆ«ã€å›½ç±ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™äº›æ•°æ®å˜æˆæœºå™¨å­¦ä¹ æ¨¡åž‹å¯ä»¥ç†è§£çš„æ•°å€¼ç‰¹å¾ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/table.png"
loading="lazy"
alt="table"
>&lt;/p>
&lt;p>è¡¨æ ¼çš„ç¬¬ä¸€åˆ—æ˜¯å¹´é¾„ï¼Œå¹´é¾„æœ¬èº«å°±æ˜¯æ•°å€¼ç‰¹å¾ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨åšå¤„ç†ï¼Œæ•°å€¼ç‰¹å¾çš„ç‰¹ç‚¹æ˜¯å¯ä»¥æ¯”è¾ƒå¤§å°ï¼Œæ¯”å¦‚ &lt;code>35&lt;/code> å²çš„äººæ¯” &lt;code>31&lt;/code> å²çš„å¹´é¾„å¤§ã€‚&lt;/p>
&lt;p>ç¬¬äºŒåˆ—æ˜¯æ€§åˆ«ï¼Œæ€§åˆ«æ˜¯äºŒå…ƒç‰¹å¾ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ•°æ¥è¡¨ç¤ºæ€§åˆ«ã€‚ç”¨ &lt;code>0&lt;/code> è¡¨ç¤ºå¥³æ€§ï¼Œç”¨ &lt;code>1&lt;/code> è¡¨ç¤ºç”·æ€§ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ€§åˆ«å°±è¡¨ç¤ºä¸ºä¸€ä¸ªæ ‡é‡ï¼š&lt;code>0&lt;/code> / &lt;code>1&lt;/code>ã€‚&lt;/p>
&lt;p>ç¬¬ä¸‰åˆ—æ˜¯å›½ç±ï¼Œæ¯”å¦‚ä¸­å›½ï¼Œç¾Žå›½ï¼Œå°åº¦ã€‚å›½ç±æ˜¯ç±»åˆ«ç‰¹å¾ï¼Œæœºå™¨å­¦ä¹ å¹¶ä¸ç†è§£å›½ç±ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠå›½ç±ç¼–ç æˆæ•°å€¼å‘é‡ã€‚ä¸–ç•Œä¸Šçº¦æœ‰ &lt;code>197&lt;/code> ä¸ªå›½å®¶ï¼Œæˆ‘ä»¬å…ˆç”¨ä¸€ä¸ª &lt;code>[1 - 197]&lt;/code> çš„æ•´æ•°è¡¨ç¤ºä¸€ä¸ªå›½å®¶ã€‚å¯ä»¥å»ºç«‹ä¸€ä¸ªå­—å…¸ï¼ŒæŠŠå›½ç±æ˜ å°„æˆä¸€ä¸ª &lt;code>[1 - 197]&lt;/code> çš„æ•´æ•°ã€‚æ¯”å¦‚ï¼š&lt;code>China:1; US:2; India:3; Japan:4; Germany:5&lt;/code>ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>&lt;strong>æˆ‘ä»¬è¦ä»Ž 1 å¼€å§‹è®¡ç®—ï¼Œè€Œä¸èƒ½ä»Ž 0 å¼€å§‹è®¡ç®—ã€‚&lt;/strong>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>åšè¿™ç§æ˜ å°„ï¼Œå›½ç±å°±è¡¨ç¤ºæˆ &lt;code>[1 - 197]&lt;/code> ä¹‹é—´çš„æ•´æ•°ã€‚ä»…ä»…æŠŠå›½ç±è¡¨ç¤ºæˆ &lt;code>[1 - 197]&lt;/code> çš„æ•´æ•°è¿˜æ˜¯ä¸è¡Œï¼Œä¸€ä¸ªæ•´æ•°åªæ˜¯ä¸€ç§ç±»åˆ«ï¼Œå®ƒä»¬ä¹‹é—´ä¸èƒ½æ¯”è¾ƒå¤§å°ã€‚&lt;code>US:2; India:3&lt;/code> è¿™ä¸ªæ•°å­—å¹¶ä¸è¡¨ç¤ºå°åº¦å¤§äºŽç¾Žå›½ï¼Œè¿™äº›æ•´æ•°åªæ˜¯ç±»åˆ«è€Œå·²ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„æ•°å€¼ç‰¹å¾ã€‚&lt;/p>
&lt;p>æ‰€ä»¥è¦è¿›ä¸€æ­¥å¯¹å›½ç±åš &lt;code>one-hot encoding&lt;/code> ï¼Œç”¨ &lt;code>one-hot&lt;/code> å‘é‡æ¥è¡¨ç¤ºå›½ç±ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">China -&amp;gt; 1 -&amp;gt; [1,0,0,0,...,0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">US -&amp;gt; 2 -&amp;gt; [0,1,0,0,...,0]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¯”å¦‚ï¼Œä¸­å›½å¯¹åº” 1ï¼Œæ‰€ä»¥ç”¨ 197 ç»´çš„ &lt;code>one-hot&lt;/code> å‘é‡ &lt;code>[1,0,0,0...,0]&lt;/code> æ¥è¡¨ç¤ºï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ï¼›ç¾Žå›½å¯¹åº” 2ï¼Œè¿™ä¸ª 197 ç»´çš„å‘é‡ &lt;code>[0,1,0,0...,0]&lt;/code> ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªå›½ç±å°±ç”±ä¸€ä¸ª &lt;code>one-hot&lt;/code> å‘é‡è¡¨ç¤ºï¼Œä¸€å…±æœ‰ 197 ä¸ªå›½å®¶ï¼Œæ‰€ä»¥æ¯ä¸ªå‘é‡éƒ½æ˜¯ 197 ç»´çš„ã€‚&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->æˆ‘ä»¬è¦ä»Ž 1 å¼€å§‹è®¡ç®—ï¼Œè€Œä¸èƒ½ä»Ž 0 å¼€å§‹è®¡ç®—ã€‚&lt;!-- raw HTML omitted -->
å› ä¸ºæˆ‘ä»¬è¦æŠŠ 0 ä¿ç•™ï¼Œç”¨æ¥è¡¨ç¤ºæœªçŸ¥æˆ–è€…ç¼ºå¤±çš„å›½ç±ã€‚æ•°æ®åº“é‡Œé¢ç»å¸¸ä¼šæœ‰ç¼ºå¤±çš„æ•°æ®ï¼ˆæ¯”å¦‚ç”¨æˆ·æ²¡æœ‰å¡«å†™å›½ç±ï¼‰ï¼Œè¿™æ ·ç¼ºå¤±çš„å›½ç±å°±ç”¨ 0 æ¥è¡¨ç¤ºï¼Œå®ƒçš„ &lt;code>one-hot&lt;/code> å‘é‡å°±æ˜¯ä¸€ä¸ªå…¨ 0 çš„å‘é‡&lt;code>[0,0,0,0...,0]&lt;/code>ã€‚&lt;/p>
&lt;p>ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª 199 ç»´è¡¨ç¤ºä¸€ä¸ªäººçš„ç‰¹å¾ã€‚æ¯”å¦‚è¿™ä¸ªäºº 28 å²ï¼Œå¥³æ€§ï¼Œå›½ç±æ˜¯ä¸­å›½ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/1.png"
loading="lazy"
alt="1"
>&lt;/p>
&lt;p>å…¶ä¸­ï¼Œä¸€ä¸ªç»´åº¦è¡¨ç¤ºå¹´é¾„ï¼Œä¸€ä¸ªç»´åº¦è¡¨ç¤ºæ€§åˆ«ï¼Œä¸€ä¸ª 197 ç»´çš„ &lt;code>one-hot&lt;/code> å‘é‡è¡¨ç¤ºå›½ç±ã€‚&lt;/p>
&lt;p>è¿™ä¸ªä¾‹å­é‡Œï¼Œè¿™ä¸ª 36 å²ï¼Œç”·æ€§ï¼Œå›½ç±æœªçŸ¥çš„äººçš„ç‰¹å¾æ˜¯è¿™ä¸ª 199 ç»´çš„å‘é‡ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª 197 ç»´çš„å…¨ 0 å‘é‡è¡¨ç¤ºæœªçŸ¥å›½ç±ã€‚&lt;/p>
&lt;h2 id="-ä¸ºä»€ä¹ˆè¦ç”¨-one-hot-å‘é‡è¡¨ç¤ºç‰¹å¾">ðŸ”– ä¸ºä»€ä¹ˆè¦ç”¨ one-hot å‘é‡è¡¨ç¤ºç‰¹å¾&lt;/h2>
&lt;p>åœ¨å¤„ç†ç±»åˆ«ç‰¹å¾çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code>one-hot&lt;/code> å‘é‡è¡¨ç¤ºå›½ç±ï¼Œæ¯ä¸ªå›½ç±éƒ½ç”¨ 197 ç»´çš„å‘é‡è¡¨ç¤ºã€‚ä¸ºä»€ä¹ˆè¦ç”¨ &lt;code>one-hot&lt;/code> å‘é‡è€Œä¸ç”¨ä¸€ä¸ªæ•°å­—è¡¨ç¤ºå‘¢ï¼Ÿæ¯”å¦‚ç”¨ 1 è¡¨ç¤ºä¸­å›½ï¼Œ2 è¡¨ç¤ºç¾Žå›½ï¼Œ3 è¡¨ç¤ºå°åº¦ã€‚è¿™æ ·ä¸€æ¥ï¼Œåå­—å°±å˜æˆäº†æ•°å­—ï¼Œå¯ä»¥åšæ•°å€¼è®¡ç®—ï¼Œè€Œä¸”ç”¨ä¸€ä¸ªæ•°å­—è¡¨ç¤ºçš„è¯ï¼Œå¯ä»¥èŠ‚çœ 197 å€çš„å­˜å‚¨ç©ºé—´ã€‚å½“ç„¶è¿™æ˜¯ä¸è¡Œçš„ã€‚å¦åˆ™æˆ‘ä»¬å°±ä¸éœ€è¦ &lt;code>one-hot encoding&lt;/code> äº†ã€‚&lt;/p>
&lt;p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨ &lt;code>1 -&amp;gt; China; 2 -&amp;gt; US; 3 -&amp;gt; India&lt;/code>ã€‚é‚£ä¹ˆå°†ä¸­å›½ &lt;code>1&lt;/code> å’Œç¾Žå›½ &lt;code>2&lt;/code> çš„ç‰¹å¾åŠ èµ·æ¥ï¼š&lt;code>1+2=3&lt;/code> ï¼Œç›¸å½“äºŽ â€œä¸­å›½ + ç¾Žå›½ = å°åº¦â€ã€‚è¿™æ ·çš„ç‰¹å¾å®Œå…¨ä¸åˆç†ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/2.png"
loading="lazy"
alt="2"
>&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>one-hot&lt;/code> ç‰¹å¾å‘é‡æ›´åˆç†ã€‚å°† China å’Œ US çš„ &lt;code>one-hot&lt;/code> å‘é‡åŠ èµ·æ¥ï¼Œå¾—åˆ° &lt;code>[1,1,0,0,...,0]&lt;/code>ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå…ƒç´ éƒ½æ˜¯ 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ï¼Œè¿™ä¸ªç‰¹å¾å‘é‡çš„è§£é‡Šæ˜¯ï¼šæ—¢æœ‰ä¸­å›½å›½ç±ï¼Œåˆæœ‰ç¾Žå›½å›½ç±ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;p>æ‰€ä»¥åšæœºå™¨å­¦ä¹ çš„æ—¶å€™ï¼Œä¸èƒ½ç”¨ä¸€ä¸ªæ ‡é‡æ¥è¡¨ç¤ºä¸€ä¸ªç±»åˆ«ç‰¹å¾ï¼Œè¿™ç§ç‰¹å¾åšæ³•æ±‚å’Œç­‰æ•°å€¼è®¡ç®—æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨ &lt;code>one-hot&lt;/code> å‘é‡æ¥è¡¨ç¤ºç±»åˆ«ç‰¹å¾ã€‚&lt;/p>
&lt;h2 id="-å¤„ç†æ–‡æœ¬æ•°æ®çš„æµç¨‹">ðŸš€ å¤„ç†æ–‡æœ¬æ•°æ®çš„æµç¨‹&lt;/h2>
&lt;p>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†çš„åº”ç”¨ä¸­ï¼Œæ•°æ®å°±æ˜¯æ–‡æœ¬ &lt;code>document&lt;/code>ï¼Œæ–‡æœ¬å¯ä»¥åˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå•è¯è¡¨ç¤ºæˆæ•°å€¼å‘é‡ã€‚å…¶ä¸­æ¯ä¸ªå•è¯éƒ½æ˜¯ä¸€ä¸ªç±»åˆ«ï¼Œå¦‚æžœå­—å…¸é‡Œæœ‰ä¸€ä¸‡ä¸ªå•è¯ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€ä¸‡çš„ç±»åˆ«ï¼Œæ˜¾ç„¶å•è¯å°±æ˜¯ç±»åˆ«ç‰¹å¾ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¤„ç†ç±»åˆ«ç‰¹å¾çš„æ–¹æ³•ï¼ŒæŠŠå•è¯å˜æˆæ•°å€¼å‘é‡ã€‚&lt;/p>
&lt;p>æ–‡æœ¬å¤„ç†ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸ”” æŠŠæ–‡æœ¬åˆ†å‰²æˆå•è¯&lt;/li>
&lt;li>ðŸ”” è®¡ç®—æ¯ä¸ªå•è¯å‡ºçŽ°çš„æ¬¡æ•°&lt;/li>
&lt;li>ðŸ”” è¿›è¡Œ one-hot ç¼–ç &lt;/li>
&lt;/ul>
&lt;p>æ–‡æœ¬å¤„ç†çš„ç¬¬ä¸€æ­¥æ˜¯æŠŠæ–‡æœ¬åˆ†å‰²æˆå•è¯ã€‚ä¸€æ®µè¯ï¼Œä¸€ç¯‡æ–‡ç« æˆ–è€…ä¸€æœ¬ä¹¦å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥æŠŠæ–‡æœ¬åˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œè¿™ä¸ªæ­¥éª¤ç§°ä¸º &lt;code>Tokenization&lt;/code>ã€‚&lt;/p>
&lt;p>æ¯”å¦‚è¯´è¿™å¥è¯ &lt;code>... to be or not to be ...&lt;/code>ï¼Œ å¯ä»¥åˆ†å‰²æˆè¿™äº›å•è¯ &lt;code>[to, be, or, not, to, be]&lt;/code>ã€‚Tokenization å°±æ˜¯æŠŠæ–‡æœ¬å˜æˆå•è¯çš„åˆ—è¡¨ã€‚&lt;/p>
&lt;p>æ–‡æœ¬å¤„ç†çš„ç¬¬äºŒæ­¥æ˜¯è®¡ç®—è¯é¢‘ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå•è¯å‡ºçŽ°çš„æ¬¡æ•°ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ &lt;code>hash Map&lt;/code> æ¥è®¡ç®—ï¼Œè®¡ç®—å¼€å§‹ä¹‹å‰ï¼Œå“ˆå¸Œè¡¨æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬æ ¹æ®ä»¥ä¸‹æ–¹å¼æ›´æ–°å“ˆå¸Œè¡¨ï¼šå¦‚æžœå•è¯ &lt;code>w&lt;/code> ä¸åœ¨è¡¨é‡Œé¢ï¼Œè¯´æ˜Žåˆ°ç›®å‰ä¸ºæ­¢ï¼Œ&lt;code>w&lt;/code> è¿˜æ²¡æœ‰å‡ºçŽ°åœ¨æ–‡æœ¬é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠ &lt;code>w&lt;/code> åŠ å…¥å“ˆå¸Œè¡¨ï¼Œå¹¶è®©å®ƒçš„è¯é¢‘ç­‰äºŽ 1ï¼›å¦‚æžœ &lt;code>w&lt;/code> åœ¨å“ˆå¸Œè¡¨é‡Œé¢ï¼Œè¯´æ˜Ž &lt;code>w&lt;/code> ä¹‹å‰åœ¨æ–‡æœ¬é‡Œå‡ºçŽ°è¿‡ï¼Œåªéœ€è¦æŠŠ &lt;code>w&lt;/code> çš„è¯é¢‘åŠ  1 å³å¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/4.png"
loading="lazy"
alt="4"
>&lt;/p>
&lt;p>æŽ¥ä¸‹æ¥ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†æŒ¨ä¸ªå¤„ç†è¿™ä¸ªåˆ—è¡¨é‡Œçš„å•è¯ã€‚å½“å¤„ç†åˆ°å•è¯ &lt;code>to&lt;/code> çš„æ—¶å€™ï¼Œé¦–å…ˆæŸ¥ä¸€ä¸‹å“ˆå¸Œè¡¨ï¼Œå‘çŽ°å“ˆå¸Œè¡¨é‡Œé¢æœ‰ &lt;code>to&lt;/code>ï¼Œå®ƒçš„è¯é¢‘æ˜¯ 398ï¼Œè¯´æ˜Ž to åœ¨æ–‡ç« é‡Œå·²ç»å‡ºçŽ°è¿‡ 398 æ¬¡äº†ï¼ŒçŽ°åœ¨è¿™ä¸ªå•è¯åˆå‡ºçŽ°äº†ä¸€æ¬¡ï¼ŒäºŽæ˜¯æŠŠè¡¨é‡Œçš„è¯é¢‘åŠ  1ï¼Œå˜æˆäº† 399ï¼›å½“å¤„ç†åˆ°å•è¯ &lt;code>or&lt;/code>çš„æ—¶å€™ï¼Œåœ¨è¡¨é‡Œæ‰¾ä¸åˆ°ï¼Œè¿™è¯´æ˜Žæ–‡ç« é‡Œè¿˜æ²¡æœ‰å‡ºçŽ°è¿‡ &lt;code>or&lt;/code> è¿™ä¸ªå•è¯ï¼Œç¬¬ä¸€æ¬¡å‡ºçŽ°åœ¨æ–‡ç« é‡Œï¼ŒäºŽæ˜¯æˆ‘ä»¬æŠŠ &lt;code>or&lt;/code> æ’å…¥è¡¨é‡Œï¼Œå°†è¯é¢‘è®¾ç½®ä¸º 1ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/5.png"
loading="lazy"
alt="5"
>&lt;/p>
&lt;p>å®Œæˆç»Ÿè®¡è¯é¢‘ä¹‹åŽï¼Œéœ€è¦æŠŠå“ˆå¸Œè¡¨åšä¸€ä¸ªæŽ’åºï¼ŒæŒ‰ç…§è¯é¢‘é€’å‡çš„é¡ºåºè¿›è¡ŒæŽ’åˆ—ï¼Œè¡¨çš„æœ€å‰é¢æ˜¯è¯é¢‘æœ€é«˜çš„ï¼Œè¡¨æœ€åŽæ˜¯è¯é¢‘æœ€ä½Žçš„ã€‚ç„¶åŽå°±æŠŠè¯é¢‘æ¢æˆä¸‹æ ‡ &lt;code>index&lt;/code>ï¼Œä»Ž 1 å¼€å§‹æ•°è®¡æ•°ï¼Œè¯é¢‘æœ€é«˜çš„è¯çš„ &lt;code>index&lt;/code> æ˜¯ 1ã€‚è¿™ä¸ªä¾‹å­é‡Œï¼Œä¸€å…±æœ‰ 8 ä¸ªå•è¯ï¼Œæ¯ä¸ªè¯å¯¹åº”ä¸€ä¸ª [1, 8] ä¹‹é—´çš„æ­£æ•´æ•°ã€‚è¿™ä¸ªè¡¨ç§°ä¸ºå­—å…¸ ï¼Œå¯ä»¥æŠŠå•è¯æ˜ å°„ä¸ºä¸€ä¸ªæ•°å­—ã€‚&lt;/p>
&lt;p>å­—å…¸é‡Œå•è¯çš„ä¸ªæ•°ç§°ä¸ºè¯æ±‡é‡ &lt;code>vocabulary&lt;/code>ã€‚è¿™ä¾‹å­é‡Œè¯æ±‡é‡ç­‰äºŽ 8ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/6.png"
loading="lazy"
alt="6"
>&lt;/p>
&lt;p>è‹±è¯­é‡Œå¤§æ¦‚æœ‰ 1 ä¸‡ä¸ªå¸¸ç”¨è¯ï¼Œä½†æ˜¯ç»Ÿè®¡è¯é¢‘ä¹‹åŽï¼Œä½ ä¼šå‘çŽ°å­—å…¸ä¼šæœ‰å‡ åä¸‡ç”šè‡³ä¸Šç™¾ä¸‡ä¸ªå•è¯ã€‚ç»Ÿè®¡è¯é¢‘çš„ç›®çš„å°±æ˜¯ä¿ç•™å¸¸ç”¨è¯ï¼ŒåŽ»æŽ‰ä½Žé¢‘è¯ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¿ç•™è¯é¢‘æœ€é«˜çš„ 1 ä¸‡ä¸ªå•è¯ï¼Œåˆ æŽ‰å…¶ä½™å•è¯ã€‚&lt;/p>
&lt;p>&lt;strong>ä¸ºä»€ä¹ˆè¦åˆ æŽ‰ä½Žé¢‘è¯å‘¢ï¼Ÿ&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° ä½Žé¢‘è¯é€šå¸¸æ²¡æœ‰æ„ä¹‰&lt;/li>
&lt;/ul>
&lt;p>å¾ˆå¤šä½Žé¢‘è¯éƒ½æ˜¯åå­—å®žä½“ &lt;code>name entities&lt;/code>ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„åå­—å°±æ˜¯ä¸ªåå­—å®žä½“ï¼Œå‡å¦‚æˆ‘ä»¬çš„åå­—å‡ºçŽ°åœ¨ä¸€ä¸ªæ•°æ®é›†é‡Œé¢ï¼Œä»–çš„é¢‘çŽ‡è‚¯å®šä¼šå¾ˆä½Žï¼Œåœ¨å¤§å¤šæ•°çš„åº”ç”¨é‡Œåå­—å®žä½“æ²¡æœ‰æ„ä¹‰ã€‚&lt;/p>
&lt;p>ä½Žé¢‘è¯å¾ˆå¤šéƒ½æ˜¯æ‹¼å†™é”™è¯¯é€ æˆçš„ï¼Œå¦‚æžœæŠŠ prince çš„ c è¯¯å†™æˆ sï¼Œprinseï¼Œé‚£ä¹ˆå°±åˆ›é€ äº†ä¸€ä¸ªæ–°çš„å•è¯ï¼Œè¿™ç§è¯çš„é¢‘çŽ‡ä¹Ÿå¾ˆä½Žï¼Œåœ¨å¾ˆå¤šåº”ç”¨é‡Œï¼ŒåŽ»æŽ‰è¿™ç§è¯æ²¡æœ‰å±å®³ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° åŽ»æŽ‰ä½Žé¢‘è¯çš„å¦ä¸€ä¸ªåŽŸå› æ˜¯æˆ‘ä»¬ä¸å¸Œæœ› &lt;code>vocabulary&lt;/code> å¤ªå¤§ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸‹ä¸€ä¸ªæ­¥éª¤åš &lt;code>one-hot encoding&lt;/code> çš„æ—¶å€™ï¼Œå‘é‡çš„ç»´åº¦å°±æ˜¯å­—å…¸çš„å¤§å°ã€‚å­—å…¸è¶Šå¤§ï¼Œå‘é‡çš„ç»´åº¦å°±è¶Šé«˜ï¼Œè¿™ä¼šè®©è®¡ç®—å˜æ…¢ã€‚ä¸‹ä¸€èŠ‚è¯¦ç»†è¯´æ˜Žè¯åµŒå…¥ &lt;code>Word Embedding&lt;/code> çš„æ—¶å€™å°±ä¼šçœ‹åˆ°ï¼Œå­—å…¸è¶Šå¤§ï¼Œæ¨¡åž‹çš„å‚æ•°å°±è¶Šä¼šè¶Šå¤šï¼Œå°±ä¼šå®¹æ˜“é€ æˆè¿‡æ‹Ÿåˆ &lt;code>overfitting&lt;/code>ï¼Œåˆ æŽ‰ä½Žé¢‘è¯å°±ä¼šå¤§å¹…å‡å° &lt;code>vocabulary&lt;/code>ã€‚&lt;/p>
&lt;p>æ–‡æœ¬å¤„ç†çš„ç¬¬ä¸‰æ­¥å°±æ˜¯å¯¹å•è¯åš &lt;code>one-hot encoding&lt;/code>ï¼Œé€šè¿‡æŸ¥å­—å…¸ï¼ŒæŠŠå•è¯æ˜ å°„æˆä¸€ä¸ªæ­£æ•´æ•°ï¼Œä¸€ä¸ªå•è¯çš„åˆ—è¡¨å°±æ˜ å°„æˆäº†ä¸€ä¸ªæ­£æ•´æ•°çš„åˆ—è¡¨ï¼›å¦‚æžœæœ‰å¿…è¦å°±ç»§ç»­æŠŠè¿™äº›æ­£æ•´æ•°å˜æˆ &lt;code>one-hot&lt;/code> å‘é‡ã€‚è¿™äº› &lt;code>one-hot&lt;/code> å‘é‡çš„ç»´åº¦æ­£å¥½ç­‰äºŽ &lt;code>vocabulary&lt;/code>ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œå­—å…¸çš„é•¿åº¦æ˜¯ 8ï¼Œæ‰€ä»¥ &lt;code>one-hot&lt;/code> ç»´åº¦å°±ç­‰äºŽ 8ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;p>ä¸Šé¢è¯´è¿‡ï¼Œå­—å…¸é‡Œçš„ä½Žé¢‘è¯å¯èƒ½ä¼šè¢«åˆ æŽ‰ï¼Œæ‰€ä»¥æœ‰äº›è¯åœ¨å­—å…¸é‡Œæ‰¾ä¸åˆ°ï¼Œä¾‹å¦‚æŠŠ be é”™è¯¯æ‹¼å†™æˆå•è¯ biï¼Œè¿™ä¸ªè¯åœ¨å­—å…¸é‡Œæ‰¾ä¸åˆ°ï¼Œ&lt;code>one-hot encoding&lt;/code> æ—¶ï¼Œå¯ä»¥å¿½ç•¥è¿™ä¸ªè¯ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒç¼–ç æˆå…¨ 0 å‘é‡ã€‚&lt;/p>
&lt;h2 id="-æ€»ç»“">ðŸŽ æ€»ç»“&lt;/h2>
&lt;p>æœ€åŽæ€»ç»“ä¸€ä¸‹è¿™ä¸€èŠ‚çš„å†…å®¹ã€‚&lt;/p>
&lt;p>éƒ¨åˆ†æœºå™¨å­¦ä¹ çš„æ•°æ®ä¼šå…·å¤‡ç±»åˆ«ç‰¹å¾ &lt;code>Categorical Features&lt;/code>ï¼Œæœºå™¨å­¦ä¹ æ¨¡åž‹æ— æ³•ç†è§£ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è½¬æ¢æˆæ•°å€¼ç‰¹å¾ã€‚ç±»åˆ«ç‰¹å¾çš„ç±»åˆ«ä¼šè¢«æ˜ å°„æˆä¸€ä¸ªä»Ž &lt;code>1&lt;/code> å¼€å§‹è®¡ç®—çš„æ•´æ•°ï¼Œ&lt;code>0&lt;/code> è¢«ç”¨æ¥è¡¨ç¤ºç¼ºå¤±æˆ–è€…æœªçŸ¥çš„ç±»åˆ«ï¼Œå¹¶ä¸”ä½¿ç”¨ &lt;code>one-hot&lt;/code> å‘é‡ï¼Œèƒ½å¾ˆå¥½çš„è¡¨ç¤ºç±»åˆ«ç‰¹å¾çš„æ„ä¹‰ã€‚&lt;/p>
&lt;p>æ–‡æœ¬å¤„ç†ä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€æ­¥ &lt;code>tokenization&lt;/code> æŠŠæ–‡æœ¬åˆ†å‰²æˆå•è¯çš„åˆ—è¡¨ï¼›ç¬¬äºŒæ­¥å»ºç«‹äº†ä¸€ä¸ªå­—å…¸&lt;code>vocabulary&lt;/code>ï¼ŒæŠŠå•è¯æ˜ å°„æˆä¸€ä¸ªæ­£æ•´æ•°ï¼›ç¬¬ä¸‰æ­¥è¿›è¡Œ &lt;code>one-hot encoding&lt;/code>ï¼Œå°†åˆ†å‰²åŽçš„å•è¯åˆ—è¡¨æ˜ å°„æˆæ­£æ•´æ•°çš„åˆ—è¡¨æˆ–å˜æˆ &lt;code>one-hot&lt;/code> å‘é‡ã€‚&lt;/p></description></item><item><title>æ³¨è§£ä¸Žåå°„</title><link>https://www.letout.cn/p/java/annotation-and-reflection/</link><pubDate>Fri, 28 Jan 2022 01:02:02 +0800</pubDate><guid>https://www.letout.cn/p/java/annotation-and-reflection/</guid><description>&lt;h2 id="æ³¨è§£">æ³¨è§£&lt;/h2>
&lt;h3 id="å†…ç½®æ³¨è§£">å†…ç½®æ³¨è§£&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>@Override&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>@Deprecated&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>@SuppressWarning&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å…ƒæ³¨è§£">å…ƒæ³¨è§£&lt;/h3>
&lt;p>å…ƒæ³¨è§£çš„ä½œç”¨æ˜¯ï¼šæ³¨è§£å…¶ä»–æ³¨è§£ã€‚Java ä¸­å®šä¹‰äº†å››ä¸ªå…ƒæ³¨è§£ç±»åž‹ï¼Œç”¨æ¥å¯¹å…¶ä»–æ³¨è§£ç±»åž‹åšè¯´æ˜Žã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>@Target&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æè¿°æ³¨è§£çš„ä½¿ç”¨èŒƒå›´ï¼Œæ˜¯ç”¨äºŽç±»ã€æ–¹æ³•è¿˜æ˜¯å±žæ€§ç­‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è¯¥æ³¨è§£çš„ä½œç”¨èŒƒå›´ä¸º
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// TYPE æè¿°ç±»ã€æŽ¥å£(åŒ…æ‹¬æ³¨è§£ç±»åž‹) æˆ–enumå£°æ˜Ž
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// FIELD æè¿°åŸŸå³ç±»æˆå‘˜å˜é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// METHOD æè¿°æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// PARAMETER æè¿°å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// CONSTRUCTOR æè¿°æž„é€ å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// LOCAL_VARIABLE æè¿°å±€éƒ¨å˜é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nd">@Target&lt;/span>&lt;span class="o">({&lt;/span>&lt;span class="n">TYPE&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">FIELD&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">METHOD&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">PARAMETER&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">CONSTRUCTOR&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">LOCAL_VARIABLE&lt;/span>&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Retention&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">RetentionPolicy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SOURCE&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nd">@interface&lt;/span> &lt;span class="n">SuppressWarning&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="nf">value&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>@Retention&lt;/code>
&lt;ul>
&lt;li>SOURCE æºæ–‡ä»¶ä¸­æœ‰æ•ˆ&lt;/li>
&lt;li>CLASS classæ–‡ä»¶ä¸­æœ‰æ•ˆ&lt;/li>
&lt;li>RUNTIME è¿è¡Œæ—¶æœ‰æ•ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨ä»€ä¹ˆçº§åˆ«ä¿ç•™æ³¨è§£ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Target&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ElementType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">METHOD&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Retention&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">RetentionPolicy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SOURCE&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// æºæ–‡ä»¶ä¸­æœ‰æ•ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="nd">@interface&lt;/span> &lt;span class="n">Override&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>@Documented&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>è¯´æ˜Žè¯¥æ³¨è§£å°†è¢«åŒ…å«åœ¨ javadoc ä¸­&lt;/p>
&lt;ul>
&lt;li>&lt;code>@Inherited&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>è¯´æ˜Žå­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»ä¸­çš„è¯¥æ³¨è§£&lt;/p>
&lt;h3 id="è‡ªå®šä¹‰æ³¨è§£">è‡ªå®šä¹‰æ³¨è§£&lt;/h3>
&lt;p>ä½¿ç”¨ &lt;code>@interface&lt;/code> è‡ªå®šä¹‰æ³¨è§£ï¼Œä¼šé»˜è®¤ç»§æ‰¿ &lt;code>java.lang.annotation.Annotation&lt;/code> æŽ¥å£ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¸€èˆ¬ç”¨ &lt;code>value&lt;/code> ä½œä¸ºå‚æ•°åã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ä»¥ç”¨ &lt;code>default&lt;/code> å£°æ˜Žé»˜è®¤å€¼ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>String value() default &amp;quot;&amp;quot;;&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="åå°„">åå°„&lt;/h2>
&lt;p>åå°„æœºåˆ¶å…è®¸ç¨‹åºåœ¨æ‰§è¡ŒæœŸé—´ï¼Œä½¿ç”¨åå°„ API èŽ·å–ç±»çš„ä¿¡æ¯ï¼Œå¹¶æ“ä½œä»»æ„å¯¹è±¡çš„å†…éƒ¨å±žæ€§åŠæ–¹æ³•ã€‚&lt;/p>
&lt;p>ç±»åŠ è½½åŽï¼Œåœ¨æ–¹æ³•åŒºä¸­ä¼šäº§ç”Ÿä¸€ä¸ª &lt;code>java.lang.Class&lt;/code> ç±»åž‹çš„å¯¹è±¡ï¼ŒåŒ…å«äº†ç±»çš„ä¿¡æ¯ã€‚åå°„é€šè¿‡è¿™ä¸ªç±»ï¼Œå¯ä»¥èŽ·å–ç±»çš„ç»“æž„ä¸Žä¿¡æ¯ã€‚&lt;/p>
&lt;p>åœ¨ JVM ä¸­ï¼Œæ¯ä¸ªç±»åªå­˜åœ¨ä¸€ä¸ª &lt;code>Class&lt;/code> å¯¹è±¡ï¼Œæ— è®ºä½¿ç”¨ä»€ä¹ˆæ–¹å¼èŽ·å–ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ã€‚ï¼ˆåŠ è½½å™¨æ¯ä¸ªç±»åªä¼šåŠ è½½ä¸€æ¬¡ï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;cn.letout.Person&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">person&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Person&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="èŽ·å–ç±»çš„ä¿¡æ¯">èŽ·å–ç±»çš„ä¿¡æ¯&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">clazz&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;cn.letout.Test&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç±»çš„ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// åŒ…å + ç±»å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getSimpleName&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// ç±»å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç±»çš„å±žæ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Field&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">publicFields&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getFields&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// èŽ·å– public å±žæ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Field&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">fields&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredFields&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// èŽ·å–æ‰€æœ‰å±žæ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Field&lt;/span> &lt;span class="n">nameField&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getField&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// èŽ·å¾—æŒ‡å®šå±žæ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nameField&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// èŽ·å¾—å±žæ€§å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nameField&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getType&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// èŽ·å¾—å±žæ€§ç±»åž‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç±»çš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Method&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">publicMethods&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getMethods&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Method&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">methods&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredMethods&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Method&lt;/span> &lt;span class="n">getNameMethod&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;getName&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// èŽ·å¾—æŒ‡å®šæ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Method&lt;/span> &lt;span class="n">setNameMethod&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;setName&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">setNameMethod&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// èŽ·å–æ–¹æ³•å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">setNameMethod&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getReturnType&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// èŽ·å–æ–¹æ³•è¿”å›žç±»åž‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç±»çš„æž„é€ å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Constructor&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">publicConstructors&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getConstructors&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Constructor&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">constructors&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredConstructors&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç±»çš„æ³¨è§£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Annotation&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">annotations&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAnnotations&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Annotation&lt;/span> &lt;span class="n">testAnnotation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAnnotation&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">TestAnnotation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">testAnnotation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åˆ›å»ºç±»çš„å¯¹è±¡">åˆ›å»ºç±»çš„å¯¹è±¡&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Person&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">clazz&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Person&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Person&lt;/span> &lt;span class="n">person&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getConstructor&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Person&lt;/span> &lt;span class="n">person&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getConstructor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// èŽ·å–ç§æœ‰æž„é€ æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä½¿ç”¨ getDeclaredConstructor() èŽ·å–éž public æž„é€ æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Constructor&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Person&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">constructor&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredConstructor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">constructor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAccessible&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Person&lt;/span> &lt;span class="n">person&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">constructor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è°ƒç”¨ç±»çš„æ–¹æ³•">è°ƒç”¨ç±»çš„æ–¹æ³•&lt;/h3>
&lt;p>ä½¿ç”¨åå°„æœºåˆ¶ï¼Œè°ƒç”¨ç±»çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span> &lt;span class="n">clazz&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;cn.letout.Person&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Object&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// èŽ·å– public æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Method&lt;/span> &lt;span class="n">method&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;test&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;å‚æ•°&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// èŽ·å–éž public æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Method&lt;/span> &lt;span class="n">privateMethod&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;fun&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">privateMethod&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAccessible&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">privateMethod&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;å‚æ•°&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¿®æ”¹ç±»çš„å±žæ€§">ä¿®æ”¹ç±»çš„å±žæ€§&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span> &lt;span class="n">clazz&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;cn.letout.Person&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Object&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Field&lt;/span> &lt;span class="n">filed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredField&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">field&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAccessible&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">field&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;Emery&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>åå°„å¯ä»¥ä¿®æ”¹ final ä¿®é¥°çš„å¸¸é‡å±žæ€§ã€‚&lt;/strong>
å¦‚æžœ JVM æ²¡æœ‰è¿›è¡Œå†…è”ä¼˜åŒ–ï¼Œå¯ç›´æŽ¥èŽ·å–å¯¹åº”çš„å€¼ã€‚å¦‚æžœ JVM å¯¹å…¶è¿›è¡Œäº†å†…è”ä¼˜åŒ–ï¼Œç¼–è¯‘é˜¶æ®µå·²ç»å°†å…¶æ›¿æ¢æˆäº†å¸¸é‡çš„å€¼ï¼ŒåŽŸä»£ç å¯èƒ½è¾“å‡ºåŽŸå€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// final name
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">person&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å†…è”ä¼˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Emery&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åå°„èŽ·å–æ³¨è§£">åå°„èŽ·å–æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// èŽ·å–ç±»æ³¨è§£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Annotation&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">annotations&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAnnotations&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Annotation&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Test&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">testAnnotation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAnnotation&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Test&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// èŽ·å–å±žæ€§æ³¨è§£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Field&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">declaredFields&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredFields&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Field&lt;/span> &lt;span class="n">field&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">declaredFields&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Annotation&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Test&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">testAnnotation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">field&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAnnotation&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Test&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">testAnnotation&lt;/span> &lt;span class="o">!&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">testAnnotation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ... ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java Map æ“ä½œ</title><link>https://www.letout.cn/p/java-map-traversal/</link><pubDate>Thu, 28 Oct 2021 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/java-map-traversal/</guid><description>&lt;img src="https://www.letout.cn/imgs/11.jpeg" alt="Featured image of post Java Map æ“ä½œ" />&lt;p>åšè‡ªç„¶è¯­è¨€å¤„ç†å†™äº†æŒºä¹…çš„ &lt;code>Python&lt;/code> ï¼Œç»å¸¸è¦å¤„ç†æ•°æ®ã€‚ç”¨ &lt;code>Python&lt;/code> ä¸­çš„å¤„ç†æ•°æ®çœŸçš„æŒºçˆ½çš„ ðŸ«£ï¼Œæˆ‘å¹³å¸¸éƒ½å–œæ¬¢æŠŠå„ç§æ•°æ®éƒ½å¾€ &lt;code>dict&lt;/code>ï¼ˆä¹Ÿå°±æ˜¯ &lt;code>Java&lt;/code> ä¸­çš„ &lt;code>map&lt;/code>ï¼‰ å’Œ &lt;code>json&lt;/code> ä¸Šè½¬ï¼Œç”¨ &lt;code>Python&lt;/code> å¤„ç†è¿™ä¸ªå„ç§æ–¹ä¾¿ã€‚ æœ€è¿‘å†å†™ &lt;code>Java&lt;/code> å°±ç»å¸¸â€œæ‰‹æ®‹â€ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹ &lt;code>Java&lt;/code> ä¸­å¤„ç† &lt;code>Map&lt;/code>ã€‚&lt;/p>
&lt;h2 id="-éåŽ†æ–¹å¼">â­ï¸ éåŽ†æ–¹å¼&lt;/h2>
&lt;p>Java éåŽ† Mapï¼Œè¦ä¹ˆå°±æ˜¯éåŽ†å®ƒçš„ &lt;code>Map.Entry&amp;lt;K,V&amp;gt; &amp;lt;- entrySet()&lt;/code>ï¼Œè¦ä¹ˆå°±æ˜¯éåŽ†å®ƒçš„ key &lt;code>KeySet &amp;lt;- keySet()&lt;/code>ã€‚ä¸»è¦å¯ä»¥ç”¨ä¸‹é¢å››ç§æ–¹å¼éåŽ†ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Iterator&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ForEach&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Lambda&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Stream&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>é™¤éžç‰¹æ®Šéœ€è¦ï¼Œå°½é‡ä½¿ç”¨åŽ 3 ç§éåŽ†æ–¹å¼ï¼Œä½¿ç”¨ &lt;code>Iterator&lt;/code> å¯èƒ½æ›´å®¹æ˜“é€ æˆä¸€äº›é”™è¯¯ï¼ˆEffective Java - 58ï¼š&lt;code>for-each&lt;/code> ä¼˜å…ˆäºŽ &lt;code>for&lt;/code> å¾ªçŽ¯ï¼‰ã€‚&lt;/p>
&lt;p>åœ¨ä¸€äº› &lt;code>for-each&lt;/code> ä¸èƒ½èƒœä»»çš„åœ°æ–¹ï¼Œå…¶å®žä¹Ÿæœ‰å¾ˆå¯¹å†…ç½®æ–¹æ³•èƒ½å¤Ÿå®Œæˆæ“ä½œï¼Œä¸ä»…æ›´åŠ ç›´è§‚ï¼Œè€Œä¸”éžå¸¸æ˜“ç”¨ã€‚æ¯”å¦‚åˆ é™¤æ“ä½œï¼š&lt;code>Collection#removeIf()&lt;/code> &lt;code>Java 1.8+&lt;/code>ã€‚&lt;/p>
&lt;h3 id="foreach">ForEach&lt;/h3>
&lt;h4 id="entryset">EntrySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="nf">entrySet&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="keyset">KeySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">keySet&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">keySet&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="lambda">Lambda&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">AbstractMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;,&lt;/span> &lt;span class="n">Cloneable&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Serializable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">forEach&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Biconsumer&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">action&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// key
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// value
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="stream">Stream&lt;/h3>
&lt;h4 id="steram">Steram&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">stream&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="parallelstream">parallelStream&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">parallelStream&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="interator">Interator&lt;/h3>
&lt;h4 id="entryset-1">EntrySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">iterator&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ ¹æ® Effective Java - 57ï¼Œæ›´æŽ¨èä»¥ä¸‹è¿™ç§å†™æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">iterator&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="keyset-1">KeySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Iteator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">iterator&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">keySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-ä¸€äº›æ“ä½œ">ðŸŒŸ ä¸€äº›æ“ä½œ&lt;/h2>
&lt;h3 id="åˆ¤ç©º">åˆ¤ç©º&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™‹&lt;/span>&lt;span class="n">â€&lt;/span>&lt;span class="err">â™‚&lt;/span>&lt;span class="n">ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™…&lt;/span>&lt;span class="n">â€&lt;/span>&lt;span class="err">â™‚&lt;/span>&lt;span class="n">ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">boolean&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è®¡æ•°--merge">è®¡æ•° / merge()&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">merge&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BiFunction&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">remappingFunction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">merge&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Integer&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="removeif">removeIf()&lt;/h3>
&lt;blockquote>
&lt;p>ðŸš§ æ³¨æ„ï¼š&lt;/p>
&lt;p>&lt;code>Map&lt;/code> æœ¬èº«æ˜¯æ²¡æœ‰ &lt;code>removeIf()&lt;/code>ã€‚&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">entry&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">keySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">values&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="absent">absent&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">putIfAbsent&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä¸å­˜åœ¨ key æ—¶ï¼ŒæŒ‰ mappingFunction æ·»åŠ  value
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å­˜åœ¨ key ä¸æ”¹å˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">computeIfAbsent&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Function&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">mappingFunction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">computeIfPresent&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BiFunction&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">remappingFunction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="default">default&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getOrDefault&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-å‚è€ƒ">ðŸ”— å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s/zQBN3UvJDhRTKP6SzcZFKw" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s/zQBN3UvJDhRTKP6SzcZFKw&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Modularized Interaction Network for Named Entity Recognition</title><link>https://www.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/</link><pubDate>Wed, 01 Sep 2021 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/</guid><description>&lt;img src="https://www.letout.cn/imgs/9.jpeg" alt="Featured image of post Modularized Interaction Network for Named Entity Recognition" />&lt;p>çŽ°æœ‰NERæ¨¡åž‹ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŸºäºŽåºåˆ—æ ‡æ³¨çš„NERæ¨¡åž‹ï¼ˆThe sequence labeling-based NERmodelsï¼‰&lt;/p>
&lt;ul>
&lt;li>é•¿å®žä½“è¯†åˆ«ä¸ä½³ï¼Œåªå…³æ³¨è¯çº§ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>åŸºäºŽåˆ†æ®µçš„NERæ¨¡åž‹ï¼ˆThe segment-based NERmodelsï¼‰&lt;/p>
&lt;ul>
&lt;li>å¤„ç†åˆ†æ®µï¼Œè€Œéžå•ä¸ªè¯ï¼Œä¸èƒ½æ•èŽ·åˆ†æ®µä¸­çš„è¯çº§ä¾èµ–å…³ç³»&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>è¾¹ç•Œæ£€æµ‹ï¼ˆboundary detectionï¼‰å’Œç±»åž‹é¢„æµ‹ï¼ˆtype pre-dictionï¼‰å¯ä»¥ç›¸äº’é…åˆï¼Œä¸¤ä¸ªå­ä»»åŠ¡å¯å…±äº«ä¿¡æ¯ï¼Œç›¸äº’åŠ å¼ºã€‚&lt;/p>
&lt;p>æå‡ºæ¨¡å—åŒ–äº¤äº’ç½‘ç»œæ¨¡åž‹MINï¼ˆModularized Interaction Networkï¼‰&lt;/p>
&lt;p>åˆ©ç”¨æ®µçº§ä¿¡æ¯å’Œè¯çº§ä¾èµ–å…³ç³»ï¼Œç»“åˆä¸€ç§äº¤äº’æœºåˆ¶ï¼Œæ”¯æŒè¾¹ç•Œæ£€æµ‹å’Œç±»åž‹é¢„æµ‹ä¹‹é—´çš„ä¿¡æ¯å…±äº«ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/1.png"
width="493"
height="408"
srcset="https://www.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/1_huf69a1b5e1975a497801b13aa3110264f_41598_480x0_resize_box_3.png 480w, https://www.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/1_huf69a1b5e1975a497801b13aa3110264f_41598_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="120"
data-flex-basis="290px"
>&lt;/p>
&lt;p>a recurrentneural network encoder-decoder framework with apointer network is used to detect entity segmentsfor segment information.&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/2.png"
width="790"
height="399"
srcset="https://www.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/2_hu67c580ff6778a63552a8e24eeebbd582_54929_480x0_resize_box_3.png 480w, https://www.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/2_hu67c580ff6778a63552a8e24eeebbd582_54929_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="197"
data-flex-basis="475px"
>&lt;/p></description></item><item><title>A Sequence-to-Set Network for Nested Named Entity Recognition</title><link>https://www.letout.cn/p/sequence-to-set/</link><pubDate>Mon, 07 Jun 2021 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/sequence-to-set/</guid><description>&lt;img src="https://www.letout.cn/imgs/14.jpeg" alt="Featured image of post A Sequence-to-Set Network for Nested Named Entity Recognition" />&lt;p>å€Ÿé‰´å›¾åƒé¢†åŸŸçš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡ï¼Œå°†åµŒå¥—ä»»åŠ¡è½¬åŒ–æˆspançš„é¢„æµ‹ï¼Œè§£å†³åµŒå¥—å‘½åå®žä½“è¯†åˆ«ä»»åŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/sequence-to-set/model.png"
width="693"
height="366"
srcset="https://www.letout.cn/p/sequence-to-set/model_hu04a3cb5aafa3b0d4955b742068e6104d_64624_480x0_resize_box_3.png 480w, https://www.letout.cn/p/sequence-to-set/model_hu04a3cb5aafa3b0d4955b742068e6104d_64624_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="model"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="454px"
>&lt;/p>
&lt;p>å…·ä½“æ˜¯é‡‡ç”¨ä¸¤é˜¶æ®µï¼š&lt;/p>
&lt;ul>
&lt;li>ç¬¬ä¸€æ­¥ Locateï¼Œå³å®šä½å®žä½“çš„è¾¹ç•Œ&lt;/li>
&lt;li>ç¬¬äºŒæ­¥ Labelï¼Œå³å¯¹è¯†åˆ«spanè¿›è¡Œå®žä½“ç±»åž‹åˆ¤æ–­ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/sequence-to-set/1.png"
width="357"
height="52"
srcset="https://www.letout.cn/p/sequence-to-set/1_huec6c826749de8343d0aee5d973132caa_9180_480x0_resize_box_3.png 480w, https://www.letout.cn/p/sequence-to-set/1_huec6c826749de8343d0aee5d973132caa_9180_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="686"
data-flex-basis="1647px"
>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/sequence-to-set/2.png"
width="347"
height="320"
srcset="https://www.letout.cn/p/sequence-to-set/2_hu4391112aaed5160844ed6f4005b28fce_42441_480x0_resize_box_3.png 480w, https://www.letout.cn/p/sequence-to-set/2_hu4391112aaed5160844ed6f4005b28fce_42441_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="108"
data-flex-basis="260px"
>&lt;/p></description></item><item><title>Named Entity Recognition As Dependency Parsing</title><link>https://www.letout.cn/p/namedentityrecognitionasdependencyparsing/</link><pubDate>Tue, 01 Jun 2021 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/namedentityrecognitionasdependencyparsing/</guid><description>&lt;img src="https://www.letout.cn/imgs/7.jpeg" alt="Featured image of post Named Entity Recognition As Dependency Parsing" />&lt;p>æ–‡ä¸­å°†æ¯ä¸ª token ç”¨ BERT å’Œ fastText è¿›è¡Œ embeddingï¼Œæ‹¼æŽ¥ä¸Šç”¨ CNN ç¼–ç çš„å­—ç¬¦çº§åˆ«å‘é‡ï¼Œé€å…¥ä¸€ä¸ªåŒå‘ LSTM ç¼–ç ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒèŽ·å¾—æ¯ä¸ªè¯çš„è¡¨è¾¾ã€‚ä¹‹åŽé‡‡ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„ FFNN æ¥å¾—åˆ°ä½œä¸ºå®žä½“å¼€å§‹å’Œç»“æŸçš„ä½ç½®çš„è¡¨è¾¾ã€‚&lt;/p>
&lt;p>æœ€åŽç”¨ä¸€ä¸ªä»¿å°„æ¨¡åž‹å¾—åˆ°ä¸€ä¸ª $lÃ—lÃ—c$ çš„ tensorï¼Œå…¶ä¸­ l æ˜¯å¥å­é•¿åº¦ï¼Œc æ˜¯å®žä½“ç±»åˆ«æ•°é‡åŠ ä¸€ï¼ˆè¡¨ç¤ºæ— å®žä½“ï¼‰ã€‚è¿ç”¨è¯¥çŸ©é˜µï¼Œæ–‡ä¸­å¯¹äºŽåµŒå¥—å’ŒéžåµŒå¥—é‡‡ç”¨äº†ä¸¤ç§ä¸åŒçš„ç­–ç•¥ï¼Œä»Žè€Œå¾—åˆ°äº†å®žä½“çš„èµ·æ­¢ä½ç½®ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/namedentityrecognitionasdependencyparsing/model.png"
width="500"
height="501"
srcset="https://www.letout.cn/p/namedentityrecognitionasdependencyparsing/model_hue39a704d975d112c4ae2b387bb0aa5be_45180_480x0_resize_box_3.png 480w, https://www.letout.cn/p/namedentityrecognitionasdependencyparsing/model_hue39a704d975d112c4ae2b387bb0aa5be_45180_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="model"
class="gallery-image"
data-flex-grow="99"
data-flex-basis="239px"
>&lt;/p>
&lt;p>code: &lt;a class="link" href="https://github.com/juntaoy/biaffine-ner" target="_blank" rel="noopener"
>https://github.com/juntaoy/biaffine-ner&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/namedentityrecognitionasdependencyparsing/ner.png"
width="325"
height="669"
srcset="https://www.letout.cn/p/namedentityrecognitionasdependencyparsing/ner_huff0969dccbb13cbf7d246862faeafc4d_75035_480x0_resize_box_3.png 480w, https://www.letout.cn/p/namedentityrecognitionasdependencyparsing/ner_huff0969dccbb13cbf7d246862faeafc4d_75035_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="ner"
class="gallery-image"
data-flex-grow="48"
data-flex-basis="116px"
>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/namedentityrecognitionasdependencyparsing/nested.png"
width="323"
height="618"
srcset="https://www.letout.cn/p/namedentityrecognitionasdependencyparsing/nested_hu30723d7bae4f05520cc9500a93ac4824_73991_480x0_resize_box_3.png 480w, https://www.letout.cn/p/namedentityrecognitionasdependencyparsing/nested_hu30723d7bae4f05520cc9500a93ac4824_73991_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="nested"
class="gallery-image"
data-flex-grow="52"
data-flex-basis="125px"
>&lt;/p></description></item><item><title>PyTorch ç«é€Ÿä¸Šæ‰‹</title><link>https://www.letout.cn/p/pytorch-handbook/</link><pubDate>Thu, 01 Apr 2021 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/pytorch-handbook/</guid><description>&lt;img src="https://www.letout.cn/imgs/10.jpeg" alt="Featured image of post PyTorch ç«é€Ÿä¸Šæ‰‹" />&lt;h2 id="pytorch-æ˜¯ä»€ä¹ˆ">PyTorch æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2>
&lt;p>åŸºäºŽ Python çš„ç§‘å­¦è®¡ç®—åŒ…ï¼ŒæœåŠ¡äºŽä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼š&lt;/p>
&lt;ul>
&lt;li>Numpy çš„æ›¿ä»£å“ï¼Œå¯ä»¥ä½¿ç”¨ GPU çš„å¼ºå¤§è®¡ç®—åŠ›&lt;/li>
&lt;li>æä¾›æœ€å¤§çš„çµæ´»æ€§å’Œé«˜é€Ÿçš„æ·±åº¦å­¦ä¹ ç ”ç©¶å¹³å°&lt;/li>
&lt;/ul>
&lt;h2 id="tensors">Tensors&lt;/h2>
&lt;p>Tensors ä¸Ž Numpy ä¸­çš„ ndarrays ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ PyTorch ä¸­ Tensors å¯ä»¥ä½¿ç”¨ GPU è¿›è¡Œè®¡ç®—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">__future__&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">print_function&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 1 ] åˆ›å»ºä¸€ä¸ª 5x3 çš„çŸ©é˜µï¼Œä½†ä¸åˆå§‹åŒ–ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">empty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 2 ] åˆ›å»ºä¸€ä¸ªéšæœºåˆå§‹åŒ–çš„çŸ©ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[0.6972, 0.0231, 0.3087],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.2083, 0.6141, 0.6896],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.7228, 0.9715, 0.5304],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.7727, 0.1621, 0.9777],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.6526, 0.6170, 0.2605]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 3 ] åˆ›å»ºä¸€ä¸ª 0 å¡«å……çš„çŸ©é˜µï¼Œæ•°æ®ç±»åž‹ä¸º longï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">long&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 4 ] åˆ›å»ºä¸€ä¸ª tensor ä½¿ç”¨çŽ°æœ‰æ•°æ®åˆå§‹åŒ–ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="mf">5.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([5.5000, 3.0000])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 5 ] æ ¹æ®çŽ°æœ‰çš„ tensor åˆ›å»º tensorã€‚è¿™äº›æ–¹æ³•å°†é‡ç”¨è¾“å…¥ tensor çš„å±žæ€§ï¼ˆå¦‚ï¼šdtypeï¼Œé™¤éžè®¾ç½®æ–°çš„å€¼è¿›è¡Œè¦†ç›–ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ©ç”¨ new_* æ–¹æ³•åˆ›å»ºå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">new_ones&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">double&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.]], dtype=torch.float64)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¦†ç›– dtype&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯¹è±¡ size ç›¸åŒï¼Œåªæ˜¯ å€¼å’Œç±»åž‹ å‘ç”Ÿå˜åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.5691, -2.0126, -0.4064],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0863, 0.4692, -1.1209],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-1.1177, -0.5764, -0.5363],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.4390, 0.6688, 0.0889],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.3334, -1.1600, 1.8457]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 6 ] èŽ·å– sizeï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># torch.Size([5, 3])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>&lt;code>torch.Size&lt;/code> è¿”å›ž &lt;code>tuple&lt;/code> ç±»åž‹ï¼Œæ”¯æŒ &lt;code>tuple&lt;/code> ç±»åž‹æ‰€æœ‰çš„æ“ä½œã€‚&lt;/p>
&lt;/blockquote>
&lt;p>[ 7 ] æ“ä½œ&lt;/p>
&lt;p>[ 7.1 ] åŠ æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æä¾›è¾“å‡º tensor ä½œä¸ºå‚æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">empty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">out&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 7.2 ] æ›¿æ¢ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># add x to y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>{% note info %}
&lt;code>_&lt;/code> ç»“å°¾çš„æ“ä½œä¼šæ›¿æ¢åŽŸå˜é‡ã€‚
å¦‚ï¼š&lt;code>x_copy_(y)&lt;/code>ï¼Œ&lt;code>x.t_()&lt;/code> ä¼šæ”¹å˜ &lt;code>x&lt;/code>
{% endnote %}&lt;/p>
&lt;p>[ 7.3 ] ä½¿ç”¨ Numpy ä¸­ç´¢å¼•æ–¹å¼ï¼Œå¯¹ tensor è¿›è¡Œæ“ä½œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">[:,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([-2.0126, 0.4692, -0.5764, 0.6688, -1.1600])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 8 ] &lt;code>torch.view&lt;/code> æ”¹å˜ tensor çš„ç»´åº¦å’Œå¤§å° ï¼ˆä¸Ž Numpy ä¸­ reshape ç±»ä¼¼ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">z&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># -1 ä»Žå…¶ä»–ç»´åº¦æŽ¨æ–­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">z&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># torch.Size([4, 4]) torch.Size([16]) torch.Size([2, 8])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 9 ] å¦‚æžœåªæœ‰ä¸€ä¸ªå…ƒç´ çš„ tensorï¼Œä½¿ç”¨ &lt;code>item()&lt;/code> èŽ·å– Python æ•°æ®ç±»åž‹çš„æ•°å€¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([-0.2368])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -0.23680149018764496&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="numpy-è½¬æ¢">Numpy è½¬æ¢&lt;/h3>
&lt;p>Torch Tensor ä¸Ž Numpy æ•°ç»„ä¹‹é—´è¿›è¡Œè½¬æ¢éžå¸¸è½»æ¾ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ones&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">numpy&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([1., 1., 1., 1., 1.])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># [1. 1. 1. 1. 1.]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Torch Tensor ä¸Ž Numpy æ•°ç»„å…±äº«åº•å±‚å†…å­˜åœ°å€ï¼Œä¿®æ”¹ä¸€ä¸ªä¼šå¯¼è‡´å¦ä¸€ä¸ªçš„å˜åŒ–ã€‚&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([2., 2., 2., 2., 2.])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># [2. 2. 2. 2. 2.]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">numpy&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">np&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ones&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_numpy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">out&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># [2. 2. 2. 2. 2.]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([2., 2., 2., 2., 2.], dtype=torch.float64)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>æ‰€æœ‰çš„ Tensor ç±»åž‹é»˜è®¤éƒ½æ˜¯åŸºäºŽ CPUï¼Œ CharTensor ç±»åž‹ä¸æ”¯æŒåˆ° Numpy çš„è£…æ¢ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="cuda-å¼ é‡">CUDA å¼ é‡&lt;/h3>
&lt;p>ä½¿ç”¨ &lt;code>.to()&lt;/code> å¯ä»¥å°† Tensor ç§»åŠ¨åˆ°ä»»ä½•è®¾å¤‡ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cuda&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">is_available&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">device&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cuda&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># CUDA è®¾å¤‡å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ones_like&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># ç›´æŽ¥ä»Ž GPU åˆ›å»ºå¼ é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">z&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([0.7632], device=&amp;#39;cuda:0&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cpu&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">double&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># tensor([0.7632], dtype=torch.float64)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="autograd-è‡ªåŠ¨æ±‚å¯¼">Autograd è‡ªåŠ¨æ±‚å¯¼&lt;/h2>
&lt;p>autograd åŒ…ä¸º Tensor ä¸Šæ‰€æœ‰çš„æ“ä½œæä¾›äº†è‡ªåŠ¨æ±‚å¯¼ã€‚å®ƒæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å®šä¹‰çš„æ¡†æž¶ï¼Œè¿™æ„å‘³ç€åå‘ä¼ æ’­æ˜¯æ ¹æ®ä½ çš„ä»£ç æ¥ç¡®å®šå¦‚ä½•è¿è¡Œï¼Œå¹¶ä¸”æ¯æ¬¡è¿­ä»£å¯ä»¥æ˜¯ä¸åŒçš„ã€‚&lt;/p>
&lt;h3 id="æ­£å‘ä¼ æ’­-åå‘ä¼ æ’­">æ­£å‘ä¼ æ’­ åå‘ä¼ æ’­&lt;/h3>
&lt;p>ç¥žç»ç½‘ç»œï¼ˆNNï¼‰æ˜¯åœ¨æŸäº›è¾“å…¥æ•°æ®ä¸Šæ‰§è¡ŒåµŒå¥—å‡½æ•°çš„é›†åˆã€‚
è¿™äº›å‡½æ•°ç”±å‚æ•°ï¼ˆæƒé‡å’Œåå·®ç»„æˆï¼‰å®šä¹‰ï¼Œå‚æ•°åœ¨ PyTorch ä¸­å­˜å‚¨åœ¨å¼ é‡ä¸­ã€‚&lt;/p>
&lt;p>è®­ç»ƒ NN åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>æ­£å‘ä¼ æ’­ï¼šåœ¨æ­£å‘ä¼ æ’­ä¸­ï¼ŒNN å¯¹æ­£ç¡®çš„è¾“å‡ºè¿›è¡Œæœ€ä½³çŒœæµ‹ã€‚å®ƒé€šè¿‡æ¯ä¸ªå‡½æ•°è¿è¡Œè¾“å…¥æ•°æ®ä»¥è¿›è¡ŒçŒœæµ‹ã€‚&lt;/li>
&lt;li>åå‘ä¼ æ’­ï¼šåœ¨åå‘ä¼ æ’­ä¸­ï¼ŒNN æ ¹æ®å…¶çŒœæµ‹ä¸­çš„è¯¯å·®è°ƒæ•´å…¶å‚æ•°ã€‚å®ƒé€šè¿‡ä»Žè¾“å‡ºå‘åŽéåŽ†ï¼Œæ”¶é›†æœ‰å…³å‚æ•°ï¼ˆæ¢¯åº¦ï¼‰çš„è¯¯å·®å¯¼æ•°å¹¶ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ¥ä¼˜åŒ–å‚æ•°æ¥å®žçŽ°ã€‚&lt;/li>
&lt;/ul>
&lt;p>[ 1 ] æˆ‘ä»¬ä»Ž torchvision åŠ è½½äº†ç»è¿‡é¢„è®­ç»ƒçš„ resnet18 æ¨¡åž‹ã€‚åˆ›å»ºä¸€ä¸ªéšæœºæ•°æ®å¼ é‡æ¥è¡¨ç¤ºå…·æœ‰ 3 ä¸ªé€šé“çš„å•ä¸ªå›¾åƒï¼Œé«˜åº¦å’Œå®½åº¦ä¸º 64ï¼Œå…¶å¯¹åº”çš„labelåˆå§‹åŒ–ä¸ºä¸€äº›éšæœºå€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="nn">torchvision&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torchvision&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">resnet18&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pretrained&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 2 ] æŽ¥ä¸‹æ¥ï¼Œé€šè¿‡æ¨¡åž‹çš„æ¯ä¸€å±‚è¿è¡Œè¾“å…¥æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚&lt;strong>æ­£å‘ä¼ æ’­&lt;/strong>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">prediction&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 3 ] ä½¿ç”¨æ¨¡åž‹çš„é¢„æµ‹ï¼ˆpredicationï¼‰å’Œç›¸åº”çš„æ ‡ç­¾ï¼ˆlabelsï¼‰æ¥è®¡ç®—è¯¯å·®ï¼ˆlossï¼‰ã€‚
ä¸‹ä¸€æ­¥é€šè¿‡åå‘ä¼ æ’­æ­¤è¯¯å·®ã€‚æˆ‘ä»¬åœ¨ loss tensor ä¸Šè°ƒç”¨ &lt;code>.backward()&lt;/code> æ—¶ï¼Œå¼€å§‹åå‘ä¼ æ’­ã€‚Autograd ä¼šä¸ºæ¯ä¸ªæ¨¡åž‹å‚æ•°è®¡ç®—æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å‚æ•° &lt;code>.grad&lt;/code> å±žæ€§ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">prediction&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backword&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># backword pass&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 4 ] æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ è½½ä¸€ä¸ªä¼˜åŒ–å™¨ï¼ˆSDGï¼‰ï¼Œå­¦ä¹ çŽ‡ä¸º 0.01ï¼ŒåŠ¨é‡ä¸º 0.9ã€‚åœ¨ optim ä¸­æ³¨å†Œæ¨¡åž‹çš„æ‰€æœ‰å‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">optim&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SDG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">1e-2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">momentum&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 5 ] æœ€åŽï¼Œè°ƒç”¨ &lt;code>.step()&lt;/code> å¯åŠ¨æ¢¯åº¦ä¸‹é™ã€‚ä¼˜åŒ–å™¨é€šè¿‡ &lt;code>.grad&lt;/code> ä¸­å­˜å‚¨çš„æ¢¯åº¦æ¥è°ƒæ•´æ¯ä¸ªå‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># gradient descent&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç¥žç»ç½‘ç»œçš„å¾®åˆ†">ç¥žç»ç½‘ç»œçš„å¾®åˆ†&lt;/h3>
&lt;p>è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ autograd å¦‚ä½•æ”¶é›†æ¢¯åº¦ã€‚
æˆ‘ä»¬åœ¨åˆ›å»º Tensor æ—¶ï¼Œä½¿ç”¨ &lt;code>requires_grad=True&lt;/code> å‚æ•°ï¼Œè¡¨ç¤ºå°†è·Ÿè¸ª Tensor çš„æ‰€æœ‰æ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="mf">2.&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">3.&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">require_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="mf">6.&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">4.&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">require_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»Ž tensor a, b åˆ›å»ºå¦ä¸€ä¸ª tensor Q&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Q&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">3&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å‡è®¾ tensor aï¼Œb æ˜¯ç¥žç»ç½‘ç»œçš„å‚æ•°ï¼Œtensor Q æ˜¯è¯¯å·®ã€‚åœ¨ NN è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬æƒ³è¦èŽ·å¾—ç›¸å¯¹äºŽå‚æ•°çš„è¯¯å·®ï¼Œå³å„è‡ªå¯¹åº”çš„åå¯¼ï¼š&lt;/p>
&lt;p>$$\frac{\partial Q}{\partial a}=9a^2$$&lt;/p>
&lt;p>å½“æˆ‘ä»¬åœ¨ tensor Q ä¸Šè°ƒç”¨ &lt;code>.backward()&lt;/code> æ—¶ï¼ŒAutograd å°†è®¡ç®—è¿™äº›æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å„ä¸ªå¼ é‡çš„ &lt;code>.grad&lt;/code> å±žæ€§ä¸­ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬éœ€è¦åœ¨ &lt;code>Q.backword()&lt;/code> ä¸­æ˜¾å¼ä¼ é€’ &lt;code>gradient&lt;/code> å‚æ•°ï¼ˆä¸Ž Q å½¢çŠ¶ç›¸åŒçš„å¼ é‡ï¼Œè¡¨ç¤º Q ç›¸å¯¹æœ¬èº«çš„æ¢¯åº¦ï¼‰ã€‚&lt;/p>
&lt;p>$$\frac{\partial Q}{\partial b}=-2b$$&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">external_grad&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="mf">1.&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">1.&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Q&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gradient&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">external_grad&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æœ€åŽï¼Œæ¢¯åº¦è®°å½•åœ¨ a.grad b.grad ä¸­ï¼ŒæŸ¥çœ‹æ”¶é›†çš„æ¢¯åº¦æ˜¯å¦æ­£ç¡®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([True, True])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">b&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([True, True])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°† Q èšåˆä¸ºä¸€ä¸ªæ ‡é‡ï¼Œç„¶åŽéšå¼åœ°å‘åŽè°ƒç”¨ï¼Œå¦‚ï¼š&lt;code>Q.sum().backward()&lt;/code>ã€‚&lt;/p>
&lt;h2 id="ç¥žç»ç½‘ç»œ">ç¥žç»ç½‘ç»œ&lt;/h2>
&lt;p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬äº†è§£åˆ° nn åŒ…ä¾èµ– autograd åŒ…æ¥å®šä¹‰æ¨¡åž‹å¹¶æ±‚å¯¼ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•å®šä¹‰ä¸€ä¸ªç½‘ç»œã€‚ä¸€ä¸ª nn.Module åŒ…å«ä¸ª layer å’Œä¸€ä¸ª forward(input) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ž outputã€‚&lt;/p>
&lt;p>å¦‚ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹æ‰‹å†™æ•°å­—å›¾åƒè¿›è¡Œåˆ†ç±»çš„å·ç§¯ç¥žç»ç½‘ç»œï¼š&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/pytorch-handbook/CNN.png"
width="759"
height="209"
srcset="https://www.letout.cn/p/pytorch-handbook/CNN_hufa4266fb90da2cc9816f33e05e560204_9416_480x0_resize_box_3.png 480w, https://www.letout.cn/p/pytorch-handbook/CNN_hufa4266fb90da2cc9816f33e05e560204_9416_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="CNN"
class="gallery-image"
data-flex-grow="363"
data-flex-basis="871px"
>&lt;/p>
&lt;p>ç¥žç»ç½‘ç»œçš„å…¸åž‹è®­ç»ƒè¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>å®šä¹‰åŒ…å«ä¸€äº›å¯å­¦ä¹ çš„å‚æ•°ï¼ˆæƒé‡ï¼‰ç¥žç»ç½‘ç»œæ¨¡åž‹&lt;/li>
&lt;li>åœ¨æ•°æ®é›†ä¸Šè¿­ä»£&lt;/li>
&lt;li>é€šè¿‡ç¥žç»ç½‘ç»œå¤„ç†è¾“å…¥&lt;/li>
&lt;li>è®¡ç®—æŸå¤±ï¼ˆè¾“å‡ºç»“æžœå’Œæ­£ç¡®å€¼çš„å·®å€¼å¤§å°ï¼‰&lt;/li>
&lt;li>å°†æ¢¯åº¦åå‘ä¼ æ’­å›žç½‘ç»œçš„å‚æ•°&lt;/li>
&lt;li>æ›´æ–°ç½‘ç»œçš„å‚æ•°ï¼ˆæ¢¯åº¦ä¸‹é™ï¼‰ï¼šweight = weight - learning_rate * gradient&lt;/li>
&lt;/ul>
&lt;h3 id="å®šä¹‰ç½‘ç»œ">å®šä¹‰ç½‘ç»œ&lt;/h3>
&lt;p>åœ¨æ¨¡åž‹ä¸­å¿…é¡»å®šä¹‰ &lt;code>forward()&lt;/code>ï¼Œ &lt;code>backword&lt;/code>ï¼ˆç”¨æ¥è®¡ç®—æ¢¯åº¦ï¼‰ä¼šè¢« autograd è‡ªåŠ¨åˆ›å»ºã€‚å¯åœ¨ &lt;code>forward()&lt;/code> ä¸­ä½¿ç”¨ä»»ä½•é’ˆå¯¹ Tensor çš„æ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">nn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn.functional&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">F&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Model&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 1 input image channel, 6 output channels, 3x3 square convolution&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># kernel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv_1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv_2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># an affine operation: y = Wx + b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">16&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">6&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">120&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">120&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">84&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">84&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Max Pooling over a (2, 2) window&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max_pool2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># If the size is a square you can only specify a single number&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max_pool2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">num_flat_features&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">x&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">num_flat_features&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sefl&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">]&lt;/span> &lt;span class="c1"># all dimensions except the batch dimension&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num_features&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num_features&lt;/span> &lt;span class="o">*=&lt;/span> &lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">num_features&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Net&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Net(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (conv1): Conv2d(1, 6, kernel_size=(3, 3), stride=(1, 1))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (conv2): Conv2d(6, 16, kernel_size=(3, 3), stride=(1, 1))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (fc1): Linear(in_features=576, out_features=120, bias=True)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (fc2): Linear(in_features=120, out_features=84, bias=True)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (fc3): Linear(in_features=84, out_features=10, bias=True)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># )&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>parameters()&lt;/code> è¿”å›žå¯è¢«å­¦ä¹ çš„å‚æ•°ï¼ˆæƒé‡ï¼‰åˆ—è¡¨å’Œå€¼&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">params&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1"># conv1 çš„ weight torch.Size([6, 1, 3, 3])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æµ‹è¯•éšæœºè¾“å…¥ 32x32ã€‚æ³¨ï¼šè¿™ä¸ªç½‘ç»œï¼ˆLeNetï¼‰çš„æœŸæœ›çš„è¾“å…¥å¤§å°æ˜¯ 32x32ï¼Œå¦‚æžœä½¿ç”¨ MINIST æ•°æ®é›†æ¥è®­ç»ƒè¿™ä¸ªç½‘ç»œï¼Œè¯·æŠŠå›¾ç‰‡å¤§å°é‡æ–°è°ƒæ•´åˆ° 32x32ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">input&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">32&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">out&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.1120, 0.0713, 0.1014, -0.0696, -0.1210, 0.0084, -0.0206, 0.1366,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -0.0455, -0.0036]], grad_fn=&amp;lt;AddmmBackward&amp;gt;)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å°†æ‰€æœ‰çš„å‚æ•°çš„æ¢¯åº¦ç¼“å­˜æ¸…é›¶ï¼Œè¿›è¡Œéšæœºæ¢¯åº¦çš„åå‘ä¼ æ’­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>&lt;code>torch.nn&lt;/code> ä»…æ”¯æŒå°æ‰¹é‡è¾“å…¥ã€‚æ•´ä¸ª &lt;code>torch.nn&lt;/code> åŒ…éƒ½åªæ”¯æŒå°æ‰¹é‡æ ·æœ¬ï¼Œè€Œä¸æ”¯æŒå•ä¸ªæ ·æœ¬ã€‚
å¦‚ï¼š&lt;code>nn.Conv2d&lt;/code>æŽ¥å—ä¸€ä¸ª4ç»´ Tensorï¼Œåˆ†åˆ«ç»´ sSamples * nChannels * Height * Width ï¼ˆæ ·æœ¬æ•°* é€šé“æ•° * é«˜ * å®½ï¼‰ã€‚å¦‚æžœä½ æœ‰å•ä¸ªæ ·æœ¬ï¼Œåªéœ€è¦ä½¿ç”¨ &lt;code>input.unsqueeze(0)&lt;/code> æ¥æ·»åŠ å…¶ä»–çš„ç»´æ•°ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº†å¦‚ä½•æž„å»ºä¸€ä¸ªç½‘ç»œï¼Œå›žé¡¾ä¸€ä¸‹åˆ°ç›®å‰ä¸ºæ­¢ä½¿ç”¨åˆ°çš„ç±»ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>torch.Tensor&lt;/code>ï¼š ä¸€ä¸ªå¤šç»´æ•°ç»„ã€‚ æ”¯æŒä½¿ç”¨ backward() è¿›è¡Œè‡ªåŠ¨æ¢¯åº¦è®¡ç®—ï¼Œå¹¶ä¿å­˜å…³äºŽè¿™ä¸ªå‘é‡çš„æ¢¯åº¦ w.r.t.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>nn.Model&lt;/code>ï¼š ç¥žç»ç½‘ç»œæ¨¡å—ã€‚å®žçŽ°å°è£…å‚æ•°ã€ç§»åŠ¨åˆ° GPU ä¸Šè¿è¡Œã€å¯¼å‡ºã€åŠ è½½ç­‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>nn.Parameter&lt;/code>ï¼š ä¸€ç§å¼ é‡ã€‚å°†å…¶åˆ†é…ä¸º Model çš„å±žæ€§æ—¶ï¼Œè‡ªåŠ¨æ³¨å†Œä¸ºå‚æ•°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>autograd.Function&lt;/code>ï¼š å®žçŽ°ä¸€ä¸ªè‡ªåŠ¨æ±‚å¯¼æ“ä½œçš„å‰å‘å’Œåå‘å®šä¹‰ã€‚æ¯ä¸ª Tensor æ“ä½œéƒ½ä¼šåˆ›å»ºè‡³å°‘ä¸€ä¸ª Function èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹è¿žæŽ¥åˆ°åˆ›å»º Tensor çš„å‡½æ•°ï¼Œå¹¶ç¼–ç å…¶åŽ†å²è®°å½•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æŸå¤±å‡½æ•°">æŸå¤±å‡½æ•°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">target&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># ä¾‹å­ï¼šä¸€ä¸ªå‡è®¾çš„ç»“æžœ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">target&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">target&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># è®© target ä¸Ž output çš„å½¢çŠ¶ç›¸åŒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">criterion&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MSELoss&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">criterion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">target&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">loss&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åå‘ä¼ æ’­">åå‘ä¼ æ’­&lt;/h3>
&lt;p>è¦å®žçŽ°åå‘ä¼ æ’­è¯¯å·®ï¼Œåªéœ€è¦ &lt;code>loss.backward()&lt;/code>ã€‚
ä½†æ˜¯ï¼Œéœ€è¦æ¸…é™¤çŽ°æœ‰çš„æ¢¯åº¦ï¼Œå¦åˆ™æ¢¯åº¦å°†ç´¯ç§¯åˆ°çŽ°æœ‰çš„æ¢¯åº¦ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># å°†æ‰€æœ‰çš„æ¢¯åº¦ç¼“å†²å½’é›¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bias&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># conv1.bias.grad åå‘ä¼ æ’­å‰ tensor([0., 0., 0., 0., 0., 0.])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bias&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># åå‘ä¼ æ’­åŽ tensor([0.0111, -0.0064, 0.0053, -0.0047, 0.0026, -0.0153])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ›´æ–°æƒé‡">æ›´æ–°æƒé‡&lt;/h3>
&lt;p>åœ¨ä½¿ç”¨ PyTorch æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>torch.optim&lt;/code> ä¸­æä¾›çš„æ–¹æ³•è¿›è¡Œæ¢¯åº¦ä¸‹é™ã€‚å¦‚ï¼šSDGï¼ŒNesterov-SDGï¼ŒAdamï¼ŒRMSprop ç­‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.optim&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">optim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºä¸€ä¸ª optimizer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SDG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.01&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨è®­ç»ƒä¸­å¾ªçŽ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># å°†æ¢¯åº¦ç¼“å†²åŒºæ¸…é›¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">criterion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">target&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loass&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backword&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># æ›´æ–°&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è®­ç»ƒåˆ†ç±»å™¨">è®­ç»ƒåˆ†ç±»å™¨&lt;/h2>
&lt;h3 id="æ•°æ®ä»Žå“ªé‡Œæ¥">æ•°æ®ä»Žå“ªé‡Œæ¥ï¼Ÿ&lt;/h3>
&lt;p>é€šå¸¸ï¼Œéœ€è¦å¤„ç†å›¾åƒã€æ–‡æœ¬ã€éŸ³é¢‘æˆ–è§†é¢‘æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å°†æ•°æ®åŠ è½½åˆ° NumPy æ•°ç»„ä¸­çš„æ ‡å‡† Python åŒ…ï¼Œå†å°†è¯¥æ•°å€¼è½¬æ¢ä¸º &lt;code>torch.*Tensor&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>å¤„ç†å›¾åƒï¼Œå¯ä»¥ä½¿ç”¨ Pillowï¼ŒOpenCV&lt;/li>
&lt;li>å¤„ç†éŸ³é¢‘ï¼Œå¯ä»¥ä½¿ç”¨ SciPyï¼Œlibrosa&lt;/li>
&lt;li>å¤„ç†æ–‡æœ¬ï¼Œå¯åŸºäºŽ Python æˆ– Cython çš„åŽŸå§‹åŠ è½½ï¼Œæˆ– NLTK å’Œ SpaCy&lt;/li>
&lt;/ul>
&lt;p>å¯¹äºŽå›¾åƒä»»åŠ¡ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ª &lt;code>torchvision&lt;/code> çš„åŒ…ï¼Œå«æœ‰å¸¸è§çš„æ•°æ®é›†ï¼ˆImagenetï¼ŒCIFAR10ï¼ŒMNISTç­‰ï¼‰çš„æ•°æ®åŠ è½½å™¨ï¼Œä»¥åŠç”¨äºŽå›¾åƒçš„æ•°æ®è½¬æ¢å™¨ï¼ˆtorchvision.datasets å’Œ torch.utils.data.DataLoaderï¼‰ã€‚&lt;/p>
&lt;p>åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œå°†ä½¿ç”¨ CIFAR10 æ•°æ®é›†ã€‚å…¶ä¸­åŒ…å« 10 åˆ†ç±»çš„å›¾åƒï¼šâ€œé£žæœºâ€ï¼Œâ€œæ±½è½¦â€ï¼Œâ€œé¸Ÿâ€ï¼Œâ€œçŒ«â€ï¼Œâ€œé¹¿â€ï¼Œâ€œç‹—â€ï¼Œâ€œé’è›™â€ï¼Œâ€œé©¬â€ï¼Œâ€œèˆ¹â€ï¼Œâ€œå¡è½¦â€ã€‚å›¾åƒçš„å°ºå¯¸ä¸º 3 * 32 * 32ï¼Œå³å°ºå¯¸ä¸º 32 * 32 åƒç´ çš„ 3 é€šé“å½©è‰²å›¾åƒã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/pytorch-handbook/CIFAR-10.png"
width="472"
height="369"
srcset="https://www.letout.cn/p/pytorch-handbook/CIFAR-10_hubd3e6b51c00827c9a17b1eaa7622a23e_30944_480x0_resize_box_3.png 480w, https://www.letout.cn/p/pytorch-handbook/CIFAR-10_hubd3e6b51c00827c9a17b1eaa7622a23e_30944_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="CIFAR-10"
class="gallery-image"
data-flex-grow="127"
data-flex-basis="306px"
>&lt;/p>
&lt;p>æŽ¥ä¸‹æ¥ï¼Œä½œä¸ºæ¼”ç¤ºï¼Œå°†æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ­¥éª¤è®­ç»ƒå›¾åƒåˆ†ç±»å™¨ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>torchvision&lt;/code> åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10 è®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†&lt;/li>
&lt;li>å®šä¹‰ CNN&lt;/li>
&lt;li>å®šä¹‰æŸå¤±å‡½æ•°&lt;/li>
&lt;li>æ ¹æ®è®­ç»ƒæ•°æ®è®­ç»ƒç½‘ç»œ&lt;/li>
&lt;li>åœ¨æµ‹è¯•æ•°æ®ä¸Šæµ‹è¯•ç½‘ç»œ&lt;/li>
&lt;/ul>
&lt;h3 id="åŠ è½½å¹¶æ ‡å‡†åŒ–-cifar10">åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torchvision&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torchvision.transforms&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">transforms&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>torchvision çš„è¾“å‡ºæ˜¯ [0, 1] çš„ PILImage å›¾åƒï¼Œæˆ‘ä»¬è¦æŠŠå®ƒè½¬æ¢ä¸ºå½’ä¸€åŒ–èŒƒå›´ä¸º [-1, 1] çš„å¼ é‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">transform&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">transforms&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Compose&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="n">transforms&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ToTensor&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">transforms&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Normalize&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">))]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">trainset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torchvision&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">datasets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CIFAR10&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;./data&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">download&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">transform&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">transform&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">trainloader&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataLoader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">trainset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shuffle&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_workers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">testset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">trochvision&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">datasets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CIFAR10&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;./data&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">download&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">transform&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">transform&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">testloader&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataLoader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">testset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">barch_size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shuffle&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_workers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">classes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;plane&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;car&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;bird&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;cat&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;deer&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;dog&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;frog&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;horse&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ship&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;truck&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®šä¹‰-cnn">å®šä¹‰ CNN&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">nn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn.functional&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">F&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Module&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># in_channels, out_channels, kernel_size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è¾“å…¥çš„ä¸º 3 é€šé“å›¾åƒï¼Œæå– 6 ä¸ªç‰¹å¾ï¼Œå¾—åˆ° 6 ä¸ª feature mapï¼Œå·ç§¯æ ¸ä¸ºä¸€ä¸ª 5*5 çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MaxPool2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å·ç§¯å±‚è¾“å‡ºäº† 16 ä¸ª feature mapï¼Œæ¯ä¸ª feature map æ˜¯ 6*6 çš„äºŒç»´æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">16&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">120&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">120&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">84&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">84&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pool&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pool&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">x&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨">å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨&lt;/h3>
&lt;p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº¤å‰ç†µä½œä¸ºæŸå¤±å‡½æ•°ï¼Œä½¿ç”¨å¸¦åŠ¨é‡çš„éšæœºæ¢¯åº¦ä¸‹é™ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.optim&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">optim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">criterion&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CrossEntropyLoss&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SDG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.001&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">momentum&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è®­ç»ƒç½‘ç»œ">è®­ç»ƒç½‘ç»œ&lt;/h3>
&lt;p>æŽ¥ä¸‹æ¥ï¼Œåªéœ€è¦åœ¨è¿­ä»£æ•°æ®ï¼Œå°†æ•°æ®è¾“å…¥ç½‘ç»œä¸­å¹¶ä¼˜åŒ–ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">enumerate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">trainloader&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="c1"># èŽ·å–è¾“å…¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># å°†æ¢¯åº¦ç¼“å†²åŒºæ¸…é›¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">inputs&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># æ­£å‘ä¼ æ’­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">criterion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lables&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># åå‘ä¼ æ’­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># ä¼˜åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">2000&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1999&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="c1"># æ¯ 2000 æ‰¹æ¬¡æ‰“å°ä¸€æ¬¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;[]&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">epoch&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="mi">2000&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ•°æ®">åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ•°æ®&lt;/h3>
&lt;p>åœ¨ä¸Šé¢çš„è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬è®­ç»ƒäº† 2 æ¬¡ï¼ŒæŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦æ£€æµ‹ç½‘ç»œæ˜¯å¦ä»Žæ•°æ®é›†ä¸­å­¦ä¹ åˆ°äº†æœ‰ç”¨çš„ä¸œè¥¿ã€‚é€šè¿‡é¢„æµ‹ç¥žç»ç½‘ç»œè¾“å‡ºçš„ç±»åˆ«æ ‡ç­¾ä¸Žå®žé™…æƒ…å†µæ ‡ç­¾å¯¹æ¯”è¿›è¡Œæ£€æµ‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">corrent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">total&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">no_grad&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">testloader&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">images&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lobels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">images&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">predicted&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">outputs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">total&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">corrent&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">predicted&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Accuracy of the network on the 10000 test images: &lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1"> &lt;/span>&lt;span class="si">%%&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">corrent&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of the network on the 10000 test images: 9%&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨è®­ç»ƒä¸¤æ¬¡çš„ç½‘ç»œä¸­ï¼Œéšæœºé€‰æ‹©çš„æ­£ç¡®çŽ‡ä¸º 10%ã€‚ç½‘ç»œä¼¼ä¹Žå­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ã€‚&lt;/p>
&lt;p>é‚£è¿™ä¸ªç½‘ç»œï¼Œè¯†åˆ«å“ªä¸€ç±»å¥½ï¼Œå“ªä¸€ç±»ä¸å¥½å‘¢ï¼Ÿ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">class_corrent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">class_total&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">no_grad&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">testloader&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">images&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">images&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">predicted&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">predicted&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">squeeze&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">label&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">class_correct&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">label&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">class_total&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">label&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Accuracy of &lt;/span>&lt;span class="si">%5s&lt;/span>&lt;span class="s1"> : &lt;/span>&lt;span class="si">%2d&lt;/span>&lt;span class="s1"> &lt;/span>&lt;span class="si">%%&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">classes&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">class_correct&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">class_total&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of plane : 99 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of car : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of bird : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of cat : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of deer : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of dog : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of frog : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of horse : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of ship : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of truck : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ä½¿ç”¨-gpu">ä½¿ç”¨ GPU&lt;/h2>
&lt;p>ä¸Žå°† tensor ç§»åˆ° GPU ä¸Šä¸€æ ·ï¼Œç¥žç»ç½‘ç»œä¹Ÿå¯ä»¥ç§»åŠ¨åˆ° GPU ä¸Šã€‚
å¦‚æžœå¯ä»¥ä½¿ç”¨ CUDAï¼Œå°†è®¾å¤‡å®šä¹‰ä¸ºç¬¬ä¸€ä¸ª cuda è®¾å¤‡ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">device&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cuda:0&amp;#39;&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cuda&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">is_available&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="s1">&amp;#39;cpu&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cuda:0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¤åˆ¶ nn å’Œ tensor åˆ° GPU ä¸Šã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>.to(device)&lt;/code> å¹¶æ²¡æœ‰å¤åˆ¶ nn / tensor åˆ° GPU ä¸Šï¼Œè€Œæ˜¯è¿”å›žäº†ä¸€ä¸ª copyã€‚éœ€è¦èµ‹å€¼åˆ°ä¸€ä¸ªæ–°çš„å˜é‡åŽåœ¨ GPU ä¸Šä½¿ç”¨è¿™ä¸ª nn / tensorã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://pytorch.apachecn.org/#/docs/1.7/02" target="_blank" rel="noopener"
>https://pytorch.apachecn.org/#/docs/1.7/02&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>React Hooks</title><link>https://www.letout.cn/p/react-hooks/</link><pubDate>Thu, 28 Jan 2021 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/react-hooks/</guid><description>&lt;img src="https://www.letout.cn/imgs/9.jpeg" alt="Featured image of post React Hooks" />&lt;h1 id="react-hooks-ç®€ä»‹">React Hooks ç®€ä»‹&lt;/h1>
&lt;h2 id="hook-å«ä¹‰">Hook å«ä¹‰&lt;/h2>
&lt;h1 id="ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶">ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶&lt;/h1>
&lt;h1 id="usestate">useState&lt;/h1>
&lt;h2 id="ä½¿ç”¨">ä½¿ç”¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useState&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">Example&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å£°æ˜Žäº†ä¸€ä¸ª count çš„ state å˜é‡ï¼Œå¹¶åˆå§‹åŒ–ä¸º 0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// setCount è®¾ç½® state å€¼ count çš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œå°† count çš„å€¼ +1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">You&lt;/span> &lt;span class="nx">clicked&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">times&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">button&lt;/span> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Click&lt;/span> &lt;span class="nx">me&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="nx">Example&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è¯­æ³•">è¯­æ³•&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å£°æ˜Žä¸€ä¸ª state å˜é‡ï¼Œå¹¶åŒæ—¶åˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setState&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">initialState&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>useState è¿”å›žä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„
&lt;ul>
&lt;li>state å˜é‡ï¼ŒæŒ‡å‘çŠ¶æ€å½“å‰å€¼&lt;/li>
&lt;li>setState æ›´æ–° state å€¼çš„æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>initialState çŠ¶æ€åˆå§‹å€¼å¯ä»¥æ˜¯æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ç­‰&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸Žç±»ä¸­ä½¿ç”¨-setstate-å¼‚åŒ">ä¸Žç±»ä¸­ä½¿ç”¨ &lt;code>setState&lt;/code> å¼‚åŒ&lt;/h2>
&lt;ul>
&lt;li>ç›¸åŒç‚¹
&lt;ul>
&lt;li>åœ¨ä¸€æ¬¡æ¸²æŸ“å‘¨æœŸä¸­è°ƒç”¨å¤šæ¬¡ setStateï¼Œæ•°æ®åªæ”¹å˜ä¸€æ¬¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¸åŒç‚¹
&lt;ul>
&lt;li>ç±»ç»„ä»¶ä¸­ setState ä¸ºåˆå¹¶&lt;/li>
&lt;li>å‡½æ•°ç»„ä»¶ä¸­ setState ä¸ºæ›¿æ¢&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="useeffect">useEffect&lt;/h1>
&lt;p>useEffect ç”¨æ¥æ‰§è¡Œå‰¯ä½œç”¨ã€‚å¯ä»¥å°† useEffect Hook çœ‹åš &lt;code>componentDidMount, componentDidUpdate, componentWillMount&lt;/code> ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„ç»„åˆã€‚&lt;/p>
&lt;p>å¸¸ç”¨åœ¨ï¼š&lt;/p>
&lt;ul>
&lt;li>æœåŠ¡å™¨è¯·æ±‚&lt;/li>
&lt;li>è®¿é—®å…ƒç´  dom å…ƒç´ &lt;/li>
&lt;li>æœ¬åœ°æŒä¹…åŒ–ç¼“å­˜&lt;/li>
&lt;li>ç»‘å®š/è§£ç»‘äº‹ä»¶&lt;/li>
&lt;li>æ·»åŠ è®¢é˜…&lt;/li>
&lt;li>è®¾ç½®å®šæ—¶å™¨&lt;/li>
&lt;li>è®°å½•æ—¥å¿—&lt;/li>
&lt;li>ç­‰&lt;/li>
&lt;/ul>
&lt;p>useEffect æŽ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¸²æŸ“å®Œæ¯•åŽæ‰æ‰§è¡Œï¼Œè¯¥å‡½æ•°æœ‰è¦æ±‚ï¼šè¦ä¹ˆè¿”å›žä¸€ä¸ªèƒ½æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¦ä¹ˆå°±ä¸è¿”å›žä»»ä½•å†…å®¹ã€‚&lt;/p>
&lt;h2 id="ä¸éœ€è¦æ¸…é™¤çš„-effect">ä¸éœ€è¦æ¸…é™¤çš„ effect&lt;/h2>
&lt;p>åœ¨ React æ›´æ–° DOM ä¹‹åŽï¼Œæˆ‘ä»¬æƒ³è¿è¡Œä¸€äº›é¢å¤–çš„ä»£ç ã€‚æ¯”å¦‚å‘é€ç½‘ç»œè¯·æ±‚ï¼Œæ‰‹åŠ¨å˜æ›´ DOMï¼Œè®°å½•æ—¥å¿—ï¼Œè¿™äº›éƒ½æ˜¯å¸¸è§çš„æ— éœ€æ¸…é™¤çš„æ“ä½œã€‚
å› ä¸ºæˆ‘ä»¬åœ¨æ‰§è¡Œå®Œè¿™äº›æ“ä½œä¹‹åŽï¼Œå°±å¯ä»¥å¿½ç•¥ä»–ä»¬äº†ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹ä¸ºä½¿ç”¨ class å’Œ Hook éƒ½æ˜¯æ€Žä¹ˆå®žçŽ°è¿™äº›å‰¯ä½œç”¨çš„å¯¹æ¯”ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨ç±»ç»„ä»¶">ä½¿ç”¨ç±»ç»„ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åœ¨ React æ›´æ–° DOM æ“ä½œåŽï¼Œç«‹å³æ›´æ–° document çš„ title å±žæ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">class&lt;/span> &lt;span class="nx">Example&lt;/span> &lt;span class="kr">extends&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Component&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç»„ä»¶åŠ è½½æ—¶éœ€è¦æ›´æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">componentDidMount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç»„ä»¶æ›´æ–°æ—¶éœ€è¦æ›´æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">componentDidUpdate&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åœ¨ render() ä¸èƒ½æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚åº”è¯¥åœ¨ react æ›´æ–° DOM åŽå†æ‰§è¡Œå‰¯ä½œç”¨ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">render&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">You&lt;/span> &lt;span class="nx">clicked&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">times&lt;/span>&lt;span class="p">.&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">button&lt;/span> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">})}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">click&lt;/span> &lt;span class="nx">me&lt;/span>&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä½¿ç”¨-hook">ä½¿ç”¨ Hook&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">useState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">Example&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="c1">// ç»è¿‡æ¸²æŸ“æˆ–æ›´æ–°ï¼Œ DOM æ›´æ–°å®Œæ¯•ä¹‹åŽï¼Œä¼šè¿è¡Œè¯¥ effect
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You click &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">You&lt;/span> &lt;span class="nx">clicked&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">times&lt;/span>&lt;span class="p">.&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">button&lt;/span> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">})}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">click&lt;/span> &lt;span class="nx">me&lt;/span>&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åŽå’Œæ¯æ¬¡æ›´æ–°ä¹‹åŽéƒ½ä¼šæ‰§è¡Œ useEffectã€‚ä¸” React ä¿è¯æ¯æ¬¡è¿è¡Œ effect çš„åŒæ—¶ï¼ŒDOM å·²ç»æ›´æ–°å®Œæ¯•ã€‚&lt;/li>
&lt;li>useEffect æ”¾åœ¨ç»„ä»¶å†…éƒ¨è®©æˆ‘ä»¬å¯ä»¥åœ¨ effect ä¸­ç›´æŽ¥è®¿é—® state / propsã€‚æˆ‘ä»¬ä¸éœ€è¦ç‰¹æ®Šçš„ API æ¥è¯»å–ã€‚&lt;/li>
&lt;li>ä¸Ž componentDidMount æˆ– componentDidUpdate ä¸åŒï¼Œä½¿ç”¨ useEffect è°ƒåº¦çš„ effect ä¸ä¼šé˜»å¡žæµè§ˆå™¨æ›´æ–°å±å¹•ï¼Œè¿™è®©ä½ çš„åº”ç”¨çœ‹èµ·æ¥å“åº”æ›´å¿«ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œeffect ä¸éœ€è¦åŒæ­¥åœ°æ‰§è¡Œã€‚åœ¨ä¸ªåˆ«æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚æµ‹é‡å¸ƒå±€ï¼‰ï¼Œæœ‰å•ç‹¬çš„ useLayoutEffect Hook ä¾›ä½ ä½¿ç”¨ï¼Œå…¶ API ä¸Ž useEffect ç›¸åŒã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="éœ€è¦æ¸…é™¤çš„-effect">éœ€è¦æ¸…é™¤çš„ effect&lt;/h2>
&lt;p>æœ‰ä¸€äº›å‰¯ä½œç”¨æ˜¯éœ€è¦æ¸…é™¤çš„ï¼Œå¦‚è®¢é˜…å¤–éƒ¨æ•°æ®æºã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ¸…é™¤å·¥ä½œæ˜¯éžå¸¸é‡è¦çš„ï¼Œå¯ä»¥é˜²æ­¢å¼•èµ·å†…å­˜æ³„éœ²ï¼&lt;/p>
&lt;h3 id="ä½¿ç”¨ç±»ç»„ä»¶-1">ä½¿ç”¨ç±»ç»„ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">class&lt;/span> &lt;span class="nx">FriendStatus&lt;/span> &lt;span class="kr">extends&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Component&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">null&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bind&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentDidMount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentDidUpdate&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentWillUnmount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åœ¨ç»„ä»¶å¸è½½æ—¶ï¼Œå…³é—­è®¢é˜…çš„æ•°æ®æº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">render&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s1">&amp;#39;Loading...&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;Online&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Offline&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä½¿ç”¨å‡½æ•°ç»„ä»¶">ä½¿ç”¨å‡½æ•°ç»„ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">useState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">FriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">isOnline&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// effect å¯é€‰æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¿”å›žå‡½æ•°ä¸ä¸€å®šéœ€è¦å‘½å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">cleanup&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s1">&amp;#39;Loading...&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">isOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;Online&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Offline&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>React ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œæ¸…é™¤æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å¤šä¸ª-effect-å®žçŽ°å…³æ³¨ç‚¹åˆ†ç¦»">å¤šä¸ª Effect å®žçŽ°å…³æ³¨ç‚¹åˆ†ç¦»&lt;/h2>
&lt;p>ä½¿ç”¨ Hook çš„å…¶ä¸­ä¸€ä¸ªç›®çš„æ˜¯è¦è§£å†³ï¼š class ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ç»å¸¸åŒ…å«ä¸ç›¸å…³é€»è¾‘ï¼Œç›¸å…³é€»è¾‘åˆåˆ†ç¦»åœ¨å‡ ä¸ªä¸åŒçš„æ–¹æ³•ä¸­ã€‚&lt;/p>
&lt;p>å¦‚ä¸‹ä¸ºä¸Šæ–‡ä¸­è®¡æ•°å™¨å’Œå¥½å‹çŠ¶æ€æŒ‡ç¤ºå™¨é€»è¾‘ç»„åˆåœ¨ä¸€èµ·çš„ç»„ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">class&lt;/span> &lt;span class="nx">FriendStatusWithCounter&lt;/span> &lt;span class="kr">extends&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Component&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStautsChange&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bind&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç›¸åº”çš„é€»è¾‘è¢«åˆ†é…åœ¨ä¸‰ä¸ªä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">componentDidMount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// counter
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// friend status
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">fried&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentDidUpdate&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentWillUnmount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è‹¥ä½¿ç”¨ Hookï¼Œå’Œä½¿ç”¨å¤šä¸ª state çš„ Hook ä¸€æ ·ï¼Œé€šè¿‡ä½¿ç”¨å¤šä¸ª effectï¼Œå°†ä¸ç›¸å…³çš„é€»è¾‘åˆ†ç¦»åˆ°ä¸åŒçš„ effect ä¸­ã€‚&lt;/p>
&lt;p>Hook å…è®¸æŒ‰ç…§ä»£ç çš„ç”¨é€”è¿›è¡Œåˆ†ç¦»ï¼Œä¸åŒäºŽç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚å°†æŒ‰ç…§ effect å£°æ˜Žçš„é¡ºåºä¾æ¬¡è°ƒç”¨ç»„ä»¶ä¸­çš„æ¯ä¸€ä¸ª effectã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">FriendStatusWithCounter&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">isOneline&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useIsOneline&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setIsOneline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOneline&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è·³è¿‡-effect-è¿›è¡Œæ€§èƒ½ä¼˜åŒ–">è·³è¿‡ Effect è¿›è¡Œæ€§èƒ½ä¼˜åŒ–&lt;/h2>
&lt;p>åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code>componentDidUpdate&lt;/code> ä¸­ &lt;code>prevProps&lt;/code> å’Œ &lt;code>prevState&lt;/code> çš„ props / state çš„å˜åŒ–æ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡ŒæŸäº›å‰¯ä½œç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">componentDidUpdate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">prevProps&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">prevState&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">prevState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ Hook ä¸­ï¼Œå¯ä»¥é€šè¿‡å¯¹ useEffect ä¼ é€’æ•°ç»„ä½œä¸ºç¬¬äºŒå¯é€‰å‚æ•°ï¼Œé€šçŸ¥ React è·³è¿‡å¯¹ effect çš„è°ƒç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">]);&lt;/span> &lt;span class="c1">// è¡¨ç¤º count æ›´æ”¹æ—¶ä¼šè¿›è¡Œæ›´æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// {... , [5]} å½“ count === 5 æ—¶ï¼Œè·³è¿‡ effect
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>è‹¥åªæƒ³è¿è¡Œä¸€æ¬¡ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ [] ä½œä¸ºç¬¬äºŒå‚æ•°ã€‚
&lt;ul>
&lt;li>ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ï¼Œeffect å†…éƒ¨çš„ props å’Œ state ä¼šä¸€ç›´æ‹¥æœ‰å…¶åˆå§‹å€¼ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä½¿ç”¨è¯¥ä¼˜åŒ–ï¼Œè¯·ç¡®ä¿æ•°ç»„ä¸­åŒ…å«äº†æ‰€æœ‰å¤–éƒ¨ä½œç”¨åŸŸä¸­ä¼šéšæ—¶é—´å˜åŒ–ä¸”åœ¨ effect ä¸­ä½¿ç”¨çš„å˜é‡ï¼Œå¦åˆ™ä»£ç ä¼šç”¨åˆ°å…ˆå‰æ¸²æŸ“ä¸­çš„æ—§å˜é‡ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ-effect-çš„åŽŸå› ">æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ Effect çš„åŽŸå› &lt;/h2>
&lt;h1 id="è‡ªå®šä¹‰-hook">è‡ªå®šä¹‰ Hook&lt;/h1>
&lt;p>è‡ªå®šä¹‰ Hook å¯ä»¥å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ã€‚&lt;/p>
&lt;p>ç›®å‰ä¸ºæ­¢ï¼Œåœ¨ React ä¸­æœ‰ä¸¤ç§æµè¡Œçš„æ–¹å¼å…±äº«ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘ï¼š&lt;/p>
&lt;ul>
&lt;li>render props&lt;/li>
&lt;li>é«˜é˜¶ç»„ä»¶
ä½¿ç”¨ Hook å¯ä»¥åœ¨ä¸å¢žåŠ ç»„ä»¶çš„æƒ…å†µä¸‹è§£å†³ç›¸åŒçš„é—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="åˆ›å»ºè‡ªå®šä¹‰-hook">åˆ›å»ºè‡ªå®šä¹‰ Hook&lt;/h2>
&lt;p>å½“æˆ‘ä»¬æƒ³åœ¨å‡½æ•°é—´å…±äº«é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæå–åˆ°å¦å¤–ä¸€ä¸ªå‡½æ•°ä¸­ã€‚ç”±äºŽç»„ä»¶å’Œ Hook éƒ½æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ä¹ŸåŒæ ·ä½¿ç”¨äºŽè¿™ç§æ–¹å¼ã€‚&lt;/p>
&lt;p>è‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åç§°ä»¥ &amp;ldquo;use&amp;rdquo; å¼€å¤´ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–çš„ Hookã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯æ ¹æ®ä¸Šæ–‡ä¸­ &lt;code>FriendStatus&lt;/code> å®žä¾‹ï¼Œæ‰€æå–çš„è‡ªå®šä¹‰ Hookã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useEffect&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åç§°ä¸€å®šä»¥ use å¼€å¤´
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friendID&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">isOnline&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOneline&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friendID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubcribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friendID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">isOnline&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨è¿™ä¸ªè‡ªå®šä¹‰ Hook ä¸­ï¼Œæ²¡æœ‰åŒ…å«ä»»ä½•æ–°å†…å®¹ï¼ˆé€»è¾‘ä¸Žç»„ä»¶ä¸­çš„å®Œå…¨ä¸€è‡´ï¼‰&lt;/p>
&lt;h2 id="ä½¿ç”¨è‡ªå®šä¹‰-hook">ä½¿ç”¨è‡ªå®šä¹‰ Hook&lt;/h2>
&lt;p>ä¸Žç»„ä»¶ä¸€è‡´ï¼Œè¯·ç¡®ä¿åªåœ¨è‡ªå®šä¹‰ Hook çš„é¡¶å±‚æ— æ¡ä»¶åœ°è°ƒç”¨å…¶ä»– Hookã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">function&lt;/span> &lt;span class="nx">FriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">isOnline&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s2">&amp;#34;Loading...&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">isOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;Online&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Offline&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ®µä»£ç ä¸Žä¹‹å‰çš„å·¥ä½œæ–¹å¼å®Œå…¨ä¸€æ ·ï¼Œæˆ‘ä»¬åªæ˜¯å°†å‡½æ•°ä¸­éœ€è¦å…±äº«çš„é€»è¾‘æå–åˆ°å•ç‹¬çš„å‡½æ•°ä¸­ã€‚&lt;/p>
&lt;ul>
&lt;li>è‡ªå®šä¹‰ Hook æ˜¯ä¸€ç§è‡ªç„¶éµå¾ª Hook è®¾è®¡çš„çº¦å®šï¼Œä¸æ˜¯ React çš„ç‰¹æ€§ã€‚&lt;/li>
&lt;li>è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ &amp;ldquo;use&amp;rdquo; å¼€å¤´&lt;/li>
&lt;li>ä¸åŒç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ Hook ä¸ä¼šå…±äº« stateã€‚
&lt;ul>
&lt;li>è‡ªå®šä¹‰ Hook æ˜¯é‡ç”¨çŠ¶æ€é€»è¾‘çš„æœºåˆ¶ï¼ˆä¾‹å¦‚è®¾ç½®ä¸ºè®¢é˜…å¹¶å­˜å‚¨å½“å‰å€¼ï¼‰ï¼Œæ¯æ¬¡ä½¿ç”¨è‡ªå®šä¹‰ Hook æ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰ state å’Œå‰¯ä½œç”¨å®Œå…¨éš”ç¦»ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="åœ¨å¤šä¸ª-hook-ä¹‹é—´ä¼ é€’ä¿¡æ¯">åœ¨å¤šä¸ª Hook ä¹‹é—´ä¼ é€’ä¿¡æ¯&lt;/h2>
&lt;p>ç”±äºŽ Hook æœ¬èº«å°±æ˜¯å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è¿™æ˜¯ä¸€ä¸ªèŠå¤©æ¶ˆæ¯æŽ¥æ”¶è€…çš„é€‰æ‹©å™¨ï¼Œå®ƒä¼šæ˜¾ç¤ºå½“å‰é€‰å®šçš„å¥½å‹æ˜¯å¦åœ¨çº¿
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">ChatRecipientPicker&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰é€‰æ‹©çš„å¥½å‹ ID ä¿å­˜åœ¨ recipientID çŠ¶æ€å˜é‡ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">recipientID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setRecipientID&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“æ›´æ–° recipientID çŠ¶æ€å˜é‡æ—¶ï¼ŒuseFriendStatus Hook ä¼šå–æ¶ˆè®¢é˜…ä¹‹å‰é€‰ä¸­çš„å¥½å‹ï¼Œå¹¶è®¢é˜…æ–°é€‰ä¸­çš„å¥½å‹çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">isRecipientOnline&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">recipientID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">Circle&lt;/span> &lt;span class="nx">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">isRecipientOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;green&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;red&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">select&lt;/span> &lt;span class="c1">// &amp;lt;select&amp;gt; ä¸­é€‰æ‹©å…¶ä»–å¥½å‹æ—¶æ›´æ–° recipientID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">recipientID&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">onChange&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">e&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">setRecipientID&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Number&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">target&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span>&lt;span class="p">))}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">friendList&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friend&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">option&lt;/span> &lt;span class="nx">key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">/option&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">/select&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘ä»¬å°†å½“å‰é€‰æ‹©çš„å¥½å‹ ID ä¿å­˜åœ¨ recipientID çŠ¶æ€å˜é‡ä¸­ï¼Œå¹¶ä¼šåœ¨ç”¨æˆ·ä»Ž &amp;lt;select&amp;gt; ä¸­é€‰æ‹©å…¶ä»–å¥½å‹æ—¶æ›´æ–°è¿™ä¸ª stateã€‚&lt;/p>
&lt;p>ç”±äºŽ useState ä¼šæä¾› recipientID çŠ¶æ€å˜é‡çš„æœ€æ–°å€¼ï¼Œå¯ä»¥å°†å®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™è‡ªå®šä¹‰çš„ useFriendStatus Hookã€‚å½“æˆ‘ä»¬é€‰æ‹©ä¸åŒçš„å¥½å‹å¹¶æ›´æ–° recipientID çŠ¶æ€å˜é‡æ—¶ï¼ŒuseFriendStatus Hook ä¼šå–æ¶ˆè®¢é˜…ä¹‹å‰é€‰ä¸­çš„å¥½å‹ï¼Œå¹¶è®¢é˜…æ–°é€‰ä¸­çš„å¥½å‹çŠ¶æ€ã€‚&lt;/p>
&lt;h1 id="hook-è§„åˆ™">Hook è§„åˆ™&lt;/h1>
&lt;h1 id="é¢å¤–çš„-hook">é¢å¤–çš„ Hook&lt;/h1>
&lt;h1 id="å‚è€ƒ">å‚è€ƒ&lt;/h1>
&lt;ul>
&lt;li>&lt;a class="link" href="https://juejin.im/post/6844903814349193229" target="_blank" rel="noopener"
>https://juejin.im/post/6844903814349193229&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://juejin.im/post/6844903985338400782" target="_blank" rel="noopener"
>https://juejin.im/post/6844903985338400782&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.ruanyifeng.com/blog/2019/09/react-hooks.html" target="_blank" rel="noopener"
>https://www.ruanyifeng.com/blog/2019/09/react-hooks.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://zh-hans.reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener"
>https://zh-hans.reactjs.org/docs/hooks-intro.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>è§£å†³ Ubuntu ç¬”è®°æœ¬è€³æœºæ²¡æœ‰å£°éŸ³çš„é—®é¢˜</title><link>https://www.letout.cn/p/ubuntu-sound/</link><pubDate>Sat, 02 Jan 2021 02:02:02 +0800</pubDate><guid>https://www.letout.cn/p/ubuntu-sound/</guid><description>&lt;img src="https://www.letout.cn/imgs/5.jpeg" alt="Featured image of post è§£å†³ Ubuntu ç¬”è®°æœ¬è€³æœºæ²¡æœ‰å£°éŸ³çš„é—®é¢˜" />&lt;h2 id="ubuntu-è€³æœºæ²¡æœ‰å£°éŸ³">Ubuntu è€³æœºæ²¡æœ‰å£°éŸ³&lt;/h2>
&lt;p>ç¬”è®°æœ¬ä½¿ç”¨ Ubuntu æ’æœ‰çº¿è€³æœºåŽï¼Œå¹¶æ²¡æœ‰ååº”ï¼Œè¯¥å¤–æ”¾è¿˜æ˜¯å¤–æ”¾ã€‚&lt;/p>
&lt;p>æ„Ÿè§‰æ˜¯é€‚é…é—®é¢˜ï¼Œwindows ä¸‹æ²¡æœ‰é—®é¢˜ã€‚æ‰¾äº†ä¸€åœˆåŠžæ³•ï¼Œåªèƒ½é€šè¿‡è½¯ä»¶æ‰‹åŠ¨åˆ‡æ¢äº†ï¼Œæ•ˆæžœè¿˜ä¸é”™ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install pavucontrol
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥åœ¨è¿™é‡Œåˆ‡æ¢è¾“å‡ºè®¾å¤‡ï¼š&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/ubuntu-sound/output.png"
width="514"
height="446"
srcset="https://www.letout.cn/p/ubuntu-sound/output_hubad1730db6fbe32ffe9d254c812a9365_52081_480x0_resize_box_3.png 480w, https://www.letout.cn/p/ubuntu-sound/output_hubad1730db6fbe32ffe9d254c812a9365_52081_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="output"
class="gallery-image"
data-flex-grow="115"
data-flex-basis="276px"
>&lt;/p>
&lt;p>åˆ‡æ¢è¾“å…¥è®¾å¤‡ï¼š&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/ubuntu-sound/input.png"
width="517"
height="448"
srcset="https://www.letout.cn/p/ubuntu-sound/input_hufb6fce95f1bcffd19d35ec16e321d778_54938_480x0_resize_box_3.png 480w, https://www.letout.cn/p/ubuntu-sound/input_hufb6fce95f1bcffd19d35ec16e321d778_54938_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="input"
class="gallery-image"
data-flex-grow="115"
data-flex-basis="276px"
>&lt;/p></description></item><item><title>NumPy</title><link>https://www.letout.cn/p/numpy/</link><pubDate>Tue, 01 Dec 2020 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/numpy/</guid><description>&lt;img src="https://www.letout.cn/imgs/3.jpeg" alt="Featured image of post NumPy" />&lt;h1 id="æ•°æ®ç±»åž‹">æ•°æ®ç±»åž‹&lt;/h1>
&lt;h1 id="æ•°ç»„-numpyarray">æ•°ç»„ numpy.array&lt;/h1>
&lt;h4 id="npzeros">np.zeros&lt;/h4>
&lt;p>åˆ›å»ºæŒ‡å®šå¤§å°çš„æ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ä»¥ 0 å¡«å……ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.zeros(shape, dtype=None, order = &amp;lsquo;C&amp;rsquo;)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>shape æ•°ç»„å½¢çŠ¶&lt;/li>
&lt;li>dtype æ•°æ®ç±»åž‹&lt;/li>
&lt;li>order &amp;lsquo;C&amp;rsquo; ç”¨äºŽ C çš„è¡Œæ•°ç»„ï¼Œæˆ–è€… &amp;lsquo;F&amp;rsquo; ç”¨äºŽ FORTRAN çš„åˆ—æ•°ç»„&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0. 0. 0. 0. 0.]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0 0 0 0 0]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># ä¸‰è¡Œäº”åˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">shape&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0., 0., 0., 0.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0., 0., 0., 0.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0., 0., 0., 0.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="npones">np.ones&lt;/h4>
&lt;p>åˆ›å»ºæŒ‡å®šå¤§å°çš„æ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ä»¥ 1 å¡«å……ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.ones(shape, dtype=None, order=&amp;lsquo;C&amp;rsquo;)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h4 id="npfull">np.full&lt;/h4>
&lt;p>åˆ›å»ºæŒ‡å®šå¤§å°å’Œæ•°æ®çš„æ•°ç»„&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.full(shape, fill_value, dtype=None, order=&amp;lsquo;C&amp;rsquo;)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºä¸€ä¸ª ä¸‰è¡Œäº”åˆ— å€¼ä¸º 666.0 çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">full&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="mf">666.0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="nparange">np.arange&lt;/h4>
&lt;p>åœ¨æ•°ç»„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ range åˆ›å»ºæŒ‡å®šèŒƒå›´çš„æ•°ç»„ï¼ˆä¸èƒ½ä¼ é€’æµ®ç‚¹æ•°ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 20) æ­¥é•¿ä¸º 2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 2, 4, 6, 8, 10, 12, 14, 16, 18]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ numpy ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ arange åˆ›å»ºæ•°ç»„èŒƒå›´å¹¶è¿”å›ž ndarray å¯¹è±¡ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.arange(start, stop, step, dtype)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>start èµ·å§‹å€¼ï¼Œé»˜è®¤ä¸º 0&lt;/li>
&lt;li>stop ç»ˆæ­¢å€¼ï¼Œä¸åŒ…å«&lt;/li>
&lt;li>step æ­¥é•¿ï¼Œé»˜è®¤ä¸º 1&lt;/li>
&lt;li>dtype æ•°æ®ç±»åž‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯ä»¥ä¼ é€’æµ®ç‚¹æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0.2, 0.4, 0.6, 0.8]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="nplinspace">np.linspace&lt;/h4>
&lt;p>åˆ›å»ºä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œæž„æˆä¸€ä¸ªç­‰å·®æ•°åˆ—ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.linspace(start, stop, num=50, endpoint=True, retstep=False,dtype=None, axis=0)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>start èµ·å§‹å€¼&lt;/li>
&lt;li>stop ç»ˆæ­¢å€¼ï¼ˆé»˜è®¤åŒ…å« endpoint=Trueï¼‰&lt;/li>
&lt;li>endpoint å½“ä¸º True æ—¶ï¼Œä¼šåŒ…å« stop çš„å€¼&lt;/li>
&lt;li>retstep å½“ä¸º True æ—¶ï¼Œç”Ÿæˆçš„æ•°ç»„ä¸­ä¼šæ˜¾ç¤ºé—´è·&lt;/li>
&lt;li>dtype æ•°æ®ç±»åž‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿæˆ [0, 20] é—´è·ä¸º 2 çš„ 10 ä¸ªæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">linspace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">11&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 2., 4., 6., 8., 10., 12., 14., 16., 18., 20.]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="nprandom">np.random&lt;/h4>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.random.randint(low, high=None, size=None, dtype=None)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ç”ŸæˆæŒ‡å®šçš„æ•´æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ [0, 10) é—´ç”Ÿæˆä¸€ä¸ªéšæœºæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ [0, 10) é—´ç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º 10 çš„ä¸€ç»´æ•°ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [7, 7, 7, 7, 7, 4, 5, 6, 4, 7]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ [0, 10) é—´ç”Ÿæˆä¸€ä¸ª 3è¡Œ6åˆ— çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŒ‡å®šéšæœºç§å­ï¼Œä½¿ç”Ÿæˆçš„æ•°æ®åœ¨æµ‹è¯•æ—¶ä¿æŒä¸€è‡´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">666&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>numpy.random.random(size=None)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ç”Ÿæˆ [0.0, 1.0) é—´çš„æµ®ç‚¹æ•°ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.random.normal(loc=0.0, scale=1.0, size=None)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ç”Ÿæˆä¸€ä¸ªç¬¦åˆæ­£æ€åˆ†å¸ƒçš„æµ®ç‚¹æ•°ã€‚&lt;/p>
&lt;ul>
&lt;li>loc å‡å€¼&lt;/li>
&lt;li>scale æ–¹å·®&lt;/li>
&lt;li>size å¤§å°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿæˆ å‡å€¼ä¸º 10 æ–¹å·®ä¸º 100 çš„æµ®ç‚¹æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿæˆ å‡å€¼ä¸º 0 æ–¹å·®ä¸º 1 çš„ 3è¡Œ5åˆ—çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="numpyarray-åŸºæœ¬æ“ä½œ">numpy.array åŸºæœ¬æ“ä½œ&lt;/h1>
&lt;p>å‡è®¾æœ‰å¦‚ä¸‹ä¸€ä¸ªä¸€ç»´çš„æ•°ç»„ x å’Œ ä¸€ä¸ªä¸‰è¡Œäº”åˆ—çš„çŸ©é˜µ Xï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">numpy&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">np&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0, 1, 2, 3, 4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 5, 6, 7, 8, 9],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [10, 11, 12, 13, 14]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="reshape">Reshape&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°† x è½¬ç½®ä¸º 2è¡Œ5åˆ—çš„ çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">A&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ] &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°†å‘é‡è£…ç½®æˆçŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -1ï¼šè®© numpy è‡ªå·±å†³å®šç»´åº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 10åˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 10è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">D&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [2],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [3],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [5],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [6],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [7],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [8],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [9],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">E&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ•°æ®ä¸èƒ½æ•´é™¤çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½ reshape&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">F&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åŸºæœ¬å±žæ€§">åŸºæœ¬å±žæ€§&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ndarray.ndim ç§©ï¼Œå³è½´çš„æ•°é‡æˆ–ç»´åº¦çš„æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ndim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ndim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ndarray.shape æ•°ç»„ç»´åº¦ï¼Œå¯¹äºŽçŸ©é˜µä¸ºnè¡Œmåˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (10, )&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (3, 5)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ndarray.size æ•°ç»„å…ƒç´ çš„æ€»ä¸ªæ•°ï¼Œå¯¹äºŽçŸ©é˜µä¸º n*m ä¸ª&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 15&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ•°æ®è®¿é—®">æ•°æ®è®¿é—®&lt;/h2>
&lt;p>ä¸€ç»´ numpy.array å¯ä»¥å’Œæ•°ç»„ä¸€æ ·è¿›è¡Œè®¿é—®ã€‚&lt;/p>
&lt;p>å¤šç»´ numpy.array åœ¨è®¿é—®æ—¶ï¼ŒæŽ¨èä¼ å…¥å¤šä¸ªå‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸€ç»´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>æœºå™¨å­¦ä¹ åŸºç¡€</title><link>https://www.letout.cn/p/mechine-learning-basics/</link><pubDate>Mon, 28 Sep 2020 14:02:02 +0800</pubDate><guid>https://www.letout.cn/p/mechine-learning-basics/</guid><description>&lt;h1 id="æœºå™¨å­¦ä¹ ">æœºå™¨å­¦ä¹ &lt;/h1>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/machinelearning.png"
width="887"
height="316"
srcset="https://www.letout.cn/p/mechine-learning-basics/machinelearning_hu13b17d6db5217e228d729d78505e197d_53854_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/machinelearning_hu13b17d6db5217e228d729d78505e197d_53854_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="machinelearning"
class="gallery-image"
data-flex-grow="280"
data-flex-basis="673px"
>&lt;/p>
&lt;h2 id="åŸºæœ¬æœ¯è¯­">åŸºæœ¬æœ¯è¯­&lt;/h2>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/lris_table.png"
width="497"
height="282"
srcset="https://www.letout.cn/p/mechine-learning-basics/lris_table_hu260d85a8756d54afc32312bc0e6db2f3_34466_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/lris_table_hu260d85a8756d54afc32312bc0e6db2f3_34466_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_table"
class="gallery-image"
data-flex-grow="176"
data-flex-basis="422px"
>&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºè¡¨æ ¼ï¼Œæ˜¯é¸¢å°¾èŠ±ï¼ˆlrisï¼‰ç›¸å…³ä¿¡æ¯çš„æ•°æ®ï¼Œå…¶ä¸­ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°æ®æ•´ä½“ç§°ä¸ºæ•°æ®é›†ï¼ˆdata setï¼‰&lt;/li>
&lt;li>æ¯ä¸€è¡Œæ•°æ®ç§°ä¸ºä¸€ä¸ªæ ·æœ¬ï¼ˆsampleï¼‰&lt;/li>
&lt;li>æ¯ä¸€åˆ—ï¼ˆé™¤è¡¨æ ¼æœ€åŽä¸€åˆ—ï¼‰è¡¨è¾¾æ ·æœ¬çš„ä¸€ä¸ªç‰¹å¾ï¼ˆfeatureï¼‰&lt;/li>
&lt;li>æœ€åŽä¸€åˆ—ï¼Œæˆä¸ºæ ‡è®°ï¼ˆlabelï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/lris_feature.png"
width="729"
height="277"
srcset="https://www.letout.cn/p/mechine-learning-basics/lris_feature_hueb1f2deb5cb4168dcc54624d0c16003a_37076_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/lris_feature_hueb1f2deb5cb4168dcc54624d0c16003a_37076_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature"
class="gallery-image"
data-flex-grow="263"
data-flex-basis="631px"
>&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºä¿¡æ¯ï¼Œå…¶ä¸­ è¼ç‰‡é•¿åº¦ã€å®½åº¦ï¼ŒèŠ±ç“£çš„é•¿åº¦ã€å®½åº¦ç§°ä¸º ç‰¹å¾ï¼›æ¯ä¸€è¡Œç‰¹å¾çš„å€¼ç§°ä¸ºç‰¹å¾å‘é‡ï¼ˆæ•°å­¦ä¸Šé€šå¸¸ä¼šå°†å…¶è¡¨ç¤ºä¸ºåˆ—å‘é‡ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/lris_feature2.png"
width="740"
height="267"
srcset="https://www.letout.cn/p/mechine-learning-basics/lris_feature2_hu711adcd4960fbcd7b6d08efae6dde377_37358_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/lris_feature2_hu711adcd4960fbcd7b6d08efae6dde377_37358_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature2"
class="gallery-image"
data-flex-grow="277"
data-flex-basis="665px"
>&lt;/p>
&lt;p>è‹¥å°†è¯¥å›¾ä¸­çš„æ•°æ®è¡¨ç¤ºä¸ºçŸ©é˜µçš„æ–¹å¼ï¼Œç»“æžœå¦‚å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/lris_array.png"
width="214"
height="248"
srcset="https://www.letout.cn/p/mechine-learning-basics/lris_array_hu72a83eec8e112bcbfe072659d9d3f18d_16930_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/lris_array_hu72a83eec8e112bcbfe072659d9d3f18d_16930_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_array"
class="gallery-image"
data-flex-grow="86"
data-flex-basis="207px"
>&lt;/p>
&lt;p>é€‰æ‹©ä¸¤ç§é¸¢å°¾èŠ±çš„ç‰¹å¾ä¸ºä¾‹ï¼Œå°†å…¶è¡¨ç¤ºä¸ºå¦‚å›¾çš„äºŒç»´ç©ºé—´ï¼ˆå¤šç»´ç‰¹å¾å°†å…¶è¡¨ç¤ºä¸ºå¤šç»´ç©ºé—´ï¼‰ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å°†è¿™æ ·çš„ç©ºé—´ç§°ä¸º ç‰¹å¾ç©ºé—´ï¼ˆfeature spaceï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/lris_feature_space.png"
width="519"
height="361"
srcset="https://www.letout.cn/p/mechine-learning-basics/lris_feature_space_hu3ac3a516a704dd018abbe59f3e7cdabc_44237_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/lris_feature_space_hu3ac3a516a704dd018abbe59f3e7cdabc_44237_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature_space"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="345px"
>&lt;/p>
&lt;p>åˆ†ç±»ä»»åŠ¡æœ¬è´¨å°±æ˜¯åœ¨ç‰¹å¾ç©ºé—´åˆ‡åˆ†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨ç‰¹å¾ç©ºé—´ä¸­ï¼Œå°†é¸¢å°¾èŠ±æ ¹æ®ä¸¤ç§ç‰¹å¾åˆ†ä¸ºäº†ä¸¤ç±»ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/lris_feature_space2.png"
width="514"
height="396"
srcset="https://www.letout.cn/p/mechine-learning-basics/lris_feature_space2_hu50eafd2c36f314e6e36adfce0dde2c44_59204_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/lris_feature_space2_hu50eafd2c36f314e6e36adfce0dde2c44_59204_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature_space2"
class="gallery-image"
data-flex-grow="129"
data-flex-basis="311px"
>&lt;/p>
&lt;h2 id="æœºå™¨å­¦ä¹ çš„åŸºæœ¬ä»»åŠ¡">æœºå™¨å­¦ä¹ çš„åŸºæœ¬ä»»åŠ¡&lt;/h2>
&lt;p>æœºå™¨å­¦ä¹ çš„åŸºæœ¬ä»»åŠ¡åŸºæœ¬æœ‰ä¸¤ç±»ï¼Œåˆ†åˆ«ä¸ºï¼š&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>åˆ†ç±»&lt;/li>
&lt;li>å›žå½’&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="åˆ†ç±»ä»»åŠ¡">åˆ†ç±»ä»»åŠ¡&lt;/h3>
&lt;blockquote>
&lt;ul>
&lt;li>ä¸€äº›ç®—æ³•åªæ”¯æŒå®ŒæˆäºŒåˆ†ç±»çš„ä»»åŠ¡&lt;/li>
&lt;li>å¤šåˆ†ç±»çš„ä»»åŠ¡å¯ä»¥è½¬æ¢æˆäºŒåˆ†ç±»çš„ä»»åŠ¡&lt;/li>
&lt;li>ä¸€äº›ç®—æ³•å¤©ç„¶çš„æ”¯æŒå¤šåˆ†ç±»é—®é¢˜&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h4 id="äºŒåˆ†ç±»">äºŒåˆ†ç±»&lt;/h4>
&lt;p>äºŒåˆ†ç±»é—®é¢˜çš„å¸¸è§å®žä¾‹ï¼š&lt;/p>
&lt;ul>
&lt;li>åˆ¤æ–­é‚®ä»¶æ˜¯åžƒåœ¾é‚®ä»¶ï¼›ä¸æ˜¯åžƒåœ¾é‚®ä»¶&lt;/li>
&lt;li>åˆ¤æ–­å‘æ”¾ç»™å®¢æˆ·ä¿¡ç”¨å¡æœ‰é£Žé™©ï¼›æ— é£Žé™©&lt;/li>
&lt;li>åˆ¤æ–­ç—…æ‚£è‰¯æ€§è‚¿ç˜¤ï¼›æ¶æ€§è‚¿ç˜¤&lt;/li>
&lt;li>åˆ¤æ–­æŸæ”¯è‚¡ç¥¨æ¶¨ï¼›è·Œ&lt;/li>
&lt;/ul>
&lt;h4 id="å¤šåˆ†ç±»">å¤šåˆ†ç±»&lt;/h4>
&lt;p>å¤šåˆ†ç±»é—®é¢˜çš„å¸¸è§å®žä¾‹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°å­—è¯†åˆ«&lt;/li>
&lt;li>å›¾åƒè¯†åˆ«&lt;/li>
&lt;li>åˆ¤æ–­å‘æ”¾ç»™å®¢æˆ·ä¿¡ç”¨å¡çš„é£Žé™©è¯„çº§&lt;/li>
&lt;li>å›´æ£‹æ¸¸æˆç­‰&lt;/li>
&lt;li>è‡ªåŠ¨é©¾é©¶è¯†åˆ«&lt;/li>
&lt;/ul>
&lt;h4 id="å¤šæ ‡ç­¾åˆ†ç±»">å¤šæ ‡ç­¾åˆ†ç±»&lt;/h4>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œä¸ºå¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜çš„å¸¸è§å®žä¾‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/label_classification.png"
width="873"
height="383"
srcset="https://www.letout.cn/p/mechine-learning-basics/label_classification_hud280503f45d6bb1349e14ec6a2810ad7_406716_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/label_classification_hud280503f45d6bb1349e14ec6a2810ad7_406716_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="label_classification"
class="gallery-image"
data-flex-grow="227"
data-flex-basis="547px"
>&lt;/p>
&lt;h3 id="å›žå½’ä»»åŠ¡">å›žå½’ä»»åŠ¡&lt;/h3>
&lt;p>å›žå½’é—®é¢˜çš„ç»“æžœä¸Žåˆ†ç±»é—®é¢˜çš„ç»“æžœä¸åŒï¼Œå›žå½’é—®é¢˜çš„ç»“æžœæ˜¯ä¸€ä¸ªè¿žç»­æ•°å­—çš„å€¼ï¼Œè€Œéžä¸€ä¸ªç±»åˆ«ã€‚&lt;/p>
&lt;p>å¸¸è§çš„å›žå½’é—®é¢˜æœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>æˆ¿å±‹ä»·æ ¼&lt;/li>
&lt;li>å¸‚åœºåˆ†æž&lt;/li>
&lt;li>å­¦æœ¯æˆç»©&lt;/li>
&lt;li>è‚¡ç¥¨ä»·æ ¼&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œå›žå½’ä»»åŠ¡å¯ä»¥ç®€åŒ–æˆåˆ†ç±»ä»»åŠ¡ã€‚&lt;/p>
&lt;h2 id="æœºå™¨å­¦ä¹ ç®—æ³•åˆ†ç±»">æœºå™¨å­¦ä¹ ç®—æ³•åˆ†ç±»&lt;/h2>
&lt;h3 id="ç›‘ç£å­¦ä¹ ">ç›‘ç£å­¦ä¹ &lt;/h3>
&lt;p>ç›‘ç£å­¦ä¹  &lt;code>supervised learning&lt;/code> ä¸»è¦å¤„ç†çš„æ˜¯åˆ†ç±»é—®é¢˜å’Œå›žå½’é—®é¢˜ã€‚&lt;/p>
&lt;p>ç›‘ç£å­¦ä¹ çš„å«ä¹‰æ˜¯ç»™æœºå™¨çš„è®­ç»ƒæ•°æ®ä¸­æ‹¥æœ‰â€œæ ‡è®°â€æˆ–è€…â€œç­”æ¡ˆâ€ã€‚æ ¹æ®è¿™äº›æ•°æ®è¿›è¡Œæ¨¡åž‹çš„è®­ç»ƒã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/supervised_learning.png"
width="871"
height="313"
srcset="https://www.letout.cn/p/mechine-learning-basics/supervised_learning_huf7d45c74be41f0f4fbb77506581979b3_52561_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/supervised_learning_huf7d45c74be41f0f4fbb77506581979b3_52561_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="supervised_learning"
class="gallery-image"
data-flex-grow="278"
data-flex-basis="667px"
>&lt;/p>
&lt;ul>
&lt;li>å¦‚æ ¹æ®å›¾ç‰‡åˆ¤æ–­çŒ«ç‹—ï¼ˆå›¾åƒå·²ç»æ‹¥æœ‰äº†æ ‡å®šä¿¡æ¯ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/supervised_learning_2.png"
width="738"
height="291"
srcset="https://www.letout.cn/p/mechine-learning-basics/supervised_learning_2_hu2b9853d4704d9cf5e3f903309b997aeb_170020_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/supervised_learning_2_hu2b9853d4704d9cf5e3f903309b997aeb_170020_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="supervised_learning_2"
class="gallery-image"
data-flex-grow="253"
data-flex-basis="608px"
>&lt;/p>
&lt;ul>
&lt;li>å¦‚æ›´å…·æ‰‹å†™å­—ä½“è¯†åˆ«æ•°å­—ï¼ˆç»™å‡ºç»“æžœæ ‡è®°ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/supervised_learning_3.png"
width="707"
height="408"
srcset="https://www.letout.cn/p/mechine-learning-basics/supervised_learning_3_hub5f7e5166008572d41af8d4590a4d11f_201016_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/supervised_learning_3_hub5f7e5166008572d41af8d4590a4d11f_201016_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="supervised_learning_3"
class="gallery-image"
data-flex-grow="173"
data-flex-basis="415px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é“¶è¡Œå·²ç»ç§¯ç´¯äº†ä¸€å®šçš„å®¢æˆ·ä¿¡æ¯å’Œä»–ä»¬ä¿¡ç”¨å¡çš„ä¿¡ç”¨æƒ…å†µ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŒ»é™¢å·²ç»ç§¯ç´¯äº†ä¸€å®šçš„ç—…äººä¿¡æ¯å’Œä»–ä»¬æœ€ç»ˆç¡®è¯Šæ˜¯å¦æ‚£ç—…çš„æƒ…å†µã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å¸¸è§çš„ç›‘ç£å­¦ä¹ ç®—æ³•æœ‰ï¼š&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>kè¿‘é‚»&lt;/li>
&lt;li>çº¿æ€§å›žå½’å’Œå¤šé¡¹å¼å›žå½’&lt;/li>
&lt;li>é€»è¾‘å›žå½’&lt;/li>
&lt;li>SVM&lt;/li>
&lt;li>å†³ç­–æ ‘å’Œéšæœºæ£®æž—&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="éžç›‘ç£å­¦ä¹ ">éžç›‘ç£å­¦ä¹ &lt;/h3>
&lt;p>éžç›‘ç£å­¦ä¹  &lt;code>unsupervised learning&lt;/code> ç»™æœºå™¨çš„è®­ç»ƒæ•°æ®æ²¡æœ‰ä»»ä½•â€œæ ‡è®°â€æˆ–è€…â€œç­”æ¡ˆâ€ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning.png"
width="431"
height="320"
srcset="https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning_hu23cfcedd7d7c0433075d3be27fb1b699_35769_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning_hu23cfcedd7d7c0433075d3be27fb1b699_35769_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;p>å¯¹æ²¡æœ‰â€œæ ‡è®°â€çš„æ•°æ®è¿›è¡Œåˆ†ç±» &amp;ndash; èšç±»åˆ†æžã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning_2.png"
width="529"
height="305"
srcset="https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning_2_hua6076421e113c36653c61737a036f410_62650_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning_2_hua6076421e113c36653c61737a036f410_62650_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning_2"
class="gallery-image"
data-flex-grow="173"
data-flex-basis="416px"
>&lt;/p>
&lt;h4 id="æ„ä¹‰">æ„ä¹‰&lt;/h4>
&lt;h5 id="å¯¹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†">å¯¹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†&lt;/h5>
&lt;ul>
&lt;li>ç‰¹å¾æå–ï¼šè¡Œç”¨å¡çš„ä¿¡ç”¨è¯„çº§å’Œäººçš„èƒ–ç˜¦æ— å…³ï¼Ÿ&lt;/li>
&lt;li>ç‰¹å¾åŽ‹ç¼©ï¼šPCA&lt;/li>
&lt;/ul>
&lt;p>é™ç»´å¤„ç†çš„æ„ä¹‰ï¼šæ–¹ä¾¿å¯è§†åŒ–&lt;/p>
&lt;p>æˆ‘ä»¬æ— æ³•ç†è§£å››ç»´ä»¥ä¸Šç©ºé—´ï¼Œæ‰€ä»¥å¯ä»¥å°†å…¶é™ç»´åˆ°ä¸‰ç»´æˆ–è€…äºŒç»´ç©ºé—´ï¼Œæ–¹ä¾¿ç†è§£ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning_3.png"
width="441"
height="308"
srcset="https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning_3_hu38269c3322bdeea39e5dc5fabf9129df_91476_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning_3_hu38269c3322bdeea39e5dc5fabf9129df_91476_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning_3"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="343px"
>&lt;/p>
&lt;h5 id="å¼‚å¸¸æ£€æµ‹">å¼‚å¸¸æ£€æµ‹&lt;/h5>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning_4.png"
width="658"
height="343"
srcset="https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning_4_hu1a0363349b68a744dcaab61af015c7ec_76718_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/unsupervised_learning_4_hu1a0363349b68a744dcaab61af015c7ec_76718_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning_4"
class="gallery-image"
data-flex-grow="191"
data-flex-basis="460px"
>&lt;/p>
&lt;h3 id="åŠç›‘ç£å­¦ä¹ ">åŠç›‘ç£å­¦ä¹ &lt;/h3>
&lt;p>&lt;code>semi-supervised learning&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸€éƒ¨åˆ†æ•°æ®æœ‰â€œæ ‡è®°â€æˆ–è€…ç­”æ¡ˆï¼Œå¦ä¸€éƒ¨åˆ†æ•°æ®æ²¡æœ‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¸¸è§çš„åœºæ™¯ï¼šå„ç§åŽŸå› äº§ç”Ÿçš„æ ‡è®°ç¼ºå¤±ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æˆ‘ä»¬é€šå¸¸éƒ½å…ˆä½¿ç”¨æ— ç›‘ç£å­¦ä¹ æ‰‹æ®µå¯¹æ•°æ®åšå¤„ç†ï¼Œä¹‹åŽä½¿ç”¨ç›‘ç£å­¦ä¹ æ‰‹æ®µåšæ¨¡åž‹çš„è®­ç»ƒå’Œé¢„æµ‹ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å¢žå¼ºå­¦ä¹ ">å¢žå¼ºå­¦ä¹ &lt;/h3>
&lt;p>æ ¹æ®å‘¨å›´çŽ¯å¢ƒçš„æƒ…å†µï¼Œé‡‡å–è¡ŒåŠ¨ï¼Œæ ¹æ®é‡‡å–è¡ŒåŠ¨çš„ç»“æžœï¼Œå­¦ä¹ è¡ŒåŠ¨æ–¹å¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/reinforcement_learning.png"
width="734"
height="290"
srcset="https://www.letout.cn/p/mechine-learning-basics/reinforcement_learning_hu54ff37564e23648f6ad43f62f0917611_39669_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/reinforcement_learning_hu54ff37564e23648f6ad43f62f0917611_39669_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="reinforcement_learning"
class="gallery-image"
data-flex-grow="253"
data-flex-basis="607px"
>&lt;/p>
&lt;ul>
&lt;li>æ— äººé©¾é©¶&lt;/li>
&lt;li>æœºå™¨äºº&lt;/li>
&lt;/ul>
&lt;p>åœ¨å¢žå¼ºå­¦ä¹ ä¸­ï¼Œç›‘ç£å­¦ä¹ å’ŒåŠç›‘ç£å­¦ä¹ æ˜¯åŸºç¡€ã€‚&lt;/p>
&lt;h2 id="æœºå™¨å­¦ä¹ çš„å…¶ä»–åˆ†ç±»">æœºå™¨å­¦ä¹ çš„å…¶ä»–åˆ†ç±»&lt;/h2>
&lt;h3 id="åœ¨çº¿å­¦ä¹ å’Œæ‰¹é‡å­¦ä¹ ">åœ¨çº¿å­¦ä¹ å’Œæ‰¹é‡å­¦ä¹ &lt;/h3>
&lt;h4 id="åœ¨çº¿å­¦ä¹ ">åœ¨çº¿å­¦ä¹ &lt;/h4>
&lt;p>&lt;code>Online Learning&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/online_learning.png"
width="881"
height="356"
srcset="https://www.letout.cn/p/mechine-learning-basics/online_learning_hufd2519c1c5cf57144a0949d734813375_60298_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/online_learning_hufd2519c1c5cf57144a0949d734813375_60298_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="online_learning"
class="gallery-image"
data-flex-grow="247"
data-flex-basis="593px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¼˜ç‚¹ï¼šåŠæ—¶åæ˜ æ–°çš„çŽ¯å¢ƒå˜åŒ–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é—®é¢˜ï¼šæ–°çš„æ•°æ®å¯èƒ½å¸¦æ¥ä¸å¥½çš„å˜åŒ–ï¼Œé”™è¯¯çš„æ•°æ®å¯èƒ½å¸¦æ¥é”™è¯¯çš„ç»“æžœ&lt;/p>
&lt;ul>
&lt;li>è§£å†³æ–¹æ¡ˆï¼šéœ€è¦åŠ å¼ºå¯¹æ•°æ®çš„ç›‘æŽ§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ä¹Ÿé€‚ç”¨äºŽæ•°æ®é‡å·¨å¤§ï¼Œå®Œå…¨æ— æ³•æ‰¹é‡å­¦ä¹ çš„çŽ¯å¢ƒ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="æ‰¹é‡å­¦ä¹ ç¦»çº¿å­¦ä¹ ">æ‰¹é‡å­¦ä¹ ï¼ˆç¦»çº¿å­¦ä¹ ï¼‰&lt;/h4>
&lt;p>&lt;code>Batch Learning / Offline Learning&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/batch_learning.png"
width="887"
height="316"
srcset="https://www.letout.cn/p/mechine-learning-basics/batch_learning_hu13b17d6db5217e228d729d78505e197d_53854_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/batch_learning_hu13b17d6db5217e228d729d78505e197d_53854_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="batch_learning"
class="gallery-image"
data-flex-grow="280"
data-flex-basis="673px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¼˜ç‚¹ï¼šç®€å•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é—®é¢˜ï¼šè¦è€ƒè™‘å¦‚å¦‚ä½•é€‚åº”çŽ¯å¢ƒå˜åŒ–&lt;/p>
&lt;ul>
&lt;li>è§£å†³æ–¹æ¡ˆï¼šå®šæ—¶é‡æ–°æ‰¹é‡å­¦ä¹ &lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç¼ºç‚¹ï¼šæ¯æ¬¡é‡æ–°æ‰¹é‡å­¦ä¹ ï¼Œè¿è¡Œé‡å·¨å¤§ã€‚åœ¨æŸäº›çŽ¯å¢ƒå˜åŒ–éžå¸¸å¿«çš„æƒ…å†µä¸‹ï¼Œç”šè‡³æ˜¯ä¸å¯èƒ½çš„ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å‚æ•°å­¦ä¹ å’Œéžå‚æ•°å­¦ä¹ ">å‚æ•°å­¦ä¹ å’Œéžå‚æ•°å­¦ä¹ &lt;/h3>
&lt;h4 id="å‚æ•°å­¦ä¹ ">å‚æ•°å­¦ä¹ &lt;/h4>
&lt;p>&lt;code>Parametric Learning&lt;/code>&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œä¸ºæˆ¿å±‹é¢ç§¯ä¸Žä»·æ ¼çš„å…³ç³»æ›²çº¿ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/mechine-learning-basics/parametric_learning.png"
width="729"
height="405"
srcset="https://www.letout.cn/p/mechine-learning-basics/parametric_learning_hu2c1f09a65fb7d83b5cf239a816caf4d4_38988_480x0_resize_box_3.png 480w, https://www.letout.cn/p/mechine-learning-basics/parametric_learning_hu2c1f09a65fb7d83b5cf239a816caf4d4_38988_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="parametric_learning"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="432px"
>&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼šä¸€æ—¦å­¦ä¹ åˆ°äº†å‚æ•°ï¼Œå°±ä¸éœ€è¦åŽŸæœ‰çš„æ•°æ®é›†ã€‚&lt;/p>
&lt;h4 id="éžå‚æ•°å­¦ä¹ ">éžå‚æ•°å­¦ä¹ &lt;/h4>
&lt;p>&lt;code>Nonparametric Learning&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸å¯¹æ¨¡åž‹è¿›è¡Œè¿‡å¤šå‡è®¾&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éžå‚æ•°ä¸ç­‰äºŽæ²¡æœ‰å‚æ•°ï¼Œè€Œæ˜¯å¯¹æ•´ä¸ªä¸è¿›è¡Œå»ºæ¨¡ï¼Œä¸å­¦ä¹ ä¸€äº›å‚æ•°&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Spring Cloud Hystrix æœåŠ¡å®¹é”™</title><link>https://www.letout.cn/p/spring-cloud-hystrix/</link><pubDate>Wed, 29 Jul 2020 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/spring-cloud-hystrix/</guid><description>&lt;h1 id="spring-cloud-hystrix">Spring Cloud Hystrix&lt;/h1>
&lt;p>åœ¨å¾®æœåŠ¡æž¶æž„ä¸­ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿæ‹†åˆ†æˆäº†ä¸€ä¸ªä¸ªçš„æœåŠ¡å•å…ƒï¼Œå„å•å…ƒåº”ç”¨é—´é€šè¿‡æœåŠ¡æ³¨å†Œä¸Žè®¢é˜…çš„æ–¹å¼äº’ç›¸ä¾èµ–ã€‚ç”±äºŽæ¯ä¸ªå•å…ƒéƒ½åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­è¿è¡Œï¼Œå¦‚æžœæŸä¸ªæœåŠ¡ä¸å¯ç”¨ï¼Œå¯èƒ½å¯¼è‡´çº§è”æ•…éšœï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨çš„æƒ…å†µï¼ˆé›ªå´©æ•ˆåº”ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œäº§ç”Ÿäº†æ–­è·¯å™¨ç­‰ä¸€ç³»åˆ—çš„æœåŠ¡ä¿æŠ¤æœºåˆ¶ã€‚&lt;/p>
&lt;h1 id="ç®€ä»‹">ç®€ä»‹&lt;/h1>
&lt;p>Spring Cloud Hystrixï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºŽ Netflix çš„å¼€æºæ¡†æž¶ï¼Œå…·æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>æœåŠ¡é™çº§&lt;/li>
&lt;li>ä¾èµ–éš”ç¦»&lt;/li>
&lt;li>æœåŠ¡ç†”æ–­&lt;/li>
&lt;li>ç›‘æŽ§ï¼ˆHystrix Dashboardï¼‰&lt;/li>
&lt;/ul>
&lt;h1 id="å®žçŽ°ä¸€ä¸ª-hystrix-server">å®žçŽ°ä¸€ä¸ª Hystrix Server&lt;/h1>
&lt;h2 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-netflix-hystrix&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ·»åŠ æ³¨è§£">æ·»åŠ æ³¨è§£&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableCircuitBreaker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">HystrixApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">HystrixApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hystrix-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="hystrix-åº”ç”¨">Hystrix åº”ç”¨&lt;/h1>
&lt;h2 id="æœåŠ¡é™çº§">æœåŠ¡é™çº§&lt;/h2>
&lt;p>å‡è®¾çŽ°åœ¨æœ‰ä¸€ä¸ªæŽ¥å£ &lt;code>/user/{id}&lt;/code> èŽ·å–ç”¨æˆ·ä¿¡æ¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@PathVariable&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">userService&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ UserService ä¸­æ·»åŠ è°ƒç”¨æ–¹æ³•çš„æœåŠ¡é™çº§ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@HystrixCommand&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">fallbackMethod&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;userFallback&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ­£å¸¸çš„æœåŠ¡è°ƒç”¨å’Œä¸šåŠ¡ æ­¤å¤„ä»¥ restTemplate ä¸ºä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">url&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/user/{1}&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">userFallback&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å¤„ç†æœåŠ¡é™çº§éœ€è¦è¿”å›žçš„å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æœåŠ¡é™çº§-openfiegn">æœåŠ¡é™çº§ OpenFiegn&lt;/h2>
&lt;h3 id="é…ç½®æ–‡ä»¶-1">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">feign&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hystrix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="openfeign-client-ç«¯å®žçŽ°">OpenFeign Client ç«¯å®žçŽ°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@FeignClient&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;user&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// è¿œç¨‹æœåŠ¡å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">fallback&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">UserClientFallback&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span> &lt;span class="c1">// æŒ‡å®š å½“æœåŠ¡é™çº§æ—¶ï¼Œé‡‡ç”¨çš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">UserClient&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/user/{id}&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@PathVariable&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å®žçŽ° UserClient æŽ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">UserClientFallback&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">UserClient&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@PathVariable&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å®žçŽ°é™çº§å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ä¾èµ–éš”ç¦»">ä¾èµ–éš”ç¦»&lt;/h2>
&lt;p>SpringCloud Hystrix çš„ ä¾èµ–éš”ç¦» ç±»ä¼¼äºŽdockerçš„â€œèˆ±å£æ¨¡å¼â€ã€‚
dockeré€šè¿‡â€èˆ±å£æ¨¡å¼â€å®žçŽ°è¿›ç¨‹éš”ç¦»ï¼Œä½¿å¾—å®¹å™¨ä¹‹é—´äº’ä¸å½±å“ã€‚
è€ŒHystrixä½¿ç”¨è¯¥æ¨¡å¼å®žçŽ°ï¼šâ€œçº¿ç¨‹æ± éš”ç¦»â€ï¼Œä¼šä¸ºæ¯ä¸€ä¸ªHystrixCommandåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹æ± ï¼Œè¿™æ ·å°±ç®—æŸä¸ªåœ¨HystrixåŒ…è£…ä¸‹çš„ä¾èµ–æœåŠ¡å‡ºçŽ°å»¶è¿Ÿè¿‡é«˜æƒ…å†µï¼Œä¹Ÿåªæ˜¯å¯¹è¯¥ä¾èµ–æœåŠ¡çš„è°ƒç”¨äº§ç”Ÿå½±å“ï¼Œå¹¶ä¸ä¼šæ‹–æ…¢å…¶ä»–æœåŠ¡ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ @HystrixCommand æ¥å°†æŸä¸ªå‡½æ•°åŒ…è£…æˆäº† Hystrix å‘½ä»¤æ—¶ï¼ŒHystrixæ¡†æž¶è‡ªåŠ¨åœ°ä¸ºè¿™ä¸ªå‡½æ•°å®žçŽ°äº†ä¾èµ–éš”ç¦»ã€‚æ‰€ä»¥ä¾èµ–éš”ç¦»ï¼ŒæœåŠ¡é™çº§åœ¨ä½¿ç”¨æ—¶å€™éƒ½æ˜¯ä¸€ä½“åŒ–å®žçŽ°çš„ï¼Œè¿™æ ·å°±å¯ä»¥å®žçŽ°æœåŠ¡å®¹é”™ä¿æŠ¤ã€‚åœ¨ç¼–ç¨‹æ¨¡åž‹ä¸Šå°±ä¼šéžå¸¸æ–¹ä¾¿ã€‚&lt;/p>
&lt;h2 id="æœåŠ¡ç†”æ–­">æœåŠ¡ç†”æ–­&lt;/h2></description></item><item><title>Spring Cloud Zuul æœåŠ¡ç½‘å…³</title><link>https://www.letout.cn/p/spring-cloud-zuul/</link><pubDate>Tue, 28 Jul 2020 15:14:45 +0800</pubDate><guid>https://www.letout.cn/p/spring-cloud-zuul/</guid><description>&lt;h1 id="spring-cloud-zuul">Spring Cloud Zuul&lt;/h1>
&lt;p>åœ¨å¾®æœåŠ¡æž¶æž„ä¸­ï¼ŒåŽç«¯æœåŠ¡å¾€å¾€ä¸ç›´æŽ¥å¼€æ”¾ç»™è°ƒç”¨ç«¯ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªAPIç½‘å…³æ ¹æ®è¯·æ±‚çš„urlï¼Œè·¯ç”±åˆ°ç›¸åº”çš„æœåŠ¡ã€‚
å½“æ·»åŠ APIç½‘å…³åŽï¼Œåœ¨ç¬¬ä¸‰æ–¹è°ƒç”¨ç«¯å’ŒæœåŠ¡æä¾›æ–¹ä¹‹é—´å°±åˆ›å»ºäº†ä¸€é¢å¢™ï¼Œè¿™é¢å¢™ç›´æŽ¥ä¸Žè°ƒç”¨æ–¹é€šä¿¡è¿›è¡Œæƒé™æŽ§åˆ¶ï¼ŒåŽå°†è¯·æ±‚å‡è¡¡åˆ†å‘ç»™åŽå°æœåŠ¡ç«¯ã€‚
Spring Cloud Zuul æ˜¯ä¸€ä¸ªåŸºäºŽJVMè·¯ç”±å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæä¾›åŠ¨æ€è·¯ç”±ï¼Œç›‘æŽ§ï¼Œå¼¹æ€§ï¼Œå®‰å…¨ç­‰çš„è¾¹ç¼˜æœåŠ¡ã€‚&lt;/p>
&lt;h1 id="ç®€ä»‹">ç®€ä»‹&lt;/h1>
&lt;p>Zuul çš„ä¸»è¦åŠŸèƒ½æ˜¯è·¯ç”±è½¬å‘å’Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰ã€‚ä¸åŒç±»åž‹çš„ Filter ç”¨äºŽå¤„ç†è¯·æ±‚ï¼Œå¯ä»¥å®žçŽ°ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>æƒé™æŽ§åˆ¶å’Œå®‰å…¨æ€§ï¼šå¯ä»¥è¯†åˆ«è®¤è¯éœ€è¦çš„ä¿¡æ¯å’Œæ‹’ç»ä¸æ»¡è¶³æ¡ä»¶çš„è¯·æ±‚&lt;/li>
&lt;li>ç›‘æŽ§ï¼šç›‘æŽ§è¯·æ±‚ä¿¡æ¯&lt;/li>
&lt;li>åŠ¨æ€è·¯ç”±ï¼šæ ¹æ®éœ€è¦åŠ¨æ€åœ°è·¯ç”±è¯·æ±‚åˆ°åŽå°çš„ä¸åŒæœåŠ¡é›†ç¾¤&lt;/li>
&lt;li>åŽ‹åŠ›æµ‹è¯•ï¼šé€æ¸å¢žå¤§åˆ°é›†ç¾¤çš„æµé‡ï¼Œä»¥ä¾¿è¿›è¡Œæ€§èƒ½è¯„ä¼°&lt;/li>
&lt;li>è´Ÿè½½å‡è¡¡ï¼šä¸ºæ¯ç§ç±»åž‹çš„è¯·æ±‚åˆ†é…å®¹é‡å¹¶ä¸¢å¼ƒè¶…è¿‡é™é¢çš„è¯·æ±‚&lt;/li>
&lt;li>é™æµ&lt;/li>
&lt;li>é»‘ç™½åå•è¿‡æ»¤&lt;/li>
&lt;li>é™æ€èµ„æºå¤„ç†ï¼šç›´æŽ¥åœ¨zuulå¤„ç†é™æ€èµ„æºçš„å“åº”è€Œä¸éœ€è¦è½¬å‘è¿™äº›è¯·æ±‚åˆ°å†…éƒ¨é›†ç¾¤ä¸­&lt;/li>
&lt;/ul>
&lt;h1 id="åŸºç¡€ä½¿ç”¨">åŸºç¡€ä½¿ç”¨&lt;/h1>
&lt;h2 id="åˆ›å»ºä¸€ä¸ª-api-gateway">åˆ›å»ºä¸€ä¸ª api-gateway&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-zuul&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ·»åŠ æ³¨è§£">æ·»åŠ æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableZuulProxy&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ApiGatewayApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ApiGatewayApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">api-gateway&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">9000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># è‡ªå®šä¹‰è·¯ç”±è§„åˆ™&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">routes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">user&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/user/**&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">user &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æµ‹è¯•">æµ‹è¯•&lt;/h3>
&lt;p>é€šè¿‡ä»¥ä¸Šé…ç½®æ–‡ä»¶é…ç½®ï¼Œå³å¯é€šè¿‡ api-gateway æœåŠ¡åŽ»è¯·æ±‚ user æœåŠ¡ã€‚&lt;/p>
&lt;p>å‡è®¾ user æœåŠ¡çš„ç«¯å£ä¸º 8080ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª api ä¸º &lt;code>/info&lt;/code>ã€‚
é€šè¿‡è®¿é—® &lt;code>http://localhost:9000/user/info&lt;/code>ï¼Œå³å¯è®¿é—®è¯¥ apiã€‚ï¼ˆè‹¥åŽŸæŽ¥å£åŒ…å«è·¯ç”±å‰ç¼€ /userï¼Œéœ€è¦ä½¿ç”¨ /user/user/info è®¿é—®ï¼‰&lt;/p>
&lt;h2 id="å¸¸ç”¨åŠŸèƒ½">å¸¸ç”¨åŠŸèƒ½&lt;/h2>
&lt;h3 id="ç»Ÿä¸€å‰ç¼€">ç»Ÿä¸€å‰ç¼€&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">prefix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/proxy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="header-è¿‡æ»¤åŠé‡å®šå‘æ·»åŠ -host">Header è¿‡æ»¤åŠé‡å®šå‘æ·»åŠ  Host&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># é»˜è®¤ä¸ºè¯¥é…ç½®ï¼Œä¼šè¿‡æ»¤ Cookie Set-Cookie Authorization ä¿¡æ¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># è®¾ç½®ä¸ºç©ºå³ä¸ä¼šè¿‡æ»¤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sensitive-headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cookie,Set-Cookie,Authorization&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">add-host-header&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># é‡å®šå‘ä¼šæ·»åŠ  host è¯·æ±‚å¤´&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æŸ¥çœ‹è·¯ç”±ä¿¡æ¯">æŸ¥çœ‹è·¯ç”±ä¿¡æ¯&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–-1">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.boot&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-boot-starter-actuator&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶-1">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">9000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">management&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">endpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exposure&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;routes&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è®¿é—®æŽ¥å£">è®¿é—®æŽ¥å£&lt;/h3>
&lt;ul>
&lt;li>è®¿é—® &lt;code>http://localhost:9000/actuator/routes&lt;/code> èŽ·å–ä¿¡æ¯&lt;/li>
&lt;li>è®¿é—® &lt;code>http://localhost:9000/actuator/routes/details&lt;/code> èŽ·å–è¯¦ç»†ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;h1 id="zuul-åº”ç”¨">Zuul åº”ç”¨&lt;/h1>
&lt;h2 id="zuul-filter">Zuul Filter&lt;/h2>
&lt;p>Filteræ˜¯Zuulçš„æ ¸å¿ƒï¼Œç”¨æ¥å®žçŽ°å¯¹å¤–æœåŠ¡çš„æŽ§åˆ¶ã€‚Filteræœ‰4ä¸ªç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;ul>
&lt;li>pre
&lt;ul>
&lt;li>åœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡å‰æ‰§è¡Œã€‚&lt;/li>
&lt;li>æ¯”å¦‚æƒé™æ ¡éªŒã€æ‰“å°æ—¥å¿—ç­‰åŠŸèƒ½ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>routing
&lt;ul>
&lt;li>åœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡æ—¶æ‰§è¡Œã€‚&lt;/li>
&lt;li>ç”¨äºŽæž„å»ºå‘é€ç»™å¾®æœåŠ¡çš„è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ Apache HttpClient æˆ– Netfilx Ribbon è¯·æ±‚å¾®æœåŠ¡ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>post
&lt;ul>
&lt;li>è¿™ç§è¿‡æ»¤å™¨åœ¨è·¯ç”±åˆ°å¾®æœåŠ¡ä»¥åŽæ‰§è¡Œã€‚&lt;/li>
&lt;li>ä¸ºå“åº”æ·»åŠ æ ‡å‡†çš„HTTP Headerã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯å’ŒæŒ‡æ ‡ã€å°†å“åº”ä»Žå¾®æœåŠ¡å‘é€ç»™å®¢æˆ·ç«¯ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>error
&lt;ul>
&lt;li>å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œè¯¥è¿‡æ»¤å™¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/spring-cloud-zuul/zuul-core.png"
width="921"
height="566"
srcset="https://www.letout.cn/p/spring-cloud-zuul/zuul-core_hu334c91cd99c88cb1ff369a39dfc29056_46538_480x0_resize_box_3.png 480w, https://www.letout.cn/p/spring-cloud-zuul/zuul-core_hu334c91cd99c88cb1ff369a39dfc29056_46538_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="zuul-core"
class="gallery-image"
data-flex-grow="162"
data-flex-basis="390px"
>&lt;/p>
&lt;h3 id="è‡ªå®šä¹‰-filter">è‡ªå®šä¹‰ Filter&lt;/h3>
&lt;p>å®žçŽ°è‡ªå®šä¹‰ Filterï¼Œéœ€ç»§æ‰¿ &lt;code>com.netflix.zuul.ZuulFilter&lt;/code>ï¼Œå¹¶è¦†ç›–ç»§æ‰¿çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">MyFilter&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">ZuulFilter&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="nf">filterType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å®šä¹‰filterçš„ç±»åž‹ï¼Œpreã€routeã€postã€error
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="nf">filterOrder&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å®šä¹‰filterçš„é¡ºåºï¼Œæ•°å­—è¶Šå°è¡¨ç¤ºé¡ºåºè¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">shouldFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ˜¯å¦éœ€è¦æ‰§è¡Œè¯¥filterï¼Œtrueè¡¨ç¤ºæ‰§è¡Œï¼Œfalseè¡¨ç¤ºä¸æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// filteréœ€è¦æ‰§è¡Œçš„å…·ä½“æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="zuul-é™æµ">Zuul é™æµ&lt;/h3>
&lt;p>é™æµåœ¨å‰ç½®è¿‡æ»¤å™¨ï¼ˆpreï¼‰å‰ä½¿ç”¨ï¼Œåœ¨è¯·æ±‚è¢«è½¬å‘å‰è°ƒç”¨ï¼Œä¸”ä¼˜å…ˆçº§æœ€é«˜ã€‚&lt;/p>
&lt;p>ä»¤ç‰Œæ¡¶é™æµç¤ºä¾‹ã€‚ä»¤ç‰Œæ¡¶ç®—æ³•èƒ½å¤Ÿåœ¨é™åˆ¶æ•°æ®çš„å¹³å‡ä¼ è¾“é€ŸçŽ‡çš„åŒæ—¶è¿˜å…è®¸æŸç§ç¨‹åº¦çš„çªå‘ä¼ è¾“ã€‚&lt;/p>
&lt;p>ä»¤ç‰Œæ¡¶ç®—æ³•ä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿåº¦å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼Œè€Œå¦‚æžœè¯·æ±‚éœ€è¦è¢«å¤„ç†ï¼Œåˆ™éœ€è¦å…ˆä»Žæ¡¶é‡ŒèŽ·å–ä¸€ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œå¯å–æ—¶ï¼Œåˆ™æ‹’ç»æœåŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/spring-cloud-zuul/token-bucket.png"
width="595"
height="428"
srcset="https://www.letout.cn/p/spring-cloud-zuul/token-bucket_hu1695d7ffe20c41b60543bc6e8b7c644d_101106_480x0_resize_box_3.png 480w, https://www.letout.cn/p/spring-cloud-zuul/token-bucket_hu1695d7ffe20c41b60543bc6e8b7c644d_101106_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="token-bucket"
class="gallery-image"
data-flex-grow="139"
data-flex-basis="333px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">org.springframework.cloud.netflix.zuul.filters.support.FilterConstants&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RateLimiterFilter&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">ZuulFilter&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç›´æŽ¥ä½¿ç”¨ guava ä¸­çš„ RateLimiter å®žçŽ°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">RateLimiter&lt;/span> &lt;span class="n">RATE_LIMITER&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RateLimiter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">filterType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">FilterConstants&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PRE_TYPE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">filterOrder&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é™æµæ˜¯æœ€é«˜ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥æ¯”æœ€é«˜ä¼˜å…ˆçº§ -3 è¿˜è¦å°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">FilterConstants&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SERVLET_DETECTION_FILTER_ORDER&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">shouldFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">ZuulException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æžœæ²¡æœ‰æ‹¿åˆ°ä»¤ç‰Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">RATE_LIMITER&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">tryAcquire&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RuntimeException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="zuul-é‰´æƒ">Zuul é‰´æƒ&lt;/h3>
&lt;p>åœ¨è¯·æ±‚æœåŠ¡å‰ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æƒé™è®¿é—®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">TokenFilter&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">ZuulFilter&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">filterType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">FilterConstants&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PRE_TYPE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">filterOrder&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è¶Šå°è¶Šé å‰ï¼Œæ”¾åœ¨ PRE_DECORATION_FILTER_ORDER ä¹‹å‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">PRE_DECORATION_FILTER_ORDER&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">shouldFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// éœ€è¦å®šä¹‰çš„é€»è¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">ZuulException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RequestContext&lt;/span> &lt;span class="n">requestContext&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RequestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCurrentContext&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">HttpServletRequest&lt;/span> &lt;span class="n">request&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">requestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getRequest&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// éœ€è¦æ ¹æ®å®žé™…æƒ…å†µï¼Œä»Ž header / cookie ä¸­èŽ·å–ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">token&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">...;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ ¹æ®å®žé™…æƒ…å†µè¿›è¡Œæ ¡éªŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(...)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é¦–å…ˆè®¾ç½® zuul
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">requestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setSendZuulResponse&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è®¾ç½®è¿”å›žä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">requestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setResponseStatusCode&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">HttpStatus&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">UNAUTHORIZED&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="zuul-è·¨åŸŸ">Zuul è·¨åŸŸ&lt;/h2>
&lt;p>åœ¨æµè§ˆå™¨ä¸­çš„ ajax è¯·æ±‚æ˜¯æœ‰åŒæºç­–ç•¥çš„ï¼Œå¦‚æžœè¿åäº†åŒæºç­–ç•¥ï¼Œå°±ä¼šæœ‰è·¨åŸŸé—®é¢˜ã€‚åœ¨ Zuul ä¸­æ·»åŠ  CorsFilter è¿‡æ»¤å™¨ï¼Œæ˜¯è·¨åŸŸé—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">CorsConfig&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">CorsFilter&lt;/span> &lt;span class="nf">corsFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">UrlBaseCorsConfigurationSource&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">UrlBaseCorsConfigrationSOurce&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">CorsConfiguration&lt;/span> &lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CorsConfiguration&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowCredentials&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowedOrigins&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singletonList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowedHeaders&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singletonList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span>&lt;span class="err">ï¼›&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowedMethods&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singletonList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setMaxAge&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">300L&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">registerCorsConfiguration&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/**&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CorsFilter&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Spring Cloud Config ç»Ÿä¸€é…ç½®ä¸­å¿ƒ</title><link>https://www.letout.cn/p/spring-cloud-config/</link><pubDate>Mon, 27 Jul 2020 12:14:45 +0800</pubDate><guid>https://www.letout.cn/p/spring-cloud-config/</guid><description>&lt;h1 id="spring-cloud-config">Spring Cloud Config&lt;/h1>
&lt;p>Spring Cloud Config æ˜¯ä¸€ä¸ªè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ç®¡ç†æ–¹æ¡ˆã€‚&lt;/p>
&lt;ul>
&lt;li>Server
&lt;ul>
&lt;li>æä¾›é…ç½®æ–‡ä»¶çš„å­˜å‚¨ï¼Œä»¥æŽ¥å£çš„å½¢å¼æä¾›é…ç½®æ–‡ä»¶çš„å†…å®¹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Client
&lt;ul>
&lt;li>é€šè¿‡æŽ¥å£èŽ·å–æ•°æ®ï¼Œå¹¶ä¾æ®æ­¤æ•°æ®åˆå§‹åŒ–åº”ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="config-server">Config Server&lt;/h1>
&lt;h2 id="æ–°å»ºä¸€ä¸ª-git-ä»“åº“">æ–°å»ºä¸€ä¸ª git ä»“åº“&lt;/h2>
&lt;p>åœ¨ git æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œç”¨æ¥å­˜æ”¾é…ç½®æ–‡ä»¶ã€‚&lt;/p>
&lt;p>å¹¶åœ¨ä»“åº“ä¸­æ·»åŠ ç›¸åº”çš„é…ç½®æ–‡ä»¶ã€‚&lt;/p>
&lt;ul>
&lt;li>user-dev.yml&lt;/li>
&lt;li>user-test.yml&lt;/li>
&lt;li>user-prod.yml&lt;/li>
&lt;/ul>
&lt;h2 id="å…·ä½“å®žçŽ°">å…·ä½“å®žçŽ°&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-config-server&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ·»åŠ æ³¨è§£">æ·»åŠ æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableConfigServer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ConfigApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConfigApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">config&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">git&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://github.com/xxx/confg &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># é…ç½®æ–‡ä»¶ä»“åº“åœ°å€&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">username&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">password&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">searchpath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">config-repo &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># gitä»“åº“åœ°å€ä¸‹çš„ç›¸å¯¹åœ°å€ï¼Œå¯é…ç½®å¤šä¸ª&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é€šè¿‡æŽ¥å£æŸ¥çœ‹é…ç½®">é€šè¿‡æŽ¥å£æŸ¥çœ‹é…ç½®&lt;/h3>
&lt;p>ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ä¼šè¢«è½¬æ¢æˆwebæŽ¥å£ï¼Œå¯åŠ¨åº”ç”¨åŽï¼Œå¯åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼ˆè‹¥é…ç½®æ–‡ä»¶çš„æ ¼å¼æœ‰é”™è¯¯ï¼Œå°†æ— æ³•è®¿é—®ï¼‰ã€‚&lt;/p>
&lt;p>å¦‚è®¿é—® &lt;code>http://localhost:8000/user/dev&lt;/code> å³å¯è¿”å›ž user-dev.yml çš„é…ç½®ä¿¡æ¯ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>/{application}/{profile}[/{label}]&lt;/code>&lt;/li>
&lt;li>&lt;code>/{application}-{profile}.yml&lt;/code>&lt;/li>
&lt;li>&lt;code>/{label}/{application}-{profile}.yml&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>profileï¼šé…ç½®çŽ¯å¢ƒï¼Œlabelï¼šä»“åº“åˆ†æ”¯ã€‚&lt;/p>
&lt;h1 id="config-client">Config Client&lt;/h1>
&lt;h2 id="åœ¨é¡¹ç›®ä¸­åˆ›å»º-bootstrapyml">åœ¨é¡¹ç›®ä¸­åˆ›å»º bootstrap.yml&lt;/h2>
&lt;p>åœ¨é¡¹ç›®ä¸­ï¼Œbootstrap.yml ä¼šä¼˜å…ˆäºŽ application.yml åŠ è½½ã€‚&lt;/p>
&lt;h3 id="applicationyml-åº”ç”¨åœºæ™¯">application.yml åº”ç”¨åœºæ™¯&lt;/h3>
&lt;p>ä¸»è¦ç”¨äºŽ Spring Boot é¡¹ç›®çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚&lt;/p>
&lt;h3 id="bootstrapyml-åº”ç”¨åœºæ™¯">bootstrap.yml åº”ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ä»Žé¢å¤–çš„èµ„æºåŠ è½½é…ç½®ä¿¡æ¯ï¼ˆå¦‚ä½¿ç”¨ Spring Cloud Config æ—¶ï¼‰&lt;/li>
&lt;li>ä¸€äº›å›ºå®šä¸èƒ½è¢«è¦†ç›–çš„å±žæ€§ï¼ˆå…·æœ‰é«˜ä¼˜å…ˆçº§ï¼Œä¸€èˆ¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®æˆ–applicationä¸­åŒåé…ç½®è¦†ç›–ï¼‰&lt;/li>
&lt;li>ä¸€äº› åŠ å¯†/è§£å¯† çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;h2 id="å…·ä½“å®žçŽ°-1">å…·ä½“å®žçŽ°&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–-1">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-config&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶-1">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">user &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># è¯¥åº”ç”¨èŽ·å–ä¹‹å‰é…ç½®å¥½çš„ user-dev.yml &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8000/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">profile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">master&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">discovery&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å¯ç”¨æœåŠ¡å‘çŽ° (Eureka)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">config &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># spring cloud config server åº”ç”¨åç§°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">profile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">master&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å¯åŠ¨æœåŠ¡">å¯åŠ¨æœåŠ¡&lt;/h3>
&lt;p>å¯åŠ¨æœåŠ¡æ—¶ï¼Œå³ä¼šå…ˆåŽ» git ä»“åº“èŽ·å–é…ç½®ä¿¡æ¯ã€‚&lt;/p>
&lt;h1 id="é…ç½®ä¿¡æ¯è‡ªåŠ¨æ›´æ–°">é…ç½®ä¿¡æ¯è‡ªåŠ¨æ›´æ–°&lt;/h1>
&lt;p>å½“ git ä»“åº“ä¸­çš„é…ç½®ä¿¡æ¯æ›´æ–°åŽï¼Œä½¿ç”¨é…ç½®çš„å®¢æˆ·ç«¯å¹¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°é…ç½®ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€äº›æœºåˆ¶åŽ»è§¦å‘é…ç½®çš„æ›´æ–°ã€‚&lt;/p>
&lt;h2 id="actuator">actuator&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–-2">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.boot&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-boot-starter-actuator&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ·»åŠ æ³¨è§£æ‰“å¼€æ›´æ–°æœºåˆ¶">æ·»åŠ æ³¨è§£ï¼Œæ‰“å¼€æ›´æ–°æœºåˆ¶&lt;/h3>
&lt;p>é€šè¿‡åœ¨éœ€è¦åŠ è½½æ›´æ–°é…ç½®çš„ç±»ä¸Šæ·»åŠ  &lt;code>@RefreshScope&lt;/code>ï¼Œå½“å®¢æˆ·ç«¯é€šè¿‡è§¦å‘ POST æ–¹å¼çš„ &lt;code>/refresh&lt;/code> æ—¶ï¼Œä¼šè‡ªåŠ¨å°†æ–°çš„é…ç½®æ›´æ–°åˆ°ç›¸åº”çš„å­—æ®µä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RefreshScope&lt;/span> &lt;span class="c1">// è¯¥ç±»ä¸­é…ç½®ç›¸å…³ä¼šè‡ªåŠ¨åˆ·æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ActuatorController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Value&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;${env}&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@RequestMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/env&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">env&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">env&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶-2">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># server ç«¯æ·»åŠ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">management&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">endpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exposure&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># client ç«¯æ·»åŠ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">management&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">endpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exposure&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">refresh&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æµ‹è¯•è‡ªåŠ¨åˆ·æ–°">æµ‹è¯•è‡ªåŠ¨åˆ·æ–°&lt;/h3>
&lt;p>å½“ git ä»“åº“ä¸­é…ç½®æ–‡ä»¶æ›´æ–°åŽï¼Œé€šè¿‡å‘é€ POST è¯·æ±‚åˆ° &lt;code>/refresh&lt;/code> åŽï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨èŽ·å–æœ€æ–°é…ç½®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl -v -X POST http://localhost:8080/actuator/refresh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="spring-cloud-bus-æŽ¨è">Spring Cloud Bus ï¼ˆæŽ¨èï¼‰&lt;/h2>
&lt;p>é€šè¿‡ spring cloud busï¼Œé€šè¿‡ POST è¯·æ±‚ &lt;code>/bus-refresh&lt;/code>ï¼Œå®žçŽ°è‡ªåŠ¨èŽ·å–æœ€æ–°é…ç½®ã€‚&lt;/p>
&lt;p>è‡³æ­¤ä¸¤ç§æ¶ˆæ¯ä»£ç†ï¼š&lt;/p>
&lt;ul>
&lt;li>RabbitMQ&lt;/li>
&lt;li>Kafka&lt;/li>
&lt;/ul>
&lt;h2 id="webhook">WebHook&lt;/h2>
&lt;p>WebHook æ˜¯å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé€šè¿‡å‘é€ http post è¯·æ±‚çš„æ–¹å¼æ¥é€šçŸ¥ä¿¡æ¯æŽ¥æ”¶æ–¹ã€‚&lt;/p>
&lt;p>é€šè¿‡åˆ›å»º WebHook å³å¯è‡ªåŠ¨è§¦å‘ POST è¯·æ±‚ï¼Œè®©å®¢æˆ·ç«¯åŠ¨æ€åˆ·æ–°é…ç½®ã€‚&lt;/p></description></item><item><title>Spring Cloud æœåŠ¡é€šä¿¡</title><link>https://www.letout.cn/p/spring-cloud-openfeign/</link><pubDate>Sun, 26 Jul 2020 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/spring-cloud-openfeign/</guid><description>&lt;h1 id="spring-cloud-æœåŠ¡é€šä¿¡">Spring Cloud æœåŠ¡é€šä¿¡&lt;/h1>
&lt;ul>
&lt;li>
&lt;p>åŒæ­¥é€šä¿¡ï¼š&lt;/p>
&lt;ul>
&lt;li>dobbo é€šè¿‡ RPC è¿œç¨‹è°ƒç”¨ã€‚&lt;/li>
&lt;li>spring cloud é€šè¿‡ REST æŽ¥å£è°ƒç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å¼‚æ­¥é€šä¿¡ï¼š&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡æ¶ˆæ¯å¯¹åˆ—ï¼Œå¦‚ï¼šRabbitMQï¼ŒKafkaï¼ŒActiveM ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>æœ¬æ–‡ä¸»è¦ä»‹ç» Spring Cloud ä½¿ç”¨ RestTemplate / OpenFeign è¿›è¡Œ REST æŽ¥å£è°ƒç”¨ã€‚&lt;/p>
&lt;h1 id="resttemplate">RestTemplate&lt;/h1>
&lt;h2 id="é€šè¿‡-resttemplate-è¿›è¡Œè°ƒç”¨">é€šè¿‡ RestTemplate è¿›è¡Œè°ƒç”¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="nf">getProductMsg&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="n">restTemplate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RestTemplate&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="n">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;http://example.com/product/info&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// è¿œç¨‹è°ƒç”¨åœ°å€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">ProductInfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// response ç±»åž‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="c1">// éœ€è¦ä¼ é€’çš„å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ©ç”¨-loadbalancerclient-èŽ·å–ä¿¡æ¯">åˆ©ç”¨ LoadBalancerClient èŽ·å–ä¿¡æ¯&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="n">LoadBalancerClient&lt;/span> &lt;span class="n">loadBalancerClient&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="nf">getProductMsg&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="n">restTemplate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RestTemplate&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ServiceInstance&lt;/span> &lt;span class="n">serviceInstance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loadBalancerClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">choose&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;PRODUCT&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ©ç”¨ loadBalancerClient é€šè¿‡åº”ç”¨åï¼ˆspring.application.nameï¼‰èŽ·å–ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">format&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;http://%s:%s&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">serviceInstance&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getHost&lt;/span>&lt;span class="o">(),&lt;/span> &lt;span class="n">serviceInstance&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getPort&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/product/info&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="n">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">ProductInfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ©ç”¨-loadbalance-åœ¨-resttemplate-ä¸­ç›´æŽ¥ä½¿ç”¨åº”ç”¨åç§°">åˆ©ç”¨ LoadBalance åœ¨ RestTemplate ä¸­ç›´æŽ¥ä½¿ç”¨åº”ç”¨åç§°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">RestTemplateConfig&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@LoadBalance&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="nf">restTemplate&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RestTemplate&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="nf">getProductMsg&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ©ç”¨ @LoadBalance å¯ä»¥åœ¨ RestTemplate ä¸­ä½¿ç”¨åº”ç”¨åç§°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="n">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;http://PRODUCT/product/msg&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">ProductInfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="openfeign-æŽ¨è">OpenFeign ï¼ˆæŽ¨èï¼‰&lt;/h1>
&lt;h2 id="å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-openfeign&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ·»åŠ å¯åŠ¨æ³¨è§£">æ·»åŠ å¯åŠ¨æ³¨è§£&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">org.springframework.cloud.openfeign.EnableFeignClients&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableFeignClients&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">FeignApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">FeignApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å…·ä½“å®žçŽ°">å…·ä½“å®žçŽ°&lt;/h2>
&lt;p>çŽ°åœ¨æœ‰ä¸¤ä¸ªæœåŠ¡ï¼Œåˆ†åˆ«ä¸º Prodcut å’Œ Order ã€‚
éœ€æ±‚ï¼š Order æœåŠ¡ä¸­ï¼Œå®¢æˆ·è¿›è¡Œäº†ä¸‹å•æ“ä½œåŽï¼Œè°ƒç”¨ Productï¼ˆFeignï¼‰ çš„è¿›è¡Œå‡åº“å­˜æ“ä½œã€‚&lt;/p>
&lt;ul>
&lt;li>Product æœåŠ¡ä¸­ï¼Œå®šä¹‰è¿œç¨‹è°ƒç”¨ç«¯ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">DecreaseStockInput&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@FeignClient&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;product&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// name: è¿œç¨‹æœåŠ¡å(Spring.application.name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">ProductClient&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@RequestMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/product/decrease_stock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">decreaseStock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@RequestBody&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">DecreaseStockInput&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">decreaseStockInputList&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Order æœåŠ¡ä¸­ï¼Œå¯¹ Product Client è¿›è¡Œè°ƒç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">OrderServiceImpl&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">OrderService&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ³¨å…¥çš„ä¸º Product ä¸­çš„ ProductClient
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// é€šè¿‡ä¾èµ–çš„æ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">ProductClient&lt;/span> &lt;span class="n">productClient&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">OrderDTO&lt;/span> &lt;span class="nf">create&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">OrderDTO&lt;/span> &lt;span class="n">orderDTO&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// è°ƒç”¨ Product æœåŠ¡ä¸­çš„ api è¿›è¡Œå‡åº“å­˜æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">productClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">decreaseStock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">decreaseStockInputList&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Spring Cloud Eureka æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°</title><link>https://www.letout.cn/p/spring-cloud-eureka/</link><pubDate>Sat, 25 Jul 2020 13:14:45 +0800</pubDate><guid>https://www.letout.cn/p/spring-cloud-eureka/</guid><description>&lt;h1 id="eureka-æ‰¾åˆ°å•¦">Eureka æ‰¾åˆ°å•¦ï¼&lt;/h1>
&lt;p>æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°&lt;/p>
&lt;h1 id="ç®€ä»‹">ç®€ä»‹&lt;/h1>
&lt;ul>
&lt;li>Spring Cloud å°è£…äº† Netflix å…¬å¸å¼€å‘çš„ Eureka æ¨¡å—æ¥å®žçŽ°æœåŠ¡æ³¨å†Œå’Œå‘çŽ°ã€‚é‡‡ç”¨äº† C-S çš„è®¾è®¡æž¶æž„ã€‚ç”¨æ¥ç®€åŒ–ä¸ŽæœåŠ¡å™¨çš„äº¤äº’ã€ä½œä¸ºè½®è¯¢è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶æä¾›æœåŠ¡çš„æ•…éšœåˆ‡æ¢æ”¯æŒã€‚&lt;/li>
&lt;li>ç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆã€‚
&lt;ul>
&lt;li>Ereka Serverã€‚ æ³¨å†Œä¸­å¿ƒ&lt;/li>
&lt;li>Ereka Clientã€‚ æœåŠ¡æ³¨å†Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>Eureka é‡‡ç”¨äº†&lt;strong>å®¢æˆ·ç«¯å‘çŽ°&lt;/strong>çš„æ–¹å¼ï¼Œåœ¨æœåŠ¡è¿è¡Œæ—¶ï¼Œé€šè¿‡(è½®è®­ã€hashç­‰è´Ÿè½½å‡è¡¡æœºåˆ¶ç­‰æ–¹å¼)æ³¨å†Œä¸­å¿ƒæ‰¾åˆ°éœ€è¦æœåŠ¡ï¼ˆå³ A é€šè¿‡ æ³¨å†Œä¸­å¿ƒ æ‰¾ Bï¼Œéœ€è¦è°æ‰¾è°ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/spring-cloud-eureka/eureka-server-discovery.png"
width="1202"
height="571"
srcset="https://www.letout.cn/p/spring-cloud-eureka/eureka-server-discovery_huebe0236b66186033cdf1592e4bf67abe_104496_480x0_resize_box_3.png 480w, https://www.letout.cn/p/spring-cloud-eureka/eureka-server-discovery_huebe0236b66186033cdf1592e4bf67abe_104496_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-server-discovery"
class="gallery-image"
data-flex-grow="210"
data-flex-basis="505px"
>&lt;/p>
&lt;h1 id="eureka-server">Eureka Server&lt;/h1>
&lt;p>æ³¨å†Œä¸­å¿ƒè®°å½•ç€æ‰€æœ‰åº”ç”¨çš„ä¿¡æ¯å’ŒçŠ¶æ€(å¦‚ï¼šåº”ç”¨åï¼Œæ‰€åœ¨æœåŠ¡å™¨ï¼Œæ˜¯å¦æ­£å¸¸å·¥ä½œ)ã€‚&lt;/p>
&lt;h2 id="å®žçŽ°ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ">å®žçŽ°ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ&lt;/h2>
&lt;h3 id="1-å¼•å…¥ä¾èµ–">1. å¼•å…¥ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-eureka-server&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-æ·»åŠ å¯åŠ¨æ³¨è§£">2. æ·»åŠ å¯åŠ¨æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableEurekaServer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">EurekaServerApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">EurekaServerApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-é…ç½®æ–‡ä»¶">3. é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverï¼Œä½œä¸º Server ç«¯ä¸éœ€è¦&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æ˜¯å¦ä»ŽEureka ServerèŽ·å–æ³¨å†Œä¿¡æ¯ï¼Œä½œä¸º Server ç«¯ä¸éœ€è¦&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æŽ¥æ”¶çš„æ˜¯ä¸€ä¸ª Map ç»“æž„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="4-å¯åŠ¨ç¨‹åº">4. å¯åŠ¨ç¨‹åº&lt;/h3>
&lt;p>å¯åŠ¨åŽï¼Œè®¿é—® http://localhost:8761/ï¼Œå³å¯çœ‹åˆ° Spring Eureka ç•Œé¢ã€‚&lt;/p>
&lt;h2 id="å®žçŽ°-eureka-é›†ç¾¤">å®žçŽ° Eureka é›†ç¾¤&lt;/h2>
&lt;p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯æœ€é‡è¦çš„åŸºç¡€éƒ¨åˆ†ï¼Œç†åº”éšæ—¶å¤„äºŽå¯ä»¥æä¾›æœåŠ¡çš„çŠ¶æ€ã€‚ä¸ºäº†ç»´æŒå…¶å¯ç”¨æ€§ï¼Œé€šå¸¸ä¼šé‡‡ç”¨é›†ç¾¤çš„æ–¹æ¡ˆã€‚Eurekaé€šè¿‡&lt;strong>äº’ç›¸æ³¨å†Œ&lt;/strong>çš„æ–¹å¼æ¥å®žçŽ°é«˜å¯ç”¨çš„éƒ¨ç½²&lt;/p>
&lt;h3 id="åŒèŠ‚ç‚¹æ³¨å†Œ">åŒèŠ‚ç‚¹æ³¨å†Œ&lt;/h3>
&lt;p>åˆ›å»ºä¸¤å°æœåŠ¡å™¨ï¼Œç«¯å£åˆ†åˆ«ä¸º 8761 å’Œ 8762ã€‚&lt;/p>
&lt;p>å°† 8761 çš„æœåŠ¡å™¨é…ç½®æŒ‡å‘ 8761ï¼Œå°† 8762 çš„æœåŠ¡å™¨æŒ‡å‘ 8761ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å°† service-url æŒ‡å‘ 8762&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8762/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8762&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å°† service-url æŒ‡å‘ 8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯åŠ¨ç¨‹åºåŽï¼Œé€šè¿‡ http://localhost:8761/ å’Œ http://localhost:8762/ éƒ½å¯è®¿é—® Eureka ç•Œé¢ã€‚å¹¶ä¸”å¯ä»¥çœ‹åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¿¡æ¯èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-1.png"
width="1849"
height="596"
srcset="https://www.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-1_huba86fcdb4b5d0d0d30bd35cfb721e86e_55103_480x0_resize_box_3.png 480w, https://www.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-1_huba86fcdb4b5d0d0d30bd35cfb721e86e_55103_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-server-cluster-1"
class="gallery-image"
data-flex-grow="310"
data-flex-basis="744px"
>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-2.png"
width="1745"
height="582"
srcset="https://www.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-2_hu2962bd37558dde85fe30af951e20dc3b_54772_480x0_resize_box_3.png 480w, https://www.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-2_hu2962bd37558dde85fe30af951e20dc3b_54772_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-server-cluster-2"
class="gallery-image"
data-flex-grow="299"
data-flex-basis="719px"
>&lt;/p>
&lt;h3 id="å¤šèŠ‚ç‚¹æ³¨å†Œ">å¤šèŠ‚ç‚¹æ³¨å†Œ&lt;/h3>
&lt;p>åœ¨ç”Ÿäº§ä¸­æˆ‘ä»¬éœ€è¦ä¸‰å°æˆ–è€…å¤§äºŽä¸‰å°çš„æ³¨å†Œä¸­å¿ƒæ¥ä¿è¯æœåŠ¡çš„ç¨³å®šæ€§ï¼Œé…ç½®çš„åŽŸç†å…¶å®žéƒ½ä¸€æ ·ï¼šå°†æ³¨å†Œä¸­å¿ƒåˆ†åˆ«æŒ‡å‘å…¶å®ƒçš„æ³¨å†Œä¸­å¿ƒã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8762/eureka/,http://localhost:8763/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8762&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/,http://localhost:8763/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8763&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/,http://localhost:8762/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="eureka-client">Eureka Client&lt;/h1>
&lt;h2 id="å®žçŽ°ä¸€ä¸ªæœåŠ¡æ³¨å†Œ">å®žçŽ°ä¸€ä¸ªæœåŠ¡æ³¨å†Œ&lt;/h2>
&lt;h3 id="1-ä¾èµ–é…ç½®">1. ä¾èµ–é…ç½®&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-eureka&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-æ·»åŠ å¯åŠ¨æ³¨è§£-1">2. æ·»åŠ å¯åŠ¨æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">org.springframework.cloud.netflix.eureka.server.EnableEurekaServer&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ClientApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ClientApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-é…ç½®æ–‡ä»¶-1">3. é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-client&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># instance: # è‡ªå®šä¹‰é“¾æŽ¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># hostname: example.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="4-å¯åŠ¨ç¨‹åº-1">4. å¯åŠ¨ç¨‹åº&lt;/h3>
&lt;p>å¯åŠ¨ç¨‹åºåŽï¼Œè¿›å…¥ Eureka é¡µé¢ http://localhost:8761/eureka/ï¼Œå³å¯çœ‹åˆ°æ³¨å†Œçš„æœåŠ¡ eureka-clientã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/spring-cloud-eureka/eureka-client.png"
width="1888"
height="356"
srcset="https://www.letout.cn/p/spring-cloud-eureka/eureka-client_hu7c72d91007eb8a4a1109447929086548_37277_480x0_resize_box_3.png 480w, https://www.letout.cn/p/spring-cloud-eureka/eureka-client_hu7c72d91007eb8a4a1109447929086548_37277_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-client"
class="gallery-image"
data-flex-grow="530"
data-flex-basis="1272px"
>&lt;/p>
&lt;h1 id="æ€»ç»“">æ€»ç»“&lt;/h1>
&lt;ul>
&lt;li>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯æœ€é‡è¦çš„åŸºç¡€éƒ¨åˆ†&lt;/li>
&lt;li>@EnableEurekaServer @EnableEurekaClient&lt;/li>
&lt;li>å…·æœ‰ å¿ƒè·³æ£€æµ‹ï¼Œå¥åº·æ£€æŸ¥ï¼Œè´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½&lt;/li>
&lt;li>ä¸ºä¿è¯é«˜å¯ç”¨ï¼Œå»ºè®®é›†ç¾¤éƒ¨ç½²&lt;/li>
&lt;/ul></description></item><item><title>é›·è›‡ çµåˆƒ 15 æ ‡å‡†ç‰ˆ 2018 é»‘è‹¹æžœ</title><link>https://www.letout.cn/p/razer-blade-base-hackintosh/</link><pubDate>Thu, 27 Feb 2020 21:14:45 +0800</pubDate><guid>https://www.letout.cn/p/razer-blade-base-hackintosh/</guid><description>&lt;p>&lt;strong>è­¦å‘Šï¼šè¯¥æ•™ç¨‹ä»…ä¸ºä¸ªäººè®°å½•ï¼Œè¯¥ç¬”è®°æœ¬å®‰è£…æ¶‰åŠè§£é”BIOSï¼Œå­˜åœ¨ä¸€å®šé£Žé™©ï¼Œå¦‚æ‚¨ä½¿ç”¨è¯¥æ•™ç¨‹å¯¹è®¡ç®—æœºè¿›è¡Œæ›´æ”¹ï¼Œæ‰€é€ æˆçš„çš„ä»»ä½•åŽæžœæˆ‘æ¦‚ä¸è´Ÿè´£ã€‚&lt;/strong>&lt;/p>
&lt;h1 id="å†™åœ¨æœ€å‰">å†™åœ¨æœ€å‰&lt;/h1>
&lt;ul>
&lt;li>
&lt;p>å¼€å­¦åŽå¤ªå¿™ï¼Œå¹¶ä¸”ç”µè„‘æˆ‘æ¢äº†å—æ›´å¤§çš„ç¡¬ç›˜ï¼Œè¿™å°ç”µè„‘æˆ‘ä¸æ‰“ç®—å†å®‰è£…é»‘è‹¹æžœäº†ï¼Œæœ¬æ•™ç¨‹å¯èƒ½ä¼šä¸å†æ›´æ–°ï¼Œæœ€æ–°ä¸Šä¼ çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ äº†å¯¹ type-C 4K 30Hz çš„æ”¯æŒï¼Œ4K 60Hz æ˜¾ç¤ºå™¨ä¼šé»‘å±ï¼Œæ— æ³•è¾“å‡ºä¿¡å·ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æžœæƒ³è¦ä½¿ç”¨ Clover å®‰è£… 10.15 æˆ–ä»¥ä¸‹ç³»ç»Ÿçš„è¯ï¼Œå¯ä»¥ä¾æ—§æŒ‰ç…§æ­¤æ•™ç¨‹ï¼ˆè¯·å°† Clover å’Œ kext é€‰æ‹©åˆ°é€‚åº”ç‰ˆæœ¬ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æžœæ‰“ç®—å®‰è£…æ–°ç³»ç»Ÿä½¿ç”¨çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ Opencore å®‰è£…ã€‚æŽ¨èå‚è€ƒ &lt;a class="link" href="https://github.com/Tyson-Hu/RazerBlade15-Base-Model-Hackintosh_macOS_Monterey" target="_blank" rel="noopener"
>RazerBlade15-Base-Model-Hackintosh_macOS_Monterey&lt;/a>ï¼Œè¯¥æ•™ç¨‹å†™çš„éžå¸¸è¯¦ç»†ï¼Œæ„Ÿè°¢ä»–çš„ä»˜å‡ºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å»ºè®®ä¸è¦ä½¿ç”¨ ä¸œèŠï¼ˆé“ ä¾ ï¼‰çš„å›ºæ€ç¡¬ç›˜ï¼Œæˆ‘çš„ç¡¬ç›˜ä¸º&lt;strong>ä¸œèŠ tr200&lt;/strong>ï¼Œåœ¨ macOS ä¸­èŽ«åå¡é¡¿ï¼Œæˆ‘çš„&lt;strong>ä¸œèŠUç›˜&lt;/strong>åœ¨ macOS ä¸­ä¹ŸèŽ«åå¡é¡¿ï¼Œå…¶ä»–ç³»ç»Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ï¼ˆçŽ„å­¦é—®é¢˜ï¼Ÿï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¥ä½ çŽ©å¾—æ„‰å¿«ï¼&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/EmeryWan/Razer-Blade-15-2018-Base-Hackintosh" target="_blank" rel="noopener"
>Github âž¡ï¸&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å› ä¸ºç–«æƒ…åŽŸå› æ˜¥èŠ‚ä¸€ç›´å®…åœ¨å®¶ï¼Œå­¦æ ¡å‡æœŸä¹Ÿå»¶é•¿äº†ï¼Œæ‰¾åˆ°äº†åŒæ¬¾ç¬”è®°æœ¬çš„æ•™ç¨‹ï¼Œæ‰€ä»¥å…¥å‘å®‰è£…é»‘è‹¹æžœï¼Œæœ€è¿‘æŠŠæ­¥éª¤æ•´ç†äº†ä¸€ä¸‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®‰è£…è¿‡ç¨‹æˆ‘ä¸»è¦å‚è€ƒäº† &lt;a class="link" href="https://www.tonymacx86.com/threads/guide-razer-blade-15-2018-detailed-install-guide-high-sierra-10-13-6-17g2208-17g5019.264017/" target="_blank" rel="noopener"
>è¿™ç¯‡&lt;/a> å’Œ &lt;a class="link" href="https://github.com/stonevil/Razer_Blade_Advanced_early_2019_Hackintosh" target="_blank" rel="noopener"
>è¿™ç¯‡&lt;/a> æ•™ç¨‹ï¼Œæ„Ÿè°¢ä»–ä»¬çš„è¾›è‹¦ä»˜å‡ºã€‚éƒ¨åˆ†å†…å®¹ä¸ºä»–ä»¬æ‰€å†™æ•™ç¨‹çš„æ±‰åŒ–ï¼Œè¯¦ç»†æˆ–ç²¾ç®€ï¼Œæˆ‘çš„æ°´å¹³æœ‰é™ï¼ŒåˆšæŽ¥è§¦é»‘è‹¹æžœï¼Œå»ºè®®åŒæ—¶å‚è€ƒä»–ä»¬çš„æ•™ç¨‹ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>ç¡¬ä»¶ä»‹ç»&lt;/li>
&lt;li>ç»“æžœä»‹ç»&lt;/li>
&lt;li>è§£é”BIOS&lt;/li>
&lt;li>å®‰è£…å‰å‡†å¤‡&lt;/li>
&lt;li>ç³»ç»Ÿå®‰è£…&lt;/li>
&lt;li>DSDTï¼ŒSSDTåˆ¶ä½œ&lt;/li>
&lt;li>ç½‘å¡&lt;/li>
&lt;li>ä¸€äº›ä¼˜åŒ–&lt;/li>
&lt;li>å‚è€ƒ&lt;/li>
&lt;li>æ›´æ–°&lt;/li>
&lt;/ul>
&lt;h2 id="1-ç¡¬ä»¶ä»‹ç»">[1] ç¡¬ä»¶ä»‹ç»&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">&lt;/th>
&lt;th style="text-align:center">åž‹å·&lt;/th>
&lt;th style="text-align:center">æœ€ç»ˆæƒ…å†µ&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">CPU&lt;/td>
&lt;td style="text-align:center">i7-8750H&lt;/td>
&lt;td style="text-align:center">å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">GPU&lt;/td>
&lt;td style="text-align:center">Nvdia 1060 Max-Q&lt;/td>
&lt;td style="text-align:center">é™¤ 10.13 High Sierra å®‰è£… WebDriver å¤–ä¸å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">ç¡¬ç›˜&lt;/td>
&lt;td style="text-align:center">æ›´æ¢äº† é‡‘å£«é¡¿ A2000&lt;/td>
&lt;td style="text-align:center">å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">ç½‘å¡&lt;/td>
&lt;td style="text-align:center">9560NGW&lt;/td>
&lt;td style="text-align:center">WIFI ç›®å‰æ— è§£ï¼Œè“ç‰™å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">æ˜¾ç¤ºå™¨&lt;/td>
&lt;td style="text-align:center">1080P&lt;/td>
&lt;td style="text-align:center">å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">æ‘„åƒå¤´&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">æ‰¬å£°å™¨&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">è€³æœº&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">æ— æ³•æ£€æµ‹åˆ°éº¦å…‹é£Ž&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">éº¦å…‹é£Ž&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">ä¸å¯ç”¨ï¼Œå·²è¯†åˆ«ï¼Œä½†åœ¨è®¾ç½®ä¸­æœªçœ‹è§è¾“å…¥ç”µå¹³&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">è§¦æŽ§æ¿&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">æ‰‹åŠ¿å¯ç”¨ï¼ˆååº”ç¨æ…¢ï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">HDMI æŽ¥å£&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">ç›´é€šæ˜¾å¡ï¼Œé™¤å®‰è£… High Sierra å¤–ä¸å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Mini DP æŽ¥å£&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">ç›´é€šæ˜¾å¡ï¼Œé™¤å®‰è£… High Sierra å¤–ä¸å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">é›·ç”µ3&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">è¢«è¯†åˆ«æˆ USB3.1ï¼Œå¯å¤–æŽ¥æ‹“å±•åžå¤–æŽ¥æ˜¾ç¤ºå™¨ï¼Œæˆ‘çš„ç”µè„‘ä¸­éœ€è¦åˆ é™¤SSDT-12-OptTabl.aml&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="2-å®‰è£…ç»“æžœ">[2] å®‰è£…ç»“æžœ&lt;/h2>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/2-1.png"
width="586"
height="353"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/2-1_hu2b7930256d93d7df669e002f0ee8a5ea_76515_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/2-1_hu2b7930256d93d7df669e002f0ee8a5ea_76515_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2-1"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="398px"
>&lt;/p>
&lt;h3 id="ä¸€äº›å°é—®é¢˜">ä¸€äº›å°é—®é¢˜&lt;/h3>
&lt;p>æˆ‘ä¹Ÿæ˜¯åˆšåˆšæŽ¥è§¦é»‘è‹¹æžœï¼Œå¾ˆå¤šé—®é¢˜æˆ‘ä¹Ÿæ— æ³•è§£å†³ï¼Œæœ‰è°äº†è§£çš„è¯å¸Œæœ›èƒ½å¸®åŠ©ä¸€ä¸‹ï¼Œæ„Ÿè°¢ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;del>éº¦å…‹é£Žæ— æ³•ä½¿ç”¨ï¼Œç³»ç»Ÿèƒ½æ‰¾åˆ°ä½†æ— æ³•ä½¿ç”¨ï¼Œè€³æœºéº¦å…‹é£Žæ— æ³•æ‰¾åˆ°ã€‚æƒ³è¦ä½¿ç”¨çš„è¯åªèƒ½é€šè¿‡è“ç‰™è€³æœºäº†ã€‚&lt;/del>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è€³æœºéº¦å…‹æ— æ³•è¯†åˆ«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¾“å‡ºè®¾å¤‡é»˜è®¤è¯†åˆ«åˆ°äº†æ‰¬å£°å™¨å’Œè€³æœºï¼ˆå³ä½¿æœªæ’å…¥è€³æœºï¼‰ï¼Œæ— æ³•è‡ªåŠ¨åˆ‡æ¢ï¼Œéœ€æ‰‹åŠ¨åˆ‡æ¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/2-2.png"
width="294"
height="170"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/2-2_hubc4478c282b951d1ef6fe2ce5f964b3d_36544_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/2-2_hubc4478c282b951d1ef6fe2ce5f964b3d_36544_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2-2"
class="gallery-image"
data-flex-grow="172"
data-flex-basis="415px"
>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ›´æ–°">æ›´æ–°&lt;/h3>
&lt;p>ä»Šå¤©æœ¬æ¥æƒ³æ ¹æ® &lt;a class="link" href="https://blog.daliansky.net/Use-AppleALC-sound-card-to-drive-the-correct-posture-of-AppleHDA.html" target="_blank" rel="noopener"
>è¿™ç¯‡æ–‡ç« &lt;/a> å°è¯•è‡ªå·±å®šåˆ¶ä¸€ä¸‹ &lt;code>AppleALC&lt;/code> ï¼Œå½“æˆ‘æŠŠæœ‰æ•ˆèŠ‚ç‚¹å’Œè·¯å¾„å¼„å®Œä¹‹åŽï¼Œå‡†å¤‡ä¸‹è½½ &lt;a class="link" href="https://github.com/acidanthera/AppleALC/releases" target="_blank" rel="noopener"
>AppleALC-DEBUG&lt;/a> ç¼–è¯‘çš„æ—¶å€™ï¼Œæ²¡æƒ³åˆ°æœ€æ–°ç‰ˆæœ¬å·²ç»æ·»åŠ äº†è¿™ä¸ªç¬”è®°æœ¬çš„ &lt;code>layout-id:23&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/2-3.png"
width="873"
height="546"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/2-3_huecb3588f2c0bb9ac90822e9e02e3e4ec_119856_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/2-3_huecb3588f2c0bb9ac90822e9e02e3e4ec_119856_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2-3"
class="gallery-image"
data-flex-grow="159"
data-flex-basis="383px"
>&lt;/p>
&lt;p>è¯·æŒ‰ç…§å¦‚å›¾ä¿®æ”¹ï¼Œä¿å­˜åŽé‡å¯ã€‚æˆ‘çš„ç”µè„‘è€³æœºéº¦å…‹é£Žæ— æ³•è¯†åˆ«ï¼ˆæˆ‘åœ¨ Ubuntu ä¸‹ä¹Ÿæ— æ³•æ‰¾åˆ°è€³æœºéº¦å…‹é£Žçš„æœ‰æ•ˆèŠ‚ç‚¹ä¿¡æ¯ï¼‰&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/2-4.png"
width="1279"
height="678"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/2-4_hud4d6f2c40445a0b958e52be6265bd97d_161259_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/2-4_hud4d6f2c40445a0b958e52be6265bd97d_161259_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2-4"
class="gallery-image"
data-flex-grow="188"
data-flex-basis="452px"
>&lt;/p>
&lt;p>æ·»åŠ  type-c è¾“å‡º 4kï¼Œåªèƒ½æ”¯æŒåˆ°æœ€é«˜ 30Hzï¼Œè¾“å‡º 60Hz ä¼šç›´æŽ¥é»‘å±ã€‚å¯ä»¥å®‰è£…ä¸€ä¸ª &lt;a class="link" href="https://github.com/avibrazil/RDM" target="_blank" rel="noopener"
>RDM&lt;/a> è¿›è¡Œç®¡ç†ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/2-5.png"
width="1316"
height="696"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/2-5_hu390d568d81002677c5e0774860cb2cfd_174773_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/2-5_hu390d568d81002677c5e0774860cb2cfd_174773_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2-5"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="453px"
>&lt;/p>
&lt;h2 id="3-è§£é”bios">[3] è§£é”BIOS&lt;/h2>
&lt;p>&lt;strong>è§£é”BIOSï¼Œå­˜åœ¨ä¸€å®šé£Žé™©ï¼Œå¦‚æ‚¨ä½¿ç”¨è¯¥æ•™ç¨‹å¯¹è®¡ç®—æœºè¿›è¡Œæ›´æ”¹ï¼Œæ‰€é€ æˆçš„çš„ä»»ä½•åŽæžœæˆ‘æ¦‚ä¸è´Ÿè´£ï¼ï¼ï¼&lt;/strong>&lt;/p>
&lt;p>é›·è›‡å›½å†…å®˜ç½‘æ²¡æœ‰æä¾›é©±åŠ¨å’ŒBIOSçš„ä¸‹è½½ï¼Œå¦‚æœ‰éœ€è¦ï¼Œéœ€è¦è®¿é—®ç¾Žå›½å®˜ç½‘ã€‚&lt;a class="link" href="https://support.razer.com/gaming-laptops/razer-blade-15-2018-base/" target="_blank" rel="noopener"
>ç‚¹æˆ‘ã€‚&lt;/a>&lt;/p>
&lt;p>è¯¥ç¬”è®°æœ¬ DVMT é¢„åˆ†é…é»˜è®¤ä¸º 32MBï¼Œä¸è¶³ä»¥å¯åŠ¨ MacOSï¼Œåœ¨ BIOS ä¸­è¯¥è®¾ç½®é¡¹é»˜è®¤éšè—ï¼Œæ‰€ä»¥è¦æå–æœ¬æœº BIOS å¹¶ä¸”è¿›è¡Œè§£é”ï¼Œå°† DVMT é¢„åˆ†é…é»˜è®¤è®¾ç½®ä¸º 64MBï¼ˆ1080Pï¼‰ï¼Œåˆ†è¾¨çŽ‡æ›´é«˜è¯·åˆ†é…æ›´å¤§ç©ºé—´ã€‚&lt;/p>
&lt;p>&lt;strong>å»ºè®®åœ¨ windows ä¸‹æ“ä½œã€‚&lt;/strong>&lt;/p>
&lt;h3 id="3-1-æå–æœ¬æœº-bios">[3-1] æå–æœ¬æœº BIOS&lt;/h3>
&lt;p>&lt;strong>æ³¨æ„å¤‡ä»½å¥½ã€‚&lt;/strong>&lt;/p>
&lt;p>æ‰“å¼€ &lt;code>AFUWINGUI.exe&lt;/code>ï¼Œç‚¹å‡» Save æŒ‰é’®ï¼Œå¯¼å‡ºæœ¬æœºå½“å‰ BIOS ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/3-1.png"
width="625"
height="463"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/3-1_hu2b3b289386be70a81cfc03a2fd4a6ba9_25755_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/3-1_hu2b3b289386be70a81cfc03a2fd4a6ba9_25755_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3-1"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;h3 id="3-2-ä¿®æ”¹-bios">[3-2] ä¿®æ”¹ BIOS&lt;/h3>
&lt;ul>
&lt;li>æ‰“å¼€ &lt;code>AMIBCP.exe&lt;/code> ï¼Œç‚¹å‡» File -&amp;gt; open æ‰“å¼€å¯¼å‡ºçš„ BIOSã€‚&lt;/li>
&lt;li>å¦‚å›¾ï¼Œåœ¨å·¦ä¾§é€‰æ‹© / -&amp;gt; Setup -&amp;gt; Chipsetï¼Œå°†å·¦ä¾§çš„ &lt;code>System Agent Configuration&lt;/code> çš„ Access ç”± Default ä¿®æ”¹ä¸º USER&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/3-2.png"
width="1073"
height="752"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/3-2_hu504742517ec89fe4fa26edd955452484_46678_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/3-2_hu504742517ec89fe4fa26edd955452484_46678_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3-2"
class="gallery-image"
data-flex-grow="142"
data-flex-basis="342px"
>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/3-3.png"
width="981"
height="234"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/3-3_hu384a5070e96805721cfad18ac4b9c8d8_22227_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/3-3_hu384a5070e96805721cfad18ac4b9c8d8_22227_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3-3"
class="gallery-image"
data-flex-grow="419"
data-flex-basis="1006px"
>&lt;/p>
&lt;ul>
&lt;li>ä¿®æ”¹å®ŒåŽç‚¹å‡» File -&amp;gt; Save asã€‚é‡å‘½åä¸ºæ–°çš„ BIOSã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="3-3-åˆ·å…¥æ–°-bios">[3-3] åˆ·å…¥æ–° BIOS&lt;/h3>
&lt;p>&lt;strong>ï¼ï¼ï¼ æ³¨æ„ï¼Œè¯¥è¿‡ç¨‹è™½ç„¶ç®€å•ï¼Œä½†æœ‰ä¸€å®šé£Žé™©ï¼Œé€ æˆçš„ä»»ä½•ç»“æžœä¸Žæœ¬äººæ— å…³ã€‚&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é‡æ–°æ‰“å¼€ AFUWINGUI.exeï¼Œç‚¹å‡» Open æ‰“å¼€åˆšåˆšä¿®æ”¹åŽçš„ BIOSã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/3-4.png"
width="625"
height="463"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/3-4_hu3d9923cc8e5f7434310ba01f6dc9c068_25929_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/3-4_hu3d9923cc8e5f7434310ba01f6dc9c068_25929_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3-4"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°½å¯èƒ½çš„é€€å‡ºå…¶ä»–ç¨‹åºï¼Œå°½é‡ä¿æŒåŽå°å¹²å‡€ï¼Œå†ç‚¹å‡» Flash åˆ·å…¥æ–°çš„ BIOSã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/3-5.png"
width="625"
height="463"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/3-5_hu3d9923cc8e5f7434310ba01f6dc9c068_27476_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/3-5_hu3d9923cc8e5f7434310ba01f6dc9c068_27476_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3-5"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;ul>
&lt;li>é‡å¯&lt;/li>
&lt;/ul>
&lt;h2 id="4-å®‰è£…å‰å‡†å¤‡">[4] å®‰è£…å‰å‡†å¤‡&lt;/h2>
&lt;h3 id="4-1-å‡†å¤‡macos-catalina-å®‰è£…ç›˜">[4-1] å‡†å¤‡macOS Catalina å®‰è£…ç›˜&lt;/h3>
&lt;p>æŽ¨èä½¿ç”¨&lt;a class="link" href="https://blog.daliansky.net/" target="_blank" rel="noopener"
>é»‘æžœå°å…µ&lt;/a>åˆ¶ä½œçš„é•œåƒï¼Œä½¿ç”¨ &lt;strong>TransMac&lt;/strong> åˆ¶ä½œï¼ˆè½¯ä»¶åœ¨æ–‡ä»¶å¤¹ä¸­å·²æä¾›ï¼‰ã€‚&lt;a class="link" href="https://blog.daliansky.net/macOS-Catalina-10.15.3-19D76-Release-version-with-Clover-5103-original-image-Double-EFI-Version.html" target="_blank" rel="noopener"
>è¿™é‡Œæ˜¯10.15.3çš„é•œåƒ&lt;/a>ã€‚&lt;/p>
&lt;p>å¦‚æžœæ‚¨è¦å®‰è£…æ›´æ–°çš„ç³»ç»Ÿï¼Œè¯·å‡çº§ CLOVERï¼Œå’Œ kexts/ åˆ°å¯¹åº”å…¼å®¹æˆ–æ›´æ–°çš„ç‰ˆæœ¬ï¼Œå¯å°†åˆ¶ä½œå¥½çš„å®‰è£…ç›˜ä¸­ &lt;code>EFI/CLOVER&lt;/code> çš„æ–‡ä»¶è¿›è¡ŒåŒåæ›¿æ¢ã€‚ï¼ˆæœªæ¥çš„æ–°ç‰ˆæœ¬å¯èƒ½ä¸å¯é¢„çŸ¥çš„é—®é¢˜ï¼Œè¯·é…Œæƒ…å‡çº§ï¼‰ã€‚&lt;/p>
&lt;h3 id="4-2-å¯åŠ¨ç›˜åˆ¶ä½œ">[4-2] å¯åŠ¨ç›˜åˆ¶ä½œ&lt;/h3>
&lt;p>è¯·å‚è€ƒï¼Œæˆ–è‡ªè¡Œæœç´¢ï¼Œç½‘ä¸Šæ•™ç¨‹å¾ˆå¤šã€‚&lt;a class="link" href="https://zhuanlan.zhihu.com/p/58630676" target="_blank" rel="noopener"
>ç‚¹æˆ‘ã€‚&lt;/a>&lt;/p>
&lt;h2 id="5-ç³»ç»Ÿå®‰è£…">[5] ç³»ç»Ÿå®‰è£…&lt;/h2>
&lt;h3 id="5-1-bios-è®¾ç½®">[5-1] BIOS è®¾ç½®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>Advanced&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>Thunderbolt(TM) Configuration&lt;/code>
&lt;ul>
&lt;li>&lt;code>Security Level&lt;/code> è®¾ç½®æˆ &lt;code>No Security&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Chipset&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>System Agent (SA) Configuration&lt;/code>
&lt;ul>
&lt;li>&lt;code>Graphics Configuration&lt;/code>
&lt;ul>
&lt;li>&lt;code>DVMT Pre-Allocated&lt;/code> è®¾ç½®æˆ &lt;code>64&lt;/code>&lt;/li>
&lt;li>&lt;code>DVMT Total Gfx Mem&lt;/code> è®¾ç½®æˆ &lt;code>MAX&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Security&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>Secure Boot&lt;/code> è®¾ç½®æˆ &lt;code>Disabled&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Boot&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>Fast Boot&lt;/code> è®¾ç½®æˆ &lt;code>Disabled&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>CSM Configuration&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>CSM Support&lt;/code> è®¾ç½®æˆ &lt;code>Disabled&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="5-2-å®‰è£…è¿‡ç¨‹">[5-2] å®‰è£…è¿‡ç¨‹&lt;/h3>
&lt;p>ç³»ç»Ÿå®‰è£…è¿‡ç¨‹å¤§è‡´ç›¸åŒï¼Œé€‰æ‹©Uç›˜å¯åŠ¨åŽè¿›å…¥å®‰è£…ã€‚å®‰è£…è¿‡ç¨‹ä¼šé‡å¯å‡ æ¬¡ã€‚&lt;/p>
&lt;p>å¯è‡ªè¡Œæœç´¢ï¼Œå‚è€ƒå…¶ä»–äººçš„æ­¥éª¤ã€‚&lt;/p>
&lt;h3 id="5-3-å®‰è£…æ—¶å¯èƒ½å‡ºçŽ°çš„é—®é¢˜">[5-3] å®‰è£…æ—¶å¯èƒ½å‡ºçŽ°çš„é—®é¢˜&lt;/h3>
&lt;p>æ˜¾ç¤ºç¨‹åºå‰¯æœ¬å·²æŸå&lt;/p>
&lt;ul>
&lt;li>æ–­ç½‘&lt;/li>
&lt;li>æ‰“å¼€ç»ˆç«¯&lt;/li>
&lt;li>ä¿®æ”¹æ—¶é—´ä¸ºç³»ç»Ÿå‘å¸ƒå¯¹åº”çš„æ—¶é—´ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚ä¿®æ”¹ä¸º 2019å¹´ã€‚è¾“å…¥ &lt;code>date 000000002019&lt;/code>ã€‚&lt;/p>
&lt;h2 id="6-dsdtssdtåˆ¶ä½œ">[6] DSDTï¼ŒSSDTåˆ¶ä½œ&lt;/h2>
&lt;p>é€šè¿‡ä¿®è¡¥DSDTï¼ŒSSDTé©±åŠ¨è§¦æŽ§æ¿ï¼ŒéŸ³é¢‘ï¼Œç”µæ± çŠ¶æ€ï¼Œäº®åº¦æŽ§åˆ¶ç­‰ã€‚&lt;/p>
&lt;h3 id="6-1-å‡†å¤‡ä¿®è¡¥">[6-1] å‡†å¤‡ä¿®è¡¥&lt;/h3>
&lt;p>[6-1-1]&lt;/p>
&lt;p>å¼€æœºåœ¨ Clover å¼•å¯¼ç•Œé¢ä¸­æŒ‰ &lt;code>F4&lt;/code>ï¼Œæ‰€éœ€æ–‡ä»¶ä¼šåŠ è½½åˆ° &lt;code>EFI/Clover/ACPI/origin&lt;/code> ä¸­ã€‚é€šè¿‡ Clover Configurator æŒ‚è½½å¯åŠ¨çš„ EFIï¼ˆé€šè¿‡Uç›˜å¯åŠ¨å°±æŒ‚è½½Uç›˜ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-1.png"
width="1279"
height="678"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-1_hu144b08cce4e790f431926a2da7d31c39_187647_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-1_hu144b08cce4e790f431926a2da7d31c39_187647_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-1"
class="gallery-image"
data-flex-grow="188"
data-flex-basis="452px"
>&lt;/p>
&lt;p>[6-1-2]&lt;/p>
&lt;p>å°† origin æ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ¡Œé¢ï¼ŒåŒæ—¶å°† &lt;code>iasl&lt;/code> è½¯ä»¶å¤åˆ¶åˆ°æ–‡ä»¶å¤¹ä¸­ã€‚&lt;/p>
&lt;p>[6-1-3]&lt;/p>
&lt;p>æ‰“å¼€ç»ˆç«¯&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ~/Desktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir patched
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./origin/iasl -da -dl DSDT.aml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[6-1-4]&lt;/p>
&lt;p>æ‰“å¼€ originï¼Œä½¿ç”¨ &lt;code>MaciASL&lt;/code> æ‰“å¼€ç”Ÿæˆçš„ &lt;strong>DSDT.dsl&lt;/strong> æ–‡ä»¶ã€‚ç‚¹å‡» Compileï¼Œç¡®ä¿æ²¡æœ‰é”™è¯¯ã€‚ï¼ˆé»˜è®¤åº”è¯¥æ²¡æœ‰ errorï¼Œä½†æœ‰å¾ˆå¤š warningï¼Œwarning ä¸å¿…å…³ç³»ï¼Œè‹¥æœ‰ error è¯·å°† error å¤„ä»£ç æ³¨é‡Šæˆ–åˆ é™¤ï¼‰&lt;/p>
&lt;p>[6-1-5]&lt;/p>
&lt;p>ç¡®ä¿æ²¡æœ‰ errors åŽï¼Œç‚¹å‡» Patchã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-2.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-2_hu66c83b6f1d65cd60613cc338a3dbc89f_356101_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-2_hu66c83b6f1d65cd60613cc338a3dbc89f_356101_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-2"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;h3 id="6-2-ä¿®å¤ç”µæ± ">[6-2] ä¿®å¤ç”µæ± &lt;/h3>
&lt;p>[1] åœ¨å¼¹çª—çš„å·¦ä¾§ç‚¹å‡» &lt;code>_RehabMan Laptop/[bat]Razer Blade (2014)&lt;/code> ï¼Œç­‰å¾…å³ä¾§è¿›è¡ŒåŒ¹é…åŽç‚¹å‡» Applyã€‚&lt;/p>
&lt;p>å¦‚æžœç½‘ç»œä¸å¥½çš„è¯å¯èƒ½æ— æ³•åŠ è½½ï¼ˆgithubï¼‰ï¼Œè¯·åˆ‡æ¢åˆ°åˆé€‚çš„ç½‘ç»œï¼Œæˆ–è®¿é—® &lt;a class="link" href="https://github.com/RehabMan/Laptop-DSDT-Patch/blob/master/battery/battery_Razer-Blade-2014.txt" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a>ï¼Œæˆ–å¤åˆ¶ä»¥ä¸‹ä»£ç ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-3.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-3_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_432072_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-3_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_432072_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-3"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">#Maintained by: RehabMan for: Laptop Patches
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#battery_Razer-Blade-2014.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># created by sidelia 2016-01-17
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># changes for Razer Blade Stealth (Kaby Lake) by BlenderSleuth (minor fixes by RehabMan)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># works for:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Razer Blade (2014)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Razer Blade Stealth (Kaby Lake), per BlenderSleuth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Razer Blade (14&amp;#34;, late 2016)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Razer Blade Pro (2017)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Razer Blade 15 (2018), per JomanJi/blodtanner
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label B1B2 remove_entry;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into definitionblock code_regex . insert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Method (B1B2, 2, NotSerialized) { Return(Or(Arg0, ShiftLeft(Arg1, 8))) }\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BIF1,\s+16, replace_matched begin IF10,8,IF11,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BIF2,\s+16, replace_matched begin IF20,8,IF21,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BIF3,\s+16, replace_matched begin IF30,8,IF31,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BIF4,\s+16, replace_matched begin IF40,8,IF41,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BST0,\s+16, replace_matched begin ST00,8,ST01,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BST1,\s+16, replace_matched begin ST10,8,ST11,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BST2,\s+16, replace_matched begin ST20,8,ST21,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BST3,\s+16, replace_matched begin ST30,8,ST31,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \^\^EC0\.BIF1, replaceall_matched begin B1B2(^^EC0.IF10,^^EC0.IF11), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \^\^EC0\.BIF2, replaceall_matched begin B1B2(^^EC0.IF20,^^EC0.IF21), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \^\^EC0\.BIF3, replaceall_matched begin B1B2(^^EC0.IF30,^^EC0.IF31), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \^\^EC0\.BIF4, replaceall_matched begin B1B2(^^EC0.IF40,^^EC0.IF41), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BST code_regex \^\^EC0\.BST0, replaceall_matched begin B1B2(^^EC0.ST00,^^EC0.ST01), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BST code_regex \^\^EC0\.BST1, replaceall_matched begin B1B2(^^EC0.ST10,^^EC0.ST11), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BST code_regex \^\^EC0\.BST2, replaceall_matched begin B1B2(^^EC0.ST20,^^EC0.ST21), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BST code_regex \^\^EC0\.BST3, replaceall_matched begin B1B2(^^EC0.ST30,^^EC0.ST31), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># added for Razer Blade 15 (2018), per JomanJi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BIF0,\s+16, replace_matched begin IF00,8,IF01,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \(\^\^EC0.BIF0, replaceall_matched begin (B1B2(\^\^EC0.IF00,\^\^EC0.IF01), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># utility methods to read/write buffers from/to EC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label RE1B parent_label EC0 remove_entry;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label RECB parent_label EC0 remove_entry;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 insert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Method (RE1B, 1, NotSerialized)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> OperationRegion(ERAM, EmbeddedControl, Arg0, 1)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Field(ERAM, ByteAcc, NoLock, Preserve) { BYTE, 8 }\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Return(BYTE)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Method (RECB, 2, Serialized)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// Arg0 - offset in bytes from zero-based EC\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// Arg1 - size of buffer in bits\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ShiftRight(Add(Arg1,7), 3, Arg1)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name(TEMP, Buffer(Arg1) { })\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Add(Arg0, Arg1, Arg1)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Store(0, Local0)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> While (LLess(Arg0, Arg1))\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Store(RE1B(Arg0), Index(TEMP, Local0))\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Increment(Arg0)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Increment(Local0)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Return(TEMP)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># buffer fields
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex (ECCM,)\s+(256) replace_matched begin ECCX,%2,//%1%2 end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \(\^\^EC0.ECCM, replaceall_matched begin (^^EC0.RECB(0x60,256), end;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[2] ç‚¹å‡» Compileï¼Œç¡®ä¿æ²¡æœ‰é”™è¯¯ã€‚ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰ï¼Œä¸åŒç‰ˆæœ¬BIOSå¯èƒ½æƒ…å†µä¸åŒï¼‰ã€‚&lt;/p>
&lt;h3 id="6-4-ä¿®å¤é‡å¯ä¿å­˜èƒŒå…‰äº®åº¦">[6-4] ä¿®å¤é‡å¯ä¿å­˜èƒŒå…‰äº®åº¦&lt;/h3>
&lt;p>[6-4-1]&lt;/p>
&lt;p>åœ¨å·¦ä¾§èœå•æ å‘ä¸‹æ»‘åŠ¨ï¼Œæ‰¾åˆ° &lt;code>[gfx0] Disable/Enable on _WAK/_PTS (DSDT)&lt;/code>ï¼Œç‚¹å‡»éƒ½å•å‡» Applyã€‚&lt;/p>
&lt;p>ç½‘ç»œä¸å¥½å¯ç‚¹å‡» &lt;a class="link" href="https://github.com/RehabMan/Laptop-DSDT-Patch/blob/master/graphics/graphics_PTS_WAK-disable.txt" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a> æˆ–å¤åˆ¶ä»¥ä¸‹ä»£ç ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#Maintained by: RehabMan for: Laptop Patches
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#graphics_PTS_WAK-disable.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># The purpose of this patch is to add code to to _WAK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># that disables Radeon/nvidia on wake and add code
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># to _PTS that enables it on _PTS.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># The path of _OFF may have to be customized to match your SSDTs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># The patch attempts to identify the correct _REG by using
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># the ACPI PNP identifier for the EC.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Use this patch if you experience trouble shutting down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># or restarting your laptop when disabling nvida/radeon.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _PTS code_regex ([\s\S]*) replace_matched
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">External(\\_SB.PCI0.PEG0.PEGP._ON, MethodObj)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">If (CondRefOf(\\_SB.PCI0.PEG0.PEGP._ON)) { \\_SB.PCI0.PEG0.PEGP._ON() }\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _WAK code_regex (Return\s+\(.*) replace_matched
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">External(\\_SB.PCI0.PEG0.PEGP._OFF, MethodObj)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">If (CondRefOf(\\_SB.PCI0.PEG0.PEGP._OFF)) { \\_SB.PCI0.PEG0.PEGP._OFF() }\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[6-4-2] æŒ‰ command + F æœç´¢ &lt;code>Device (ALSD)&lt;/code>ï¼Œæ‰¾åˆ°å¦‚å›¾ä»£ç ï¼Œå°†å…¶æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-4.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-4_hub68a8a966914faccc2fa404696284489_152896_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-4_hub68a8a966914faccc2fa404696284489_152896_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-4"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">Device (_SB.ALS0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name (_HID, &amp;#34;ACPI0008&amp;#34;) // _HID: Hardware ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name (_CID, &amp;#34;smc-als&amp;#34;) // _STA: Status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name (_ALI, 300) // _ALI: Ambient Light Illuminance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name (_ALR, Package () // _ALR: Ambient Light Response
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Package () { 100, 300 },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-5.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-5_hub980ce45be6280fc8a0a8de2a9044e65_256600_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-5_hub980ce45be6280fc8a0a8de2a9044e65_256600_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-5"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;h3 id="6-3-ä¿®å¤è§¦æŽ§æ¿">[6-3] ä¿®å¤è§¦æŽ§æ¿&lt;/h3>
&lt;p>çµåˆƒ 15 çš„æ ‡å‡†ç‰ˆå’Œç²¾è‹±ç‰ˆä½¿ç”¨çš„è§¦æŽ§æ¿ä¸åŒï¼Œè¯·æ ¹æ®è‡ªå·±çš„ç”µè„‘è¿›è¡Œé€‰æ‹©ä¿®å¤æ–¹æ¡ˆã€‚&lt;/p>
&lt;h4 id="6-3-1-æ ‡å‡†ç‰ˆ">[6-3-1] æ ‡å‡†ç‰ˆ&lt;/h4>
&lt;p>[6-3-1-1]&lt;/p>
&lt;p>ç»§ç»­æœç´¢ &lt;code>SSCN&lt;/code>ã€‚æ‰¾åˆ° Scope ä¸º &lt;code>_SB.PCI0.I2C0&lt;/code> ä¸‹çš„ SSCN æ–¹æ³•ã€‚å¤åˆ¶ SSCN ä¸Ž FMCNï¼ˆåœ¨ SSCN ä¸‹æ–¹ï¼‰è¿™ ä¸¤ä¸ªæ–¹æ³•ã€‚å¹¶å°†è¿™ä¸¤ä¸ªæ–¹æ³•å¦‚å›¾é‡å‘½åï¼ˆä¹Ÿå¯é€‰æ‹©åˆ é™¤ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-6.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-6_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_280587_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-6_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_280587_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-6"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>é‡å‘½åä¸ºï¼š&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-7.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-7_hu3f7d5d77e0868263a4b670cd80a4de9e_282582_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-7_hu3f7d5d77e0868263a4b670cd80a4de9e_282582_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-7"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>[6-3-1-3]&lt;/p>
&lt;p>æœç´¢ TPD0ã€‚å°†ä¹‹å‰å‰ªåˆ‡çš„ä¸¤ä¸ªæ–¹æ³•æ”¾åˆ° &lt;code>_INI&lt;/code> æ–¹æ³•åŽã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-8.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-8_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_154135_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-8_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_154135_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-8"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-9.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-9_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_286656_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-9_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_286656_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-9"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>[6-3-1-4]&lt;/p>
&lt;p>å‘ä¸‹æ‰¾åˆ°å¦‚ä¸‹ä»£ç ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-10.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-10_hu23d7821cfcc16e2238565e92d2428825_290461_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-10_hu23d7821cfcc16e2238565e92d2428825_290461_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-10"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>å°†å…¶æ›´æ”¹ä¸ºå¦‚å›¾ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-11.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-11_hu1c5f5c37fa8eeab89aecaea9b074d8a6_267651_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-11_hu1c5f5c37fa8eeab89aecaea9b074d8a6_267651_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-11"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;h4 id="6-3-2-ç²¾è‹±ç‰ˆ">[6-3-2] ç²¾è‹±ç‰ˆ&lt;/h4>
&lt;p>[6-3-2-1]&lt;/p>
&lt;p>åœ¨ Patch é¡µé¢ä¸­ç²˜è´´ä»¥ä¸‹ä»£ç ä»£ç ï¼Œç‚¹å‡» Applyã€‚&lt;/p>
&lt;p>[6-3-2-2]&lt;/p>
&lt;p>ç‚¹å‡» Compile è¿›è¡Œç¼–è¯‘ç¡®å®šæ—  errorï¼ˆé»˜è®¤æ²¡æœ‰ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">into method label _STA parent_label GPI0 replace_content begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Return (0x0F)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into_all method label _CRS parent_label TPD0 replace_content begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ConcatenateResTemplate (SBFB, SBFI)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="6-4-ä¿å­˜ä¿®æ”¹å¥½çš„-dsdtaml">[6-4] ä¿å­˜ä¿®æ”¹å¥½çš„ DSDT.aml&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ç‚¹å‡» File -&amp;gt; save as ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>File Format é€‰æ‹© &lt;code>ACPI Machine Language Binary&lt;/code>ã€‚å‘½åä¸º DSDT.amlã€‚å­˜å…¥æ¡Œé¢ä¸­çš„ parched æ–‡ä»¶å¤¹ä¸­ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="6-5-å±è”½-nvdia-æ˜¾å¡">[6-5] å±è”½ Nvdia æ˜¾å¡&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>å¦‚æžœä½ é€‰æ‹©å®‰è£… High Sierra å®‰è£… WebDriver ä½¿ç”¨ Nvidia æ˜¾å¡çš„è¯ï¼Œä¸ç”¨è¯¥è¡¥ä¸&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;p>[ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹æ”¯æŒé©±åŠ¨çš„ High Sierra ](&lt;a class="link" href="https://www.tonymacx86.com/nvidia-drivers/" target="_blank" rel="noopener"
>https&lt;/a> : &lt;a class="link" href="https://www.tonymacx86.com/nvidia-drivers/" target="_blank" rel="noopener"
>//www.tonymacx86.com/nvidia-drivers/&lt;/a>)&lt;/p>
&lt;ul>
&lt;li>&lt;strong>åœ¨çš„ç¬”è®°æœ¬ä¸Šä½¿ç”¨è¯¥è¡¥ä¸ä¼šå¯¼è‡´ type-c è½¬è§†é¢‘æŽ¥å£æ— ä¿¡å·ï¼Œæ— æ³•æ‹“å±•æ˜¾ç¤ºå™¨ï¼Œè‹¥å‡ºçŽ°ç›¸åŒæƒ…å†µè¯·åˆ é™¤è¯¥è¡¥ä¸ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>[6-5-1]&lt;/p>
&lt;p>å†æ¬¡è¿›å…¥ origin æ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨ç»ˆç«¯è¾“å…¥&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">./origin/iasl -da -dl SSDT-12-OptTabl.aml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[6-5-2]&lt;/p>
&lt;p>æ ¹æ®ä¸Šæ–¹ä¿®è¡¥ç”µæ± çŠ¶æ€ï¼Œè§¦æŽ§æ¿çš„æ–¹å¼ç±»ä¼¼ï¼Œä½¿ç”¨ MaciASL æ‰“å¼€ &lt;strong>SSDT-12-OptTabl.dsl&lt;/strong>&lt;/p>
&lt;p>[6-5-3]&lt;/p>
&lt;p>æŒ‰ command + F æœç´¢ä»¥ä¸‹ä»£ç &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">Method (_OFF, 0, Serialized) // _OFF: Power Off
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-12.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-12_hu2676900d025708aa224f75aaa3467a9c_159091_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-12_hu2676900d025708aa224f75aaa3467a9c_159091_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-12"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>[6-5-4]&lt;/p>
&lt;p>åœ¨è¯¥ä»£ç ä¸Šæ–¹ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">Method (_INI) {_OFF() } // added to call _OFF
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[6-5-5]&lt;/p>
&lt;p>ç‚¹å‡» patchï¼Œå°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ°å¼¹çª—ä¸­ï¼Œç‚¹å‡» applyã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">into method label _INI parent_label \_SB.PCI0.GFX0 insert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//added to turn nvidia/radeon off\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">External(\_SB.PCI0.PEG0.PEGP._OFF, MethodObj)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[6-5-6]&lt;/p>
&lt;p>ç‚¹å‡»ç¼–è¯‘ï¼Œå‡ºçŽ°ä¸€ä¸ªé”™è¯¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-13.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-13_hua74e3ca4eeedf7cfd113fba4cc112dcf_385932_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-13_hua74e3ca4eeedf7cfd113fba4cc112dcf_385932_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-13"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>[6-5-7]&lt;/p>
&lt;p>æœç´¢ä¸€ä¸‹ä»£ç ï¼Œå¹¶å°†å…¶åˆ é™¤ï¼Œå†æ¬¡ç¼–è¯‘ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">External &lt;span class="o">(&lt;/span>_SB_.PCI0.PEG0.TGPC, IntObj&lt;span class="o">)&lt;/span> // &lt;span class="o">(&lt;/span>from opcode&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-14.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-14_huc397bebb9da1198e3070ace5d1200979_429156_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-14_huc397bebb9da1198e3070ace5d1200979_429156_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-10"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>[6-5-8]&lt;/p>
&lt;p>ç‚¹å‡» File -&amp;gt; Save Asã€‚å°†æœ€ç»ˆçš„ /aml æ–‡ä»¶ä¿å­˜ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-15.png"
width="1025"
height="725"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-15_huc397bebb9da1198e3070ace5d1200979_427498_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-15_huc397bebb9da1198e3070ace5d1200979_427498_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-11"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;h3 id="6-6-åˆ¶ä½œ-ssdt-usbxaml">[6-6] åˆ¶ä½œ SSDT-USBX.aml&lt;/h3>
&lt;p>å¦‚æžœæƒ³åˆ¶ä½œè‡ªå·±çš„ SSDT-USBX.amlã€‚è¯·å‚è€ƒ &lt;a class="link" href="https://github.com/stonevil/Razer_Blade_Advanced_early_2019_Hackintosh#usb-mapping" target="_blank" rel="noopener"
>ç‚¹æˆ‘ã€‚&lt;/a>&lt;/p>
&lt;p>ä½¿ç”¨ USBMapã€‚&lt;a class="link" href="https://github.com/corpnewt/USBMap" target="_blank" rel="noopener"
>ç‚¹æˆ‘&lt;/a>&lt;/p>
&lt;h3 id="6-7-å¤åˆ¶æä¾›çš„çš„-aml-æ–‡ä»¶">[6-7] å¤åˆ¶æä¾›çš„çš„ .aml æ–‡ä»¶&lt;/h3>
&lt;p>å°†æ–‡ä»¶å¤¹ä¸­çš„ SSDT-PNLF.amlï¼ŒSSDT-UIAC-ALL.amlï¼ŒSSDT-USBX.amlï¼ŒSSDT-XOSI.aml åŒä¸Šé¢ä¿®è¡¥çš„ä¸¤ä¸ªæ–‡ä»¶ä¸€åŒæ”¾å…¥ patched æ–‡ä»¶å¤¹ä¸­ï¼Œæœ€åŽ patched æ–‡ä»¶å¤¹ä¸­åº”è¯¥æœ‰å¦‚ä¸‹6ä¸ªæ–‡ä»¶ã€‚&lt;/p>
&lt;p>&lt;strong>å¦‚æžœ type-c è½¬è§†é¢‘æŽ¥å£æ— ä¿¡å·ï¼Œè¯·åˆ é™¤SSDT-12-OptTabl.aml&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/6-16.png"
width="618"
height="293"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/6-16_hu06ceecd71981737f4621cc2ff5d5371e_32019_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/6-16_hu06ceecd71981737f4621cc2ff5d5371e_32019_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-16"
class="gallery-image"
data-flex-grow="210"
data-flex-basis="506px"
>&lt;/p>
&lt;h2 id="7-ç½‘å¡">[7] ç½‘å¡&lt;/h2>
&lt;h3 id="7-1-æ›´æ¢åšé€šç½‘å¡">[7-1] æ›´æ¢åšé€šç½‘å¡&lt;/h3>
&lt;p>åœ¨ç½‘ä¸Šæ‰¾è¿‡æ‹†æœºå›¾ï¼Œç½‘å¡é™„è¿‘çš„ä½ç½®è¿˜æ˜¯æŒºå¤šçš„ï¼Œæˆ‘çš„é€‰æ‹©æ˜¯æ‹†æœºçš„ &lt;code>BCM94360cs2&lt;/code> + è½¬æŽ¥å¡ï¼Œå¯ç›´æŽ¥å…é©±ä½¿ç”¨ã€‚&lt;/p>
&lt;p>ç›¸æ¯”ä½¿ç”¨åŽŸè£…çš„ç½‘å¡ä½ç½®ç¨æœ‰ç‚¹é«˜ï¼ŒåŽ‹åœ¨ä¸€æ ¹çš„æŽ’çº¿ä¸Šï¼Œä½†æ˜¯ä¸å½±å“ï¼Œå¦‚é€‰æ‹©åŒæ¬¾ç½‘å¡ï¼Œè¯·æ³¨æ„ç»ç¼˜ï¼Œå»ºè®®ä¸Šèžºä¸çš„æ—¶å€™ä¸è¦æ‹§å¤ªç´§ï¼Œä¸æ¾åŠ¨å³å¯ã€‚è£…ä¸Šä¹‹åŽçš„æ•ˆæžœå¦‚å›¾ã€‚&lt;/p>
&lt;p>**å°æç¤º: **æ‹§èžºä¸å‰æœ€å¥½æŠŠæ˜“ç¢Žè´´ç»™æ¸…ç†å¹²å‡€ã€‚è¿™ä¸ªè´´çº¸åˆ†é‡å¤ªè¶³ï¼Œå¡åœ¨èžºä¸å­”ä¸­å¯¼è‡´ä¸€ç›´æ»‘ä¸ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/7-1.png"
width="574"
height="668"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/7-1_hu1161da1d8dba47d941a13aa6ae79cf52_787645_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/7-1_hu1161da1d8dba47d941a13aa6ae79cf52_787645_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="7-1"
class="gallery-image"
data-flex-grow="85"
data-flex-basis="206px"
>&lt;/p>
&lt;p>**ä½¿ç”¨æ•ˆæžœ: **2.4G WIFI å’Œ è“ç‰™æœ‰å¹²æ‰°ï¼Œå°¤å…¶æ˜¯ 2.4G WIFI ä½¿ç”¨å¸¦å®½é«˜çš„æ—¶å€™ï¼Œè“ç‰™å‡ ä¹Žä¸èƒ½ç”¨ã€‚å…¶ä»–ä½¿ç”¨åœºæ™¯åŸºæœ¬è‰¯å¥½ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æƒ³æŠ˜è…¾çš„è¯å¯é€‰æ‹© &lt;code>DW1820A&lt;/code>ï¼Œå¯å‚è€ƒ &lt;a class="link" href="https://blog.daliansky.net/DW1820A_BCM94350ZAE-driver-inserts-the-correct-posture.html" target="_blank" rel="noopener"
>è¿™é‡Œã€‚&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åšé€š &lt;code>BCM94352Z&lt;/code> ï¼ŒçŽ°åœ¨ä»·é’±è¢«ç‚’çš„å¾ˆé«˜ï¼Œç›®å‰å°†è¿‘ 300ï¼Œæœ‰é’±éšæ„ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="7-2-ä½¿ç”¨è‡ªå¸¦ç½‘å¡">[7-2] ä½¿ç”¨è‡ªå¸¦ç½‘å¡&lt;/h3>
&lt;p>Intel è“ç‰™é»˜è®¤å…é©±ï¼ŒWiFi ç›®å‰æ— è§£ã€‚&lt;/p>
&lt;p>è“ç‰™ä»Ž windows é‡å¯è¿›å…¥ macOS å¯ä½¿ç”¨ï¼ˆç½‘å¡æœªæ–­ç”µæ‰€ä»¥ä¸Šä¼ äº†é©±åŠ¨ï¼‰ã€‚&lt;/p>
&lt;p>å°† &lt;a class="link" href="https://github.com/zxystd/IntelBluetoothFirmware/releases" target="_blank" rel="noopener"
>è¯¥é©±åŠ¨&lt;/a> æ”¾å…¥ EFI/CLOVER/kextsï¼Œå¯ä»¥å®žçŽ°å†·å¯åŠ¨é©±åŠ¨è‡ªå¸¦ç½‘å¡è“ç‰™ã€‚&lt;/p>
&lt;p>**ä½¿ç”¨æ•ˆæžœ: **è“ç‰™é”®ç›˜ï¼Œè“ç‰™éŸ³ç®±æ²¡æœ‰é—®é¢˜ï¼Œè“ç‰™é¼ æ ‡è²Œä¼¼ä¸èƒ½ç”¨ã€‚&lt;/p>
&lt;h3 id="7-3-ä½¿ç”¨usbç½‘å¡">[7-3] ä½¿ç”¨USBç½‘å¡&lt;/h3>
&lt;p>usb ç½‘å¡é©±åŠ¨å®‰è£…ã€‚&lt;a class="link" href="https://github.com/chris1111/Wireless-USB-Adapter-Clover/releases" target="_blank" rel="noopener"
>ç‚¹æˆ‘ã€‚&lt;/a>&lt;/p>
&lt;ul>
&lt;li>COMFAST CF-WU815N 150M å•é¢‘&lt;/li>
&lt;li>COMFAST CF-811AC 650M åŒé¢‘&lt;/li>
&lt;li>COMFAST CF-812AC 1300M åŒé¢‘&lt;/li>
&lt;li>æ›´å¤šå…¶ä»–åž‹å·è‡ªè¡Œæœç´¢&lt;/li>
&lt;/ul>
&lt;h2 id="8-ä¸€äº›ä¼˜åŒ–">[8] ä¸€äº›ä¼˜åŒ–&lt;/h2>
&lt;h3 id="8-1-hidpi">[8-1] HIDPI&lt;/h3>
&lt;p>å¼€å¯ HIDPI åŽå¯èƒ½ä¼šå¯¼è‡´å¼€æœºç¬¬äºŒé˜¶æ®µ Logo å˜å¤§ï¼Œå› ä¸ºåˆ†è¾¨çŽ‡æ˜¯ä»¿å†’çš„ï¼Œä¸å½±å“ä½¿ç”¨ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ç»ˆç«¯æ‰§è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">sh -c &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>curl -fsSL https://raw.githubusercontent.com/xzhih/one-key-hidpi/master/hidpi.sh&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>é€‰æ‹© &amp;ldquo;å¼€å¯ HIDPI&amp;rdquo;&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ˜¾ç¤ºçš„ ICON é€‰æ‹© Macbook Proï¼ˆåœ¨è®¾ç½®ç•Œé¢æ˜¾ç¤ºçš„æ ·å¼ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€‰æ‹©åˆ†è¾¨çŽ‡é…ç½® 1080P æ˜¾ç¤ºå™¨ï¼ˆæ ¹æ®è‡ªèº«æƒ…å†µé€‰æ‹©ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šè¯¦ç»†æƒ…å†µå¯å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚&lt;a class="link" href="https://www.sqlsec.com/2018/09/hidpi.html" target="_blank" rel="noopener"
>ç‚¹æˆ‘ã€‚&lt;/a>&lt;/p>
&lt;h3 id="8-2-æ‰“å¼€-trim">[8-2] æ‰“å¼€ TRIM&lt;/h3>
&lt;p>å¦‚æžœä½¿ç”¨ SSDï¼Œä¸€å®šè¦æ‰“å¼€ TRIMï¼Œé˜²æ­¢ç³»ç»Ÿå¤šæ¬¡æ“¦å†™ï¼Œç¡®ä¿ç¡¬ç›˜å¯¿å‘½ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">sudo trimforce &lt;span class="nb">enable&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®ŒæˆåŽç³»ç»Ÿä¼šè¿›è¡Œä¸€æ¬¡é‡å¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/8-1.png"
width="597"
height="392"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/8-1_hu7ef8c94d672dd32ca37ffb306a046a5c_44030_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/8-1_hu7ef8c94d672dd32ca37ffb306a046a5c_44030_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="8-1"
class="gallery-image"
data-flex-grow="152"
data-flex-basis="365px"
>&lt;/p>
&lt;h3 id="8-3-ç¦ç”¨ç¡çœ ">[8-3] ç¦ç”¨ç¡çœ &lt;/h3>
&lt;p>åœ¨ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶åœ¨ è®¾ç½® -&amp;gt; èŠ‚èƒ½ ä¸­å…³é—­ç›¸åº”è®¾ç½®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">sudo pmset -a hibernatemode &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm /var/vm/sleepimage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo mkdir /var/vm/sleepimage
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/8-2.png"
width="668"
height="447"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/8-2_hud42e2df37bc11de06acd6253c0889518_56255_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/8-2_hud42e2df37bc11de06acd6253c0889518_56255_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="8-2"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="358px"
>&lt;/p>
&lt;p>&lt;img src="https://www.letout.cn/p/razer-blade-base-hackintosh/8-3.png"
width="668"
height="447"
srcset="https://www.letout.cn/p/razer-blade-base-hackintosh/8-3_hu811770682d9683eef53048df303f786e_59426_480x0_resize_box_3.png 480w, https://www.letout.cn/p/razer-blade-base-hackintosh/8-3_hu811770682d9683eef53048df303f786e_59426_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="8-3"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="358px"
>&lt;/p>
&lt;h3 id="8-4-æ´—ç™½åºåˆ—å·">[8-4] â€œæ´—ç™½â€åºåˆ—å·&lt;/h3>
&lt;p>ç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œè‡ªè¡Œæœä¸€ä¸‹ã€‚&lt;/p>
&lt;h1 id="å‚è€ƒ">å‚è€ƒ&lt;/h1>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/stonevil/Razer_Blade_Advanced_early_2019_Hackintosh" target="_blank" rel="noopener"
>https://github.com/stonevil/Razer_Blade_Advanced_early_2019_Hackintosh&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.tonymacx86.com/threads/guide-razer-blade-15-2018-detailed-install-guide-high-sierra-10-13-6-17g2208-17g5019.264017/" target="_blank" rel="noopener"
>https://www.tonymacx86.com/threads/guide-razer-blade-15-2018-detailed-install-guide-high-sierra-10-13-6-17g2208-17g5019.264017/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.daliansky.net/" target="_blank" rel="noopener"
>https://blog.daliansky.net/&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>