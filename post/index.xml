<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on ä¸€å±‚</title><link>https://emerywan.github.io/blog/post/</link><description>Recent content in Posts on ä¸€å±‚</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Sat, 06 Aug 2022 16:02:02 +0800</lastBuildDate><atom:link href="https://emerywan.github.io/blog/post/index.xml" rel="self" type="application/rss+xml"/><item><title>ç±»åŠ è½½å™¨</title><link>https://emerywan.github.io/blog/p/java/jvm/classloader/</link><pubDate>Sat, 06 Aug 2022 16:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/java/jvm/classloader/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/25.jpeg" alt="Featured image of post ç±»åŠ è½½å™¨" />&lt;h2 id="ç±»åŠ è½½å™¨">ç±»åŠ è½½å™¨&lt;/h2>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/java/jvm/classloader/menu.png"
width="1707"
height="638"
srcset="https://emerywan.github.io/blog/blog/p/java/jvm/classloader/menu_hu8b8ca38d973bcbde05d207eb8795320e_321907_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/java/jvm/classloader/menu_hu8b8ca38d973bcbde05d207eb8795320e_321907_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="menu"
class="gallery-image"
data-flex-grow="267"
data-flex-basis="642px"
>&lt;/p>
&lt;h3 id="bootstrapclassloader">BootstrapClassLoader&lt;/h3>
&lt;p>å¯åŠ¨ç±»åŠ è½½å™¨&lt;/p>
&lt;p>æœ€é¡¶å±‚çš„åŠ è½½ç±»ï¼Œç”± C++ å®žçŽ°ï¼Œè´Ÿè´£åŠ è½½ &lt;code>%JAVA_HOME%/lib&lt;/code> ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»æˆ–è€…è¢« &lt;code>-Xbootclasspath&lt;/code> å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»ã€‚&lt;/p>
&lt;h3 id="extensionclassloader">ExtensionClassLoader&lt;/h3>
&lt;p>æ‰©å±•ç±»åŠ è½½å™¨ã€‚Java ç³»ç»Ÿç±»åº“çš„æ‰©å±•æœºåˆ¶ã€‚&lt;/p>
&lt;p>è´Ÿè´£åŠ è½½ &lt;code>%JRE_HOME%/lib/ext&lt;/code> ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»ï¼Œæˆ–è¢« &lt;code>java.ext.dirs&lt;/code> ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„ jar åŒ…ã€‚&lt;/p>
&lt;h3 id="applicationclassloader">ApplicationClassLoader&lt;/h3>
&lt;p>é¢å‘ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½å½“å‰åº”ç”¨ &lt;code>classpath&lt;/code> ä¸‹çš„æ‰€æœ‰ jar åŒ…å’Œç±»ã€‚&lt;/p>
&lt;h2 id="åŒäº²å§”æ´¾æ¨¡åž‹">åŒäº²å§”æ´¾æ¨¡åž‹&lt;/h2>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/java/jvm/classloader/classloader.png"
width="1279"
height="699"
srcset="https://emerywan.github.io/blog/blog/p/java/jvm/classloader/classloader_hu2885d6b96687a867396da9eda76d4bf0_289144_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/java/jvm/classloader/classloader_hu2885d6b96687a867396da9eda76d4bf0_289144_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="classloader"
class="gallery-image"
data-flex-grow="182"
data-flex-basis="439px"
>&lt;/p>
&lt;p>æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼Œç”¨ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº†åŒä¸€ä¸ªé™å®šåçš„ç±»ï¼ŒJVM ä¹Ÿä¼šè®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protected&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">loadClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">resolve&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">ClassNotFoundException&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">getClassLoadingLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// (1) åˆ¤æ–­æ˜¯å¦åŠ è½½è¿‡è¯¥ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findLoadedClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">long&lt;/span> &lt;span class="n">t0&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">nanoTime&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">parent&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parent&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">loadClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// (2) parent == null çº¦å®šä¸ºï¼šparnet ä¸º Bootstracp ClassLoader
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findBootstrapClassOrNull&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ClassNotFoundException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ClassNotFoundException thrown if class not found
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// from the non-null parent class loader
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// (3) è¯´æ˜Ž parent åŠ è½½ä¸äº†ï¼Œå½“å‰ loader å°è¯•åŠ è½½ class
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">t1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">nanoTime&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// this is the defining class loader; record the stats
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">sun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">misc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PerfCounter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getParentDelegationTime&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">addTime&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">t0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">misc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PerfCounter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getFindClassTime&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">addElapsedTimeFrom&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">misc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PerfCounter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getFindClasses&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">increment&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">resolve&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resolveClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé™å®šåçš„ç±»åªä¼šè¢«ä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½å¹¶è§£æžä½¿ç”¨ï¼Œåœ¨ç¨‹åºä¸­æ˜¯å”¯ä¸€çš„ï¼Œä¸ä¼šäº§ç”Ÿæ­§ä¹‰ã€‚&lt;/p>
&lt;p>åœ¨åŠ è½½æ—¶ï¼Œé¦–å…ˆä¼šåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ï¼Œå¦‚æžœå·²ç»åŠ è½½ï¼Œä¼šç›´æŽ¥è¿”å›žï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ã€‚&lt;/p>
&lt;p>å°è¯•åŠ è½½æ—¶ï¼Œä¸ä¼šè‡ªå·±è¿›è¡ŒåŠ è½½ï¼Œè€Œæ˜¯å°†è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œå½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œæ‰ä¼šç”±è‡ªå·±å¤„ç†ã€‚&lt;/p></description></item><item><title>ç±»åŠ è½½æœºåˆ¶</title><link>https://emerywan.github.io/blog/p/java/jvm/class-loading/</link><pubDate>Sat, 06 Aug 2022 13:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/java/jvm/class-loading/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/24.jpeg" alt="Featured image of post ç±»åŠ è½½æœºåˆ¶" />&lt;h2 id="java-ç±»ç”Ÿå‘½å‘¨æœŸ">Java ç±»ç”Ÿå‘½å‘¨æœŸ&lt;/h2>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/life.png"
width="973"
height="331"
srcset="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/life_hue0715323a61c74c3a1d0de4b0a99146c_113100_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/life_hue0715323a61c74c3a1d0de4b0a99146c_113100_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="java-class-life"
class="gallery-image"
data-flex-grow="293"
data-flex-basis="705px"
>&lt;/p>
&lt;h2 id="ç±»åŠ è½½è¿‡ç¨‹">ç±»åŠ è½½è¿‡ç¨‹&lt;/h2>
&lt;p>ç±»åŠ è½½ä¸»è¦æœ‰ä¸‰æ­¥ï¼š&lt;code>åŠ è½½ - é“¾æŽ¥ - åˆå§‹åŒ–&lt;/code>ã€‚&lt;/p>
&lt;h3 id="-åŠ è½½">ðŸ¥Ž åŠ è½½&lt;/h3>
&lt;p>åŠ è½½æ˜¯ä¸€ä¸ªè¯»å– Class æ–‡ä»¶ï¼Œå°†å…¶è½¬åŒ–ä¸ºæŸç§é™æ€æ•°æ®ç»“æž„å­˜å‚¨åœ¨æ–¹æ³•åŒºå†…ï¼Œå¹¶åœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªä¾¿äºŽè°ƒç”¨çš„ java.lang.Class ç±»åž‹çš„å¯¹è±¡çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/loading.png"
width="707"
height="335"
srcset="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/loading_hu8b469e8111e2814cd40ca0f04de26462_22328_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/loading_hu8b469e8111e2814cd40ca0f04de26462_22328_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="loading"
class="gallery-image"
data-flex-grow="211"
data-flex-basis="506px"
>&lt;/p>
&lt;p>åˆ†ä¸ºä¸‰æ­¥è¿›è¡Œï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>èŽ·å–å®šä¹‰ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼ˆä¸é™åˆ¶ä»Žå“ªé‡ŒèŽ·å–ï¼Œæ–‡ä»¶ã€ç½‘ç»œã€å³æ—¶ç”Ÿæˆï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°†å­—èŠ‚æµä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æž„ï¼Œè½¬æ¢æˆæ–¹æ³•åŒºä¸­è¿è¡Œæ—¶æ•°æ®ç»“æž„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ java.lang.Class å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®è®¿é—®å…¥å£&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-é“¾æŽ¥">ðŸ¥Ž é“¾æŽ¥&lt;/h3>
&lt;h4 id="-éªŒè¯">âš¾ï¸ éªŒè¯&lt;/h4>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/verify.png"
width="915"
height="390"
srcset="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/verify_hu8c1a3959f1e343b5f02da51e1aaf01f3_138925_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/verify_hu8c1a3959f1e343b5f02da51e1aaf01f3_138925_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="verify"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="563px"
>&lt;/p>
&lt;ul>
&lt;li>æ–‡ä»¶æ ¼å¼éªŒè¯&lt;/li>
&lt;/ul>
&lt;p>éªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆ Class æ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œèƒ½è¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ã€‚&lt;/p>
&lt;ul>
&lt;li>å…ƒæ•°æ®ã€å­—èŠ‚ç éªŒè¯&lt;/li>
&lt;/ul>
&lt;p>å¯¹å­—èŠ‚ç è¿›è¡Œè¯­æ³•ã€è¯­ä¹‰çš„åˆ†æžï¼Œä¿è¯å…¶ç¬¦åˆ Java è™šæ‹Ÿæœºçš„è§„èŒƒï¼Œä¸ä¼šæœ‰å±å®³è™šæ‹Ÿæœºçš„è¡Œä¸ºã€‚&lt;/p>
&lt;ul>
&lt;li>ç¬¦å·å¼•ç”¨éªŒè¯&lt;/li>
&lt;/ul>
&lt;p>ç¡®ä¿è§£æžè¡Œä¸ºèƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚&lt;strong>å‘ç”Ÿåœ¨è§£æžé˜¶æ®µã€‚&lt;/strong>&lt;/p>
&lt;h4 id="-å‡†å¤‡">âš¾ï¸ å‡†å¤‡&lt;/h4>
&lt;p>ä¸ºç±»ä¸­å®šä¹‰çš„å˜é‡ï¼ˆé™æ€å˜é‡ &lt;code>static&lt;/code>ï¼‰åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/prepare.png"
width="482"
height="260"
srcset="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/prepare_hu58a397643ad84aca2032de9a3ac6155c_29464_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/prepare_hu58a397643ad84aca2032de9a3ac6155c_29464_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="prepare"
class="gallery-image"
data-flex-grow="185"
data-flex-basis="444px"
>&lt;/p>
&lt;ul>
&lt;li>&lt;code>static&lt;/code> -&amp;gt; èµ‹é›¶å€¼&lt;/li>
&lt;li>&lt;code>static final&lt;/code> -&amp;gt; èµ‹å®šä¹‰çš„å¸¸é‡å€¼&lt;/li>
&lt;/ul>
&lt;h4 id="-è§£æž">âš¾ï¸ è§£æž&lt;/h4>
&lt;p>è§£æžæ˜¯å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æŽ¥å¼•ç”¨ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¬¦å·å¼•ç”¨ï¼šæè¿°å¼•ç”¨å¯¹è±¡çš„ç¬¦å·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç›´æŽ¥å¼•ç”¨ï¼šæŒ‡å‘ç›®æ ‡å®žé™…åœ°å€çš„æŒ‡é’ˆ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ðŸŽ¾ è§£æžéƒ¨åˆ†æ˜¯çµæ´»çš„ï¼Œå¯ä»¥åœ¨åˆå§‹åŒ–çŽ¯èŠ‚åŽå†è¿›è¡Œï¼Œå®žçŽ°æ‰€è°“çš„â€œåŽæœŸç»‘å®šâ€ã€‚ï¼ˆæ–¹æ³•è°ƒç”¨ç›´åˆ°è¿è¡Œæ—¶æ‰ä¼šè§£æžï¼Œå› ä¸ºæ— æ³•åœ¨ç¼–è¯‘æ—¶ç¡®å®šæ–¹æ³•è°ƒç”¨æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ‰€ä»¥æ–¹æ³•å®šä¹‰å’Œæ–¹æ³•è°ƒç”¨ç›´åˆ°è¿è¡Œæ—¶æ‰ç»‘å®šã€‚ï¼‰&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/resolve_1.png"
width="163"
height="370"
srcset="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/resolve_1_hua9ef48196efa3564a4ef1eaa93606c3a_10102_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/resolve_1_hua9ef48196efa3564a4ef1eaa93606c3a_10102_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="resolve"
class="gallery-image"
data-flex-grow="44"
data-flex-basis="105px"
>&lt;/p>
&lt;p>å½“ä¸€ä¸ªç±»è¢«ç¼–è¯‘æˆ Class ä¹‹åŽï¼Œå‡è®¾è¿™ä¸ªç±»ç§°ä¸º &lt;code>A&lt;/code>ï¼Œå¹¶ä¸”åœ¨ &lt;code>A&lt;/code> ä¸­å¼•ç”¨äº†ç±» &lt;code>B&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åœ¨ç¼–è¯‘é˜¶æ®µï¼Œ&lt;code>A&lt;/code> æ— æ³•ç¡®å®š &lt;code>B&lt;/code> æ˜¯å¦è¢«ç¼–è¯‘ï¼ˆçŽ°åœ¨ &lt;code>B&lt;/code> ä¸€å®šæœªåŠ è½½ï¼‰ï¼Œæ­¤æ—¶ &lt;code>A&lt;/code> æ— æ³•çŸ¥é“ &lt;code>B&lt;/code> çš„å®žé™…åœ°å€ï¼Œæ‰€æœ‰åœ¨ &lt;code>A.Class&lt;/code> ä¸­ï¼Œä¼šä½¿ç”¨ä¸€ä¸ª&lt;code>å­—ç¬¦ä¸²&lt;/code>ä»£è¡¨ &lt;code>B&lt;/code>ã€‚è¿™ä¸ªå­—ç¬¦ä¸²è¢«ç§°ä¸º&lt;strong>ç¬¦å·å¼•ç”¨&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨è¿è¡Œé˜¶æ®µï¼Œ&lt;code>A&lt;/code> å‘ç”Ÿäº†åŠ è½½ï¼Œåœ¨è§£æžæ—¶ï¼Œå‘çŽ°å…¶ä¸­çš„ &lt;code>B&lt;/code> è¿˜æœªè¢«åŠ è½½ï¼Œå°±ä¼šè§¦å‘ç±» &lt;code>B&lt;/code> çš„åŠ è½½ï¼Œå°† &lt;code>B&lt;/code> åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­ã€‚æ­¤æ—¶ï¼Œ&lt;code>A&lt;/code> ä¸­çš„ç¬¦å·å¼•ç”¨ä¼šè¢«æ›¿æ¢ä¸º &lt;code>B&lt;/code> ä¸­çš„å®žé™…åœ°å€ï¼ˆç›´æŽ¥å¼•ç”¨ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/resolve.png"
width="922"
height="538"
srcset="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/resolve_hu45e5622ef4d0eaddcde37871cfee2a7a_117190_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/resolve_hu45e5622ef4d0eaddcde37871cfee2a7a_117190_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="resolve"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="411px"
>&lt;/p>
&lt;ul>
&lt;li>é™æ€è§£æž&lt;/li>
&lt;/ul>
&lt;p>ç±» &lt;code>B&lt;/code> æ˜¯å…·ä½“çš„å®žçŽ°ç±»ï¼Œè§£æžçš„å¯¹è±¡ååˆ†æ˜Žç¡®ï¼Œå³ä¼šè¿›è¡Œé™æ€è§£æžã€‚&lt;/p>
&lt;ul>
&lt;li>åŠ¨æ€è§£æž&lt;/li>
&lt;/ul>
&lt;p>Java é€šè¿‡åŽæœŸç»‘å®šçš„æ–¹å¼å®žçŽ°å¤šæ€ï¼Œé€šè¿‡åŠ¨æ€è§£æžå®žçŽ°ã€‚&lt;/p>
&lt;p>å¦‚æžœç±» &lt;code>B&lt;/code> æ˜¯æŠ½è±¡ç±»æˆ–è€…æŽ¥å£ï¼Œæœ‰å…·ä½“çš„å®žçŽ°ç±» &lt;code>C&lt;/code>ã€&lt;code>D&lt;/code>ï¼Œå½“å‰å…·ä½“çš„å®žçŽ°æ–¹å¼å¹¶ä¸æ˜Žç¡®ï¼Œæ— æ³•ç¡®å®šä½¿ç”¨å“ªä¸ªå…·ä½“å®žçŽ°ã€‚&lt;/p>
&lt;p>ç›´åˆ°è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†è°ƒç”¨ï¼Œè™šæ‹Ÿæœºè°ƒç”¨æ ˆä¸­ä¼šå¾—åˆ°å…·ä½“ç±»çš„ä¿¡æ¯ï¼Œå†è¿›è¡Œè§£æžï¼Œå°±æœ‰æ˜Žç¡®çš„ç›´æŽ¥å¼•ç”¨ä»£æ›¿ç¬¦å·å¼•ç”¨ã€‚&lt;/p>
&lt;h3 id="-åˆå§‹åŒ–">ðŸ¥Ž åˆå§‹åŒ–&lt;/h3>
&lt;p>è™šæ‹ŸæœºçœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­ç¼–å†™çš„ä»£ç ï¼Œå®Œæˆä¸€äº›ä¸»åŠ¨çš„èµ„æºåˆå§‹åŒ–åŠ¨ä½œã€‚&lt;/p>
&lt;p>&lt;strong>æ‰§è¡Œçš„æ˜¯ç±»å±‚é¢çš„åˆå§‹åŒ–ã€‚&lt;/strong> åªæœ‰æ˜¾å¼è°ƒç”¨ new æ‰ä¼šæ‰§è¡Œæž„é€ å‡½æ•°çš„åˆå§‹åŒ–ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/init.png"
width="533"
height="388"
srcset="https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/init_hud5162327100fcc16da85dffebeccc0e0_46268_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/java/jvm/class-loading/init_hud5162327100fcc16da85dffebeccc0e0_46268_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="init"
class="gallery-image"
data-flex-grow="137"
data-flex-basis="329px"
>&lt;/p>
&lt;ul>
&lt;li>æˆå‘˜å˜é‡çš„èµ‹å€¼&lt;/li>
&lt;li>é™æ€å˜é‡çš„èµ‹å€¼&lt;/li>
&lt;li>é™æ€ä»£ç å—&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://javaguide.cn/java/jvm/class-loading-process.html" target="_blank" rel="noopener"
>https://javaguide.cn/java/jvm/class-loading-process.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.bilibili.com/video/BV14U4y1L75q/?spm_id_from=333.788" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV14U4y1L75q/?spm_id_from=333.788&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>MySQL å­˜å‚¨å¼•æ“Ž</title><link>https://emerywan.github.io/blog/p/mysql/innodb/</link><pubDate>Sun, 31 Jul 2022 13:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/mysql/innodb/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/23.jpeg" alt="Featured image of post MySQL å­˜å‚¨å¼•æ“Ž" />&lt;h2 id="äº‹åŠ¡">äº‹åŠ¡&lt;/h2>
&lt;p>äº‹åŠ¡æ˜¯ä¸€ç»„é€»è¾‘ä¸Šçš„æ•°æ®åº“æ“ä½œï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚&lt;/p>
&lt;h3 id="ç‰¹æ€§">ç‰¹æ€§&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>åŽŸå­æ€§ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸€è‡´æ€§ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éš”ç¦»æ€§ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹çŽ¯å¢ƒä¸‹è¿è¡Œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŒä¹…æ€§ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›žæ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/innodb/1.png"
width="869"
height="333"
srcset="https://emerywan.github.io/blog/blog/p/mysql/innodb/1_hu3fd49fc1a58d123f3498503f7ff7204f_68265_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/innodb/1_hu3fd49fc1a58d123f3498503f7ff7204f_68265_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="260"
data-flex-basis="626px"
>&lt;/p>
&lt;h2 id="redo-log">redo log&lt;/h2>
&lt;p>é‡åšæ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œæŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ã€‚å±žäºŽç‰©ç†æ—¥å¿—ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/innodb/redolog.png"
width="889"
height="359"
srcset="https://emerywan.github.io/blog/blog/p/mysql/innodb/redolog_huec6805565d40a88bf7c70b51e3ee84c7_38212_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/innodb/redolog_huec6805565d40a88bf7c70b51e3ee84c7_38212_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="redolog"
class="gallery-image"
data-flex-grow="247"
data-flex-basis="594px"
>&lt;/p>
&lt;p>redo log ç”¨æ¥ä¿éšœæ•°æ®åº“çš„æŒä¹…æ€§ã€‚&lt;/p>
&lt;p>åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ‰§è¡Œå¤šä¸ªå¢žåˆ æ”¹çš„æ“ä½œæ—¶ï¼ŒInnoDB å¼•æ“Žä¼šå…ˆæ“ä½œç¼“å†²æ± ä¸­çš„æ•°æ®ï¼Œå¦‚æžœç¼“å†²åŒºæ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œä¼šé€šè¿‡åŽå°çº¿ç¨‹å°†ç£ç›˜ä¸­çš„æ•°æ®åŠ è½½å‡ºæ¥ï¼Œå­˜æ”¾åœ¨ç¼“å†²åŒºä¸­ï¼Œå†å°†ç¼“å†²æ± ä¸­çš„æ•°æ®ä¿®æ”¹ï¼Œä¿®æ”¹åŽçš„æ•°æ®é¡µæˆ‘ä»¬ç§°ä¸ºè„é¡µã€‚&lt;/p>
&lt;p>è„é¡µåˆ™ä¼šåœ¨ä¸€å®šçš„æ—¶æœºï¼Œé€šè¿‡åŽå°çº¿ç¨‹åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œä»Žè€Œä¿è¯ç¼“å†²åŒºä¸Žç£ç›˜çš„æ•°æ®ä¸€è‡´ã€‚&lt;/p>
&lt;p>ç¼“å†²åŒºçš„è„é¡µæ•°æ®å¹¶ä¸æ˜¯å®žæ—¶åˆ·æ–°çš„ï¼Œè€Œæ˜¯ä¸€æ®µæ—¶é—´ä¹‹åŽå°†ç¼“å†²åŒºçš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼ˆéšæœºç£ç›˜ IOï¼‰ã€‚&lt;/p>
&lt;p>å½“å¯¹ç¼“å†²åŒºçš„æ•°æ®è¿›è¡Œå¢žåˆ æ”¹ä¹‹åŽï¼Œä¼šé¦–å…ˆå°†æ“ä½œçš„æ•°æ®é¡µçš„å˜åŒ–ï¼Œè®°å½•åœ¨ redo log buffer ä¸­ã€‚åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šå°† redo log buffer ä¸­çš„æ•°æ®åˆ·æ–°åˆ° redo log ç£ç›˜æ–‡ä»¶ä¸­ï¼ˆé¡ºåºç£ç›˜ IOï¼‰ã€‚&lt;/p>
&lt;p>å¦‚æžœåˆ·æ–°ç¼“å†²åŒºçš„è„é¡µåˆ°ç£ç›˜æ—¶ï¼Œå‘ç”Ÿé”™è¯¯ï¼Œæ­¤æ—¶å°±å¯ä»¥å€ŸåŠ©äºŽ redo log è¿›è¡Œæ•°æ®æ¢å¤ï¼Œè¿™æ ·å°±ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€‚&lt;/p>
&lt;h2 id="undo-log">undo log&lt;/h2>
&lt;p>å›žæ»šæ—¥å¿—ã€‚è®°å½•æ“ä½œæ•°æ®åº“çš„é€†æ“ä½œï¼Œç”¨äºŽè¿›è¡Œå›žæ»šã€‚&lt;/p>
&lt;p>ä½œç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>æä¾›å›žæ»šï¼ˆä¿éšœäº‹åŠ¡çš„åŽŸå­æ€§ï¼‰&lt;/li>
&lt;li>MVCC&lt;/li>
&lt;/ul>
&lt;p>undo log æ˜¯é€»è¾‘æ—¥å¿—ï¼Œå¯ä»¥è®¤ä¸ºå½“ delete ä¸€æ¡è®°å½•æ—¶ï¼Œundo log ä¸­ä¼šè®°å½•ä¸€æ¡å¯¹åº”çš„ insert è®°å½•ï¼›å½“ update ä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒè®°å½•ä¸€æ¡å¯¹åº”ç›¸åçš„ update è®°å½•ã€‚&lt;/p>
&lt;h2 id="mvcc">MVCC&lt;/h2>
&lt;p>å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶ï¼ŒåŒä¸€æ¡è®°å½•åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ã€‚&lt;/p>
&lt;ul>
&lt;li>éšå¼å­—æ®µ
&lt;ul>
&lt;li>DB_TRX_ID äº‹åŠ¡ id&lt;/li>
&lt;li>DB_ROLL_PTR å›žæ»šæŒ‡é’ˆï¼ˆè®°å½•è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>undo log&lt;/li>
&lt;li>readview&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/innodb/2.png"
width="447"
height="293"
srcset="https://emerywan.github.io/blog/blog/p/mysql/innodb/2_hu6914e1ba0252a0a630b3ee48cb8867a4_30147_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/innodb/2_hu6914e1ba0252a0a630b3ee48cb8867a4_30147_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="152"
data-flex-basis="366px"
>&lt;/p>
&lt;h3 id="å½“å‰è¯»">å½“å‰è¯»&lt;/h3>
&lt;p>è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>&lt;code>update&lt;/code> &lt;code>insert&lt;/code> &lt;code>delete&lt;/code> &lt;code>select ... for update&lt;/code> &lt;code>select ... lock in share mode&lt;/code> éƒ½æ˜¯è¿›è¡Œå½“å‰è¯»ã€‚&lt;/p>
&lt;h3 id="å¿«ç…§è¯»">å¿«ç…§è¯»&lt;/h3>
&lt;p>ç®€å•çš„ä¸åŠ é” &lt;code>select&lt;/code> å°±æ˜¯å¿«ç…§è¯»ã€‚è¯»å–çš„æ˜¯å¿«ç…§ç‰ˆæœ¬ï¼Œé€šè¿‡ MVCC è¿›è¡Œå¹¶å‘æŽ§åˆ¶ã€‚&lt;/p>
&lt;h2 id="ä¸€è‡´æ€§">ä¸€è‡´æ€§&lt;/h2>
&lt;p>æ•°æ®åº“é€šè¿‡åŽŸå­æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§æ¥ä¿è¯ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>C(ä¸€è‡´æ€§)æ˜¯ç›®çš„ï¼ŒA(åŽŸå­æ€§)ã€I(éš”ç¦»æ€§)ã€D(æŒä¹…æ€§)æ˜¯æ˜¯ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ•°æ®åº“æä¾›çš„æ‰‹æ®µã€‚&lt;/p></description></item><item><title>MySQL å­˜å‚¨å¼•æ“Ž</title><link>https://emerywan.github.io/blog/p/mysql/engine/</link><pubDate>Fri, 29 Jul 2022 19:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/mysql/engine/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/22.jpeg" alt="Featured image of post MySQL å­˜å‚¨å¼•æ“Ž" />&lt;h2 id="mysql-ä½“ç³»ç»“æž„">MySQL ä½“ç³»ç»“æž„&lt;/h2>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/engine/1.png"
width="1176"
height="639"
srcset="https://emerywan.github.io/blog/blog/p/mysql/engine/1_hu5b4a85ab8f594ef5edc02d326d256cb0_206182_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/engine/1_hu5b4a85ab8f594ef5edc02d326d256cb0_206182_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h3 id="è¿žæŽ¥å±‚">è¿žæŽ¥å±‚&lt;/h3>
&lt;p>ä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºŽè¿žæŽ¥å¤„ç†ã€æŽˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>ä¸ºé€šè¿‡è®¤è¯å®‰å…¨æŽ¥å…¥çš„å®¢æˆ·ç«¯æä¾›çº¿ç¨‹ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æŽ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚&lt;/p>
&lt;h3 id="æœåŠ¡å±‚">æœåŠ¡å±‚&lt;/h3>
&lt;p>ä¸»è¦å®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæŽ¥å£ï¼Œå¹¶å®Œæˆç¼“å­˜çš„æŸ¥è¯¢ï¼ŒSQLçš„åˆ†æžå’Œä¼˜åŒ–ï¼Œéƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œã€‚&lt;/p>
&lt;p>æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“Žçš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®žçŽ°ï¼Œå¦‚ è¿‡ç¨‹ã€å‡½æ•°ç­‰ã€‚åœ¨è¯¥å±‚ï¼ŒæœåŠ¡å™¨ä¼šè§£æžæŸ¥è¯¢å¹¶åˆ›å»ºç›¸åº”çš„å†…éƒ¨è§£æžæ ‘ï¼Œå¹¶å¯¹å…¶å®Œæˆç›¸åº”çš„ä¼˜åŒ–å¦‚ç¡®å®šè¡¨çš„æŸ¥è¯¢çš„é¡ºåºï¼Œæ˜¯å¦åˆ©ç”¨ç´¢å¼•ç­‰ï¼Œæœ€åŽç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œã€‚&lt;/p>
&lt;p>å¦‚æžœæ˜¯selectè¯­å¥ï¼ŒæœåŠ¡å™¨è¿˜ä¼šæŸ¥è¯¢å†…éƒ¨çš„ç¼“å­˜ï¼Œå¦‚æžœç¼“å­˜ç©ºé—´è¶³å¤Ÿå¤§ï¼Œè¿™æ ·åœ¨è§£å†³å¤§é‡è¯»æ“ä½œçš„çŽ¯å¢ƒä¸­èƒ½å¤Ÿå¾ˆå¥½çš„æå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚&lt;/p>
&lt;h3 id="å¼•æ“Žå±‚">å¼•æ“Žå±‚&lt;/h3>
&lt;p>çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼ŒæœåŠ¡å™¨é€šè¿‡APIå’Œå­˜å‚¨å¼•æ“Žè¿›è¡Œé€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“Žå…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæ¥é€‰å–åˆé€‚çš„å­˜å‚¨å¼•æ“Žã€‚æ•°æ®åº“ä¸­çš„ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“Žå±‚å®žçŽ°çš„ã€‚&lt;/p>
&lt;h3 id="å­˜å‚¨å±‚">å­˜å‚¨å±‚&lt;/h3>
&lt;p>æ•°æ®å­˜å‚¨å±‚ï¼Œ ä¸»è¦æ˜¯å°†æ•°æ®ï¼ˆå¦‚: redologã€undologã€æ•°æ®ã€ç´¢å¼•ã€äºŒè¿›åˆ¶æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ï¼‰å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¹¶å®Œæˆä¸Žå­˜å‚¨å¼•æ“Žçš„äº¤äº’ã€‚&lt;/p>
&lt;h2 id="å­˜å‚¨å¼•æ“Ž">å­˜å‚¨å¼•æ“Ž&lt;/h2>
&lt;p>å­˜å‚¨å¼•æ“Žå°±æ˜¯å­˜å‚¨æ•°æ®ï¼Œå»ºç«‹ç´¢å¼•ï¼Œæ›´æ–°ã€æŸ¥è¯¢æ•°æ®ç­‰æŠ€æœ¯çš„å…·ä½“å®žçŽ°æ–¹å¼ã€‚&lt;/p>
&lt;p>å­˜å‚¨å¼•æ“Žæ˜¯åŸºäºŽè¡¨çš„ï¼Œè€Œä¸æ˜¯åŸºäºŽåº“çš„ï¼Œæ‰€ä»¥å­˜å‚¨å¼•æ“Žå¯ä»¥è¢«ç§°ä¸ºè¡¨ç±»åž‹ï¼Œå¯åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼ŒæŒ‡å®šé€‰æ‹©çš„å­˜å‚¨å¼•æ“Žã€‚&lt;/p>
&lt;ul>
&lt;li>å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“Ž&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">engines&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="innodb">InnoDB&lt;/h2>
&lt;p>InnoDB æ˜¯ MySQL 5.5 ä¹‹åŽé»˜è®¤çš„ MySQL å­˜å‚¨å¼•æ“Žã€‚&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>DML æ“ä½œéµå¾ª ACID æ¨¡åž‹ï¼Œæ”¯æŒäº‹åŠ¡&lt;/li>
&lt;li>æ”¯æŒè¡Œçº§é”ï¼Œæé«˜å¹¶å‘è®¿é—®æ€§èƒ½&lt;/li>
&lt;li>æ”¯æŒå¤–é”®çº¦æŸï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§&lt;/li>
&lt;/ul>
&lt;p>InnoDB çš„é€»è¾‘å­˜å‚¨ç»“æž„ï¼š&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/engine/innodb.png"
width="1207"
height="503"
srcset="https://emerywan.github.io/blog/blog/p/mysql/engine/innodb_hu255dad38c999e36f2d3fd079c10a9f22_82479_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/engine/innodb_hu255dad38c999e36f2d3fd079c10a9f22_82479_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="innodb"
class="gallery-image"
data-flex-grow="239"
data-flex-basis="575px"
>&lt;/p>
&lt;ul>
&lt;li>è¡¨ç©ºé—´&lt;/li>
&lt;/ul>
&lt;p>InnoDB å­˜å‚¨å¼•æ“Žé€»è¾‘ç»“æž„çš„æœ€é«˜å±‚ï¼Œidb æ–‡ä»¶å°±æ˜¯è¡¨ç©ºé—´æ–‡ä»¶ã€‚åœ¨è¡¨ç©ºé—´ä¸­å¯ä»¥åŒ…å«å¤šä¸ª Segment æ®µã€‚&lt;/p>
&lt;ul>
&lt;li>æ®µ&lt;/li>
&lt;/ul>
&lt;p>è¡¨ç©ºé—´æ˜¯ç”±å„ä¸ªæ®µç»„æˆçš„ï¼Œå¸¸è§çš„æ®µæœ‰æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›žæ»šæ®µç­‰ã€‚InnoDB å¯¹äºŽæ®µçš„ç®¡ç†ï¼Œéƒ½æ˜¯å¼•æ“Žè‡ªèº«å®Œæˆï¼Œä¸éœ€è¦äººä¸ºæŽ§åˆ¶ï¼Œä¸€ä¸ªæ®µä¸­åŒ…å«å¤šä¸ªåŒºã€‚&lt;/p>
&lt;ul>
&lt;li>åŒºï¼ˆ1Mï¼‰&lt;/li>
&lt;/ul>
&lt;p>åŒºæ˜¯è¡¨ç©ºé—´çš„å•å…ƒç»“æž„ï¼Œæ¯ä¸ªåŒºçš„å¤§å°ä¸º 1Mã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“Žé¡µçš„å¤§å°ä¸º 16Kï¼Œå³ä¸€ä¸ªåŒºä¸­ä¸€å…±æœ‰ 64 ä¸ªè¿žç»­çš„é¡µã€‚&lt;/p>
&lt;ul>
&lt;li>é¡µï¼ˆ16Kï¼‰&lt;/li>
&lt;/ul>
&lt;p>é¡µæ˜¯ç»„æˆåŒºçš„æœ€å°å•å…ƒï¼Œä¹Ÿæ˜¯ InnoDB å­˜å‚¨å¼•æ“Žç£ç›˜ç®¡ç†çš„æœ€å°å•å…ƒï¼Œæ¯ä¸ªé¡µé»˜è®¤ä¸º 16Kã€‚ä¸ºäº†ä¿è¯é¡µçš„è¿žç»­æ€§ï¼ŒInnoDB å­˜å‚¨å¼•æ“Žæ¯æ¬¡ä»Žç£ç›˜ç”³è¯· 4-5 ä¸ªåŒºã€‚&lt;/p>
&lt;ul>
&lt;li>è¡Œ&lt;/li>
&lt;/ul>
&lt;p>InnoDB å­˜å‚¨å¼•æ“Žæ˜¯é¢å‘è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®æ˜¯æŒ‰è¡Œè¿›è¡Œå­˜æ”¾çš„ï¼Œåœ¨æ¯ä¸€è¡Œä¸­ï¼Œé™¤äº†å®šä¹‰è¡¨æ—¶æŒ‡å®šçš„å­—æ®µå¤–ï¼Œè¿˜åŒ…æ‹¬éšè—å­—æ®µã€‚&lt;/p>
&lt;h2 id="myisam">MyISAM&lt;/h2>
&lt;p>MyISAM æ˜¯ MySQL æ—©æœŸçš„é»˜è®¤å­˜å‚¨å¼•æ“Žã€‚&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”®&lt;/li>
&lt;li>æ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”&lt;/li>
&lt;li>é€‚åˆ select&lt;/li>
&lt;/ul>
&lt;p>å­˜å‚¨æ–‡ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>.sdi
å­˜å‚¨è¡¨ç»“æž„ä¿¡æ¯&lt;/li>
&lt;li>.MYD
å­˜å‚¨æ•°æ®&lt;/li>
&lt;li>.MYI
å­˜å‚¨ç´¢å¼•&lt;/li>
&lt;/ul>
&lt;h2 id="memory">Memory&lt;/h2>
&lt;p>Memory å¼•æ“Žçš„è¡¨æ•°æ®æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œç”±äºŽå—åˆ°ç¡¬ä»¶ã€æ–­ç”µç­‰é—®é¢˜çš„å½±å“ï¼Œåªèƒ½å°†è¿™äº›è¡¨ä½œä¸ºä¸´æ—¶è¡¨æˆ–ç¼“å­˜ä½¿ç”¨ã€‚&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å†…å­˜å­˜æ”¾æ•°æ®ï¼Œå®•æœºåŽæ•°æ®ä¼šä¸¢å¤±&lt;/li>
&lt;li>hash ç´¢å¼•ï¼ˆé»˜è®¤ï¼‰&lt;/li>
&lt;/ul>
&lt;p>æ–‡ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>.sdi å­˜å‚¨è¡¨ç»“æž„ä¿¡æ¯&lt;/li>
&lt;/ul></description></item><item><title>MySQL ä¼˜åŒ–</title><link>https://emerywan.github.io/blog/p/mysql/sql-optimize/</link><pubDate>Fri, 01 Jul 2022 18:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/mysql/sql-optimize/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/20.jpeg" alt="Featured image of post MySQL ä¼˜åŒ–" />&lt;h2 id="insert-ä¼˜åŒ–">insert ä¼˜åŒ–&lt;/h2>
&lt;p>ä¸€æ¬¡æ€§å¾€æ•°æ®åº“ä¸­æ’å…¥å¤šæ¡æ•°æ®ï¼Œå¯ä»Žä»¥ä¸‹ä¸‰æ–¹é¢ä¼˜åŒ–ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰¹é‡æ’å…¥æ•°æ®&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ‰‹åŠ¨æŽ§åˆ¶äº‹åŠ¡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">transaction&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">commit&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ä¸»é”®é¡ºåºæ’å…¥&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ä¸»é”®ä¹±åºæ’å…¥ : 8 1 9 21 88 2 4 15 89 5 7 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ä¸»é”®é¡ºåºæ’å…¥ : 1 2 3 4 5 7 8 9 15 21 88 89
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¸»é”®ä¼˜åŒ–">ä¸»é”®ä¼˜åŒ–&lt;/h3>
&lt;ul>
&lt;li>æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½Žä¸»é”®çš„é•¿åº¦ï¼Œå‡å°‘ç£ç›˜ IO&lt;/li>
&lt;li>æ’å…¥æ•°æ®å°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨ auto_increment è‡ªå¢žä¸»é”®&lt;/li>
&lt;li>å°½é‡ä¸è¦ä½¿ç”¨ UUID æˆ–å…¶ä»–è‡ªç„¶ä¸»é”®ï¼ˆå¦‚èº«ä»½è¯å·ï¼‰ ä½œä¸ºä¸»é”®&lt;/li>
&lt;li>ä¸šåŠ¡æ“ä½œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹&lt;/li>
&lt;/ul>
&lt;p>åœ¨ InnoDB å­˜å‚¨å¼•æ“Žä¸­ï¼Œè¡¨æ•°æ®æ˜¯æ ¹æ®ä¸»é”®é¡ºåºç»„ç»‡å­˜æ”¾çš„ã€‚è¿™ç§å­˜å‚¨æ–¹å¼ä¸ºç´¢å¼•ç»„ç»‡è¡¨ï¼ˆindex organized table IOTï¼‰ã€‚&lt;/p>
&lt;p>åœ¨ InnoDB å¼•æ“Žä¸­ï¼Œæ•°æ®è¡Œæ˜¯è®°å½•åœ¨é€»è¾‘ç»“æž„ page é¡µä¸­çš„ï¼Œè€Œæ¯ä¸€ä¸ªé¡µçš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œé»˜è®¤ 16Kã€‚
é‚£ä¹Ÿå°±æ„å‘³ç€ï¼Œä¸€ä¸ªé¡µä¸­æ‰€å­˜å‚¨çš„è¡Œä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå¦‚æžœæ’å…¥çš„æ•°æ®è¡Œåœ¨è¯¥é¡µå­˜å‚¨ä¸ä¸‹ï¼Œå°†ä¼šå­˜å‚¨åˆ°ä¸‹ä¸€ä¸ªé¡µä¸­ï¼Œé¡µä¸Žé¡µä¹‹é—´ä¼šé€šè¿‡æŒ‡é’ˆè¿žæŽ¥ã€‚&lt;/p>
&lt;h4 id="é¡µåˆ†è£‚">é¡µåˆ†è£‚&lt;/h4>
&lt;p>é¡µå¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥å¡«å……ä¸€åŠï¼Œä¹Ÿå¯ä»¥å¡«å……100%ã€‚æ¯ä¸ªé¡µåŒ…å«äº† 2-N è¡Œæ•°æ®(å¦‚æžœä¸€è¡Œæ•°æ®è¿‡å¤§ï¼Œä¼šè¡Œ
æº¢å‡º)ï¼Œæ ¹æ®ä¸»é”®æŽ’åˆ—ã€‚&lt;/p>
&lt;p>ä¹±åºæ’å…¥ï¼š&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_1.png"
width="898"
height="636"
srcset="https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_1_hu563b35cba82cad8802163900e924e8ca_143837_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_1_hu563b35cba82cad8802163900e924e8ca_143837_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="primary_index_1"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="338px"
>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_2.png"
width="915"
height="659"
srcset="https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_2_hua83dc9b4ef4e3c90fc06cafc64e9881b_251787_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_2_hua83dc9b4ef4e3c90fc06cafc64e9881b_251787_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="primary_index_2"
class="gallery-image"
data-flex-grow="138"
data-flex-basis="333px"
>&lt;/p>
&lt;h4 id="é¡µåˆå¹¶">é¡µåˆå¹¶&lt;/h4>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_3.png"
width="906"
height="382"
srcset="https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_3_hu3b7e2aa6c3e2312a91f1497a31cd1dee_78730_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_3_hu3b7e2aa6c3e2312a91f1497a31cd1dee_78730_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="primary_index_3"
class="gallery-image"
data-flex-grow="237"
data-flex-basis="569px"
>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_4.png"
width="887"
height="573"
srcset="https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_4_hu41da46b964a6401e487c72fb3de2f351_108741_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/sql-optimize/primary_index_4_hu41da46b964a6401e487c72fb3de2f351_108741_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="primary_index_4"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="371px"
>&lt;/p>
&lt;h2 id="order-by-ä¼˜åŒ–">order by ä¼˜åŒ–&lt;/h2>
&lt;p>MySQLçš„æŽ’åºï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Using filesort : é€šè¿‡è¡¨çš„ç´¢å¼•æˆ–å…¨è¡¨æ‰«æï¼Œè¯»å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œç„¶åŽåœ¨æŽ’åºç¼“å†²åŒº sort
buffer ä¸­å®ŒæˆæŽ’åºæ“ä½œï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æŽ¥è¿”å›žæŽ’åºç»“æžœçš„æŽ’åºéƒ½å« FileSort æŽ’åº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Using index : é€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æŽ¥è¿”å›žæœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦
é¢å¤–æŽ’åºï¼Œæ“ä½œæ•ˆçŽ‡é«˜&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¼˜åŒ–åŽŸåˆ™ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ ¹æ®æŽ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œå¤šå­—æ®µæŽ’åºæ—¶ï¼Œä¹Ÿéµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆ(filesort)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¤šå­—æ®µæŽ’åº, ä¸€ä¸ªå‡åºä¸€ä¸ªé™åºï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„è”åˆç´¢å¼•åœ¨åˆ›å»ºæ—¶çš„è§„åˆ™ï¼ˆASC/DESCï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æžœä¸å¯é¿å…çš„å‡ºçŽ° filesortï¼Œå¤§æ•°æ®é‡æŽ’åºæ—¶ï¼Œå¯ä»¥é€‚å½“å¢žå¤§æŽ’åºç¼“å†²åŒºå¤§å° sort_buffer_size(é»˜è®¤ 256k)&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="limit-ä¼˜åŒ–">limit ä¼˜åŒ–&lt;/h2>
&lt;p>åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œå¦‚æžœè¿›è¡Œ limit åˆ†é¡µæŸ¥è¯¢ï¼Œåœ¨æŸ¥è¯¢æ—¶ï¼Œè¶Šå¾€åŽï¼Œåˆ†é¡µæŸ¥è¯¢æ•ˆçŽ‡è¶Šä½Žã€‚&lt;/p>
&lt;p>å½“åœ¨è¿›è¡Œåˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œå¦‚æžœæ‰§è¡Œ &lt;code>limit 2000000,10&lt;/code> ï¼Œæ­¤æ—¶éœ€è¦MySQLæŽ’åºå‰2000010 è®°
å½•ï¼Œä»…ä»…è¿”å›ž 2000000 - 2000010 çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æŽ’åºçš„ä»£ä»·éžå¸¸å¤§ ã€‚&lt;/p>
&lt;p>ä¼˜åŒ–æ€è·¯: ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»ºè¦†ç›–ç´¢å¼•èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•åŠ å­æŸ¥
è¯¢å½¢å¼è¿›è¡Œä¼˜åŒ–ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_sku&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_sku&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2000000&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="count-ä¼˜åŒ–">count ä¼˜åŒ–&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>count(ä¸»é”®)&lt;/p>
&lt;ul>
&lt;li>InnoDB å¼•æ“Žä¼šéåŽ†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„ ä¸»é”®id å€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›žç»™æœåŠ¡å±‚ã€‚æœåŠ¡å±‚æ‹¿åˆ°ä¸»é”®åŽï¼Œç›´æŽ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ (ä¸»é”®ä¸å¯èƒ½ä¸ºnull)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>count(å­—æ®µ)&lt;/p>
&lt;ul>
&lt;li>æ²¡æœ‰ not null çº¦æŸ: InnoDB å¼•æ“Žä¼šéåŽ†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›žç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚åˆ¤æ–­æ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullï¼Œè®¡æ•°ç´¯åŠ ã€‚&lt;/li>
&lt;li>æœ‰ not null çº¦æŸï¼šInnoDB å¼•æ“Žä¼šéåŽ†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›žç»™æœåŠ¡å±‚ï¼Œç›´æŽ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>count(æ•°å­—)&lt;/p>
&lt;ul>
&lt;li>InnoDB å¼•æ“ŽéåŽ†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚æœåŠ¡å±‚å¯¹äºŽè¿”å›žçš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­—â€œ1â€è¿›åŽ»ï¼Œç›´æŽ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>count(*)&lt;/p>
&lt;ul>
&lt;li>InnoDBå¼•æ“Žå¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ï¼ŒæœåŠ¡å±‚ç›´æŽ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="update-ä¼˜åŒ–">update ä¼˜åŒ–&lt;/h2>
&lt;p>InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•åŠ çš„é”ï¼Œå¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™ä¼šä»Žè¡Œé”
å‡çº§ä¸ºè¡¨é”ã€‚&lt;/p>
&lt;p>å¼€å¯å¤šä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œ SQL æ—¶ï¼Œé˜²æ­¢è¡Œé”å‡çº§ä¸ºäº†è¡¨é”ã€‚&lt;/p></description></item><item><title>MySQL æ—¥å¿—</title><link>https://emerywan.github.io/blog/p/mysql/log/</link><pubDate>Thu, 30 Jun 2022 18:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/mysql/log/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/19.jpeg" alt="Featured image of post MySQL æ—¥å¿—" />&lt;h2 id="æ—¥å¿—">æ—¥å¿—&lt;/h2>
&lt;h3 id="é”™è¯¯æ—¥å¿—">é”™è¯¯æ—¥å¿—&lt;/h3>
&lt;p>é”™è¯¯æ—¥å¿—æ˜¯ MySQL ä¸­æœ€é‡è¦çš„æ—¥å¿—ä¹‹ä¸€ï¼Œå®ƒè®°å½•äº†å½“ mysqld å¯åŠ¨å’Œåœæ­¢æ—¶ï¼Œä»¥åŠæœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•ä¸¥é‡é”™è¯¯æ—¶çš„ç›¸å…³ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å½“æ•°æ®åº“å‡ºçŽ°ä»»ä½•æ•…éšœå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨æ—¶ï¼Œå»ºè®®é¦–å…ˆæŸ¥çœ‹æ­¤æ—¥å¿—ã€‚&lt;/p>
&lt;p>æŸ¥çœ‹æ—¥å¿—ä½ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%log_error%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/log/errorlog.png"
width="669"
height="214"
srcset="https://emerywan.github.io/blog/blog/p/mysql/log/errorlog_huaf2aa946fc0c9a4be25a1e7ae77fcd38_27013_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/log/errorlog_huaf2aa946fc0c9a4be25a1e7ae77fcd38_27013_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="errorlog"
class="gallery-image"
data-flex-grow="312"
data-flex-basis="750px"
>&lt;/p>
&lt;h3 id="äºŒè¿›åˆ¶æ—¥å¿—">äºŒè¿›åˆ¶æ—¥å¿—&lt;/h3>
&lt;p>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBINLOGï¼‰è®°å½•äº†æ‰€æœ‰çš„ DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰è¯­å¥å’Œ DMLï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰è¯­å¥ã€‚&lt;/p>
&lt;p>ä½œç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>ç¾éš¾æ—¶æ•°æ®æ¢å¤&lt;/li>
&lt;li>MySQL ä¸»ä»Žå¤åˆ¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%log_bin%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/log/binlog.png"
width="602"
height="240"
srcset="https://emerywan.github.io/blog/blog/p/mysql/log/binlog_hue4b3570af35eb515872cd8390aac573d_28397_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/log/binlog_hue4b3570af35eb515872cd8390aac573d_28397_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="binlog"
class="gallery-image"
data-flex-grow="250"
data-flex-basis="602px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>log_bin_basename&lt;/p>
&lt;ul>
&lt;li>å½“å‰æ•°æ®åº“æœåŠ¡å™¨çš„binlogæ—¥å¿—çš„åŸºç¡€åç§°(å‰ç¼€)ï¼Œå…·ä½“çš„binlogæ–‡ä»¶åéœ€è¦å†è¯¥basenameçš„åŸºç¡€ä¸ŠåŠ ä¸Šç¼–å·(ç¼–å·ä»Ž000001å¼€å§‹)ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>log_bin_index&lt;/p>
&lt;ul>
&lt;li>binlogçš„ç´¢å¼•æ–‡ä»¶ï¼Œé‡Œé¢è®°å½•äº†å½“å‰æœåŠ¡å™¨å…³è”çš„binlogæ–‡ä»¶æœ‰å“ªäº›ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="binlog-æ ¼å¼">binlog æ ¼å¼&lt;/h4>
&lt;p>MySQL æœåŠ¡å™¨ä¸­æä¾›äº†å¤šç§æ ¼å¼æ¥è®°å½•äºŒè¿›åˆ¶æ—¥å¿—ï¼š&lt;/p>
&lt;p>é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ï¼Œåªéœ€è¦åœ¨ /etc/my.cnf ä¸­é…ç½® binlog_format å‚æ•°å³å¯ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>statement&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åŸºäºŽ SQL è¯­å¥çš„æ—¥å¿—è®°å½•ï¼Œè®°å½•çš„æ˜¯ SQL è¯­å¥ï¼Œå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„ SQL éƒ½ä¼šè®°å½•åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>row&lt;/code> ï¼ˆé»˜è®¤ï¼‰&lt;/p>
&lt;ul>
&lt;li>åŸºäºŽè¡Œçš„æ—¥å¿—è®°å½•ï¼Œè®°å½•çš„æ˜¯æ¯ä¸€è¡Œçš„æ•°æ®å˜æ›´ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>mixed&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ··åˆäº† statememt å’Œ row ä¸¤ç§æ ¼å¼ï¼Œé»˜è®¤é‡‡ç”¨statementï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸º row è¿›è¡Œè®°å½•ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%binlog_format%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/log/binlogformat.png"
width="432"
height="156"
srcset="https://emerywan.github.io/blog/blog/p/mysql/log/binlogformat_hu025aaab383e907dcebf622698b084bf9_13882_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/log/binlogformat_hu025aaab383e907dcebf622698b084bf9_13882_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="binlogformat"
class="gallery-image"
data-flex-grow="276"
data-flex-basis="664px"
>&lt;/p>
&lt;h4 id="æŸ¥çœ‹-binlog">æŸ¥çœ‹ binlog&lt;/h4>
&lt;p>æ—¥å¿—æ˜¯ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨çš„ï¼Œä¸èƒ½ç›´æŽ¥è¯»å–ï¼Œéœ€è¦é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—æŸ¥è¯¢å·¥å…· &lt;code>mysqlbinlog&lt;/code> æ¥æŸ¥çœ‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mysqlbinlog [å‚æ•°] logfilename
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">å‚æ•°é€‰é¡¹ï¼š
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -d æŒ‡å®šæ•°æ®åº“åç§°ï¼Œåªåˆ—å‡ºæŒ‡å®šçš„æ•°æ®åº“ç›¸å…³æ“ä½œ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -o å¿½ç•¥æŽ‰æ—¥å¿—ä¸­çš„å‰ n è¡Œå‘½ä»¤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v å°†è¡Œäº‹ä»¶(æ•°æ®å˜æ›´)é‡æž„ä¸ºSQLè¯­å¥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -vv å°†è¡Œäº‹ä»¶(æ•°æ®å˜æ›´)é‡æž„ä¸ºSQLè¯­å¥ï¼Œå¹¶è¾“å‡ºæ³¨é‡Šä¿¡æ¯
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="æ¸…ç†-binlog">æ¸…ç† binlog&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>&lt;code>reset master&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åˆ é™¤å…¨éƒ¨ binlog æ—¥å¿—ï¼Œåˆ é™¤ä¹‹åŽï¼Œæ—¥å¿—ç¼–å·ï¼Œå°†ä»Ž binlog.000001é‡æ–°å¼€å§‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>purge master logs to 'binlog.000005'&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åˆ é™¤ 000005 ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>purge master logs before 'yyyy-mm-dd hh24:mi:ss'&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åˆ é™¤æ—¥å¿—ä¸º &amp;ldquo;yyyy-mm-dd hh24:mi:ss&amp;rdquo; ä¹‹å‰äº§ç”Ÿçš„æ‰€æœ‰æ—¥å¿—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å¯ä»¥åœ¨ mysql çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„è¿‡æœŸæ—¶é—´ï¼Œè®¾ç½®äº†ä¹‹åŽï¼ŒäºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸä¼šè‡ªåŠ¨åˆ é™¤ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%binlog_expire_logs_seconds%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/log/binlogexpire.png"
width="541"
height="153"
srcset="https://emerywan.github.io/blog/blog/p/mysql/log/binlogexpire_hua71c1465b703f02a37880ff6dd450f1c_15632_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/log/binlogexpire_hua71c1465b703f02a37880ff6dd450f1c_15632_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="binlogexpire"
class="gallery-image"
data-flex-grow="353"
data-flex-basis="848px"
>&lt;/p>
&lt;h3 id="æŸ¥è¯¢æ—¥å¿—">æŸ¥è¯¢æ—¥å¿—&lt;/h3>
&lt;p>æŸ¥è¯¢æ—¥å¿—ä¸­è®°å½•äº†å®¢æˆ·ç«¯çš„æ‰€æœ‰æ“ä½œè¯­å¥ã€‚ï¼ˆbinlog ä¸åŒ…å«æŸ¥è¯¢æ•°æ®çš„ SQL è¯­å¥ï¼‰&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢æ—¥å¿—æ˜¯æœªå¼€å¯çš„ã€‚&lt;/p>
&lt;p>å¦‚æžœéœ€è¦å¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼Œå¯ä»¥ä¿®æ”¹MySQLçš„é…ç½®æ–‡ä»¶ /etc/my.cnf æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># è¯¥é€‰é¡¹ç”¨æ¥å¼€å¯æŸ¥è¯¢æ—¥å¿—
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># å¯é€‰å€¼ 0 å…³é—­ 1 å¼€å¯
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">general_log=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶å
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># å¦‚æžœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤çš„æ–‡ä»¶åä¸º host_name.log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">general_log_file=mysql_query.log
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¼€å¯äº†æŸ¥è¯¢æ—¥å¿—ä¹‹åŽï¼Œ/var/lib/mysql/ ç›®å½•ä¸‹å°±ä¼šå‡ºçŽ° mysql_query.log æ–‡ä»¶ã€‚&lt;/p>
&lt;p>æ‰€æœ‰çš„å®¢æˆ·ç«¯çš„å¢žåˆ æ”¹æŸ¥æ“ä½œéƒ½ä¼šè®°å½•åœ¨è¯¥æ—¥å¿—æ–‡ä»¶ä¹‹ä¸­ï¼Œé•¿æ—¶é—´è¿è¡ŒåŽï¼Œè¯¥æ—¥å¿—æ–‡ä»¶å°†ä¼šéžå¸¸å¤§ã€‚&lt;/p>
&lt;h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—">æ…¢æŸ¥è¯¢æ—¥å¿—&lt;/h3>
&lt;p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰§è¡Œæ—¶é—´è¶…è¿‡ &lt;code>long_query_time&lt;/code>&lt;/li>
&lt;li>æ‰«æè®°å½•æ•°å¤§äºŽ &lt;code>min_examined_row_limit&lt;/code>
çš„æ‰€æœ‰çš„SQLè¯­å¥çš„æ—¥å¿—ï¼Œé»˜è®¤æœªå¼€å¯ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚æžœéœ€è¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦åœ¨ MySQL çš„é…ç½®æ–‡ä»¶ /etc/my.cnf ä¸­é…ç½®å¦‚ä¸‹å‚æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># æ…¢æŸ¥è¯¢æ—¥å¿—
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">slow_query_log=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># æ‰§è¡Œæ—¶é—´å‚æ•°
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">long_query_time=2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ä¼šè®°å½•ç®¡ç†è¯­å¥ï¼Œä¹Ÿä¸ä¼šè®°å½•ä¸ä½¿ç”¨ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾çš„æŸ¥è¯¢ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># è®°å½•æ‰§è¡Œè¾ƒæ…¢çš„ç®¡ç†è¯­å¥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">log_slow_admin_statements=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># è®°å½•æ‰§è¡Œè¾ƒæ…¢çš„æœªä½¿ç”¨ç´¢å¼•çš„è¯­å¥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">log_queries_not_using_indexes= 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>MySQL ç´¢å¼•</title><link>https://emerywan.github.io/blog/p/mysql/index/</link><pubDate>Thu, 30 Jun 2022 14:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/mysql/index/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/15.jpeg" alt="Featured image of post MySQL ç´¢å¼•" />&lt;h2 id="ç´¢å¼•">ç´¢å¼•&lt;/h2>
&lt;p>ç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ© MySQL é«˜æ•ˆèŽ·å–æ•°æ®çš„æ•°æ®ç»“æž„ï¼Œæé«˜æŸ¥è¯¢æ•ˆçŽ‡ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¼˜ç‚¹&lt;/p>
&lt;ul>
&lt;li>æé«˜æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦&lt;/li>
&lt;li>é™ä½Žæ•°æ®åº“çš„ IO æˆæœ¬&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç¼ºç‚¹&lt;/p>
&lt;ul>
&lt;li>å ç”¨ç£ç›˜ç©ºé—´&lt;/li>
&lt;li>å¢žåˆ æ”¹éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œæ€§èƒ½å¯èƒ½ä¼šä¸‹é™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="ç´¢å¼•çš„åˆ†ç±»">ç´¢å¼•çš„åˆ†ç±»&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- æŸ¥çœ‹è¡¨ä¸­çš„ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table_name&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¸»é”®ç´¢å¼•">ä¸»é”®ç´¢å¼•&lt;/h3>
&lt;p>å½“ä¸€å¼ è¡¨ï¼ŒæŠŠæŸä¸ªåˆ—è®¾ä¸ºä¸»é”®çš„æ—¶å€™ï¼Œåˆ™è¯¥åˆ—å°±æ˜¯ä¸»é”®ç´¢å¼•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ™®é€šç´¢å¼•">æ™®é€šç´¢å¼•&lt;/h3>
&lt;p>ç”¨è¡¨ä¸­çš„æ™®é€šåˆ—æž„å»ºçš„ç´¢å¼•ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_index_name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_index_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_table&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å”¯ä¸€ç´¢å¼•">å”¯ä¸€ç´¢å¼•&lt;/h3>
&lt;p>ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œå…è®¸æœ‰å¤šä¸ªç©ºå€¼ nullï¼ˆå’Œä¸»é”®ä¸åŒï¼Œä¸»é”®ä¸å…è®¸ä¸ºç©ºï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">unique&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">new_unique_index_name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unique&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">new_unique_index_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_table&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å…¨æ–‡ç´¢å¼•">å…¨æ–‡ç´¢å¼•&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">fulltext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_fulltext_index_content&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç»„åˆç´¢å¼•">ç»„åˆç´¢å¼•&lt;/h3>
&lt;p>ç»„åˆç´¢å¼• / è”åˆç´¢å¼•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_name_age_index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="èšç°‡ç´¢å¼•">èšç°‡ç´¢å¼•&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ç´¢å¼•å’Œæ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œç´¢å¼•ç»“æž„çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ®ï¼Œæ‰¾åˆ°äº†ç´¢å¼•å°±æ‰¾åˆ°äº†æ•°æ®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è®¿é—®æ•°æ®æ›´å¿«ï¼Œèšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªB+æ ‘ä¸Šã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºŽæ’å…¥é¡ºåºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ›´æ–°èšç°‡ç´¢å¼•åˆ—çš„ä»£ä»·å¾ˆé«˜ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/index8.png"
width="722"
height="369"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/index8_hu9d45f79d8b338c019791de22ea52eb90_62479_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/index8_hu9d45f79d8b338c019791de22ea52eb90_62479_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="index8"
class="gallery-image"
data-flex-grow="195"
data-flex-basis="469px"
>&lt;/p>
&lt;h3 id="éžèšç°‡ç´¢å¼•äºŒçº§ç´¢å¼•">éžèšç°‡ç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰&lt;/h3>
&lt;p>å°†æ•°æ®ä¸Žç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æž„çš„å¶å­èŠ‚ç‚¹å…³è”çš„æ˜¯å¯¹åº”çš„ä¸»é”®ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/clustering-index.png"
width="840"
height="571"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/clustering-index_hub32172b742ab96d724c643b42699b935_232051_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/clustering-index_hub32172b742ab96d724c643b42699b935_232051_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="clustering-index"
class="gallery-image"
data-flex-grow="147"
data-flex-basis="353px"
>&lt;/p>
&lt;ul>
&lt;li>äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œè¦å›žè¡¨ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/index9.png"
width="727"
height="389"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/index9_hua49cf0193b83cd4f61e5b4747229532b_46178_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/index9_hua49cf0193b83cd4f61e5b4747229532b_46178_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="index9"
class="gallery-image"
data-flex-grow="186"
data-flex-basis="448px"
>&lt;/p>
&lt;h2 id="ç´¢å¼•çš„ç»“æž„">ç´¢å¼•çš„ç»“æž„&lt;/h2>
&lt;h3 id="b-tree">B Tree&lt;/h3>
&lt;p>B æ ‘æ˜¯ä¸€ç§å¤šå‰å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œå…¶ä¸»è¦ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ ‘çš„èŠ‚ç‚¹ä¸­å­˜å‚¨ç€å¤šä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå†…èŠ‚ç‚¹æœ‰å¤šä¸ªåˆ†å‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å‚¨å­˜æ•°æ®ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸­åŒ…å«é”®å€¼å’Œæ•°æ®ï¼ŒèŠ‚ç‚¹ä¸­çš„é”®å€¼ä»Žå°åˆ°å¤§æŽ’åˆ—ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>çˆ¶èŠ‚ç‚¹å½“ä¸­çš„å…ƒç´ ä¸ä¼šå‡ºçŽ°åœ¨å­èŠ‚ç‚¹ä¸­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ‰€æœ‰çš„å¶å­ç»“ç‚¹éƒ½ä½äºŽåŒä¸€å±‚ï¼Œå¶èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ·±åº¦ï¼Œå¶èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰æŒ‡é’ˆè¿žæŽ¥ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/BTree.png"
width="824"
height="496"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/BTree_hu5a2ea9e01a7974b484f27a03994c1eb9_162577_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/BTree_hu5a2ea9e01a7974b484f27a03994c1eb9_162577_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="BTree"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="398px"
>&lt;/p>
&lt;h3 id="b-tree-1">B+ Tree&lt;/h3>
&lt;p>B+ æ ‘æ˜¯ B æ ‘çš„å‡çº§ç‰ˆã€‚B+ æ ‘åœ¨ç»“æž„ä¸Šå’ŒBæ ‘çš„åŒºåˆ«åœ¨äºŽï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åªæœ‰å¶å­èŠ‚ç‚¹æ‰ä¼šå­˜å‚¨æ•°æ®ï¼Œéžå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ï¼Œç”¨äºŽæŸ¥æ‰¾ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¶å­èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨åŒå‘æŒ‡é’ˆè¿žæŽ¥ï¼Œæœ€åº•å±‚çš„å¶å­èŠ‚ç‚¹å½¢æˆäº†ä¸€ä¸ªåŒå‘æœ‰åºé“¾è¡¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¶å­èŠ‚ç‚¹ä¿å­˜äº†çˆ¶èŠ‚ç‚¹æ‰€æœ‰å…³é”®å­—è®°å½•çš„æŒ‡é’ˆã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/BTree2.png"
width="726"
height="486"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/BTree2_hu9d51150ef65d39ad05b8ca626e16e349_124398_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/BTree2_hu9d51150ef65d39ad05b8ca626e16e349_124398_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="B&amp;#43;Tree"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="358px"
>&lt;/p>
&lt;p>ç›¸æ¯”ä¸Ž B æ ‘ï¼ŒB+ æ ‘æœ‰ä»¥ä¸‹æå‡ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ‰«è¡¨èƒ½åŠ›æ›´å¼ºï¼ˆè¿›è¡Œå…¨è¡¨æ‰«æï¼Œåªéœ€è¦éåŽ†å¶å­èŠ‚ç‚¹å³å¯ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…·æœ‰æ›´å¥½çš„ç£ç›˜è¯»å†™èƒ½åŠ›ï¼ˆéžå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œä½¿æ ‘æ›´çŸ®ï¼ŒIO æ“ä½œæ›´å°‘ï¼Œä¸€æ¬¡ç£ç›˜åŠ è½½æ‰«æèŒƒå›´æ›´å¤§ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŸ¥è¯¢æ•ˆçŽ‡ç¨³å®šï¼ˆæ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼ŒIO æ¬¡æ•°ç¨³å®šï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¢žåˆ æ•°æ®æ•ˆçŽ‡æ›´é«˜ï¼ˆæ•°æ®åœ¨å¶å­èŠ‚ç‚¹ä»¥æœ‰åºé“¾è¡¨å­˜å‚¨ï¼Œå¯æé«˜æ•°æ®å¢žåˆ æ•ˆçŽ‡ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ•°æ®åº“ä¸­ï¼ŒB+ æ ‘çš„é«˜åº¦ä¸€èˆ¬éƒ½åœ¨ 2~4 å±‚ã€‚ç”±äºŽ MySQL çš„ INNODB å¼•æ“Žåœ¨è®¾è®¡æ—¶æ˜¯å°† B+ æ ‘çš„æ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜çš„ï¼Œå› æ­¤åœ¨æŸ¥æ‰¾æŸä¸€é”®å€¼çš„è¡Œè®°å½•æ—¶ï¼Œæœ€å¤šåªéœ€è¦ 1~3 æ¬¡ç£ç›˜IOã€‚&lt;/p>
&lt;h3 id="hash">Hash&lt;/h3>
&lt;p>æ”¯æŒ hash ç´¢å¼•çš„æ˜¯ Memory å­˜å‚¨å¼•æ“Žã€‚é‡‡ç”¨ä¸€å®šçš„ hash ç®—æ³•ï¼Œå°†é”®å€¼æ¢ç®—æˆæ–°çš„ hash å€¼ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ§½ä½ä¸Šï¼Œç„¶åŽå­˜å‚¨åœ¨ hash è¡¨ä¸­ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="hash.png" >hash&lt;/a>&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>åªèƒ½ç”¨äºŽå¯¹ç­‰æ¯”è¾ƒï¼ˆ=, inï¼‰ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆbetween, &amp;gt;, &amp;lt;ï¼‰&lt;/li>
&lt;li>æ— æ³•åˆ©ç”¨ç´¢å¼•å®ŒæˆæŽ’åºæ“ä½œ&lt;/li>
&lt;li>æŸ¥è¯¢æ•ˆçŽ‡é«˜ï¼Œé€šå¸¸åªéœ€è¦ä¸€æ¬¡æ£€ç´¢ï¼ˆæ—  hash å†²çªçš„æƒ…å†µï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="åˆ›å»ºç´¢å¼•çš„åŽŸåˆ™">åˆ›å»ºç´¢å¼•çš„åŽŸåˆ™&lt;/h2>
&lt;h3 id="-å»ºè®®åˆ›å»ºç´¢å¼•">ðŸ™† å»ºè®®åˆ›å»ºç´¢å¼•&lt;/h3>
&lt;ul>
&lt;li>âœ… &lt;code>select&lt;/code> è¯­å¥ï¼Œé¢‘ç¹ä½œä¸º &lt;code>where&lt;/code> æ¡ä»¶çš„å­—æ®µ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- index(first_name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">last_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Cools&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- è”åˆç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(first_name, last_name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- æ³¨æ„æ»¡è¶³ï¼šæœ€å·¦å‰ç¼€åŽŸåˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(last_name, first_name) -&amp;gt; where first_name=&amp;#34;Georgi&amp;#34; æ— æ³•ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>âœ… &lt;code>update/delete&lt;/code> è¯­å¥çš„ &lt;code>where&lt;/code> æ¡ä»¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">update&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Jim&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;100001&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">delete&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fitst_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>âœ… éœ€è¦åˆ†ç»„ï¼ŒæŽ’åºçš„å­—æ®µ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">group&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>âœ… ä½¿ç”¨ &lt;code>distinct&lt;/code> çš„å­—æ®µ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">distinct&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>âœ… å­—æ®µéœ€è¦å”¯ä¸€æ€§çº¦æŸ&lt;/p>
&lt;ul>
&lt;li>å”¯ä¸€ç´¢å¼•&lt;/li>
&lt;li>ä¸»é”®ç´¢å¼•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>âœ… å¤šè¡¨æŸ¥è¯¢ï¼Œè¿žæŽ¥å­—æ®µåº”åˆ›å»ºç´¢å¼•&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç±»åž‹åŠ¡å¿…ä¿æŒä¸€è‡´&lt;/strong>ï¼Œé¿å…éšå¼è£…æ¢&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">departments&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;100001&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- employees.emp_no dept_emp.emp_no ç±»åž‹åŠ¡å¿…ä¿æŒä¸€è‡´
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- dept_emp.dept_no departmants.dept_no ç±»åž‹åŠ¡å¿…ä¿æŒä¸€è‡´
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-ä¸å»ºè®®åˆ›å»ºç´¢å¼•">ðŸ™… ä¸å»ºè®®åˆ›å»ºç´¢å¼•&lt;/h3>
&lt;ul>
&lt;li>âŒ &lt;code>where&lt;/code> å­å¥ä¸­ç”¨ä¸åˆ°çš„å­—æ®µ&lt;/li>
&lt;/ul>
&lt;p>ç´¢å¼•çš„ä½œç”¨æ˜¯å¿«é€Ÿå®šä½åˆ°æƒ³è¦çš„æ•°æ®ï¼Œç”¨ä¸åˆ°å°±æ²¡æœ‰å¿…è¦åˆ›å»ºæ•°æ®äº†ã€‚&lt;/p>
&lt;ul>
&lt;li>âŒ è¡¨é‡Œçš„è®°å½•éžå¸¸å°‘&lt;/li>
&lt;/ul>
&lt;p>å¦‚åªæœ‰ 100 æ¡æ•°æ®ï¼Œæœ‰æ— å½±å“ä¸å¤§ã€‚&lt;/p>
&lt;ul>
&lt;li>âŒ æœ‰å¤§é‡é‡å¤æ•°æ®ï¼Œé€‰æ‹©æ€§ä½Ž&lt;/li>
&lt;/ul>
&lt;p>å¦‚ï¼šæ€§åˆ«å­—æ®µï¼Œå¯¼è‡´å¤§é‡å›žè¡¨ã€‚&lt;/p>
&lt;p>ç´¢å¼•çš„é€‰æ‹©æ€§è¶Šé«˜ï¼ŒæŸ¥è¯¢æ•ˆçŽ‡è¶Šå¥½ï¼Œå¯ä»¥åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­è¿‡æ»¤æ›´å¤šçš„è¡Œ&lt;/p>
&lt;ul>
&lt;li>âŒ é¢‘ç¹æ›´æ–°çš„å­—æ®µï¼Œåˆ›å»ºç´¢å¼•è¦è€ƒè™‘ç»´æŠ¤ç´¢å¼•çš„å¼€é”€&lt;/li>
&lt;/ul>
&lt;p>é¢‘ç¹ä¿®æ”¹ä½†æŸ¥è¯¢å°‘çš„å­—æ®µï¼Œä¸æŽ¨èåˆ›å»ºç´¢å¼•&lt;/p>
&lt;h2 id="ç´¢å¼•å¤±æ•ˆä¸Žè§£å†³æ–¹æ¡ˆ">ç´¢å¼•å¤±æ•ˆä¸Žè§£å†³æ–¹æ¡ˆ&lt;/h2>
&lt;h3 id="-ç´¢å¼•åˆ—ä¸ç‹¬ç«‹è¿›è¡Œäº†è®¡ç®—æˆ–å˜æˆäº†å‚æ•°">âš ï¸ ç´¢å¼•åˆ—ä¸ç‹¬ç«‹ï¼Œè¿›è¡Œäº†è®¡ç®—æˆ–å˜æˆäº†å‚æ•°&lt;/h3>
&lt;ul>
&lt;li>ç´¢å¼•å­—æ®µè¿›è¡Œäº†è¡¨è¾¾å¼è®¡ç®—&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">form&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100003&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/index1.png"
width="1185"
height="157"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/index1_huaa761d032e691cca90bef5eef1dadb87_81724_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/index1_huaa761d032e691cca90bef5eef1dadb87_81724_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="754"
data-flex-basis="1811px"
>&lt;/p>
&lt;p>åº”äº‹å…ˆè®¡ç®—å¥½è¡¨è¾¾å¼çš„å€¼ï¼Œå†ä¼ å…¥ï¼Œé¿å…åœ¨ SQL &lt;code>where&lt;/code> çš„å·¦ä¾§åšè®¡ç®—ã€‚&lt;/p>
&lt;ul>
&lt;li>ç´¢å¼•å­—æ®µæ˜¯å‡½æ•°çš„å‚æ•°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">substring&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fitst_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Geo&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>äº‹å…ˆè®¡ç®—å¥½å†ä¼ å…¥ã€‚&lt;/p>
&lt;p>æˆ–è€…ä½¿ç”¨ä¸€äº›ç­‰ä»·çš„ SQLã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Geo%&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- first_name éœ€è¦æ˜¯ç´¢å¼•çš„æƒ…å†µä¸‹æœ‰æ•ˆï¼ˆæ ¹æ®å®žé™…åœºæ™¯ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- æ³¨æ„ like ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/index2.png"
width="1169"
height="154"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/index2_hu58e272ce7b5bb61c6085e6a94f631f41_86327_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/index2_hu58e272ce7b5bb61c6085e6a94f631f41_86327_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="759"
data-flex-basis="1821px"
>&lt;/p>
&lt;h3 id="-ä½¿ç”¨äº†å·¦æ¨¡ç³Š">âš ï¸ ä½¿ç”¨äº†å·¦æ¨¡ç³Š&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;%Geo%&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- æ— æ³•ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employee&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Geo%&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- å¯ä»¥ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æžœæ— æ³•é¿å…ï¼Œä¸”æœ‰è¾ƒé«˜éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æœç´¢å¼•æ“Žã€‚&lt;/p>
&lt;h3 id="-or-æŸ¥è¯¢çš„éƒ¨åˆ†å­—æ®µæ²¡æœ‰ç´¢å¼•">âš ï¸ or æŸ¥è¯¢çš„éƒ¨åˆ†å­—æ®µæ²¡æœ‰ç´¢å¼•&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">or&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">last_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- å‡è®¾å½“å‰ first_name æœ‰ç´¢å¼•ï¼Œlast_name æ²¡æœ‰ç´¢å¼•ï¼Œè¯¥æ¡ sql æ— æ³•ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(fitst_name)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/index3.png"
width="1148"
height="176"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/index3_hua5c1e2b296fd025c6e1f6de1e5790543_84429_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/index3_hua5c1e2b296fd025c6e1f6de1e5790543_84429_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3"
class="gallery-image"
data-flex-grow="652"
data-flex-basis="1565px"
>&lt;/p>
&lt;p>è§£å†³ï¼šæ ¹æ®å®žé™…ä¸šåŠ¡ï¼Œæ·»åŠ ç›¸åº”çš„ç´¢å¼•ã€‚&lt;/p>
&lt;p>æ·»åŠ ç´¢å¼•åŽï¼Œç´¢å¼•åˆå¹¶ï¼Œé¿å…äº†å…¨è¡¨æ‰«æã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/index4.png"
width="1129"
height="139"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/index4_hu903a3bbf3d6eb2ece40fc0c15484c985_86767_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/index4_hu903a3bbf3d6eb2ece40fc0c15484c985_86767_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="4"
class="gallery-image"
data-flex-grow="812"
data-flex-basis="1949px"
>&lt;/p>
&lt;h3 id="-å­—ç¬¦ä¸²æ¡ä»¶æ²¡æœ‰ä½¿ç”¨-">âš ï¸ å­—ç¬¦ä¸²æ¡ä»¶æ²¡æœ‰ä½¿ç”¨ &amp;quot;&amp;quot;&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- è¿™é‡Œ dept_no åœ¨æ•°æ®åº“å®šä¹‰ä¸º varchar
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŽŸåˆ™çš„æŸ¥è¯¢">âš ï¸ ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŽŸåˆ™çš„æŸ¥è¯¢&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Facello&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- index(last_name, first_name)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/index5.png"
width="1156"
height="155"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/index5_huc69773c1cc30429ec167298f8192f5a8_78720_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/index5_huc69773c1cc30429ec167298f8192f5a8_78720_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="5"
class="gallery-image"
data-flex-grow="745"
data-flex-basis="1789px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Facello&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- æ›´æ¢ç´¢å¼•é¡ºåº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(first_name, last_name)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/index6.png"
width="1144"
height="179"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/index6_huc94bdeb83f55eebd5e2d4f615313b023_79724_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/index6_huc94bdeb83f55eebd5e2d4f615313b023_79724_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6"
class="gallery-image"
data-flex-grow="639"
data-flex-basis="1533px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">last_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- index(first_name, last_name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- MySQL çš„å¼•æ“Žä¸ºæ›´å¥½åˆ©ç”¨å¤åˆç´¢å¼•ï¼Œä¼šåŠ¨æ€è°ƒæ•´å­—æ®µé¡ºåº
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-null-æ¡ä»¶æŸ¥è¯¢">âš ï¸ null æ¡ä»¶æŸ¥è¯¢&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>å•åˆ—ç´¢å¼•æ— æ³•å­˜å‚¨ null å€¼ï¼Œå¤åˆç´¢å¼•æ— æ³•å­˜å‚¨å…¨ä¸º null çš„å€¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŸ¥è¯¢æ—¶ï¼Œé‡‡ç”¨ &lt;code>is null&lt;/code> &lt;code>is not null&lt;/code> æ¡ä»¶ï¼Œæ ¹æ®è¡¨ä¸­çš„æ•°æ®åˆ†å¸ƒï¼ŒMySQL åˆ¤æ–­æ˜¯å¦èµ°ç´¢å¼•ï¼Œå¹¶ä¸å›ºå®š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MySQL å®˜æ–¹å»ºè®®å°½é‡æŠŠå­—æ®µå®šä¹‰ä¸º &lt;code>NOT NULL&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mysql/index/index7.png"
width="821"
height="497"
srcset="https://emerywan.github.io/blog/blog/p/mysql/index/index7_hu4d7b4705c5cf93f7dc141b75d9f23067_225180_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mysql/index/index7_hu4d7b4705c5cf93f7dc141b75d9f23067_225180_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="7"
class="gallery-image"
data-flex-grow="165"
data-flex-basis="396px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mobile&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">is&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-éšå¼è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ">âš ï¸ éšå¼è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">departments&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;100001&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- employees.emp_no dept_emp.emp_no ç±»åž‹ä¸ä¸€è‡´æ—¶ä¼šå¯¼è‡´éšå¼è½¬æ¢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- dept_emp de departments.dept_no ç±»åž‹ä¸ä¸€è‡´æ—¶ä¼šå¯¼è‡´éšå¼è½¬æ¢
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-mysql-è¯„ä¼°">âš ï¸ MySQL è¯„ä¼°&lt;/h3>
&lt;p>MySQL åœ¨æŸ¥è¯¢æ—¶ï¼Œä¼šè¯„ä¼°ä½¿ç”¨ç´¢å¼•çš„æ•ˆçŽ‡ä¸Žèµ°å…¨è¡¨æ‰«æçš„æ•ˆçŽ‡ï¼Œå¦‚æžœèµ°å…¨è¡¨æ‰«ææ›´å¿«ï¼Œåˆ™æ”¾å¼ƒ
ç´¢å¼•ï¼Œèµ°å…¨è¡¨æ‰«æã€‚&lt;/p>
&lt;p>å› ä¸ºç´¢å¼•æ˜¯ç”¨æ¥ç´¢å¼•å°‘é‡æ•°æ®çš„ï¼Œå¦‚æžœé€šè¿‡ç´¢å¼•æŸ¥è¯¢è¿”å›žå¤§æ‰¹é‡çš„æ•°æ®ï¼Œåˆ™è¿˜ä¸
å¦‚èµ°å…¨è¡¨æ‰«ææ¥çš„å¿«ï¼Œæ­¤æ—¶ç´¢å¼•å°±ä¼šå¤±æ•ˆã€‚&lt;/p>
&lt;h2 id="æœ€å·¦å‰ç¼€æ³•åˆ™">æœ€å·¦å‰ç¼€æ³•åˆ™&lt;/h2>
&lt;p>æœ€å·¦å‰ç¼€æ³•åˆ™æŒ‡çš„æ˜¯æŸ¥è¯¢ä»Žç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚&lt;/p>
&lt;p>å¦‚æžœè·³è·ƒæŸä¸€åˆ—ï¼Œç´¢å¼•å°†ä¼šéƒ¨åˆ†å¤±æ•ˆ(åŽé¢çš„å­—æ®µç´¢å¼•å¤±æ•ˆ)ã€‚&lt;/p>
&lt;p>ä¸­é—´ä¸èƒ½è·³è¿‡æŸä¸€åˆ—ï¼Œå¦åˆ™è¯¥åˆ—åŽé¢çš„å­—æ®µç´¢å¼•å°†å¤±æ•ˆã€‚&lt;/p>
&lt;h2 id="èŒƒå›´æŸ¥è¯¢">èŒƒå›´æŸ¥è¯¢&lt;/h2>
&lt;p>è”åˆç´¢å¼•ä¸­ï¼Œå‡ºçŽ°èŒƒå›´æŸ¥è¯¢(&amp;gt;, &amp;lt;)ï¼ŒèŒƒå›´æŸ¥è¯¢å³ä¾§çš„åˆ—ç´¢å¼•å¤±æ•ˆã€‚&lt;/p>
&lt;h2 id="è¦†ç›–ç´¢å¼•">è¦†ç›–ç´¢å¼•&lt;/h2>
&lt;p>å¯¹äºŽç´¢å¼• Xï¼Œ&lt;code>SELECT&lt;/code> çš„å­—æ®µåªéœ€è¦ä»Žç´¢å¼•ä¸­å°±èƒ½èŽ·å¾—ï¼Œè€Œæ— éœ€å›žè¡¨èŽ·å–ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(name, age, pos)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pos&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">staffs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;July&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‰ç¼€ç´¢å¼•">å‰ç¼€ç´¢å¼•&lt;/h2>
&lt;p>å½“å­—æ®µç±»åž‹ä¸ºå­—ç¬¦ä¸²ï¼ˆvarcharï¼Œtextï¼Œlongtextç­‰ï¼‰æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¼šè®©
ç´¢å¼•å˜å¾—å¾ˆå¤§ï¼ŒæŸ¥è¯¢æ—¶ï¼Œæµªè´¹å¤§é‡çš„ç£ç›˜ IOï¼Œ å½±å“æŸ¥è¯¢æ•ˆçŽ‡ã€‚&lt;/p>
&lt;p>å¯ä»¥åªå°†å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å‰ç¼€ï¼Œå»ºç«‹ç´¢å¼•ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§èŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œä»Žè€Œæé«˜ç´¢å¼•æ•ˆçŽ‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- ä¸º email å­—æ®µï¼Œå»ºç«‹ç´¢å¼•é•¿åº¦ä¸º 5 çš„å‰ç¼€ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index_email_5&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="explain">explain&lt;/h2>
&lt;p>æŸ¥çœ‹ SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€‚å­—æ®µå«ä¹‰ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>id&lt;/p>
&lt;ul>
&lt;li>æŸ¥è¯¢ä¸­æ‰§è¡Œ select å­å¥æˆ–è€…æ˜¯æ“ä½œè¡¨çš„é¡ºåº&lt;/li>
&lt;li>id ç›¸åŒï¼Œæ‰§è¡Œé¡ºåºä»Žä¸Šåˆ°ä¸‹ï¼›id ä¸åŒï¼Œå€¼è¶Šå¤§ï¼Œè¶Šå…ˆæ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>select_type&lt;/p>
&lt;ul>
&lt;li>è¡¨ç¤º select çš„ç±»åž‹&lt;/li>
&lt;li>SIMPLE (ç®€å• select,ä¸ä½¿ç”¨ union æˆ–å­æŸ¥è¯¢ç­‰)&lt;/li>
&lt;li>PRIMARY (æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†,æœ€å¤–å±‚çš„ select è¢«æ ‡è®°ä¸º PRIMARY)&lt;/li>
&lt;li>UNION (union ä¸­çš„ç¬¬äºŒä¸ªæˆ–åŽé¢çš„ select è¯­å¥)&lt;/li>
&lt;li>SUBQUERY (å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª select)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>table&lt;/p>
&lt;ul>
&lt;li>è¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºŽå“ªå¼ è¡¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>type&lt;/p>
&lt;ul>
&lt;li>MySQLåœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼&lt;/li>
&lt;li>æ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿žæŽ¥ç±»åž‹ä¸ºï¼šNULLã€systemã€constã€eq_refã€refã€rangeã€indexã€all&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>possible_keys&lt;/p>
&lt;ul>
&lt;li>å¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸Šçš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ª&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>key
-å®žé™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æžœä¸º NULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>key_len&lt;/p>
&lt;ul>
&lt;li>è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œè¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éžå®žé™…ä½¿ç”¨é•¿åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ref&lt;/p>
&lt;ul>
&lt;li>ä¸Šè¿°è¡¨çš„è¿žæŽ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºŽæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>rows&lt;/p>
&lt;ul>
&lt;li>MySQL è®¤ä¸ºå¿…é¡»è¦æ‰§è¡ŒæŸ¥è¯¢çš„è¡Œæ•°ï¼Œåœ¨ innodb å¼•æ“Žçš„è¡¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œå¯èƒ½å¹¶ä¸æ€»æ˜¯å‡†ç¡®çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Extra&lt;/p>
&lt;ul>
&lt;li>MySQLè§£å†³æŸ¥è¯¢çš„è¯¦ç»†ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://juejin.cn/post/6936032090546765837" target="_blank" rel="noopener"
>https://juejin.cn/post/6936032090546765837&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Linux ç›®å½•ç»“æž„ä»‹ç»</title><link>https://emerywan.github.io/blog/p/linux-dir/</link><pubDate>Thu, 23 Jun 2022 02:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/linux-dir/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/10.jpeg" alt="Featured image of post Linux ç›®å½•ç»“æž„ä»‹ç»" />&lt;p>Linux æ˜¯ä¸€ä¸ªå¼€æºçš„ç³»ç»Ÿï¼Œä½¿å¾— Linux å‘è¡Œç‰ˆæœ¬æœ‰å¾ˆå¤šï¼Œåˆ©ç”¨ Linux å¼€å‘äº§å“çš„å›¢é˜Ÿä¹Ÿæœ‰å¾ˆå¤šï¼Œå¦‚æžœä»»ç”±æ¯ä¸ªäººéƒ½æŒ‰ç…§è‡ªå·±çš„æƒ³æ³•æ¥é…ç½® Linux ç³»ç»Ÿæ–‡ä»¶ç›®å½•ï¼ŒåŽæœŸå¯èƒ½ä¼šäº§ç”Ÿè¯¸å¤šçš„ç®¡ç†é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å…è¯¸å¤šä½¿ç”¨è€…å¯¹ Linux ç³»ç»Ÿç›®å½•ç»“æž„å¤©é©¬è¡Œç©ºï¼ŒLinux åŸºé‡‘ä¼šå‘å¸ƒäº† FHS æ ‡å‡†ã€‚å¤šæ•° Linux å‘è¡Œç‰ˆç³»ç»Ÿéƒ½éµå¾ªè¿™ä¸€æ ‡å‡†ã€‚&lt;/p>
&lt;blockquote>
&lt;p>FHSï¼ˆFilesystem Hierarchy Standardï¼‰ï¼Œæ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡åŒ–æ ‡å‡†ï¼Œè¯¥æ ‡å‡†è§„å®šäº† Linux ç³»ç»Ÿä¸­æ‰€æœ‰ä¸€çº§ç›®å½•ä»¥åŠéƒ¨åˆ†äºŒçº§ç›®å½•ï¼ˆ/usr å’Œ /varï¼‰çš„ç”¨é€”ã€‚å‘å¸ƒæ­¤æ ‡å‡†çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†è®©ç”¨æˆ·æ¸…æ¥šåœ°äº†è§£æ¯ä¸ªç›®å½•åº”è¯¥å­˜æ”¾ä»€ä¹ˆç±»åž‹çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å‡ ä¹Žæ‰€æœ‰çš„ Linux å‘è¡Œç‰ˆéƒ½åŒ…å«ä»¥ä¸‹çš„ç›®å½•ç»“æž„ï¼š&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/directory.png"
width="950"
height="450"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/directory_hua98ec03a363a3999681794ab96f9f09a_36725_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/directory_hua98ec03a363a3999681794ab96f9f09a_36725_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="directory"
class="gallery-image"
data-flex-grow="211"
data-flex-basis="506px"
>&lt;/p>
&lt;p>ä¸åŒçš„å‘è¡Œç‰ˆå¯èƒ½ä¼šæ·»åŠ ä¸€ä¸‹ç‹¬æœ‰çš„ç›®å½•ï¼Œä¾‹å¦‚ Ubuntu ä¸­åŒ…å« &lt;code>/snap&lt;/code> æ¥æ”¾ç½® snap åº”ç”¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/root.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/root_hu18035549831c69e974e5e46a3403bc3f_73150_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/root_hu18035549831c69e974e5e46a3403bc3f_73150_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="root"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="bin">/bin&lt;/h2>
&lt;p>Binary&lt;/p>
&lt;p>äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶çš„å¿«æ·æ–¹å¼ï¼ˆè½¯é“¾æŽ¥ï¼‰ï¼Œå­˜æ”¾ç€å¸¸ç”¨çš„å‘½ä»¤ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚å¸¸ç”¨çš„ &lt;code>ls&lt;/code> &lt;code>cp&lt;/code> &lt;code>cd&lt;/code> ç­‰å‘½ä»¤éƒ½å­˜æ”¾åœ¨è¿™é‡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/bin.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/bin_hu88e8cbe9114805e25899e6212c3f7b45_50694_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/bin_hu88e8cbe9114805e25899e6212c3f7b45_50694_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="bin"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="boot">/boot&lt;/h2>
&lt;p>å¯åŠ¨ Linux æ—¶ä½¿ç”¨çš„ä¸€äº›æ ¸å¿ƒæ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€äº›è¿žæŽ¥æ–‡ä»¶ä»¥åŠé•œåƒæ–‡ä»¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/boot.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/boot_hu918783384ee5a012af8445662a5570f5_99689_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/boot_hu918783384ee5a012af8445662a5570f5_99689_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="boot"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;p>å¦‚æžœæ˜¯ä»¥ UEFI æ–¹å¼å®‰è£…çš„ç³»ç»Ÿï¼Œå…¶ä¸­ &lt;code>efi&lt;/code> æ–‡ä»¶å¤¹ä¸­çš„ä¸º &lt;code>EFI&lt;/code> åˆ†åŒºä¸­çš„å¼•å¯¼ã€‚&lt;/p>
&lt;h2 id="dev">/dev&lt;/h2>
&lt;p>Device&lt;/p>
&lt;p>å­˜æ”¾ç€æ‰€æœ‰çš„è®¾å¤‡æ–‡ä»¶ã€‚åœ¨ Linux ä¸­ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨çš„ï¼ŒåŒ…æ‹¬ç¡¬ä»¶è®¾å¤‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/dev.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/dev_hu5755a852922f274414d0e5a0eab070dd_98725_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/dev_hu5755a852922f274414d0e5a0eab070dd_98725_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="dev"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="etc">/etc&lt;/h2>
&lt;p>Etcetera&lt;/p>
&lt;p>å­˜æ”¾ç¨‹åºçš„é…ç½®ä¿¡æ¯ï¼Œå¤§å¤šæ•°å®‰è£…çš„åº”ç”¨é…ç½®ä¿¡æ¯éƒ½ä¼šåœ¨è¿™é‡Œã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>/etc/apt&lt;/code> apt æºé…ç½®ç›®å½•&lt;/li>
&lt;li>&lt;code>/ect/vim&lt;/code> vim é…ç½®ç›®å½•&lt;/li>
&lt;li>&lt;code>/etc/nginx&lt;/code> nginx é…ç½®ç›®å½•&lt;/li>
&lt;li>&lt;code>/ect/redis&lt;/code> redis é…ç½®ç›®å½•&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/etc.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/etc_hu7a52980e1c04af5a90bf8edab9585ec6_85844_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/etc_hu7a52980e1c04af5a90bf8edab9585ec6_85844_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="etc"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="home">/home&lt;/h2>
&lt;p>ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚&lt;/p>
&lt;p>åœ¨ Linux ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç›®å½•ï¼Œä¸€èˆ¬è¯¥ç›®å½•åæ˜¯ä»¥ç”¨æˆ·çš„è´¦å·å‘½åã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/home.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/home_hud18e334789b3c740b9a20da6a45ce695_61060_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/home_hud18e334789b3c740b9a20da6a45ce695_61060_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="home"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="lib">/lib&lt;/h2>
&lt;p>Library&lt;/p>
&lt;p>ç³»ç»Ÿæœ€åŸºæœ¬çš„åŠ¨æ€è¿žæŽ¥å…±äº«åº“ï¼Œå…¶ä½œç”¨ç±»ä¼¼äºŽ Windows é‡Œçš„ DLL æ–‡ä»¶ã€‚&lt;/p>
&lt;p>å‡ ä¹Žæ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½éœ€è¦ç”¨åˆ°è¿™äº›å…±äº«åº“ã€‚åŒ…å« bin å’Œ sbin ä¸­å¯æ‰§è¡Œæ–‡ä»¶çš„ä¾èµ–ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/lib.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/lib_hub083733446fb3cb4ae55f28313c8182b_83036_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/lib_hub083733446fb3cb4ae55f28313c8182b_83036_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lib"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="media">/media&lt;/h2>
&lt;p>è‡ªåŠ¨æŒ‚è½½çš„è®¾å¤‡ï¼Œæ¯”å¦‚ U ç›˜ï¼Œç§»åŠ¨ç¡¬ç›˜ï¼Œç½‘ç»œè®¾å¤‡ç­‰çš„ç›®å½•ã€‚&lt;/p>
&lt;p>æ¯”å¦‚çŽ°åœ¨æœ‰ä¸€ä¸ª U ç›˜ï¼Œæ’åˆ°ç”µè„‘ä¸Šä¹‹åŽï¼Œç³»ç»Ÿä¼šæŠŠ U ç›˜è‡ªåŠ¨æŒ‚è½½åˆ° &lt;code>/media/$USER&lt;/code> æ–‡ä»¶å¤¹ä¸­ã€‚&lt;/p>
&lt;h2 id="mnt">/mnt&lt;/h2>
&lt;p>æä¾›ç»™ç”¨æˆ·ä¸´æ—¶æ‰‹åŠ¨æŒ‚è½½è®¾å¤‡æ–‡ä»¶å¤¹ï¼Œä¸€èˆ¬æ˜¯ç©ºæ–‡ä»¶å¤¹ã€‚&lt;/p>
&lt;p>æ¯”å¦‚çŽ°åœ¨è¦æ‰‹åŠ¨æŒ‚è½½ä¸€ä¸ªç¡¬ç›˜ï¼Œå¯ç”¨å¦‚ä¸‹æŒ‚è½½åˆ° &lt;code>/mnt&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mount /dev/sdb1 /mnt/disk
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="opt">/opt&lt;/h2>
&lt;p>Optional&lt;/p>
&lt;p>ä¸€äº›ç¬¬ä¸‰æ–¹è½¯ä»¶å®‰è£…çš„ç›®å½•ã€‚&lt;/p>
&lt;p>æ¯”å¦‚ Chrome æµè§ˆå™¨ï¼ŒWPS ç­‰è½¯ä»¶ï¼Œéƒ½ä¼šå®‰è£…åœ¨è¿™é‡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/opt.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/opt_huea96cc753b9c5430ebdf81edcd8754fb_76369_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/opt_huea96cc753b9c5430ebdf81edcd8754fb_76369_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="opt"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="root">/root&lt;/h2>
&lt;p>è¿™æ˜¯ root ç”¨æˆ·çš„å®¶ç›®å½•ã€‚&lt;/p>
&lt;h2 id="proc">/proc&lt;/h2>
&lt;p>Processes&lt;/p>
&lt;p>&lt;code>/proc&lt;/code> æ˜¯ä¸€ç§ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼ˆä¹Ÿå³è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå­˜å‚¨çš„æ˜¯å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œè¿™ä¸ªç›®å½•æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ç›®å½•ï¼Œå®ƒæ˜¯ç³»ç»Ÿå†…å­˜çš„æ˜ å°„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æŽ¥è®¿é—®è¿™ä¸ªç›®å½•æ¥èŽ·å–ç³»ç»Ÿä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/procversion.png"
width="734"
height="476"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/procversion_hua30e25cc62b3a6421f2f9b1383e8ea4d_32573_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/procversion_hua30e25cc62b3a6421f2f9b1383e8ea4d_32573_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="procversion"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="370px"
>&lt;/p>
&lt;p>&lt;code>/proc&lt;/code> é‡Œé¢æœ‰ä¸€å¤§å †æ•°å­—å‘½åçš„æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ•°å­—å…¶å®žæ˜¯ Process IDï¼ˆPIDï¼‰ï¼Œå¯¹åº”ç€è¿è¡Œçš„æœåŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/procps.png"
width="734"
height="476"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/procps_hu3633a821f850bd2d5d2ffca1ae08eb64_38818_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/procps_hu3633a821f850bd2d5d2ffca1ae08eb64_38818_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="procps"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="370px"
>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/proccat.png"
width="734"
height="476"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/proccat_hu433bb9e8c82cee4321d94d03495747e7_47919_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/proccat_hu433bb9e8c82cee4321d94d03495747e7_47919_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="proccat"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="370px"
>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/proc1929.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/proc1929_hue982c12fdacf4a0dd83c56ac9a4d5cac_81321_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/proc1929_hue982c12fdacf4a0dd83c56ac9a4d5cac_81321_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="proc1929"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="sbin">/sbin&lt;/h2>
&lt;p>Superuser Binaries&lt;/p>
&lt;p>è¿™é‡Œå­˜æ”¾çš„æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨çš„ç³»ç»Ÿç®¡ç†ç¨‹åºã€‚&lt;/p>
&lt;p>ä¾‹å¦‚å¸¸è§çš„ &lt;code>groupadd&lt;/code> &lt;code>groupdel&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/sbin.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/sbin_hufd2d26ea46f84ef22af6fb59ef9f4da6_85048_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/sbin_hufd2d26ea46f84ef22af6fb59ef9f4da6_85048_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="sbin"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="srv">/srv&lt;/h2>
&lt;p>Service&lt;/p>
&lt;p>ä¸»è¦ç”¨æ¥å­˜æ”¾æœåŠ¡æ•°æ®ã€‚å¯¹äºŽæ¡Œé¢ç‰ˆ Linux ç³»ç»Ÿï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ä¸€èˆ¬æ˜¯ç©ºçš„ï¼Œä½†æ˜¯å¯¹äºŽ Linux æœåŠ¡å™¨ï¼ŒWeb æœåŠ¡æˆ–è€… FTP æ–‡ä»¶æœåŠ¡çš„èµ„æºå¯ä»¥å­˜æ”¾åœ¨è¿™é‡Œã€‚&lt;/p>
&lt;h2 id="tmp">/tmp&lt;/h2>
&lt;p>Temporary&lt;/p>
&lt;p>å­˜å‚¨ä¸€äº›ç¨‹åºçš„ä¸´æ—¶æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä¸´æ—¶æ–‡ä»¶å¯èƒ½èµ·åˆ°å¾ˆé‡è¦çš„ä½œç”¨ã€‚æ¯”å¦‚æœ‰æ—¶å€™ Word æ–‡æ¡£å´©æºƒäº†ï¼Œå¥½ä¸å®¹æ˜“å†™çš„ä¸œè¥¿å…¨æ²¡äº†ï¼ŒLinux çš„å¾ˆå¤šæ–‡æœ¬ç¼–è¾‘å™¨éƒ½ä¼šåœ¨ &lt;code>/tmp&lt;/code> æ”¾ä¸€ä»½å½“å‰æ–‡æœ¬çš„ copy ä½œä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚æžœä½ çš„ç¼–è¾‘å™¨æ„å¤–å´©æºƒï¼Œæœ‰æœºä¼šåœ¨ &lt;code>/tmp&lt;/code> æ‰¾ä¸€æ‰¾ä¸´æ—¶æ–‡ä»¶æŠ¢æ•‘ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/tmp.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/tmp_hu1b50e9a39b2feae689bf9b3fbfb30a17_96039_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/tmp_hu1b50e9a39b2feae689bf9b3fbfb30a17_96039_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="tmp"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="usr">/usr&lt;/h2>
&lt;p>Unix Shared Resources&lt;/p>
&lt;p>å…±äº«èµ„æºï¼Œè¿™æ˜¯ä¸€ä¸ªéžå¸¸é‡è¦çš„ç›®å½•ï¼Œç”¨æˆ·çš„å¾ˆå¤šåº”ç”¨ç¨‹åºå’Œæ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œç±»ä¼¼äºŽ windows ä¸‹çš„ program files ç›®å½•ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/usr.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/usr_hu2204c3c3a7c106aec9dea68c29029999_46168_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/usr_hu2204c3c3a7c106aec9dea68c29029999_46168_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="usr"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h3 id="usrbin---usrsbin">/usr/bin /usr/sbin&lt;/h3>
&lt;p>ç³»ç»Ÿç”¨æˆ· / è¶…çº§ç®¡ç†å‘˜ ä½¿ç”¨çš„åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;p>åœ¨ Ubuntu ä¸­ï¼Œ&lt;code>/bin&lt;/code> &lt;code>/sbin&lt;/code> å…¶å®žå°±æ˜¯ &lt;code>/usr/bin&lt;/code> &lt;code>/usr/sbin&lt;/code> çš„ä¸€ä¸ªé“¾æŽ¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/usrbin.png"
width="734"
height="476"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/usrbin_hu6a478b7090e2cf503d0d2abd86c3db3e_22476_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/usrbin_hu6a478b7090e2cf503d0d2abd86c3db3e_22476_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="usrbin"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="370px"
>&lt;/p>
&lt;h3 id="usrsrc">/usr/src&lt;/h3>
&lt;p>å†…æ ¸æºä»£ç é»˜è®¤çš„æ”¾ç½®ç›®å½•ã€‚&lt;/p>
&lt;h3 id="usrlib">/usr/lib&lt;/h3>
&lt;p>åŒ…å«æ‰€æœ‰é‚£äº›ç”¨æˆ·ä¸èƒ½ç›´æŽ¥æ‰§è¡Œçš„åº“æ–‡ä»¶ã€‚åŒ…å«ç€æ‰€æœ‰ &amp;lsquo;/usr/bin&amp;rsquo; å’Œ &amp;lsquo;/usr/sbin&amp;rsquo; ç›®å½•ä¸­å¯æ‰§è¡Œå‘½ä»¤ç¨‹åºéœ€è°ƒç”¨çš„äºŒè¿›åˆ¶åº“æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ä½¿ç”¨ &lt;code>apt&lt;/code> å®‰è£… openjdk çš„ç›®å½•åœ¨ &lt;code>/usr/lib/jvm&lt;/code>ã€‚&lt;/p>
&lt;h3 id="usrshare">/usr/share&lt;/h3>
&lt;p>åŒ…å«ç‹¬ç«‹äºŽæž¶æž„çš„å…±äº«æ•°æ®ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ç³»ç»Ÿæ¡Œé¢å›¾æ ‡ç›®å½• &lt;code>/user/share/applications&lt;/code>ã€‚&lt;/p>
&lt;h3 id="usrlocal">/usr/local&lt;/h3>
&lt;p>ç”¨äºŽæœ¬åœ°å®‰è£…è½¯ä»¶çš„ç›®æ ‡ç›®å½•ã€‚ä»Žæºä»£ç å®‰è£…çš„ç”¨æˆ·ç¨‹åºéƒ½å°†å®‰è£…åˆ°è¿™é‡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/usrlocal.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/usrlocal_hu79bfa6340b43e74ca17a031487cf8d3c_78872_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/usrlocal_hu79bfa6340b43e74ca17a031487cf8d3c_78872_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="usrlocal"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="var">/var&lt;/h2>
&lt;p>Variable&lt;/p>
&lt;p>å­˜æ”¾ç€åœ¨ä¸æ–­æ‰©å……ç€çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬ä¹ æƒ¯å°†é‚£äº›ç»å¸¸è¢«ä¿®æ”¹çš„ç›®å½•æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚æ—¥å¿—æ–‡ä»¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/linux-dir/var.png"
width="893"
height="485"
srcset="https://emerywan.github.io/blog/blog/p/linux-dir/var_hu71c741f1b1910044aff61d309cf9c7cd_50789_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/linux-dir/var_hu71c741f1b1910044aff61d309cf9c7cd_50789_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="var"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://segmentfault.com/a/1190000038497705" target="_blank" rel="noopener"
>https://segmentfault.com/a/1190000038497705&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.runoob.com/linux/linux-system-contents.html" target="_blank" rel="noopener"
>https://www.runoob.com/linux/linux-system-contents.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ä½¿ç”¨ Github Actions åœ¨è…¾è®¯äº‘ CloudBase éƒ¨ç½² Hugo</title><link>https://emerywan.github.io/blog/p/hugo-in-cloudbase/</link><pubDate>Wed, 22 Jun 2022 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/hugo-in-cloudbase/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/3.jpeg" alt="Featured image of post ä½¿ç”¨ Github Actions åœ¨è…¾è®¯äº‘ CloudBase éƒ¨ç½² Hugo" />&lt;h2 id="-ä»‹ç»">ðŸŒ± ä»‹ç»&lt;/h2>
&lt;p>è®¸å¤šå¹³å°éƒ½æä¾›äº†å…è´¹çš„é™æ€é¡µé¢æ‰˜ç®¡çš„æœåŠ¡ï¼Œå¦‚ &lt;code>Github Pages&lt;/code>ï¼Œ&lt;code>Vercel&lt;/code>ï¼Œ&lt;code>Netlify&lt;/code>ç­‰ã€‚ä½†åœ¨å›½å†…ç”±äºŽä¸€äº›â€œåŽŸå› â€ï¼Œè¿™äº›å›½å¤–çš„æœåŠ¡åœ¨å›½å†…çš„è®¿é—®å¹¶ä¸ç¨³å®šã€‚&lt;/p>
&lt;p>å›½å†…çš„å…è´¹æ‰˜ç®¡å¹³å°å¦‚ &lt;code>Gitee&lt;/code> é™åˆ¶å¾ˆå¤šï¼Œä¸å¯ä»¥è‡ªå®šä¹‰åŸŸåè€Œä¸”ä¹‹å‰å‡ºçŽ°äº†é˜²ç›—é“¾é—®é¢˜ï¼Œè®¿é—®ä¹Ÿä¸æ˜¯å¾ˆå¿«ï¼Œä¸å¤ªæŽ¨èä½œä¸ºæ‰˜ç®¡å¹³å°ã€‚&lt;/p>
&lt;p>è…¾è®¯äº‘æŽ¨å‡ºçš„äº‘å¼€å‘ &lt;code>CloudBase&lt;/code> ä¹Ÿæœ‰é™æ€é¡µé¢æ‰˜ç®¡æœåŠ¡ã€‚å…¶å®žå®ƒç›¸æ¯”è¿™äº›é™æ€æ‰˜ç®¡å¹³å°ï¼Œæœ‰æ›´å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œç”šè‡³èƒ½å¤Ÿæ­ä¸€æ•´å¥—ç³»ç»Ÿã€‚è™½ç„¶æ˜¯ä»˜è´¹æœåŠ¡ï¼Œä½†æ˜¯åœ¨æŒ‰é‡ä»˜è´¹çš„æƒ…å†µä¸‹èµ„è´¹ä¸æ˜¯å¾ˆé«˜ï¼Œåœ¨åšå®¢è®¿é—®é‡ä¸æ˜¯å¾ˆé«˜çš„æƒ…å†µä¸‹ååˆ†åˆé€‚ã€‚&lt;/p>
&lt;p>ç›®å‰åœ¨è…¾è®¯äº‘ä¸­æš‚æ—¶è¿˜æ²¡æœ‰ &lt;code>Hugo&lt;/code> çš„æ¨¡æ¿ã€‚ç›®å‰æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è¾¾åˆ°è‡ªåŠ¨éƒ¨ç½²çš„åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ° ä½¿ç”¨ &lt;code>Github Actions&lt;/code> ç¼–è¯‘ï¼Œé€šè¿‡ &lt;code>Tencent CloudBase Github Action&lt;/code> è‡ªåŠ¨éƒ¨ç½²åˆ° &lt;code>CloudBase&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ° ä½¿ç”¨ &lt;code>Github Actions&lt;/code> ç¼–è¯‘ï¼ŒæŽ¨é€åˆ° &lt;code>Web åº”ç”¨æ‰˜ç®¡ï¼ˆwebifyï¼‰&lt;/code> çš„ç®€æ˜“é™æ€é¡µé¢æ¨¡æ¿ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ä½¿ç”¨-cloudbase">ðŸ– ä½¿ç”¨ CloudBase&lt;/h2>
&lt;p>&lt;strong>ä½¿ç”¨ CloudBse æ—¶ï¼Œä½¿ç”¨æŒ‰é‡è®¡è´¹çŽ¯å¢ƒä¼šæœ‰ä¸€äº›å…è´¹ç”¨é‡ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="-è…¾è®¯äº‘">â˜ï¸ è…¾è®¯äº‘&lt;/h3>
&lt;h4 id="åˆ›å»ºçŽ¯å¢ƒ">åˆ›å»ºçŽ¯å¢ƒ&lt;/h4>
&lt;p>åœ¨ &lt;code>äº‘å¼€å‘ CloudBase&lt;/code> æ–°å»ºä¸€ä¸ªåº”ç”¨ï¼Œé€‰æ‹© &lt;strong>ç©ºæ¨¡æ¿&lt;/strong>ï¼Œæ ¹æ®è‡ªèº«éœ€æ±‚å¡«å†™ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/new.png"
width="1896"
height="1608"
srcset="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/new_hu99910b72135936b76933bc6c60d2f8a9_394958_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/new_hu99910b72135936b76933bc6c60d2f8a9_394958_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="new"
class="gallery-image"
data-flex-grow="117"
data-flex-basis="282px"
>&lt;/p>
&lt;p>åˆ›å»ºæˆåŠŸåŽï¼ŒèŽ·å¾— &lt;code>çŽ¯å¢ƒID&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/env_id.png"
width="796"
height="406"
srcset="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/env_id_hucc29efc322e6de70f5fc042978c8e74b_42486_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/env_id_hucc29efc322e6de70f5fc042978c8e74b_42486_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="env_id"
class="gallery-image"
data-flex-grow="196"
data-flex-basis="470px"
>&lt;/p>
&lt;h4 id="èŽ·å–-api-å¯†é’¥">èŽ·å– API å¯†é’¥&lt;/h4>
&lt;p>ä¸ºéƒ¨ç½²æ–°å»ºä¸€ä¸ªå¯†é’¥å¯¹ã€‚åœ¨ &lt;code>è®¿é—®ç®¡ç† -&amp;gt; ç”¨æˆ·åˆ—è¡¨ -&amp;gt; æ–°å»ºç”¨æˆ· -&amp;gt; è‡ªå®šä¹‰åˆ›å»º -&amp;gt; å¯è®¿é—®èµ„æºå¹¶æŽ¥æ”¶æ¶ˆæ¯&lt;/code>ã€‚&lt;a class="link" href="https://console.cloud.tencent.com/cam" target="_blank" rel="noopener"
>ðŸ”— ä¼ é€é—¨&lt;/a>&lt;/p>
&lt;p>æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæ–°å»ºç”¨æˆ·ååŽé€‰æ‹© &lt;code>ç¼–ç¨‹è®¿é—®&lt;/code>ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/new_user.png"
width="2122"
height="1158"
srcset="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/new_user_hu5db7ae8d8e85e220ba3039161cacacd8_188871_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/new_user_hu5db7ae8d8e85e220ba3039161cacacd8_188871_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="new_user"
class="gallery-image"
data-flex-grow="183"
data-flex-basis="439px"
>&lt;/p>
&lt;p>åœ¨è‡ªå®šä¹‰ç­–ç•¥ä¸­å‹¾é€‰ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>QcloudAccessForTCBRole&lt;/code>ï¼šæŽˆäºˆäº‘å¼€å‘ï¼ˆTCBï¼‰å¯¹äº‘èµ„æºçš„è®¿é—®æƒé™ï¼›&lt;/li>
&lt;li>&lt;code>QcloudAccessForTCBRoleInAccessCloudBaseRun&lt;/code>ï¼šä¾›äº‘å¼€å‘ï¼ˆTCBï¼‰æœåŠ¡è§’è‰²ï¼ˆTCB_QcsRoleï¼‰è¿›è¡Œå…³è”ï¼Œç”¨äºŽ TCB è®¿é—®å…¶ä»–äº‘æœåŠ¡èµ„æºã€‚åŒ…å«ç§æœ‰ç½‘ç»œ VPCã€äº‘æœåŠ¡å™¨ CVM ç›¸å…³æ“ä½œæƒé™ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/access.png"
width="2048"
height="626"
srcset="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/access_hu76f892695bd748244f5434357abaf2d0_122725_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/access_hu76f892695bd748244f5434357abaf2d0_122725_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="access"
class="gallery-image"
data-flex-grow="327"
data-flex-basis="785px"
>&lt;/p>
&lt;p>ç‚¹ä¸€ä¸‹ä¸€æ­¥åŽï¼Œæ–°å»ºç”¨æˆ·æˆåŠŸã€‚å¯ä»¥èŽ·å¾— &lt;code>SecretId&lt;/code> å’Œ &lt;code>SecretKey&lt;/code>ã€‚&lt;/p>
&lt;h3 id="-github-actions">âš™ï¸ Github Actions&lt;/h3>
&lt;h4 id="è®¾ç½®-github-secrets">è®¾ç½® Github Secrets&lt;/h4>
&lt;p>åœ¨é¡¹ç›®çš„ &lt;code>Settings -&amp;gt; Secrets -&amp;gt; Actions&lt;/code> ä¸­æ·»åŠ ä¸Šè¿°å¾—åˆ°çš„ &lt;code>ENV_ID&lt;/code>ï¼Œ&lt;code>SECRET_ID&lt;/code>ï¼Œ&lt;code>SECRET_KEY&lt;/code>ï¼ˆåç§°å¯ä»¥è‡ªå®šä¹‰ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/secret.png"
width="1616"
height="366"
srcset="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/secret_hu55ad514f0e88b8a75da2092c1dc5a21a_68162_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/secret_hu55ad514f0e88b8a75da2092c1dc5a21a_68162_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="secret"
class="gallery-image"
data-flex-grow="441"
data-flex-basis="1059px"
>&lt;/p>
&lt;h4 id="æ·»åŠ -workflows">æ·»åŠ  workflows&lt;/h4>
&lt;p>å¯ä»¥åœ¨ä»“åº“çš„ &lt;code>Actions&lt;/code> ä¸­ &lt;code>new workflow&lt;/code>ï¼Œæˆ–è€…åœ¨é¡¹ç›®ä¸­ &lt;code>.github/workflows&lt;/code> æ·»åŠ ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Tencent CloudBase&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">push&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">branches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-publish&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">publish content to static website&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Checkout&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/checkout@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">submodules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-depth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Setup Hugo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-hugo@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">extended&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Build&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hugo --minify --gc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># ä½¿ç”¨äº‘å¼€å‘ Github Action éƒ¨ç½²&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy to Tencent CloudBase&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TencentCloudBase/cloudbase-action@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">secretId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_SECRET_ID }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">secretKey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_SECRET_KEY }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">envId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_ENV_ID }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ðŸš§ æç¤ºï¼š&lt;/p>
&lt;p>è¿™é‡Œä½¿ç”¨äº† &lt;code>TencentCloudBase/cloudbase-action@v2&lt;/code>ï¼Œéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ  &lt;code>cloudbaserc.json&lt;/code>ã€‚&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;envId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;{{env.ENV_ID}}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// è¿™é‡Œéœ€è¦æ›´æ”¹ä¸ºä½ çš„ çŽ¯å¢ƒIDï¼Œæˆ–è€…åœ¨ .env æ–‡ä»¶ä¸­é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nt">&amp;#34;$schema&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://framework-1258016615.tcloudbaseapp.com/schema/latest.json&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;framework&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;hugo-blog&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;plugins&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;client&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;use&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;@cloudbase/framework-plugin-website&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;inputs&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outputPath&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;public&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ignore&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;.git&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;.github&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;cloudbaserc.js&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ðŸš§ æç¤ºï¼š&lt;/p>
&lt;p>è¿™é‡Œä¹Ÿå¯ä»¥é€‰æ‹© &lt;code> Tencent CloudBase Github Action V1&lt;/code>ã€‚ðŸ™‹â€â™‚ï¸ &lt;strong>ï¼ˆæŽ¨èï¼‰&lt;/strong>&lt;/p>
&lt;p>V2 æ¯” V1 æœ‰æ›´å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚æ‹‰å–ä»£ç åœ¨è…¾è®¯äº‘ç«¯ç¼–è¯‘ï¼Œä½†ç›®å‰æ²¡æœ‰ Hugo æ¨¡æ¿ã€‚æˆ‘ä»¬å·²ç»åœ¨ Github Actions äº§å‡ºäº†é™æ€æ–‡ä»¶ï¼Œç›´æŽ¥æŽ¨é€å³å¯ã€‚æ‰€ä»¥ç›®å‰å¯¹äºŽ hugo æ¥è¯´ï¼Œæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½¿ç”¨ç”šè‡³ V1 æ›´å¿«æ›´ç®€æ´ã€‚&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># å°†ä¸Šè¿° jobs å†…æ›¿æ¢ä¸º&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy to Tencent CloudBase&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TencentCloudBase/cloudbase-action@v1.1.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">secretId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_SECRET_ID }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">secretKey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_SECRET_KEY }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">envId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.QCLOUD_ENV_ID }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">staticSrcPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">public&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-ä½¿ç”¨-webify">ðŸ ä½¿ç”¨ webify&lt;/h2>
&lt;p>ä½¿ç”¨ Web åº”ç”¨æ‰˜ç®¡ï¼ˆwebifyï¼‰ä¸»è¦æ˜¯åˆ©ç”¨ &lt;code>Github Actions&lt;/code> ç”Ÿæˆ é™æ€é¡µé¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œå†æ‰˜ç®¡è¿™ä¸ªåˆ†æ”¯çš„å†…å®¹ã€‚&lt;/p>
&lt;h3 id="-åˆ›å»ºæœåŠ¡">â˜ï¸ åˆ›å»ºæœåŠ¡&lt;/h3>
&lt;p>åœ¨ &lt;code>Web åº”ç”¨æ‰˜ç®¡ -&amp;gt; æ–°å»ºåº”ç”¨&lt;/code> æ–°å»ºä¸€ä¸ªç®€æ˜“é™æ€é¡µé¢æ¨¡æ¿ã€‚æ ¹æ®éœ€æ±‚å¡«å†™ä¿¡æ¯ã€‚é€‰æ‹©çº¯é™æ€é¡µé¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/webify.png"
width="2530"
height="1256"
srcset="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/webify_hu211af589e3a728aa0fd91d8fdf6a5a77_643488_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/webify_hu211af589e3a728aa0fd91d8fdf6a5a77_643488_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="webify"
class="gallery-image"
data-flex-grow="201"
data-flex-basis="483px"
>&lt;/p>
&lt;p>åœ¨ &lt;code>åº”ç”¨åˆ—è¡¨ -&amp;gt; åº”ç”¨è®¾ç½®&lt;/code> ä¸­é…ç½®ä»“åº“ä¿¡æ¯ï¼Œå¹¶æ ¹æ®è‡ªèº«æƒ…å†µé€‰æ‹©é™æ€æ–‡ä»¶çš„éƒ¨ç½²åˆ†æ”¯ã€‚ï¼ˆå¦‚æžœå½“å‰æ²¡æœ‰ç”Ÿæˆé™æ€é¡µé¢çš„åˆ†æ”¯ï¼Œå¯å®ŒæˆåŽé¢æ“ä½œåŽå†è¿›è¡Œæ­¤æ­¥éª¤ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/webify_info.png"
width="1896"
height="1164"
srcset="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/webify_info_hufa1571ab4508131ee643c8a2551cf3ff_136359_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/webify_info_hufa1571ab4508131ee643c8a2551cf3ff_136359_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="webify_info"
class="gallery-image"
data-flex-grow="162"
data-flex-basis="390px"
>&lt;/p>
&lt;h3 id="-github-actions-1">âš™ï¸ Github Actions&lt;/h3>
&lt;h4 id="è®¾ç½®-github-token">è®¾ç½® Github Token&lt;/h4>
&lt;p>åœ¨ç”¨æˆ·çš„ &lt;code>Settings -&amp;gt; Developer settings -&amp;gt; Personal access tokens -&amp;gt; Generate new token&lt;/code> èŽ·å–ä¸€ä¸ª &lt;code>Repo Token&lt;/code>ã€‚&lt;a class="link" href="https://github.com/settings/tokens" target="_blank" rel="noopener"
>ðŸ”— ä¼ é€é—¨&lt;/a>&lt;/p>
&lt;p>åœ¨é¡¹ç›®çš„ &lt;code>Settings -&amp;gt; Secrets -&amp;gt; Actions&lt;/code> ä¸­æ·»åŠ ä¸Šè¿°å¾—åˆ°çš„ &lt;code>Token&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/access_token.png"
width="1600"
height="598"
srcset="https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/access_token_hu161bb7d01a4edfa7f2231ebb5df9a1e4_123158_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/hugo-in-cloudbase/access_token_hu161bb7d01a4edfa7f2231ebb5df9a1e4_123158_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="access_token"
class="gallery-image"
data-flex-grow="267"
data-flex-basis="642px"
>&lt;/p>
&lt;h4 id="æ·»åŠ -workflows-1">æ·»åŠ  workflows&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Tencent CloudBase&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">push&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">branches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-publish&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">publish content to static website&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Checkout&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/checkout@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">submodules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-depth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Setup Hugo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-hugo@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">extended&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Build&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hugo --minify --gc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy to Branch&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-gh-pages@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">github_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.ACCESS_TOKEN }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">keep_files&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">publish_branch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">gh-pages &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æ›´æ”¹ä¸ºä½ æƒ³è¦ç”Ÿæˆçš„åˆ†æ”¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">publich_dir&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">./public&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">commit_message&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ github.event.head_commit.message }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-å‚è€ƒ">â›“ å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>ðŸ”— &lt;a class="link" href="https://blog.wangjunfeng.com/post/hugo-cloudbase/" target="_blank" rel="noopener"
>https://blog.wangjunfeng.com/post/hugo-cloudbase/&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://cloud.tencent.com/document/product/1210/43389" target="_blank" rel="noopener"
>https://cloud.tencent.com/document/product/1210/43389&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://github.com/TencentCloudBase/cloudbase-action" target="_blank" rel="noopener"
>https://github.com/TencentCloudBase/cloudbase-action&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://github.com/TencentCloudBase/cloudbase-action/blob/3354b442713265aa9d7c5bf03b0b8cb0173f546f/README.md" target="_blank" rel="noopener"
>https://github.com/TencentCloudBase/cloudbase-action/blob/3354b442713265aa9d7c5bf03b0b8cb0173f546f/README.md&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ä½¿ç”¨ ZooKeeper å®žçŽ°åˆ†å¸ƒå¼é”</title><link>https://emerywan.github.io/blog/p/distributed-lock/zookeeper/</link><pubDate>Wed, 11 May 2022 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/distributed-lock/zookeeper/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/2.jpeg" alt="Featured image of post ä½¿ç”¨ ZooKeeper å®žçŽ°åˆ†å¸ƒå¼é”" />&lt;h2 id="ä½¿ç”¨-zookeeper-å®žçŽ°">ä½¿ç”¨ ZooKeeper å®žçŽ°&lt;/h2>
&lt;h3 id="åŽŸç†">åŽŸç†&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>æŒä¹…èŠ‚ç‚¹ï¼ˆçº¢è‰²ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>çž¬æ—¶èŠ‚ç‚¹ï¼ˆé»„è‰²ï¼‰ï¼šä¸å¯å†æœ‰å­èŠ‚ç‚¹ï¼Œä¼šè¯ç»“æŸåŽçž¬æ—¶èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ¶ˆå¤±&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/distributed-lock/zookeeper/node.png"
width="542"
height="618"
srcset="https://emerywan.github.io/blog/blog/p/distributed-lock/zookeeper/node_hubb94f897927986ed284f5e5898a8688d_78967_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/distributed-lock/zookeeper/node_hubb94f897927986ed284f5e5898a8688d_78967_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="node"
class="gallery-image"
data-flex-grow="87"
data-flex-basis="210px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åˆ©ç”¨ Zookeeper çš„çž¬æ—¶æœ‰åºèŠ‚ç‚¹çš„ç‰¹æ€§ï¼Œå¤šçº¿ç¨‹å¹¶å‘åˆ›å»ºçž¬æ—¶èŠ‚ç‚¹æ—¶ï¼Œå¾—åˆ°æœ‰åºçš„åºåˆ—&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åºå·æœ€å°çš„çº¿ç¨‹èŽ·å¾—é”ï¼Œå…¶ä»–çš„çº¿ç¨‹åˆ™ç›‘å¬è‡ªå·±åºå·çš„å‰ä¸€ä¸ªåºå·ï¼›å½“å‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œåˆ é™¤è‡ªå·±åºå·çš„èŠ‚ç‚¹ï¼›ä¸‹ä¸€ä¸ªåºå·çš„çº¿ç¨‹å¾—åˆ°é€šçŸ¥ï¼Œå°†ç»§ç»­æ‰§è¡Œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå·²ç»ç¡®å®šäº†çº¿ç¨‹çš„æ‰§è¡Œé¡ºåº&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/distributed-lock/zookeeper/thread.png"
width="485"
height="297"
srcset="https://emerywan.github.io/blog/blog/p/distributed-lock/zookeeper/thread_hu0d11f519269d68572311b436f0d9b410_73659_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/distributed-lock/zookeeper/thread_hu0d11f519269d68572311b436f0d9b410_73659_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="thread"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="391px"
>&lt;/p>
&lt;h3 id="å®žçŽ°">å®žçŽ°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ZkLock&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">AutoCloseable&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Watcher&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">ZooKeeper&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">znode&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// å½“å‰çº¿ç¨‹åˆ›å»ºçš„è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">ZkLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">connectString&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">sessionTimeout&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IOException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">zooKeeper&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ZooKeeper&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">connectString&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">sessionTimeout&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * try-catch-with-resource
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">clode&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">Exception&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">delete&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">znode&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é‡Šæ”¾é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * è§‚å¯Ÿå™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">process&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">WatchedEvent&lt;/span> &lt;span class="n">watchedEvent&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰ä¸€ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤æ—¶ï¼Œå¯å”¤é†’èŽ·å–é”çš„ç­‰å¾…ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹èŽ·å–äº†é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">watchedEvent&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">Event&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">EventType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">NodeDeleted&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">notify&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * èŽ·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">getLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Stat&lt;/span> &lt;span class="n">stat&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">exists&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">stat&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// å½“å‰ä¸šåŠ¡è‹¥æ²¡æœ‰æŒä¹…èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å…ˆåˆ›å»ºä¸€ä¸ªæŒä¹…èŠ‚ç‚¹ï¼Œåœ¨æŒä¹…èŠ‚ç‚¹é‡Œåˆ›å»ºçž¬æ—¶èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getBytes&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">StandardCharsets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">UTF_8&lt;/span>&lt;span class="o">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ZooDefs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Ids&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">OPEN_ACL_UNSAFE&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// å…¬å¼€æƒé™ï¼Œä¸ä½¿ç”¨ç”¨æˆ·åå¯†ç å°±èƒ½è®¿é—®è¿™ä¸ªèŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">CreateMode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PERSISTENT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ›å»ºçž¬æ—¶æœ‰åºèŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">subPath&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;_&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">znode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subPath&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getBytes&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">StandardCharsets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">UTF_8&lt;/span>&lt;span class="o">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ZooDefs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Ids&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">OPEN_ACL_UNSAFE&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CreateMode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">EPHEMERAL_SEQUENTIAL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–è¯¥ä¸šåŠ¡ä¸‹çš„æ‰€æœ‰çž¬æ—¶èŠ‚ç‚¹ï¼Œè¿›è¡Œæ¯”è¾ƒæŽ’åº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">childrenNodes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getChildren&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sort&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">childrenNodes&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æžœåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯å½“å‰åˆ›å»ºçš„èŠ‚ç‚¹ï¼Œç›´æŽ¥èŽ·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">firstNode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">childrenNodes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">znode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">endsWith&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">firstNode&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç­‰å¾…èŽ·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">lastNode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">firstNode&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">childrenNode&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ‰¾åˆ°å½“å‰èŠ‚ç‚¹ï¼Œç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">znode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">endWith&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">exists&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">lastNode&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lastNode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">node&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è®©å½“å‰çº¿ç¨‹é˜»å¡žï¼Œå¹¶ä¸”ä¼šé‡Šæ”¾é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ä¸Šé¢çš„åŒæ­¥ä»£ç å—æ‰ä¼šèŽ·å¾—é”å¹¶æ‰§è¡Œ notify()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">KeeperException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æµ‹è¯•">æµ‹è¯•&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ZkLockController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/zkLock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">zkLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;è¿›å…¥æ–¹æ³•&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ZkLock&lt;/span> &lt;span class="n">zklock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ZkLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;127.0.0.1:2181&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">10000&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">zkLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;order&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;èŽ·å–äº†é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUtil&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">10&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ¨¡æ‹Ÿä¸šåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®Œæˆä¸šåŠ¡&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;success&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="curator">Curator&lt;/h2>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/distributed-lock/zookeeper/curator.png"
width="537"
height="87"
srcset="https://emerywan.github.io/blog/blog/p/distributed-lock/zookeeper/curator_hu690a82169c4c3fdc258308de88a2c62f_35331_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/distributed-lock/zookeeper/curator_hu690a82169c4c3fdc258308de88a2c62f_35331_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="curator"
class="gallery-image"
data-flex-grow="617"
data-flex-basis="1481px"
>&lt;/p>
&lt;h3 id="ä¾èµ–é…ç½®">ä¾èµ–é…ç½®&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.apache.curator&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>curator-recipes&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>4.2.0&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®žçŽ°-1">å®žçŽ°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">DemoTest&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">test&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">zookeeperConnectionString&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;127.0.0.1:2181&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RetryPolicy&lt;/span> &lt;span class="n">retryPolicy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ExponentialBackoffRetry&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">1000&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">3&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CuratorFramework&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">CuratorFrameworkFactory&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newClient&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">zookeeperConnectionString&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">retryPolicy&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">lockPath&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/order&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">InterProcessMutex&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">InterProcessMutex&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">lockPath&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–äº’æ–¥é”ï¼Œé˜»å¡žç›´åˆ°å¯ç”¨ï¼Œæˆ–ç»™å®šæ—¶é—´åˆ°æœŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// åŒä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ acquire() å¯é‡å…¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">acquire&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">30&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;èŽ·å–é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¿…é¡»é€šè¿‡ release() é‡Šæ”¾é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">release&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>ä½¿ç”¨ Redis å®žçŽ°åˆ†å¸ƒå¼é”</title><link>https://emerywan.github.io/blog/p/distributed-lock/redis/</link><pubDate>Wed, 11 May 2022 12:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/distributed-lock/redis/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/1.jpeg" alt="Featured image of post ä½¿ç”¨ Redis å®žçŽ°åˆ†å¸ƒå¼é”" />&lt;h2 id="redis-nx-å®žçŽ°">Redis NX å®žçŽ°&lt;/h2>
&lt;p>åˆ©ç”¨ NX çš„&lt;strong>åŽŸå­æ€§&lt;/strong>ï¼Œå¤šä¸ªçº¿ç¨‹å¹¶å‘æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¾ç½®æˆåŠŸï¼Œè®¾ç½®æˆåŠŸå³èŽ·å–äº†é”ã€‚&lt;/p>
&lt;p>&lt;strong>å¦‚æžœæ²¡æœ‰èŽ·å–é”ï¼Œä¸ä¼šé˜»å¡žå½“å‰æ–¹æ³•ï¼Œç›´æŽ¥è·³è¿‡ä»»åŠ¡ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="èŽ·å–é”">èŽ·å–é”&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set key unique_value NX PX 30000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> product:stock:clothes UUID NX PX &lt;span class="m">30000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>key
&lt;ul>
&lt;li>æ ¹æ®ä¸åŒçš„ä¸šåŠ¡ï¼ŒåŒºåˆ†ä¸åŒçš„é”&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>unique_value
&lt;ul>
&lt;li>ä¿è¯æ¯ä¸ªçº¿ç¨‹çš„éšæœºå€¼éƒ½ä¸åŒï¼Œç”¨äºŽé‡Šæ”¾é”æ—¶çš„æ ¡éªŒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>NX
&lt;ul>
&lt;li>key ä¸å­˜åœ¨æ—¶è®¾ç½®æˆåŠŸï¼Œkey å­˜åœ¨åˆ™ä¸æˆåŠŸ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>PX
&lt;ul>
&lt;li>è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ã€‚è‹¥å‡ºçŽ°å¼‚å¸¸ï¼Œæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå¯ä»¥ä¿è¯è¶…æ—¶åŽï¼Œé”å¯ä»¥è¿‡æœŸå¤±æ•ˆï¼ˆæ¯«ç§’ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="é‡Šæ”¾é”">é‡Šæ”¾é”&lt;/h3>
&lt;p>é‡Šæ”¾é”å°†è¯¥ key åˆ é™¤ï¼Œåœ¨é‡Šæ”¾é”ä¹‹å‰éœ€è¦æ ¡éªŒè®¾ç½®çš„éšæœºæ•°ï¼Œç›¸åŒæ‰è¡¨ç¤ºæ˜¯è¯¥çº¿ç¨‹åŠ çš„é”ï¼Œèƒ½é‡Šæ”¾ã€‚&lt;/p>
&lt;p>éœ€è¦é‡‡ç”¨ LUA è„šæœ¬ï¼Œdel å‘½ä»¤æ²¡æœ‰æä¾›æ ¡éªŒå€¼çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>redis æ‰§è¡Œå‘½ä»¤æ˜¯æŒ‰ç…§ä¸€æ¡æŒ‡ä»¤å®Œæˆä¹‹åŽï¼Œå†æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œç”¨ lua è„šæœ¬ï¼Œèƒ½ä¿è¯ redis æ‰§è¡Œå®Œè¿™ä¸ªè„šæœ¬æ‰æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œæ‰€ä»¥èƒ½ä¿è¯åˆ¤æ–­ å’Œ åˆ é™¤æ˜¯åŽŸå­æ€§çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">if&lt;/span> &lt;span class="n">redis.call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;get&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">KEYS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">ARGV&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="kr">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="n">redis.call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;del&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">KEYS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å®žçŽ°">å®žçŽ°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedisLockController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/redisLock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">redisLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–åˆ†å¸ƒå¼é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">RedisCallback&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;)&lt;/span> &lt;span class="n">redisConnection&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Expiration&lt;/span> &lt;span class="n">expiration&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Expiration&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">seconds&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">30&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// NX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span> &lt;span class="n">setOption&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ifAbsent&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// éœ€è¦ä½¿ç”¨ redisTemplate ä¸­çš„åºåˆ—åŒ–å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKeySerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisValue&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValueSerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">redisConnection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisKey&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">redisValue&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">expiration&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// èŽ·å–åˆ°äº†é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;èŽ·å–åˆ°äº†é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">15&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;if redis.call(\&amp;#34;get\&amp;#34;,KEYS[1])==ARGV[1] then\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn redis.call(\&amp;#34;del\&amp;#34;,KEYS[1])\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;else\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn 0\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;end&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">redisScript&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">of&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Boolean&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisScript&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é‡Šæ”¾é” {}&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ä¸šåŠ¡å®Œæˆ&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;success&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedisLock&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”åç§°ï¼Œä¸åŒä¸šåŠ¡å¯èƒ½é”ä¸åŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">RedisLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">redisTemplate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">expireTime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// value å¯ä»¥ä¸æš´éœ²å‡ºåŽ»ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ä¸ä¸€æ ·çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">UUID&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">randomUUID&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * èŽ·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">getLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–åˆ†å¸ƒå¼é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">RedisCallback&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;)&lt;/span> &lt;span class="n">redisConnection&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Expiration&lt;/span> &lt;span class="n">expiration&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Expiration&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">seconds&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">expireTime&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// NX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span> &lt;span class="n">setOption&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ifAbsent&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç”±äºŽè¿™é‡Œéœ€è¦æŽ¥å— byte, ä¸èƒ½æš´åŠ›çš„ä½¿ç”¨ string.getBytes()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// è¦ä½¿ç”¨æ¨¡æ¿é‡Œé¢çš„ key\value åºåˆ—åŒ–å™¨æ¥å®žçŽ°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKeySerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisValue&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValueSerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisConnection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisKey&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">redisValue&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">expiration&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">setOption&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * é‡Šæ”¾é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">unLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// lua è„šæœ¬
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;if redis.call(\&amp;#34;get\&amp;#34;,KEYS[1])==ARGV[1] then\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn redis.call(\&amp;#34;del\&amp;#34;,KEYS[1])\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;else\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn 0\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;end&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">redisScript&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">of&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Boolean&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisScript&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="redisson">Redisson&lt;/h2>
&lt;h3 id="ä¾èµ–é…ç½®">ä¾èµ–é…ç½®&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.redisson&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>redisson-spring-boot-starter&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>3.16.7&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®žçŽ°-1">å®žçŽ°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedissonLockController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedissonClient&lt;/span> &lt;span class="n">redissonClient&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/redissonLock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">redissonLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;æ‰§è¡Œæ–¹æ³•&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;redisson&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redissonClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”è¶…æ—¶æ—¶é—´ï¼Œå¦‚æžœæœªèŽ·å¾—é”ï¼Œä¼šé˜»å¡žç­‰å¾…èŽ·å–åˆ°é”ï¼ˆ-1 è¡¨ç¤ºæ²¡æœ‰è¶…æ—¶æ—¶é—´ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">30&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;èŽ·å–é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é‡Šæ”¾é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®Œæˆä¸šåŠ¡&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;success&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - CyclicBarrier å®žçŽ°åŽŸç†</title><link>https://emerywan.github.io/blog/p/thread/cyclicbarrier/</link><pubDate>Tue, 03 May 2022 23:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/thread/cyclicbarrier/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/14.jpeg" alt="Featured image of post Java å¹¶å‘ - CyclicBarrier å®žçŽ°åŽŸç†" />&lt;h2 id="åŽŸç†">åŽŸç†&lt;/h2>
&lt;p>&lt;code>CyclicBarrier&lt;/code> é€šè¿‡å¯é‡å…¥é” &lt;code>CyclicBarrier&lt;/code> å®žçŽ°ï¼Œå†…éƒ¨ä½¿ç”¨é™æ€å†…éƒ¨ç±» &lt;code>Generation&lt;/code> ç»´æŠ¤ &lt;code>broken&lt;/code> æ ‡è®°ï¼Œè¡¨ç¤ºå±éšœæ˜¯å¦å¯ç”¨ã€‚&lt;/p>
&lt;p>é€šè¿‡æž„é€ æ–¹æ³•ä¼ å…¥ç­‰å¾…çº¿ç¨‹æ•° &lt;code>parties&lt;/code>ã€‚&lt;/p>
&lt;p>æ¯æ¬¡æœ‰ä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœï¼Œ &lt;code>count - 1&lt;/code>ï¼Œç›´åˆ° &lt;code>count = 0&lt;/code>ï¼Œä¼šé‡Šæ”¾å±éšœï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨ &lt;code>nextGeneration()&lt;/code> å¯¹ &lt;code>count&lt;/code> å’Œ &lt;code>generation&lt;/code> è¿›è¡Œé‡ç½®ï¼Œè¿›è¡Œä¸‹ä¸€è½®å¾ªçŽ¯ã€‚&lt;/p>
&lt;p>æœ‰ä¸‰ç§æƒ…å†µä¼šé€ æˆå±éšœç ´åï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>CyclicBarrier Runnable command æ–¹æ³•æŠ›å‡ºå¼‚å¸¸&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨é‡Šæ”¾æ¡ä»¶è¿˜æœªè¾¾åˆ°æ—¶ï¼ŒæŸä¸ªçº¿ç¨‹æŠ›å‡ºäº†å¼‚å¸¸&lt;/p>
&lt;/li>
&lt;li>
&lt;p>await() ç­‰å¾…è¶…æ—¶&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æºç ">æºç &lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">CyclicBarrier&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å†…éƒ¨ç±»ï¼Œå­˜æ”¾ broken æ ‡è®°ï¼Œè¡¨ç¤ºå±éšœæ˜¯å¦è¢«æŸåï¼ŒæŸååŽæ— æ³•æ­£å¸¸å·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Generation&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">broken&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¯é‡å…¥é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Condition&lt;/span> &lt;span class="n">trip&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newCondition&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å±éšœé˜»æŒ¡çš„çº¿ç¨‹æ•°ï¼Œæž„é€ æ–¹æ³•ä¼ å…¥çš„åˆå§‹åŒ–å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å±éšœé‡Šæ”¾æ—¶æ‰§è¡Œçš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="n">barrierCommand&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰çš„ Generation å¯¹è±¡ï¼Œæ¯ä¸€è½®éƒ½ä¼šæœ‰ä¸€ä¸ªæ–°çš„ Generation å¯¹è±¡ï¼Œå­˜æ”¾ broken æ ‡è®°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="n">Generation&lt;/span> &lt;span class="n">generation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Generation&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰è¿˜éœ€è¦é˜»æŒ¡å‡ ä¸ªçº¿ç¨‹ï¼Œæ¯æ¬¡ -1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¼€å¯ä¸‹ä¸€è½®å±éšœï¼ˆcount==0 æˆ– resetï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">nextGeneration&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">signalAll&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡ç½® count
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">generation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Generation&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç ´åå½“å‰å±éšœï¼Œå˜ä¸ºä¸å¯ç”¨çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ reset æ¢å¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">breakBarrier&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">generation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">signalAll&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">dowait&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">boolean&lt;/span> &lt;span class="n">timed&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">nanos&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeoutException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åŠ é”ï¼Œæœ‰å¤šä¸ªçº¿ç¨‹ä¼šè°ƒç”¨ await() åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥åŒæ­¥æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">Generation&lt;/span> &lt;span class="n">g&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generation&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// å±éšœæ˜¯å¦æŸå
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">interrupted&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">index&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">index&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// è¾¾åˆ°æ¡ä»¶ï¼Œå¯æ‰“ç ´å±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">ranAction&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="n">command&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">barrierCommand&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">command&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// æ‰§è¡Œæ‰“ç ´å±éšœçš„å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">command&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ranAction&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nextGeneration&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// å¼€å¯ä¸‹ä¸€è½®å¾ªçŽ¯ï¼Œé‡Œé¢ä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">ranAction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// (1) å‡å¦‚ command å‡ºçŽ°å¼‚å¸¸ï¼Œç ´åå±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰è¿˜æœªè¾¾åˆ°å†²ç ´å±éšœçš„çš„æ¡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ä¸€ç›´å¾ªçŽ¯ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾æ‰“ç ´å±éšœçš„æ¡ä»¶ï¼Œä¸­æ–­ï¼Œæˆ–è¶…æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(;;)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">timed&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// æœªè¾¾åˆ°è¶…æ—¶æ—¶é—´ï¼Œè¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°è¢«å”¤é†’
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">nanos&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">0L&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nanos&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">awaitNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">nanos&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">ie&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// (2) ç­‰å¾…åˆ°è¾¾æ¡ä»¶æ—¶ï¼Œçº¿ç¨‹è¢«ä¸­æ–­ï¼Œç ´åå±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">generation&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="o">!&lt;/span> &lt;span class="n">g&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">ie&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// We&amp;#39;re about to finish waiting even if we had not
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// been interrupted, so this interrupt is deemed to
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// &amp;#34;belong&amp;#34; to subsequent execution.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">interrupt&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// çº¿ç¨‹è¢«å”¤é†’ä¹‹åŽï¼Œå±éšœè¢«ç ´åï¼Œç›´æŽ¥æŠ›å‡ºå¼‚å¸¸
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">generation&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// è¿”å›žå½“å‰çº¿ç¨‹æ˜¯ç¬¬å‡ ä¸ªåˆ°è¾¾çš„çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">timed&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">nanos&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">0L&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// (3) ç­‰å¾…è¶…æ—¶ï¼Œç ´åå±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">TimeoutException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">CyclicBarrier&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="n">barrierAction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">parties&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">IllegalArgumentException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">parties&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">barrierCommand&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">barrierAction&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">CyclicBarrier&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">parties&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getParties&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¼€å§‹ç­‰å¾… è¿”å›žå½“å‰çº¿ç¨‹æ˜¯ç¬¬å‡ ä¸ªåˆ°è¾¾çš„çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">dowait&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">0L&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">TimeoutException&lt;/span> &lt;span class="n">toe&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Error&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">toe&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// cannot happen
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="n">timeout&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeoutException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">dowait&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">timeout&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ¤æ–­å±éšœæ˜¯å¦è¢«ç ´å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">isBroken&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// éœ€åŠ é”è®¿é—®ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½åœ¨æ‰§è¡Œ dowait()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">generation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡ç½®æ“ä½œ å…ˆç ´åå±éšœï¼Œå†è¿›è¡Œä¸‹ä¸€è½®å¾ªçŽ¯å±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">reset&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// break the current generation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">nextGeneration&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// start a new generation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–ç­‰å¾…çº¿ç¨‹æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getNumberWaiting&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">parties&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - CountDownLatch å®žçŽ°åŽŸç†</title><link>https://emerywan.github.io/blog/p/thread/countdownlatch/</link><pubDate>Tue, 03 May 2022 14:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/thread/countdownlatch/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/6.jpeg" alt="Featured image of post Java å¹¶å‘ - CountDownLatch å®žçŽ°åŽŸç†" />&lt;h2 id="åŸºæœ¬å®žçŽ°æ€è·¯">åŸºæœ¬å®žçŽ°æ€è·¯ï¼š&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>åˆ©ç”¨ &lt;strong>å…±äº«é”&lt;/strong> å®žçŽ°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆå§‹åŒ–æ—¶ï¼Œ&lt;code>state=count&lt;/code> å³å·²ç»ä¸Šäº† &lt;code>count&lt;/code> æ¬¡å…±äº«é”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>await()&lt;/code> å³åŠ å…±äº«é”ï¼Œå¿…é¡» &lt;code>state=0&lt;/code> æ—¶æ‰èƒ½åŠ é”æˆåŠŸï¼Œå¦åˆ™æŒ‰ç…§ AQS æœºåˆ¶ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—é˜»å¡ž&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>countDown()&lt;/code> è§£ä¸€æ¬¡é”ï¼Œç›´åˆ°ä¸º &lt;code>0&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æºç ">æºç &lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">CountDownLatch&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å†…éƒ¨ç±»å®žçŽ° AQS
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Sync&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">AbstractQueuedSynchronizer&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">serialVersionUID&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">4982264981922014374L&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Sync&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ä½¿ç”¨ AQS çš„ state ä½œä¸ºè®¡æ•°å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">setState&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getCount&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">getState&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡‡ç”¨ **å…±äº«é”** æœºåˆ¶ï¼Œå› ä¸ºå¯ä»¥è¢«ä¸åŒçš„çº¿ç¨‹ countdown
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">protected&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">tryAcquireShared&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">acquires&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">getState&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">protected&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">tryReleaseShared&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">releases&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¯æ¬¡æ‰§è¡Œå°† state-1ï¼Œç›´åˆ° state=0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(;;)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getState&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">nextc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">compareAndSetState&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">nextc&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="c1">// é€šè¿‡ CAS æ”¹å˜ state çš„å€¼ï¼Œå¤±è´¥ä¼šè¿›è¡Œä¸‹ä¸€è½®å¾ªçŽ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">nextc&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Sync&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">CountDownLatch&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">IllegalArgumentException&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;count &amp;lt; 0&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sync&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Sync&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é€šè¿‡ acquireSharedInterruptibly èŽ·å–å…±äº«é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// è‹¥ state!=0 ä¼šè¢«æŒç»­é˜»å¡ž
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">acquireSharedInterruptibly&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// 1 è¿™é‡Œæ˜¯éšæ„çš„å‚æ•°ï¼Œåœ¨ coutdownlatch ä¸­æ— æ„ä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="n">timeout&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">tryAcquireSharedNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">timeout&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è§£é”ä¸€æ¬¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">countDown&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">releaseShared&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// èŽ·å–å½“å‰è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="nf">getCount&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCount&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kd">super&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;[Count = &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCount&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;]&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Ubuntu å®‰è£…è½¯ä»¶æŽ¨èæ–¹å¼</title><link>https://emerywan.github.io/blog/p/ubuntu-software-install/</link><pubDate>Mon, 02 May 2022 02:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/ubuntu-software-install/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/4.jpeg" alt="Featured image of post Ubuntu å®‰è£…è½¯ä»¶æŽ¨èæ–¹å¼" />&lt;h2 id="è¯´æ˜Ž">è¯´æ˜Ž&lt;/h2>
&lt;p>Ubuntu æœ‰äº›ç¬¬ä¸‰æ–¹è½¯ä»¶åªæä¾›äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ï¼ˆåŽ‹ç¼©åŒ…æˆ– AppImageï¼‰ï¼Œè€Œä¸æ˜¯å®‰è£…åŒ…æˆ–è€… apt æºï¼Œè¿™æ—¶å€™éœ€è¦æˆ‘ä»¬åŽ»è‡ªå·±è§£åŽ‹æ–‡ä»¶ï¼Œæ”¾åœ¨è‡ªå®šä¹‰ç›®å½•ï¼Œå¹¶è¿›è¡Œé…ç½®ã€‚&lt;/p>
&lt;p>å¹³å¸¸ä½¿ç”¨æ¡Œé¢çŽ¯å¢ƒçš„è¯ï¼Œè¿™æ ·å®‰è£…åŽï¼Œæ›´æ–°è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦çš„ï¼Œä¸€æ›´æ–°å°±è¦ä¿®æ”¹å¾ˆå¤šåœ°æ–¹ã€‚&lt;/p>
&lt;p>è¿™é‡Œä»‹ç»æˆ‘å¹³å¸¸çš„é…ç½®æ–¹å¼ï¼Œæ¯æ¬¡æ›´æ–°åŽï¼Œåªéœ€è¦ä¿®æ”¹è½¯é“¾æŽ¥å³å¯ï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºæ–¹ä¾¿çš„ã€‚&lt;/p>
&lt;h2 id="æ–¹å¼">æ–¹å¼&lt;/h2>
&lt;p>ä»¥ &lt;a class="link" href="https://github.com/Fndroid/clash_for_windows_pkg/releases" target="_blank" rel="noopener"
>cfw&lt;/a> å®‰è£…ä¸ºä¾‹ï¼ŒLinux æä¾› &lt;code>.tar.gz&lt;/code> çš„æ‰§è¡Œæ–‡ä»¶ã€‚&lt;/p>
&lt;p>æˆ‘é€šå¸¸éƒ½æŠŠè¿™æ ·çš„è½¯ä»¶éƒ½ç»Ÿä¸€æ”¾åˆ° &lt;code>~/Applications&lt;/code> ä¸­ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸ•ï¸ é¦–å…ˆåˆ›å»ºä¸€ä¸ªå®‰è£…çš„è½¯ä»¶çš„æ–‡ä»¶å¤¹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mkdir -p ~/Application/clash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸžï¸ å°†ä¸‹è½½çš„æ–‡ä»¶è§£åŽ‹åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">tar -xzvf Clash.for.Windows-0.19.12 -C ~/Application/clash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸœï¸ åˆ›å»ºå¯åŠ¨æ–‡ä»¶çš„è½¯è¿žæŽ¥&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">ln -s ./Clash&lt;span class="se">\ &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="se">\ &lt;/span>Windows-0.19.12-x64-linux/cfw ./clash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¯æ¬¡å¯åŠ¨åº”ç”¨éƒ½ä½¿ç”¨è¿™ä¸ªè½¯é“¾æŽ¥è¿›è¡Œæ“ä½œï¼Œå½“éœ€è¦å‡çº§åº”ç”¨æ—¶ï¼Œåªéœ€è¦åˆ›å»ºæ–°çš„è½¯é“¾æŽ¥ï¼ŒæŒ‡å‘æ–°çš„å¯åŠ¨æ–‡ä»¶ã€‚æœ€åŽçš„æ•ˆæžœå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ tree . -L 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ clash -&amp;gt; ./Clash for Windows-0.19.12-x64-linux/cfw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ Clash for Windows-0.19.12-x64-linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â””â”€â”€ Clash for Windows-0.19.2-x64-linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ–ï¸ æ·»åŠ æ¡Œé¢å›¾æ ‡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">vim ~/.local/share/applications/clw.desktop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[Desktop Entry]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name=Clash for Linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Icon=/home/emery/Applications/icon/clash_icon.png # æ›¿æ¢ä¸ºè‡ªå·±çš„ç›®å½•
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Comment=Clash for Linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Exec=&amp;#34;/home/emery/Applications/Clash/clash&amp;#34; %u # æ›¿æ¢ä¸ºè‡ªå·±çš„ç›®å½•
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type=Application
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Categories=Network
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Terminal=false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">StartupNotify=true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>åœ¨ Ubuntu ä¸­æ­å»º CUDA çŽ¯å¢ƒ</title><link>https://emerywan.github.io/blog/p/cuda/</link><pubDate>Mon, 02 May 2022 02:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/cuda/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/11.jpeg" alt="Featured image of post åœ¨ Ubuntu ä¸­æ­å»º CUDA çŽ¯å¢ƒ" />&lt;h2 id="nvdia-é©±åŠ¨">Nvdia é©±åŠ¨&lt;/h2>
&lt;p>é¦–å…ˆï¼Œè¯·ç¡®ä¿åœ¨ç³»ç»Ÿä¸­å®‰è£…äº†è‹±ä¼Ÿè¾¾æ˜¾å¡é©±åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>nvidia-msi&lt;/code> å‘½ä»¤æŸ¥çœ‹æ˜¾å¡å¯¹åº”ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å¦‚æžœæ²¡æœ‰å®‰è£…é©±åŠ¨ï¼Œå¯ä»¥å‚è€ƒè¯¥ç« èŠ‚ã€‚&lt;a class="link" href="https://emerywan.github.io/blog/guide/prepare/driver.html" >ä¼ é€é—¨âž¡ï¸&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/cuda/nvidia-msi.png"
width="734"
height="512"
srcset="https://emerywan.github.io/blog/blog/p/cuda/nvidia-msi_hu25fedbd9e105d28334236f2eb0bd81d5_56804_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/cuda/nvidia-msi_hu25fedbd9e105d28334236f2eb0bd81d5_56804_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="nvidia-msi"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="344px"
>&lt;/p>
&lt;p>æŽ¨èä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦è½¯ä»¶ &lt;code>è½¯ä»¶å’Œæ›´æ–°&lt;/code> å®‰è£…æ˜¾å¡é©±åŠ¨ã€‚æ‰“å¼€åº”ç”¨åŽï¼Œç‚¹å‡» &lt;code>é™„åŠ é©±åŠ¨&lt;/code> é€‰é¡¹ï¼Œä¼šå¯¹æ‰€æœ‰å¯é€‰çš„é™„åŠ é©±åŠ¨è¿›è¡Œæœç´¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/cuda/nvidia-install.png"
width="877"
height="500"
srcset="https://emerywan.github.io/blog/blog/p/cuda/nvidia-install_hud8377b5c2eaf750be9838eb34291d82b_111878_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/cuda/nvidia-install_hud8377b5c2eaf750be9838eb34291d82b_111878_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="nvidia-install"
class="gallery-image"
data-flex-grow="175"
data-flex-basis="420px"
>&lt;/p>
&lt;p>å…¶ä¸­ï¼Œ&lt;code>Nouveau&lt;/code> ä¸ºè‹±ä¼Ÿè¾¾æ˜¾å¡å¼€æºé©±åŠ¨ï¼ˆé»˜è®¤å®‰è£…ï¼‰ï¼Œé€‰æ‹©éœ€è¦çš„ &lt;code>NVIDIA drive&lt;/code> é©±åŠ¨é€‰é¡¹ï¼Œç‚¹å‡» &lt;code>åº”ç”¨æ›´æ”¹&lt;/code>ã€‚&lt;/p>
&lt;p>ç­‰å¾…è¿›åº¦æ¡ç»“æŸåŽï¼Œé‡å¯ç”µè„‘ï¼Œå³å®Œæˆäº†æ˜¾å¡é©±åŠ¨çš„å®‰è£…ã€‚&lt;/p>
&lt;h2 id="cuda">CUDA&lt;/h2>
&lt;p>ä½ å¯ä»¥åœ¨ &lt;a class="link" href="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a> çœ‹åˆ°æ˜¾å¡é©±åŠ¨ç‰ˆæœ¬ä¸Ž CUDA ç‰ˆæœ¬çš„å¯¹åº”å…³ç³»ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/cuda/cuda.png"
width="1540"
height="358"
srcset="https://emerywan.github.io/blog/blog/p/cuda/cuda_hu06d82653b392e263a912d34e822f7d1a_74559_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/cuda/cuda_hu06d82653b392e263a912d34e822f7d1a_74559_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cuda"
class="gallery-image"
data-flex-grow="430"
data-flex-basis="1032px"
>&lt;/p>
&lt;p>ðŸŒ° åœ¨è¿™é‡Œçš„æ˜¾å¡é©±åŠ¨ç‰ˆæœ¬ä¸º &lt;code>470.103.01&lt;/code>ï¼Œæ ¹æ®å¯¹åº”è¡¨å¯çŸ¥ï¼Œæœ€é«˜å¯é€‰çš„ CUDA Toolkit çš„ç‰ˆæœ¬å·ä¸º &lt;code>CUDA 11.4 Update 4&lt;/code>ã€‚&lt;/p>
&lt;p>ä¹‹åŽï¼Œå¯åœ¨å®˜ç½‘ &lt;a class="link" href="https://developer.nvidia.com/cuda-toolkit-archive" target="_blank" rel="noopener"
>è¯¥é¡µé¢&lt;/a> ä¸­ï¼Œé€‰æ‹©å¯¹åº”çš„ CUDA Toolkitã€‚&lt;/p>
&lt;p>å¯æ ¹æ®å½“å‰ç³»ç»ŸçŽ¯å¢ƒï¼Œé€‰æ‹©å¯¹åº”çš„ä¸‹è½½é€‰é¡¹ï¼ˆæŽ¨èä¸‹è½½ &lt;code>.drunfile&lt;/code>ï¼Œ&lt;code>.deb&lt;/code> ä¼šè¦†ç›–ç³»ç»Ÿå®‰è£…çš„æ˜¾å¡é©±åŠ¨ï¼‰ï¼š&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/cuda/cuda-platform.png"
width="2506"
height="894"
srcset="https://emerywan.github.io/blog/blog/p/cuda/cuda-platform_hu9bf542e30b48a580f041a55f80ab65bc_245327_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/cuda/cuda-platform_hu9bf542e30b48a580f041a55f80ab65bc_245327_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cuda-platform"
class="gallery-image"
data-flex-grow="280"
data-flex-basis="672px"
>&lt;/p>
&lt;p>ä¸‹è½½å®ŒæˆåŽï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">DOWNLOAD_DIR&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x ./cuda_&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>_linux.run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh ./cuda_&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>_linux.run
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>::: warning è­¦å‘Š ðŸš§
æ³¨æ„ï¼šåœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œè¯·å–æ¶ˆå‹¾é€‰å®‰è£…é©±åŠ¨é€‰é¡¹ã€‚
:::&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/cuda/cuda-install.png"
width="734"
height="476"
srcset="https://emerywan.github.io/blog/blog/p/cuda/cuda-install_hu423287ac940ffb3bc75497440c5c47d7_30663_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/cuda/cuda-install_hu423287ac940ffb3bc75497440c5c47d7_30663_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cuda-install"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="370px"
>&lt;/p>
&lt;p>é…ç½®çŽ¯å¢ƒå˜é‡ï¼Œåœ¨å¯¹åº”é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># bash -&amp;gt; .bashrc / zsh -&amp;gt; .zshrc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">CUDA_HOME&lt;/span>&lt;span class="o">=&lt;/span>/usr/local/cuda-&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">CUDA_HOME&lt;/span>&lt;span class="si">}&lt;/span>/bin:&lt;span class="si">${&lt;/span>&lt;span class="nv">PATH&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="cudnn">cuDNN&lt;/h2>
&lt;p>ä½ å¯ä»¥åœ¨å®˜ç½‘ &lt;a class="link" href="https://developer.nvidia.com/rdp/cudnn-download" target="_blank" rel="noopener"
>æ­¤é“¾æŽ¥&lt;/a> ä¸‹è½½ CUDNNï¼Œéœ€è¦æ³¨å†Œå¼€å‘è€…è´¦å·ï¼Œå¯èƒ½è¿˜éœ€è¦ä¸€ä¸ªâ€œè‰¯å¥½çš„ç½‘ç»œçŽ¯å¢ƒâ€ã€‚&lt;/p>
&lt;p>é€‰æ‹©ä¸Ž CUDA ç›¸å¯¹åº”ç”¨çš„ cuDNNï¼ŒæŽ¨èä¸‹è½½åŽ‹ç¼©åŒ…æ ¼å¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/cuda/cudnn.png"
width="2228"
height="1498"
srcset="https://emerywan.github.io/blog/blog/p/cuda/cudnn_hu2d2e598f2ebb22e3f94073a6174ea5e2_332327_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/cuda/cudnn_hu2d2e598f2ebb22e3f94073a6174ea5e2_332327_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cudnn"
class="gallery-image"
data-flex-grow="148"
data-flex-basis="356px"
>&lt;/p>
&lt;p>ä¸‹è½½å®ŒæˆåŽï¼Œè§£åŽ‹æ–‡ä»¶å¤¹ï¼Œå¹¶æ ¹æ®ä»¥ä¸‹å‘½ä»¤å¤åˆ¶è§£åŽ‹åŽæ–‡ä»¶å¤¹ä¸­çš„ &lt;code>lib64&lt;/code> &lt;code>include&lt;/code> æ–‡ä»¶å¤¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">tar -xzvf cudnn-linux-&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp cudnn-linux-&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>/lib64/* /usr/local/cuda/lib64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp cudnn-linux-&lt;span class="o">{&lt;/span>Version&lt;span class="o">}&lt;/span>/include/* /usr/local/cuda/include
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¤åˆ¶å®ŒæˆåŽï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ cuDNN ç‰ˆæœ¬ä¿¡æ¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">cat /usr/local/cuda-10.1/include/cudnn.h &lt;span class="p">|&lt;/span> grep CUDNN_MAJOR -A &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - AQS</title><link>https://emerywan.github.io/blog/p/thread/aqs/</link><pubDate>Wed, 13 Apr 2022 14:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/thread/aqs/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/6.jpeg" alt="Featured image of post Java å¹¶å‘ - AQS" />&lt;h2 id="aqs">AQS&lt;/h2>
&lt;p>AQS &lt;code>AbstractQueuedSynchronized&lt;/code> æ˜¯ä¸€ä¸ªç”¨æ¥æž„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æž¶ï¼Œæ˜¯å¯¹ CAS çš„ä¸€ç§å°è£…å’Œä¸°å¯Œï¼ŒAQS å¼•å…¥äº†ç‹¬å é”ï¼Œå…±äº«é”ç­‰æ€§è´¨ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ AQS èƒ½å¤ŸåŸºäºŽ Java APIï¼Œç®€å•é«˜æ•ˆåœ°æž„å»ºå‡ºåº”ç”¨å¹¿æ³›çš„å¤§é‡åŒæ­¥å™¨ï¼Œç”¨äºŽ Java å¤šçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚&lt;/p>
&lt;h2 id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³&lt;/h2>
&lt;p>AQS ä½¿ç”¨ä¸€ä¸ª &lt;code>int&lt;/code> æˆå‘˜å˜é‡è¡¨ç¤ºåŒæ­¥çŠ¶æ€ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ CAS å¯¹è¯¥åŒæ­¥çŠ¶æ€è¿›è¡ŒåŽŸå­æ“ä½œï¼Œå®žçŽ°å¯¹å…¶å€¼çš„ä¿®æ”¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å…±äº«å˜é‡ï¼Œä½¿ç”¨ volatile ä¿éšœå¯è§æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">private&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>AQS é€šè¿‡å†…ç½®çš„ &lt;code>FIFO&lt;/code> åŒå‘é˜Ÿåˆ—æ¥å®ŒæˆèŽ·å–èµ„æºçº¿ç¨‹çš„æŽ’é˜Ÿå·¥ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">transient&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="n">Node&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">transient&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="n">Node&lt;/span> &lt;span class="n">tail&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²æ—¶ï¼Œå°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚&lt;/p>
&lt;p>å¦‚æžœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œå°†æš‚æ—¶èŽ·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚&lt;/p>
&lt;h2 id="èµ„æºçš„å…±äº«æ–¹å¼">èµ„æºçš„å…±äº«æ–¹å¼&lt;/h2>
&lt;h3 id="ç‹¬å ">ç‹¬å &lt;/h3>
&lt;p>å½“ä¸€ä¸ªçº¿ç¨‹ä»¥ç‹¬å æ¨¡å¼èŽ·å–é”æ—¶ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ã€‚&lt;/p>
&lt;ul>
&lt;li>ReentrantLock&lt;/li>
&lt;/ul>
&lt;h3 id="å…±äº«">å…±äº«&lt;/h3>
&lt;p>å½“ä¸€ä¸ªçº¿ç¨‹ä»¥å…±äº«æ¨¡å¼èŽ·å–é”æ—¶ï¼Œå…¶ä»–ä¹Ÿæƒ³ä»¥å…±äº«æ¨¡å¼èŽ·å–é”çš„çº¿ç¨‹ä¹Ÿèƒ½å¤Ÿä¸€èµ·è®¿é—®å…±äº«èµ„æºï¼Œä½†å…¶ä»–æƒ³ä»¥ç‹¬å æ¨¡å¼èŽ·å–é”çš„çº¿ç¨‹éœ€è¦ç­‰å¾…ã€‚&lt;/p>
&lt;ul>
&lt;li>CountDownLatch&lt;/li>
&lt;li>CyclicBarrier&lt;/li>
&lt;li>Semaphore&lt;/li>
&lt;/ul>
&lt;h2 id="å®žçŽ°">å®žçŽ°&lt;/h2>
&lt;h3 id="countdownlatch">CountDownLatch&lt;/h3>
&lt;p>&lt;code>CountDownLatch&lt;/code> åŒæ­¥å·¥å…·å…è®¸ä¸€æ¡æˆ–å¤šæ¡çº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹ä¸­çš„ä¸€ç»„æ“ä½œå®ŒæˆåŽï¼Œå†ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;p>&lt;code>CountDownLatch&lt;/code> ä»»åŠ¡åˆ†ä¸º &lt;code>n&lt;/code> ä¸ªå­çº¿ç¨‹æ‰§è¡Œï¼Œ&lt;code>state&lt;/code> å°†è¢«åˆå§‹åŒ–ä¸º &lt;code>n&lt;/code>ï¼Œè¿™ &lt;code>n&lt;/code> ä¸ªçº¿ç¨‹å°†ä¼šå¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒåŽè°ƒç”¨ &lt;code>countDown()&lt;/code> æ–¹æ³•ï¼Œ&lt;code>state&lt;/code> ä¼šé€šè¿‡ &lt;code>CAS - 1&lt;/code>ã€‚å½“æ‰€æœ‰çš„å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œä¹‹åŽï¼Œ&lt;code>state=0&lt;/code>ï¼Œä¼š unpack ä¸»çº¿ç¨‹ï¼Œç»§ç»­åŽç»­åŠ¨ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">SearchTask&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">CountDownLatch&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">SearchTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">CountDownLatch&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">latch&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// **å­çº¿ç¨‹**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å„è‡ªå¯»æ‰¾ç›¸åº”ç›®æ ‡çš„é¾™ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ðŸƒâ€â™‚ï¸ å¼€å§‹å¯»æ‰¾&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å·é¾™ç &amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ThreadLocalRandom&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">current&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">20&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">seconds&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ðŸ‘ èŠ±äº†&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;ç§’ï¼Œæ‰¾åˆ°äº†&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å·é¾™ç &amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¯å½“ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œå°±è°ƒç”¨ä¸€æ¬¡ countDown() æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">countDown&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// **ä¸»çº¿ç¨‹**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ç­‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åŽï¼Œæ‰¾åˆ°æ‰€æœ‰é¾™ç ï¼Œå¬å”¤ç¥žé¾™
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">idList&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">2&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">3&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">4&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">5&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">6&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">7&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// state åˆå§‹åŒ–ä¸ºä»»åŠ¡çš„ä¸ªæ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">CountDownLatch&lt;/span> &lt;span class="n">latch&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CountDownLatch&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">idList&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">idList&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thead&lt;/span> &lt;span class="n">thread&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Thead&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">SearchTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">latch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;æ‰¾åˆ°æ‰€æœ‰é¾™ç äº†ï¼å¬å”¤ç¥žé¾™ ðŸ²&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/thread/aqs/countdownlatch.png"
width="605"
height="416"
srcset="https://emerywan.github.io/blog/blog/p/thread/aqs/countdownlatch_hu76805997e75031fb962291546eee5c35_69221_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/thread/aqs/countdownlatch_hu76805997e75031fb962291546eee5c35_69221_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="countdownlatch"
class="gallery-image"
data-flex-grow="145"
data-flex-basis="349px"
>&lt;/p>
&lt;p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»»åŠ¡åˆ†ä¸º 7 ä¸ªå­çº¿ç¨‹æ‰§è¡Œï¼Œå°† &lt;code>CountDownLatch&lt;/code> çš„å€¼åˆå§‹åŒ–ä¸ºä¸Žçº¿ç¨‹ç›¸åŒçš„æ¬¡æ•°ã€‚ä¸»çº¿ç¨‹é€šè¿‡ &lt;code>await()&lt;/code> ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆã€‚&lt;/p>
&lt;p>è¿™å‡ ä¸ªå­ä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒæˆåŽ &lt;code>countDown()&lt;/code> ä¸€æ¬¡ï¼Œ&lt;code>state&lt;/code> ä¼šé€šè¿‡ CAS æ“ä½œ &lt;code>-1&lt;/code>ã€‚&lt;/p>
&lt;p>ç›´åˆ°æ‰€æœ‰çš„å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åŽï¼Œ&lt;code>state=0&lt;/code>ï¼Œä¸»çº¿ç¨‹ä¼šç»“æŸç­‰å¾…ï¼Œç»§ç»­æ‰§è¡ŒåŽç»­ä»»åŠ¡ã€‚&lt;/p>
&lt;h3 id="cyclicbarrier">CyclicBarrier&lt;/h3>
&lt;p>&lt;code>CyclicBarrier&lt;/code> ç”¨äºŽå¤šä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…å¯¹æ–¹æ‰§è¡Œåˆ°æŸä¸ªçŠ¶æ€åŽï¼Œè¿™äº›çº¿ç¨‹å†ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/thread/aqs/cyclicbarrier.jpg"
width="890"
height="282"
srcset="https://emerywan.github.io/blog/blog/p/thread/aqs/cyclicbarrier_hu4bbc637d91d993b0f3842d2bee476984_33199_480x0_resize_q75_box.jpg 480w, https://emerywan.github.io/blog/blog/p/thread/aqs/cyclicbarrier_hu4bbc637d91d993b0f3842d2bee476984_33199_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="cyclicbarrier"
class="gallery-image"
data-flex-grow="315"
data-flex-basis="757px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">5&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// CyclicBarrier å¯ä»¥è®¾ç½®å­çº¿ç¨‹å…¨éƒ¨åˆ°è¾¾ barrierï¼Œæ‰§è¡Œçš„ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">CyclicBarrier&lt;/span> &lt;span class="n">barrier&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CyclicBarrier&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ðŸ‘Œ äººå‘˜åˆ°é½ï¼å‡†å¤‡çˆ¬å±±ï¼&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å­çº¿ç¨‹ï¼Œæ¨¡æ‹Ÿ 5 ä¸ªåŒå­¦ç›¸çº¦çˆ¬å±±
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">5&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;åŒå­¦&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ðŸ‘‹ &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å‡†å¤‡å‡ºå‘åŽ»é›†åˆç‚¹äº†ã€‚&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ThreadLocalRandom&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">current&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ðŸ¦¶ &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;èŠ±äº† &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; ç§’åˆ°è¾¾é›†åˆç‚¹ã€‚&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ç­‰å¾…æ‰€æœ‰çš„åŒå­¦ï¼ˆå­çº¿ç¨‹ï¼‰è¿è¡Œåˆ°æ­¤å¤„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">barrier&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// å½“ await çš„çº¿ç¨‹è¶³å¤Ÿï¼Œå†ç»§ç»­æ‰§è¡Œçº¿ç¨‹åŽç»­ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">BrokenBarrierException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å’Œå¤§å®¶ä¸€èµ·çˆ¬å±±äº†ã€‚â›°&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">},&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;åŒå­¦&amp;#34;&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/thread/aqs/cyclicbarrier-result.png"
width="576"
height="450"
srcset="https://emerywan.github.io/blog/blog/p/thread/aqs/cyclicbarrier-result_huabd0a32719e9e0c5e0894dc282a3eb45_80712_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/thread/aqs/cyclicbarrier-result_huabd0a32719e9e0c5e0894dc282a3eb45_80712_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cyclicbarrier result"
class="gallery-image"
data-flex-grow="128"
data-flex-basis="307px"
>&lt;/p>
&lt;p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰ 5 ä¸ªå­çº¿ç¨‹åˆ†åˆ«å¼€å§‹æ‰§è¡Œï¼ˆ5 ä¸ªåŒå­¦ä»Žå®¶é‡Œå‡ºå‘ï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ°è¾¾æŸä¸ªçŠ¶æ€åŽ &lt;code>await()&lt;/code> è¿›è¡Œç­‰å¾…ï¼ˆæ¯ä¸ªåŒå­¦åˆ°è¾¾é›†åˆç‚¹ä¼šç­‰å¾…å…¶ä»–åŒå­¦åˆ°è¾¾ï¼‰ï¼Œå½“çº¿ç¨‹å…¨éƒ¨è¾¾åˆ°ä¹‹åŽï¼Œâ€œå±éšœâ€ä¼šé‡Šæ”¾ï¼Œçº¿ç¨‹å°†ç»§ç»­æ‰§è¡Œï¼ˆäººå‘˜åˆ°é½åŽå¼€å§‹çˆ¬å±±ï¼‰ã€‚&lt;/p>
&lt;blockquote>
&lt;p>CyclicBarrier å¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œå¯ä»¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨é‡ç½®è®¡æ•°ã€‚
ä½¿ç”¨ barrier.reset() ä¼šè¿›è¡Œé‡ç½®ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šæŠ›å‡º BrokenBarrierException&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// CyclicBarrier çš„è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å­çº¿ç¨‹çš„æ•°é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">10&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å°†å­çº¿ç¨‹çš„æ•°é‡è®¾ç½®ä¸º &lt;code>10&lt;/code>ï¼Œå¾ªçŽ¯å±éšœè®¾ç½®ä¸º &lt;code>5&lt;/code>ï¼Œå°†ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æžœï¼šæ¯æœ‰ &lt;code>5&lt;/code> ä¸ªï¼Œçº¿ç¨‹åˆ°è¾¾â€œå±éšœâ€ç‚¹ï¼Œå°±ä¼šé‡Šæ”¾ä¸€æ¬¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/thread/aqs/cyclicbarrier-result-2.png"
width="585"
height="811"
srcset="https://emerywan.github.io/blog/blog/p/thread/aqs/cyclicbarrier-result-2_hu2373c7ae3a7710cd05edc6f1f466fc13_156183_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/thread/aqs/cyclicbarrier-result-2_hu2373c7ae3a7710cd05edc6f1f466fc13_156183_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cyclicbarrier result"
class="gallery-image"
data-flex-grow="72"
data-flex-basis="173px"
>&lt;/p>
&lt;h3 id="semaphore">Semaphore&lt;/h3>
&lt;p>é€šè¿‡ä½¿ç”¨ &lt;code>Semaphore&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šæŸä¸ªèµ„æºåŒä¸€æ—¶é—´èƒ½å¤Ÿè¢«è®¿é—®çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œå®ƒç›¸å½“äºŽå¯¹æŸä¸ªèµ„æºçš„è®¿é—®è¿›è¡Œäº†æµé‡æŽ§åˆ¶ã€‚&lt;/p>
&lt;p>æ˜¯ä¸€ä¸ªå¯ä»¥è¢« n ä¸ªçº¿ç¨‹å ç”¨çš„æŽ’å®ƒé”ï¼Œå¯ä»¥åœ¨æœ€å¼€å§‹è®¾å®š &lt;code>Semaphore&lt;/code> è®¸å¯è¯æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥èŽ·å¾— 1 ä¸ªæˆ–å¤šä¸ªè®¸å¯è¯ï¼Œå½“è®¸å¯è¯è€—å°½æˆ–ä¸è¶³ä»¥ä¾›å…¶ä»–çº¿ç¨‹èŽ·å–æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°†è¢«é˜»å¡žã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">ExecutionException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">InterruptedException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Semaphore&lt;/span> &lt;span class="n">semaphore&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Semaphore&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">3&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">semaphore&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">acquire&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// æ— å‚ä¸ºç”³è¯·ä¸€ä¸ªè®¸å¯è¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ç”³è¯·è®¸å¯è¯æˆåŠŸ&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">5&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ¨¡æ‹Ÿä»»åŠ¡è€—æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">semaphore&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">release&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="reentrantlock">ReentrantLock&lt;/h3>
&lt;h3 id="reentrantreadwritelock">ReentrantReadWriteLock&lt;/h3></description></item><item><title>çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼</title><link>https://emerywan.github.io/blog/p/thread/singleton/</link><pubDate>Mon, 11 Apr 2022 18:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/thread/singleton/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/8.jpeg" alt="Featured image of post çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼" />&lt;h2 id="å•ä¾‹æ¨¡å¼">å•ä¾‹æ¨¡å¼&lt;/h2>
&lt;p>å•ä¾‹æ¨¡å¼æ‰€è¦å®žçŽ°çš„ç›®æ ‡ï¼šä¿æŒä¸€ä¸ªç±»æœ‰ä¸”åªæœ‰ä¸€ä¸ªå®žä¾‹ã€‚&lt;/p>
&lt;p>å‡ºäºŽæ€§èƒ½çš„è€ƒè™‘ï¼Œä¸å°‘å•ä¾‹æ¨¡å¼éƒ½ä¼šé‡‡ç”¨å»¶è¿ŸåŠ è½½çš„æ–¹å¼ã€‚&lt;/p>
&lt;p>æ ¹æ®æ˜¯å¦å»¶è¿ŸåŠ è½½ï¼Œå¯ä»¥åˆ†ä¸ºï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é¥¿æ±‰å¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ‡’æ±‰å¼&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å•çº¿ç¨‹çš„å•ä¾‹æ¨¡å¼">å•çº¿ç¨‹çš„å•ä¾‹æ¨¡å¼&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æž„é€ å™¨ç§æœ‰ï¼Œå…¶ä»–ç±»æ— æ³•é€šè¿‡ new åˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ›å»ºå¹¶è¿”å›žè¯¥ç±»çš„å”¯ä¸€å®žä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">someService&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸€äº›ä¸šåŠ¡ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åŠ é”çš„å•ä¾‹æ¨¡å¼">åŠ é”çš„å•ä¾‹æ¨¡å¼&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sychronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Singleton&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// æ¯æ¬¡åˆ¤ç©ºæ“ä½œï¼Œéƒ½è¦èŽ·å–é”ï¼Œå¼€é”€æžå¤§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ä½¿ç”¨åŒé‡æ£€éªŒåˆ¤æ–­&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Singleton&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ &lt;code>volatile&lt;/code> ä¿®é¥°å®žä¾‹ï¼Œåˆ©ç”¨äº†ä»¥ä¸‹ä¸¤ä¸ªä½œç”¨ï¼š&lt;/p>
&lt;p>(1) ä¿éšœå¯è§æ€§ï¼š&lt;/p>
&lt;p>ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–äº† &lt;code>instance&lt;/code> çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è¯»å–åˆ°ç›¸åº”çš„å€¼ã€‚&lt;/p>
&lt;p>(2) ä¿éšœæœ‰åºæ€§ï¼š&lt;/p>
&lt;p>ä¿éšœä¸€ä¸ªçº¿ç¨‹è¯»å–åˆ°çš„ &lt;code>instance&lt;/code> å¼•ç”¨çš„å®žä¾‹å·²ç»åˆå§‹åŒ–å®Œæ¯•ã€‚&lt;/p>
&lt;p>å¯¹è±¡å®žä¾‹åŒ–ä¼šåˆ†è§£æˆä»¥ä¸‹å‡ ä¸ªå­æ“ä½œï¼š&lt;/p>
&lt;ul>
&lt;li>åˆ†é…å¯¹è±¡æ‰€éœ€çš„ç©ºé—´&lt;/li>
&lt;li>åˆå§‹åŒ– instance å¼•ç”¨çš„å¯¹è±¡&lt;/li>
&lt;li>å°†å¯¹è±¡çš„å¼•ç”¨å†™å…¥å…±äº«å˜é‡&lt;/li>
&lt;/ul>
&lt;p>ç”±äºŽ JVM å…·æœ‰æŒ‡ä»¤é‡æŽ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ &lt;code>1-&amp;gt;3-&amp;gt;2&lt;/code>ã€‚æŒ‡ä»¤é‡æŽ’åœ¨å•çº¿ç¨‹çŽ¯å¢ƒä¸‹ä¸ä¼šå‡ºçŽ°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹èŽ·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®žä¾‹ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼šçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3 åŽï¼Œæ­¤æ—¶ T2 è°ƒç”¨ &lt;code>getInstance()&lt;/code> åŽå‘çŽ° &lt;code>instance&lt;/code> ä¸ä¸ºç©ºï¼Œå› æ­¤ç›´æŽ¥è¿”å›žï¼Œä½†æ­¤æ—¶ &lt;code>instance&lt;/code> è¿˜æœªè¢«åˆå§‹åŒ–ã€‚&lt;/p>
&lt;h3 id="é™æ€å†…éƒ¨ç±»çš„å•ä¾‹æ¨¡å¼">é™æ€å†…éƒ¨ç±»çš„å•ä¾‹æ¨¡å¼&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">InstanceHolder&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// é™æ€å†…éƒ¨ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ä¿å­˜å¤–éƒ¨ç±»çš„å”¯ä¸€å®žä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">INSTANCE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">InstanceHolder&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">INSTANCE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">someService&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getInstace&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">someService&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“å¤–éƒ¨ç±»åŠ è½½æ—¶ï¼Œå†…éƒ¨ç±»ä¸ä¼šåŠ è½½ï¼Œå¹¶ä¸”é™æ€å˜é‡åªä¼šæœ‰é»˜è®¤å€¼ï¼ˆnullï¼‰ã€‚&lt;/p>
&lt;p>ç±»çš„é™æ€å˜é‡è¢«åˆæ¬¡è®¿é—®æ‰ä¼šè§¦å‘ Java è™šæ‹Ÿæœºå¯¹è¯¥ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¼šå˜ä¸ºå…¶åˆå§‹å€¼ã€‚&lt;/p>
&lt;h3 id="æžšä¸¾å•ä¾‹">æžšä¸¾å•ä¾‹&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">INSTANCE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ç§æœ‰æž„é€ å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pubilc&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">someService&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸šåŠ¡åˆ°å—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å­—æ®µ &lt;code>INSTANCE&lt;/code> æ˜¯æžšä¸¾ç±»çš„å”¯ä¸€å®žä¾‹ã€‚åœ¨ &lt;code>Singleton.INSTANCE&lt;/code> åˆæ¬¡è¢«å¼•ç”¨æ—¶æ‰ä¼šè¢«åˆå§‹åŒ–ã€‚&lt;/p></description></item><item><title>Java å¹¶å‘ - é”æœºåˆ¶</title><link>https://emerywan.github.io/blog/p/thread/lock/</link><pubDate>Mon, 11 Apr 2022 14:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/thread/lock/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/7.jpeg" alt="Featured image of post Java å¹¶å‘ - é”æœºåˆ¶" />&lt;p>åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šå¯¹åŒä¸€ä¸ªèµ„æºè¿›è¡Œäº‰æŠ¢ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡å¼•å…¥&lt;strong>é”æœºåˆ¶&lt;/strong>ï¼Œä½¿ç”¨ä¸€ç§æŠ½è±¡çš„é”ï¼Œå¯¹èµ„æºè¿›è¡Œé”å®šï¼Œè¾¾åˆ°åŒæ­¥è®¿é—®ã€‚&lt;/p>
&lt;h2 id="å®žçŽ°">å®žçŽ°&lt;/h2>
&lt;p>Java é‡‡ç”¨äº†ä¸¤ç§å®žçŽ°æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŸºäºŽ &lt;code>Object&lt;/code> çš„æ‚²è§‚é”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŸºäºŽ &lt;code>CAS&lt;/code> çš„ä¹è§‚é”&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æ‚²è§‚é”">æ‚²è§‚é”&lt;/h2>
&lt;p>åœ¨ Java ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡ï¼ˆObjectï¼‰ï¼Œéƒ½æ‹¥æœ‰ä¸€æŠŠé”ï¼Œå­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ï¼Œè®°å½•äº†å½“å‰å¯¹è±¡è¢«å“ªä¸ªçº¿ç¨‹æ‰€å ç”¨ã€‚&lt;/p>
&lt;h3 id="å†…éƒ¨é”-synchronized">å†…éƒ¨é” synchronized&lt;/h3>
&lt;p>&lt;code>synchronized&lt;/code> å…³é”®å­—å¯ä»¥ç”¨æ¥åŒæ­¥çº¿ç¨‹ï¼Œå…¶è¢«ç¼–è¯‘åŽï¼Œä¼šç”Ÿæˆ &lt;code>monitorenter&lt;/code> å’Œ &lt;code>moniterexit&lt;/code> ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼Œç”¨æ¥è¿›è¡Œçº¿ç¨‹çš„åŒæ­¥ã€‚&lt;/p>
&lt;p>&lt;code>synchronized&lt;/code> æ˜¯éžå…¬å¹³é”ã€‚ä¸€æŠŠé”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹èŽ·å–ï¼Œæ²¡æœ‰èŽ·å¾—é”çš„çº¿ç¨‹åªèƒ½ç­‰å¾…ã€‚çº¿ç¨‹å¯¹å†…éƒ¨é”çš„ç”³è¯·å’Œé‡Šæ”¾ç”± Java è™šæ‹Ÿæœºè´Ÿè´£å®žæ–½ã€‚&lt;/p>
&lt;p>åŠ é”æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¯¹è±¡é”&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¿®é¥°å®žä¾‹æ–¹æ³• &lt;code>pubilc sychronized void method() { ... }&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»£ç å—é”ä½å½“å‰å¯¹è±¡ &lt;code>synchronized(this)&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç±»é”&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¿®é¥°é™æ€æ–¹æ³• &lt;code>public static synchronized void method() { ... }&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»£ç å—é”å®š class å¯¹è±¡ &lt;code>synchronized(MyClass.class) { ... }&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;code>synchronized&lt;/code> ä¿®é¥°çš„æ–¹æ³•ï¼Œæ— è®ºæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œè¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šé‡Šæ”¾é”ã€‚&lt;/p>
&lt;h3 id="jdk-16-å¯¹-synchronized-çš„ä¼˜åŒ–">JDK 1.6 å¯¹ synchronized çš„ä¼˜åŒ–&lt;/h3>
&lt;p>&lt;code>synchronized&lt;/code> ä¾èµ–äºŽ JVMï¼Œä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿåº•å±‚çš„ &lt;code>Mutex Lock&lt;/code> å®žçŽ°ã€‚&lt;/p>
&lt;p>Java çº¿ç¨‹çš„å®žçŽ°æ˜¯å¯¹æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„æ˜ å°„ï¼Œæ¯å½“å”¤é†’æˆ–æŒ‚èµ·ä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼Œéƒ½è¦åˆ‡æ¢åˆ°æ“ä½œç³»ç»Ÿçš„å†…æ ¸æ€ï¼Œä»£ä»·æ˜¯éžå¸¸æ˜‚è´µçš„ã€‚&lt;/p>
&lt;p>JDK 1.6 å¯¹é”çš„å®žçŽ°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚ &lt;code>é”ç²—åŒ–&lt;/code>ï¼Œ&lt;code>é”æ¶ˆé™¤&lt;/code>ï¼Œ&lt;code>è½»é‡çº§é”&lt;/code>ï¼Œ&lt;code>åå‘é”&lt;/code>ï¼Œ&lt;code>é€‚åº”æ€§è‡ªæ—‹&lt;/code>ç­‰ã€‚&lt;/p>
&lt;p>å¯¹è±¡é”ä¸€å…±æœ‰å››ç§çŠ¶æ€ï¼š&lt;/p>
&lt;blockquote>
&lt;p>æ— é” -&amp;gt; åå‘é” -&amp;gt; è½»é‡çº§é” -&amp;gt; é‡é‡çº§é”&lt;/p>
&lt;/blockquote>
&lt;p>ä¼šéšç€ç«žäº‰æƒ…å†µé€æ¸å‡çº§ï¼ˆä¸å¯ä»¥é™çº§ï¼‰ï¼Œæé«˜èŽ·å–é”å’Œé‡Šæ”¾é”çš„æ•ˆçŽ‡ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ”’ æ— é”çŠ¶æ€&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æŸäº›èµ„æºä¸ä¼šå‡ºçŽ°å¤šçº¿ç¨‹ç«žäº‰çš„æƒ…å†µï¼Œéšæ„å¤šä¸ªçº¿ç¨‹è°ƒç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ©ç”¨å…¶ä»–ä¸€äº›æ–¹å¼æŽ§åˆ¶åŒæ­¥ã€‚å¦‚ï¼šCAS&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ä¸å¯¹èµ„æºè¿›è¡Œæ“ä½œç³»ç»Ÿçº§åˆ«çš„é”å®šã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ”’ åå‘é”&lt;/p>
&lt;ul>
&lt;li>é€‚åˆåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹çš„ç«žäº‰ï¼Œæ¯æ¬¡éƒ½æ˜¯åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡èŽ·å–é”ï¼Œé‚£ä¹ˆå¯¹è±¡é”ä¼šâ€œè®°ä½â€è¿™ä¸ªçº¿ç¨‹ï¼Œåªè¦æ˜¯è¿™ä¸ªçº¿ç¨‹è¿‡æ¥ï¼Œå°±ç›´æŽ¥æŠŠé”äº¤å‡ºåŽ»ã€‚&lt;/p>
&lt;p>å¦‚æžœå¯¹è±¡å‘çŽ°ç›®å‰ä¸æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯æœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç«žäº‰é”ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ”’ è½»é‡çº§é”&lt;/p>
&lt;ul>
&lt;li>é€‚åˆåŒæ­¥ä»£ç å—çš„æ‰§è¡Œé€Ÿåº¦éžå¸¸å¿«çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å½“é”å‡çº§ä¸ºè½»é‡çº§é”çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡ CAS è¿›è¡Œè‡ªæ—‹ç­‰å¾…æ¥èŽ·å–é”ï¼Œä¸ä¼šé˜»å¡žï¼Œä»Žè€Œæé«˜æ€§èƒ½ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸ”’ é‡é‡çº§é”&lt;/p>
&lt;ul>
&lt;li>é€‚åˆåŒæ­¥ä»£ç å—æ‰§è¡Œé€Ÿåº¦è¾ƒé•¿çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å¯¹è±¡é”çŠ¶æ€è¢«æ ‡è®°ä¸ºé‡é‡çº§é”ï¼Œéœ€è¦é€šè¿‡ Monitor æ¥å¯¹çº¿ç¨‹è¿›è¡ŒæŽ§åˆ¶ã€‚&lt;/p>
&lt;h2 id="ä¹è§‚é”-cas">ä¹è§‚é” CAS&lt;/h2>
&lt;p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒåŒæ­¥ä»£ç å—æ‰§è¡Œçš„æ—¶é—´è¿œè¿œå°äºŽçº¿ç¨‹åˆ‡æ¢çš„è€—æ—¶ã€‚æ‰€ä»¥å¸Œæœ›èƒ½å¤Ÿåœ¨ç”¨æˆ·æ€ä¸­å¯¹çº¿ç¨‹çš„åˆ‡æ¢è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·æ•ˆçŽ‡æ›´é«˜ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬è®©çº¿ç¨‹â€œä¹è§‚åœ°â€åå¤å°è¯•èŽ·å–å…±äº«èµ„æºï¼Œå½“å‘çŽ°ç©ºé—²æ—¶ä¾¿è¿›è¡Œä½¿ç”¨ï¼Œå¦åˆ™ç»§ç»­â€œä¹è§‚åœ°â€è¿›è¡Œé‡è¯•ã€‚&lt;/p>
&lt;p>åŸºäºŽä»¥ä¸Šæƒ³æ³•ï¼Œè¯žç”Ÿäº† &lt;code>CAS (Compare And Swap)&lt;/code> ç®—æ³•ï¼šæ¯”è¾ƒå¹¶äº¤æ¢ã€‚&lt;/p>
&lt;p>CASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>éœ€è¦è¯»å†™çš„å†…å­˜å€¼ addr&lt;/li>
&lt;li>è¿›è¡Œæ¯”è¾ƒçš„å€¼ oldValue&lt;/li>
&lt;li>è¦å†™å…¥çš„æ–°å€¼ newValue&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">cas&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">oldValue&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">newValue&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* Executes atomically. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">addr&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">old&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span>&lt;span class="n">addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ª cas å‡½æ•°çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•åŒæ­¥æŽªæ–½ï¼Œä¼¼ä¹Žè¿˜æ˜¯å­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>å½“ A çº¿ç¨‹æ¯”è¾ƒäº† oldValue çš„å€¼æ˜¯æƒ³è¦çš„ï¼Œä½†æ˜¯è¿™ä¸ªçž¬é—´ï¼ŒB çº¿ç¨‹çªç„¶æŠ¢åˆ°äº†æ—¶é—´ç‰‡ï¼Œæ›´æ”¹äº†å€¼ï¼›ä½†æ˜¯ A çº¿ç¨‹å¹¶ä¸çŸ¥é“ï¼Œå°†å€¼æ”¹æˆäº† newValueï¼Œè¿™å°±å‡ºçŽ°äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒA B ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶èŽ·å¾—äº†èµ„æºã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œ&lt;code>CAS&lt;/code> çš„æ“ä½œå¿…é¡»æ˜¯ &lt;code>åŽŸå­æ€§&lt;/code> çš„ã€‚è¿™ä¸ªåŽŸå­æ“ä½œï¼Œ&lt;strong>ç”±è®¡ç®—æœºå¤„ç†å™¨æŒ‡ä»¤é›†æä¾›ï¼Œç›´æŽ¥ç”±ç¡¬ä»¶ä¿éšœã€‚&lt;/strong>&lt;/p>
&lt;h3 id="åŽŸå­å˜é‡ç±»">åŽŸå­å˜é‡ç±»&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>åŸºç¡€æ•°æ®ç±»åž‹&lt;/p>
&lt;ul>
&lt;li>AtomicInteger&lt;/li>
&lt;li>AtomicLong&lt;/li>
&lt;li>AtomicBoolean&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æ•°ç»„ç±»åž‹&lt;/p>
&lt;ul>
&lt;li>AtomicIntegerArray&lt;/li>
&lt;li>AtomicLongArray&lt;/li>
&lt;li>AtomicReferenceArray&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å­—æ®µæ›´æ–°ç±»åž‹&lt;/p>
&lt;ul>
&lt;li>AtomicIntegerFieldUpdater&lt;/li>
&lt;li>AtomicLongFieldUpdater&lt;/li>
&lt;li>AtomicReferenceFieldUpdater&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å¼•ç”¨ç±»åž‹&lt;/p>
&lt;ul>
&lt;li>AtomicReference&lt;/li>
&lt;li>AtomicStampedReference&lt;/li>
&lt;li>AtomicMarkableReference&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">AtomicInteger&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">AtomicInteger&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">3&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">1000&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; : &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">n&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">incrementAndGet&lt;/span>&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">},&lt;/span> &lt;span class="s">&amp;#34;Thread&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>AtomicInteger&lt;/code> ä¸»è¦ç”±ä¸€ä¸ª &lt;code>Unsafe&lt;/code> ç±»åž‹çš„å®žä¾‹ &lt;code>unsafe&lt;/code> å’Œ &lt;code>Long&lt;/code> ç±»åž‹çš„ &lt;code>offset&lt;/code> å®žçŽ°ã€‚&lt;/p>
&lt;p>Java é€šè¿‡ &lt;code>Unsafe&lt;/code> çš„ CAS æ“ä½œæ¥å¯¹ &lt;code>volatile int&lt;/code> å€¼è¿›è¡Œæ›´æ–°ã€‚æ ¹æ® &lt;code>value&lt;/code> åœ¨å¯¹è±¡ä¸­çš„åç§»é‡ï¼ŒCAS æ“ä½œå†…å­˜æ•°æ®ï¼Œæ‰§è¡Œä¸€äº›åº•å±‚ï¼Œå’Œå¹³å°ç›¸å…³çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// setup to use Unsafe.compareAndSwapInt for updates
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Unsafe&lt;/span> &lt;span class="n">unsafe&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Unsafe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getUnsafe&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">valueOffset&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">valueOffset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">unsafe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">objectFieldOffset&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">AtomicInteger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclareFiele&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Error&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¾‹å¦‚ &lt;code>incrementAndGet()&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// AtomicInteger.java
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">incrementAndGet&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">unsafe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAndAddInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">valueOffset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Unsafe.java
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getAndAddInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">delta&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">do&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">v&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getIntVolatile&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">while&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">compareAndSwapInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">delta&lt;/span>&lt;span class="o">));&lt;/span> &lt;span class="c1">// è‡ªæ—‹ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°é…ç½®ï¼Œé»˜è®¤æ˜¯ 10
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">compareAndSwapInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">expected&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¾ªçŽ¯å¼€é”€å¤§&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åªèƒ½å¤„ç†ä¸€ä¸ªå…±äº«å˜é‡&lt;/p>
&lt;ul>
&lt;li>å°è£…æˆå¯¹è±¡ AtomicReference&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ABA&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="aba-é—®é¢˜">ABA é—®é¢˜&lt;/h3>
&lt;p>CAS éœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥å†…å­˜å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šæ›´æ–°å†…å­˜å€¼ã€‚&lt;/p>
&lt;p>å¦‚æžœå†…å­˜å€¼åŽŸæ¥æ˜¯ Aï¼ŒåŽæ¥å˜æˆäº† Bï¼Œç„¶åŽåˆå˜æˆäº† Aï¼Œé‚£ä¹ˆ CAS è¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘çŽ°å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®žé™…ä¸Šæ˜¯æœ‰å˜åŒ–çš„ã€‚&lt;/p>
&lt;p>&lt;code>A -&amp;gt; B -&amp;gt; A&lt;/code>&lt;/p>
&lt;p>å¯ä»¥ä¸ºå…±äº«å˜é‡å¼•å…¥ä¸€ä¸ªä¿®è®¢å·ï¼ˆæ—¶é—´æˆ³ï¼‰ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šæ›´æ–°ç›¸åº”çš„ä¿®è®¢å·ï¼Œåˆ¤æ–­å˜é‡çš„å€¼æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹ç»™ä¿®æ”¹è¿‡ã€‚&lt;code>AtomicStampedReference&lt;/code>&lt;/p>
&lt;p>&lt;code>[A, 0] -&amp;gt; [B, 1] -&amp;gt; [A, 2]&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;World&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// initialRef initialStamp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">AtomicStampedReference&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">reference&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">AtomicStampedReference&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// expectedReference newStamp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">reference&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">attemptStamp&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">2&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// å¯¹ç‰ˆæœ¬å·è¿›è¡Œä¿®æ”¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// expectedReference newReference expectedStamp newStamp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">reference&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">compareAndSet&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">2&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">3&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// CAS æ“ä½œéœ€è¦åŒæ—¶æä¾› é¢„æœŸå€¼ æ–°å€¼ é¢„æœŸç‰ˆæœ¬å· æ–°ç‰ˆæœ¬å·
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Javaå¹¶å‘ - çº¿ç¨‹æ± </title><link>https://emerywan.github.io/blog/p/thread/threadpool/</link><pubDate>Wed, 30 Mar 2022 16:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/thread/threadpool/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/9.jpeg" alt="Featured image of post Javaå¹¶å‘ - çº¿ç¨‹æ± " />&lt;h2 id="åˆ›å»º">åˆ›å»º&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nf">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">corePoolSize&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">maximumPoolSize&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">long&lt;/span> &lt;span class="n">keepAliveTime&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BlockingQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">workQueue&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadFactory&lt;/span> &lt;span class="n">threadFactory&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RejectedExecutionHandler&lt;/span> &lt;span class="n">handler&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>&lt;code>corePoolSize&lt;/code> æ ¸å¿ƒçº¿ç¨‹æ•°&lt;/p>
&lt;ul>
&lt;li>æ¯æ¬¡å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªå¤šçº¿ç¨‹ä»»åŠ¡ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ¸å¿ƒçº¿ç¨‹ï¼Œæ— è®ºæ˜¯å¦æœ‰ç©ºé—²çº¿ç¨‹ï¼Œç›´åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°çš„æ•°é‡ï¼Œæ‰ä¼šå¼€å§‹å¤ç”¨çº¿ç¨‹èµ„æºã€‚&lt;/li>
&lt;li>ä½¿ç”¨ &lt;code>prestartAllCoreThreads()&lt;/code> ç›´æŽ¥åˆå§‹åŒ–å…¨éƒ¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>maximumPoolSize&lt;/code> æœ€å¤§çº¿ç¨‹æ•°&lt;/p>
&lt;ul>
&lt;li>å½“æ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºŽè¿è¡ŒçŠ¶æ€ï¼Œä¸”ç­‰å¾…é˜Ÿåˆ—å·²æ»¡ï¼Œä¼šå¼€å§‹åˆ›å»ºéžæ ¸å¿ƒçº¿ç¨‹ï¼Œä½†ä¸è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>keepAliveTime&lt;/code> çº¿ç¨‹æœ€å¤§ç©ºé—²æ—¶é—´&lt;/p>
&lt;ul>
&lt;li>éžæ ¸å¿ƒçº¿ç¨‹è¶…è¿‡æœ€å¤§ç©ºé—²æ—¶é—´ï¼Œä¼šè‡ªåŠ¨é”€æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>unit&lt;/code> æœ€å¤§ç©ºé—²æ—¶é—´å•ä½&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>workQueue&lt;/code> çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—&lt;/p>
&lt;ul>
&lt;li>æ ¸å¿ƒçº¿ç¨‹æ•°å·²æ»¡æ—¶ï¼Œä¼šå°†ä»»åŠ¡æš‚å­˜åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼Œç›´åˆ°çº¿ç¨‹èµ„æºå¯ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>threadFactory&lt;/code> çº¿ç¨‹åˆ›å»ºå·¥åŽ‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>handler&lt;/code> æ‹’ç»ç­–ç•¥&lt;/p>
&lt;ul>
&lt;li>å½“ç­‰å¾…é˜Ÿåˆ—å·²æ»¡ï¼Œå¹¶ä¸”è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ–°çš„ä»»åŠ¡ä¼šè¿›è¡Œæ‹’ç»å¤„ç†&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="çº¿ç¨‹æ± çš„å¤§å°">çº¿ç¨‹æ± çš„å¤§å°&lt;/h3>
&lt;ul>
&lt;li>CPU å¯†é›†åž‹&lt;/li>
&lt;/ul>
&lt;p>ä¸»è¦æ˜¯æ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼Œç›¸åº”å¾ˆå¿«ï¼ŒCPU åˆ©ç”¨çŽ‡é«˜ã€‚æŽ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•° + 1&lt;/p>
&lt;ul>
&lt;li>IO å¯†é›†åž‹&lt;/li>
&lt;/ul>
&lt;p>ä¸»è¦æ˜¯è¿›è¡Œ IO æ“ä½œï¼Œå¦‚ç¡¬ç›˜è¯»å–æ•°æ®ç­‰ï¼ŒIO æ“ä½œæ—¶é—´é•¿ï¼ŒCPU åˆ©ç”¨ä¸é«˜ï¼ŒæŽ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•° = 2 * CPU æ ¸å¿ƒæ•°ã€‚&lt;/p>
&lt;h3 id="æ‹’ç»ç­–ç•¥">æ‹’ç»ç­–ç•¥&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>AbortPolicy&lt;/p>
&lt;ul>
&lt;li>æŠ›å‡ºå¼‚å¸¸æ‹’ç»ä»»åŠ¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>DiscardPolicy&lt;/p>
&lt;ul>
&lt;li>ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œæ‹’ç»ä»»åŠ¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>DiscardOldestPolicy&lt;/p>
&lt;ul>
&lt;li>ä¸¢å¼ƒæœ€è€çš„ä»»åŠ¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>CallerRunsPolicy&lt;/p>
&lt;ul>
&lt;li>å°†ä»»åŠ¡äº¤ç»™è°ƒç”¨çº¿ç¨‹æ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="ä½¿ç”¨">ä½¿ç”¨&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// execute
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// submit
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">future&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">submit&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;è¿”å›žå€¼&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">future&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å¸¸è§çš„çº¿ç¨‹æ± ">å¸¸è§çš„çº¿ç¨‹æ± &lt;/h2>
&lt;h3 id="newsinglethreadexecutor">newSingleThreadExecutor&lt;/h3>
&lt;ul>
&lt;li>åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± &lt;/li>
&lt;li>å”¯ä¸€çº¿ç¨‹å¯ä»¥ä¿è¯æ‰€æäº¤çš„ä»»åŠ¡é¡ºåºæ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="nf">newSingleThreadExecutor&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">FinalizableDelegatedExecutorService&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">0L&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MILLISECONDS&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedBlockingQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;()));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="newfixedthreadpool">newFixedThreadPool&lt;/h3>
&lt;ul>
&lt;li>å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± &lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="nf">newFixedThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">nThreads&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">nThread&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">nThread&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">0L&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MILLISECONDS&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedBlockingQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="newcachedthreadpool">newCachedThreadPool&lt;/h3>
&lt;ul>
&lt;li>æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± &lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="nf">newCachedThreadPool&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Integer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MAX_VALUE&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">60L&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">SynchronousQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“æäº¤æ–°ä»»åŠ¡æ—¶ï¼Œå¦‚æžœçº¿ç¨‹æ± ä¸ºç©ºæˆ–æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚&lt;/p>
&lt;p>å½“çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTime=60sï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹èµ„æºã€‚é•¿æ—¶é—´ç©ºé—²çš„ CachedThreadPool ä¸ä¼šæŒæœ‰ä»»åŠ¡ä»»ä½•çº¿ç¨‹èµ„æºã€‚&lt;/p>
&lt;h2 id="scheduledthreadpoolexecutor">ScheduledThreadPoolExecutor&lt;/h2>
&lt;p>&lt;code>ScheduledThreadPoolExecutor&lt;/code> å¯ä»¥ç”¨æ¥æäº¤å®šæ—¶ä»»åŠ¡ï¼Œ&lt;code>extends ThreadPoolExecutor&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ScheduledExecutorService&lt;/span> &lt;span class="nf">newScheduledThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">corePoolSize&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ScheduledThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">corePoolSize&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>ScheduledThreadPoolExecutor&lt;/code> æœ€å¤§çº¿ç¨‹æ± å®¹é‡ä¸º &lt;code>Integer.MAX_VALUE&lt;/code>ï¼›éƒ½æ˜¯é‡‡ç”¨çš„&lt;code>DelayedWorkQueue&lt;/code> ä½œä¸ºç­‰å¾…é˜Ÿåˆ—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ScheduledExecutorService&lt;/span> &lt;span class="n">executor&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newScheduledThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å»¶è¿Ÿ 3 s åŽæ‰§è¡Œä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">schedule&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®šæ—¶ä»»åŠ¡&amp;#34;&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="n">3&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">shutdown&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ScheduledExecutorService&lt;/span> &lt;span class="n">executor&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newScheduledThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å»¶è¿Ÿ 3 s åŽï¼Œæ¯ 1 s æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">scheduleAtFixedRate&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®šæ—¶ä»»åŠ¡&amp;#34;&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="n">3&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="forkjoinpool">ForkJoinPool&lt;/h2>
&lt;blockquote>
&lt;p>Fork -&amp;gt; æ‹†åˆ† Pool -&amp;gt; åˆå¹¶&lt;/p>
&lt;/blockquote>
&lt;p>æŠŠå¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå°ä»»åŠ¡ï¼Œæœ€åŽæ±‡æ€»å¤šä¸ªå°ä»»åŠ¡çš„ç»“æžœï¼Œå¾—åˆ°æ•´å¤§ä»»åŠ¡çš„ç»“æžœã€‚è¿™äº›å°ä»»åŠ¡éƒ½æ˜¯åŒæ—¶è¿›è¡Œï¼Œå¯æé«˜è¿ç®—æ•ˆçŽ‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ForkJoinTask&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">task&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SubTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ForkJoinPool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commonPool&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">task&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">SubTask&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">RecursiveTask&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">SubTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">start&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">end&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">protected&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="nf">compute&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">end&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">125&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ä»»åŠ¡è¶³å¤Ÿå°ï¼Œç›´æŽ¥è®¡ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; å¼€å§‹è®¡ç®— &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;-&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">end&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;çš„å€¼&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä»»åŠ¡å¤ªå¤§ï¼Œæ‹†åˆ†æˆå­ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">SubTask&lt;/span> &lt;span class="n">subTask1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SubTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">end&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">2&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subTask1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">fork&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SubTask&lt;/span> &lt;span class="n">subTask2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SubTask&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">end&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">2&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subTask2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">fork&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">subTask1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">join&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">subTask2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">join&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å·¥ä½œçªƒå–ï¼š&lt;/p>
&lt;p>å­ä»»åŠ¡ä¼šè¢«æ”¾åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¼šæœ‰å¯¹åº”çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡ã€‚&lt;/p>
&lt;p>è‹¥æŸä¸ªé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è®¡ç®—å®Œæ¯•ï¼Œä½†å…¶ä»–çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­è¿˜æœ‰ä»»åŠ¡ï¼Œä¼šä»Žå…¶ä»–é˜Ÿåˆ—ä¸­â€œçªƒå–â€ä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://segmentfault.com/a/1190000039267451" target="_blank" rel="noopener"
>https://segmentfault.com/a/1190000039267451&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Java å¤šçº¿ç¨‹</title><link>https://emerywan.github.io/blog/p/thread/thread/</link><pubDate>Wed, 30 Mar 2022 14:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/thread/thread/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/9.jpeg" alt="Featured image of post Java å¤šçº¿ç¨‹" />&lt;h2 id="è¿›ç¨‹ä¸Žçº¿ç¨‹">è¿›ç¨‹ä¸Žçº¿ç¨‹&lt;/h2>
&lt;p>&lt;strong>è¿›ç¨‹&lt;/strong>æ˜¯ç¨‹åºå‘æ“ä½œç³»ç»Ÿç”³è¯·èµ„æºçš„åŸºæœ¬å•ä½ã€‚&lt;/p>
&lt;p>&lt;strong>çº¿ç¨‹&lt;/strong>æ˜¯è¿›ç¨‹ä¸­å¯ç‹¬ç«‹æ‰§è¡Œçš„æœ€å°å•ä½ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ï¼ŒåŒä¸€è¿›ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹ä¸­çš„èµ„æºã€‚&lt;/p>
&lt;h3 id="æ— å¤„ä¸åœ¨çš„çº¿ç¨‹">æ— å¤„ä¸åœ¨çš„çº¿ç¨‹&lt;/h3>
&lt;ul>
&lt;li>main çº¿ç¨‹&lt;/li>
&lt;li>åžƒåœ¾å›žæ”¶çº¿ç¨‹&lt;/li>
&lt;li>Web æœåŠ¡å™¨è¯·æ±‚å¤„ç†çº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;h2 id="çº¿ç¨‹çš„åˆ›å»º">çº¿ç¨‹çš„åˆ›å»º&lt;/h2>
&lt;h3 id="extends-thread">extends Thread&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">MyThread&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Thread&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="implement-runnable">implement Runnable&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">RunnableThread&lt;/span> &lt;span class="n">implement&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">RunnableThread&lt;/span>&lt;span class="o">()).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="implement-callable">implement Callable&amp;lt;&amp;gt;&lt;/h3>
&lt;p>Callable å¯ä»¥æœ‰è¿”å›žå€¼ï¼Œè¿”å›žå€¼é€šè¿‡ &lt;code>FutureTask&lt;/code> è¿›è¡Œå°è£…ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">CallbaleThead&lt;/span> &lt;span class="n">implement&lt;/span> &lt;span class="n">Callbale&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="nf">call&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">Exception&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">666&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">FutureTask&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">futureTask&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">FutureTask&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">CallbaleThead&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">futureTask&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">futureTask&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/thread/thread/FutureTask.png"
width="964"
height="706"
srcset="https://emerywan.github.io/blog/blog/p/thread/thread/FutureTask_hu6b05634f3a5f84702cb4db413d8bbef5_51410_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/thread/thread/FutureTask_hu6b05634f3a5f84702cb4db413d8bbef5_51410_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="FutureTask"
class="gallery-image"
data-flex-grow="136"
data-flex-basis="327px"
>&lt;/p>
&lt;h3 id="çº¿ç¨‹æ± ">çº¿ç¨‹æ± &lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="n">executorService&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newFixThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">10&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">executorService&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="n">executorService&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newFixThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">future&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">executorService&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">submit&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">666&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">future&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ">çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Thread&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">State&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">NEW&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RUNNABLE&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BLOCKED&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">WAITING&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TIMED_WAITING&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TErMINATED&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ–°å»º &lt;code>New&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åˆ›å»ºåŽå°šæœªå¯åŠ¨ã€‚&lt;/p>
&lt;ul>
&lt;li>å¯è¿è¡Œ &lt;code>Runnable&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å¯èƒ½æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½æ­£åœ¨ç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚&lt;/p>
&lt;ul>
&lt;li>é˜»å¡ž &lt;code>Blocking&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ç­‰å¾…èŽ·å–ä¸€ä¸ªæŽ’å®ƒé”ï¼Œå¦‚æžœå…¶çº¿ç¨‹é‡Šæ”¾äº†é”å°±ä¼šç»“æŸæ­¤çŠ¶æ€ã€‚&lt;/p>
&lt;ul>
&lt;li>æ— é™æœŸç­‰å¾… &lt;code>Waiting&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œå¦åˆ™ä¸ä¼šè¢«åˆ†é… CPU æ—¶é—´ç‰‡ã€‚&lt;/p>
&lt;ul>
&lt;li>é™æœŸç­‰å¾… &lt;code>Timed Waiting&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ— éœ€ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åŽä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ã€‚&lt;/p>
&lt;ul>
&lt;li>æ­»äº¡ &lt;code>Terminated&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>çº¿ç¨‹ç»“æŸä»»åŠ¡ä¹‹åŽè‡ªå·±ç»“æŸï¼Œæˆ–è€…äº§ç”Ÿäº†å¼‚å¸¸è€Œç»“æŸã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://pdai.tech/md/java/thread/java-thread-x-thread-basic.html#%e5%ae%9e%e7%8e%b0-callable-%e6%8e%a5%e5%8f%a3" target="_blank" rel="noopener"
>https://pdai.tech/md/java/thread/java-thread-x-thread-basic.html#%e5%ae%9e%e7%8e%b0-callable-%e6%8e%a5%e5%8f%a3&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>é€šç”¨ç¨‹åºè®¾è®¡</title><link>https://emerywan.github.io/blog/p/effective-java/general-programming/</link><pubDate>Wed, 30 Mar 2022 14:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/effective-java/general-programming/</guid><description>&lt;img src="https://emerywan.github.io/blog/p/effective-java/general-programming/effective-java.png" alt="Featured image of post é€šç”¨ç¨‹åºè®¾è®¡" />&lt;h1 id="-é€šç”¨ç¨‹åºè®¾è®¡">â˜˜ï¸ é€šç”¨ç¨‹åºè®¾è®¡&lt;/h1>
&lt;p>Effective Java é˜…è¯»ç¬”è®°ã€‚æœ¬ç« ä¸»è¦è®¨è®ºäº† &lt;code>Java&lt;/code> è¯­è¨€çš„å…·ä½“ç»†èŠ‚ã€‚åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>å±€éƒ¨å˜é‡&lt;/li>
&lt;li>æŽ§åˆ¶ç»“æž„&lt;/li>
&lt;li>ç±»åº“&lt;/li>
&lt;li>æ•°æ®ç»“æž„&lt;/li>
&lt;li>ä¸æ˜¯ç”±è¯­è¨€æœ¬èº«æä¾›çš„æœºåˆ¶&lt;/li>
&lt;li>ä¼˜åŒ–å’Œå‘½åæƒ¯ä¾‹ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="57-å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–">57. å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–&lt;/h2>
&lt;h3 id="-å»ºè®®">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± æœ€å°åŒ–å±€éƒ¨å˜é‡çš„èŒƒå›´ï¼Œå¯æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œé™ä½Žå‡ºé”™çš„å¯èƒ½æ€§ã€‚&lt;strong>åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å®ƒçš„åœ°æ–¹å£°æ˜Žå˜é‡ã€‚&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ æ¯ä¸ªå±€éƒ¨å˜é‡å£°æ˜Žéƒ½åº”è¯¥åŒ…å«ä¸€ä¸ªåˆå§‹åŒ–è¡¨è¾¾å¼ã€‚&lt;code>try-catch&lt;/code> è¯­å¥é™¤å¤–ã€‚&lt;/p>
&lt;p>å¦‚æžœä¸€ä¸ªå˜é‡åˆå§‹åŒ–ï¼Œä¼šæŠ›å‡ºä¸€ä¸ª checked å¼‚å¸¸ï¼Œå¿…é¡»åœ¨ &lt;code>try&lt;/code> ä¸­åˆå§‹åŒ–ï¼ˆé™¤éžæ‰€åŒ…å«çš„æ–¹æ³•å¯ä»¥æŠ›å¼‚å¸¸ï¼‰ã€‚&lt;/p>
&lt;p>å¦‚æžœè¯¥å€¼å¿…é¡»åœ¨ &lt;code>try&lt;/code> å—ä¹‹å¤–ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åœ¨ &lt;code>try&lt;/code> å—ä¹‹å‰å£°æ˜Žï¼Œæ­¤æ—¶å®ƒè¿˜ä¸èƒ½â€œåˆç†åœ°åˆå§‹åŒ–â€œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cons&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸ€ å¾ªçŽ¯ç»“æŸåŽä¸å†éœ€è¦å¾ªçŽ¯å˜é‡ï¼Œ&lt;code>for&lt;/code> å¾ªçŽ¯å°±ä¼˜äºŽ &lt;code>while&lt;/code> å¾ªçŽ¯ï¼ˆ&lt;code>for&lt;/code> å¾ªçŽ¯å…è®¸å£°æ˜Žå¾ªçŽ¯å˜é‡ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± ä¿æŒæ–¹æ³•å°è€Œé›†ä¸­ï¼Œæ¯ä¸ªæ“ä½œéƒ½ç”¨ä¸€ä¸ªæ–¹æ³•æ¥å®Œæˆã€‚é¿å…ä¸€ä¸ªæ“ä½œç›¸å…³çš„å±€éƒ¨å˜é‡å¯èƒ½åœ¨å¦ä¸€ä¸ªæ“ä½œä¸­ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹">ðŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ¾ éåŽ†é›†åˆçš„é¦–é€‰ä¹ æƒ¯ç”¨æ³•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Element&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do something with e
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸ’ éœ€è¦è®¿é—® &lt;code>Iterator&lt;/code> / è°ƒç”¨ &lt;code>Iterator&lt;/code> çš„ &lt;code>remove()&lt;/code>ï¼Œé¦–é€‰ &lt;code>for&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// i is loop variable
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Element&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do something with i and e
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸ’ å¾ªçŽ¯ä¹ æƒ¯ç”¨æ³•ï¼šæœ€å°åŒ–å±€éƒ¨å˜é‡çš„èŒƒå›´&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ¯æ¬¡å¾ªçŽ¯éƒ½ä¼šè°ƒç”¨ expensiveComputation()ï¼Œä¸”è¿”å›žç»“æžœç›¸åŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">expensiveComputation&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do something with i
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®ƒæœ‰ä¸¤ä¸ªå¾ªçŽ¯å˜é‡ï¼ši å’Œ nï¼Œéƒ½å…·æœ‰å®Œå…¨æ­£ç¡®çš„ä½œç”¨åŸŸã€‚ç¬¬äºŒä¸ªå˜é‡ n ç”¨äºŽå­˜å‚¨ç¬¬ä¸€ä¸ªå˜é‡çš„æžé™ï¼Œé¿å…äº†æ¯æ¬¡è¿­ä»£ä¸­å†—ä½™è®¡ç®—çš„æˆæœ¬ã€‚
å¦‚æžœå¾ªçŽ¯æ¶‰åŠä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸”ä¿è¯åœ¨æ¯æ¬¡è¿­ä»£ä¸­è¿”å›žç›¸åŒçš„ç»“æžœï¼Œåº”è¯¥ä½¿ç”¨è¿™ä¸ªä¹ æƒ¯ç”¨æ³•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="58-for-each-å¾ªçŽ¯ä¼˜äºŽä¼ ç»Ÿçš„-for-å¾ªçŽ¯">58. for-each å¾ªçŽ¯ä¼˜äºŽä¼ ç»Ÿçš„ for å¾ªçŽ¯&lt;/h2>
&lt;h3 id="-å»ºè®®-1">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± &lt;code>for-each&lt;/code> éšè—è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡ï¼Œå¯æ¶ˆé™¤æ··ä¹±å’Œå‡ºé”™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± &lt;code>:&lt;/code> è¡¨ç¤º â€œåœ¨&amp;hellip;é‡Œé¢â€ã€‚ä½¿ç”¨ &lt;code>for-each&lt;/code> å¾ªçŽ¯ä¸ä¼šé™ä½Žæ€§èƒ½ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¥€ ä»¥ä¸‹æƒ…å†µä¸åº”è¯¥ä½¿ç”¨ &lt;code>for-each&lt;/code>ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ° ç ´åæ€§è¿‡æ»¤ã€‚å¦‚æžœéœ€è¦éåŽ†ä¸€ä¸ªé›†åˆå¹¶åˆ é™¤é€‰å®šå…ƒç´ ï¼Œéœ€è¦ä½¿ç”¨æ˜¾å¼çš„è¿­ä»£å™¨ï¼Œä»¥ä¾¿è°ƒç”¨å…¶ &lt;code>remove()&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ° è½¬æ¢ã€‚éåŽ†æ—¶éœ€è¦æ›¿æ¢å…¶ä¸­å…ƒç´ çš„å€¼ï¼Œéœ€è¦ &lt;code>List&lt;/code> è¿­ä»£å™¨æˆ–æ•°ç»„ç´¢å¼•æ¥æ›¿æ¢å…ƒç´ çš„å€¼ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ° å¹¶è¡Œè¿­ä»£ã€‚å¦‚æžœéœ€è¦å¹¶è¡ŒéåŽ†å¤šä¸ªé›†åˆï¼Œé‚£ä¹ˆéœ€è¦æ˜¾å¼åœ°æŽ§åˆ¶è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡ï¼Œä»¥ä¾¿æ‰€æœ‰è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡éƒ½å¯ä»¥åŒæ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-1">ðŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ’ ä½¿ç”¨ &lt;code>Collection.removeIf()&lt;/code> å¯é¿å…æ˜¾å¼çš„éåŽ†ï¼ˆJava8ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">Collection&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Iterable&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Predicate&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">filter&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Objects&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">requireNonNull&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">removed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">each&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">interator&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">each&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">test&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">each&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">each&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">removed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">removed&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h2 id="59-äº†è§£å¹¶ä½¿ç”¨åº“">59. äº†è§£å¹¶ä½¿ç”¨åº“&lt;/h2>
&lt;h3 id="-å»ºè®®-2">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;p>&lt;strong>èƒ½ç”¨åº“æ–¹æ³•å°±ç”¨åº“æ–¹æ³•ã€‚&lt;/strong>&lt;/p>
&lt;p>å…·æœ‰ç®—æ³•èƒŒæ™¯çš„é«˜çº§å·¥ç¨‹å¸ˆèŠ±äº†å¤§é‡æ—¶é—´è®¾è®¡ã€å®žçŽ°å’Œæµ‹è¯•åº“æ–¹æ³•ï¼Œç„¶åŽå°†åº“æ–¹æ³•å±•ç¤ºç»™è¯¥é¢†åŸŸçš„å‡ ä½ä¸“å®¶ï¼Œä»¥ç¡®ä¿åº“æ–¹æ³•æ˜¯æ­£ç¡®çš„ã€‚
è¿™äº›åº“æ–¹æ³•ç»è¿‡ beta æµ‹è¯•ã€å‘å¸ƒï¼Œå¹¶è¢«æ•°ç™¾ä¸‡ç¨‹åºå‘˜å¹¿æ³›ä½¿ç”¨äº†è¿‘ 20 å¹´ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± ä½¿ç”¨æ ‡å‡†ç±»åº“çš„å¥½å¤„ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° åˆ©ç”¨ç¼–å†™å®ƒçš„ä¸“å®¶çš„çŸ¥è¯†å’Œä»¥å‰ä½¿ç”¨å®ƒçš„äººçš„ç»éªŒã€‚&lt;/li>
&lt;li>ðŸŒ° ä¸å¿…æµªè´¹æ—¶é—´ä¸ºé‚£äº›ä¸Žä½ çš„å·¥ä½œæ— å…³çš„é—®é¢˜ç¼–å†™ä¸“é—¨çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/li>
&lt;li>ðŸŒ° éšç€æ—¶é—´çš„æŽ¨ç§»ï¼Œå®ƒä»¬çš„æ€§èƒ½ä¼šä¸æ–­æé«˜ï¼Œæ— éœ€ä»˜å‡ºä»»ä½•åŠªåŠ›ã€‚ï¼ˆç‰ˆæœ¬æ›´æ–°ï¼‰&lt;/li>
&lt;li>ðŸŒ° å¯ä»¥å°†ä»£ç æ”¾åœ¨ä¸»å¹²ä¸­ã€‚è¿™æ ·çš„ä»£ç æ›´å®¹æ˜“è¢«å¼€å‘äººå‘˜é˜…è¯»ã€ç»´æŠ¤å’Œå¤ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± åœ¨æ¯ä¸ªä¸»è¦ç‰ˆæœ¬ä¸­ï¼Œéƒ½ä¼šå‘åº“ä¸­æ·»åŠ è®¸å¤šç‰¹æ€§ï¼Œäº†è§£è¿™äº›æ–°å¢žç‰¹æ€§æ˜¯å€¼å¾—çš„ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ æ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥ç†Ÿæ‚‰ &lt;code>java.lang&lt;/code>ã€&lt;code>java.util&lt;/code> å’Œ &lt;code>java.io&lt;/code> çš„åŸºç¡€çŸ¥è¯†åŠå…¶å­åŒ…ã€‚ å…¶ä»–åº“çš„çŸ¥è¯†å¯ä»¥æ ¹æ®éœ€è¦èŽ·å¾—ã€‚å°¤å…¶æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° &lt;code>java.util.Collections&lt;/code>&lt;/li>
&lt;li>ðŸŒ° &lt;code>java.util.Streams&lt;/code>&lt;/li>
&lt;li>ðŸŒ° &lt;code>java.util.concurrent&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å¦‚æžœä½ åœ¨ Java å¹³å°åº“ä¸­æ‰¾ä¸åˆ°ä½ éœ€è¦çš„ä¸œè¥¿ï¼Œä½ çš„ä¸‹ä¸€ä¸ªé€‰æ‹©åº”è¯¥æ˜¯å¯»æ‰¾é«˜è´¨é‡çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚è°·æ­Œçš„ä¼˜ç§€çš„å¼€æº &lt;code>Guava&lt;/code> åº“ã€‚å¦‚æžœä½ æ— æ³•åœ¨ä»»ä½•é€‚å½“çš„åº“ä¸­æ‰¾åˆ°æ‰€éœ€çš„åŠŸèƒ½ï¼Œåªèƒ½è‡ªå·±å®žçŽ°å®ƒã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-2">ðŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ’ ä»Ž Java 7 å¼€å§‹ï¼Œå°±ä¸åº”è¯¥å†ä½¿ç”¨ Randomã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ° åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé€‰æ‹©çš„éšæœºæ•°ç”Ÿæˆå™¨çŽ°åœ¨æ˜¯ &lt;code>ThreadLocalRandom&lt;/code>ã€‚ å®ƒèƒ½äº§ç”Ÿæ›´é«˜è´¨é‡çš„éšæœºæ•°ï¼Œè€Œä¸”é€Ÿåº¦éžå¸¸å¿«ã€‚&lt;code>ThreadLocalRandom.current().nextInt(100)&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ° å¯¹äºŽ &lt;code>Fork Join Pool&lt;/code> å’Œå¹¶è¡Œ &lt;code>Stream&lt;/code>ï¼Œä½¿ç”¨ &lt;code>SplittableRandom&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å‡è®¾ä½ æƒ³è¦ç”Ÿæˆ 0 åˆ°æŸä¸ªä¸Šç•Œä¹‹é—´çš„éšæœºæ•´æ•°ï¼Œè®¸å¤šç¨‹åºå‘˜ä¼šç¼–å†™ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„å°æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æœ‰ä¸¥é‡ç¼ºé™·
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">static&lt;/span> &lt;span class="n">Random&lt;/span> &lt;span class="n">rnd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Random&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">random&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">Math&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">abs&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">rad&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®ƒæœ‰ä¸‰ä¸ªç¼ºç‚¹:&lt;/p>
&lt;ul>
&lt;li>ðŸŒ© n æ˜¯å°çš„å¹³æ–¹æ•°ï¼Œéšæœºæ•°åºåˆ—ä¼šåœ¨ç›¸å½“çŸ­çš„æ—¶é—´å†…é‡å¤&lt;/li>
&lt;li>ðŸŒ© å¦‚æžœ n ä¸æ˜¯ 2 çš„å¹‚ï¼Œé‚£ä¹ˆå¹³å‡è€Œè¨€ï¼Œä¸€äº›æ•°å­—å°†æ¯”å…¶ä»–æ•°å­—æ›´é¢‘ç¹åœ°è¿”å›ž&lt;/li>
&lt;li>ðŸŒ© åœ¨æžå°‘æ•°æƒ…å†µä¸‹ä¼šè¿”å›žè¶…å‡ºæŒ‡å®šèŒƒå›´çš„æ•°å­— &lt;code>Integer.MAX_VALUE&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>åº”è¯¥ç›´æŽ¥ä½¿ç”¨ç±»åº“ &lt;code>Ramdom.nextInt(n)&lt;/code> ï¼Œè€Œä¸æ˜¯è‡ªå·±å°è£…&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">nextInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸŒ¾ Linux &lt;code>curl&lt;/code> in Java 9&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å‡è®¾ä½ æƒ³ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥æ‰“å°å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„ URL çš„å†…å®¹ï¼ˆè¿™å¤§è‡´æ˜¯ Linux &lt;code>curl&lt;/code> å‘½ä»¤æ‰€åšçš„ï¼‰ã€‚åœ¨ Java 9 ä¹‹å‰ï¼Œè¿™æ®µä»£ç æœ‰ç‚¹ä¹å‘³ï¼Œä½†æ˜¯åœ¨ Java 9 ä¸­ï¼Œ&lt;code>transferTo()&lt;/code> è¢«æ·»åŠ åˆ° &lt;code>InputStream&lt;/code> ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨è¿™ä¸ªæ–°æ–¹æ³•æ‰§è¡Œè¿™é¡¹ä»»åŠ¡çš„å®Œæ•´ç¨‹åºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IOException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InputStream&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">URL&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">]).&lt;/span>&lt;span class="na">openStream&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">in&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">transferTo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="60-è‹¥éœ€è¦ç²¾ç¡®ç­”æ¡ˆå°±åº”é¿å…ä½¿ç”¨-float-double">60. è‹¥éœ€è¦ç²¾ç¡®ç­”æ¡ˆå°±åº”é¿å…ä½¿ç”¨ float double&lt;/h2>
&lt;h3 id="-å»ºè®®-3">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>ðŸŒ± &lt;code>float&lt;/code> å’Œ &lt;code>double&lt;/code> ç±»åž‹ç‰¹åˆ«ä¸é€‚åˆè¿›è¡Œè´§å¸è®¡ç®—ï¼Œå› ä¸ºä¸èƒ½å°† 0.1ï¼ˆæˆ– 10 çš„ä»»æ„è´Ÿæ¬¡å¹‚ï¼‰ç²¾ç¡®åœ°è¡¨ç¤ºã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 0.6100000000000001
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">03&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">42&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ðŸ€ æ•°å€¼ä¸æ˜¯å¤ªå¤§ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>int&lt;/code> æˆ– &lt;code>long&lt;/code>
&lt;ul>
&lt;li>ðŸŒ° å¦‚æžœæ•°å€¼ä¸è¶…è¿‡ 9 ä½å°æ•°ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>int&lt;/code>&lt;/li>
&lt;li>ðŸŒ° å¦‚æžœä¸è¶…è¿‡ 18 ä½ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>long&lt;/code>&lt;/li>
&lt;li>ðŸŒ° å¦‚æžœæ•°é‡å¯èƒ½è¶…è¿‡ 18 ä½ï¼Œåˆ™ä½¿ç”¨ &lt;code>BigDecimal&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>ä¾‹å¦‚ï¼šåœ¨å¾®ä¿¡æ”¯ä»˜çš„ &lt;code>Java SDK&lt;/code> ä¸­ï¼Œè´§å¸çš„ç±»åž‹ä¸º &lt;code>int&lt;/code>ï¼Œç»“ç®—å•ä½ä¸º åˆ†ï¼›
åœ¨æ”¯ä»˜å®æ”¯ä»˜çš„ &lt;code>Java SDK&lt;/code> ä¸­ï¼Œè´§å¸çš„ç±»åž‹ä¸º &lt;code>String&lt;/code>ï¼Œç»“ç®—å•ä½ä¸º å…ƒ&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>ðŸŒ± ä½¿ç”¨ &lt;code>BigDecimal&lt;/code> ç±»åž‹ä»£æ›¿ &lt;code>double / float&lt;/code>ã€‚æ³¨æ„ï¼Œ&lt;strong>ä½¿ç”¨ &lt;code>BigDecimal&lt;/code> çš„ &lt;code>String&lt;/code> æž„é€ å‡½æ•°è€Œä¸æ˜¯å®ƒçš„ &lt;code>double / float&lt;/code> æž„é€ å‡½æ•°ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h2 id="61-åŸºæœ¬æ•°æ®ç±»åž‹ä¼˜äºŽåŒ…è£…ç±»">61. åŸºæœ¬æ•°æ®ç±»åž‹ä¼˜äºŽåŒ…è£…ç±»&lt;/h2>
&lt;h3 id="-å»ºè®®-4">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± Java ç±»åž‹ç³»ç»Ÿç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° åŸºæœ¬ç±»åž‹ï¼ˆprimitive typeï¼‰ï¼š&lt;code>int double boolean&lt;/code>&lt;/li>
&lt;li>ðŸŒ° å¼•ç”¨ç±»åž‹ï¼ˆreference typeï¼‰ï¼š&lt;code>String List&lt;/code>
æ¯ä¸ªåŸºæœ¬ç±»åž‹éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å¼•ç”¨ç±»åž‹ï¼Œç§°ä¸ºåŒ…è£…ç±»åž‹ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± åŸºæœ¬ç±»åž‹å’ŒåŒ…è£…ç±»åž‹ä¹‹é—´æœ‰ä¸‰ä¸ªä¸»è¦åŒºåˆ«ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° åŸºæœ¬ç±»åž‹åªæœ‰å®ƒä»¬çš„å€¼ï¼Œè€ŒåŒ…è£…ç±»åž‹å…·æœ‰ä¸Žå…¶å€¼ä¸åŒçš„æ ‡è¯†&lt;/li>
&lt;li>ðŸŒ° åŸºæœ¬ç±»åž‹åªæœ‰å…¨åŠŸèƒ½å€¼ï¼Œè€Œæ¯ä¸ªåŒ…è£…ç±»åž‹é™¤äº†å¯¹åº”çš„åŸºæœ¬ç±»åž‹çš„æ‰€æœ‰åŠŸèƒ½å€¼å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéžåŠŸèƒ½å€¼ï¼Œå³ &lt;code>null&lt;/code>&lt;/li>
&lt;li>ðŸŒ° åŸºæœ¬ç±»åž‹æ¯”åŒ…è£…ç±»åž‹æ›´èŠ‚çœæ—¶é—´å’Œç©ºé—´&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ è¦æœ‰é€‰æ‹©ï¼Œå°±åº”è¯¥ä¼˜å…ˆä½¿ç”¨åŸºæœ¬ç±»åž‹ï¼Œè€Œä¸æ˜¯åŒ…è£…ç±»åž‹ã€‚åŸºæœ¬ç±»åž‹æ›´ç®€å•ã€æ›´å¿«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¥€ ä»¥ä¸‹æƒ…å†µå¿…é¡»ä½¿ç”¨åŒ…è£…ç±»åž‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° ä½œä¸ºé›†åˆä¸­çš„å…ƒç´ ã€é”®å’Œå€¼&lt;/li>
&lt;li>ðŸŒ° å¿…é¡»ä½¿ç”¨åŒ…è£…ç±»åž‹ä½œä¸ºç±»åž‹å‚æ•°ï¼Œ&lt;code>Java&lt;/code> ä¸å…è®¸ä½¿ç”¨åŸºæœ¬ç±»åž‹ã€‚å¦‚ &lt;code>ThreadLocal&amp;lt;Integer&amp;gt;&lt;/code>&lt;/li>
&lt;li>ðŸŒ° è¿›è¡Œåå°„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¿…é¡»ä½¿ç”¨åŒ…è£…ç±»åž‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-3">ðŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ¾ ä»¥ä¸‹ä¸‰ä¸ªä¾‹å­ä¸ºå¸¸è§çš„åŒ…è£…ç±»åž‹é—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ© å°† &lt;code>==&lt;/code> æ“ä½œç¬¦åº”ç”¨äºŽåŒ…è£…ç±»åž‹å‡ ä¹Žéƒ½æ˜¯é”™è¯¯çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™…&lt;/span>&lt;span class="n">â€&lt;/span>&lt;span class="err">â™‚&lt;/span>&lt;span class="n">ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Comparator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">naturalOrder&lt;/span> &lt;span class="o">=(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">0&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¡¨è¾¾å¼ &lt;code>i &amp;lt; j&lt;/code> ä¼šä½¿ i å’Œ j å¼•ç”¨çš„ &lt;code>Integer&lt;/code> å®žä¾‹è‡ªåŠ¨æ‹†ç®±ã€‚
è¡¨è¾¾å¼ &lt;code>i == j&lt;/code> å¯¹ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ‰§è¡Œæ¯”è¾ƒï¼Œè¿”å›ž &lt;code>false&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Comparator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">naturalOrder&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">iBoxed&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">jBoxed&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iBoxed&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">jBoxed&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// è‡ªåŠ¨æ‹†ç®±
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">0&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸŒ© &lt;code>NullPointerException&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Unbelievable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">42&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Unbelievable&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è®¡ç®—è¡¨è¾¾å¼ &lt;code>i == 42&lt;/code> æ—¶æŠ›å‡º &lt;code>NullPointerException&lt;/code>ã€‚ç©ºå¯¹è±¡å¼•ç”¨è‡ªåŠ¨æ‹†ç®±ï¼Œå°†å¾—åˆ°ä¸€ä¸ª &lt;code>NullPointerException&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ© ä¸¥é‡çš„æ€§èƒ½é—®é¢˜&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Long&lt;/span> &lt;span class="n">sum&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0L&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">Integer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MAX_VALUE&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å±€éƒ¨å˜é‡ &lt;code>sum&lt;/code>ï¼Œå®ƒæ˜¯åŒ…è£…ç±»åž‹ &lt;code>Long&lt;/code>ï¼Œè€Œä¸æ˜¯åŸºæœ¬ç±»åž‹ &lt;code>long&lt;/code>ã€‚å˜é‡è¢«åå¤è£…ç®±å’Œæ‹†ç®±ï¼ˆè¶…å‡ºç¼“å­˜éƒ¨åˆ†æ—¶ï¼‰ï¼Œå¯¼è‡´äº§ç”Ÿæ˜Žæ˜¾çš„æ€§èƒ½ä¸‹é™ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="62-å…¶ä»–ç±»åž‹æ›´åˆé€‚æ—¶åº”é¿å…ä½¿ç”¨å­—ç¬¦ä¸²">62. å…¶ä»–ç±»åž‹æ›´åˆé€‚æ—¶ï¼Œåº”é¿å…ä½¿ç”¨å­—ç¬¦ä¸²&lt;/h2>
&lt;h3 id="-å»ºè®®-5">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± å½“å­˜åœ¨æˆ–å¯ä»¥ç¼–å†™æ›´å¥½çš„æ•°æ®ç±»åž‹æ—¶ï¼Œåº”é¿å…å°†å­—ç¬¦ä¸²ç”¨æ¥è¡¨ç¤ºå¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å¦‚æžœä½¿ç”¨ä¸å½“ï¼Œå­—ç¬¦ä¸²æ¯”å…¶ä»–ç±»åž‹æ›´éº»çƒ¦ã€çµæ´»æ€§æ›´å·®ã€é€Ÿåº¦æ›´æ…¢ã€æ›´å®¹æ˜“å‡ºé”™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿å…¶ä»–çš„å€¼ç±»åž‹ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° å¦‚æžœæ˜¯æ•°å€¼ç±»åž‹ï¼Œåˆ™åº”å°†å…¶è½¬æ¢ä¸ºé€‚å½“çš„æ•°å€¼ç±»åž‹ï¼Œå¦‚ &lt;code>int&lt;/code>ã€&lt;code>float&lt;/code> æˆ– &lt;code>BigInteger&lt;/code>ã€‚&lt;/li>
&lt;li>ðŸŒ° å¦‚æžœæ˜¯é—®é¢˜çš„ç­”æ¡ˆï¼Œå¦‚â€œæ˜¯â€æˆ–â€œå¦â€è¿™ç±»å½¢å¼ï¼Œåˆ™åº”å°†å…¶è½¬æ¢ä¸ºé€‚å½“çš„ &lt;code>Enum&lt;/code> æˆ– &lt;code>boolean&lt;/code>ã€‚&lt;/li>
&lt;li>ðŸŒ° æ›´ä¸€èˆ¬åœ°ï¼Œå¦‚æžœæœ‰åˆé€‚çš„å€¼ç±»åž‹ï¼Œæ— è®ºæ˜¯åŸºæœ¬ç±»åž‹è¿˜æ˜¯å¯¹è±¡å¼•ç”¨ï¼Œéƒ½åº”è¯¥ä½¿ç”¨å®ƒï¼›å¦‚æžœæ²¡æœ‰ï¼Œåº”è¯¥å†™ä¸€ä¸ªã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿æžšä¸¾ç±»åž‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿èšåˆç±»åž‹ã€‚&lt;/p>
&lt;p>å¦‚æžœä¸€ä¸ªå®žä½“æœ‰å¤šä¸ªç»„ä»¶ï¼Œå°†å…¶è¡¨ç¤ºä¸ºå•ä¸ªå­—ç¬¦ä¸²é€šå¸¸æ˜¯å¾ˆä¸åˆé€‚çš„ã€‚
ä¾‹å¦‚ï¼Œä¸‹é¢è¿™è¡Œä»£ç æ¥è‡ªä¸€ä¸ªçœŸå®žçš„ç³»ç»Ÿæ ‡è¯†ç¬¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">compoundKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">className&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;#&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ç§æ–¹æ³•æœ‰å¾ˆå¤šç¼ºç‚¹ï¼šå¦‚æžœç”¨äºŽåˆ†éš”å­—æ®µ &lt;code>#&lt;/code> çš„å­—ç¬¦å‡ºçŽ°åœ¨å…¶ä¸­ä¸€ä¸ªå­—æ®µä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ··ä¹±ã€‚è¦è®¿é—®å„ä¸ªå­—æ®µï¼Œä½ å¿…é¡»è§£æžå­—ç¬¦ä¸²ã€‚ä¸èƒ½æä¾› &lt;code>equals&lt;/code>ã€&lt;code>toString&lt;/code> æˆ– &lt;code>compareTo&lt;/code> æ–¹æ³•ï¼Œä½†å¿…é¡»æŽ¥å— &lt;code>String&lt;/code> æä¾›çš„è¡Œä¸ºã€‚
æ›´å¥½çš„æ–¹æ³•æ˜¯ç¼–å†™ä¸€ä¸ªç±»æ¥è¡¨ç¤ºèšåˆï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç§æœ‰é™æ€æˆå‘˜ç±»ã€‚ï¼ˆItem-24ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿ capabilities&lt;/p>
&lt;p>æœ‰æ—¶ï¼Œå­—ç¬¦ä¸²ç”¨äºŽæŽˆäºˆå¯¹æŸäº›åŠŸèƒ½çš„è®¿é—®æƒã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œè€ƒè™‘çº¿ç¨‹æœ¬åœ°å˜é‡æœºåˆ¶çš„è®¾è®¡ã€‚è¿™æ ·çš„æœºåˆ¶æä¾›äº†æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å˜é‡å€¼ã€‚
è¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºŽï¼šå­—ç¬¦ä¸²é”®è¡¨ç¤ºçº¿ç¨‹æœ¬åœ°å˜é‡çš„å…±äº«å…¨å±€åç§°ç©ºé—´ã€‚
ä¸ºäº†ä½¿è¿™ç§æ–¹æ³•æœ‰æ•ˆï¼Œå®¢æˆ·ç«¯æä¾›çš„å­—ç¬¦ä¸²é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼šå¦‚æžœä¸¤ä¸ªå®¢æˆ·ç«¯å„è‡ªå†³å®šä¸ºå®ƒä»¬çš„çº¿ç¨‹æœ¬åœ°å˜é‡ä½¿ç”¨ç›¸åŒçš„åç§°ï¼Œå®ƒä»¬æ— æ„ä¸­å°±ä¼šå…±äº«ä¸€ä¸ªå˜é‡ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´ä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½å¤±è´¥ã€‚
è€Œä¸”å®‰å…¨æ€§å¾ˆå·®ã€‚æ¶æ„å®¢æˆ·ç«¯å¯ä»¥æ•…æ„ä½¿ç”¨ä¸Žå¦ä¸€ä¸ªå®¢æˆ·ç«¯ç›¸åŒçš„å­—ç¬¦ä¸²å¯†é’¥æ¥éžæ³•è®¿é—®å¦ä¸€ä¸ªå®¢æˆ·ç«¯çš„æ•°æ®ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="63-å½“å¿ƒå­—ç¬¦ä¸²è¿žæŽ¥å¼•èµ·çš„æ€§èƒ½é—®é¢˜">63. å½“å¿ƒå­—ç¬¦ä¸²è¿žæŽ¥å¼•èµ·çš„æ€§èƒ½é—®é¢˜&lt;/h2>
&lt;h3 id="-å»ºè®®-6">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± ä¸è¦ä½¿ç”¨å­—ç¬¦ä¸²è¿žæŽ¥æ“ä½œç¬¦åˆå¹¶å¤šä¸ªå­—ç¬¦ä¸²ï¼Œé™¤éžæ€§èƒ½æ— å…³ç´§è¦ã€‚ä½¿ç”¨å­—ç¬¦ä¸²ä¸²è”è¿ç®—ç¬¦ &lt;code>+&lt;/code>ï¼Œé‡å¤ä¸²è” n ä¸ªå­—ç¬¦ä¸²ï¼Œéœ€è¦ n çš„å¹³æ–¹çº§æ—¶é—´ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ ä½¿ç”¨ &lt;code>StringBuilder&lt;/code> ä»£æ›¿ &lt;code>String&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="64-é€šè¿‡æŽ¥å£å¼•ç”¨å¯¹è±¡">64. é€šè¿‡æŽ¥å£å¼•ç”¨å¯¹è±¡&lt;/h2>
&lt;h3 id="-å»ºè®®-7">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ€ ä¼˜å…ˆä½¿ç”¨æŽ¥å£è€Œä¸æ˜¯ç±»æ¥å¼•ç”¨å¯¹è±¡ã€‚å¦‚æžœå­˜åœ¨åˆé€‚çš„æŽ¥å£ç±»åž‹ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨æŽ¥å£ç±»åž‹å£°æ˜Žå‚æ•°ã€è¿”å›žå€¼ã€å˜é‡å’Œå­—æ®µã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± ä½¿ç”¨æŽ¥å£ä½œä¸ºç±»åž‹çš„ä¹ æƒ¯ï¼Œç¨‹åºå°†æ›´åŠ çµæ´»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ¥€ ä»¥ä¸‹æƒ…å†µä½¿ç”¨ ç±» æ¥å¼•ç”¨å¯¹è±¡ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° æ²¡æœ‰åˆé€‚çš„æŽ¥å£å­˜åœ¨
&lt;ul>
&lt;li>&lt;code>String&lt;/code> å’Œ &lt;code>BigInteger&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ðŸŒ° æ¡†æž¶çš„åŸºæœ¬ç±»åž‹æ˜¯ç±»ï¼Œä¸æ˜¯æŽ¥å£
&lt;ul>
&lt;li>&lt;code>java.io&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ðŸŒ° å®žçŽ°æŽ¥å£çš„ç±»æä¾›äº†æŽ¥å£ä¸­ä¸å­˜åœ¨çš„é¢å¤–æ–¹æ³•
&lt;ul>
&lt;li>&lt;code>PriorityQueue&lt;/code> ä¸­å®žçŽ°äº† &lt;code>Queue&lt;/code> ä¸å­˜åœ¨çš„ &lt;code>comparator&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-4">ðŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>ðŸŒ¾ ä¼˜å…ˆä½¿ç”¨æŽ¥å£ä½œä¸ºç±»åž‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Son&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">sonSet&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedHashSet&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™…&lt;/span>&lt;span class="n">â€&lt;/span>&lt;span class="err">â™‚&lt;/span>&lt;span class="n">ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">LinkedHashSet&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Son&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">sonSet&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedHashSet&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="65-æŽ¥å£ä¼˜å…ˆåå°„æœºåˆ¶">65. æŽ¥å£ä¼˜å…ˆåå°„æœºåˆ¶&lt;/h2>
&lt;h3 id="-å»ºè®®-8">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± æ ¸å¿ƒåå°„æœºåˆ¶ &lt;code>java.lang.reflect&lt;/code> æä¾›å¯¹ä»»æ„ç±»çš„ç¼–ç¨‹è®¿é—®ã€‚ç»™å®šä¸€ä¸ª Class å¯¹è±¡ï¼Œå¯ä»¥èŽ·å¾— &lt;code>Constructor&lt;/code>ã€&lt;code>Method&lt;/code>ã€&lt;code>Filed&lt;/code> å®žä¾‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± é€šè¿‡è¿‡è°ƒç”¨ &lt;code>Constructor&lt;/code>ã€&lt;code>Method&lt;/code>ã€&lt;code>Filed&lt;/code> å®žä¾‹ä¸Šçš„æ–¹æ³•ï¼Œå¯ä»¥æž„é€ åº•å±‚çš„å®žä¾‹ã€è°ƒç”¨åº•å±‚ç±»çš„æ–¹æ³•ã€è®¿é—®åº•å±‚ç±»ä¸­çš„å­—æ®µã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° &lt;code>Method.invoke()&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ¥€ åå°„å…è®¸ä¸€ä¸ªç±»ä½¿ç”¨å¦ä¸€ä¸ªç±»ï¼Œå³ä½¿åœ¨ç¼–è¯‘å‰è€…æ—¶åŽè€…å¹¶ä¸å­˜åœ¨ã€‚ç„¶è€Œï¼Œè¿™ç§èƒ½åŠ›æ˜¯æœ‰ä»£ä»·çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° å¤±åŽ»äº†ç¼–è¯‘æ—¶ç±»åž‹æ£€æŸ¥çš„æ‰€æœ‰å¥½å¤„ï¼ŒåŒ…æ‹¬å¼‚å¸¸æ£€æŸ¥ã€‚&lt;/li>
&lt;li>ðŸŒ° æ‰§è¡Œåå°„è®¿é—®æ‰€éœ€çš„ä»£ç æ—¢ç¬¨æ‹™åˆå†—é•¿ã€‚å†™èµ·æ¥å¾ˆä¹å‘³ï¼Œè¯»èµ·æ¥ä¹Ÿå¾ˆå›°éš¾ã€‚&lt;/li>
&lt;li>ðŸŒ° æ€§èƒ½é™ä½Žã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å¦‚æžœä½ å¯¹åº”ç”¨ç¨‹åºæ˜¯å¦éœ€è¦åå°„æœ‰ä»»ä½•ç–‘é—®ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¸éœ€è¦ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å¦‚æžœå¿…é¡»ç”¨åˆ°åœ¨ç¼–è¯‘æ—¶æ— æ³•èŽ·å–çš„ç±»ï¼Œåœ¨ç¼–è¯‘æ—¶å­˜åœ¨ä¸€ä¸ªé€‚å½“çš„æŽ¥å£æˆ–è¶…ç±»æ¥ï¼Œå¯ä»¥ç”¨åå°„æ–¹å¼åˆ›å»ºå®žä¾‹ï¼Œå¹¶é€šè¿‡å®ƒä»¬çš„æŽ¥å£æˆ–è¶…ç±»æ­£å¸¸åœ°è®¿é—®å®ƒä»¬ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Translate the class name into a Class object
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">cl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">cl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forNmae&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">])&lt;/span> &lt;span class="c1">// Unchecked cast
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ClassNotFoundException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Class not found.&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Get the constructor
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Constructor&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">cons&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cons&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredConstructor&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">NoSuchMethodException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;No parameterless constructor&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Instantiate the set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// ðŸ™‹â€â™‚ï¸ use interface
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cons&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">IllegalAccessException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Constructor not accessible&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InstantiationException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Class not instantiable.&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InvocationTargetException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Constructor threw &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCause&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ClassCastException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Class doesn&amp;#39;t implement Set&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Exercise the set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">addAll&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">subList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ðŸ¥€ ä¸Šä¾‹ä¸­åå°„æœºåˆ¶çš„ç¼ºç‚¹&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° äº§ç”Ÿ 6 ä¸ªè¿è¡Œæ—¶å¼‚å¸¸&lt;/li>
&lt;li>ðŸŒ° æ ¹æ®ç±»åç”Ÿäº§å®žä¾‹éœ€è¦ 25 è¡Œå†—é•¿ä»£ç ï¼Œè€Œè°ƒç”¨æž„é€ å™¨åªéœ€è¦ä¸€è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± åå°„çš„åˆæ³•ç”¨é€”ï¼ˆå¾ˆå°‘ï¼‰æ˜¯ç®¡ç†ç±»å¯¹è¿è¡Œæ—¶å¯èƒ½ä¸å­˜åœ¨çš„å…¶ä»–ç±»ã€æ–¹æ³•æˆ–å­—æ®µçš„ä¾èµ–å…³ç³»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å¦‚æžœç¼–å†™çš„ç¨‹åºå¿…é¡»åœ¨ç¼–è¯‘æ—¶å¤„ç†æœªçŸ¥çš„ç±»ï¼Œåˆ™åº”è¯¥å°½å¯èƒ½åªä½¿ç”¨åå°„å®žä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨åœ¨ç¼–è¯‘æ—¶å·²çŸ¥çš„æŽ¥å£æˆ–è¶…ç±»è®¿é—®å¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="66-è°¨æ…Žåœ°ä½¿ç”¨æœ¬åœ°æ–¹æ³•">66. è°¨æ…Žåœ°ä½¿ç”¨æœ¬åœ°æ–¹æ³•&lt;/h2>
&lt;h3 id="-å»ºè®®-9">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>ðŸŒ± éžå¸¸ä¸å»ºè®®ä½¿ç”¨æœ¬åœ°æ–¹æ³•ã€‚JVM å˜å¾—æ›´å¿«äº†ï¼Œå¹¶ä¸” Java å¹³å°çš„æˆç†Ÿï¼Œå®ƒæä¾›äº†å¯¹è®¸å¤šä»¥å‰åªèƒ½åœ¨å®¿ä¸»å¹³å°ä¸­ä¸Šæ‰¾åˆ°çš„ç‰¹æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>ä¾‹å¦‚ï¼ŒJava 9 ä¸­æ·»åŠ çš„æµ API æä¾›äº†å¯¹ OS æµç¨‹çš„è®¿é—®ã€‚&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>ðŸ¥€ ä½¿ç”¨æœ¬åœ°æ–¹æ³•æœ‰ä¸¥é‡çš„ç¼ºç‚¹ï¼š
&lt;ul>
&lt;li>ðŸŒ° æœ¬åœ°è¯­è¨€ä¸å®‰å…¨ï¼ˆItem-50ï¼‰ï¼Œä½¿ç”¨æœ¬åœ°æ–¹æ³•çš„åº”ç”¨ç¨‹åºä¸å†èƒ½å…å—å†…å­˜æ¯åé”™è¯¯çš„å½±å“ã€‚&lt;/li>
&lt;li>ðŸŒ° Java æ›´ä¾èµ–äºŽå¹³å°ï¼Œå› æ­¤ä½¿ç”¨æœ¬åœ°æ–¹æ³•çš„ç¨‹åºçš„å¯ç§»æ¤æ€§è¾ƒå·®ã€‚&lt;/li>
&lt;li>ðŸŒ° å®ƒä»¬æ›´éš¾è°ƒè¯•ã€‚&lt;/li>
&lt;li>ðŸŒ° å¦‚æžœä¸å°å¿ƒï¼Œæœ¬åœ°æ–¹æ³•å¯èƒ½ä¼šé™ä½Žæ€§èƒ½ï¼Œå› ä¸ºåžƒåœ¾æ”¶é›†å™¨æ— æ³•è‡ªåŠ¨è·Ÿè¸ªæœ¬åœ°å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œè€Œä¸”è¿›å‡ºæœ¬åœ°ä»£ç ä¼šäº§ç”Ÿç›¸å…³çš„æˆæœ¬ã€‚&lt;/li>
&lt;li>ðŸŒ° æœ¬åœ°æ–¹æ³•éœ€è¦â€œç²˜åˆä»£ç â€ï¼Œè¿™å¾ˆéš¾é˜…è¯»ï¼Œè€Œä¸”ç¼–å†™èµ·æ¥å¾ˆä¹å‘³ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="67-è°¨æ…Žåœ°è¿›è¡Œä¼˜åŒ–">67. è°¨æ…Žåœ°è¿›è¡Œä¼˜åŒ–&lt;/h2>
&lt;h3 id="-å»ºè®®-10">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸ€ ä¼˜åŒ–å¼Šå¤§äºŽåˆ©ï¼Œå°¤å…¶æ˜¯å¦‚æžœè¿‡æ—©åœ°è¿›è¡Œä¼˜åŒ–ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šç”Ÿæˆæ—¢ä¸å¿«é€Ÿä¹Ÿä¸æ­£ç¡®ä¸”æ— æ³•è½»æ¾ä¿®å¤çš„è½¯ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ ä¸è¦ä¸ºäº†æ€§èƒ½è€Œç‰ºç‰²åˆç†çš„æž¶æž„ã€‚åŠªåŠ›ç¼–å†™å¥½çš„ç¨‹åºï¼Œè€Œä¸æ˜¯å¿«é€Ÿçš„ç¨‹åºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å¥½çš„ç¨‹åºä½“çŽ°äº†ä¿¡æ¯éšè—çš„åŽŸåˆ™ï¼šåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬åœ¨å•ä¸ªç»„ä»¶ä¸­æœ¬åœ°åŒ–è®¾è®¡å†³ç­–ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸å½±å“ç³»ç»Ÿå…¶ä½™éƒ¨åˆ†çš„æƒ…å†µä¸‹æ›´æ”¹å•ä¸ªå†³ç­–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ ä¸ä¼˜åŒ–ä¸æ„å‘³ç€åœ¨ç¨‹åºå®Œæˆä¹‹å‰å¯ä»¥å¿½ç•¥æ€§èƒ½é—®é¢˜ã€‚å®žçŽ°ä¸Šçš„é—®é¢˜å¯ä»¥é€šè¿‡ä»¥åŽçš„ä¼˜åŒ–æ¥è§£å†³ï¼Œä½†æ˜¯å¯¹äºŽæž¶æž„ç¼ºé™·ï¼Œå¦‚æžœä¸é‡å†™ç³»ç»Ÿï¼Œå°±ä¸å¯èƒ½è§£å†³é™åˆ¶æ€§èƒ½çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾è®¡APIã€çº¿è·¯å±‚åè®®å’ŒæŒä¹…æ•°æ®æ ¼å¼æ—¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸ€ å†å¤šçš„åº•å±‚ä¼˜åŒ–ä¹Ÿä¸èƒ½å¼¥è¡¥ç®—æ³•é€‰æ‹©çš„ä¸è¶³ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="68-éµå®ˆè¢«å¹¿æ³›è®¤å¯çš„å‘½åçº¦å®š">68. éµå®ˆè¢«å¹¿æ³›è®¤å¯çš„å‘½åçº¦å®š&lt;/h2>
&lt;h3 id="-å»ºè®®-11">ðŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ± Java å¹³å°æœ‰ä¸€ç»„å®Œå–„çš„å‘½åçº¦å®šï¼Œå…¶ä¸­è®¸å¤šçº¦å®šåŒ…å«åœ¨ã€ŠThe Java Language Specificationã€‹&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° typographical å­—é¢çº¦å®š&lt;/li>
&lt;li>ðŸŒ° grammatical è¯­æ³•çº¦å®š&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± å­—é¢æƒ¯ä¾‹ç¤ºä¾‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">&lt;strong>Identifier Type&lt;/strong>&lt;/th>
&lt;th style="text-align:center">&lt;strong>Example&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">Package or module&lt;/td>
&lt;td style="text-align:center">&lt;code>org.junit.jupiter.api&lt;/code>, &lt;code>com.google.common.collect&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Class or Interface&lt;/td>
&lt;td style="text-align:center">&lt;code>Stream&lt;/code>, &lt;code>FutureTask&lt;/code>, &lt;code>LinkedHashMap&lt;/code>, &lt;code>HttpClient&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Method or Field&lt;/td>
&lt;td style="text-align:center">&lt;code>remove()&lt;/code>, &lt;code>groupingBy()&lt;/code>, &lt;code>getCrc()&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Constant Field&lt;/td>
&lt;td style="text-align:center">MIN_VALUE, NEGATIVE_INFINITY&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Local Variable&lt;/td>
&lt;td style="text-align:center">i, denom, houseNum&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Type Parameter&lt;/td>
&lt;td style="text-align:center">T, E, K, V, X, R, U, V, T1, T2&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ± è¯­æ³•å‘½åçº¦å®šæ¯”æŽ’ç‰ˆçº¦å®šæ›´çµæ´»ï¼Œä¹Ÿæ›´æœ‰äº‰è®®ã€‚&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Long Shorter Term Memory</title><link>https://emerywan.github.io/blog/p/nlp-in-action/long-short-term-memory/</link><pubDate>Sat, 19 Mar 2022 20:36:14 +0800</pubDate><guid>https://emerywan.github.io/blog/p/nlp-in-action/long-short-term-memory/</guid><description>&lt;img src="https://nlp.letout.cn/img/banner.png" alt="Featured image of post Long Shorter Term Memory" />&lt;p>è¿™ä¸€èŠ‚ï¼Œå°†ä»‹ç» &lt;code>LSTM (Long Shorter Term Memory)&lt;/code>ï¼Œä»¥åŠç”¨ &lt;code>pytorch&lt;/code> å®žçŽ° &lt;code>LSTM &lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> æ˜¯ä¸€ç§ &lt;code>RNN&lt;/code> æ¨¡åž‹ï¼Œæ˜¯å¯¹ &lt;code>simple RNN&lt;/code> çš„æ”¹è¿›ï¼Œ&lt;code>LSTM&lt;/code> å¯ä»¥é¿å…æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼Œå¯ä»¥æœ‰æ›´é•¿çš„è®°å¿†ã€‚&lt;code>LSTM&lt;/code> çš„è®ºæ–‡åœ¨ 1997 å¹´å‘è¡¨ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Hochreiter and Schmidhuber. Long short-term memory. Neural computation, 1997.&lt;/p>
&lt;/blockquote>
&lt;h2 id="-lstm">ðŸ”– LSTM&lt;/h2>
&lt;p>&lt;code>LSTM&lt;/code> ä¹Ÿæ˜¯ä¸€ç§å¾ªçŽ¯ç¥žç»ç½‘ç»œï¼ŒåŽŸç†è·Ÿ &lt;code>simple RNN&lt;/code> å·®ä¸å¤šï¼Œæ¯å½“è¯»å–ä¸€ä¸ªæ–°çš„è¾“å…¥ $x$ï¼Œå°±ä¼šæ›´æ–°çŠ¶æ€ $h$ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/1.png"
loading="lazy"
alt="1"
>&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> çš„ç»“æž„æ¯” &lt;code>simple RNN&lt;/code> è¦å¤æ‚å¾ˆå¤šï¼Œ&lt;code>simple RNN&lt;/code> åªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µï¼Œ &lt;code>LSTM&lt;/code> æœ‰å››ä¸ªå‚æ•°çŸ©é˜µã€‚æŽ¥ä¸‹æ¥æˆ‘ä»¬å…·ä½“æ¥çœ‹çœ‹ &lt;code>LSTM&lt;/code> çš„å†…éƒ¨ç»“æž„ã€‚&lt;/p>
&lt;h3 id="-ä¼ é€å¸¦">ðŸš  ä¼ é€å¸¦&lt;/h3>
&lt;p>&lt;code>LSTM&lt;/code> æœ€é‡è¦çš„è®¾è®¡æ˜¯è¿™ä¸ªä¼ é€å¸¦ &lt;code>Conveyor belt&lt;/code>ï¼Œå³ä¸ºå‘é‡ $C$ã€‚è¿‡åŽ»çš„ä¿¡æ¯é€šè¿‡ä¼ é€å¸¦ï¼Œç›´æŽ¥é€åˆ°ä¸‹ä¸€ä¸ªæ—¶åˆ»ï¼Œä¸ä¼šå‘ç”Ÿå¤ªå¤§çš„å˜åŒ–ã€‚&lt;code>LSTM&lt;/code> å°±æ˜¯é ä¼ é€å¸¦æ¥é¿å…æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/2.png"
loading="lazy"
alt="2"
>&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> ä¸­æœ‰å¾ˆå¤šä¸ªé—¨ &lt;code>gate&lt;/code>ï¼Œå¯ä»¥æœ‰é€‰æ‹©çš„è®©ä¿¡æ¯é€šè¿‡ã€‚&lt;/p>
&lt;h3 id="-forgate-gate">ðŸšª Forgate Gate&lt;/h3>
&lt;p>é¦–å…ˆä»‹ç» &lt;code>forget gate&lt;/code> é—å¿˜é—¨ã€‚é—å¿˜é—¨ç”± â˜˜ï¸ &lt;code>sigmoid&lt;/code> å‡½æ•°ï¼Œå’Œ ðŸ€ å…ƒç´ ç§¯ &lt;code>element wise multiplication&lt;/code> ä¸¤éƒ¨åˆ†ç»„æˆã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;p>ðŸŒ¼ è¾“å…¥ &lt;code>sigmoid&lt;/code> çš„æ˜¯ä¸€ä¸ªå‘é‡ $a$ï¼Œ&lt;code>sigmoid&lt;/code> ä½œç”¨åˆ°å‘é‡ $a$ çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼ŒæŠŠæ¯ä¸€ä¸ªå…ƒç´ éƒ½åŽ‹åˆ° &lt;code>0&lt;/code> å’Œ &lt;code>1&lt;/code> ä¹‹é—´ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚å‘é‡ $a$ æ˜¯ï¼š&lt;code>[1, 3, 0, -2]&lt;/code>ï¼Œé‚£ä¹ˆï¼Œ&lt;code>sigmoid&lt;/code> å‡½æ•°å°†åˆ†åˆ«ä½œç”¨åœ¨è¿™å››ä¸ªå…ƒç´ ä¸Šã€‚ç„¶åŽåˆ†åˆ«è¾“å‡ºï¼š&lt;code>[0.73, 0.95, 0.5, 0.12]&lt;/code> ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/4.png"
loading="lazy"
alt="4"
>&lt;/p>
&lt;p>è¾“å…¥çš„å‘é‡ $a$ï¼Œä¸Žè¾“å‡ºçš„å‘é‡ $f$ åº”è¯¥æœ‰ç›¸åŒçš„ç»´åº¦ï¼Œè¿™ä¸ªä¾‹å­é‡Œï¼Œå‘é‡ $a$ æ˜¯å››ç»´çš„ï¼Œå‘é‡ $f$ ä¹Ÿä¼šæ˜¯å››ç»´çš„ã€‚&lt;/p>
&lt;p>ðŸŒ¸ ç®—å‡º $f$ å‘é‡ä¹‹åŽï¼Œè®¡ç®—ä¼ é€å¸¦å‘é‡ $c$ ä¸Žé—å¿˜é—¨å‘é‡ $f$ çš„å…ƒç´ ç§¯ã€‚å…ƒç´ ç§¯ &lt;code>element wise multiplication&lt;/code> æ˜¯è¿™æ ·ç®—çš„ï¼š&lt;/p>
&lt;p>$c$ å’Œ $f$ éƒ½æ˜¯å››ç»´çš„å‘é‡ï¼Œå°†å®ƒä»¬çš„æ¯ä¸€ä¸ªå…ƒç´ åˆ†åˆ«ç›¸ä¹˜ã€‚æ‰€ä»¥å…ƒç´ ç§¯çš„ç»“æžœä¹Ÿæ˜¯ä¸ªå››ç»´çš„å‘é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/5.png"
loading="lazy"
alt="5"
>&lt;/p>
&lt;p>è¿™ä¸ªé—å¿˜é—¨ $f$ï¼Œæœ‰é€‰æ‹©çš„è®©ä¼ é€å¸¦ $c$ çš„å€¼é€šè¿‡ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ðŸŒ° å‡å¦‚ $f$ çš„ä¸€ä¸ªå…ƒç´ æ˜¯ $0$ï¼Œé‚£ä¹ˆ $c$ å¯¹åº”çš„å…ƒç´ ä¸èƒ½é€šè¿‡ï¼Œå¯¹åº”çš„è¾“å‡ºæ˜¯ $0$ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ðŸŒ° å‡å¦‚ $f$ çš„ä¸€ä¸ªå…ƒç´ æ˜¯ $1$ï¼Œé‚£ä¹ˆ $c$ å¯¹åº”çš„å…ƒç´ å°±å…¨éƒ¨é€šè¿‡ï¼Œå¯¹åº”çš„è¾“å‡ºæ˜¯ $c$ æœ¬èº«ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>é—å¿˜é—¨ $f$ å…·ä½“æ˜¯è¿™ä¹ˆç®—å‡ºæ¥çš„ï¼šé¦–å…ˆçœ‹è¿™å¼ ç»“æž„å›¾ï¼Œ$f_t$ æ˜¯ä¸Šä¸€ä¸ªçŠ¶æ€ $h_{t-1}$ï¼Œä¸Žå½“å‰è¾“å…¥ $x$ çš„å‡½æ•°ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/6.png"
loading="lazy"
alt="6"
>&lt;/p>
&lt;p>æŠŠçŠ¶æ€ $h_{t-1}$ ä¸Žè¾“å…¥ $x_t$ åšæ‹¼æŽ¥ &lt;code>concatnation&lt;/code>ï¼Œå¾—åˆ°æ›´é«˜ç»´åº¦çš„å‘é‡ã€‚ç„¶åŽè®¡ç®—çŸ©é˜µ $w_f$ ä¸Žè¿™ä¸ªå‘é‡çš„ä¹˜ç§¯ï¼Œå¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œå†ç”¨ &lt;code>sigmoid&lt;/code> å‡½æ•°ï¼Œå¾—åˆ°å‘é‡ $f_t$ï¼Œ$f_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä»‹äºŽ &lt;code>0&lt;/code> å’Œ &lt;code>1&lt;/code> ä¹‹é—´ï¼Œé—å¿˜é—¨æœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µ $w_f$ï¼Œéœ€è¦é€šè¿‡ &lt;strong>åå‘ä¼ æ’­&lt;/strong> ä»Žè®­ç»ƒæ•°æ®é‡Œå­¦ä¹ ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;h3 id="-input-gate">ðŸšª Input Gate&lt;/h3>
&lt;p>åˆšæ‰è®²äº†é—å¿˜é—¨ï¼ŒçŽ°åœ¨æ¥çœ‹ä¸€çœ‹ &lt;code>input gate&lt;/code> è¾“å…¥é—¨ã€‚åœ¨è¿™å¼ ç»“æž„å›¾é‡Œï¼Œè¾“å…¥é—¨ $i_t$ï¼Œä¾èµ–äºŽæ—§çš„çŠ¶æ€å‘é‡ $h_{t-1}$ï¼Œå’Œæ–°çš„è¾“å…¥ $x_t$ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>è¾“å…¥é—¨ $i_t$ çš„è®¡ç®—ç±»ä¼¼äºŽé—å¿˜é—¨ï¼ŒæŠŠæ—§çš„çŠ¶æ€ $h_{t-1}$ï¼Œä¸Žæ–°çš„è¾“å…¥ $x_t$ åšæ‹¼æŽ¥ &lt;code>concatnation&lt;/code>ï¼Œå¾—åˆ°æ›´é«˜ç»´çš„å‘é‡ã€‚&lt;/p>
&lt;p>ç„¶åŽè®¡ç®—çŸ©é˜µ $w_i$ ä¸Žè¿™ä¸ªå‘é‡çš„ä¹˜ç§¯å¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œæœ€åŽä½¿ç”¨æ¿€æ´»å‡½æ•° &lt;code>sigmod&lt;/code>ï¼Œå¾—åˆ°å‘é‡ $i_t$ï¼ˆ$i_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä»‹äºŽ $0$ å’Œ $1$ ä¹‹é—´ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/9.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>è¾“å…¥é—¨ä¹Ÿæœ‰è‡ªå·±çš„å‚æ•°çŸ©é˜µï¼Œè®¡ä½œ $W_i$ï¼Œ$W_i$ ä¹Ÿéœ€è¦ä»Žè®­ç»ƒæ•°æ®ä¸­å­¦ä¹ ã€‚&lt;/p>
&lt;h3 id="-new-value">ðŸ†• New Value&lt;/h3>
&lt;p>è¿˜éœ€è¦è®¡ç®—æ–°çš„è¾“å…¥å€¼ &lt;code>new value&lt;/code> $\widetilde{c}_t$ï¼Œ$\widetilde{c}_t$ æ˜¯ä¸ªå‘é‡ï¼Œè®¡ç®—æ–¹æ³•è·Ÿé—å¿˜é—¨å’Œè¾“å…¥é—¨éƒ½å¾ˆåƒã€‚ä¹Ÿæ˜¯æŠŠæ—§çŠ¶æ€ $h_{t-1}$ï¼Œä¸Žæ–°è¾“å…¥ $x_t$ åšæ‹¼æŽ¥ï¼Œå†ä¹˜åˆ°å‚æ•°çŸ©é˜µä¸Šã€‚&lt;/p>
&lt;p>åŒºåˆ«åœ¨äºŽæ¿€æ´»å‡½æ•°ä¸æ˜¯ &lt;code>sigmoid&lt;/code>ï¼Œè€Œæ˜¯åŒæ›²æ­£åˆ‡å‡½æ•° &lt;code>tanh&lt;/code>ï¼Œæ‰€ä»¥ç®—å‡ºçš„å‘é‡ $\widetilde{c}_t$ çš„å…ƒç´ éƒ½ä»‹äºŽ &lt;code>(-1, +1)&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/10.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>è®¡ç®— &lt;code>new value&lt;/code> $\widetilde{c}_t$ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªå•ç‹¬çš„å‚æ•°çŸ©é˜µçŸ©é˜µ $w_c$ã€‚&lt;/p>
&lt;h3 id="-æ›´æ–°-ä¼ è¾“å¸¦">ðŸš‚ æ›´æ–° ä¼ è¾“å¸¦&lt;/h3>
&lt;p>æˆ‘ä»¬å·²ç»ç®—å‡ºäº†é—å¿˜é—¨ $f_t$ï¼Œè¾“å…¥é—¨ $i_t$ï¼Œä»¥åŠæ–°çš„è¾“å…¥å€¼ $\widetilde{c}_t$ï¼Œæˆ‘ä»¬è¿˜çŸ¥é“ä¼ é€å¸¦æ—§çš„å€¼ $c_{t-1}$ï¼ŒçŽ°åœ¨å¯ä»¥æ›´æ–°ä¼ é€å¸¦ $c$ äº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/11.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>1ï¸âƒ£ è®¡ç®—é—å¿˜é—¨ $f_t$ å’Œä¼ é€å¸¦æ—§çš„å€¼ $c_{t-1}$ çš„å…ƒç´ ç§¯ã€‚&lt;/p>
&lt;p>é—å¿˜é—¨ $f_t$ï¼Œå’Œä¼ é€å¸¦ $c_{t-1}$ æ˜¯ç»´åº¦ç›¸åŒçš„å‘é‡ï¼Œç®—å‡ºçš„ä¹˜ç§¯ä¹Ÿæ˜¯ä¸ªå‘é‡ã€‚é—å¿˜é—¨ $f_t$ï¼Œå¯ä»¥é€‰æ‹©æ€§çš„é—å¿˜ $c_{t-1}$ ä¸­çš„ä¸€äº›å…ƒç´ ï¼Œå¦‚æžœ $f_t$ ä¸­çš„ä¸€ä¸ªå…ƒç´ æ˜¯ $0$ï¼Œé‚£ä¹ˆ $c_{t-1}$ ç›¸åº”çš„å…ƒç´ å°±ä¼šè¢«é—å¿˜ã€‚&lt;/p>
&lt;p>ä¸Šä¸€æ­¥é€šè¿‡ ðŸšª é—å¿˜é—¨ é€‰æ‹©æ€§åˆ é™¤æŽ‰äº†ä¼ é€å¸¦ $c_{t-1}$ çš„ä¸€äº›å…ƒç´ ï¼ŒçŽ°åœ¨è¦å¾€ä¼ é€å¸¦ä¸Šæ·»åŠ æ–°çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>2ï¸âƒ£ è®¡ç®—è¾“å…¥é—¨ $i_t$ï¼Œå’Œæ–°çš„è¾“å…¥å€¼ $\widetilde{c}_t$ çš„å…ƒç´ ç§¯ã€‚&lt;/p>
&lt;p>è¾“å…¥é—¨ $i_t$ å’Œæ–°çš„å€¼ $\widetilde{c}_t$ éƒ½æ˜¯ç»´åº¦ç›¸åŒçš„å‘é‡ï¼Œä»–ä»¬çš„ä¹˜ç§¯ä¹Ÿæ˜¯ç»´åº¦ç›¸åŒçš„å‘é‡ï¼ŒæŠŠä¹˜ç§¯åŠ åˆ°ä¼ é€å¸¦ä¸Šï¼Œè¿™æ ·å°±å®Œæˆäº†å¯¹ä¼ é€å¸¦çš„ä¸€è½®æ›´æ–°ã€‚&lt;/p>
&lt;p>ç”¨é—å¿˜é—¨åˆ é™¤äº†ä¼ é€å¸¦ä¸Šçš„ä¸€äº›ä¿¡æ¯ï¼Œç„¶åŽç”¨é—å¿˜é—¨è¾“å…¥åŠ å…¥æ–°çš„ä¿¡æ¯ï¼Œå¾—åˆ°äº†ä¼ é€å¸¦æ–°çš„å€¼ $c_t$ï¼Œåˆ°çŽ°åœ¨ï¼Œå·²ç»æ›´æ–°å®Œä¼ é€å¸¦ $c$ ã€‚&lt;/p>
&lt;h3 id="-output-gate">ðŸšª Output Gate&lt;/h3>
&lt;p>æœ€åŽä¸€æ­¥æ˜¯è®¡ç®— &lt;code>LSTM&lt;/code> çš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯çŠ¶æ€å‘é‡ $h_t$ã€‚&lt;/p>
&lt;p>$h_t$ æ˜¯è¿™ä¹ˆè®¡ç®—çš„ï¼šé¦–å…ˆè®¡ç®—è¾“å‡ºé—¨ $o_t$ï¼Œè¾“å‡ºé—¨ $o_t$ è·Ÿå‰é¢çš„é—å¿˜é—¨ï¼Œè¾“å…¥é—¨çš„è®¡ç®—åŸºæœ¬ä¸€æ ·ã€‚&lt;/p>
&lt;p>æŠŠæ—§çš„çŠ¶æ€ $h_{t-1}$ï¼Œä¸Žæ–°çš„è¾“å…¥ $x_t$ åšæ‹¼æŽ¥ï¼Œå¾—åˆ°æ›´é«˜ç»´çš„å‘é‡ï¼Œç„¶åŽç®—çŸ©é˜µ $W_o$ ä¸Žè¿™ä¸ªå‘é‡çš„ä¹˜ç§¯ï¼Œå¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œæœ€åŽä½¿ç”¨æ¿€æ´»å‡½æ•° &lt;code>sigmod&lt;/code> å¾—åˆ°å‘é‡ $o_t$ã€‚$o_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä»‹äºŽ &lt;code>(0, 1)&lt;/code>ï¼Œè¾“å‡ºé—¨ä¹Ÿæœ‰è‡ªå·±çš„å‚æ•°å‘é‡ $W_o$ï¼Œ$W_o$ ä¹Ÿéœ€è¦ä»Žè®­ç»ƒæ•°æ®ä¸­å­¦ä¹ ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/12.png"
loading="lazy"
alt="12"
>&lt;/p>
&lt;p>çŽ°åœ¨è®¡ç®—çŠ¶æ€å‘é‡ $h_t$ï¼Œå¯¹ä¼ é€å¸¦ $c_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ æ±‚åŒæ›²æ­£åˆ‡&lt;code>tanh&lt;/code>ï¼ŒæŠŠå…ƒç´ å…¨éƒ½åŽ‹åˆ° &lt;code>(-1, +1)&lt;/code> åŒºé—´ã€‚&lt;/p>
&lt;p>ç„¶åŽï¼Œæ±‚è¿™ä¸¤ä¸ªå‘é‡çš„å…ƒç´ ç§¯ï¼Œè¿™ä¸ªçº¢è‰²å‘é‡æ˜¯åˆšåˆšæ±‚å‡ºçš„è¾“å‡ºé—¨ $o_t$ï¼Œè¿™æ ·å°±å¾—åˆ°äº†çŠ¶æ€å‘é‡ $h_t$ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/13.png"
loading="lazy"
alt="13"
>&lt;/p>
&lt;p>çœ‹ä¸€ä¸‹ç»“æž„å›¾ï¼Œ$h_t$ ä»–æœ‰ä¸¤ä»½ &lt;code>copys&lt;/code>ï¼Œ$h_t$ çš„ä¸€ä»½ &lt;code>copy&lt;/code> ä¼ è¾“åˆ°äº†ä¸‹ä¸€æ­¥ï¼Œå¦ä¸€ä»½ &lt;code>copy&lt;/code> æˆäº† &lt;code>LSTM&lt;/code> çš„è¾“å‡ºã€‚&lt;/p>
&lt;p>åˆ°ç¬¬ &lt;code>t&lt;/code> æ­¥ä¸ºæ­¢ï¼Œä¸€å…±æœ‰ &lt;code>t&lt;/code> ä¸ªå‘é‡ $x$ è¢«è¾“å…¥äº† &lt;code>LSTM&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ‰€æœ‰è¿™äº› $x$ å‘é‡çš„ä¿¡æ¯ï¼Œéƒ½ç§¯ç´¯åœ¨äº†çŠ¶æ€ $h_t$ é‡Œé¢ã€‚&lt;/p>
&lt;h2 id="-lstm-çš„å‚æ•°æ•°é‡">ðŸ§® LSTM çš„å‚æ•°æ•°é‡&lt;/h2>
&lt;p>æˆ‘ä»¬æ¥ç®—ä¸€ä¸‹ &lt;code>LSTM&lt;/code> çš„å‚æ•°æ•°é‡ï¼Œ&lt;code>LSTM&lt;/code> æœ‰ â¶ é—å¿˜é—¨ï¼›â· è¾“å…¥é—¨ï¼›â¸ æ–°çš„è¾“å…¥ï¼›â¹ è¾“å‡ºé—¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/04/14.png"
loading="lazy"
alt="14"
>&lt;/p>
&lt;p>è¿™å››ä¸ªæ¨¡å—éƒ½æœ‰å„è‡ªçš„å‚æ•°çŸ©é˜µ $w$ï¼Œæ‰€ä»¥ä¸€å…±æœ‰ &lt;code>4&lt;/code> ä¸ªå‚æ•°çŸ©é˜µï¼ŒçŸ©é˜µçš„è¡Œæ•°æ˜¯ï¼š$shape(h)$ï¼Œåˆ—æ•°æ˜¯ï¼š $shape(h)+shape(x)$&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œ&lt;code>LSTM&lt;/code> å‚æ•°çš„æ•°é‡æ˜¯ï¼š&lt;/p>
&lt;p>$4 * shape(h) * [ shape(h) + shape(x)]$&lt;/p>
&lt;h2 id="-å®žçŽ°-lstm">ðŸ›  å®žçŽ° LSTM&lt;/h2>
&lt;p>&lt;strong>Doing&lt;/strong>&lt;/p>
&lt;h2 id="-æ€»ç»“">ðŸŽ æ€»ç»“&lt;/h2>
&lt;p>æ€»ç»“ä¸€ä¸‹è¿™ä¸€èŠ‚çš„å†…å®¹ï¼Œè¿™èŠ‚ä»‹ç»äº† &lt;code>LSTM&lt;/code> æ¨¡åž‹å’Œç”¨ &lt;code>PyTorch&lt;/code> çš„å®žçŽ°ã€‚&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> å’Œ &lt;code>simple RNN&lt;/code> ä¸»è¦çš„åŒºåˆ«ï¼Œæ˜¯ç”¨äº†ä¸€æ¡ä¼ é€å¸¦ï¼Œè®©è¿‡åŽ»çš„ä¿¡æ¯å¯ä»¥å¾ˆå®¹æ˜“ä¼ è¾“åˆ°ä¸‹ä¸€æ—¶åˆ»ï¼Œè¿™æ ·å°±æœ‰äº†æ›´é•¿çš„è®°å¿†ã€‚&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> çš„è¡¨çŽ°æ€»æ˜¯æ¯” &lt;code>simple RNN&lt;/code> è¦å¥½ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æƒ³ä½¿ç”¨ &lt;code>RNN&lt;/code> çš„æ—¶å€™å°±ç”¨ ðŸ™‹â€â™‚ï¸ &lt;code>LSTM&lt;/code> æ¨¡åž‹ï¼Œè€Œä¸è¦ç”¨ ðŸ™…â€â™‚ï¸ &lt;code>simple RNN&lt;/code> æ¨¡åž‹ã€‚&lt;/p>
&lt;p>&lt;code>LSTM&lt;/code> æœ‰å››ä¸ªç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸšª &lt;code>Forget Gate&lt;/code> é—å¿˜é—¨&lt;/li>
&lt;li>ðŸšª &lt;code>Input Gate&lt;/code> è¾“å…¥é—¨&lt;/li>
&lt;li>ðŸ†• &lt;code>New Value&lt;/code> æ–°çš„è¾“å…¥&lt;/li>
&lt;li>ðŸšª &lt;code>Output Gate&lt;/code> è¾“å‡ºé—¨&lt;/li>
&lt;/ul>
&lt;p>è¿™å››ä¸ªç»„ä»¶å„è‡ªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µï¼Œæ‰€ä»¥ä¸€å…±æœ‰å››ä¸ªå‚æ•°çŸ©é˜µï¼Œ&lt;code>LSTM&lt;/code> å‚æ•°çš„æ•°é‡æ˜¯ï¼š&lt;/p>
&lt;p>$4 * shape(h) * [ shape(h) + shape(x)]$&lt;/p>
&lt;p>ä¸‹ä¸€èŠ‚å°†ä»‹ç»ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>stacked RNN&lt;/code>&lt;/li>
&lt;li>&lt;code>bi-directional RNN&lt;/code>&lt;/li>
&lt;li>é¢„è®­ç»ƒ&lt;/li>
&lt;/ul>
&lt;h2 id="-å‚è€ƒ">â›“ å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>ðŸ”— &lt;a class="link" href="https://github.com/wangshusen/DeepLearning/blob/master/Slides/9_RNN_3.pdf" target="_blank" rel="noopener"
>https://github.com/wangshusen/DeepLearning/blob/master/Slides/9_RNN_3.pdf&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/" target="_blank" rel="noopener"
>https://colah.github.io/posts/2015-08-Understanding-LSTMs/&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://www.youtube.com/watch?v=vTouAvxlphc" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=vTouAvxlphc&lt;/a>&lt;/li>
&lt;li>ðŸ”— &lt;a class="link" href="https://www.bilibili.com/video/BV1UK4y1d7xa" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1UK4y1d7xa&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>æ–‡æœ¬å¤„ç†ä¸Žè¯åµŒå…¥</title><link>https://emerywan.github.io/blog/p/nlp-in-action/text-processing-and-word-embedding/</link><pubDate>Fri, 11 Mar 2022 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/nlp-in-action/text-processing-and-word-embedding/</guid><description>&lt;img src="https://nlp.letout.cn/img/banner.png" alt="Featured image of post æ–‡æœ¬å¤„ç†ä¸Žè¯åµŒå…¥" />&lt;p>æœ¬èŠ‚ä¸»è¦å†…å®¹ä¸º &lt;strong>æ–‡æœ¬å¤„ç†&lt;/strong> &lt;code>Text Processing&lt;/code> å’Œ &lt;strong>è¯åµŒå…¥&lt;/strong> &lt;code>Word Embedding&lt;/code>ã€‚æœ¬èŠ‚å’Œä¸‹é¢ä¸¤èŠ‚å†…å®¹éƒ½ä¼šä½¿ç”¨ IMDb ç”µå½±è¯„è®ºçš„æ•°æ®ï¼Œç”¨æ¥æ­å»ºæœºå™¨å­¦ä¹ æ¨¡åž‹åˆ†æžç”µå½±è¯„è®ºã€‚&lt;/p>
&lt;h2 id="-imdb">ðŸŒ± IMDb&lt;/h2>
&lt;p>&lt;a class="link" href="https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E7%94%B5%E5%BD%B1%E8%B5%84%E6%96%99%E5%BA%93" target="_blank" rel="noopener"
>IMDb&lt;/a> æ˜¯æœ€æœ‰åçš„ç”µå½±è¯„è®ºç½‘ç«™ï¼Œç”¨æˆ·å¯ä»¥åœ¨ IMDb ä¸Šç»™ç”µå½±æ‰“åˆ†ï¼Œ1 åˆ†æ˜¯éžå¸¸è®¨åŽŒï¼Œ10 åˆ†æ˜¯éžå¸¸å–œæ¬¢ï¼Œå¦‚æžœä¹æ„ï¼Œè¿˜å¯ä»¥å†™ä¸€æ®µç”µå½±è¯„è®ºã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/imdb.png"
loading="lazy"
alt="IMDb"
>&lt;/p>
&lt;p>å¦‚æžœä¸ç»™ä½ çœ‹åˆ†æ•°ï¼Œåªç»™ä½ çœ‹è¯„è®ºï¼Œä½ å¤§æ¦‚èƒ½çŒœåˆ°ç”¨æˆ·æ‰“çš„åˆ†æ•°ï¼Œä½†ä½ çš„çŒœæµ‹å¯èƒ½ä¸å¤ªå‡†ç¡®ã€‚å¦‚æžœæ¢ç§æ–¹å¼ï¼Œè®©ä½ åˆ¤æ–­ç”µå½±è¯„è®ºæ˜¯ &lt;strong>æ­£é¢&lt;/strong> &lt;code>positive&lt;/code> çš„è¿˜æ˜¯ &lt;strong>è´Ÿé¢&lt;/strong> &lt;code>negative&lt;/code> çš„ï¼Œä½ åº”è¯¥ä¼šæœ‰å¾ˆé«˜çš„å‡†ç¡®çŽ‡ã€‚æœ‰äººä»Ž IMDb ä¸Šçˆ¬äº† 5 ä¸‡æ¡ç”µå½±è¯„è®ºï¼Œè¿™äº›è¯„è®ºéƒ½æ˜¯å¾ˆæžç«¯çš„ï¼Œéƒ½æ˜¯å¼ºçƒˆçš„å–œæ¬¢ï¼Œæˆ–è€…å¼ºçƒˆåæ„Ÿã€‚è¿™ä¸ªäºŒåˆ†ç±»é—®é¢˜å¯¹äºŽäººæ¥è¯´å¾ˆç®€å•ï¼Œäººè¯»ä¸€ä¸‹ç”µå½±è¯„è®ºå°±èƒ½è½»æ˜“çŸ¥é“è¿™æ˜¯æ­£é¢è¯„ä»·è¿˜æ˜¯è´Ÿé¢è¯„ä»·ï¼Œäººåº”è¯¥èƒ½æœ‰ 100% çš„å‡†ç¡®çŽ‡ï¼Œè¿™ä¸ªæ•°æ®é›†è¢«åˆ†æˆä¸¤åŠï¼Œ2 ä¸‡ 5 åƒæ¡ä½œä¸ºè®­ç»ƒæ•°æ® &lt;code>Train&lt;/code>ï¼Œå¦å¤– 2 ä¸‡ 5 åƒæ¡ä½œä¸ºæµ‹è¯•æ•°æ® &lt;code>Test&lt;/code>ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>ä½ å¯ä»¥åœ¨ä¸‹é¢çš„é“¾æŽ¥ä¸­èŽ·å–åˆ°æ•°æ®é›†ï¼š&lt;a class="link" href="https://ai.stanford.edu/~amaas/data/sentiment/" target="_blank" rel="noopener"
>https://ai.stanford.edu/~amaas/data/sentiment/&lt;/a>&lt;/p>
&lt;h2 id="-æ–‡æœ¬å¤„ç†æ–‡æœ¬å¤„ç†">ðŸ”– æ–‡æœ¬å¤„ç†æ–‡æœ¬å¤„ç†&lt;/h2>
&lt;p>åœ¨è¯åµŒå…¥ &lt;code>Word Embedding&lt;/code> å’Œæ­å»ºæœºå™¨å­¦ä¹ æ¨¡åž‹ä¹‹å‰ï¼Œé¦–å…ˆè¦è¿›è¡Œæ–‡æœ¬å¤„ç†ï¼Œå°†æ–‡æœ¬å˜æˆåºåˆ— &lt;code>Sequence&lt;/code>ï¼Œæ–‡æœ¬å¤„ç†å¾ˆæ— èŠï¼Œä½†æˆ‘ä»¬åº”è¯¥é‡è§†å®ƒï¼Œæ–‡æœ¬å¤„ç†çš„å¥½åï¼Œä¼šç›´æŽ¥å½±å“æœºå™¨å­¦ä¹ æ¨¡åž‹çš„å‡†ç¡®çŽ‡ã€‚&lt;/p>
&lt;h3 id="-tokenization">ðŸš€ Tokenization&lt;/h3>
&lt;p>æ–‡æœ¬å¤„ç†çš„ç¬¬ä¸€æ­¥æ˜¯ &lt;code>Tokenization&lt;/code>ï¼ŒæŠŠæ–‡æœ¬åˆ†å‰²æˆå¾ˆå¤š &lt;code>tokens&lt;/code>ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠæ–‡æœ¬åˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œä¸€ä¸ª &lt;code>token&lt;/code> å°±æ˜¯ä¸€ä¸ªå•è¯ï¼ˆå‡å¦‚ä½ æŠŠæ–‡æœ¬åˆ†å‰²æˆå­—ç¬¦ï¼Œé‚£ä¹ˆä¸€ä¸ª &lt;code>token&lt;/code> å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼‰ï¼Œåšå®Œ &lt;code>Tokenization&lt;/code>ï¼Œä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²å°±è¢«åˆ†å‰²æˆä¸€ä¸ªå¾ˆå¤šå•è¯çš„åˆ—è¡¨ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/1.png"
loading="lazy"
alt="1"
>&lt;/p>
&lt;p>&lt;code>Tokenization&lt;/code> çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯è®²ç©¶å¾ˆå¤šã€‚æ¯”å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° æ˜¯å¦åº”è¯¥æŠŠå¤§å†™å˜æˆå°å†™ï¼Ÿ&lt;/li>
&lt;/ul>
&lt;p>é€šå¸¸æƒ…å†µä¸‹åº”è¯¥æŠŠå¤§å†™å˜æˆå°å†™ï¼Œå¤§å°å†™å•è¯é€šå¸¸æ˜¯ä¸€ä¸ªæ„æ€ï¼›ä½†æœ‰æ—¶å€™ä¼šæ··æ·†å•è¯ï¼ˆApple -&amp;gt; appleï¼‰ï¼Œæ¯”å¦‚ Apple æ˜¯è‹¹æžœå…¬å¸ï¼Œapple æ˜¯æ°´æžœï¼Œå¤§å°å†™çš„ apple å¹¶ä¸æ˜¯ç›¸åŒçš„å•è¯ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° åŽ»é™¤åœç”¨è¯ã€‚&lt;code>stop word&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æœ‰äº›åº”ç”¨ä¼šåŽ»é™¤ stop wordï¼Œå®ƒæ˜¯ theã€aã€of ç­‰æœ€é«˜é¢‘çš„å•è¯ï¼Œè¿™äº›è¯å‡ ä¹Žå‡ºçŽ°åœ¨æ‰€æœ‰çš„å¥å­é‡Œï¼Œå¯¹è¿™ä¸ªäºŒåˆ†ç±»é—®é¢˜å‡ ä¹Žæ˜¯æ²¡æœ‰å¸®åŠ©ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° æ‹¼å†™çº é”™ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç”¨æˆ·å‘ç”µå½±è¯„è®ºçš„æ—¶å€™ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹å¹¶ä¸ä¼šä»”ç»†æ£€æŸ¥ï¼Œæ‰€ä»¥å†™çš„ä¸œè¥¿éš¾å…ä¼šæœ‰æ‹¼å†™é”™è¯¯ï¼Œæ‰€ä»¥åšæ‹¼å†™çº é”™é€šå¸¸æ˜¯æœ‰ç”¨çš„ã€‚&lt;/p>
&lt;p>è¿™é‡Œåªæ˜¯ä¸¾äº†å‡ ä¸ªä¾‹å­ï¼Œå®žé™…ä¸Šåš &lt;code>Tokenization&lt;/code> çš„æ—¶å€™éœ€è¦åšå¤§é‡çš„å·¥ä½œï¼Œ&lt;code>Tokenization&lt;/code> çœ‹ä¼¼ç®€å•ï¼Œä½†å®žé™…ä¸Šå¹¶ä¸å®¹æ˜“ã€‚&lt;/p>
&lt;h3 id="-build-dictionary">ðŸ§° Build Dictionary&lt;/h3>
&lt;p>ç¬¬äºŒæ­¥æ˜¯å»ºç«‹ä¸€ä¸ªå­—å…¸ã€‚å¯ä»¥å…ˆç»Ÿè®¡è¯é¢‘ï¼ŒåŽ»æŽ‰ä¸€äº›ä½Žé¢‘è¯ï¼Œè®©åŽè®©æ¯ä¸ªå•è¯å¯¹åº”ä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ¯”å¦‚è®© &lt;code>the -&amp;gt; 1; cat -&amp;gt; 2; sat -&amp;gt; 3&lt;/code>ã€‚æœ‰äº†è¿™ä¸ªå­—å…¸ï¼Œå°±å¯ä»¥æŠŠæ¯ä¸ªå•è¯å¯¹åº”åˆ°ä¸€ä¸ªæ•´æ•°ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸€å¥è¯å°±å¯ä»¥ç”¨æ­£æ•´æ•°çš„åˆ—è¡¨è¡¨ç¤ºï¼Œè¿™ä¸ªåˆ—è¡¨è¢«ç§°ä¸ºåºåˆ— &lt;code>Sequences&lt;/code>ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/2.png"
loading="lazy"
alt="2"
>&lt;/p>
&lt;p>å¦‚æžœæœ‰å¿…è¦çš„è¯ï¼Œè¿˜å¾—è¿›ä¸€æ­¥åš &lt;code>one-hot encoding&lt;/code>ï¼ŒæŠŠå•è¯è¡¨ç¤ºæˆ &lt;code>one-hot&lt;/code> å‘é‡ã€‚&lt;/p>
&lt;p>åœ¨ç”µå½±è¯„è®ºçš„ä¾‹å­é‡Œï¼Œæ•°æ®æ˜¯ 5 ä¸‡æ¡ç”µå½±è¯„è®ºï¼Œæ¯æ¡ç”µå½±è¯„è®ºå¯ä»¥è¡¨ç¤ºæˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åšå®Œ &lt;code>Tokenization&lt;/code> å’Œ &lt;code>Encoding&lt;/code> åŽï¼Œæ¯æ¡ç”µå½±è¯„è®ºéƒ½ä¼šè½¬æ¢æˆä¸€ä¸ª &lt;code>Sequences&lt;/code>ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ­£æ•´æ•°çš„åˆ—è¡¨ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;p>ç”µå½±è¯„è®ºæœ‰é•¿æœ‰çŸ­ï¼Œæœ‰äººåªèƒ½å†™å‡ ä¸ªå­—çš„è¯„è®ºï¼Œæœ‰äººèƒ½æ´‹æ´‹æ´’æ´’å†™å‡ åƒå­—ï¼Œæ‰€ä»¥å¾—åˆ°çš„è¿™äº› &lt;code>Sequences&lt;/code> çš„é•¿åº¦ä¹Ÿå„ä¸ç›¸åŒã€‚æ¯”å¦‚è¿™ä¸¤æ¡ &lt;code>Sequences&lt;/code> çš„é•¿åº¦åˆ†åˆ«æ˜¯ 52 å’Œ 90ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/4.png"
loading="lazy"
alt="4"
>&lt;/p>
&lt;p>è¿™å°±é€ æˆäº†ä¸€ä¸ªé—®é¢˜ï¼Œè®­ç»ƒæ•°æ®æ²¡æœ‰å¯¹é½ï¼Œæ¯æ¡ &lt;code>Sequences&lt;/code> éƒ½æœ‰ä¸åŒçš„é•¿åº¦ã€‚åšæœºå™¨å­¦ä¹ çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®å­˜å‚¨åˆ°çŸ©é˜µæˆ–è€…å¼ é‡é‡Œï¼Œæ¯æ¡åºåˆ—éƒ½å¾—æœ‰ç›¸åŒçš„é•¿åº¦ï¼Œéœ€è¦æŠŠåºåˆ—å¯¹é½ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/5.png"
loading="lazy"
alt="5"
>&lt;/p>
&lt;p>è§£å†³æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬å¯ä»¥å›ºå®šé•¿åº¦ä¸º $w$ã€‚å‡å¦‚ä¸€ä¸ªåºåˆ—é•¿åº¦å¤ªé•¿ï¼Œè¶…è¿‡äº† $w$ ä¸ªè¯ï¼Œå°±ç æŽ‰å‰é¢çš„è¯ï¼Œåªä¿ç•™æœ€åŽé¢ $w$ä¸ªè¯ï¼ˆå½“ç„¶ä¿ç•™æœ€å‰é¢ $w$ ä¸ªè¯ä¹ŸåŒæ ·å¯ä»¥ï¼‰ï¼›å‡å¦‚ä¸€ä¸ªåºåˆ—å¤ªçŸ­ï¼Œä¸åˆ° $w$ ä¸ªè¯ï¼Œé‚£ä¹ˆå°±åš &lt;code>zero padding&lt;/code> ç”¨ 0 æ¥è¡¥é½ï¼ŒæŠŠé•¿åº¦å¢žåŠ åˆ° $w$ã€‚&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/6.png"
loading="lazy"
alt="6"
>&lt;/p>
&lt;p>è¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰åºåˆ—çš„é•¿åº¦éƒ½æ˜¯ $w$ï¼Œå¯ä»¥å­˜å‚¨åˆ°ä¸€ä¸ªçŸ©é˜µé‡Œã€‚&lt;/p>
&lt;h2 id="-è¯åµŒå…¥">ðŸ€ï¸ è¯åµŒå…¥&lt;/h2>
&lt;p>æ–‡æœ¬å¤„ç†å·²ç»å®Œæˆäº†ï¼ŒçŽ°åœ¨æ¯ä¸ªè¯éƒ½ç”¨ä¸€ä¸ªæ­£æ•´æ•°æ¥è¡¨ç¤ºï¼Œä¸‹ä¸€æ­¥æ˜¯ &lt;code>Word Embedding&lt;/code>ï¼ŒæŠŠæ¯ä¸ªè¯éƒ½è¡¨ç¤ºä¸ºä¸€ä¸ªä¸€ç»´å‘é‡ã€‚&lt;/p>
&lt;p>çŽ°åœ¨æ¯ä¸ªå•è¯éƒ½ç”¨ä¸€ä¸ªæ•°å­—æ¥è¡¨ç¤ºï¼Œè¯¥æ€Žä¹ˆæŠŠè¿™äº› &lt;code>Categorical&lt;/code> ç‰¹å¾è¡¨ç¤ºä¸ºæ•°å€¼å‘é‡å‘¢ï¼Ÿ&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>æ˜¾ç„¶å¯ä»¥åš &lt;code>one-hot encoding&lt;/code>ï¼Œç”¨ä¸€ä¸ª &lt;code>one-hot&lt;/code> å‘é‡æ¥è¡¨ç¤ºä¸€ä¸ªå•è¯ã€‚&lt;!-- raw HTML omitted -->
æ¯”å¦‚ &lt;code>good: index = 2&lt;/code>ï¼ŒäºŽæ˜¯ä½¿ç”¨æ ‡å‡†æ­£äº¤ç§¯ $e_2$ æ¥è¡¨ç¤ºï¼Œå®ƒçš„ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ï¼Œ$e_2=[0, 1, 0, 0, &amp;hellip;, 0]$&lt;/p>
&lt;p>å‡å¦‚ &lt;code>vocabulary = v&lt;/code>ï¼Œä¹Ÿå°±æ˜¯è¯´å­—å…¸é‡Œä¸€å…±æœ‰ $v$ ä¸ªå•è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦ç»´åº¦ &lt;code>dimension = v&lt;/code> çš„ &lt;code>one-hot&lt;/code> å‘é‡ï¼Œè¦æ˜¯å­—å…¸é‡Œæœ‰ 1 ä¸‡ä¸ªå•è¯ï¼Œé‚£ä¹ˆè¿™äº› &lt;code>one-hot&lt;/code> å‘é‡éƒ½æ˜¯ 1 ä¸‡ç»´çš„ï¼Œè¿™æ ·çš„å‘é‡ç»´åº¦æ˜¯åœ¨å¤ªé«˜äº†ã€‚ä¸‹ä¸€èŠ‚ä»‹ç» RNN çš„æ—¶å€™ä½ ä¼šçœ‹åˆ°ï¼ŒRNN çš„å‚æ•°æ•°é‡æ­£æ¯”äºŽè¾“å…¥å‘é‡çš„ç»´åº¦ï¼Œæˆ‘ä»¬è‚¯å®šä¸æƒ³è®©è¾“å…¥çš„å‘é‡æ˜¯ 1 ä¸‡ç»´çš„ï¼Œå¦åˆ™ä¸€å±‚ RNN å°†ä¼šæœ‰å¥½å‡ åä¸‡ä¸ªå‚æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åš &lt;code>Word Embedding&lt;/code>ï¼ŒæŠŠè¿™äº›é«˜ç»´ &lt;code>one-hot&lt;/code> å‘é‡æ˜ å°„åˆ°ä½Žç»´å‘é‡ã€‚&lt;/p>
&lt;p>å…·ä½“åšæ³•æ˜¯å§ &lt;code>one-hot&lt;/code> å‘é‡ $e_i$ ä¹˜åˆ°å‚æ•°çŸ©é˜µ $P^T$ ä¸Šï¼ŒçŸ©é˜µ $P^T$ çš„å¤§å°æ˜¯ $d*v$ã€‚å…¶ä¸­ $d$ æ˜¯è¯å‘é‡çš„ç»´åº¦ï¼Œç”±ç”¨æˆ·è‡ªå·±å†³å®šï¼›$v$ æ˜¯ &lt;code>vocabulary&lt;/code>ï¼Œè¡¨ç¤ºå­—å…¸é‡Œå•è¯çš„æ•°é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;p>çŸ©é˜µçš„ä¹˜æ³•çš„ç»“æžœè®°åšå‘é‡ $x_i$ï¼Œ$x_i$ å°±æ˜¯ä¸€ä¸ªè¯å‘é‡ï¼Œç»´åº¦æ˜¯ $d*1$ï¼Œå¦‚æžœ &lt;code>one-hot&lt;/code> å‘é‡ $e$ çš„ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯ 1ï¼Œé‚£ä¹ˆ $x_i$ å°±æ˜¯ $P^T$ çŸ©é˜µçš„ç¬¬ä¸‰åˆ—ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ$P^T$ çŸ©é˜µæ¯ä¸€åˆ—éƒ½æ˜¯ä¸€ä¸ªè¯å‘é‡ã€‚&lt;/p>
&lt;p>åŒç†ï¼Œä¸‹é¢è¿™ä¸ªå‚æ•°çŸ©é˜µ $P$ çš„æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªè¯å‘é‡ã€‚è¿™ä¸ªçŸ©é˜µçš„è¡Œæ•°æ˜¯ $v$ï¼Œä¹Ÿå°±æ˜¯ &lt;code>vocabulary&lt;/code>ï¼›æ¯ä¸€è¡Œå¯¹åº”ä¸€ä¸ªå•è¯ï¼ŒçŸ©é˜µçš„åˆ—æ•°æ˜¯ $d$ï¼Œ$d$ æ˜¯ç”¨æˆ·å†³å®šçš„ï¼Œ$d$ çš„å¤§å°ä¼šå½±å“æœºå™¨å­¦ä¹ æ¨¡åž‹çš„è¡¨çŽ°ï¼Œåº”è¯¥ç”¨ äº¤å‰éªŒè¯ &lt;code>Cross Validation&lt;/code> ç”¨æ¥é€‰æ‹©ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ $d$ã€‚&lt;/p>
&lt;p>å­—å…¸é‡Œçš„ç¬¬ä¸€ä¸ªè¯çš„æ˜¯ &lt;code>movie&lt;/code>ï¼Œé‚£ä¹ˆç¬¬ä¸€è¡Œå°±æ˜¯ &lt;code>movie&lt;/code> çš„è¯å‘é‡ï¼›å­—å…¸é‡Œçš„ç¬¬äºŒä¸ªè¯æ˜¯ &lt;code>good&lt;/code>ï¼Œé‚£ä¹ˆç¬¬äºŒè¡Œå°±æ˜¯ &lt;code>good&lt;/code> çš„è¯å‘é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯åˆ¤æ–­ç”µå½±è¯„è®ºæ˜¯æ­£é¢çš„è¿˜æ˜¯è´Ÿé¢çš„ï¼Œè¿™ä¸ªå‚æ•°çŸ©é˜µæ˜¯ä»Žè®­ç»ƒæ•°æ®ä¸­å­¦ä¹ å‡ºæ¥çš„ï¼Œæ‰€ä»¥è¿™äº›è¯å‘é‡éƒ½å¸¦æœ‰æ„Ÿæƒ…è‰²å½©ï¼Œå‡å¦‚è¿™äº›è¯å‘é‡éƒ½æ˜¯äºŒç»´çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å¹³é¢åæ ‡ç³»ä¸­æ ‡å‡ºè¿™äº›è¯å‘é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/02/9.png"
loading="lazy"
alt="9"
>&lt;/p>
&lt;p>&lt;code>fantastic; good; fun&lt;/code> è¿™äº›è¯å‘é‡éƒ½å¸¦æœ‰æ­£é¢æƒ…æ„Ÿï¼Œæ‰€ä»¥è¿™ä¸‰ä¸ªè¯çš„è¯å‘é‡å­¦å‡ºæ¥éƒ½æ¯”è¾ƒæŽ¥è¿‘ï¼›åŒç†ï¼Œ&lt;code>poor; boring; mediocre&lt;/code> è¿™äº›è¯å¸¦æœ‰è´Ÿé¢æƒ…æ„Ÿï¼Œæ‰€ä»¥å­¦å‡ºæ¥çš„è¯åŒæ ·ä¹Ÿåº”è¯¥æ¯”è¾ƒæŽ¥è¿‘ï¼Œä½†æ˜¯è¿™äº›è¯çš„è¯å‘é‡åº”è¯¥è¿œç¦»æ­£é¢è‰²å½©çš„è¯å‘é‡ã€‚åƒ &lt;code>movie; is&lt;/code> è¿™æ ·çš„ä¸­æ€§è¯ï¼Œæ²¡æœ‰æ„Ÿæƒ…è‰²å½©ï¼Œå®ƒä»¬åº”è¯¥åœ¨ä¸­é—´ã€‚&lt;/p>
&lt;h2 id="-æ€»ç»“">ðŸŽ æ€»ç»“&lt;/h2>
&lt;p>æœ€åŽæ€»ç»“ä¸€ä¸‹è¿™ä¸€ç« çš„å†…å®¹ã€‚&lt;/p>
&lt;p>è¿™ä¸€èŠ‚ä¸ŠåŠéƒ¨åˆ†ï¼Œè¯´æ˜Žäº†æ–‡æœ¬å¤„ç†æ˜¯ä»€ä¹ˆæ ·çš„ã€‚ç»™æˆ‘ä»¬ä¸€æ¡ç”µå½±è¯„è®ºï¼Œé¦–å…ˆåš &lt;code>Tokenization&lt;/code>ï¼ŒæŠŠç”µå½±è¯„è®ºåˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œç„¶åŽæŠŠå¾ˆå¤šå•è¯ç¼–ç æˆæ•°å­—ï¼Œè¿™æ ·ä¸€æ•´æ¡ç”µå½±è¯„è®ºå°±å¯ä»¥å¾ˆå¤šæ­£æ•´æ•°æ¥è¡¨ç¤ºï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ­£æ•´æ•°åºåˆ—å«åš &lt;code>Sequences&lt;/code>ï¼Œå°±æ˜¯ç¥žç»ç½‘ç»œä¸­ &lt;code>Embedding&lt;/code> å±‚çš„è¾“å…¥ã€‚ç”±äºŽç”µå½±è¯„è®ºçš„é•¿çŸ­ä¸ä¸€ï¼Œå¾—åˆ°çš„ &lt;code>Sequence&lt;/code> çš„é•¿çŸ­ä¹Ÿä¸ä¸€æ ·ï¼Œæ²¡åŠžæ³•å­˜å‚¨åœ¨ä¸€ä¸ªçŸ©é˜µé‡Œï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ &lt;code>Alignment&lt;/code> å¯¹é½ã€‚å‡è®¾æœ€å¤§é•¿åº¦ä¸º &lt;code>20&lt;/code>ï¼Œå¦‚æžœé•¿åº¦å¤§äºŽ&lt;code>20&lt;/code>ï¼Œå°±åªä¿ç•™æœ€åŽ &lt;code>20&lt;/code> ä¸ªå•è¯ï¼›å¦‚æžœé•¿åº¦ä¸åˆ° &lt;code>20&lt;/code>ï¼Œå°±ç”¨ &lt;code>0&lt;/code> è¡¥é½ï¼ŒæŠŠé•¿åº¦å¢žåŠ åˆ° &lt;code>20&lt;/code>ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ª &lt;code>Sequences&lt;/code> é•¿åº¦éƒ½ç›¸åŒã€‚&lt;/p></description></item><item><title>RNN</title><link>https://emerywan.github.io/blog/p/nlp-in-action/simple-rnn/</link><pubDate>Tue, 08 Mar 2022 20:36:14 +0800</pubDate><guid>https://emerywan.github.io/blog/p/nlp-in-action/simple-rnn/</guid><description>&lt;img src="https://nlp.letout.cn/img/banner.png" alt="Featured image of post RNN" />&lt;p>è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥å­¦ä¹ &lt;strong>å¾ªçŽ¯ç¥žç»ç½‘ç»œ&lt;/strong>&lt;code>Recurrent Neural Networks&lt;/code>ã€‚æœ¬èŠ‚çš„å†…å®¹æ˜¯ &lt;code>Simple RNN&lt;/code>ï¼Œä»¥åŠç”¨ &lt;code>Pytorch&lt;/code> ç¼–ç¨‹å®žçŽ° &lt;code>Simple RNN&lt;/code>ã€‚&lt;/p>
&lt;h2 id="-ç®€ä»‹">ðŸŒ± ç®€ä»‹&lt;/h2>
&lt;p>çŽ°åœ¨ &lt;code>RNN&lt;/code> æ²¡æœ‰ä»¥å‰æµè¡Œï¼Œå°¤å…¶æ˜¯åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸Šï¼Œ&lt;code>RNN&lt;/code> å·²ç»æœ‰ä¸€äº›è¿‡æ—¶äº†ï¼Œå¦‚æžœè®­ç»ƒçš„æ•°æ®è¶³å¤Ÿå¤šï¼Œ&lt;code>RNN&lt;/code> çš„æ•ˆæžœä¸å¦‚ &lt;code>Transformer&lt;/code> æ¨¡åž‹ï¼Œä½†æ˜¯åœ¨å°è§„æ¨¡çš„é—®é¢˜ä¸Šï¼Œ&lt;code>RNN&lt;/code> è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚&lt;/p>
&lt;h2 id="-å¦‚ä½•å»ºæ¨¡æ—¶åºæ•°æ®">ðŸ”– å¦‚ä½•å»ºæ¨¡æ—¶åºæ•°æ®ï¼Ÿ&lt;/h2>
&lt;p>æœºå™¨å­¦ä¹ ä¸­ç»å¸¸ç”¨åˆ°æ–‡æœ¬ã€è¯­éŸ³ç­‰ &lt;strong>æ—¶åºæ•°æ®&lt;/strong>&lt;code>sequential data&lt;/code>ï¼ˆæŒ‰æ—¶é—´é¡ºåºè®°å½•çš„æ•°æ®åˆ—ï¼Œæœ‰é•¿åº¦ä¸å›ºå®šçš„ç‰¹ç‚¹ï¼‰ã€‚&lt;/p>
&lt;p>é¦–å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæ€Žä¹ˆå¯¹è¿™æ ·çš„æ—¶åºæ•°æ®è¿›è¡Œå»ºæ¨¡ï¼Ÿ
åœ¨ä¸Šä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€æ®µæ–‡å­—æ•´ä½“è¾“å…¥åˆ°ä¸€ä¸ªé€»è¾‘å›žå½’ &lt;code>Logistic Regression&lt;/code> æ¨¡åž‹ä¸­ï¼Œè®©æ¨¡åž‹æ¥åšäºŒåˆ†ç±»ï¼Œè¿™å±žäºŽä¸€ä¸ª &lt;code>one-to-one&lt;/code> æ¨¡åž‹ï¼Œä¸€ä¸ªè¾“å…¥å¯¹åº”ä¸€ä¸ªè¾“å‡ºã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/1.png"
loading="lazy"
alt="1"
>&lt;/p>
&lt;p>å…¨è¿žæŽ¥ç¥žç»ç½‘ç»œå’Œå·ç§¯ç¥žç»ç½‘ç»œéƒ½å±žäºŽ &lt;code>one-to-one&lt;/code> æ¨¡åž‹ã€‚&lt;/p>
&lt;p>äººè„‘å¹¶ä¸ä¼šä½¿ç”¨ &lt;code>one-to-one&lt;/code> æ¨¡åž‹å¤„ç†æ—¶åºæ•°æ®ï¼Œä¸ä¼šæŠŠä¸€æ•´æ®µæ–‡å­—å…¨éƒ¨è¾“å…¥åˆ°å¤§è„‘ï¼Œæˆ‘ä»¬åœ¨é˜…è¯»çš„æ—¶å€™ï¼Œä¼šä»Žå·¦åˆ°å³é˜…è¯»ä¸€æ®µæ–‡å­—ï¼Œä¸æ–­åœ°åœ¨å¤§è„‘é‡Œç§¯ç´¯ä¿¡æ¯ï¼Œé˜…è¯»ä¸€æ®µè¯ä¹‹åŽï¼Œä½ è„‘å­é‡Œå°±ç§¯ç´¯äº†ä¸€æ®µæ–‡å­—çš„å¤§æ„ã€‚&lt;/p>
&lt;p>&lt;code>one-to-one&lt;/code> æ¨¡åž‹è¦æ±‚ä¸€ä¸ªè¾“å…¥å¯¹åº”ä¸€ä¸ªè¾“å‡ºï¼Œæ¯”å¦‚ï¼šè¾“å…¥ä¸€å¼ å›¾ç‰‡ï¼Œè¾“å‡ºæ¯ä¸€ç±»çš„æ¦‚çŽ‡å€¼ï¼Œ&lt;code>one-to-one&lt;/code> çš„æ¨¡åž‹æ¯”è¾ƒé€‚åˆè¿™ç±»å›¾ç‰‡é—®é¢˜ï¼Œä½†æ˜¯ä¸å¤ªé€‚åˆæ–‡æœ¬é—®é¢˜ã€‚&lt;/p>
&lt;p>å¯¹äºŽæ–‡æœ¬é—®é¢˜ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„é•¿åº¦å¹¶ä¸å›ºå®šï¼Œä¸€æ®µè¯å¯é•¿å¯çŸ­ï¼Œæ‰€ä»¥è¾“å…¥çš„é•¿åº¦å¹¶ä¸å›ºå®šï¼›è¾“å‡ºçš„é•¿åº¦ä¹Ÿä¸å›ºå®šï¼Œæ¯”å¦‚å°†è‹±è¯­ç¿»è¯‘æˆæ±‰è¯­ï¼Œä¸€å¥è‹±è¯­æœ‰åä¸ªå•è¯ï¼Œç¿»è¯‘æˆæ±‰è¯­å¯èƒ½æœ‰åä¸ªå­—ï¼Œå¯èƒ½æœ‰å…«ä¸ªå­—ï¼Œä¹Ÿå¯èƒ½æ˜¯å››ä¸ªå­—çš„æˆè¯­ï¼Œè¾“å‡ºæ±‰è¯­çš„å­—æ•°å¹¶ä¸å›ºå®šï¼Œç”±äºŽè¾“å…¥å’Œè¾“å‡ºçš„é•¿åº¦ä¸å›ºå®šï¼Œ&lt;code>one-to-one&lt;/code> æ¨¡åž‹å°±ä¸å¤ªé€‚åˆäº†ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/translation.png"
loading="lazy"
alt="translation"
>&lt;/p>
&lt;p>å¯¹äºŽæ—¶åºæ•°æ®ï¼Œæ›´å¥½çš„æ˜¯ &lt;code>many-to-one&lt;/code> æˆ–è€…æ˜¯ &lt;code>many-to-many&lt;/code> æ¨¡åž‹ï¼Œ&lt;code>RNN&lt;/code> å°±æ˜¯è¿™æ ·çš„æ¨¡åž‹ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„é•¿åº¦éƒ½ä¸å›ºå®šã€‚æ‰€ä»¥ &lt;code>RNN&lt;/code> å¾ˆé€‚åˆè¯­éŸ³ï¼Œæ–‡æœ¬ç­‰æ—¶åºåºåˆ—æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/2.png"
loading="lazy"
alt="2"
>&lt;/p>
&lt;h2 id="-rnn">ðŸ€ï¸ RNN&lt;/h2>
&lt;p>&lt;code>RNN&lt;/code> å’Œè·Ÿäººçš„é˜…è¯»ä¹ æƒ¯å¾ˆç±»ä¼¼ï¼šäººæ¯æ¬¡çœ‹ä¸€ä¸ªè¯ï¼Œä¼šé€æ¸åœ¨å¤§è„‘é‡Œç§¯ç´¯ä¿¡æ¯ï¼›&lt;code>RNN&lt;/code> æ¯çœ‹ä¸€ä¸ªè¯ï¼Œä¼šç”¨çŠ¶æ€å‘é‡ $h$ æ¥ç§¯ç´¯é˜…è¯»è¿‡çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†è¾“å…¥çš„æ¯ä¸ªè¯ç”¨ è¯åµŒå…¥&lt;code>word embedding&lt;/code> å˜æˆä¸€ä¸ªè¯å‘é‡ $x$ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;p>æ¯æ¬¡æŠŠä¸€ä¸ªè¯å‘é‡è¾“å…¥ &lt;code>RNN&lt;/code>ï¼Œå°±ä¼šæ›´æ–°çŠ¶æ€ $h$ ï¼ŒæŠŠæ–°çš„è¾“å…¥ç§¯ç´¯åˆ°çŠ¶æ€ $h$ é‡Œé¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/4.png"
loading="lazy"
alt="4"
>&lt;/p>
&lt;p>åœ¨ $h_0$ä¸­ï¼ŒåŒ…å«äº†ç¬¬ä¸€ä¸ªè¯ &lt;code>the&lt;/code> çš„ä¿¡æ¯ï¼Œåœ¨ $h_1$ é‡Œé¢ï¼ŒåŒ…å«äº†å‰ä¸¤ä¸ª &lt;code>the cat&lt;/code> çš„ä¿¡æ¯ï¼›ä»¥æ­¤ç±»æŽ¨ï¼ŒçŠ¶æ€ $h_2$ åŒ…å« äº†å‰ä¸‰ä¸ªè¯ &lt;code>the cat sat&lt;/code> çš„ä¿¡æ¯ï¼Œæœ€åŽä¸€ä¸ªçŠ¶æ€ $h_t$ åŒ…å«äº†æ•´å¥è¯çš„ä¿¡æ¯ï¼Œå¯ä»¥æŠŠ $h_t$ çœ‹åš &lt;code>RNN&lt;/code> ä»Žæ•´å¥è¯ &lt;code>the cat sat on the mat&lt;/code> æŠ½å–çš„ç‰¹å¾å‘é‡ï¼Œåœ¨æ›´æ–°çŠ¶æ€ $h$ çš„æ—¶å€™ï¼Œéœ€è¦ç”¨åˆ°å‚æ•°çŸ©é˜µ $A$ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/5.png"
loading="lazy"
alt="5"
>&lt;/p>
&lt;p>&lt;strong>æ³¨æ„ï¼šæ•´ä¸ª RNN åªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µ&lt;/strong> $A$ã€‚æ— è®ºè¿™æ¡é“¾æœ‰å¤šé•¿ï¼Œå‚æ•° $A$ åªæœ‰ä¸€ä¸ªï¼Œ$A$ éšæœºåˆå§‹åŒ–ï¼Œç„¶åŽåˆ©ç”¨è®­ç»ƒæ•°æ®æ¥å­¦ä¹  $A$ã€‚ä¸‹é¢é¦–å…ˆè®²è§£ &lt;code>Simple RNN Model&lt;/code>ã€‚&lt;/p>
&lt;h2 id="-simple-rnn">ðŸš€ Simple RNN&lt;/h2>
&lt;p>æˆ‘ä»¬å…·ä½“çœ‹çœ‹ï¼Œ&lt;code>Simple RNN&lt;/code> ç®€å•å¾ªçŽ¯ç¥žç»ç½‘ç»œæ˜¯æ€Žä¹ˆæŠŠè¾“å…¥çš„è¯å‘é‡ $x$ï¼Œç»“åˆåˆ°çŠ¶æ€ $h$ ä¸­çš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/6.png"
loading="lazy"
alt="6"
>&lt;/p>
&lt;p>æˆ‘ä»¬å°†ä¸Šä¸€ä¸ªçŠ¶æ€è®°åš $h_t-1$ï¼Œæ–°è¾“å…¥è¯å‘é‡è®°åš $x_t$ï¼Œå°†è¿™ä¸¤ä¸ªå‘é‡åšæ‹¼æŽ¥ &lt;code>concatenation&lt;/code>ï¼Œå¾—åˆ°ä¸€ä¸ªæ›´é«˜ç»´çš„å‘é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/8.png"
loading="lazy"
alt="8"
>&lt;/p>
&lt;p>å›¾ä¸­è¿™ä¸ªçŸ©é˜µ $A$ æ˜¯ &lt;code>RNN&lt;/code> çš„æ¨¡åž‹å‚æ•°ï¼Œè¿™é‡Œè®¡ç®—çŸ©é˜µ $A$ å’Œè¿™ä¸ªå‘é‡çš„ä¹˜ç§¯ï¼ˆæ‹¼æŽ¥åŽçš„å‘é‡ï¼‰ï¼ŒçŸ©é˜µå’Œå‘é‡çš„ä¹˜ç§¯æ˜¯ä¸€ä¸ªå‘é‡ï¼Œç„¶åŽä½¿ç”¨æ¿€æ´»å‡½æ•° &lt;code>tanh&lt;/code> ä½œç”¨åœ¨å‘é‡çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œæœ€åŽæŠŠæ¿€æ´»å‡½æ•°çš„è¾“å‡ºè®°åšæ–°çš„çŠ¶æ€ $h_t$ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ¿€æ´»å‡½æ•°å¼ åŒæ›²æ­£åˆ‡å‡½æ•° &lt;code>hyperbolic tangent function&lt;/code>ï¼Œè¾“å…¥æ˜¯ä»»æ„å®žæ•°ï¼Œè¾“å‡ºåœ¨ $(-1, +1)$ ä¹‹é—´ã€‚ç”±äºŽç”¨äº†åŒæ›²æ­£åˆ‡æ¿€æ´»å‡½æ•°ï¼Œå‘é‡ $h_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½åœ¨ $(-1, +1)$ ä¹‹é—´ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/7.png"
loading="lazy"
alt="hyperbolic tangent function"
>&lt;/p>
&lt;p>è¿™ä¸ªç¥žç»ç½‘ç»œçš„ç»“æž„å›¾å¯ä»¥è¿™æ ·ç†è§£ï¼šæ–°çš„çŠ¶æ€ $h_t$ï¼Œæ˜¯æ—§çŠ¶æ€ $h_{t-1}$ å’Œæ–°çš„è¾“å…¥ $x_t$ çš„å‡½æ•°ï¼Œç¥žç»ç½‘ç»œæ¨¡åž‹çš„å‚æ•°æ˜¯ $A$ï¼šæ–°çš„çŠ¶æ€ $h_t$ï¼Œä¾èµ–äºŽå‘é‡ $h_{t-1}$, å‘é‡ $x_t$ ä»¥åŠçŸ©é˜µ $A$ã€‚&lt;/p>
&lt;h3 id="-ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨-tanh-ä½œä¸ºæ¿€æ´»å‡½æ•°">ðŸŽ¨ ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ &lt;code>tanh&lt;/code> ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Ÿ&lt;/h3>
&lt;p>æˆ‘ä»¬æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ &lt;code>tanh&lt;/code> ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Ÿèƒ½å¦å°†è¿™ä¸ªæ¿€æ´»å‡½æ•°åŽ»æŽ‰ï¼ŒåŽ»æŽ‰ä¹‹åŽä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/9.png"
loading="lazy"
alt="9"
>&lt;/p>
&lt;p>é¦–å…ˆæˆ‘ä»¬åšä¸ªç®€åŒ–ï¼Œå‡è®¾è¾“å…¥çš„è¯å‘é‡çš„å…ƒç´ éƒ½æ˜¯ $0$ã€‚å¦‚å›¾ï¼Œè¿™ç­‰åŒäºŽè¾“å…¥çš„è¯å‘é‡ $x_t$ éƒ½åŽ»æŽ‰ï¼ŒæŠŠçŸ©é˜µ $A$ å³è¾¹ä¸€åŠä¹ŸåŽ»æŽ‰ã€‚&lt;/p>
&lt;p>$x_0 = x_1 = &amp;hellip; = x_{100} = 0$&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/10.png"
loading="lazy"
alt="10"
>&lt;/p>
&lt;p>è¿™ä¹ˆä¸€æ¥ï¼Œç¬¬ &lt;code>100&lt;/code> ç»´çš„ç‰¹å¾å‘é‡ $h_{100} = Ah_{99} = A^2h_{98} = &amp;hellip; = A^{100}h_0$ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° å‡è®¾çŸ©é˜µ $A$ æœ€å¤§çš„ç‰¹å¾å€¼ç•¥å°äºŽ &lt;code>1&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ¯”å¦‚ï¼Œæœ€å¤§çš„ç‰¹å¾å€¼ç­‰äºŽ &lt;code>0.9&lt;/code>ã€‚é‚£ä¹ˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p>
&lt;p>$0.9^{100}$ éžå¸¸æŽ¥è¿‘äºŽ &lt;code>0&lt;/code> äº†ï¼Œæ‰€ä»¥çŸ©é˜µ $A^{100}$ éžå¸¸æŽ¥è¿‘äºŽ &lt;code>0&lt;/code>ï¼Œé‚£ä¹ˆæ–°çš„ç‰¹å¾å‘é‡ $h_{100}$ ä¹Ÿå‡ ä¹Žä¹Ÿæ˜¯ä¸€ä¸ªå…¨é›¶çš„å‘é‡ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° å‡è®¾çŸ©é˜µ $A$ æœ€å¤§çš„ç‰¹å¾å€¼ç•¥å¤§äºŽ &lt;code>1&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ¯”å¦‚ï¼Œæœ€å¤§çš„ç‰¹å¾å€¼ç­‰äºŽ &lt;code>1.2&lt;/code>ã€‚&lt;/p>
&lt;p>$1.2^{100}=82817974.522$ï¼Œæ‰€ä»¥çŸ©é˜µ $A^{100}$ çš„å…ƒç´ éƒ½è¶…çº§å¤§ï¼Œ$A^{100}$çš„æ¯ä¸ªå…ƒç´ éƒ½å¾ˆå¤§ï¼Œå‡å¦‚å¾ªçŽ¯çš„æ¬¡æ•°æ›´å¤šä¸€äº›ï¼Œæˆ–è€… $A$ çš„ç‰¹å¾å€¼å†å¤§ä¸€äº›ï¼ŒçŠ¶æ€å‘é‡çš„å€¼å°±ä¼šçˆ†ç‚¸ã€‚&lt;/p>
&lt;p>å‡å¦‚æ²¡æœ‰è¿™ä¸ªæ¿€æ´»å‡½æ•° &lt;code>tanh&lt;/code>ï¼Œæ•°å€¼è®¡ç®—çš„æ—¶å€™å¾ˆæœ‰å¯èƒ½ä¼šå‡ºé—®é¢˜ï¼Œè¦ä¹ˆè®¡ç®—å‡ºçš„ç»“æžœå…¨éƒ¨ç­‰äºŽ &lt;code>0&lt;/code>ï¼Œè¦ä¹ˆçˆ†ç‚¸äº†å…¨éƒ¨æ˜¯ &lt;code>NaN: Not a Number&lt;/code>ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ¿€æ´»å‡½æ•°ï¼Œæ¯æ¬¡æ›´æ–°çŠ¶æ€ $h$ åŽï¼Œéƒ½ä¼šåšä¸€ä¸ªæ ‡å‡†åŒ–æ“ä½œ &lt;code>normalization&lt;/code>ï¼Œè®© $h$ æ¢å¤åˆ° $(-1, +1)$ è¿™ä¸ªåˆé€‚çš„åŒºé—´é‡Œã€‚&lt;/p>
&lt;h3 id="-simple-rnn-æ¨¡åž‹å‚æ•°æ•°é‡">ðŸï¸ Simple RNN æ¨¡åž‹å‚æ•°æ•°é‡&lt;/h3>
&lt;p>æˆ‘ä»¬æ¥æ•°ä¸€ä¸‹ &lt;code>Simple RNN&lt;/code> æœ‰å¤šå°‘ä¸ªæ¨¡åž‹å‚æ•°ã€‚&lt;/p>
&lt;p>å¦‚å›¾ï¼Œå…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªæ‹¼æŽ¥åŽå‘é‡ï¼Œè¿™ä¸ªå‘é‡çš„ç»´åº¦æ˜¯ $h_{t-1}$ çš„ç»´åº¦åŠ ä¸Š $x_t$ çš„ç»´åº¦ï¼š&lt;/p>
&lt;p>æ‰€ä»¥ $A$ ä¸€å®šè¦æœ‰ $shape(h)+shape(x)$ ç»´åº¦è¿™ä¹ˆå¤šåˆ—ï¼š&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/11.png"
loading="lazy"
alt="11"
>&lt;/p>
&lt;p>$A$ çš„è¡Œæ•°ç­‰äºŽ $h$ çš„ç»´åº¦ï¼š&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/12.png"
loading="lazy"
alt="12"
>&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œæœ€ç»ˆçŸ©é˜µ $A$ çš„å¤§å°ç­‰äºŽï¼š&lt;/p>
&lt;p>$parameter(A) = shape(h) * [shape(h) + shape(x)]$&lt;/p>
&lt;p>è¿™ä¸ªä¹˜ç§¯ $parameter(A)$ å°±æ˜¯ &lt;code>simple RNN&lt;/code> çš„æœ€ç»ˆçš„å‚æ•°æ•°é‡ã€‚&lt;/p>
&lt;h2 id="-todo-simple-rnn-çš„ç”µå½±è¯„è®ºåˆ†æž">ðŸ“– (TODO) Simple RNN çš„ç”µå½±è¯„è®ºåˆ†æž&lt;/h2>
&lt;p>&lt;strong>Doing&lt;/strong>&lt;/p>
&lt;h2 id="-simple-rnn-çš„ç¼ºé™·">ðŸ§° simple RNN çš„ç¼ºé™·&lt;/h2>
&lt;p>ä¸‹é¢çœ‹ä¸€ä¸‹ &lt;code>simple RNN&lt;/code> è¿™ç§ç®€å•çš„æ¨¡åž‹æœ‰ä»€ä¹ˆç¼ºé™·ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªæ —å­ ðŸŒ° ï¼ŒçŽ°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œç»™å®šåŠå¥è¯ï¼Œè¦æ±‚é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/16.png"
loading="lazy"
alt="16"
>&lt;/p>
&lt;p>è¾“å…¥æ˜¯ &lt;code>clouds are in the&lt;/code>ï¼Œæ­£ç¡®çš„è¾“å‡ºåº”è¯¥æ˜¯ &lt;code>sky&lt;/code>ï¼Œå¦‚æžœåœ¨å¤§é‡æ–‡æœ¬ä¸­é¢„æµ‹ RNNï¼Œåº”è¯¥æ˜¯æœ‰èƒ½åŠ›åšå‡ºè¿™æ ·çš„é¢„æµ‹çš„ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œ&lt;code>RNN&lt;/code> åªéœ€è¦çœ‹æœ€è¿‘çš„å‡ ä¸ªè¯ï¼Œå°¤å…¶æ˜¯ &lt;code>clouds are&lt;/code>ï¼Œå¹¶ä¸éœ€è¦æ›´å¤šçš„ä¸Šä¸‹æ–‡çœ‹çš„æ›´è¿œã€‚&lt;/p>
&lt;p>è¿™ä¸ªä¾‹å­æ˜¯å¯¹ &lt;code>simple RNN&lt;/code> ååˆ†æœ‰åˆ©ï¼Œ&lt;code>simple RNN&lt;/code> ç‰¹åˆ«æ“…é•¿è¿™ç§ &lt;code>short-term dependence&lt;/code>ï¼Œ&lt;code>simple RNN&lt;/code> ä¸æ“…é•¿çš„æ˜¯ &lt;code>long-term dependence&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>RNN&lt;/code> çš„çŠ¶æ€ $h$ï¼Œå’Œä¹‹å‰æ‰€æœ‰çš„è¾“å…¥ $x$ éƒ½æœ‰å‡½æ•°ä¾èµ–å…³ç³»ï¼Œç…§ç†æ¥è¯´ï¼Œå¦‚æžœæ”¹å˜è¾“å…¥çš„å•è¯ $x_1$ï¼Œæ‰€æœ‰çš„çŠ¶æ€ $h$ éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†å®žé™…ä¸Šï¼Œ&lt;code>simple RNN&lt;/code> å¹¶æ²¡æœ‰è¿™ç§æ€§è´¨ï¼Œæ‰€ä»¥å¾ˆä¸åˆç†ã€‚å¦‚æžœæŠŠç¬¬ &lt;code>100&lt;/code> ä¸ªçŠ¶æ€å‘é‡ $h_{100}$ï¼Œå…³äºŽè¾“å…¥ $x_1$ æ±‚å¯¼ï¼Œä½ ä¼šå‘çŽ°å¯¼æ•°å‡ ä¹Žç­‰äºŽ &lt;code>0&lt;/code>ã€‚&lt;/p>
&lt;p>$\frac{\partial h_{100}}{\partial x_1} \approx 0$&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/17.png"
loading="lazy"
alt="17"
>&lt;/p>
&lt;p>å¯¼æ•°å‡ ä¹Žç­‰äºŽ &lt;code>0&lt;/code> è¯´æ˜Žä»€ä¹ˆå‘¢ï¼Ÿè¯´æ˜Žå½“æˆ‘ä»¬æ”¹å˜ $x_1$æ—¶ï¼Œ$h_{100}$ å‡ ä¹Žä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´çŠ¶æ€ $h_{100}$ å’Œ &lt;code>100&lt;/code> æ­¥ä¹‹å‰çš„è¾“å…¥ $x_1$ å‡ ä¹Žæ²¡æœ‰å…³ç³»ï¼Œè¿™æ˜¾ç„¶ä¸åˆç†ï¼Œè¯´æ˜ŽçŠ¶æ€ $h_{100}$ å‡ ä¹ŽæŠŠå¾ˆå¤šæ­¥ä¹‹å‰çš„è¾“å…¥éƒ½ç»™å¿˜è®°äº†ï¼Œ&lt;code>simple RNN&lt;/code> çš„è¿™ç§é—å¿˜ä¼šç»™åŽç»­æ“ä½œé€ æˆå¾ˆå¤šé—®é¢˜ã€‚&lt;/p>
&lt;p>å†ä¸¾ä¸ªæ —å­ ðŸŒ° ï¼Œè¿™æ˜¯å¾ˆé•¿çš„ä¸€æ®µè¯ï¼Œä¸€å¼€å§‹æ˜¯ &lt;code>I grow up in China when I was a child, ... ...&lt;/code> åˆ°äº†å¾ˆå¤šå¥è¯ä¹‹åŽï¼Œæœ‰è¿™æ ·ä¸€å¥ï¼Œ&lt;code>I speak fluent ...&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/18.png"
loading="lazy"
alt="18"
>&lt;/p>
&lt;p>ä¸‹ä¸€ä¸ªè¯åº”è¯¥æ˜¯ &lt;code>Chinese&lt;/code>ï¼Œæˆ‘å°æ—¶å€™åœ¨ä¸­å›½ï¼Œæ‰€æœ‰ä¼šè¯´æµåˆ©çš„ä¸­æ–‡ï¼Œç„¶è€Œ &lt;code>simple RNN&lt;/code> ä¸å¤ªå¯èƒ½ä¼šåšå‡º &lt;code>Chinese&lt;/code> è¿™ä¸ªæ­£ç¡®çš„é¢„æµ‹ï¼Œå› ä¸º RNN å·²ç»æŠŠå‰æ–‡ç»™å¿˜è®°äº†ã€‚&lt;code>simple RNN&lt;/code> æ“…é•¿çš„æ˜¯ &lt;code>short-term dependence&lt;/code>ï¼ŒRNN çœ‹åˆ°æœ€è¿‘çš„å•è¯æ˜¯ &lt;code>speak fluent&lt;/code>ï¼Œæ‰€ä»¥ RNN çŸ¥é“ä¸‹ä¸€ä¸ªå•è¯å¯èƒ½æ˜¯æŸç§è¯­è¨€ï¼Œå¯èƒ½æ˜¯ &lt;code>Chineseã€Englishã€Frenchã€Japanese&lt;/code> ç­‰ç­‰ï¼Œä½†æ­£ç¡®ç­”æ¡ˆæ˜¯ &lt;code>Chinese&lt;/code>ï¼Œå› ä¸ºä¸Šæ–‡æœ‰ &lt;code>I grow up in china when i was child&lt;/code>ï¼Œsimple RNN å°±åƒé‡‘é±¼ä¸€æ ·è®°å¿†åŠ›åªæœ‰ &lt;code>7&lt;/code> ç§’ï¼Œ&lt;code>RNN&lt;/code> æ ¹æœ¬å°±ä¸è®°å¾—ä¸Šæ–‡æœ‰è¿™å¥è¯ï¼Œæ‰€ä»¥ &lt;code>I speak fluent ...&lt;/code> é¢„æµ‹å•è¯å¯èƒ½æ˜¯ &lt;code>English , French&lt;/code> ç­‰ä»»ä½•ä¸€ç§è¯­è¨€ï¼Œæœªå¿…æ˜¯ &lt;code>Chinese&lt;/code>ã€‚&lt;/p>
&lt;h2 id="-æ€»ç»“">ðŸŽ æ€»ç»“&lt;/h2>
&lt;p>æœ€åŽæ€»ç»“ä¸€ä¸‹è¿™ä¸€èŠ‚çš„å†…å®¹ï¼š&lt;/p>
&lt;p>&lt;code>RNN&lt;/code> æ˜¯ä¸€ç§ç¥žç»ç½‘ç»œï¼Œä½†æ˜¯ä»–çš„ç»“æž„ä¸åŒäºŽå…¨è¿žæŽ¥ç½‘ç»œå’Œå·ç§¯ç½‘ç»œï¼Œ&lt;code>RNN&lt;/code> é€‚ç”¨äºŽæ–‡æœ¬ï¼Œè¯­éŸ³ç­‰æ—¶åºåºåˆ—æ•°æ®ï¼Œ&lt;code>RNN&lt;/code> æŒ‰ç…§é¡ºåºè¯»å–æ¯ä¸€ä¸ªè¯å‘é‡ï¼Œå¹¶ä¸”åœ¨çŠ¶æ€å‘é‡ $h$ ä¸­ç§¯ç´¯çœ‹åˆ°è¿‡å¾—ä¿¡æ¯ï¼Œ$h_0$ ä¸­åŒ…å«äº† $x_0$ çš„ä¿¡æ¯ï¼Œ$h_1$ ä¸­åŒ…å«äº† $x_0$ å’Œ $x_1$ çš„ä¿¡æ¯ï¼Œ$h_t$ ä¸­ç§¯ç´¯äº†ä¹‹å‰æ‰€æœ‰ $x={x_0, x_1, &amp;hellip;, x_t}$ çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/03/19.png"
loading="lazy"
alt="19"
>&lt;/p>
&lt;p>æœ‰ä¸€ç§é”™è¯¯çš„çœ‹æ³•æ˜¯ $h_t$ ä¸­åªåŒ…å«äº† $x_t$ çš„ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸å¯¹çš„ï¼Œ$h_t$ ä¸­åŒ…å«äº†ä¹‹å‰æ‰€æœ‰è¾“å…¥çš„ä¿¡æ¯ï¼Œå¯ä»¥è®¤ä¸º $h_t$ ä»£è¡¨äº† &lt;code>RNN&lt;/code> ä»Žæ•´ä¸ªåºåˆ—ä¸­æŠ½å–çš„ç‰¹å¾å‘é‡ï¼Œæ‰€æœ‰æˆ‘ä»¬åªéœ€è¦ $h_t$ å°±å¯ä»¥åˆ¤æ–­ç”µå½±è¯„ä»·æ˜¯æ­£é¢çš„è¿˜æ˜¯è´Ÿé¢çš„ã€‚&lt;/p>
&lt;p>&lt;code>simple RNN&lt;/code> æœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µ $A$ï¼Œå®ƒå¯èƒ½è¿˜ä¼šä¸€ä¸ª &lt;code>intercept&lt;/code> å‚æ•°å‘é‡ $b$ï¼Œä¸Šé¢çš„ä»‹ç»ä¸­å¿½ç•¥äº†è¿™ä¸ªå‚æ•°å‘é‡ $b$ï¼Œè¿™ä¸ªå‚æ•°çŸ©é˜µ $A$ çš„ç»´åº¦æ˜¯ï¼š&lt;/p>
&lt;p>$shape(h) * [shape(h) + shape(x)]$&lt;/p>
&lt;p>å‚æ•°çŸ©é˜µ $A$ ä¸€å¼€å§‹éšæœºåˆå§‹åŒ–ï¼Œç„¶åŽä»Žè®­ç»ƒæ•°æ®ä¸Šå­¦ä¹ ã€‚æ³¨æ„ï¼š&lt;code>simple RNN&lt;/code> åªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µï¼Œä¸ç®¡è¿™ä¸ªåºåˆ—æœ‰å¤šé•¿ï¼Œå‚æ•°çŸ©é˜µåªæœ‰ä¸€ä¸ªï¼Œæ‰€æœ‰æ¨¡å—é‡Œçš„å‚æ•°éƒ½æ˜¯ä¸€æ ·çš„ã€‚&lt;/p>
&lt;p>&lt;code>RNN&lt;/code> æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œ&lt;code>RNN&lt;/code> çš„è®°å¿†æ¯”è¾ƒçŸ­ï¼Œä¼šé—å¿˜å¾ˆä¹…ä¹‹å‰çš„è¾“å…¥ $x$ï¼Œå¦‚æžœè¿™ä¸ªæ—¶é—´åºåˆ—å¾ˆé•¿ï¼Œæœ‰å¥½å‡ åæ­¥ï¼Œæœ€ç»ˆ &lt;code>RNN&lt;/code> å°±ä¼šå¿˜è®°äº†ä¹‹å‰çš„è¾“å…¥ã€‚ä¸‹ä¸€èŠ‚å°†ä»‹ç» &lt;code>LSTM&lt;/code>ï¼Œ&lt;code>LSTM&lt;/code> çš„è®°å¿†ä¼šæ¯” &lt;code>simple RNN&lt;/code> é•¿å¾ˆå¤šï¼Œä½†æ˜¯ &lt;code>RNN&lt;/code> ä¹Ÿè¿˜æ˜¯ä¼šæœ‰é—å¿˜çš„é—®é¢˜ã€‚&lt;/p></description></item><item><title>æ•°æ®å¤„ç†åŸºç¡€</title><link>https://emerywan.github.io/blog/p/nlp-in-action/data-processing/</link><pubDate>Tue, 01 Mar 2022 02:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/nlp-in-action/data-processing/</guid><description>&lt;img src="https://nlp.letout.cn/img/banner.png" alt="Featured image of post æ•°æ®å¤„ç†åŸºç¡€" />&lt;h2 id="-ç±»åˆ«ç‰¹å¾">ðŸŒ± ç±»åˆ«ç‰¹å¾&lt;/h2>
&lt;p>æœºå™¨å­¦ä¹ çš„æ•°æ®é€šå¸¸æœ‰ &lt;strong>ç±»åˆ«ç‰¹å¾&lt;/strong> &lt;code>Categorical Features&lt;/code> ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç±»åˆ«ç‰¹å¾ &lt;code>Categorical Features&lt;/code> è½¬åŒ–æˆæœºå™¨å­¦ä¹ æ¨¡åž‹èƒ½ç†è§£çš„æ•°å€¼ç‰¹å¾ï¼Œä¸‹é¢ä½¿ç”¨ä¸€ä¸ªä¾‹å­æ¥å…·ä½“è®²è§£ç±»åˆ«ç‰¹å¾æ•°æ®çš„å¤„ç†ã€‚&lt;/p>
&lt;p>è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªäººçš„æ•°æ®ï¼ŒåŒ…æ‹¬ï¼šå¹´é¾„ã€æ€§åˆ«ã€å›½ç±ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™äº›æ•°æ®å˜æˆæœºå™¨å­¦ä¹ æ¨¡åž‹å¯ä»¥ç†è§£çš„æ•°å€¼ç‰¹å¾ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/table.png"
loading="lazy"
alt="table"
>&lt;/p>
&lt;p>è¡¨æ ¼çš„ç¬¬ä¸€åˆ—æ˜¯å¹´é¾„ï¼Œå¹´é¾„æœ¬èº«å°±æ˜¯æ•°å€¼ç‰¹å¾ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨åšå¤„ç†ï¼Œæ•°å€¼ç‰¹å¾çš„ç‰¹ç‚¹æ˜¯å¯ä»¥æ¯”è¾ƒå¤§å°ï¼Œæ¯”å¦‚ &lt;code>35&lt;/code> å²çš„äººæ¯” &lt;code>31&lt;/code> å²çš„å¹´é¾„å¤§ã€‚&lt;/p>
&lt;p>ç¬¬äºŒåˆ—æ˜¯æ€§åˆ«ï¼Œæ€§åˆ«æ˜¯äºŒå…ƒç‰¹å¾ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ•°æ¥è¡¨ç¤ºæ€§åˆ«ã€‚ç”¨ &lt;code>0&lt;/code> è¡¨ç¤ºå¥³æ€§ï¼Œç”¨ &lt;code>1&lt;/code> è¡¨ç¤ºç”·æ€§ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ€§åˆ«å°±è¡¨ç¤ºä¸ºä¸€ä¸ªæ ‡é‡ï¼š&lt;code>0&lt;/code> / &lt;code>1&lt;/code>ã€‚&lt;/p>
&lt;p>ç¬¬ä¸‰åˆ—æ˜¯å›½ç±ï¼Œæ¯”å¦‚ä¸­å›½ï¼Œç¾Žå›½ï¼Œå°åº¦ã€‚å›½ç±æ˜¯ç±»åˆ«ç‰¹å¾ï¼Œæœºå™¨å­¦ä¹ å¹¶ä¸ç†è§£å›½ç±ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠå›½ç±ç¼–ç æˆæ•°å€¼å‘é‡ã€‚ä¸–ç•Œä¸Šçº¦æœ‰ &lt;code>197&lt;/code> ä¸ªå›½å®¶ï¼Œæˆ‘ä»¬å…ˆç”¨ä¸€ä¸ª &lt;code>[1 - 197]&lt;/code> çš„æ•´æ•°è¡¨ç¤ºä¸€ä¸ªå›½å®¶ã€‚å¯ä»¥å»ºç«‹ä¸€ä¸ªå­—å…¸ï¼ŒæŠŠå›½ç±æ˜ å°„æˆä¸€ä¸ª &lt;code>[1 - 197]&lt;/code> çš„æ•´æ•°ã€‚æ¯”å¦‚ï¼š&lt;code>China:1; US:2; India:3; Japan:4; Germany:5&lt;/code>ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>&lt;strong>æˆ‘ä»¬è¦ä»Ž 1 å¼€å§‹è®¡ç®—ï¼Œè€Œä¸èƒ½ä»Ž 0 å¼€å§‹è®¡ç®—ã€‚&lt;/strong>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>åšè¿™ç§æ˜ å°„ï¼Œå›½ç±å°±è¡¨ç¤ºæˆ &lt;code>[1 - 197]&lt;/code> ä¹‹é—´çš„æ•´æ•°ã€‚ä»…ä»…æŠŠå›½ç±è¡¨ç¤ºæˆ &lt;code>[1 - 197]&lt;/code> çš„æ•´æ•°è¿˜æ˜¯ä¸è¡Œï¼Œä¸€ä¸ªæ•´æ•°åªæ˜¯ä¸€ç§ç±»åˆ«ï¼Œå®ƒä»¬ä¹‹é—´ä¸èƒ½æ¯”è¾ƒå¤§å°ã€‚&lt;code>US:2; India:3&lt;/code> è¿™ä¸ªæ•°å­—å¹¶ä¸è¡¨ç¤ºå°åº¦å¤§äºŽç¾Žå›½ï¼Œè¿™äº›æ•´æ•°åªæ˜¯ç±»åˆ«è€Œå·²ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„æ•°å€¼ç‰¹å¾ã€‚&lt;/p>
&lt;p>æ‰€ä»¥è¦è¿›ä¸€æ­¥å¯¹å›½ç±åš &lt;code>one-hot encoding&lt;/code> ï¼Œç”¨ &lt;code>one-hot&lt;/code> å‘é‡æ¥è¡¨ç¤ºå›½ç±ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">China -&amp;gt; 1 -&amp;gt; [1,0,0,0,...,0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">US -&amp;gt; 2 -&amp;gt; [0,1,0,0,...,0]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¯”å¦‚ï¼Œä¸­å›½å¯¹åº” 1ï¼Œæ‰€ä»¥ç”¨ 197 ç»´çš„ &lt;code>one-hot&lt;/code> å‘é‡ &lt;code>[1,0,0,0...,0]&lt;/code> æ¥è¡¨ç¤ºï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ï¼›ç¾Žå›½å¯¹åº” 2ï¼Œè¿™ä¸ª 197 ç»´çš„å‘é‡ &lt;code>[0,1,0,0...,0]&lt;/code> ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªå›½ç±å°±ç”±ä¸€ä¸ª &lt;code>one-hot&lt;/code> å‘é‡è¡¨ç¤ºï¼Œä¸€å…±æœ‰ 197 ä¸ªå›½å®¶ï¼Œæ‰€ä»¥æ¯ä¸ªå‘é‡éƒ½æ˜¯ 197 ç»´çš„ã€‚&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->æˆ‘ä»¬è¦ä»Ž 1 å¼€å§‹è®¡ç®—ï¼Œè€Œä¸èƒ½ä»Ž 0 å¼€å§‹è®¡ç®—ã€‚&lt;!-- raw HTML omitted -->
å› ä¸ºæˆ‘ä»¬è¦æŠŠ 0 ä¿ç•™ï¼Œç”¨æ¥è¡¨ç¤ºæœªçŸ¥æˆ–è€…ç¼ºå¤±çš„å›½ç±ã€‚æ•°æ®åº“é‡Œé¢ç»å¸¸ä¼šæœ‰ç¼ºå¤±çš„æ•°æ®ï¼ˆæ¯”å¦‚ç”¨æˆ·æ²¡æœ‰å¡«å†™å›½ç±ï¼‰ï¼Œè¿™æ ·ç¼ºå¤±çš„å›½ç±å°±ç”¨ 0 æ¥è¡¨ç¤ºï¼Œå®ƒçš„ &lt;code>one-hot&lt;/code> å‘é‡å°±æ˜¯ä¸€ä¸ªå…¨ 0 çš„å‘é‡&lt;code>[0,0,0,0...,0]&lt;/code>ã€‚&lt;/p>
&lt;p>ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª 199 ç»´è¡¨ç¤ºä¸€ä¸ªäººçš„ç‰¹å¾ã€‚æ¯”å¦‚è¿™ä¸ªäºº 28 å²ï¼Œå¥³æ€§ï¼Œå›½ç±æ˜¯ä¸­å›½ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/1.png"
loading="lazy"
alt="1"
>&lt;/p>
&lt;p>å…¶ä¸­ï¼Œä¸€ä¸ªç»´åº¦è¡¨ç¤ºå¹´é¾„ï¼Œä¸€ä¸ªç»´åº¦è¡¨ç¤ºæ€§åˆ«ï¼Œä¸€ä¸ª 197 ç»´çš„ &lt;code>one-hot&lt;/code> å‘é‡è¡¨ç¤ºå›½ç±ã€‚&lt;/p>
&lt;p>è¿™ä¸ªä¾‹å­é‡Œï¼Œè¿™ä¸ª 36 å²ï¼Œç”·æ€§ï¼Œå›½ç±æœªçŸ¥çš„äººçš„ç‰¹å¾æ˜¯è¿™ä¸ª 199 ç»´çš„å‘é‡ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª 197 ç»´çš„å…¨ 0 å‘é‡è¡¨ç¤ºæœªçŸ¥å›½ç±ã€‚&lt;/p>
&lt;h2 id="-ä¸ºä»€ä¹ˆè¦ç”¨-one-hot-å‘é‡è¡¨ç¤ºç‰¹å¾">ðŸ”– ä¸ºä»€ä¹ˆè¦ç”¨ one-hot å‘é‡è¡¨ç¤ºç‰¹å¾&lt;/h2>
&lt;p>åœ¨å¤„ç†ç±»åˆ«ç‰¹å¾çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code>one-hot&lt;/code> å‘é‡è¡¨ç¤ºå›½ç±ï¼Œæ¯ä¸ªå›½ç±éƒ½ç”¨ 197 ç»´çš„å‘é‡è¡¨ç¤ºã€‚ä¸ºä»€ä¹ˆè¦ç”¨ &lt;code>one-hot&lt;/code> å‘é‡è€Œä¸ç”¨ä¸€ä¸ªæ•°å­—è¡¨ç¤ºå‘¢ï¼Ÿæ¯”å¦‚ç”¨ 1 è¡¨ç¤ºä¸­å›½ï¼Œ2 è¡¨ç¤ºç¾Žå›½ï¼Œ3 è¡¨ç¤ºå°åº¦ã€‚è¿™æ ·ä¸€æ¥ï¼Œåå­—å°±å˜æˆäº†æ•°å­—ï¼Œå¯ä»¥åšæ•°å€¼è®¡ç®—ï¼Œè€Œä¸”ç”¨ä¸€ä¸ªæ•°å­—è¡¨ç¤ºçš„è¯ï¼Œå¯ä»¥èŠ‚çœ 197 å€çš„å­˜å‚¨ç©ºé—´ã€‚å½“ç„¶è¿™æ˜¯ä¸è¡Œçš„ã€‚å¦åˆ™æˆ‘ä»¬å°±ä¸éœ€è¦ &lt;code>one-hot encoding&lt;/code> äº†ã€‚&lt;/p>
&lt;p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨ &lt;code>1 -&amp;gt; China; 2 -&amp;gt; US; 3 -&amp;gt; India&lt;/code>ã€‚é‚£ä¹ˆå°†ä¸­å›½ &lt;code>1&lt;/code> å’Œç¾Žå›½ &lt;code>2&lt;/code> çš„ç‰¹å¾åŠ èµ·æ¥ï¼š&lt;code>1+2=3&lt;/code> ï¼Œç›¸å½“äºŽ â€œä¸­å›½ + ç¾Žå›½ = å°åº¦â€ã€‚è¿™æ ·çš„ç‰¹å¾å®Œå…¨ä¸åˆç†ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/2.png"
loading="lazy"
alt="2"
>&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>one-hot&lt;/code> ç‰¹å¾å‘é‡æ›´åˆç†ã€‚å°† China å’Œ US çš„ &lt;code>one-hot&lt;/code> å‘é‡åŠ èµ·æ¥ï¼Œå¾—åˆ° &lt;code>[1,1,0,0,...,0]&lt;/code>ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå…ƒç´ éƒ½æ˜¯ 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ï¼Œè¿™ä¸ªç‰¹å¾å‘é‡çš„è§£é‡Šæ˜¯ï¼šæ—¢æœ‰ä¸­å›½å›½ç±ï¼Œåˆæœ‰ç¾Žå›½å›½ç±ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/3.png"
loading="lazy"
alt="3"
>&lt;/p>
&lt;p>æ‰€ä»¥åšæœºå™¨å­¦ä¹ çš„æ—¶å€™ï¼Œä¸èƒ½ç”¨ä¸€ä¸ªæ ‡é‡æ¥è¡¨ç¤ºä¸€ä¸ªç±»åˆ«ç‰¹å¾ï¼Œè¿™ç§ç‰¹å¾åšæ³•æ±‚å’Œç­‰æ•°å€¼è®¡ç®—æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨ &lt;code>one-hot&lt;/code> å‘é‡æ¥è¡¨ç¤ºç±»åˆ«ç‰¹å¾ã€‚&lt;/p>
&lt;h2 id="-å¤„ç†æ–‡æœ¬æ•°æ®çš„æµç¨‹">ðŸš€ å¤„ç†æ–‡æœ¬æ•°æ®çš„æµç¨‹&lt;/h2>
&lt;p>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†çš„åº”ç”¨ä¸­ï¼Œæ•°æ®å°±æ˜¯æ–‡æœ¬ &lt;code>document&lt;/code>ï¼Œæ–‡æœ¬å¯ä»¥åˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå•è¯è¡¨ç¤ºæˆæ•°å€¼å‘é‡ã€‚å…¶ä¸­æ¯ä¸ªå•è¯éƒ½æ˜¯ä¸€ä¸ªç±»åˆ«ï¼Œå¦‚æžœå­—å…¸é‡Œæœ‰ä¸€ä¸‡ä¸ªå•è¯ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€ä¸‡çš„ç±»åˆ«ï¼Œæ˜¾ç„¶å•è¯å°±æ˜¯ç±»åˆ«ç‰¹å¾ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¤„ç†ç±»åˆ«ç‰¹å¾çš„æ–¹æ³•ï¼ŒæŠŠå•è¯å˜æˆæ•°å€¼å‘é‡ã€‚&lt;/p>
&lt;p>æ–‡æœ¬å¤„ç†ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>ðŸ”” æŠŠæ–‡æœ¬åˆ†å‰²æˆå•è¯&lt;/li>
&lt;li>ðŸ”” è®¡ç®—æ¯ä¸ªå•è¯å‡ºçŽ°çš„æ¬¡æ•°&lt;/li>
&lt;li>ðŸ”” è¿›è¡Œ one-hot ç¼–ç &lt;/li>
&lt;/ul>
&lt;p>æ–‡æœ¬å¤„ç†çš„ç¬¬ä¸€æ­¥æ˜¯æŠŠæ–‡æœ¬åˆ†å‰²æˆå•è¯ã€‚ä¸€æ®µè¯ï¼Œä¸€ç¯‡æ–‡ç« æˆ–è€…ä¸€æœ¬ä¹¦å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥æŠŠæ–‡æœ¬åˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œè¿™ä¸ªæ­¥éª¤ç§°ä¸º &lt;code>Tokenization&lt;/code>ã€‚&lt;/p>
&lt;p>æ¯”å¦‚è¯´è¿™å¥è¯ &lt;code>... to be or not to be ...&lt;/code>ï¼Œ å¯ä»¥åˆ†å‰²æˆè¿™äº›å•è¯ &lt;code>[to, be, or, not, to, be]&lt;/code>ã€‚Tokenization å°±æ˜¯æŠŠæ–‡æœ¬å˜æˆå•è¯çš„åˆ—è¡¨ã€‚&lt;/p>
&lt;p>æ–‡æœ¬å¤„ç†çš„ç¬¬äºŒæ­¥æ˜¯è®¡ç®—è¯é¢‘ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå•è¯å‡ºçŽ°çš„æ¬¡æ•°ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ &lt;code>hash Map&lt;/code> æ¥è®¡ç®—ï¼Œè®¡ç®—å¼€å§‹ä¹‹å‰ï¼Œå“ˆå¸Œè¡¨æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬æ ¹æ®ä»¥ä¸‹æ–¹å¼æ›´æ–°å“ˆå¸Œè¡¨ï¼šå¦‚æžœå•è¯ &lt;code>w&lt;/code> ä¸åœ¨è¡¨é‡Œé¢ï¼Œè¯´æ˜Žåˆ°ç›®å‰ä¸ºæ­¢ï¼Œ&lt;code>w&lt;/code> è¿˜æ²¡æœ‰å‡ºçŽ°åœ¨æ–‡æœ¬é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠ &lt;code>w&lt;/code> åŠ å…¥å“ˆå¸Œè¡¨ï¼Œå¹¶è®©å®ƒçš„è¯é¢‘ç­‰äºŽ 1ï¼›å¦‚æžœ &lt;code>w&lt;/code> åœ¨å“ˆå¸Œè¡¨é‡Œé¢ï¼Œè¯´æ˜Ž &lt;code>w&lt;/code> ä¹‹å‰åœ¨æ–‡æœ¬é‡Œå‡ºçŽ°è¿‡ï¼Œåªéœ€è¦æŠŠ &lt;code>w&lt;/code> çš„è¯é¢‘åŠ  1 å³å¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/4.png"
loading="lazy"
alt="4"
>&lt;/p>
&lt;p>æŽ¥ä¸‹æ¥ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†æŒ¨ä¸ªå¤„ç†è¿™ä¸ªåˆ—è¡¨é‡Œçš„å•è¯ã€‚å½“å¤„ç†åˆ°å•è¯ &lt;code>to&lt;/code> çš„æ—¶å€™ï¼Œé¦–å…ˆæŸ¥ä¸€ä¸‹å“ˆå¸Œè¡¨ï¼Œå‘çŽ°å“ˆå¸Œè¡¨é‡Œé¢æœ‰ &lt;code>to&lt;/code>ï¼Œå®ƒçš„è¯é¢‘æ˜¯ 398ï¼Œè¯´æ˜Ž to åœ¨æ–‡ç« é‡Œå·²ç»å‡ºçŽ°è¿‡ 398 æ¬¡äº†ï¼ŒçŽ°åœ¨è¿™ä¸ªå•è¯åˆå‡ºçŽ°äº†ä¸€æ¬¡ï¼ŒäºŽæ˜¯æŠŠè¡¨é‡Œçš„è¯é¢‘åŠ  1ï¼Œå˜æˆäº† 399ï¼›å½“å¤„ç†åˆ°å•è¯ &lt;code>or&lt;/code>çš„æ—¶å€™ï¼Œåœ¨è¡¨é‡Œæ‰¾ä¸åˆ°ï¼Œè¿™è¯´æ˜Žæ–‡ç« é‡Œè¿˜æ²¡æœ‰å‡ºçŽ°è¿‡ &lt;code>or&lt;/code> è¿™ä¸ªå•è¯ï¼Œç¬¬ä¸€æ¬¡å‡ºçŽ°åœ¨æ–‡ç« é‡Œï¼ŒäºŽæ˜¯æˆ‘ä»¬æŠŠ &lt;code>or&lt;/code> æ’å…¥è¡¨é‡Œï¼Œå°†è¯é¢‘è®¾ç½®ä¸º 1ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/5.png"
loading="lazy"
alt="5"
>&lt;/p>
&lt;p>å®Œæˆç»Ÿè®¡è¯é¢‘ä¹‹åŽï¼Œéœ€è¦æŠŠå“ˆå¸Œè¡¨åšä¸€ä¸ªæŽ’åºï¼ŒæŒ‰ç…§è¯é¢‘é€’å‡çš„é¡ºåºè¿›è¡ŒæŽ’åˆ—ï¼Œè¡¨çš„æœ€å‰é¢æ˜¯è¯é¢‘æœ€é«˜çš„ï¼Œè¡¨æœ€åŽæ˜¯è¯é¢‘æœ€ä½Žçš„ã€‚ç„¶åŽå°±æŠŠè¯é¢‘æ¢æˆä¸‹æ ‡ &lt;code>index&lt;/code>ï¼Œä»Ž 1 å¼€å§‹æ•°è®¡æ•°ï¼Œè¯é¢‘æœ€é«˜çš„è¯çš„ &lt;code>index&lt;/code> æ˜¯ 1ã€‚è¿™ä¸ªä¾‹å­é‡Œï¼Œä¸€å…±æœ‰ 8 ä¸ªå•è¯ï¼Œæ¯ä¸ªè¯å¯¹åº”ä¸€ä¸ª [1, 8] ä¹‹é—´çš„æ­£æ•´æ•°ã€‚è¿™ä¸ªè¡¨ç§°ä¸ºå­—å…¸ ï¼Œå¯ä»¥æŠŠå•è¯æ˜ å°„ä¸ºä¸€ä¸ªæ•°å­—ã€‚&lt;/p>
&lt;p>å­—å…¸é‡Œå•è¯çš„ä¸ªæ•°ç§°ä¸ºè¯æ±‡é‡ &lt;code>vocabulary&lt;/code>ã€‚è¿™ä¾‹å­é‡Œè¯æ±‡é‡ç­‰äºŽ 8ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/6.png"
loading="lazy"
alt="6"
>&lt;/p>
&lt;p>è‹±è¯­é‡Œå¤§æ¦‚æœ‰ 1 ä¸‡ä¸ªå¸¸ç”¨è¯ï¼Œä½†æ˜¯ç»Ÿè®¡è¯é¢‘ä¹‹åŽï¼Œä½ ä¼šå‘çŽ°å­—å…¸ä¼šæœ‰å‡ åä¸‡ç”šè‡³ä¸Šç™¾ä¸‡ä¸ªå•è¯ã€‚ç»Ÿè®¡è¯é¢‘çš„ç›®çš„å°±æ˜¯ä¿ç•™å¸¸ç”¨è¯ï¼ŒåŽ»æŽ‰ä½Žé¢‘è¯ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¿ç•™è¯é¢‘æœ€é«˜çš„ 1 ä¸‡ä¸ªå•è¯ï¼Œåˆ æŽ‰å…¶ä½™å•è¯ã€‚&lt;/p>
&lt;p>&lt;strong>ä¸ºä»€ä¹ˆè¦åˆ æŽ‰ä½Žé¢‘è¯å‘¢ï¼Ÿ&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° ä½Žé¢‘è¯é€šå¸¸æ²¡æœ‰æ„ä¹‰&lt;/li>
&lt;/ul>
&lt;p>å¾ˆå¤šä½Žé¢‘è¯éƒ½æ˜¯åå­—å®žä½“ &lt;code>name entities&lt;/code>ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„åå­—å°±æ˜¯ä¸ªåå­—å®žä½“ï¼Œå‡å¦‚æˆ‘ä»¬çš„åå­—å‡ºçŽ°åœ¨ä¸€ä¸ªæ•°æ®é›†é‡Œé¢ï¼Œä»–çš„é¢‘çŽ‡è‚¯å®šä¼šå¾ˆä½Žï¼Œåœ¨å¤§å¤šæ•°çš„åº”ç”¨é‡Œåå­—å®žä½“æ²¡æœ‰æ„ä¹‰ã€‚&lt;/p>
&lt;p>ä½Žé¢‘è¯å¾ˆå¤šéƒ½æ˜¯æ‹¼å†™é”™è¯¯é€ æˆçš„ï¼Œå¦‚æžœæŠŠ prince çš„ c è¯¯å†™æˆ sï¼Œprinseï¼Œé‚£ä¹ˆå°±åˆ›é€ äº†ä¸€ä¸ªæ–°çš„å•è¯ï¼Œè¿™ç§è¯çš„é¢‘çŽ‡ä¹Ÿå¾ˆä½Žï¼Œåœ¨å¾ˆå¤šåº”ç”¨é‡Œï¼ŒåŽ»æŽ‰è¿™ç§è¯æ²¡æœ‰å±å®³ã€‚&lt;/p>
&lt;ul>
&lt;li>ðŸŒ° åŽ»æŽ‰ä½Žé¢‘è¯çš„å¦ä¸€ä¸ªåŽŸå› æ˜¯æˆ‘ä»¬ä¸å¸Œæœ› &lt;code>vocabulary&lt;/code> å¤ªå¤§ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸‹ä¸€ä¸ªæ­¥éª¤åš &lt;code>one-hot encoding&lt;/code> çš„æ—¶å€™ï¼Œå‘é‡çš„ç»´åº¦å°±æ˜¯å­—å…¸çš„å¤§å°ã€‚å­—å…¸è¶Šå¤§ï¼Œå‘é‡çš„ç»´åº¦å°±è¶Šé«˜ï¼Œè¿™ä¼šè®©è®¡ç®—å˜æ…¢ã€‚ä¸‹ä¸€èŠ‚è¯¦ç»†è¯´æ˜Žè¯åµŒå…¥ &lt;code>Word Embedding&lt;/code> çš„æ—¶å€™å°±ä¼šçœ‹åˆ°ï¼Œå­—å…¸è¶Šå¤§ï¼Œæ¨¡åž‹çš„å‚æ•°å°±è¶Šä¼šè¶Šå¤šï¼Œå°±ä¼šå®¹æ˜“é€ æˆè¿‡æ‹Ÿåˆ &lt;code>overfitting&lt;/code>ï¼Œåˆ æŽ‰ä½Žé¢‘è¯å°±ä¼šå¤§å¹…å‡å° &lt;code>vocabulary&lt;/code>ã€‚&lt;/p>
&lt;p>æ–‡æœ¬å¤„ç†çš„ç¬¬ä¸‰æ­¥å°±æ˜¯å¯¹å•è¯åš &lt;code>one-hot encoding&lt;/code>ï¼Œé€šè¿‡æŸ¥å­—å…¸ï¼ŒæŠŠå•è¯æ˜ å°„æˆä¸€ä¸ªæ­£æ•´æ•°ï¼Œä¸€ä¸ªå•è¯çš„åˆ—è¡¨å°±æ˜ å°„æˆäº†ä¸€ä¸ªæ­£æ•´æ•°çš„åˆ—è¡¨ï¼›å¦‚æžœæœ‰å¿…è¦å°±ç»§ç»­æŠŠè¿™äº›æ­£æ•´æ•°å˜æˆ &lt;code>one-hot&lt;/code> å‘é‡ã€‚è¿™äº› &lt;code>one-hot&lt;/code> å‘é‡çš„ç»´åº¦æ­£å¥½ç­‰äºŽ &lt;code>vocabulary&lt;/code>ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œå­—å…¸çš„é•¿åº¦æ˜¯ 8ï¼Œæ‰€ä»¥ &lt;code>one-hot&lt;/code> ç»´åº¦å°±ç­‰äºŽ 8ã€‚&lt;/p>
&lt;p>&lt;img src="https://nlp.letout.cn/img/nlp/01/7.png"
loading="lazy"
alt="7"
>&lt;/p>
&lt;p>ä¸Šé¢è¯´è¿‡ï¼Œå­—å…¸é‡Œçš„ä½Žé¢‘è¯å¯èƒ½ä¼šè¢«åˆ æŽ‰ï¼Œæ‰€ä»¥æœ‰äº›è¯åœ¨å­—å…¸é‡Œæ‰¾ä¸åˆ°ï¼Œä¾‹å¦‚æŠŠ be é”™è¯¯æ‹¼å†™æˆå•è¯ biï¼Œè¿™ä¸ªè¯åœ¨å­—å…¸é‡Œæ‰¾ä¸åˆ°ï¼Œ&lt;code>one-hot encoding&lt;/code> æ—¶ï¼Œå¯ä»¥å¿½ç•¥è¿™ä¸ªè¯ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒç¼–ç æˆå…¨ 0 å‘é‡ã€‚&lt;/p>
&lt;h2 id="-æ€»ç»“">ðŸŽ æ€»ç»“&lt;/h2>
&lt;p>æœ€åŽæ€»ç»“ä¸€ä¸‹è¿™ä¸€èŠ‚çš„å†…å®¹ã€‚&lt;/p>
&lt;p>éƒ¨åˆ†æœºå™¨å­¦ä¹ çš„æ•°æ®ä¼šå…·å¤‡ç±»åˆ«ç‰¹å¾ &lt;code>Categorical Features&lt;/code>ï¼Œæœºå™¨å­¦ä¹ æ¨¡åž‹æ— æ³•ç†è§£ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è½¬æ¢æˆæ•°å€¼ç‰¹å¾ã€‚ç±»åˆ«ç‰¹å¾çš„ç±»åˆ«ä¼šè¢«æ˜ å°„æˆä¸€ä¸ªä»Ž &lt;code>1&lt;/code> å¼€å§‹è®¡ç®—çš„æ•´æ•°ï¼Œ&lt;code>0&lt;/code> è¢«ç”¨æ¥è¡¨ç¤ºç¼ºå¤±æˆ–è€…æœªçŸ¥çš„ç±»åˆ«ï¼Œå¹¶ä¸”ä½¿ç”¨ &lt;code>one-hot&lt;/code> å‘é‡ï¼Œèƒ½å¾ˆå¥½çš„è¡¨ç¤ºç±»åˆ«ç‰¹å¾çš„æ„ä¹‰ã€‚&lt;/p>
&lt;p>æ–‡æœ¬å¤„ç†ä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€æ­¥ &lt;code>tokenization&lt;/code> æŠŠæ–‡æœ¬åˆ†å‰²æˆå•è¯çš„åˆ—è¡¨ï¼›ç¬¬äºŒæ­¥å»ºç«‹äº†ä¸€ä¸ªå­—å…¸&lt;code>vocabulary&lt;/code>ï¼ŒæŠŠå•è¯æ˜ å°„æˆä¸€ä¸ªæ­£æ•´æ•°ï¼›ç¬¬ä¸‰æ­¥è¿›è¡Œ &lt;code>one-hot encoding&lt;/code>ï¼Œå°†åˆ†å‰²åŽçš„å•è¯åˆ—è¡¨æ˜ å°„æˆæ­£æ•´æ•°çš„åˆ—è¡¨æˆ–å˜æˆ &lt;code>one-hot&lt;/code> å‘é‡ã€‚&lt;/p></description></item><item><title>Java Map æ“ä½œ</title><link>https://emerywan.github.io/blog/p/java-map-traversal/</link><pubDate>Thu, 28 Oct 2021 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/java-map-traversal/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/11.jpeg" alt="Featured image of post Java Map æ“ä½œ" />&lt;p>åšè‡ªç„¶è¯­è¨€å¤„ç†å†™äº†æŒºä¹…çš„ &lt;code>Python&lt;/code> ï¼Œç»å¸¸è¦å¤„ç†æ•°æ®ã€‚ç”¨ &lt;code>Python&lt;/code> ä¸­çš„å¤„ç†æ•°æ®çœŸçš„æŒºçˆ½çš„ ðŸ«£ï¼Œæˆ‘å¹³å¸¸éƒ½å–œæ¬¢æŠŠå„ç§æ•°æ®éƒ½å¾€ &lt;code>dict&lt;/code>ï¼ˆä¹Ÿå°±æ˜¯ &lt;code>Java&lt;/code> ä¸­çš„ &lt;code>map&lt;/code>ï¼‰ å’Œ &lt;code>json&lt;/code> ä¸Šè½¬ï¼Œç”¨ &lt;code>Python&lt;/code> å¤„ç†è¿™ä¸ªå„ç§æ–¹ä¾¿ã€‚ æœ€è¿‘å†å†™ &lt;code>Java&lt;/code> å°±ç»å¸¸â€œæ‰‹æ®‹â€ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹ &lt;code>Java&lt;/code> ä¸­å¤„ç† &lt;code>Map&lt;/code>ã€‚&lt;/p>
&lt;h2 id="-éåŽ†æ–¹å¼">â­ï¸ éåŽ†æ–¹å¼&lt;/h2>
&lt;p>Java éåŽ† Mapï¼Œè¦ä¹ˆå°±æ˜¯éåŽ†å®ƒçš„ &lt;code>Map.Entry&amp;lt;K,V&amp;gt; &amp;lt;- entrySet()&lt;/code>ï¼Œè¦ä¹ˆå°±æ˜¯éåŽ†å®ƒçš„ key &lt;code>KeySet &amp;lt;- keySet()&lt;/code>ã€‚ä¸»è¦å¯ä»¥ç”¨ä¸‹é¢å››ç§æ–¹å¼éåŽ†ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Iterator&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ForEach&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Lambda&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Stream&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>é™¤éžç‰¹æ®Šéœ€è¦ï¼Œå°½é‡ä½¿ç”¨åŽ 3 ç§éåŽ†æ–¹å¼ï¼Œä½¿ç”¨ &lt;code>Iterator&lt;/code> å¯èƒ½æ›´å®¹æ˜“é€ æˆä¸€äº›é”™è¯¯ï¼ˆEffective Java - 58ï¼š&lt;code>for-each&lt;/code> ä¼˜å…ˆäºŽ &lt;code>for&lt;/code> å¾ªçŽ¯ï¼‰ã€‚&lt;/p>
&lt;p>åœ¨ä¸€äº› &lt;code>for-each&lt;/code> ä¸èƒ½èƒœä»»çš„åœ°æ–¹ï¼Œå…¶å®žä¹Ÿæœ‰å¾ˆå¯¹å†…ç½®æ–¹æ³•èƒ½å¤Ÿå®Œæˆæ“ä½œï¼Œä¸ä»…æ›´åŠ ç›´è§‚ï¼Œè€Œä¸”éžå¸¸æ˜“ç”¨ã€‚æ¯”å¦‚åˆ é™¤æ“ä½œï¼š&lt;code>Collection#removeIf()&lt;/code> &lt;code>Java 1.8+&lt;/code>ã€‚&lt;/p>
&lt;h3 id="foreach">ForEach&lt;/h3>
&lt;h4 id="entryset">EntrySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="keyset">KeySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">keySet&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="lambda">Lambda&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// key
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// value
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">AbstractMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;,&lt;/span> &lt;span class="n">Cloneable&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Serializable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">forEach&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Biconsumer&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">action&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="stream">Stream&lt;/h3>
&lt;h4 id="steram">Steram&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">stream&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="parallelstream">parallelStream&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">parallelStream&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="interator">Interator&lt;/h3>
&lt;h4 id="entryset-1">EntrySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">iterator&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ ¹æ® Effective Java - 57ï¼Œæ›´æŽ¨èä»¥ä¸‹è¿™ç§å†™æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">iterator&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="keyset-1">KeySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Iteator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">iterator&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">keySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-ä¸€äº›æ“ä½œ">ðŸŒŸ ä¸€äº›æ“ä½œ&lt;/h2>
&lt;h3 id="åˆ¤ç©º">åˆ¤ç©º&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™‹&lt;/span>&lt;span class="n">â€&lt;/span>&lt;span class="err">â™‚&lt;/span>&lt;span class="n">ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">ðŸ™…&lt;/span>&lt;span class="n">â€&lt;/span>&lt;span class="err">â™‚&lt;/span>&lt;span class="n">ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">boolean&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è®¡æ•°--merge">è®¡æ•° / merge()&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">merge&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BiFunction&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">remappingFunction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">merge&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Integer&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="removeif">removeIf()&lt;/h3>
&lt;blockquote>
&lt;p>ðŸš§ æ³¨æ„ï¼š&lt;/p>
&lt;p>&lt;code>Map&lt;/code> æœ¬èº«æ˜¯æ²¡æœ‰ &lt;code>removeIf()&lt;/code>ã€‚&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">entry&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">keySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">values&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="absent">absent&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">putIfAbsent&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä¸å­˜åœ¨ key æ—¶ï¼ŒæŒ‰ mappingFunction æ·»åŠ  value
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å­˜åœ¨ key ä¸æ”¹å˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">computeIfAbsent&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Function&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">mappingFunction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">computeIfPresent&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BiFunction&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">remappingFunction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="default">default&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getOrDefault&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-å‚è€ƒ">ðŸ”— å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s/zQBN3UvJDhRTKP6SzcZFKw" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s/zQBN3UvJDhRTKP6SzcZFKw&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Modularized Interaction Network for Named Entity Recognition</title><link>https://emerywan.github.io/blog/p/modularizedinteractionnetworkfornamed-entityrecognition/</link><pubDate>Wed, 01 Sep 2021 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/modularizedinteractionnetworkfornamed-entityrecognition/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/9.jpeg" alt="Featured image of post Modularized Interaction Network for Named Entity Recognition" />&lt;p>çŽ°æœ‰NERæ¨¡åž‹ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŸºäºŽåºåˆ—æ ‡æ³¨çš„NERæ¨¡åž‹ï¼ˆThe sequence labeling-based NERmodelsï¼‰&lt;/p>
&lt;ul>
&lt;li>é•¿å®žä½“è¯†åˆ«ä¸ä½³ï¼Œåªå…³æ³¨è¯çº§ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>åŸºäºŽåˆ†æ®µçš„NERæ¨¡åž‹ï¼ˆThe segment-based NERmodelsï¼‰&lt;/p>
&lt;ul>
&lt;li>å¤„ç†åˆ†æ®µï¼Œè€Œéžå•ä¸ªè¯ï¼Œä¸èƒ½æ•èŽ·åˆ†æ®µä¸­çš„è¯çº§ä¾èµ–å…³ç³»&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>è¾¹ç•Œæ£€æµ‹ï¼ˆboundary detectionï¼‰å’Œç±»åž‹é¢„æµ‹ï¼ˆtype pre-dictionï¼‰å¯ä»¥ç›¸äº’é…åˆï¼Œä¸¤ä¸ªå­ä»»åŠ¡å¯å…±äº«ä¿¡æ¯ï¼Œç›¸äº’åŠ å¼ºã€‚&lt;/p>
&lt;p>æå‡ºæ¨¡å—åŒ–äº¤äº’ç½‘ç»œæ¨¡åž‹MINï¼ˆModularized Interaction Networkï¼‰&lt;/p>
&lt;p>åˆ©ç”¨æ®µçº§ä¿¡æ¯å’Œè¯çº§ä¾èµ–å…³ç³»ï¼Œç»“åˆä¸€ç§äº¤äº’æœºåˆ¶ï¼Œæ”¯æŒè¾¹ç•Œæ£€æµ‹å’Œç±»åž‹é¢„æµ‹ä¹‹é—´çš„ä¿¡æ¯å…±äº«ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/modularizedinteractionnetworkfornamed-entityrecognition/1.png"
width="493"
height="408"
srcset="https://emerywan.github.io/blog/blog/p/modularizedinteractionnetworkfornamed-entityrecognition/1_huf69a1b5e1975a497801b13aa3110264f_41598_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/modularizedinteractionnetworkfornamed-entityrecognition/1_huf69a1b5e1975a497801b13aa3110264f_41598_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="120"
data-flex-basis="290px"
>&lt;/p>
&lt;p>a recurrentneural network encoder-decoder framework with apointer network is used to detect entity segmentsfor segment information.&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/modularizedinteractionnetworkfornamed-entityrecognition/2.png"
width="790"
height="399"
srcset="https://emerywan.github.io/blog/blog/p/modularizedinteractionnetworkfornamed-entityrecognition/2_hu67c580ff6778a63552a8e24eeebbd582_54929_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/modularizedinteractionnetworkfornamed-entityrecognition/2_hu67c580ff6778a63552a8e24eeebbd582_54929_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="197"
data-flex-basis="475px"
>&lt;/p></description></item><item><title>A Sequence-to-Set Network for Nested Named Entity Recognition</title><link>https://emerywan.github.io/blog/p/sequence-to-set/</link><pubDate>Mon, 07 Jun 2021 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/sequence-to-set/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/14.jpeg" alt="Featured image of post A Sequence-to-Set Network for Nested Named Entity Recognition" />&lt;p>å€Ÿé‰´å›¾åƒé¢†åŸŸçš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡ï¼Œå°†åµŒå¥—ä»»åŠ¡è½¬åŒ–æˆspançš„é¢„æµ‹ï¼Œè§£å†³åµŒå¥—å‘½åå®žä½“è¯†åˆ«ä»»åŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/sequence-to-set/model.png"
width="693"
height="366"
srcset="https://emerywan.github.io/blog/blog/p/sequence-to-set/model_hu04a3cb5aafa3b0d4955b742068e6104d_64624_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/sequence-to-set/model_hu04a3cb5aafa3b0d4955b742068e6104d_64624_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="model"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="454px"
>&lt;/p>
&lt;p>å…·ä½“æ˜¯é‡‡ç”¨ä¸¤é˜¶æ®µï¼š&lt;/p>
&lt;ul>
&lt;li>ç¬¬ä¸€æ­¥ Locateï¼Œå³å®šä½å®žä½“çš„è¾¹ç•Œ&lt;/li>
&lt;li>ç¬¬äºŒæ­¥ Labelï¼Œå³å¯¹è¯†åˆ«spanè¿›è¡Œå®žä½“ç±»åž‹åˆ¤æ–­ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/sequence-to-set/1.png"
width="357"
height="52"
srcset="https://emerywan.github.io/blog/blog/p/sequence-to-set/1_huec6c826749de8343d0aee5d973132caa_9180_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/sequence-to-set/1_huec6c826749de8343d0aee5d973132caa_9180_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="686"
data-flex-basis="1647px"
>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/sequence-to-set/2.png"
width="347"
height="320"
srcset="https://emerywan.github.io/blog/blog/p/sequence-to-set/2_hu4391112aaed5160844ed6f4005b28fce_42441_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/sequence-to-set/2_hu4391112aaed5160844ed6f4005b28fce_42441_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="108"
data-flex-basis="260px"
>&lt;/p></description></item><item><title>Named Entity Recognition As Dependency Parsing</title><link>https://emerywan.github.io/blog/p/namedentityrecognitionasdependencyparsing/</link><pubDate>Tue, 01 Jun 2021 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/namedentityrecognitionasdependencyparsing/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/7.jpeg" alt="Featured image of post Named Entity Recognition As Dependency Parsing" />&lt;p>æ–‡ä¸­å°†æ¯ä¸ª token ç”¨ BERT å’Œ fastText è¿›è¡Œ embeddingï¼Œæ‹¼æŽ¥ä¸Šç”¨ CNN ç¼–ç çš„å­—ç¬¦çº§åˆ«å‘é‡ï¼Œé€å…¥ä¸€ä¸ªåŒå‘ LSTM ç¼–ç ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒèŽ·å¾—æ¯ä¸ªè¯çš„è¡¨è¾¾ã€‚ä¹‹åŽé‡‡ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„ FFNN æ¥å¾—åˆ°ä½œä¸ºå®žä½“å¼€å§‹å’Œç»“æŸçš„ä½ç½®çš„è¡¨è¾¾ã€‚&lt;/p>
&lt;p>æœ€åŽç”¨ä¸€ä¸ªä»¿å°„æ¨¡åž‹å¾—åˆ°ä¸€ä¸ª $lÃ—lÃ—c$ çš„ tensorï¼Œå…¶ä¸­ l æ˜¯å¥å­é•¿åº¦ï¼Œc æ˜¯å®žä½“ç±»åˆ«æ•°é‡åŠ ä¸€ï¼ˆè¡¨ç¤ºæ— å®žä½“ï¼‰ã€‚è¿ç”¨è¯¥çŸ©é˜µï¼Œæ–‡ä¸­å¯¹äºŽåµŒå¥—å’ŒéžåµŒå¥—é‡‡ç”¨äº†ä¸¤ç§ä¸åŒçš„ç­–ç•¥ï¼Œä»Žè€Œå¾—åˆ°äº†å®žä½“çš„èµ·æ­¢ä½ç½®ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/namedentityrecognitionasdependencyparsing/model.png"
width="500"
height="501"
srcset="https://emerywan.github.io/blog/blog/p/namedentityrecognitionasdependencyparsing/model_hue39a704d975d112c4ae2b387bb0aa5be_45180_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/namedentityrecognitionasdependencyparsing/model_hue39a704d975d112c4ae2b387bb0aa5be_45180_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="model"
class="gallery-image"
data-flex-grow="99"
data-flex-basis="239px"
>&lt;/p>
&lt;p>code: &lt;a class="link" href="https://github.com/juntaoy/biaffine-ner" target="_blank" rel="noopener"
>https://github.com/juntaoy/biaffine-ner&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/namedentityrecognitionasdependencyparsing/ner.png"
width="325"
height="669"
srcset="https://emerywan.github.io/blog/blog/p/namedentityrecognitionasdependencyparsing/ner_huff0969dccbb13cbf7d246862faeafc4d_75035_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/namedentityrecognitionasdependencyparsing/ner_huff0969dccbb13cbf7d246862faeafc4d_75035_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="ner"
class="gallery-image"
data-flex-grow="48"
data-flex-basis="116px"
>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/namedentityrecognitionasdependencyparsing/nested.png"
width="323"
height="618"
srcset="https://emerywan.github.io/blog/blog/p/namedentityrecognitionasdependencyparsing/nested_hu30723d7bae4f05520cc9500a93ac4824_73991_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/namedentityrecognitionasdependencyparsing/nested_hu30723d7bae4f05520cc9500a93ac4824_73991_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="nested"
class="gallery-image"
data-flex-grow="52"
data-flex-basis="125px"
>&lt;/p></description></item><item><title>PyTorch ç«é€Ÿä¸Šæ‰‹</title><link>https://emerywan.github.io/blog/p/pytorch-handbook/</link><pubDate>Thu, 01 Apr 2021 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/pytorch-handbook/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/10.jpeg" alt="Featured image of post PyTorch ç«é€Ÿä¸Šæ‰‹" />&lt;h2 id="pytorch-æ˜¯ä»€ä¹ˆ">PyTorch æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2>
&lt;p>åŸºäºŽ Python çš„ç§‘å­¦è®¡ç®—åŒ…ï¼ŒæœåŠ¡äºŽä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼š&lt;/p>
&lt;ul>
&lt;li>Numpy çš„æ›¿ä»£å“ï¼Œå¯ä»¥ä½¿ç”¨ GPU çš„å¼ºå¤§è®¡ç®—åŠ›&lt;/li>
&lt;li>æä¾›æœ€å¤§çš„çµæ´»æ€§å’Œé«˜é€Ÿçš„æ·±åº¦å­¦ä¹ ç ”ç©¶å¹³å°&lt;/li>
&lt;/ul>
&lt;h2 id="tensors">Tensors&lt;/h2>
&lt;p>Tensors ä¸Ž Numpy ä¸­çš„ ndarrays ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ PyTorch ä¸­ Tensors å¯ä»¥ä½¿ç”¨ GPU è¿›è¡Œè®¡ç®—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">__future__&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">print_function&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 1 ] åˆ›å»ºä¸€ä¸ª 5x3 çš„çŸ©é˜µï¼Œä½†ä¸åˆå§‹åŒ–ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">empty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 2 ] åˆ›å»ºä¸€ä¸ªéšæœºåˆå§‹åŒ–çš„çŸ©ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[0.6972, 0.0231, 0.3087],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.2083, 0.6141, 0.6896],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.7228, 0.9715, 0.5304],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.7727, 0.1621, 0.9777],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.6526, 0.6170, 0.2605]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 3 ] åˆ›å»ºä¸€ä¸ª 0 å¡«å……çš„çŸ©é˜µï¼Œæ•°æ®ç±»åž‹ä¸º longï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">long&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 4 ] åˆ›å»ºä¸€ä¸ª tensor ä½¿ç”¨çŽ°æœ‰æ•°æ®åˆå§‹åŒ–ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="mf">5.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([5.5000, 3.0000])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 5 ] æ ¹æ®çŽ°æœ‰çš„ tensor åˆ›å»º tensorã€‚è¿™äº›æ–¹æ³•å°†é‡ç”¨è¾“å…¥ tensor çš„å±žæ€§ï¼ˆå¦‚ï¼šdtypeï¼Œé™¤éžè®¾ç½®æ–°çš„å€¼è¿›è¡Œè¦†ç›–ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ©ç”¨ new_* æ–¹æ³•åˆ›å»ºå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">new_ones&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">double&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.]], dtype=torch.float64)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¦†ç›– dtype&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯¹è±¡ size ç›¸åŒï¼Œåªæ˜¯ å€¼å’Œç±»åž‹ å‘ç”Ÿå˜åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.5691, -2.0126, -0.4064],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0863, 0.4692, -1.1209],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-1.1177, -0.5764, -0.5363],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.4390, 0.6688, 0.0889],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.3334, -1.1600, 1.8457]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 6 ] èŽ·å– sizeï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># torch.Size([5, 3])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>&lt;code>torch.Size&lt;/code> è¿”å›ž &lt;code>tuple&lt;/code> ç±»åž‹ï¼Œæ”¯æŒ &lt;code>tuple&lt;/code> ç±»åž‹æ‰€æœ‰çš„æ“ä½œã€‚&lt;/p>
&lt;/blockquote>
&lt;p>[ 7 ] æ“ä½œ&lt;/p>
&lt;p>[ 7.1 ] åŠ æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æä¾›è¾“å‡º tensor ä½œä¸ºå‚æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">empty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">out&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 7.2 ] æ›¿æ¢ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># add x to y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>{% note info %}
&lt;code>_&lt;/code> ç»“å°¾çš„æ“ä½œä¼šæ›¿æ¢åŽŸå˜é‡ã€‚
å¦‚ï¼š&lt;code>x_copy_(y)&lt;/code>ï¼Œ&lt;code>x.t_()&lt;/code> ä¼šæ”¹å˜ &lt;code>x&lt;/code>
{% endnote %}&lt;/p>
&lt;p>[ 7.3 ] ä½¿ç”¨ Numpy ä¸­ç´¢å¼•æ–¹å¼ï¼Œå¯¹ tensor è¿›è¡Œæ“ä½œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">[:,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([-2.0126, 0.4692, -0.5764, 0.6688, -1.1600])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 8 ] &lt;code>torch.view&lt;/code> æ”¹å˜ tensor çš„ç»´åº¦å’Œå¤§å° ï¼ˆä¸Ž Numpy ä¸­ reshape ç±»ä¼¼ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">z&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># -1 ä»Žå…¶ä»–ç»´åº¦æŽ¨æ–­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">z&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># torch.Size([4, 4]) torch.Size([16]) torch.Size([2, 8])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 9 ] å¦‚æžœåªæœ‰ä¸€ä¸ªå…ƒç´ çš„ tensorï¼Œä½¿ç”¨ &lt;code>item()&lt;/code> èŽ·å– Python æ•°æ®ç±»åž‹çš„æ•°å€¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([-0.2368])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -0.23680149018764496&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="numpy-è½¬æ¢">Numpy è½¬æ¢&lt;/h3>
&lt;p>Torch Tensor ä¸Ž Numpy æ•°ç»„ä¹‹é—´è¿›è¡Œè½¬æ¢éžå¸¸è½»æ¾ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ones&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">numpy&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([1., 1., 1., 1., 1.])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># [1. 1. 1. 1. 1.]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Torch Tensor ä¸Ž Numpy æ•°ç»„å…±äº«åº•å±‚å†…å­˜åœ°å€ï¼Œä¿®æ”¹ä¸€ä¸ªä¼šå¯¼è‡´å¦ä¸€ä¸ªçš„å˜åŒ–ã€‚&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([2., 2., 2., 2., 2.])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># [2. 2. 2. 2. 2.]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">numpy&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">np&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ones&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_numpy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">out&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># [2. 2. 2. 2. 2.]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([2., 2., 2., 2., 2.], dtype=torch.float64)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>æ‰€æœ‰çš„ Tensor ç±»åž‹é»˜è®¤éƒ½æ˜¯åŸºäºŽ CPUï¼Œ CharTensor ç±»åž‹ä¸æ”¯æŒåˆ° Numpy çš„è£…æ¢ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="cuda-å¼ é‡">CUDA å¼ é‡&lt;/h3>
&lt;p>ä½¿ç”¨ &lt;code>.to()&lt;/code> å¯ä»¥å°† Tensor ç§»åŠ¨åˆ°ä»»ä½•è®¾å¤‡ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cuda&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">is_available&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">device&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cuda&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># CUDA è®¾å¤‡å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ones_like&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># ç›´æŽ¥ä»Ž GPU åˆ›å»ºå¼ é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">z&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([0.7632], device=&amp;#39;cuda:0&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cpu&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">double&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># tensor([0.7632], dtype=torch.float64)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="autograd-è‡ªåŠ¨æ±‚å¯¼">Autograd è‡ªåŠ¨æ±‚å¯¼&lt;/h2>
&lt;p>autograd åŒ…ä¸º Tensor ä¸Šæ‰€æœ‰çš„æ“ä½œæä¾›äº†è‡ªåŠ¨æ±‚å¯¼ã€‚å®ƒæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å®šä¹‰çš„æ¡†æž¶ï¼Œè¿™æ„å‘³ç€åå‘ä¼ æ’­æ˜¯æ ¹æ®ä½ çš„ä»£ç æ¥ç¡®å®šå¦‚ä½•è¿è¡Œï¼Œå¹¶ä¸”æ¯æ¬¡è¿­ä»£å¯ä»¥æ˜¯ä¸åŒçš„ã€‚&lt;/p>
&lt;h3 id="æ­£å‘ä¼ æ’­-åå‘ä¼ æ’­">æ­£å‘ä¼ æ’­ åå‘ä¼ æ’­&lt;/h3>
&lt;p>ç¥žç»ç½‘ç»œï¼ˆNNï¼‰æ˜¯åœ¨æŸäº›è¾“å…¥æ•°æ®ä¸Šæ‰§è¡ŒåµŒå¥—å‡½æ•°çš„é›†åˆã€‚
è¿™äº›å‡½æ•°ç”±å‚æ•°ï¼ˆæƒé‡å’Œåå·®ç»„æˆï¼‰å®šä¹‰ï¼Œå‚æ•°åœ¨ PyTorch ä¸­å­˜å‚¨åœ¨å¼ é‡ä¸­ã€‚&lt;/p>
&lt;p>è®­ç»ƒ NN åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>æ­£å‘ä¼ æ’­ï¼šåœ¨æ­£å‘ä¼ æ’­ä¸­ï¼ŒNN å¯¹æ­£ç¡®çš„è¾“å‡ºè¿›è¡Œæœ€ä½³çŒœæµ‹ã€‚å®ƒé€šè¿‡æ¯ä¸ªå‡½æ•°è¿è¡Œè¾“å…¥æ•°æ®ä»¥è¿›è¡ŒçŒœæµ‹ã€‚&lt;/li>
&lt;li>åå‘ä¼ æ’­ï¼šåœ¨åå‘ä¼ æ’­ä¸­ï¼ŒNN æ ¹æ®å…¶çŒœæµ‹ä¸­çš„è¯¯å·®è°ƒæ•´å…¶å‚æ•°ã€‚å®ƒé€šè¿‡ä»Žè¾“å‡ºå‘åŽéåŽ†ï¼Œæ”¶é›†æœ‰å…³å‚æ•°ï¼ˆæ¢¯åº¦ï¼‰çš„è¯¯å·®å¯¼æ•°å¹¶ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ¥ä¼˜åŒ–å‚æ•°æ¥å®žçŽ°ã€‚&lt;/li>
&lt;/ul>
&lt;p>[ 1 ] æˆ‘ä»¬ä»Ž torchvision åŠ è½½äº†ç»è¿‡é¢„è®­ç»ƒçš„ resnet18 æ¨¡åž‹ã€‚åˆ›å»ºä¸€ä¸ªéšæœºæ•°æ®å¼ é‡æ¥è¡¨ç¤ºå…·æœ‰ 3 ä¸ªé€šé“çš„å•ä¸ªå›¾åƒï¼Œé«˜åº¦å’Œå®½åº¦ä¸º 64ï¼Œå…¶å¯¹åº”çš„labelåˆå§‹åŒ–ä¸ºä¸€äº›éšæœºå€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="nn">torchvision&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torchvision&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">resnet18&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pretrained&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 2 ] æŽ¥ä¸‹æ¥ï¼Œé€šè¿‡æ¨¡åž‹çš„æ¯ä¸€å±‚è¿è¡Œè¾“å…¥æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚&lt;strong>æ­£å‘ä¼ æ’­&lt;/strong>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">prediction&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 3 ] ä½¿ç”¨æ¨¡åž‹çš„é¢„æµ‹ï¼ˆpredicationï¼‰å’Œç›¸åº”çš„æ ‡ç­¾ï¼ˆlabelsï¼‰æ¥è®¡ç®—è¯¯å·®ï¼ˆlossï¼‰ã€‚
ä¸‹ä¸€æ­¥é€šè¿‡åå‘ä¼ æ’­æ­¤è¯¯å·®ã€‚æˆ‘ä»¬åœ¨ loss tensor ä¸Šè°ƒç”¨ &lt;code>.backward()&lt;/code> æ—¶ï¼Œå¼€å§‹åå‘ä¼ æ’­ã€‚Autograd ä¼šä¸ºæ¯ä¸ªæ¨¡åž‹å‚æ•°è®¡ç®—æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å‚æ•° &lt;code>.grad&lt;/code> å±žæ€§ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">prediction&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backword&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># backword pass&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 4 ] æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ è½½ä¸€ä¸ªä¼˜åŒ–å™¨ï¼ˆSDGï¼‰ï¼Œå­¦ä¹ çŽ‡ä¸º 0.01ï¼ŒåŠ¨é‡ä¸º 0.9ã€‚åœ¨ optim ä¸­æ³¨å†Œæ¨¡åž‹çš„æ‰€æœ‰å‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">optim&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SDG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">1e-2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">momentum&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 5 ] æœ€åŽï¼Œè°ƒç”¨ &lt;code>.step()&lt;/code> å¯åŠ¨æ¢¯åº¦ä¸‹é™ã€‚ä¼˜åŒ–å™¨é€šè¿‡ &lt;code>.grad&lt;/code> ä¸­å­˜å‚¨çš„æ¢¯åº¦æ¥è°ƒæ•´æ¯ä¸ªå‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># gradient descent&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç¥žç»ç½‘ç»œçš„å¾®åˆ†">ç¥žç»ç½‘ç»œçš„å¾®åˆ†&lt;/h3>
&lt;p>è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ autograd å¦‚ä½•æ”¶é›†æ¢¯åº¦ã€‚
æˆ‘ä»¬åœ¨åˆ›å»º Tensor æ—¶ï¼Œä½¿ç”¨ &lt;code>requires_grad=True&lt;/code> å‚æ•°ï¼Œè¡¨ç¤ºå°†è·Ÿè¸ª Tensor çš„æ‰€æœ‰æ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="mf">2.&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">3.&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">require_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="mf">6.&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">4.&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">require_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»Ž tensor a, b åˆ›å»ºå¦ä¸€ä¸ª tensor Q&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Q&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">3&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å‡è®¾ tensor aï¼Œb æ˜¯ç¥žç»ç½‘ç»œçš„å‚æ•°ï¼Œtensor Q æ˜¯è¯¯å·®ã€‚åœ¨ NN è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬æƒ³è¦èŽ·å¾—ç›¸å¯¹äºŽå‚æ•°çš„è¯¯å·®ï¼Œå³å„è‡ªå¯¹åº”çš„åå¯¼ï¼š&lt;/p>
&lt;p>$$\frac{\partial Q}{\partial a}=9a^2$$&lt;/p>
&lt;p>å½“æˆ‘ä»¬åœ¨ tensor Q ä¸Šè°ƒç”¨ &lt;code>.backward()&lt;/code> æ—¶ï¼ŒAutograd å°†è®¡ç®—è¿™äº›æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å„ä¸ªå¼ é‡çš„ &lt;code>.grad&lt;/code> å±žæ€§ä¸­ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬éœ€è¦åœ¨ &lt;code>Q.backword()&lt;/code> ä¸­æ˜¾å¼ä¼ é€’ &lt;code>gradient&lt;/code> å‚æ•°ï¼ˆä¸Ž Q å½¢çŠ¶ç›¸åŒçš„å¼ é‡ï¼Œè¡¨ç¤º Q ç›¸å¯¹æœ¬èº«çš„æ¢¯åº¦ï¼‰ã€‚&lt;/p>
&lt;p>$$\frac{\partial Q}{\partial b}=-2b$$&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">external_grad&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="mf">1.&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">1.&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Q&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gradient&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">external_grad&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æœ€åŽï¼Œæ¢¯åº¦è®°å½•åœ¨ a.grad b.grad ä¸­ï¼ŒæŸ¥çœ‹æ”¶é›†çš„æ¢¯åº¦æ˜¯å¦æ­£ç¡®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([True, True])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">b&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([True, True])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°† Q èšåˆä¸ºä¸€ä¸ªæ ‡é‡ï¼Œç„¶åŽéšå¼åœ°å‘åŽè°ƒç”¨ï¼Œå¦‚ï¼š&lt;code>Q.sum().backward()&lt;/code>ã€‚&lt;/p>
&lt;h2 id="ç¥žç»ç½‘ç»œ">ç¥žç»ç½‘ç»œ&lt;/h2>
&lt;p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬äº†è§£åˆ° nn åŒ…ä¾èµ– autograd åŒ…æ¥å®šä¹‰æ¨¡åž‹å¹¶æ±‚å¯¼ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•å®šä¹‰ä¸€ä¸ªç½‘ç»œã€‚ä¸€ä¸ª nn.Module åŒ…å«ä¸ª layer å’Œä¸€ä¸ª forward(input) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ž outputã€‚&lt;/p>
&lt;p>å¦‚ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹æ‰‹å†™æ•°å­—å›¾åƒè¿›è¡Œåˆ†ç±»çš„å·ç§¯ç¥žç»ç½‘ç»œï¼š&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/pytorch-handbook/CNN.png"
width="759"
height="209"
srcset="https://emerywan.github.io/blog/blog/p/pytorch-handbook/CNN_hufa4266fb90da2cc9816f33e05e560204_9416_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/pytorch-handbook/CNN_hufa4266fb90da2cc9816f33e05e560204_9416_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="CNN"
class="gallery-image"
data-flex-grow="363"
data-flex-basis="871px"
>&lt;/p>
&lt;p>ç¥žç»ç½‘ç»œçš„å…¸åž‹è®­ç»ƒè¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>å®šä¹‰åŒ…å«ä¸€äº›å¯å­¦ä¹ çš„å‚æ•°ï¼ˆæƒé‡ï¼‰ç¥žç»ç½‘ç»œæ¨¡åž‹&lt;/li>
&lt;li>åœ¨æ•°æ®é›†ä¸Šè¿­ä»£&lt;/li>
&lt;li>é€šè¿‡ç¥žç»ç½‘ç»œå¤„ç†è¾“å…¥&lt;/li>
&lt;li>è®¡ç®—æŸå¤±ï¼ˆè¾“å‡ºç»“æžœå’Œæ­£ç¡®å€¼çš„å·®å€¼å¤§å°ï¼‰&lt;/li>
&lt;li>å°†æ¢¯åº¦åå‘ä¼ æ’­å›žç½‘ç»œçš„å‚æ•°&lt;/li>
&lt;li>æ›´æ–°ç½‘ç»œçš„å‚æ•°ï¼ˆæ¢¯åº¦ä¸‹é™ï¼‰ï¼šweight = weight - learning_rate * gradient&lt;/li>
&lt;/ul>
&lt;h3 id="å®šä¹‰ç½‘ç»œ">å®šä¹‰ç½‘ç»œ&lt;/h3>
&lt;p>åœ¨æ¨¡åž‹ä¸­å¿…é¡»å®šä¹‰ &lt;code>forward()&lt;/code>ï¼Œ &lt;code>backword&lt;/code>ï¼ˆç”¨æ¥è®¡ç®—æ¢¯åº¦ï¼‰ä¼šè¢« autograd è‡ªåŠ¨åˆ›å»ºã€‚å¯åœ¨ &lt;code>forward()&lt;/code> ä¸­ä½¿ç”¨ä»»ä½•é’ˆå¯¹ Tensor çš„æ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">nn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn.functional&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">F&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Model&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 1 input image channel, 6 output channels, 3x3 square convolution&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># kernel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv_1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv_2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># an affine operation: y = Wx + b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">16&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">6&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">120&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">120&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">84&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">84&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Max Pooling over a (2, 2) window&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max_pool2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># If the size is a square you can only specify a single number&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max_pool2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">num_flat_features&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">x&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">num_flat_features&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sefl&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">]&lt;/span> &lt;span class="c1"># all dimensions except the batch dimension&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num_features&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num_features&lt;/span> &lt;span class="o">*=&lt;/span> &lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">num_features&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Net&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Net(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (conv1): Conv2d(1, 6, kernel_size=(3, 3), stride=(1, 1))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (conv2): Conv2d(6, 16, kernel_size=(3, 3), stride=(1, 1))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (fc1): Linear(in_features=576, out_features=120, bias=True)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (fc2): Linear(in_features=120, out_features=84, bias=True)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (fc3): Linear(in_features=84, out_features=10, bias=True)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># )&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>parameters()&lt;/code> è¿”å›žå¯è¢«å­¦ä¹ çš„å‚æ•°ï¼ˆæƒé‡ï¼‰åˆ—è¡¨å’Œå€¼&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">params&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1"># conv1 çš„ weight torch.Size([6, 1, 3, 3])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æµ‹è¯•éšæœºè¾“å…¥ 32x32ã€‚æ³¨ï¼šè¿™ä¸ªç½‘ç»œï¼ˆLeNetï¼‰çš„æœŸæœ›çš„è¾“å…¥å¤§å°æ˜¯ 32x32ï¼Œå¦‚æžœä½¿ç”¨ MINIST æ•°æ®é›†æ¥è®­ç»ƒè¿™ä¸ªç½‘ç»œï¼Œè¯·æŠŠå›¾ç‰‡å¤§å°é‡æ–°è°ƒæ•´åˆ° 32x32ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">input&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">32&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">out&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.1120, 0.0713, 0.1014, -0.0696, -0.1210, 0.0084, -0.0206, 0.1366,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -0.0455, -0.0036]], grad_fn=&amp;lt;AddmmBackward&amp;gt;)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å°†æ‰€æœ‰çš„å‚æ•°çš„æ¢¯åº¦ç¼“å­˜æ¸…é›¶ï¼Œè¿›è¡Œéšæœºæ¢¯åº¦çš„åå‘ä¼ æ’­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>&lt;code>torch.nn&lt;/code> ä»…æ”¯æŒå°æ‰¹é‡è¾“å…¥ã€‚æ•´ä¸ª &lt;code>torch.nn&lt;/code> åŒ…éƒ½åªæ”¯æŒå°æ‰¹é‡æ ·æœ¬ï¼Œè€Œä¸æ”¯æŒå•ä¸ªæ ·æœ¬ã€‚
å¦‚ï¼š&lt;code>nn.Conv2d&lt;/code>æŽ¥å—ä¸€ä¸ª4ç»´ Tensorï¼Œåˆ†åˆ«ç»´ sSamples * nChannels * Height * Width ï¼ˆæ ·æœ¬æ•°* é€šé“æ•° * é«˜ * å®½ï¼‰ã€‚å¦‚æžœä½ æœ‰å•ä¸ªæ ·æœ¬ï¼Œåªéœ€è¦ä½¿ç”¨ &lt;code>input.unsqueeze(0)&lt;/code> æ¥æ·»åŠ å…¶ä»–çš„ç»´æ•°ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº†å¦‚ä½•æž„å»ºä¸€ä¸ªç½‘ç»œï¼Œå›žé¡¾ä¸€ä¸‹åˆ°ç›®å‰ä¸ºæ­¢ä½¿ç”¨åˆ°çš„ç±»ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>torch.Tensor&lt;/code>ï¼š ä¸€ä¸ªå¤šç»´æ•°ç»„ã€‚ æ”¯æŒä½¿ç”¨ backward() è¿›è¡Œè‡ªåŠ¨æ¢¯åº¦è®¡ç®—ï¼Œå¹¶ä¿å­˜å…³äºŽè¿™ä¸ªå‘é‡çš„æ¢¯åº¦ w.r.t.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>nn.Model&lt;/code>ï¼š ç¥žç»ç½‘ç»œæ¨¡å—ã€‚å®žçŽ°å°è£…å‚æ•°ã€ç§»åŠ¨åˆ° GPU ä¸Šè¿è¡Œã€å¯¼å‡ºã€åŠ è½½ç­‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>nn.Parameter&lt;/code>ï¼š ä¸€ç§å¼ é‡ã€‚å°†å…¶åˆ†é…ä¸º Model çš„å±žæ€§æ—¶ï¼Œè‡ªåŠ¨æ³¨å†Œä¸ºå‚æ•°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>autograd.Function&lt;/code>ï¼š å®žçŽ°ä¸€ä¸ªè‡ªåŠ¨æ±‚å¯¼æ“ä½œçš„å‰å‘å’Œåå‘å®šä¹‰ã€‚æ¯ä¸ª Tensor æ“ä½œéƒ½ä¼šåˆ›å»ºè‡³å°‘ä¸€ä¸ª Function èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹è¿žæŽ¥åˆ°åˆ›å»º Tensor çš„å‡½æ•°ï¼Œå¹¶ç¼–ç å…¶åŽ†å²è®°å½•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æŸå¤±å‡½æ•°">æŸå¤±å‡½æ•°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">target&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># ä¾‹å­ï¼šä¸€ä¸ªå‡è®¾çš„ç»“æžœ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">target&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">target&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># è®© target ä¸Ž output çš„å½¢çŠ¶ç›¸åŒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">criterion&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MSELoss&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">criterion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">target&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">loss&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åå‘ä¼ æ’­">åå‘ä¼ æ’­&lt;/h3>
&lt;p>è¦å®žçŽ°åå‘ä¼ æ’­è¯¯å·®ï¼Œåªéœ€è¦ &lt;code>loss.backward()&lt;/code>ã€‚
ä½†æ˜¯ï¼Œéœ€è¦æ¸…é™¤çŽ°æœ‰çš„æ¢¯åº¦ï¼Œå¦åˆ™æ¢¯åº¦å°†ç´¯ç§¯åˆ°çŽ°æœ‰çš„æ¢¯åº¦ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># å°†æ‰€æœ‰çš„æ¢¯åº¦ç¼“å†²å½’é›¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bias&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># conv1.bias.grad åå‘ä¼ æ’­å‰ tensor([0., 0., 0., 0., 0., 0.])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bias&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># åå‘ä¼ æ’­åŽ tensor([0.0111, -0.0064, 0.0053, -0.0047, 0.0026, -0.0153])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ›´æ–°æƒé‡">æ›´æ–°æƒé‡&lt;/h3>
&lt;p>åœ¨ä½¿ç”¨ PyTorch æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>torch.optim&lt;/code> ä¸­æä¾›çš„æ–¹æ³•è¿›è¡Œæ¢¯åº¦ä¸‹é™ã€‚å¦‚ï¼šSDGï¼ŒNesterov-SDGï¼ŒAdamï¼ŒRMSprop ç­‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.optim&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">optim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºä¸€ä¸ª optimizer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SDG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.01&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨è®­ç»ƒä¸­å¾ªçŽ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># å°†æ¢¯åº¦ç¼“å†²åŒºæ¸…é›¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">criterion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">target&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loass&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backword&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># æ›´æ–°&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è®­ç»ƒåˆ†ç±»å™¨">è®­ç»ƒåˆ†ç±»å™¨&lt;/h2>
&lt;h3 id="æ•°æ®ä»Žå“ªé‡Œæ¥">æ•°æ®ä»Žå“ªé‡Œæ¥ï¼Ÿ&lt;/h3>
&lt;p>é€šå¸¸ï¼Œéœ€è¦å¤„ç†å›¾åƒã€æ–‡æœ¬ã€éŸ³é¢‘æˆ–è§†é¢‘æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å°†æ•°æ®åŠ è½½åˆ° NumPy æ•°ç»„ä¸­çš„æ ‡å‡† Python åŒ…ï¼Œå†å°†è¯¥æ•°å€¼è½¬æ¢ä¸º &lt;code>torch.*Tensor&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>å¤„ç†å›¾åƒï¼Œå¯ä»¥ä½¿ç”¨ Pillowï¼ŒOpenCV&lt;/li>
&lt;li>å¤„ç†éŸ³é¢‘ï¼Œå¯ä»¥ä½¿ç”¨ SciPyï¼Œlibrosa&lt;/li>
&lt;li>å¤„ç†æ–‡æœ¬ï¼Œå¯åŸºäºŽ Python æˆ– Cython çš„åŽŸå§‹åŠ è½½ï¼Œæˆ– NLTK å’Œ SpaCy&lt;/li>
&lt;/ul>
&lt;p>å¯¹äºŽå›¾åƒä»»åŠ¡ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ª &lt;code>torchvision&lt;/code> çš„åŒ…ï¼Œå«æœ‰å¸¸è§çš„æ•°æ®é›†ï¼ˆImagenetï¼ŒCIFAR10ï¼ŒMNISTç­‰ï¼‰çš„æ•°æ®åŠ è½½å™¨ï¼Œä»¥åŠç”¨äºŽå›¾åƒçš„æ•°æ®è½¬æ¢å™¨ï¼ˆtorchvision.datasets å’Œ torch.utils.data.DataLoaderï¼‰ã€‚&lt;/p>
&lt;p>åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œå°†ä½¿ç”¨ CIFAR10 æ•°æ®é›†ã€‚å…¶ä¸­åŒ…å« 10 åˆ†ç±»çš„å›¾åƒï¼šâ€œé£žæœºâ€ï¼Œâ€œæ±½è½¦â€ï¼Œâ€œé¸Ÿâ€ï¼Œâ€œçŒ«â€ï¼Œâ€œé¹¿â€ï¼Œâ€œç‹—â€ï¼Œâ€œé’è›™â€ï¼Œâ€œé©¬â€ï¼Œâ€œèˆ¹â€ï¼Œâ€œå¡è½¦â€ã€‚å›¾åƒçš„å°ºå¯¸ä¸º 3 * 32 * 32ï¼Œå³å°ºå¯¸ä¸º 32 * 32 åƒç´ çš„ 3 é€šé“å½©è‰²å›¾åƒã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/pytorch-handbook/CIFAR-10.png"
width="472"
height="369"
srcset="https://emerywan.github.io/blog/blog/p/pytorch-handbook/CIFAR-10_hubd3e6b51c00827c9a17b1eaa7622a23e_30944_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/pytorch-handbook/CIFAR-10_hubd3e6b51c00827c9a17b1eaa7622a23e_30944_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="CIFAR-10"
class="gallery-image"
data-flex-grow="127"
data-flex-basis="306px"
>&lt;/p>
&lt;p>æŽ¥ä¸‹æ¥ï¼Œä½œä¸ºæ¼”ç¤ºï¼Œå°†æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ­¥éª¤è®­ç»ƒå›¾åƒåˆ†ç±»å™¨ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>torchvision&lt;/code> åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10 è®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†&lt;/li>
&lt;li>å®šä¹‰ CNN&lt;/li>
&lt;li>å®šä¹‰æŸå¤±å‡½æ•°&lt;/li>
&lt;li>æ ¹æ®è®­ç»ƒæ•°æ®è®­ç»ƒç½‘ç»œ&lt;/li>
&lt;li>åœ¨æµ‹è¯•æ•°æ®ä¸Šæµ‹è¯•ç½‘ç»œ&lt;/li>
&lt;/ul>
&lt;h3 id="åŠ è½½å¹¶æ ‡å‡†åŒ–-cifar10">åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torchvision&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torchvision.transforms&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">transforms&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>torchvision çš„è¾“å‡ºæ˜¯ [0, 1] çš„ PILImage å›¾åƒï¼Œæˆ‘ä»¬è¦æŠŠå®ƒè½¬æ¢ä¸ºå½’ä¸€åŒ–èŒƒå›´ä¸º [-1, 1] çš„å¼ é‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">transform&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">transforms&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Compose&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="n">transforms&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ToTensor&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">transforms&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Normalize&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">))]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">trainset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torchvision&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">datasets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CIFAR10&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;./data&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">download&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">transform&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">transform&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">trainloader&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataLoader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">trainset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shuffle&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_workers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">testset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">trochvision&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">datasets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CIFAR10&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;./data&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">download&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">transform&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">transform&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">testloader&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataLoader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">testset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">barch_size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shuffle&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_workers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">classes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;plane&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;car&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;bird&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;cat&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;deer&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;dog&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;frog&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;horse&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ship&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;truck&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®šä¹‰-cnn">å®šä¹‰ CNN&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">nn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn.functional&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">F&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Module&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># in_channels, out_channels, kernel_size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è¾“å…¥çš„ä¸º 3 é€šé“å›¾åƒï¼Œæå– 6 ä¸ªç‰¹å¾ï¼Œå¾—åˆ° 6 ä¸ª feature mapï¼Œå·ç§¯æ ¸ä¸ºä¸€ä¸ª 5*5 çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MaxPool2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å·ç§¯å±‚è¾“å‡ºäº† 16 ä¸ª feature mapï¼Œæ¯ä¸ª feature map æ˜¯ 6*6 çš„äºŒç»´æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">16&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">120&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">120&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">84&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">84&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pool&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pool&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">x&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨">å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨&lt;/h3>
&lt;p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº¤å‰ç†µä½œä¸ºæŸå¤±å‡½æ•°ï¼Œä½¿ç”¨å¸¦åŠ¨é‡çš„éšæœºæ¢¯åº¦ä¸‹é™ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.optim&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">optim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">criterion&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CrossEntropyLoss&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SDG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.001&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">momentum&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è®­ç»ƒç½‘ç»œ">è®­ç»ƒç½‘ç»œ&lt;/h3>
&lt;p>æŽ¥ä¸‹æ¥ï¼Œåªéœ€è¦åœ¨è¿­ä»£æ•°æ®ï¼Œå°†æ•°æ®è¾“å…¥ç½‘ç»œä¸­å¹¶ä¼˜åŒ–ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">enumerate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">trainloader&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="c1"># èŽ·å–è¾“å…¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># å°†æ¢¯åº¦ç¼“å†²åŒºæ¸…é›¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">inputs&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># æ­£å‘ä¼ æ’­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">criterion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lables&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># åå‘ä¼ æ’­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># ä¼˜åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">2000&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1999&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="c1"># æ¯ 2000 æ‰¹æ¬¡æ‰“å°ä¸€æ¬¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;[]&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">epoch&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="mi">2000&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ•°æ®">åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ•°æ®&lt;/h3>
&lt;p>åœ¨ä¸Šé¢çš„è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬è®­ç»ƒäº† 2 æ¬¡ï¼ŒæŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦æ£€æµ‹ç½‘ç»œæ˜¯å¦ä»Žæ•°æ®é›†ä¸­å­¦ä¹ åˆ°äº†æœ‰ç”¨çš„ä¸œè¥¿ã€‚é€šè¿‡é¢„æµ‹ç¥žç»ç½‘ç»œè¾“å‡ºçš„ç±»åˆ«æ ‡ç­¾ä¸Žå®žé™…æƒ…å†µæ ‡ç­¾å¯¹æ¯”è¿›è¡Œæ£€æµ‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">corrent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">total&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">no_grad&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">testloader&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">images&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lobels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">images&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">predicted&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">outputs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">total&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">corrent&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">predicted&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Accuracy of the network on the 10000 test images: &lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1"> &lt;/span>&lt;span class="si">%%&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">corrent&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of the network on the 10000 test images: 9%&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨è®­ç»ƒä¸¤æ¬¡çš„ç½‘ç»œä¸­ï¼Œéšæœºé€‰æ‹©çš„æ­£ç¡®çŽ‡ä¸º 10%ã€‚ç½‘ç»œä¼¼ä¹Žå­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ã€‚&lt;/p>
&lt;p>é‚£è¿™ä¸ªç½‘ç»œï¼Œè¯†åˆ«å“ªä¸€ç±»å¥½ï¼Œå“ªä¸€ç±»ä¸å¥½å‘¢ï¼Ÿ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">class_corrent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">class_total&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">no_grad&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">testloader&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">images&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">images&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">predicted&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">predicted&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">squeeze&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">label&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">class_correct&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">label&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">class_total&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">label&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Accuracy of &lt;/span>&lt;span class="si">%5s&lt;/span>&lt;span class="s1"> : &lt;/span>&lt;span class="si">%2d&lt;/span>&lt;span class="s1"> &lt;/span>&lt;span class="si">%%&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">classes&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">class_correct&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">class_total&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of plane : 99 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of car : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of bird : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of cat : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of deer : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of dog : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of frog : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of horse : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of ship : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of truck : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ä½¿ç”¨-gpu">ä½¿ç”¨ GPU&lt;/h2>
&lt;p>ä¸Žå°† tensor ç§»åˆ° GPU ä¸Šä¸€æ ·ï¼Œç¥žç»ç½‘ç»œä¹Ÿå¯ä»¥ç§»åŠ¨åˆ° GPU ä¸Šã€‚
å¦‚æžœå¯ä»¥ä½¿ç”¨ CUDAï¼Œå°†è®¾å¤‡å®šä¹‰ä¸ºç¬¬ä¸€ä¸ª cuda è®¾å¤‡ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">device&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cuda:0&amp;#39;&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cuda&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">is_available&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="s1">&amp;#39;cpu&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cuda:0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¤åˆ¶ nn å’Œ tensor åˆ° GPU ä¸Šã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>.to(device)&lt;/code> å¹¶æ²¡æœ‰å¤åˆ¶ nn / tensor åˆ° GPU ä¸Šï¼Œè€Œæ˜¯è¿”å›žäº†ä¸€ä¸ª copyã€‚éœ€è¦èµ‹å€¼åˆ°ä¸€ä¸ªæ–°çš„å˜é‡åŽåœ¨ GPU ä¸Šä½¿ç”¨è¿™ä¸ª nn / tensorã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://pytorch.apachecn.org/#/docs/1.7/02" target="_blank" rel="noopener"
>https://pytorch.apachecn.org/#/docs/1.7/02&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>React Hooks</title><link>https://emerywan.github.io/blog/p/react-hooks/</link><pubDate>Thu, 28 Jan 2021 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/react-hooks/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/9.jpeg" alt="Featured image of post React Hooks" />&lt;h1 id="react-hooks-ç®€ä»‹">React Hooks ç®€ä»‹&lt;/h1>
&lt;h2 id="hook-å«ä¹‰">Hook å«ä¹‰&lt;/h2>
&lt;h1 id="ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶">ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶&lt;/h1>
&lt;h1 id="usestate">useState&lt;/h1>
&lt;h2 id="ä½¿ç”¨">ä½¿ç”¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useState&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">Example&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å£°æ˜Žäº†ä¸€ä¸ª count çš„ state å˜é‡ï¼Œå¹¶åˆå§‹åŒ–ä¸º 0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// setCount è®¾ç½® state å€¼ count çš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œå°† count çš„å€¼ +1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">You&lt;/span> &lt;span class="nx">clicked&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">times&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">button&lt;/span> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Click&lt;/span> &lt;span class="nx">me&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="nx">Example&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è¯­æ³•">è¯­æ³•&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å£°æ˜Žä¸€ä¸ª state å˜é‡ï¼Œå¹¶åŒæ—¶åˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setState&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">initialState&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>useState è¿”å›žä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„
&lt;ul>
&lt;li>state å˜é‡ï¼ŒæŒ‡å‘çŠ¶æ€å½“å‰å€¼&lt;/li>
&lt;li>setState æ›´æ–° state å€¼çš„æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>initialState çŠ¶æ€åˆå§‹å€¼å¯ä»¥æ˜¯æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ç­‰&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸Žç±»ä¸­ä½¿ç”¨-setstate-å¼‚åŒ">ä¸Žç±»ä¸­ä½¿ç”¨ &lt;code>setState&lt;/code> å¼‚åŒ&lt;/h2>
&lt;ul>
&lt;li>ç›¸åŒç‚¹
&lt;ul>
&lt;li>åœ¨ä¸€æ¬¡æ¸²æŸ“å‘¨æœŸä¸­è°ƒç”¨å¤šæ¬¡ setStateï¼Œæ•°æ®åªæ”¹å˜ä¸€æ¬¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¸åŒç‚¹
&lt;ul>
&lt;li>ç±»ç»„ä»¶ä¸­ setState ä¸ºåˆå¹¶&lt;/li>
&lt;li>å‡½æ•°ç»„ä»¶ä¸­ setState ä¸ºæ›¿æ¢&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="useeffect">useEffect&lt;/h1>
&lt;p>useEffect ç”¨æ¥æ‰§è¡Œå‰¯ä½œç”¨ã€‚å¯ä»¥å°† useEffect Hook çœ‹åš &lt;code>componentDidMount, componentDidUpdate, componentWillMount&lt;/code> ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„ç»„åˆã€‚&lt;/p>
&lt;p>å¸¸ç”¨åœ¨ï¼š&lt;/p>
&lt;ul>
&lt;li>æœåŠ¡å™¨è¯·æ±‚&lt;/li>
&lt;li>è®¿é—®å…ƒç´  dom å…ƒç´ &lt;/li>
&lt;li>æœ¬åœ°æŒä¹…åŒ–ç¼“å­˜&lt;/li>
&lt;li>ç»‘å®š/è§£ç»‘äº‹ä»¶&lt;/li>
&lt;li>æ·»åŠ è®¢é˜…&lt;/li>
&lt;li>è®¾ç½®å®šæ—¶å™¨&lt;/li>
&lt;li>è®°å½•æ—¥å¿—&lt;/li>
&lt;li>ç­‰&lt;/li>
&lt;/ul>
&lt;p>useEffect æŽ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¸²æŸ“å®Œæ¯•åŽæ‰æ‰§è¡Œï¼Œè¯¥å‡½æ•°æœ‰è¦æ±‚ï¼šè¦ä¹ˆè¿”å›žä¸€ä¸ªèƒ½æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¦ä¹ˆå°±ä¸è¿”å›žä»»ä½•å†…å®¹ã€‚&lt;/p>
&lt;h2 id="ä¸éœ€è¦æ¸…é™¤çš„-effect">ä¸éœ€è¦æ¸…é™¤çš„ effect&lt;/h2>
&lt;p>åœ¨ React æ›´æ–° DOM ä¹‹åŽï¼Œæˆ‘ä»¬æƒ³è¿è¡Œä¸€äº›é¢å¤–çš„ä»£ç ã€‚æ¯”å¦‚å‘é€ç½‘ç»œè¯·æ±‚ï¼Œæ‰‹åŠ¨å˜æ›´ DOMï¼Œè®°å½•æ—¥å¿—ï¼Œè¿™äº›éƒ½æ˜¯å¸¸è§çš„æ— éœ€æ¸…é™¤çš„æ“ä½œã€‚
å› ä¸ºæˆ‘ä»¬åœ¨æ‰§è¡Œå®Œè¿™äº›æ“ä½œä¹‹åŽï¼Œå°±å¯ä»¥å¿½ç•¥ä»–ä»¬äº†ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹ä¸ºä½¿ç”¨ class å’Œ Hook éƒ½æ˜¯æ€Žä¹ˆå®žçŽ°è¿™äº›å‰¯ä½œç”¨çš„å¯¹æ¯”ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨ç±»ç»„ä»¶">ä½¿ç”¨ç±»ç»„ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åœ¨ React æ›´æ–° DOM æ“ä½œåŽï¼Œç«‹å³æ›´æ–° document çš„ title å±žæ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">class&lt;/span> &lt;span class="nx">Example&lt;/span> &lt;span class="kr">extends&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Component&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç»„ä»¶åŠ è½½æ—¶éœ€è¦æ›´æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">componentDidMount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç»„ä»¶æ›´æ–°æ—¶éœ€è¦æ›´æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">componentDidUpdate&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åœ¨ render() ä¸èƒ½æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚åº”è¯¥åœ¨ react æ›´æ–° DOM åŽå†æ‰§è¡Œå‰¯ä½œç”¨ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">render&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">You&lt;/span> &lt;span class="nx">clicked&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">times&lt;/span>&lt;span class="p">.&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">button&lt;/span> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">})}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">click&lt;/span> &lt;span class="nx">me&lt;/span>&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä½¿ç”¨-hook">ä½¿ç”¨ Hook&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">useState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">Example&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="c1">// ç»è¿‡æ¸²æŸ“æˆ–æ›´æ–°ï¼Œ DOM æ›´æ–°å®Œæ¯•ä¹‹åŽï¼Œä¼šè¿è¡Œè¯¥ effect
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You click &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">You&lt;/span> &lt;span class="nx">clicked&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">times&lt;/span>&lt;span class="p">.&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">button&lt;/span> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">})}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">click&lt;/span> &lt;span class="nx">me&lt;/span>&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åŽå’Œæ¯æ¬¡æ›´æ–°ä¹‹åŽéƒ½ä¼šæ‰§è¡Œ useEffectã€‚ä¸” React ä¿è¯æ¯æ¬¡è¿è¡Œ effect çš„åŒæ—¶ï¼ŒDOM å·²ç»æ›´æ–°å®Œæ¯•ã€‚&lt;/li>
&lt;li>useEffect æ”¾åœ¨ç»„ä»¶å†…éƒ¨è®©æˆ‘ä»¬å¯ä»¥åœ¨ effect ä¸­ç›´æŽ¥è®¿é—® state / propsã€‚æˆ‘ä»¬ä¸éœ€è¦ç‰¹æ®Šçš„ API æ¥è¯»å–ã€‚&lt;/li>
&lt;li>ä¸Ž componentDidMount æˆ– componentDidUpdate ä¸åŒï¼Œä½¿ç”¨ useEffect è°ƒåº¦çš„ effect ä¸ä¼šé˜»å¡žæµè§ˆå™¨æ›´æ–°å±å¹•ï¼Œè¿™è®©ä½ çš„åº”ç”¨çœ‹èµ·æ¥å“åº”æ›´å¿«ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œeffect ä¸éœ€è¦åŒæ­¥åœ°æ‰§è¡Œã€‚åœ¨ä¸ªåˆ«æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚æµ‹é‡å¸ƒå±€ï¼‰ï¼Œæœ‰å•ç‹¬çš„ useLayoutEffect Hook ä¾›ä½ ä½¿ç”¨ï¼Œå…¶ API ä¸Ž useEffect ç›¸åŒã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="éœ€è¦æ¸…é™¤çš„-effect">éœ€è¦æ¸…é™¤çš„ effect&lt;/h2>
&lt;p>æœ‰ä¸€äº›å‰¯ä½œç”¨æ˜¯éœ€è¦æ¸…é™¤çš„ï¼Œå¦‚è®¢é˜…å¤–éƒ¨æ•°æ®æºã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ¸…é™¤å·¥ä½œæ˜¯éžå¸¸é‡è¦çš„ï¼Œå¯ä»¥é˜²æ­¢å¼•èµ·å†…å­˜æ³„éœ²ï¼&lt;/p>
&lt;h3 id="ä½¿ç”¨ç±»ç»„ä»¶-1">ä½¿ç”¨ç±»ç»„ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">class&lt;/span> &lt;span class="nx">FriendStatus&lt;/span> &lt;span class="kr">extends&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Component&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">null&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bind&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentDidMount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentDidUpdate&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentWillUnmount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åœ¨ç»„ä»¶å¸è½½æ—¶ï¼Œå…³é—­è®¢é˜…çš„æ•°æ®æº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">render&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s1">&amp;#39;Loading...&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;Online&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Offline&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä½¿ç”¨å‡½æ•°ç»„ä»¶">ä½¿ç”¨å‡½æ•°ç»„ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">useState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">FriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">isOnline&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// effect å¯é€‰æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¿”å›žå‡½æ•°ä¸ä¸€å®šéœ€è¦å‘½å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">cleanup&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s1">&amp;#39;Loading...&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">isOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;Online&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Offline&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>React ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œæ¸…é™¤æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å¤šä¸ª-effect-å®žçŽ°å…³æ³¨ç‚¹åˆ†ç¦»">å¤šä¸ª Effect å®žçŽ°å…³æ³¨ç‚¹åˆ†ç¦»&lt;/h2>
&lt;p>ä½¿ç”¨ Hook çš„å…¶ä¸­ä¸€ä¸ªç›®çš„æ˜¯è¦è§£å†³ï¼š class ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ç»å¸¸åŒ…å«ä¸ç›¸å…³é€»è¾‘ï¼Œç›¸å…³é€»è¾‘åˆåˆ†ç¦»åœ¨å‡ ä¸ªä¸åŒçš„æ–¹æ³•ä¸­ã€‚&lt;/p>
&lt;p>å¦‚ä¸‹ä¸ºä¸Šæ–‡ä¸­è®¡æ•°å™¨å’Œå¥½å‹çŠ¶æ€æŒ‡ç¤ºå™¨é€»è¾‘ç»„åˆåœ¨ä¸€èµ·çš„ç»„ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">class&lt;/span> &lt;span class="nx">FriendStatusWithCounter&lt;/span> &lt;span class="kr">extends&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Component&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStautsChange&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bind&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç›¸åº”çš„é€»è¾‘è¢«åˆ†é…åœ¨ä¸‰ä¸ªä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">componentDidMount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// counter
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// friend status
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">fried&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentDidUpdate&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentWillUnmount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è‹¥ä½¿ç”¨ Hookï¼Œå’Œä½¿ç”¨å¤šä¸ª state çš„ Hook ä¸€æ ·ï¼Œé€šè¿‡ä½¿ç”¨å¤šä¸ª effectï¼Œå°†ä¸ç›¸å…³çš„é€»è¾‘åˆ†ç¦»åˆ°ä¸åŒçš„ effect ä¸­ã€‚&lt;/p>
&lt;p>Hook å…è®¸æŒ‰ç…§ä»£ç çš„ç”¨é€”è¿›è¡Œåˆ†ç¦»ï¼Œä¸åŒäºŽç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚å°†æŒ‰ç…§ effect å£°æ˜Žçš„é¡ºåºä¾æ¬¡è°ƒç”¨ç»„ä»¶ä¸­çš„æ¯ä¸€ä¸ª effectã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">FriendStatusWithCounter&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">isOneline&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useIsOneline&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setIsOneline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOneline&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è·³è¿‡-effect-è¿›è¡Œæ€§èƒ½ä¼˜åŒ–">è·³è¿‡ Effect è¿›è¡Œæ€§èƒ½ä¼˜åŒ–&lt;/h2>
&lt;p>åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code>componentDidUpdate&lt;/code> ä¸­ &lt;code>prevProps&lt;/code> å’Œ &lt;code>prevState&lt;/code> çš„ props / state çš„å˜åŒ–æ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡ŒæŸäº›å‰¯ä½œç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">componentDidUpdate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">prevProps&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">prevState&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">prevState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ Hook ä¸­ï¼Œå¯ä»¥é€šè¿‡å¯¹ useEffect ä¼ é€’æ•°ç»„ä½œä¸ºç¬¬äºŒå¯é€‰å‚æ•°ï¼Œé€šçŸ¥ React è·³è¿‡å¯¹ effect çš„è°ƒç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">]);&lt;/span> &lt;span class="c1">// è¡¨ç¤º count æ›´æ”¹æ—¶ä¼šè¿›è¡Œæ›´æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// {... , [5]} å½“ count === 5 æ—¶ï¼Œè·³è¿‡ effect
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>è‹¥åªæƒ³è¿è¡Œä¸€æ¬¡ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ [] ä½œä¸ºç¬¬äºŒå‚æ•°ã€‚
&lt;ul>
&lt;li>ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ï¼Œeffect å†…éƒ¨çš„ props å’Œ state ä¼šä¸€ç›´æ‹¥æœ‰å…¶åˆå§‹å€¼ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä½¿ç”¨è¯¥ä¼˜åŒ–ï¼Œè¯·ç¡®ä¿æ•°ç»„ä¸­åŒ…å«äº†æ‰€æœ‰å¤–éƒ¨ä½œç”¨åŸŸä¸­ä¼šéšæ—¶é—´å˜åŒ–ä¸”åœ¨ effect ä¸­ä½¿ç”¨çš„å˜é‡ï¼Œå¦åˆ™ä»£ç ä¼šç”¨åˆ°å…ˆå‰æ¸²æŸ“ä¸­çš„æ—§å˜é‡ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ-effect-çš„åŽŸå› ">æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ Effect çš„åŽŸå› &lt;/h2>
&lt;h1 id="è‡ªå®šä¹‰-hook">è‡ªå®šä¹‰ Hook&lt;/h1>
&lt;p>è‡ªå®šä¹‰ Hook å¯ä»¥å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ã€‚&lt;/p>
&lt;p>ç›®å‰ä¸ºæ­¢ï¼Œåœ¨ React ä¸­æœ‰ä¸¤ç§æµè¡Œçš„æ–¹å¼å…±äº«ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘ï¼š&lt;/p>
&lt;ul>
&lt;li>render props&lt;/li>
&lt;li>é«˜é˜¶ç»„ä»¶
ä½¿ç”¨ Hook å¯ä»¥åœ¨ä¸å¢žåŠ ç»„ä»¶çš„æƒ…å†µä¸‹è§£å†³ç›¸åŒçš„é—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="åˆ›å»ºè‡ªå®šä¹‰-hook">åˆ›å»ºè‡ªå®šä¹‰ Hook&lt;/h2>
&lt;p>å½“æˆ‘ä»¬æƒ³åœ¨å‡½æ•°é—´å…±äº«é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæå–åˆ°å¦å¤–ä¸€ä¸ªå‡½æ•°ä¸­ã€‚ç”±äºŽç»„ä»¶å’Œ Hook éƒ½æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ä¹ŸåŒæ ·ä½¿ç”¨äºŽè¿™ç§æ–¹å¼ã€‚&lt;/p>
&lt;p>è‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åç§°ä»¥ &amp;ldquo;use&amp;rdquo; å¼€å¤´ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–çš„ Hookã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯æ ¹æ®ä¸Šæ–‡ä¸­ &lt;code>FriendStatus&lt;/code> å®žä¾‹ï¼Œæ‰€æå–çš„è‡ªå®šä¹‰ Hookã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useEffect&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åç§°ä¸€å®šä»¥ use å¼€å¤´
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friendID&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">isOnline&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOneline&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friendID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubcribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friendID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">isOnline&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨è¿™ä¸ªè‡ªå®šä¹‰ Hook ä¸­ï¼Œæ²¡æœ‰åŒ…å«ä»»ä½•æ–°å†…å®¹ï¼ˆé€»è¾‘ä¸Žç»„ä»¶ä¸­çš„å®Œå…¨ä¸€è‡´ï¼‰&lt;/p>
&lt;h2 id="ä½¿ç”¨è‡ªå®šä¹‰-hook">ä½¿ç”¨è‡ªå®šä¹‰ Hook&lt;/h2>
&lt;p>ä¸Žç»„ä»¶ä¸€è‡´ï¼Œè¯·ç¡®ä¿åªåœ¨è‡ªå®šä¹‰ Hook çš„é¡¶å±‚æ— æ¡ä»¶åœ°è°ƒç”¨å…¶ä»– Hookã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">function&lt;/span> &lt;span class="nx">FriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">isOnline&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s2">&amp;#34;Loading...&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">isOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;Online&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Offline&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ®µä»£ç ä¸Žä¹‹å‰çš„å·¥ä½œæ–¹å¼å®Œå…¨ä¸€æ ·ï¼Œæˆ‘ä»¬åªæ˜¯å°†å‡½æ•°ä¸­éœ€è¦å…±äº«çš„é€»è¾‘æå–åˆ°å•ç‹¬çš„å‡½æ•°ä¸­ã€‚&lt;/p>
&lt;ul>
&lt;li>è‡ªå®šä¹‰ Hook æ˜¯ä¸€ç§è‡ªç„¶éµå¾ª Hook è®¾è®¡çš„çº¦å®šï¼Œä¸æ˜¯ React çš„ç‰¹æ€§ã€‚&lt;/li>
&lt;li>è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ &amp;ldquo;use&amp;rdquo; å¼€å¤´&lt;/li>
&lt;li>ä¸åŒç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ Hook ä¸ä¼šå…±äº« stateã€‚
&lt;ul>
&lt;li>è‡ªå®šä¹‰ Hook æ˜¯é‡ç”¨çŠ¶æ€é€»è¾‘çš„æœºåˆ¶ï¼ˆä¾‹å¦‚è®¾ç½®ä¸ºè®¢é˜…å¹¶å­˜å‚¨å½“å‰å€¼ï¼‰ï¼Œæ¯æ¬¡ä½¿ç”¨è‡ªå®šä¹‰ Hook æ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰ state å’Œå‰¯ä½œç”¨å®Œå…¨éš”ç¦»ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="åœ¨å¤šä¸ª-hook-ä¹‹é—´ä¼ é€’ä¿¡æ¯">åœ¨å¤šä¸ª Hook ä¹‹é—´ä¼ é€’ä¿¡æ¯&lt;/h2>
&lt;p>ç”±äºŽ Hook æœ¬èº«å°±æ˜¯å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è¿™æ˜¯ä¸€ä¸ªèŠå¤©æ¶ˆæ¯æŽ¥æ”¶è€…çš„é€‰æ‹©å™¨ï¼Œå®ƒä¼šæ˜¾ç¤ºå½“å‰é€‰å®šçš„å¥½å‹æ˜¯å¦åœ¨çº¿
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">ChatRecipientPicker&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰é€‰æ‹©çš„å¥½å‹ ID ä¿å­˜åœ¨ recipientID çŠ¶æ€å˜é‡ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">recipientID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setRecipientID&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“æ›´æ–° recipientID çŠ¶æ€å˜é‡æ—¶ï¼ŒuseFriendStatus Hook ä¼šå–æ¶ˆè®¢é˜…ä¹‹å‰é€‰ä¸­çš„å¥½å‹ï¼Œå¹¶è®¢é˜…æ–°é€‰ä¸­çš„å¥½å‹çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">isRecipientOnline&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">recipientID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">Circle&lt;/span> &lt;span class="nx">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">isRecipientOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;green&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;red&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">select&lt;/span> &lt;span class="c1">// &amp;lt;select&amp;gt; ä¸­é€‰æ‹©å…¶ä»–å¥½å‹æ—¶æ›´æ–° recipientID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">recipientID&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">onChange&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">e&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">setRecipientID&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Number&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">target&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span>&lt;span class="p">))}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">friendList&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friend&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">option&lt;/span> &lt;span class="nx">key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">/option&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">/select&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘ä»¬å°†å½“å‰é€‰æ‹©çš„å¥½å‹ ID ä¿å­˜åœ¨ recipientID çŠ¶æ€å˜é‡ä¸­ï¼Œå¹¶ä¼šåœ¨ç”¨æˆ·ä»Ž &amp;lt;select&amp;gt; ä¸­é€‰æ‹©å…¶ä»–å¥½å‹æ—¶æ›´æ–°è¿™ä¸ª stateã€‚&lt;/p>
&lt;p>ç”±äºŽ useState ä¼šæä¾› recipientID çŠ¶æ€å˜é‡çš„æœ€æ–°å€¼ï¼Œå¯ä»¥å°†å®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™è‡ªå®šä¹‰çš„ useFriendStatus Hookã€‚å½“æˆ‘ä»¬é€‰æ‹©ä¸åŒçš„å¥½å‹å¹¶æ›´æ–° recipientID çŠ¶æ€å˜é‡æ—¶ï¼ŒuseFriendStatus Hook ä¼šå–æ¶ˆè®¢é˜…ä¹‹å‰é€‰ä¸­çš„å¥½å‹ï¼Œå¹¶è®¢é˜…æ–°é€‰ä¸­çš„å¥½å‹çŠ¶æ€ã€‚&lt;/p>
&lt;h1 id="hook-è§„åˆ™">Hook è§„åˆ™&lt;/h1>
&lt;h1 id="é¢å¤–çš„-hook">é¢å¤–çš„ Hook&lt;/h1>
&lt;h1 id="å‚è€ƒ">å‚è€ƒ&lt;/h1>
&lt;ul>
&lt;li>&lt;a class="link" href="https://juejin.im/post/6844903814349193229" target="_blank" rel="noopener"
>https://juejin.im/post/6844903814349193229&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://juejin.im/post/6844903985338400782" target="_blank" rel="noopener"
>https://juejin.im/post/6844903985338400782&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.ruanyifeng.com/blog/2019/09/react-hooks.html" target="_blank" rel="noopener"
>https://www.ruanyifeng.com/blog/2019/09/react-hooks.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://zh-hans.reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener"
>https://zh-hans.reactjs.org/docs/hooks-intro.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Ubuntu è€³æœºæ²¡æœ‰å£°éŸ³</title><link>https://emerywan.github.io/blog/p/ubuntu-sound/</link><pubDate>Sat, 02 Jan 2021 02:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/ubuntu-sound/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/5.jpeg" alt="Featured image of post Ubuntu è€³æœºæ²¡æœ‰å£°éŸ³" />&lt;h2 id="ubuntu-è€³æœºæ²¡æœ‰å£°éŸ³">Ubuntu è€³æœºæ²¡æœ‰å£°éŸ³&lt;/h2>
&lt;p>ç¬”è®°æœ¬ä½¿ç”¨ Ubuntu æ’æœ‰çº¿è€³æœºåŽï¼Œå¹¶æ²¡æœ‰ååº”ï¼Œè¯¥å¤–æ”¾è¿˜æ˜¯å¤–æ”¾ã€‚&lt;/p>
&lt;p>æ„Ÿè§‰æ˜¯é€‚é…é—®é¢˜ï¼Œwindows ä¸‹æ²¡æœ‰é—®é¢˜ã€‚æ‰¾äº†ä¸€åœˆåŠžæ³•ï¼Œåªèƒ½é€šè¿‡è½¯ä»¶æ‰‹åŠ¨åˆ‡æ¢äº†ï¼Œæ•ˆæžœè¿˜ä¸é”™ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install pavucontrol
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥åœ¨è¿™é‡Œåˆ‡æ¢è¾“å‡ºè®¾å¤‡ï¼š&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/ubuntu-sound/output.png"
width="514"
height="446"
srcset="https://emerywan.github.io/blog/blog/p/ubuntu-sound/output_hubad1730db6fbe32ffe9d254c812a9365_52081_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/ubuntu-sound/output_hubad1730db6fbe32ffe9d254c812a9365_52081_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="output"
class="gallery-image"
data-flex-grow="115"
data-flex-basis="276px"
>&lt;/p>
&lt;p>åˆ‡æ¢è¾“å…¥è®¾å¤‡ï¼š&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/ubuntu-sound/input.png"
width="517"
height="448"
srcset="https://emerywan.github.io/blog/blog/p/ubuntu-sound/input_hufb6fce95f1bcffd19d35ec16e321d778_54938_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/ubuntu-sound/input_hufb6fce95f1bcffd19d35ec16e321d778_54938_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="input"
class="gallery-image"
data-flex-grow="115"
data-flex-basis="276px"
>&lt;/p></description></item><item><title>NumPy</title><link>https://emerywan.github.io/blog/p/numpy/</link><pubDate>Tue, 01 Dec 2020 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/numpy/</guid><description>&lt;img src="https://emerywan.github.io/blog/imgs/3.jpeg" alt="Featured image of post NumPy" />&lt;h1 id="æ•°æ®ç±»åž‹">æ•°æ®ç±»åž‹&lt;/h1>
&lt;h1 id="æ•°ç»„-numpyarray">æ•°ç»„ numpy.array&lt;/h1>
&lt;h4 id="npzeros">np.zeros&lt;/h4>
&lt;p>åˆ›å»ºæŒ‡å®šå¤§å°çš„æ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ä»¥ 0 å¡«å……ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.zeros(shape, dtype=None, order = &amp;lsquo;C&amp;rsquo;)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>shape æ•°ç»„å½¢çŠ¶&lt;/li>
&lt;li>dtype æ•°æ®ç±»åž‹&lt;/li>
&lt;li>order &amp;lsquo;C&amp;rsquo; ç”¨äºŽ C çš„è¡Œæ•°ç»„ï¼Œæˆ–è€… &amp;lsquo;F&amp;rsquo; ç”¨äºŽ FORTRAN çš„åˆ—æ•°ç»„&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0. 0. 0. 0. 0.]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0 0 0 0 0]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># ä¸‰è¡Œäº”åˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">shape&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0., 0., 0., 0.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0., 0., 0., 0.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0., 0., 0., 0.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="npones">np.ones&lt;/h4>
&lt;p>åˆ›å»ºæŒ‡å®šå¤§å°çš„æ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ä»¥ 1 å¡«å……ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.ones(shape, dtype=None, order=&amp;lsquo;C&amp;rsquo;)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h4 id="npfull">np.full&lt;/h4>
&lt;p>åˆ›å»ºæŒ‡å®šå¤§å°å’Œæ•°æ®çš„æ•°ç»„&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.full(shape, fill_value, dtype=None, order=&amp;lsquo;C&amp;rsquo;)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºä¸€ä¸ª ä¸‰è¡Œäº”åˆ— å€¼ä¸º 666.0 çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">full&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="mf">666.0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="nparange">np.arange&lt;/h4>
&lt;p>åœ¨æ•°ç»„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ range åˆ›å»ºæŒ‡å®šèŒƒå›´çš„æ•°ç»„ï¼ˆä¸èƒ½ä¼ é€’æµ®ç‚¹æ•°ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 20) æ­¥é•¿ä¸º 2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 2, 4, 6, 8, 10, 12, 14, 16, 18]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ numpy ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ arange åˆ›å»ºæ•°ç»„èŒƒå›´å¹¶è¿”å›ž ndarray å¯¹è±¡ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.arange(start, stop, step, dtype)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>start èµ·å§‹å€¼ï¼Œé»˜è®¤ä¸º 0&lt;/li>
&lt;li>stop ç»ˆæ­¢å€¼ï¼Œä¸åŒ…å«&lt;/li>
&lt;li>step æ­¥é•¿ï¼Œé»˜è®¤ä¸º 1&lt;/li>
&lt;li>dtype æ•°æ®ç±»åž‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯ä»¥ä¼ é€’æµ®ç‚¹æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0.2, 0.4, 0.6, 0.8]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="nplinspace">np.linspace&lt;/h4>
&lt;p>åˆ›å»ºä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œæž„æˆä¸€ä¸ªç­‰å·®æ•°åˆ—ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.linspace(start, stop, num=50, endpoint=True, retstep=False,dtype=None, axis=0)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>start èµ·å§‹å€¼&lt;/li>
&lt;li>stop ç»ˆæ­¢å€¼ï¼ˆé»˜è®¤åŒ…å« endpoint=Trueï¼‰&lt;/li>
&lt;li>endpoint å½“ä¸º True æ—¶ï¼Œä¼šåŒ…å« stop çš„å€¼&lt;/li>
&lt;li>retstep å½“ä¸º True æ—¶ï¼Œç”Ÿæˆçš„æ•°ç»„ä¸­ä¼šæ˜¾ç¤ºé—´è·&lt;/li>
&lt;li>dtype æ•°æ®ç±»åž‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿæˆ [0, 20] é—´è·ä¸º 2 çš„ 10 ä¸ªæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">linspace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">11&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 2., 4., 6., 8., 10., 12., 14., 16., 18., 20.]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="nprandom">np.random&lt;/h4>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.random.randint(low, high=None, size=None, dtype=None)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ç”ŸæˆæŒ‡å®šçš„æ•´æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ [0, 10) é—´ç”Ÿæˆä¸€ä¸ªéšæœºæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ [0, 10) é—´ç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º 10 çš„ä¸€ç»´æ•°ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [7, 7, 7, 7, 7, 4, 5, 6, 4, 7]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ [0, 10) é—´ç”Ÿæˆä¸€ä¸ª 3è¡Œ6åˆ— çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŒ‡å®šéšæœºç§å­ï¼Œä½¿ç”Ÿæˆçš„æ•°æ®åœ¨æµ‹è¯•æ—¶ä¿æŒä¸€è‡´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">666&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>numpy.random.random(size=None)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ç”Ÿæˆ [0.0, 1.0) é—´çš„æµ®ç‚¹æ•°ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.random.normal(loc=0.0, scale=1.0, size=None)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ç”Ÿæˆä¸€ä¸ªç¬¦åˆæ­£æ€åˆ†å¸ƒçš„æµ®ç‚¹æ•°ã€‚&lt;/p>
&lt;ul>
&lt;li>loc å‡å€¼&lt;/li>
&lt;li>scale æ–¹å·®&lt;/li>
&lt;li>size å¤§å°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿæˆ å‡å€¼ä¸º 10 æ–¹å·®ä¸º 100 çš„æµ®ç‚¹æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿæˆ å‡å€¼ä¸º 0 æ–¹å·®ä¸º 1 çš„ 3è¡Œ5åˆ—çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="numpyarray-åŸºæœ¬æ“ä½œ">numpy.array åŸºæœ¬æ“ä½œ&lt;/h1>
&lt;p>å‡è®¾æœ‰å¦‚ä¸‹ä¸€ä¸ªä¸€ç»´çš„æ•°ç»„ x å’Œ ä¸€ä¸ªä¸‰è¡Œäº”åˆ—çš„çŸ©é˜µ Xï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">numpy&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">np&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0, 1, 2, 3, 4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 5, 6, 7, 8, 9],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [10, 11, 12, 13, 14]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="reshape">Reshape&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°† x è½¬ç½®ä¸º 2è¡Œ5åˆ—çš„ çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">A&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ] &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°†å‘é‡è£…ç½®æˆçŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -1ï¼šè®© numpy è‡ªå·±å†³å®šç»´åº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 10åˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 10è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">D&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [2],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [3],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [5],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [6],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [7],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [8],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [9],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">E&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ•°æ®ä¸èƒ½æ•´é™¤çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½ reshape&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">F&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åŸºæœ¬å±žæ€§">åŸºæœ¬å±žæ€§&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ndarray.ndim ç§©ï¼Œå³è½´çš„æ•°é‡æˆ–ç»´åº¦çš„æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ndim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ndim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ndarray.shape æ•°ç»„ç»´åº¦ï¼Œå¯¹äºŽçŸ©é˜µä¸ºnè¡Œmåˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (10, )&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (3, 5)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ndarray.size æ•°ç»„å…ƒç´ çš„æ€»ä¸ªæ•°ï¼Œå¯¹äºŽçŸ©é˜µä¸º n*m ä¸ª&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 15&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ•°æ®è®¿é—®">æ•°æ®è®¿é—®&lt;/h2>
&lt;p>ä¸€ç»´ numpy.array å¯ä»¥å’Œæ•°ç»„ä¸€æ ·è¿›è¡Œè®¿é—®ã€‚&lt;/p>
&lt;p>å¤šç»´ numpy.array åœ¨è®¿é—®æ—¶ï¼ŒæŽ¨èä¼ å…¥å¤šä¸ªå‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸€ç»´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>æœºå™¨å­¦ä¹ åŸºç¡€</title><link>https://emerywan.github.io/blog/p/mechine-learning-basics/</link><pubDate>Mon, 28 Sep 2020 14:02:02 +0800</pubDate><guid>https://emerywan.github.io/blog/p/mechine-learning-basics/</guid><description>&lt;h1 id="æœºå™¨å­¦ä¹ ">æœºå™¨å­¦ä¹ &lt;/h1>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/machinelearning.png"
width="887"
height="316"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/machinelearning_hu13b17d6db5217e228d729d78505e197d_53854_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/machinelearning_hu13b17d6db5217e228d729d78505e197d_53854_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="machinelearning"
class="gallery-image"
data-flex-grow="280"
data-flex-basis="673px"
>&lt;/p>
&lt;h2 id="åŸºæœ¬æœ¯è¯­">åŸºæœ¬æœ¯è¯­&lt;/h2>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_table.png"
width="497"
height="282"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_table_hu260d85a8756d54afc32312bc0e6db2f3_34466_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_table_hu260d85a8756d54afc32312bc0e6db2f3_34466_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_table"
class="gallery-image"
data-flex-grow="176"
data-flex-basis="422px"
>&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºè¡¨æ ¼ï¼Œæ˜¯é¸¢å°¾èŠ±ï¼ˆlrisï¼‰ç›¸å…³ä¿¡æ¯çš„æ•°æ®ï¼Œå…¶ä¸­ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°æ®æ•´ä½“ç§°ä¸ºæ•°æ®é›†ï¼ˆdata setï¼‰&lt;/li>
&lt;li>æ¯ä¸€è¡Œæ•°æ®ç§°ä¸ºä¸€ä¸ªæ ·æœ¬ï¼ˆsampleï¼‰&lt;/li>
&lt;li>æ¯ä¸€åˆ—ï¼ˆé™¤è¡¨æ ¼æœ€åŽä¸€åˆ—ï¼‰è¡¨è¾¾æ ·æœ¬çš„ä¸€ä¸ªç‰¹å¾ï¼ˆfeatureï¼‰&lt;/li>
&lt;li>æœ€åŽä¸€åˆ—ï¼Œæˆä¸ºæ ‡è®°ï¼ˆlabelï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature.png"
width="729"
height="277"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature_hueb1f2deb5cb4168dcc54624d0c16003a_37076_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature_hueb1f2deb5cb4168dcc54624d0c16003a_37076_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature"
class="gallery-image"
data-flex-grow="263"
data-flex-basis="631px"
>&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºä¿¡æ¯ï¼Œå…¶ä¸­ è¼ç‰‡é•¿åº¦ã€å®½åº¦ï¼ŒèŠ±ç“£çš„é•¿åº¦ã€å®½åº¦ç§°ä¸º ç‰¹å¾ï¼›æ¯ä¸€è¡Œç‰¹å¾çš„å€¼ç§°ä¸ºç‰¹å¾å‘é‡ï¼ˆæ•°å­¦ä¸Šé€šå¸¸ä¼šå°†å…¶è¡¨ç¤ºä¸ºåˆ—å‘é‡ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature2.png"
width="740"
height="267"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature2_hu711adcd4960fbcd7b6d08efae6dde377_37358_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature2_hu711adcd4960fbcd7b6d08efae6dde377_37358_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature2"
class="gallery-image"
data-flex-grow="277"
data-flex-basis="665px"
>&lt;/p>
&lt;p>è‹¥å°†è¯¥å›¾ä¸­çš„æ•°æ®è¡¨ç¤ºä¸ºçŸ©é˜µçš„æ–¹å¼ï¼Œç»“æžœå¦‚å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_array.png"
width="214"
height="248"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_array_hu72a83eec8e112bcbfe072659d9d3f18d_16930_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_array_hu72a83eec8e112bcbfe072659d9d3f18d_16930_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_array"
class="gallery-image"
data-flex-grow="86"
data-flex-basis="207px"
>&lt;/p>
&lt;p>é€‰æ‹©ä¸¤ç§é¸¢å°¾èŠ±çš„ç‰¹å¾ä¸ºä¾‹ï¼Œå°†å…¶è¡¨ç¤ºä¸ºå¦‚å›¾çš„äºŒç»´ç©ºé—´ï¼ˆå¤šç»´ç‰¹å¾å°†å…¶è¡¨ç¤ºä¸ºå¤šç»´ç©ºé—´ï¼‰ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å°†è¿™æ ·çš„ç©ºé—´ç§°ä¸º ç‰¹å¾ç©ºé—´ï¼ˆfeature spaceï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature_space.png"
width="519"
height="361"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature_space_hu3ac3a516a704dd018abbe59f3e7cdabc_44237_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature_space_hu3ac3a516a704dd018abbe59f3e7cdabc_44237_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature_space"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="345px"
>&lt;/p>
&lt;p>åˆ†ç±»ä»»åŠ¡æœ¬è´¨å°±æ˜¯åœ¨ç‰¹å¾ç©ºé—´åˆ‡åˆ†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨ç‰¹å¾ç©ºé—´ä¸­ï¼Œå°†é¸¢å°¾èŠ±æ ¹æ®ä¸¤ç§ç‰¹å¾åˆ†ä¸ºäº†ä¸¤ç±»ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature_space2.png"
width="514"
height="396"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature_space2_hu50eafd2c36f314e6e36adfce0dde2c44_59204_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/lris_feature_space2_hu50eafd2c36f314e6e36adfce0dde2c44_59204_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature_space2"
class="gallery-image"
data-flex-grow="129"
data-flex-basis="311px"
>&lt;/p>
&lt;h2 id="æœºå™¨å­¦ä¹ çš„åŸºæœ¬ä»»åŠ¡">æœºå™¨å­¦ä¹ çš„åŸºæœ¬ä»»åŠ¡&lt;/h2>
&lt;p>æœºå™¨å­¦ä¹ çš„åŸºæœ¬ä»»åŠ¡åŸºæœ¬æœ‰ä¸¤ç±»ï¼Œåˆ†åˆ«ä¸ºï¼š&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>åˆ†ç±»&lt;/li>
&lt;li>å›žå½’&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="åˆ†ç±»ä»»åŠ¡">åˆ†ç±»ä»»åŠ¡&lt;/h3>
&lt;blockquote>
&lt;ul>
&lt;li>ä¸€äº›ç®—æ³•åªæ”¯æŒå®ŒæˆäºŒåˆ†ç±»çš„ä»»åŠ¡&lt;/li>
&lt;li>å¤šåˆ†ç±»çš„ä»»åŠ¡å¯ä»¥è½¬æ¢æˆäºŒåˆ†ç±»çš„ä»»åŠ¡&lt;/li>
&lt;li>ä¸€äº›ç®—æ³•å¤©ç„¶çš„æ”¯æŒå¤šåˆ†ç±»é—®é¢˜&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h4 id="äºŒåˆ†ç±»">äºŒåˆ†ç±»&lt;/h4>
&lt;p>äºŒåˆ†ç±»é—®é¢˜çš„å¸¸è§å®žä¾‹ï¼š&lt;/p>
&lt;ul>
&lt;li>åˆ¤æ–­é‚®ä»¶æ˜¯åžƒåœ¾é‚®ä»¶ï¼›ä¸æ˜¯åžƒåœ¾é‚®ä»¶&lt;/li>
&lt;li>åˆ¤æ–­å‘æ”¾ç»™å®¢æˆ·ä¿¡ç”¨å¡æœ‰é£Žé™©ï¼›æ— é£Žé™©&lt;/li>
&lt;li>åˆ¤æ–­ç—…æ‚£è‰¯æ€§è‚¿ç˜¤ï¼›æ¶æ€§è‚¿ç˜¤&lt;/li>
&lt;li>åˆ¤æ–­æŸæ”¯è‚¡ç¥¨æ¶¨ï¼›è·Œ&lt;/li>
&lt;/ul>
&lt;h4 id="å¤šåˆ†ç±»">å¤šåˆ†ç±»&lt;/h4>
&lt;p>å¤šåˆ†ç±»é—®é¢˜çš„å¸¸è§å®žä¾‹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°å­—è¯†åˆ«&lt;/li>
&lt;li>å›¾åƒè¯†åˆ«&lt;/li>
&lt;li>åˆ¤æ–­å‘æ”¾ç»™å®¢æˆ·ä¿¡ç”¨å¡çš„é£Žé™©è¯„çº§&lt;/li>
&lt;li>å›´æ£‹æ¸¸æˆç­‰&lt;/li>
&lt;li>è‡ªåŠ¨é©¾é©¶è¯†åˆ«&lt;/li>
&lt;/ul>
&lt;h4 id="å¤šæ ‡ç­¾åˆ†ç±»">å¤šæ ‡ç­¾åˆ†ç±»&lt;/h4>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œä¸ºå¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜çš„å¸¸è§å®žä¾‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/label_classification.png"
width="873"
height="383"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/label_classification_hud280503f45d6bb1349e14ec6a2810ad7_406716_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/label_classification_hud280503f45d6bb1349e14ec6a2810ad7_406716_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="label_classification"
class="gallery-image"
data-flex-grow="227"
data-flex-basis="547px"
>&lt;/p>
&lt;h3 id="å›žå½’ä»»åŠ¡">å›žå½’ä»»åŠ¡&lt;/h3>
&lt;p>å›žå½’é—®é¢˜çš„ç»“æžœä¸Žåˆ†ç±»é—®é¢˜çš„ç»“æžœä¸åŒï¼Œå›žå½’é—®é¢˜çš„ç»“æžœæ˜¯ä¸€ä¸ªè¿žç»­æ•°å­—çš„å€¼ï¼Œè€Œéžä¸€ä¸ªç±»åˆ«ã€‚&lt;/p>
&lt;p>å¸¸è§çš„å›žå½’é—®é¢˜æœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>æˆ¿å±‹ä»·æ ¼&lt;/li>
&lt;li>å¸‚åœºåˆ†æž&lt;/li>
&lt;li>å­¦æœ¯æˆç»©&lt;/li>
&lt;li>è‚¡ç¥¨ä»·æ ¼&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œå›žå½’ä»»åŠ¡å¯ä»¥ç®€åŒ–æˆåˆ†ç±»ä»»åŠ¡ã€‚&lt;/p>
&lt;h2 id="æœºå™¨å­¦ä¹ ç®—æ³•åˆ†ç±»">æœºå™¨å­¦ä¹ ç®—æ³•åˆ†ç±»&lt;/h2>
&lt;h3 id="ç›‘ç£å­¦ä¹ ">ç›‘ç£å­¦ä¹ &lt;/h3>
&lt;p>ç›‘ç£å­¦ä¹  &lt;code>supervised learning&lt;/code> ä¸»è¦å¤„ç†çš„æ˜¯åˆ†ç±»é—®é¢˜å’Œå›žå½’é—®é¢˜ã€‚&lt;/p>
&lt;p>ç›‘ç£å­¦ä¹ çš„å«ä¹‰æ˜¯ç»™æœºå™¨çš„è®­ç»ƒæ•°æ®ä¸­æ‹¥æœ‰â€œæ ‡è®°â€æˆ–è€…â€œç­”æ¡ˆâ€ã€‚æ ¹æ®è¿™äº›æ•°æ®è¿›è¡Œæ¨¡åž‹çš„è®­ç»ƒã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/supervised_learning.png"
width="871"
height="313"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/supervised_learning_huf7d45c74be41f0f4fbb77506581979b3_52561_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/supervised_learning_huf7d45c74be41f0f4fbb77506581979b3_52561_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="supervised_learning"
class="gallery-image"
data-flex-grow="278"
data-flex-basis="667px"
>&lt;/p>
&lt;ul>
&lt;li>å¦‚æ ¹æ®å›¾ç‰‡åˆ¤æ–­çŒ«ç‹—ï¼ˆå›¾åƒå·²ç»æ‹¥æœ‰äº†æ ‡å®šä¿¡æ¯ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/supervised_learning_2.png"
width="738"
height="291"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/supervised_learning_2_hu2b9853d4704d9cf5e3f903309b997aeb_170020_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/supervised_learning_2_hu2b9853d4704d9cf5e3f903309b997aeb_170020_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="supervised_learning_2"
class="gallery-image"
data-flex-grow="253"
data-flex-basis="608px"
>&lt;/p>
&lt;ul>
&lt;li>å¦‚æ›´å…·æ‰‹å†™å­—ä½“è¯†åˆ«æ•°å­—ï¼ˆç»™å‡ºç»“æžœæ ‡è®°ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/supervised_learning_3.png"
width="707"
height="408"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/supervised_learning_3_hub5f7e5166008572d41af8d4590a4d11f_201016_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/supervised_learning_3_hub5f7e5166008572d41af8d4590a4d11f_201016_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="supervised_learning_3"
class="gallery-image"
data-flex-grow="173"
data-flex-basis="415px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é“¶è¡Œå·²ç»ç§¯ç´¯äº†ä¸€å®šçš„å®¢æˆ·ä¿¡æ¯å’Œä»–ä»¬ä¿¡ç”¨å¡çš„ä¿¡ç”¨æƒ…å†µ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŒ»é™¢å·²ç»ç§¯ç´¯äº†ä¸€å®šçš„ç—…äººä¿¡æ¯å’Œä»–ä»¬æœ€ç»ˆç¡®è¯Šæ˜¯å¦æ‚£ç—…çš„æƒ…å†µã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å¸¸è§çš„ç›‘ç£å­¦ä¹ ç®—æ³•æœ‰ï¼š&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>kè¿‘é‚»&lt;/li>
&lt;li>çº¿æ€§å›žå½’å’Œå¤šé¡¹å¼å›žå½’&lt;/li>
&lt;li>é€»è¾‘å›žå½’&lt;/li>
&lt;li>SVM&lt;/li>
&lt;li>å†³ç­–æ ‘å’Œéšæœºæ£®æž—&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="éžç›‘ç£å­¦ä¹ ">éžç›‘ç£å­¦ä¹ &lt;/h3>
&lt;p>éžç›‘ç£å­¦ä¹  &lt;code>unsupervised learning&lt;/code> ç»™æœºå™¨çš„è®­ç»ƒæ•°æ®æ²¡æœ‰ä»»ä½•â€œæ ‡è®°â€æˆ–è€…â€œç­”æ¡ˆâ€ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning.png"
width="431"
height="320"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning_hu23cfcedd7d7c0433075d3be27fb1b699_35769_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning_hu23cfcedd7d7c0433075d3be27fb1b699_35769_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;p>å¯¹æ²¡æœ‰â€œæ ‡è®°â€çš„æ•°æ®è¿›è¡Œåˆ†ç±» &amp;ndash; èšç±»åˆ†æžã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning_2.png"
width="529"
height="305"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning_2_hua6076421e113c36653c61737a036f410_62650_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning_2_hua6076421e113c36653c61737a036f410_62650_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning_2"
class="gallery-image"
data-flex-grow="173"
data-flex-basis="416px"
>&lt;/p>
&lt;h4 id="æ„ä¹‰">æ„ä¹‰&lt;/h4>
&lt;h5 id="å¯¹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†">å¯¹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†&lt;/h5>
&lt;ul>
&lt;li>ç‰¹å¾æå–ï¼šè¡Œç”¨å¡çš„ä¿¡ç”¨è¯„çº§å’Œäººçš„èƒ–ç˜¦æ— å…³ï¼Ÿ&lt;/li>
&lt;li>ç‰¹å¾åŽ‹ç¼©ï¼šPCA&lt;/li>
&lt;/ul>
&lt;p>é™ç»´å¤„ç†çš„æ„ä¹‰ï¼šæ–¹ä¾¿å¯è§†åŒ–&lt;/p>
&lt;p>æˆ‘ä»¬æ— æ³•ç†è§£å››ç»´ä»¥ä¸Šç©ºé—´ï¼Œæ‰€ä»¥å¯ä»¥å°†å…¶é™ç»´åˆ°ä¸‰ç»´æˆ–è€…äºŒç»´ç©ºé—´ï¼Œæ–¹ä¾¿ç†è§£ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning_3.png"
width="441"
height="308"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning_3_hu38269c3322bdeea39e5dc5fabf9129df_91476_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning_3_hu38269c3322bdeea39e5dc5fabf9129df_91476_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning_3"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="343px"
>&lt;/p>
&lt;h5 id="å¼‚å¸¸æ£€æµ‹">å¼‚å¸¸æ£€æµ‹&lt;/h5>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning_4.png"
width="658"
height="343"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning_4_hu1a0363349b68a744dcaab61af015c7ec_76718_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/unsupervised_learning_4_hu1a0363349b68a744dcaab61af015c7ec_76718_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning_4"
class="gallery-image"
data-flex-grow="191"
data-flex-basis="460px"
>&lt;/p>
&lt;h3 id="åŠç›‘ç£å­¦ä¹ ">åŠç›‘ç£å­¦ä¹ &lt;/h3>
&lt;p>&lt;code>semi-supervised learning&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸€éƒ¨åˆ†æ•°æ®æœ‰â€œæ ‡è®°â€æˆ–è€…ç­”æ¡ˆï¼Œå¦ä¸€éƒ¨åˆ†æ•°æ®æ²¡æœ‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¸¸è§çš„åœºæ™¯ï¼šå„ç§åŽŸå› äº§ç”Ÿçš„æ ‡è®°ç¼ºå¤±ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æˆ‘ä»¬é€šå¸¸éƒ½å…ˆä½¿ç”¨æ— ç›‘ç£å­¦ä¹ æ‰‹æ®µå¯¹æ•°æ®åšå¤„ç†ï¼Œä¹‹åŽä½¿ç”¨ç›‘ç£å­¦ä¹ æ‰‹æ®µåšæ¨¡åž‹çš„è®­ç»ƒå’Œé¢„æµ‹ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å¢žå¼ºå­¦ä¹ ">å¢žå¼ºå­¦ä¹ &lt;/h3>
&lt;p>æ ¹æ®å‘¨å›´çŽ¯å¢ƒçš„æƒ…å†µï¼Œé‡‡å–è¡ŒåŠ¨ï¼Œæ ¹æ®é‡‡å–è¡ŒåŠ¨çš„ç»“æžœï¼Œå­¦ä¹ è¡ŒåŠ¨æ–¹å¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/reinforcement_learning.png"
width="734"
height="290"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/reinforcement_learning_hu54ff37564e23648f6ad43f62f0917611_39669_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/reinforcement_learning_hu54ff37564e23648f6ad43f62f0917611_39669_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="reinforcement_learning"
class="gallery-image"
data-flex-grow="253"
data-flex-basis="607px"
>&lt;/p>
&lt;ul>
&lt;li>æ— äººé©¾é©¶&lt;/li>
&lt;li>æœºå™¨äºº&lt;/li>
&lt;/ul>
&lt;p>åœ¨å¢žå¼ºå­¦ä¹ ä¸­ï¼Œç›‘ç£å­¦ä¹ å’ŒåŠç›‘ç£å­¦ä¹ æ˜¯åŸºç¡€ã€‚&lt;/p>
&lt;h2 id="æœºå™¨å­¦ä¹ çš„å…¶ä»–åˆ†ç±»">æœºå™¨å­¦ä¹ çš„å…¶ä»–åˆ†ç±»&lt;/h2>
&lt;h3 id="åœ¨çº¿å­¦ä¹ å’Œæ‰¹é‡å­¦ä¹ ">åœ¨çº¿å­¦ä¹ å’Œæ‰¹é‡å­¦ä¹ &lt;/h3>
&lt;h4 id="åœ¨çº¿å­¦ä¹ ">åœ¨çº¿å­¦ä¹ &lt;/h4>
&lt;p>&lt;code>Online Learning&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/online_learning.png"
width="881"
height="356"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/online_learning_hufd2519c1c5cf57144a0949d734813375_60298_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/online_learning_hufd2519c1c5cf57144a0949d734813375_60298_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="online_learning"
class="gallery-image"
data-flex-grow="247"
data-flex-basis="593px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¼˜ç‚¹ï¼šåŠæ—¶åæ˜ æ–°çš„çŽ¯å¢ƒå˜åŒ–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é—®é¢˜ï¼šæ–°çš„æ•°æ®å¯èƒ½å¸¦æ¥ä¸å¥½çš„å˜åŒ–ï¼Œé”™è¯¯çš„æ•°æ®å¯èƒ½å¸¦æ¥é”™è¯¯çš„ç»“æžœ&lt;/p>
&lt;ul>
&lt;li>è§£å†³æ–¹æ¡ˆï¼šéœ€è¦åŠ å¼ºå¯¹æ•°æ®çš„ç›‘æŽ§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ä¹Ÿé€‚ç”¨äºŽæ•°æ®é‡å·¨å¤§ï¼Œå®Œå…¨æ— æ³•æ‰¹é‡å­¦ä¹ çš„çŽ¯å¢ƒ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="æ‰¹é‡å­¦ä¹ ç¦»çº¿å­¦ä¹ ">æ‰¹é‡å­¦ä¹ ï¼ˆç¦»çº¿å­¦ä¹ ï¼‰&lt;/h4>
&lt;p>&lt;code>Batch Learning / Offline Learning&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/batch_learning.png"
width="887"
height="316"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/batch_learning_hu13b17d6db5217e228d729d78505e197d_53854_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/batch_learning_hu13b17d6db5217e228d729d78505e197d_53854_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="batch_learning"
class="gallery-image"
data-flex-grow="280"
data-flex-basis="673px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¼˜ç‚¹ï¼šç®€å•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é—®é¢˜ï¼šè¦è€ƒè™‘å¦‚å¦‚ä½•é€‚åº”çŽ¯å¢ƒå˜åŒ–&lt;/p>
&lt;ul>
&lt;li>è§£å†³æ–¹æ¡ˆï¼šå®šæ—¶é‡æ–°æ‰¹é‡å­¦ä¹ &lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç¼ºç‚¹ï¼šæ¯æ¬¡é‡æ–°æ‰¹é‡å­¦ä¹ ï¼Œè¿è¡Œé‡å·¨å¤§ã€‚åœ¨æŸäº›çŽ¯å¢ƒå˜åŒ–éžå¸¸å¿«çš„æƒ…å†µä¸‹ï¼Œç”šè‡³æ˜¯ä¸å¯èƒ½çš„ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å‚æ•°å­¦ä¹ å’Œéžå‚æ•°å­¦ä¹ ">å‚æ•°å­¦ä¹ å’Œéžå‚æ•°å­¦ä¹ &lt;/h3>
&lt;h4 id="å‚æ•°å­¦ä¹ ">å‚æ•°å­¦ä¹ &lt;/h4>
&lt;p>&lt;code>Parametric Learning&lt;/code>&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œä¸ºæˆ¿å±‹é¢ç§¯ä¸Žä»·æ ¼çš„å…³ç³»æ›²çº¿ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/parametric_learning.png"
width="729"
height="405"
srcset="https://emerywan.github.io/blog/blog/p/mechine-learning-basics/parametric_learning_hu2c1f09a65fb7d83b5cf239a816caf4d4_38988_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/mechine-learning-basics/parametric_learning_hu2c1f09a65fb7d83b5cf239a816caf4d4_38988_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="parametric_learning"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="432px"
>&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼šä¸€æ—¦å­¦ä¹ åˆ°äº†å‚æ•°ï¼Œå°±ä¸éœ€è¦åŽŸæœ‰çš„æ•°æ®é›†ã€‚&lt;/p>
&lt;h4 id="éžå‚æ•°å­¦ä¹ ">éžå‚æ•°å­¦ä¹ &lt;/h4>
&lt;p>&lt;code>Nonparametric Learning&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸å¯¹æ¨¡åž‹è¿›è¡Œè¿‡å¤šå‡è®¾&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éžå‚æ•°ä¸ç­‰äºŽæ²¡æœ‰å‚æ•°ï¼Œè€Œæ˜¯å¯¹æ•´ä¸ªä¸è¿›è¡Œå»ºæ¨¡ï¼Œä¸å­¦ä¹ ä¸€äº›å‚æ•°&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Spring Cloud Hystrix æœåŠ¡å®¹é”™</title><link>https://emerywan.github.io/blog/p/spring-cloud-hystrix/</link><pubDate>Wed, 29 Jul 2020 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/spring-cloud-hystrix/</guid><description>&lt;h1 id="spring-cloud-hystrix">Spring Cloud Hystrix&lt;/h1>
&lt;p>åœ¨å¾®æœåŠ¡æž¶æž„ä¸­ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿæ‹†åˆ†æˆäº†ä¸€ä¸ªä¸ªçš„æœåŠ¡å•å…ƒï¼Œå„å•å…ƒåº”ç”¨é—´é€šè¿‡æœåŠ¡æ³¨å†Œä¸Žè®¢é˜…çš„æ–¹å¼äº’ç›¸ä¾èµ–ã€‚ç”±äºŽæ¯ä¸ªå•å…ƒéƒ½åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­è¿è¡Œï¼Œå¦‚æžœæŸä¸ªæœåŠ¡ä¸å¯ç”¨ï¼Œå¯èƒ½å¯¼è‡´çº§è”æ•…éšœï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨çš„æƒ…å†µï¼ˆé›ªå´©æ•ˆåº”ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œäº§ç”Ÿäº†æ–­è·¯å™¨ç­‰ä¸€ç³»åˆ—çš„æœåŠ¡ä¿æŠ¤æœºåˆ¶ã€‚&lt;/p>
&lt;h1 id="ç®€ä»‹">ç®€ä»‹&lt;/h1>
&lt;p>Spring Cloud Hystrixï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºŽ Netflix çš„å¼€æºæ¡†æž¶ï¼Œå…·æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>æœåŠ¡é™çº§&lt;/li>
&lt;li>ä¾èµ–éš”ç¦»&lt;/li>
&lt;li>æœåŠ¡ç†”æ–­&lt;/li>
&lt;li>ç›‘æŽ§ï¼ˆHystrix Dashboardï¼‰&lt;/li>
&lt;/ul>
&lt;h1 id="å®žçŽ°ä¸€ä¸ª-hystrix-server">å®žçŽ°ä¸€ä¸ª Hystrix Server&lt;/h1>
&lt;h2 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-netflix-hystrix&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ·»åŠ æ³¨è§£">æ·»åŠ æ³¨è§£&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableCircuitBreaker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">HystrixApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">HystrixApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hystrix-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="hystrix-åº”ç”¨">Hystrix åº”ç”¨&lt;/h1>
&lt;h2 id="æœåŠ¡é™çº§">æœåŠ¡é™çº§&lt;/h2>
&lt;p>å‡è®¾çŽ°åœ¨æœ‰ä¸€ä¸ªæŽ¥å£ &lt;code>/user/{id}&lt;/code> èŽ·å–ç”¨æˆ·ä¿¡æ¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@PathVariable&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">userService&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ UserService ä¸­æ·»åŠ è°ƒç”¨æ–¹æ³•çš„æœåŠ¡é™çº§ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@HystrixCommand&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">fallbackMethod&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;userFallback&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ­£å¸¸çš„æœåŠ¡è°ƒç”¨å’Œä¸šåŠ¡ æ­¤å¤„ä»¥ restTemplate ä¸ºä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">url&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/user/{1}&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">userFallback&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å¤„ç†æœåŠ¡é™çº§éœ€è¦è¿”å›žçš„å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æœåŠ¡é™çº§-openfiegn">æœåŠ¡é™çº§ OpenFiegn&lt;/h2>
&lt;h3 id="é…ç½®æ–‡ä»¶-1">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">feign&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hystrix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="openfeign-client-ç«¯å®žçŽ°">OpenFeign Client ç«¯å®žçŽ°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@FeignClient&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;user&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// è¿œç¨‹æœåŠ¡å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">fallback&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">UserClientFallback&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span> &lt;span class="c1">// æŒ‡å®š å½“æœåŠ¡é™çº§æ—¶ï¼Œé‡‡ç”¨çš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">UserClient&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/user/{id}&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@PathVariable&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å®žçŽ° UserClient æŽ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">UserClientFallback&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">UserClient&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@PathVariable&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å®žçŽ°é™çº§å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ä¾èµ–éš”ç¦»">ä¾èµ–éš”ç¦»&lt;/h2>
&lt;p>SpringCloud Hystrix çš„ ä¾èµ–éš”ç¦» ç±»ä¼¼äºŽdockerçš„â€œèˆ±å£æ¨¡å¼â€ã€‚
dockeré€šè¿‡â€èˆ±å£æ¨¡å¼â€å®žçŽ°è¿›ç¨‹éš”ç¦»ï¼Œä½¿å¾—å®¹å™¨ä¹‹é—´äº’ä¸å½±å“ã€‚
è€ŒHystrixä½¿ç”¨è¯¥æ¨¡å¼å®žçŽ°ï¼šâ€œçº¿ç¨‹æ± éš”ç¦»â€ï¼Œä¼šä¸ºæ¯ä¸€ä¸ªHystrixCommandåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹æ± ï¼Œè¿™æ ·å°±ç®—æŸä¸ªåœ¨HystrixåŒ…è£…ä¸‹çš„ä¾èµ–æœåŠ¡å‡ºçŽ°å»¶è¿Ÿè¿‡é«˜æƒ…å†µï¼Œä¹Ÿåªæ˜¯å¯¹è¯¥ä¾èµ–æœåŠ¡çš„è°ƒç”¨äº§ç”Ÿå½±å“ï¼Œå¹¶ä¸ä¼šæ‹–æ…¢å…¶ä»–æœåŠ¡ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ @HystrixCommand æ¥å°†æŸä¸ªå‡½æ•°åŒ…è£…æˆäº† Hystrix å‘½ä»¤æ—¶ï¼ŒHystrixæ¡†æž¶è‡ªåŠ¨åœ°ä¸ºè¿™ä¸ªå‡½æ•°å®žçŽ°äº†ä¾èµ–éš”ç¦»ã€‚æ‰€ä»¥ä¾èµ–éš”ç¦»ï¼ŒæœåŠ¡é™çº§åœ¨ä½¿ç”¨æ—¶å€™éƒ½æ˜¯ä¸€ä½“åŒ–å®žçŽ°çš„ï¼Œè¿™æ ·å°±å¯ä»¥å®žçŽ°æœåŠ¡å®¹é”™ä¿æŠ¤ã€‚åœ¨ç¼–ç¨‹æ¨¡åž‹ä¸Šå°±ä¼šéžå¸¸æ–¹ä¾¿ã€‚&lt;/p>
&lt;h2 id="æœåŠ¡ç†”æ–­">æœåŠ¡ç†”æ–­&lt;/h2></description></item><item><title>Spring Cloud Zuul æœåŠ¡ç½‘å…³</title><link>https://emerywan.github.io/blog/p/spring-cloud-zuul/</link><pubDate>Tue, 28 Jul 2020 15:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/spring-cloud-zuul/</guid><description>&lt;h1 id="spring-cloud-zuul">Spring Cloud Zuul&lt;/h1>
&lt;p>åœ¨å¾®æœåŠ¡æž¶æž„ä¸­ï¼ŒåŽç«¯æœåŠ¡å¾€å¾€ä¸ç›´æŽ¥å¼€æ”¾ç»™è°ƒç”¨ç«¯ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªAPIç½‘å…³æ ¹æ®è¯·æ±‚çš„urlï¼Œè·¯ç”±åˆ°ç›¸åº”çš„æœåŠ¡ã€‚
å½“æ·»åŠ APIç½‘å…³åŽï¼Œåœ¨ç¬¬ä¸‰æ–¹è°ƒç”¨ç«¯å’ŒæœåŠ¡æä¾›æ–¹ä¹‹é—´å°±åˆ›å»ºäº†ä¸€é¢å¢™ï¼Œè¿™é¢å¢™ç›´æŽ¥ä¸Žè°ƒç”¨æ–¹é€šä¿¡è¿›è¡Œæƒé™æŽ§åˆ¶ï¼ŒåŽå°†è¯·æ±‚å‡è¡¡åˆ†å‘ç»™åŽå°æœåŠ¡ç«¯ã€‚
Spring Cloud Zuul æ˜¯ä¸€ä¸ªåŸºäºŽJVMè·¯ç”±å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæä¾›åŠ¨æ€è·¯ç”±ï¼Œç›‘æŽ§ï¼Œå¼¹æ€§ï¼Œå®‰å…¨ç­‰çš„è¾¹ç¼˜æœåŠ¡ã€‚&lt;/p>
&lt;h1 id="ç®€ä»‹">ç®€ä»‹&lt;/h1>
&lt;p>Zuul çš„ä¸»è¦åŠŸèƒ½æ˜¯è·¯ç”±è½¬å‘å’Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰ã€‚ä¸åŒç±»åž‹çš„ Filter ç”¨äºŽå¤„ç†è¯·æ±‚ï¼Œå¯ä»¥å®žçŽ°ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>æƒé™æŽ§åˆ¶å’Œå®‰å…¨æ€§ï¼šå¯ä»¥è¯†åˆ«è®¤è¯éœ€è¦çš„ä¿¡æ¯å’Œæ‹’ç»ä¸æ»¡è¶³æ¡ä»¶çš„è¯·æ±‚&lt;/li>
&lt;li>ç›‘æŽ§ï¼šç›‘æŽ§è¯·æ±‚ä¿¡æ¯&lt;/li>
&lt;li>åŠ¨æ€è·¯ç”±ï¼šæ ¹æ®éœ€è¦åŠ¨æ€åœ°è·¯ç”±è¯·æ±‚åˆ°åŽå°çš„ä¸åŒæœåŠ¡é›†ç¾¤&lt;/li>
&lt;li>åŽ‹åŠ›æµ‹è¯•ï¼šé€æ¸å¢žå¤§åˆ°é›†ç¾¤çš„æµé‡ï¼Œä»¥ä¾¿è¿›è¡Œæ€§èƒ½è¯„ä¼°&lt;/li>
&lt;li>è´Ÿè½½å‡è¡¡ï¼šä¸ºæ¯ç§ç±»åž‹çš„è¯·æ±‚åˆ†é…å®¹é‡å¹¶ä¸¢å¼ƒè¶…è¿‡é™é¢çš„è¯·æ±‚&lt;/li>
&lt;li>é™æµ&lt;/li>
&lt;li>é»‘ç™½åå•è¿‡æ»¤&lt;/li>
&lt;li>é™æ€èµ„æºå¤„ç†ï¼šç›´æŽ¥åœ¨zuulå¤„ç†é™æ€èµ„æºçš„å“åº”è€Œä¸éœ€è¦è½¬å‘è¿™äº›è¯·æ±‚åˆ°å†…éƒ¨é›†ç¾¤ä¸­&lt;/li>
&lt;/ul>
&lt;h1 id="åŸºç¡€ä½¿ç”¨">åŸºç¡€ä½¿ç”¨&lt;/h1>
&lt;h2 id="åˆ›å»ºä¸€ä¸ª-api-gateway">åˆ›å»ºä¸€ä¸ª api-gateway&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-zuul&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ·»åŠ æ³¨è§£">æ·»åŠ æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableZuulProxy&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ApiGatewayApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ApiGatewayApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">api-gateway&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">9000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># è‡ªå®šä¹‰è·¯ç”±è§„åˆ™&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">routes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">user&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/user/**&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">user &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æµ‹è¯•">æµ‹è¯•&lt;/h3>
&lt;p>é€šè¿‡ä»¥ä¸Šé…ç½®æ–‡ä»¶é…ç½®ï¼Œå³å¯é€šè¿‡ api-gateway æœåŠ¡åŽ»è¯·æ±‚ user æœåŠ¡ã€‚&lt;/p>
&lt;p>å‡è®¾ user æœåŠ¡çš„ç«¯å£ä¸º 8080ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª api ä¸º &lt;code>/info&lt;/code>ã€‚
é€šè¿‡è®¿é—® &lt;code>http://localhost:9000/user/info&lt;/code>ï¼Œå³å¯è®¿é—®è¯¥ apiã€‚ï¼ˆè‹¥åŽŸæŽ¥å£åŒ…å«è·¯ç”±å‰ç¼€ /userï¼Œéœ€è¦ä½¿ç”¨ /user/user/info è®¿é—®ï¼‰&lt;/p>
&lt;h2 id="å¸¸ç”¨åŠŸèƒ½">å¸¸ç”¨åŠŸèƒ½&lt;/h2>
&lt;h3 id="ç»Ÿä¸€å‰ç¼€">ç»Ÿä¸€å‰ç¼€&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">prefix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/proxy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="header-è¿‡æ»¤åŠé‡å®šå‘æ·»åŠ -host">Header è¿‡æ»¤åŠé‡å®šå‘æ·»åŠ  Host&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># é»˜è®¤ä¸ºè¯¥é…ç½®ï¼Œä¼šè¿‡æ»¤ Cookie Set-Cookie Authorization ä¿¡æ¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># è®¾ç½®ä¸ºç©ºå³ä¸ä¼šè¿‡æ»¤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sensitive-headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cookie,Set-Cookie,Authorization&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">add-host-header&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># é‡å®šå‘ä¼šæ·»åŠ  host è¯·æ±‚å¤´&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æŸ¥çœ‹è·¯ç”±ä¿¡æ¯">æŸ¥çœ‹è·¯ç”±ä¿¡æ¯&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–-1">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.boot&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-boot-starter-actuator&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶-1">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">9000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">management&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">endpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exposure&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;routes&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è®¿é—®æŽ¥å£">è®¿é—®æŽ¥å£&lt;/h3>
&lt;ul>
&lt;li>è®¿é—® &lt;code>http://localhost:9000/actuator/routes&lt;/code> èŽ·å–ä¿¡æ¯&lt;/li>
&lt;li>è®¿é—® &lt;code>http://localhost:9000/actuator/routes/details&lt;/code> èŽ·å–è¯¦ç»†ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;h1 id="zuul-åº”ç”¨">Zuul åº”ç”¨&lt;/h1>
&lt;h2 id="zuul-filter">Zuul Filter&lt;/h2>
&lt;p>Filteræ˜¯Zuulçš„æ ¸å¿ƒï¼Œç”¨æ¥å®žçŽ°å¯¹å¤–æœåŠ¡çš„æŽ§åˆ¶ã€‚Filteræœ‰4ä¸ªç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;ul>
&lt;li>pre
&lt;ul>
&lt;li>åœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡å‰æ‰§è¡Œã€‚&lt;/li>
&lt;li>æ¯”å¦‚æƒé™æ ¡éªŒã€æ‰“å°æ—¥å¿—ç­‰åŠŸèƒ½ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>routing
&lt;ul>
&lt;li>åœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡æ—¶æ‰§è¡Œã€‚&lt;/li>
&lt;li>ç”¨äºŽæž„å»ºå‘é€ç»™å¾®æœåŠ¡çš„è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ Apache HttpClient æˆ– Netfilx Ribbon è¯·æ±‚å¾®æœåŠ¡ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>post
&lt;ul>
&lt;li>è¿™ç§è¿‡æ»¤å™¨åœ¨è·¯ç”±åˆ°å¾®æœåŠ¡ä»¥åŽæ‰§è¡Œã€‚&lt;/li>
&lt;li>ä¸ºå“åº”æ·»åŠ æ ‡å‡†çš„HTTP Headerã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯å’ŒæŒ‡æ ‡ã€å°†å“åº”ä»Žå¾®æœåŠ¡å‘é€ç»™å®¢æˆ·ç«¯ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>error
&lt;ul>
&lt;li>å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œè¯¥è¿‡æ»¤å™¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/spring-cloud-zuul/zuul-core.png"
width="921"
height="566"
srcset="https://emerywan.github.io/blog/blog/p/spring-cloud-zuul/zuul-core_hu334c91cd99c88cb1ff369a39dfc29056_46538_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/spring-cloud-zuul/zuul-core_hu334c91cd99c88cb1ff369a39dfc29056_46538_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="zuul-core"
class="gallery-image"
data-flex-grow="162"
data-flex-basis="390px"
>&lt;/p>
&lt;h3 id="è‡ªå®šä¹‰-filter">è‡ªå®šä¹‰ Filter&lt;/h3>
&lt;p>å®žçŽ°è‡ªå®šä¹‰ Filterï¼Œéœ€ç»§æ‰¿ &lt;code>com.netflix.zuul.ZuulFilter&lt;/code>ï¼Œå¹¶è¦†ç›–ç»§æ‰¿çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">MyFilter&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">ZuulFilter&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="nf">filterType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å®šä¹‰filterçš„ç±»åž‹ï¼Œpreã€routeã€postã€error
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="nf">filterOrder&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å®šä¹‰filterçš„é¡ºåºï¼Œæ•°å­—è¶Šå°è¡¨ç¤ºé¡ºåºè¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">shouldFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ˜¯å¦éœ€è¦æ‰§è¡Œè¯¥filterï¼Œtrueè¡¨ç¤ºæ‰§è¡Œï¼Œfalseè¡¨ç¤ºä¸æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// filteréœ€è¦æ‰§è¡Œçš„å…·ä½“æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="zuul-é™æµ">Zuul é™æµ&lt;/h3>
&lt;p>é™æµåœ¨å‰ç½®è¿‡æ»¤å™¨ï¼ˆpreï¼‰å‰ä½¿ç”¨ï¼Œåœ¨è¯·æ±‚è¢«è½¬å‘å‰è°ƒç”¨ï¼Œä¸”ä¼˜å…ˆçº§æœ€é«˜ã€‚&lt;/p>
&lt;p>ä»¤ç‰Œæ¡¶é™æµç¤ºä¾‹ã€‚ä»¤ç‰Œæ¡¶ç®—æ³•èƒ½å¤Ÿåœ¨é™åˆ¶æ•°æ®çš„å¹³å‡ä¼ è¾“é€ŸçŽ‡çš„åŒæ—¶è¿˜å…è®¸æŸç§ç¨‹åº¦çš„çªå‘ä¼ è¾“ã€‚&lt;/p>
&lt;p>ä»¤ç‰Œæ¡¶ç®—æ³•ä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿåº¦å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼Œè€Œå¦‚æžœè¯·æ±‚éœ€è¦è¢«å¤„ç†ï¼Œåˆ™éœ€è¦å…ˆä»Žæ¡¶é‡ŒèŽ·å–ä¸€ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œå¯å–æ—¶ï¼Œåˆ™æ‹’ç»æœåŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/spring-cloud-zuul/token-bucket.png"
width="595"
height="428"
srcset="https://emerywan.github.io/blog/blog/p/spring-cloud-zuul/token-bucket_hu1695d7ffe20c41b60543bc6e8b7c644d_101106_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/spring-cloud-zuul/token-bucket_hu1695d7ffe20c41b60543bc6e8b7c644d_101106_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="token-bucket"
class="gallery-image"
data-flex-grow="139"
data-flex-basis="333px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">org.springframework.cloud.netflix.zuul.filters.support.FilterConstants&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RateLimiterFilter&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">ZuulFilter&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç›´æŽ¥ä½¿ç”¨ guava ä¸­çš„ RateLimiter å®žçŽ°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">RateLimiter&lt;/span> &lt;span class="n">RATE_LIMITER&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RateLimiter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">100&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">filterType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">FilterConstants&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PRE_TYPE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">filterOrder&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é™æµæ˜¯æœ€é«˜ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥æ¯”æœ€é«˜ä¼˜å…ˆçº§ -3 è¿˜è¦å°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">FilterConstants&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SERVLET_DETECTION_FILTER_ORDER&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">shouldFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">ZuulException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æžœæ²¡æœ‰æ‹¿åˆ°ä»¤ç‰Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">RATE_LIMITER&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">tryAcquire&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RuntimeException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="zuul-é‰´æƒ">Zuul é‰´æƒ&lt;/h3>
&lt;p>åœ¨è¯·æ±‚æœåŠ¡å‰ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æƒé™è®¿é—®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">TokenFilter&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">ZuulFilter&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">filterType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">FilterConstants&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PRE_TYPE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">filterOrder&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è¶Šå°è¶Šé å‰ï¼Œæ”¾åœ¨ PRE_DECORATION_FILTER_ORDER ä¹‹å‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">PRE_DECORATION_FILTER_ORDER&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">shouldFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// éœ€è¦å®šä¹‰çš„é€»è¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">ZuulException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RequestContext&lt;/span> &lt;span class="n">requestContext&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RequestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCurrentContext&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">HttpServletRequest&lt;/span> &lt;span class="n">request&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">requestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getRequest&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// éœ€è¦æ ¹æ®å®žé™…æƒ…å†µï¼Œä»Ž header / cookie ä¸­èŽ·å–ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">token&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">...;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ ¹æ®å®žé™…æƒ…å†µè¿›è¡Œæ ¡éªŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(...)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é¦–å…ˆè®¾ç½® zuul
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">requestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setSendZuulResponse&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è®¾ç½®è¿”å›žä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">requestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setResponseStatusCode&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">HttpStatus&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">UNAUTHORIZED&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="zuul-è·¨åŸŸ">Zuul è·¨åŸŸ&lt;/h2>
&lt;p>åœ¨æµè§ˆå™¨ä¸­çš„ ajax è¯·æ±‚æ˜¯æœ‰åŒæºç­–ç•¥çš„ï¼Œå¦‚æžœè¿åäº†åŒæºç­–ç•¥ï¼Œå°±ä¼šæœ‰è·¨åŸŸé—®é¢˜ã€‚åœ¨ Zuul ä¸­æ·»åŠ  CorsFilter è¿‡æ»¤å™¨ï¼Œæ˜¯è·¨åŸŸé—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">CorsConfig&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">CorsFilter&lt;/span> &lt;span class="nf">corsFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">UrlBaseCorsConfigurationSource&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">UrlBaseCorsConfigrationSOurce&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">CorsConfiguration&lt;/span> &lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CorsConfiguration&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowCredentials&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowedOrigins&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singletonList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowedHeaders&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singletonList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span>&lt;span class="err">ï¼›&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowedMethods&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singletonList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setMaxAge&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">300L&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">registerCorsConfiguration&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/**&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CorsFilter&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Spring Cloud Config ç»Ÿä¸€é…ç½®ä¸­å¿ƒ</title><link>https://emerywan.github.io/blog/p/spring-cloud-config/</link><pubDate>Mon, 27 Jul 2020 12:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/spring-cloud-config/</guid><description>&lt;h1 id="spring-cloud-config">Spring Cloud Config&lt;/h1>
&lt;p>Spring Cloud Config æ˜¯ä¸€ä¸ªè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ç®¡ç†æ–¹æ¡ˆã€‚&lt;/p>
&lt;ul>
&lt;li>Server
&lt;ul>
&lt;li>æä¾›é…ç½®æ–‡ä»¶çš„å­˜å‚¨ï¼Œä»¥æŽ¥å£çš„å½¢å¼æä¾›é…ç½®æ–‡ä»¶çš„å†…å®¹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Client
&lt;ul>
&lt;li>é€šè¿‡æŽ¥å£èŽ·å–æ•°æ®ï¼Œå¹¶ä¾æ®æ­¤æ•°æ®åˆå§‹åŒ–åº”ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="config-server">Config Server&lt;/h1>
&lt;h2 id="æ–°å»ºä¸€ä¸ª-git-ä»“åº“">æ–°å»ºä¸€ä¸ª git ä»“åº“&lt;/h2>
&lt;p>åœ¨ git æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œç”¨æ¥å­˜æ”¾é…ç½®æ–‡ä»¶ã€‚&lt;/p>
&lt;p>å¹¶åœ¨ä»“åº“ä¸­æ·»åŠ ç›¸åº”çš„é…ç½®æ–‡ä»¶ã€‚&lt;/p>
&lt;ul>
&lt;li>user-dev.yml&lt;/li>
&lt;li>user-test.yml&lt;/li>
&lt;li>user-prod.yml&lt;/li>
&lt;/ul>
&lt;h2 id="å…·ä½“å®žçŽ°">å…·ä½“å®žçŽ°&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-config-server&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ·»åŠ æ³¨è§£">æ·»åŠ æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableConfigServer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ConfigApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConfigApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">config&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">git&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://github.com/xxx/confg &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># é…ç½®æ–‡ä»¶ä»“åº“åœ°å€&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">username&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">password&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">searchpath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">config-repo &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># gitä»“åº“åœ°å€ä¸‹çš„ç›¸å¯¹åœ°å€ï¼Œå¯é…ç½®å¤šä¸ª&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é€šè¿‡æŽ¥å£æŸ¥çœ‹é…ç½®">é€šè¿‡æŽ¥å£æŸ¥çœ‹é…ç½®&lt;/h3>
&lt;p>ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ä¼šè¢«è½¬æ¢æˆwebæŽ¥å£ï¼Œå¯åŠ¨åº”ç”¨åŽï¼Œå¯åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼ˆè‹¥é…ç½®æ–‡ä»¶çš„æ ¼å¼æœ‰é”™è¯¯ï¼Œå°†æ— æ³•è®¿é—®ï¼‰ã€‚&lt;/p>
&lt;p>å¦‚è®¿é—® &lt;code>http://localhost:8000/user/dev&lt;/code> å³å¯è¿”å›ž user-dev.yml çš„é…ç½®ä¿¡æ¯ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>/{application}/{profile}[/{label}]&lt;/code>&lt;/li>
&lt;li>&lt;code>/{application}-{profile}.yml&lt;/code>&lt;/li>
&lt;li>&lt;code>/{label}/{application}-{profile}.yml&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>profileï¼šé…ç½®çŽ¯å¢ƒï¼Œlabelï¼šä»“åº“åˆ†æ”¯ã€‚&lt;/p>
&lt;h1 id="config-client">Config Client&lt;/h1>
&lt;h2 id="åœ¨é¡¹ç›®ä¸­åˆ›å»º-bootstrapyml">åœ¨é¡¹ç›®ä¸­åˆ›å»º bootstrap.yml&lt;/h2>
&lt;p>åœ¨é¡¹ç›®ä¸­ï¼Œbootstrap.yml ä¼šä¼˜å…ˆäºŽ application.yml åŠ è½½ã€‚&lt;/p>
&lt;h3 id="applicationyml-åº”ç”¨åœºæ™¯">application.yml åº”ç”¨åœºæ™¯&lt;/h3>
&lt;p>ä¸»è¦ç”¨äºŽ Spring Boot é¡¹ç›®çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚&lt;/p>
&lt;h3 id="bootstrapyml-åº”ç”¨åœºæ™¯">bootstrap.yml åº”ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ä»Žé¢å¤–çš„èµ„æºåŠ è½½é…ç½®ä¿¡æ¯ï¼ˆå¦‚ä½¿ç”¨ Spring Cloud Config æ—¶ï¼‰&lt;/li>
&lt;li>ä¸€äº›å›ºå®šä¸èƒ½è¢«è¦†ç›–çš„å±žæ€§ï¼ˆå…·æœ‰é«˜ä¼˜å…ˆçº§ï¼Œä¸€èˆ¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®æˆ–applicationä¸­åŒåé…ç½®è¦†ç›–ï¼‰&lt;/li>
&lt;li>ä¸€äº› åŠ å¯†/è§£å¯† çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;h2 id="å…·ä½“å®žçŽ°-1">å…·ä½“å®žçŽ°&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–-1">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-config&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶-1">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">user &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># è¯¥åº”ç”¨èŽ·å–ä¹‹å‰é…ç½®å¥½çš„ user-dev.yml &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8000/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">profile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">master&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">discovery&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å¯ç”¨æœåŠ¡å‘çŽ° (Eureka)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">config &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># spring cloud config server åº”ç”¨åç§°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">profile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">master&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å¯åŠ¨æœåŠ¡">å¯åŠ¨æœåŠ¡&lt;/h3>
&lt;p>å¯åŠ¨æœåŠ¡æ—¶ï¼Œå³ä¼šå…ˆåŽ» git ä»“åº“èŽ·å–é…ç½®ä¿¡æ¯ã€‚&lt;/p>
&lt;h1 id="é…ç½®ä¿¡æ¯è‡ªåŠ¨æ›´æ–°">é…ç½®ä¿¡æ¯è‡ªåŠ¨æ›´æ–°&lt;/h1>
&lt;p>å½“ git ä»“åº“ä¸­çš„é…ç½®ä¿¡æ¯æ›´æ–°åŽï¼Œä½¿ç”¨é…ç½®çš„å®¢æˆ·ç«¯å¹¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°é…ç½®ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€äº›æœºåˆ¶åŽ»è§¦å‘é…ç½®çš„æ›´æ–°ã€‚&lt;/p>
&lt;h2 id="actuator">actuator&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–-2">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.boot&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-boot-starter-actuator&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ·»åŠ æ³¨è§£æ‰“å¼€æ›´æ–°æœºåˆ¶">æ·»åŠ æ³¨è§£ï¼Œæ‰“å¼€æ›´æ–°æœºåˆ¶&lt;/h3>
&lt;p>é€šè¿‡åœ¨éœ€è¦åŠ è½½æ›´æ–°é…ç½®çš„ç±»ä¸Šæ·»åŠ  &lt;code>@RefreshScope&lt;/code>ï¼Œå½“å®¢æˆ·ç«¯é€šè¿‡è§¦å‘ POST æ–¹å¼çš„ &lt;code>/refresh&lt;/code> æ—¶ï¼Œä¼šè‡ªåŠ¨å°†æ–°çš„é…ç½®æ›´æ–°åˆ°ç›¸åº”çš„å­—æ®µä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RefreshScope&lt;/span> &lt;span class="c1">// è¯¥ç±»ä¸­é…ç½®ç›¸å…³ä¼šè‡ªåŠ¨åˆ·æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ActuatorController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Value&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;${env}&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@RequestMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/env&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">env&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">env&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶-2">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># server ç«¯æ·»åŠ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">management&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">endpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exposure&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># client ç«¯æ·»åŠ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">management&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">endpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exposure&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">refresh&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æµ‹è¯•è‡ªåŠ¨åˆ·æ–°">æµ‹è¯•è‡ªåŠ¨åˆ·æ–°&lt;/h3>
&lt;p>å½“ git ä»“åº“ä¸­é…ç½®æ–‡ä»¶æ›´æ–°åŽï¼Œé€šè¿‡å‘é€ POST è¯·æ±‚åˆ° &lt;code>/refresh&lt;/code> åŽï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨èŽ·å–æœ€æ–°é…ç½®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl -v -X POST http://localhost:8080/actuator/refresh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="spring-cloud-bus-æŽ¨è">Spring Cloud Bus ï¼ˆæŽ¨èï¼‰&lt;/h2>
&lt;p>é€šè¿‡ spring cloud busï¼Œé€šè¿‡ POST è¯·æ±‚ &lt;code>/bus-refresh&lt;/code>ï¼Œå®žçŽ°è‡ªåŠ¨èŽ·å–æœ€æ–°é…ç½®ã€‚&lt;/p>
&lt;p>è‡³æ­¤ä¸¤ç§æ¶ˆæ¯ä»£ç†ï¼š&lt;/p>
&lt;ul>
&lt;li>RabbitMQ&lt;/li>
&lt;li>Kafka&lt;/li>
&lt;/ul>
&lt;h2 id="webhook">WebHook&lt;/h2>
&lt;p>WebHook æ˜¯å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé€šè¿‡å‘é€ http post è¯·æ±‚çš„æ–¹å¼æ¥é€šçŸ¥ä¿¡æ¯æŽ¥æ”¶æ–¹ã€‚&lt;/p>
&lt;p>é€šè¿‡åˆ›å»º WebHook å³å¯è‡ªåŠ¨è§¦å‘ POST è¯·æ±‚ï¼Œè®©å®¢æˆ·ç«¯åŠ¨æ€åˆ·æ–°é…ç½®ã€‚&lt;/p></description></item><item><title>Spring Cloud æœåŠ¡é€šä¿¡</title><link>https://emerywan.github.io/blog/p/spring-cloud-openfeign/</link><pubDate>Sun, 26 Jul 2020 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/spring-cloud-openfeign/</guid><description>&lt;h1 id="spring-cloud-æœåŠ¡é€šä¿¡">Spring Cloud æœåŠ¡é€šä¿¡&lt;/h1>
&lt;ul>
&lt;li>
&lt;p>åŒæ­¥é€šä¿¡ï¼š&lt;/p>
&lt;ul>
&lt;li>dobbo é€šè¿‡ RPC è¿œç¨‹è°ƒç”¨ã€‚&lt;/li>
&lt;li>spring cloud é€šè¿‡ REST æŽ¥å£è°ƒç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å¼‚æ­¥é€šä¿¡ï¼š&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡æ¶ˆæ¯å¯¹åˆ—ï¼Œå¦‚ï¼šRabbitMQï¼ŒKafkaï¼ŒActiveM ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>æœ¬æ–‡ä¸»è¦ä»‹ç» Spring Cloud ä½¿ç”¨ RestTemplate / OpenFeign è¿›è¡Œ REST æŽ¥å£è°ƒç”¨ã€‚&lt;/p>
&lt;h1 id="resttemplate">RestTemplate&lt;/h1>
&lt;h2 id="é€šè¿‡-resttemplate-è¿›è¡Œè°ƒç”¨">é€šè¿‡ RestTemplate è¿›è¡Œè°ƒç”¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="nf">getProductMsg&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="n">restTemplate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RestTemplate&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="n">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;http://example.com/product/info&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// è¿œç¨‹è°ƒç”¨åœ°å€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">ProductInfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// response ç±»åž‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="c1">// éœ€è¦ä¼ é€’çš„å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ©ç”¨-loadbalancerclient-èŽ·å–ä¿¡æ¯">åˆ©ç”¨ LoadBalancerClient èŽ·å–ä¿¡æ¯&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="n">LoadBalancerClient&lt;/span> &lt;span class="n">loadBalancerClient&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="nf">getProductMsg&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="n">restTemplate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RestTemplate&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ServiceInstance&lt;/span> &lt;span class="n">serviceInstance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loadBalancerClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">choose&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;PRODUCT&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ©ç”¨ loadBalancerClient é€šè¿‡åº”ç”¨åï¼ˆspring.application.nameï¼‰èŽ·å–ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">format&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;http://%s:%s&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">serviceInstance&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getHost&lt;/span>&lt;span class="o">(),&lt;/span> &lt;span class="n">serviceInstance&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getPort&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/product/info&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="n">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">ProductInfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ©ç”¨-loadbalance-åœ¨-resttemplate-ä¸­ç›´æŽ¥ä½¿ç”¨åº”ç”¨åç§°">åˆ©ç”¨ LoadBalance åœ¨ RestTemplate ä¸­ç›´æŽ¥ä½¿ç”¨åº”ç”¨åç§°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">RestTemplateConfig&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@LoadBalance&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="nf">restTemplate&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RestTemplate&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="nf">getProductMsg&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ©ç”¨ @LoadBalance å¯ä»¥åœ¨ RestTemplate ä¸­ä½¿ç”¨åº”ç”¨åç§°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="n">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;http://PRODUCT/product/msg&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">ProductInfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="openfeign-æŽ¨è">OpenFeign ï¼ˆæŽ¨èï¼‰&lt;/h1>
&lt;h2 id="å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-openfeign&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ·»åŠ å¯åŠ¨æ³¨è§£">æ·»åŠ å¯åŠ¨æ³¨è§£&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">org.springframework.cloud.openfeign.EnableFeignClients&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableFeignClients&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">FeignApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">FeignApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å…·ä½“å®žçŽ°">å…·ä½“å®žçŽ°&lt;/h2>
&lt;p>çŽ°åœ¨æœ‰ä¸¤ä¸ªæœåŠ¡ï¼Œåˆ†åˆ«ä¸º Prodcut å’Œ Order ã€‚
éœ€æ±‚ï¼š Order æœåŠ¡ä¸­ï¼Œå®¢æˆ·è¿›è¡Œäº†ä¸‹å•æ“ä½œåŽï¼Œè°ƒç”¨ Productï¼ˆFeignï¼‰ çš„è¿›è¡Œå‡åº“å­˜æ“ä½œã€‚&lt;/p>
&lt;ul>
&lt;li>Product æœåŠ¡ä¸­ï¼Œå®šä¹‰è¿œç¨‹è°ƒç”¨ç«¯ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">DecreaseStockInput&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@FeignClient&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;product&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// name: è¿œç¨‹æœåŠ¡å(Spring.application.name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">ProductClient&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@RequestMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/product/decrease_stock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">decreaseStock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@RequestBody&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">DecreaseStockInput&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">decreaseStockInputList&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Order æœåŠ¡ä¸­ï¼Œå¯¹ Product Client è¿›è¡Œè°ƒç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">OrderServiceImpl&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">OrderService&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ³¨å…¥çš„ä¸º Product ä¸­çš„ ProductClient
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// é€šè¿‡ä¾èµ–çš„æ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">ProductClient&lt;/span> &lt;span class="n">productClient&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">OrderDTO&lt;/span> &lt;span class="nf">create&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">OrderDTO&lt;/span> &lt;span class="n">orderDTO&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// è°ƒç”¨ Product æœåŠ¡ä¸­çš„ api è¿›è¡Œå‡åº“å­˜æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">productClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">decreaseStock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">decreaseStockInputList&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Spring Cloud Eureka æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°</title><link>https://emerywan.github.io/blog/p/spring-cloud-eureka/</link><pubDate>Sat, 25 Jul 2020 13:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/spring-cloud-eureka/</guid><description>&lt;h1 id="eureka-æ‰¾åˆ°å•¦">Eureka æ‰¾åˆ°å•¦ï¼&lt;/h1>
&lt;p>æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°&lt;/p>
&lt;h1 id="ç®€ä»‹">ç®€ä»‹&lt;/h1>
&lt;ul>
&lt;li>Spring Cloud å°è£…äº† Netflix å…¬å¸å¼€å‘çš„ Eureka æ¨¡å—æ¥å®žçŽ°æœåŠ¡æ³¨å†Œå’Œå‘çŽ°ã€‚é‡‡ç”¨äº† C-S çš„è®¾è®¡æž¶æž„ã€‚ç”¨æ¥ç®€åŒ–ä¸ŽæœåŠ¡å™¨çš„äº¤äº’ã€ä½œä¸ºè½®è¯¢è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶æä¾›æœåŠ¡çš„æ•…éšœåˆ‡æ¢æ”¯æŒã€‚&lt;/li>
&lt;li>ç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆã€‚
&lt;ul>
&lt;li>Ereka Serverã€‚ æ³¨å†Œä¸­å¿ƒ&lt;/li>
&lt;li>Ereka Clientã€‚ æœåŠ¡æ³¨å†Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>Eureka é‡‡ç”¨äº†&lt;strong>å®¢æˆ·ç«¯å‘çŽ°&lt;/strong>çš„æ–¹å¼ï¼Œåœ¨æœåŠ¡è¿è¡Œæ—¶ï¼Œé€šè¿‡(è½®è®­ã€hashç­‰è´Ÿè½½å‡è¡¡æœºåˆ¶ç­‰æ–¹å¼)æ³¨å†Œä¸­å¿ƒæ‰¾åˆ°éœ€è¦æœåŠ¡ï¼ˆå³ A é€šè¿‡ æ³¨å†Œä¸­å¿ƒ æ‰¾ Bï¼Œéœ€è¦è°æ‰¾è°ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-server-discovery.png"
width="1202"
height="571"
srcset="https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-server-discovery_huebe0236b66186033cdf1592e4bf67abe_104496_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-server-discovery_huebe0236b66186033cdf1592e4bf67abe_104496_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-server-discovery"
class="gallery-image"
data-flex-grow="210"
data-flex-basis="505px"
>&lt;/p>
&lt;h1 id="eureka-server">Eureka Server&lt;/h1>
&lt;p>æ³¨å†Œä¸­å¿ƒè®°å½•ç€æ‰€æœ‰åº”ç”¨çš„ä¿¡æ¯å’ŒçŠ¶æ€(å¦‚ï¼šåº”ç”¨åï¼Œæ‰€åœ¨æœåŠ¡å™¨ï¼Œæ˜¯å¦æ­£å¸¸å·¥ä½œ)ã€‚&lt;/p>
&lt;h2 id="å®žçŽ°ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ">å®žçŽ°ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ&lt;/h2>
&lt;h3 id="1-å¼•å…¥ä¾èµ–">1. å¼•å…¥ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-eureka-server&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-æ·»åŠ å¯åŠ¨æ³¨è§£">2. æ·»åŠ å¯åŠ¨æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableEurekaServer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">EurekaServerApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">EurekaServerApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-é…ç½®æ–‡ä»¶">3. é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverï¼Œä½œä¸º Server ç«¯ä¸éœ€è¦&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æ˜¯å¦ä»ŽEureka ServerèŽ·å–æ³¨å†Œä¿¡æ¯ï¼Œä½œä¸º Server ç«¯ä¸éœ€è¦&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æŽ¥æ”¶çš„æ˜¯ä¸€ä¸ª Map ç»“æž„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="4-å¯åŠ¨ç¨‹åº">4. å¯åŠ¨ç¨‹åº&lt;/h3>
&lt;p>å¯åŠ¨åŽï¼Œè®¿é—® http://localhost:8761/ï¼Œå³å¯çœ‹åˆ° Spring Eureka ç•Œé¢ã€‚&lt;/p>
&lt;h2 id="å®žçŽ°-eureka-é›†ç¾¤">å®žçŽ° Eureka é›†ç¾¤&lt;/h2>
&lt;p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯æœ€é‡è¦çš„åŸºç¡€éƒ¨åˆ†ï¼Œç†åº”éšæ—¶å¤„äºŽå¯ä»¥æä¾›æœåŠ¡çš„çŠ¶æ€ã€‚ä¸ºäº†ç»´æŒå…¶å¯ç”¨æ€§ï¼Œé€šå¸¸ä¼šé‡‡ç”¨é›†ç¾¤çš„æ–¹æ¡ˆã€‚Eurekaé€šè¿‡&lt;strong>äº’ç›¸æ³¨å†Œ&lt;/strong>çš„æ–¹å¼æ¥å®žçŽ°é«˜å¯ç”¨çš„éƒ¨ç½²&lt;/p>
&lt;h3 id="åŒèŠ‚ç‚¹æ³¨å†Œ">åŒèŠ‚ç‚¹æ³¨å†Œ&lt;/h3>
&lt;p>åˆ›å»ºä¸¤å°æœåŠ¡å™¨ï¼Œç«¯å£åˆ†åˆ«ä¸º 8761 å’Œ 8762ã€‚&lt;/p>
&lt;p>å°† 8761 çš„æœåŠ¡å™¨é…ç½®æŒ‡å‘ 8761ï¼Œå°† 8762 çš„æœåŠ¡å™¨æŒ‡å‘ 8761ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å°† service-url æŒ‡å‘ 8762&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8762/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8762&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å°† service-url æŒ‡å‘ 8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯åŠ¨ç¨‹åºåŽï¼Œé€šè¿‡ http://localhost:8761/ å’Œ http://localhost:8762/ éƒ½å¯è®¿é—® Eureka ç•Œé¢ã€‚å¹¶ä¸”å¯ä»¥çœ‹åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¿¡æ¯èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-server-cluster-1.png"
width="1849"
height="596"
srcset="https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-server-cluster-1_huba86fcdb4b5d0d0d30bd35cfb721e86e_55103_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-server-cluster-1_huba86fcdb4b5d0d0d30bd35cfb721e86e_55103_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-server-cluster-1"
class="gallery-image"
data-flex-grow="310"
data-flex-basis="744px"
>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-server-cluster-2.png"
width="1745"
height="582"
srcset="https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-server-cluster-2_hu2962bd37558dde85fe30af951e20dc3b_54772_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-server-cluster-2_hu2962bd37558dde85fe30af951e20dc3b_54772_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-server-cluster-2"
class="gallery-image"
data-flex-grow="299"
data-flex-basis="719px"
>&lt;/p>
&lt;h3 id="å¤šèŠ‚ç‚¹æ³¨å†Œ">å¤šèŠ‚ç‚¹æ³¨å†Œ&lt;/h3>
&lt;p>åœ¨ç”Ÿäº§ä¸­æˆ‘ä»¬éœ€è¦ä¸‰å°æˆ–è€…å¤§äºŽä¸‰å°çš„æ³¨å†Œä¸­å¿ƒæ¥ä¿è¯æœåŠ¡çš„ç¨³å®šæ€§ï¼Œé…ç½®çš„åŽŸç†å…¶å®žéƒ½ä¸€æ ·ï¼šå°†æ³¨å†Œä¸­å¿ƒåˆ†åˆ«æŒ‡å‘å…¶å®ƒçš„æ³¨å†Œä¸­å¿ƒã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8762/eureka/,http://localhost:8763/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8762&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/,http://localhost:8763/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8763&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/,http://localhost:8762/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="eureka-client">Eureka Client&lt;/h1>
&lt;h2 id="å®žçŽ°ä¸€ä¸ªæœåŠ¡æ³¨å†Œ">å®žçŽ°ä¸€ä¸ªæœåŠ¡æ³¨å†Œ&lt;/h2>
&lt;h3 id="1-ä¾èµ–é…ç½®">1. ä¾èµ–é…ç½®&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-eureka&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-æ·»åŠ å¯åŠ¨æ³¨è§£-1">2. æ·»åŠ å¯åŠ¨æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">org.springframework.cloud.netflix.eureka.server.EnableEurekaServer&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ClientApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ClientApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-é…ç½®æ–‡ä»¶-1">3. é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-client&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># instance: # è‡ªå®šä¹‰é“¾æŽ¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># hostname: example.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="4-å¯åŠ¨ç¨‹åº-1">4. å¯åŠ¨ç¨‹åº&lt;/h3>
&lt;p>å¯åŠ¨ç¨‹åºåŽï¼Œè¿›å…¥ Eureka é¡µé¢ http://localhost:8761/eureka/ï¼Œå³å¯çœ‹åˆ°æ³¨å†Œçš„æœåŠ¡ eureka-clientã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-client.png"
width="1888"
height="356"
srcset="https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-client_hu7c72d91007eb8a4a1109447929086548_37277_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/spring-cloud-eureka/eureka-client_hu7c72d91007eb8a4a1109447929086548_37277_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-client"
class="gallery-image"
data-flex-grow="530"
data-flex-basis="1272px"
>&lt;/p>
&lt;h1 id="æ€»ç»“">æ€»ç»“&lt;/h1>
&lt;ul>
&lt;li>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯æœ€é‡è¦çš„åŸºç¡€éƒ¨åˆ†&lt;/li>
&lt;li>@EnableEurekaServer @EnableEurekaClient&lt;/li>
&lt;li>å…·æœ‰ å¿ƒè·³æ£€æµ‹ï¼Œå¥åº·æ£€æŸ¥ï¼Œè´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½&lt;/li>
&lt;li>ä¸ºä¿è¯é«˜å¯ç”¨ï¼Œå»ºè®®é›†ç¾¤éƒ¨ç½²&lt;/li>
&lt;/ul></description></item><item><title>é›·è›‡ çµåˆƒ 15 æ ‡å‡†ç‰ˆ 2018 é»‘è‹¹æžœ</title><link>https://emerywan.github.io/blog/p/razer-blade-base-hackintosh/</link><pubDate>Thu, 27 Feb 2020 21:14:45 +0800</pubDate><guid>https://emerywan.github.io/blog/p/razer-blade-base-hackintosh/</guid><description>&lt;p>&lt;strong>è­¦å‘Šï¼šè¯¥æ•™ç¨‹ä»…ä¸ºä¸ªäººè®°å½•ï¼Œè¯¥ç¬”è®°æœ¬å®‰è£…æ¶‰åŠè§£é”BIOSï¼Œå­˜åœ¨ä¸€å®šé£Žé™©ï¼Œå¦‚æ‚¨ä½¿ç”¨è¯¥æ•™ç¨‹å¯¹è®¡ç®—æœºè¿›è¡Œæ›´æ”¹ï¼Œæ‰€é€ æˆçš„çš„ä»»ä½•åŽæžœæˆ‘æ¦‚ä¸è´Ÿè´£ã€‚&lt;/strong>&lt;/p>
&lt;h1 id="å†™åœ¨æœ€å‰">å†™åœ¨æœ€å‰&lt;/h1>
&lt;ul>
&lt;li>
&lt;p>å¼€å­¦åŽå¤ªå¿™ï¼Œå¹¶ä¸”ç”µè„‘æˆ‘æ¢äº†å—æ›´å¤§çš„ç¡¬ç›˜ï¼Œè¿™å°ç”µè„‘æˆ‘ä¸æ‰“ç®—å†å®‰è£…é»‘è‹¹æžœäº†ï¼Œæœ¬æ•™ç¨‹å¯èƒ½ä¼šä¸å†æ›´æ–°ï¼Œæœ€æ–°ä¸Šä¼ çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ äº†å¯¹ type-C 4K 30Hz çš„æ”¯æŒï¼Œ4K 60Hz æ˜¾ç¤ºå™¨ä¼šé»‘å±ï¼Œæ— æ³•è¾“å‡ºä¿¡å·ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æžœæƒ³è¦ä½¿ç”¨ Clover å®‰è£… 10.15 æˆ–ä»¥ä¸‹ç³»ç»Ÿçš„è¯ï¼Œå¯ä»¥ä¾æ—§æŒ‰ç…§æ­¤æ•™ç¨‹ï¼ˆè¯·å°† Clover å’Œ kext é€‰æ‹©åˆ°é€‚åº”ç‰ˆæœ¬ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æžœæ‰“ç®—å®‰è£…æ–°ç³»ç»Ÿä½¿ç”¨çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ Opencore å®‰è£…ã€‚æŽ¨èå‚è€ƒ &lt;a class="link" href="https://github.com/Tyson-Hu/RazerBlade15-Base-Model-Hackintosh_macOS_Monterey" target="_blank" rel="noopener"
>RazerBlade15-Base-Model-Hackintosh_macOS_Monterey&lt;/a>ï¼Œè¯¥æ•™ç¨‹å†™çš„éžå¸¸è¯¦ç»†ï¼Œæ„Ÿè°¢ä»–çš„ä»˜å‡ºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å»ºè®®ä¸è¦ä½¿ç”¨ ä¸œèŠï¼ˆé“ ä¾ ï¼‰çš„å›ºæ€ç¡¬ç›˜ï¼Œæˆ‘çš„ç¡¬ç›˜ä¸º&lt;strong>ä¸œèŠ tr200&lt;/strong>ï¼Œåœ¨ macOS ä¸­èŽ«åå¡é¡¿ï¼Œæˆ‘çš„&lt;strong>ä¸œèŠUç›˜&lt;/strong>åœ¨ macOS ä¸­ä¹ŸèŽ«åå¡é¡¿ï¼Œå…¶ä»–ç³»ç»Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ï¼ˆçŽ„å­¦é—®é¢˜ï¼Ÿï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¥ä½ çŽ©å¾—æ„‰å¿«ï¼&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/EmeryWan/Razer-Blade-15-2018-Base-Hackintosh" target="_blank" rel="noopener"
>Github âž¡ï¸&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å› ä¸ºç–«æƒ…åŽŸå› æ˜¥èŠ‚ä¸€ç›´å®…åœ¨å®¶ï¼Œå­¦æ ¡å‡æœŸä¹Ÿå»¶é•¿äº†ï¼Œæ‰¾åˆ°äº†åŒæ¬¾ç¬”è®°æœ¬çš„æ•™ç¨‹ï¼Œæ‰€ä»¥å…¥å‘å®‰è£…é»‘è‹¹æžœï¼Œæœ€è¿‘æŠŠæ­¥éª¤æ•´ç†äº†ä¸€ä¸‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®‰è£…è¿‡ç¨‹æˆ‘ä¸»è¦å‚è€ƒäº† &lt;a class="link" href="https://www.tonymacx86.com/threads/guide-razer-blade-15-2018-detailed-install-guide-high-sierra-10-13-6-17g2208-17g5019.264017/" target="_blank" rel="noopener"
>è¿™ç¯‡&lt;/a> å’Œ &lt;a class="link" href="https://github.com/stonevil/Razer_Blade_Advanced_early_2019_Hackintosh" target="_blank" rel="noopener"
>è¿™ç¯‡&lt;/a> æ•™ç¨‹ï¼Œæ„Ÿè°¢ä»–ä»¬çš„è¾›è‹¦ä»˜å‡ºã€‚éƒ¨åˆ†å†…å®¹ä¸ºä»–ä»¬æ‰€å†™æ•™ç¨‹çš„æ±‰åŒ–ï¼Œè¯¦ç»†æˆ–ç²¾ç®€ï¼Œæˆ‘çš„æ°´å¹³æœ‰é™ï¼ŒåˆšæŽ¥è§¦é»‘è‹¹æžœï¼Œå»ºè®®åŒæ—¶å‚è€ƒä»–ä»¬çš„æ•™ç¨‹ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>ç¡¬ä»¶ä»‹ç»&lt;/li>
&lt;li>ç»“æžœä»‹ç»&lt;/li>
&lt;li>è§£é”BIOS&lt;/li>
&lt;li>å®‰è£…å‰å‡†å¤‡&lt;/li>
&lt;li>ç³»ç»Ÿå®‰è£…&lt;/li>
&lt;li>DSDTï¼ŒSSDTåˆ¶ä½œ&lt;/li>
&lt;li>ç½‘å¡&lt;/li>
&lt;li>ä¸€äº›ä¼˜åŒ–&lt;/li>
&lt;li>å‚è€ƒ&lt;/li>
&lt;li>æ›´æ–°&lt;/li>
&lt;/ul>
&lt;h2 id="1-ç¡¬ä»¶ä»‹ç»">[1] ç¡¬ä»¶ä»‹ç»&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">&lt;/th>
&lt;th style="text-align:center">åž‹å·&lt;/th>
&lt;th style="text-align:center">æœ€ç»ˆæƒ…å†µ&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">CPU&lt;/td>
&lt;td style="text-align:center">i7-8750H&lt;/td>
&lt;td style="text-align:center">å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">GPU&lt;/td>
&lt;td style="text-align:center">Nvdia 1060 Max-Q&lt;/td>
&lt;td style="text-align:center">é™¤ 10.13 High Sierra å®‰è£… WebDriver å¤–ä¸å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">ç¡¬ç›˜&lt;/td>
&lt;td style="text-align:center">æ›´æ¢äº† é‡‘å£«é¡¿ A2000&lt;/td>
&lt;td style="text-align:center">å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">ç½‘å¡&lt;/td>
&lt;td style="text-align:center">9560NGW&lt;/td>
&lt;td style="text-align:center">WIFI ç›®å‰æ— è§£ï¼Œè“ç‰™å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">æ˜¾ç¤ºå™¨&lt;/td>
&lt;td style="text-align:center">1080P&lt;/td>
&lt;td style="text-align:center">å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">æ‘„åƒå¤´&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">æ‰¬å£°å™¨&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">è€³æœº&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">æ— æ³•æ£€æµ‹åˆ°éº¦å…‹é£Ž&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">éº¦å…‹é£Ž&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">ä¸å¯ç”¨ï¼Œå·²è¯†åˆ«ï¼Œä½†åœ¨è®¾ç½®ä¸­æœªçœ‹è§è¾“å…¥ç”µå¹³&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">è§¦æŽ§æ¿&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">æ‰‹åŠ¿å¯ç”¨ï¼ˆååº”ç¨æ…¢ï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">HDMI æŽ¥å£&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">ç›´é€šæ˜¾å¡ï¼Œé™¤å®‰è£… High Sierra å¤–ä¸å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Mini DP æŽ¥å£&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">ç›´é€šæ˜¾å¡ï¼Œé™¤å®‰è£… High Sierra å¤–ä¸å¯ç”¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">é›·ç”µ3&lt;/td>
&lt;td style="text-align:center">&lt;/td>
&lt;td style="text-align:center">è¢«è¯†åˆ«æˆ USB3.1ï¼Œå¯å¤–æŽ¥æ‹“å±•åžå¤–æŽ¥æ˜¾ç¤ºå™¨ï¼Œæˆ‘çš„ç”µè„‘ä¸­éœ€è¦åˆ é™¤SSDT-12-OptTabl.aml&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="2-å®‰è£…ç»“æžœ">[2] å®‰è£…ç»“æžœ&lt;/h2>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-1.png"
width="586"
height="353"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-1_hu2b7930256d93d7df669e002f0ee8a5ea_76515_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-1_hu2b7930256d93d7df669e002f0ee8a5ea_76515_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2-1"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="398px"
>&lt;/p>
&lt;h3 id="ä¸€äº›å°é—®é¢˜">ä¸€äº›å°é—®é¢˜&lt;/h3>
&lt;p>æˆ‘ä¹Ÿæ˜¯åˆšåˆšæŽ¥è§¦é»‘è‹¹æžœï¼Œå¾ˆå¤šé—®é¢˜æˆ‘ä¹Ÿæ— æ³•è§£å†³ï¼Œæœ‰è°äº†è§£çš„è¯å¸Œæœ›èƒ½å¸®åŠ©ä¸€ä¸‹ï¼Œæ„Ÿè°¢ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;del>éº¦å…‹é£Žæ— æ³•ä½¿ç”¨ï¼Œç³»ç»Ÿèƒ½æ‰¾åˆ°ä½†æ— æ³•ä½¿ç”¨ï¼Œè€³æœºéº¦å…‹é£Žæ— æ³•æ‰¾åˆ°ã€‚æƒ³è¦ä½¿ç”¨çš„è¯åªèƒ½é€šè¿‡è“ç‰™è€³æœºäº†ã€‚&lt;/del>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è€³æœºéº¦å…‹æ— æ³•è¯†åˆ«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¾“å‡ºè®¾å¤‡é»˜è®¤è¯†åˆ«åˆ°äº†æ‰¬å£°å™¨å’Œè€³æœºï¼ˆå³ä½¿æœªæ’å…¥è€³æœºï¼‰ï¼Œæ— æ³•è‡ªåŠ¨åˆ‡æ¢ï¼Œéœ€æ‰‹åŠ¨åˆ‡æ¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-2.png"
width="294"
height="170"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-2_hubc4478c282b951d1ef6fe2ce5f964b3d_36544_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-2_hubc4478c282b951d1ef6fe2ce5f964b3d_36544_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2-2"
class="gallery-image"
data-flex-grow="172"
data-flex-basis="415px"
>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ›´æ–°">æ›´æ–°&lt;/h3>
&lt;p>ä»Šå¤©æœ¬æ¥æƒ³æ ¹æ® &lt;a class="link" href="https://blog.daliansky.net/Use-AppleALC-sound-card-to-drive-the-correct-posture-of-AppleHDA.html" target="_blank" rel="noopener"
>è¿™ç¯‡æ–‡ç« &lt;/a> å°è¯•è‡ªå·±å®šåˆ¶ä¸€ä¸‹ &lt;code>AppleALC&lt;/code> ï¼Œå½“æˆ‘æŠŠæœ‰æ•ˆèŠ‚ç‚¹å’Œè·¯å¾„å¼„å®Œä¹‹åŽï¼Œå‡†å¤‡ä¸‹è½½ &lt;a class="link" href="https://github.com/acidanthera/AppleALC/releases" target="_blank" rel="noopener"
>AppleALC-DEBUG&lt;/a> ç¼–è¯‘çš„æ—¶å€™ï¼Œæ²¡æƒ³åˆ°æœ€æ–°ç‰ˆæœ¬å·²ç»æ·»åŠ äº†è¿™ä¸ªç¬”è®°æœ¬çš„ &lt;code>layout-id:23&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-3.png"
width="873"
height="546"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-3_huecb3588f2c0bb9ac90822e9e02e3e4ec_119856_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-3_huecb3588f2c0bb9ac90822e9e02e3e4ec_119856_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2-3"
class="gallery-image"
data-flex-grow="159"
data-flex-basis="383px"
>&lt;/p>
&lt;p>è¯·æŒ‰ç…§å¦‚å›¾ä¿®æ”¹ï¼Œä¿å­˜åŽé‡å¯ã€‚æˆ‘çš„ç”µè„‘è€³æœºéº¦å…‹é£Žæ— æ³•è¯†åˆ«ï¼ˆæˆ‘åœ¨ Ubuntu ä¸‹ä¹Ÿæ— æ³•æ‰¾åˆ°è€³æœºéº¦å…‹é£Žçš„æœ‰æ•ˆèŠ‚ç‚¹ä¿¡æ¯ï¼‰&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-4.png"
width="1279"
height="678"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-4_hud4d6f2c40445a0b958e52be6265bd97d_161259_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-4_hud4d6f2c40445a0b958e52be6265bd97d_161259_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2-4"
class="gallery-image"
data-flex-grow="188"
data-flex-basis="452px"
>&lt;/p>
&lt;p>æ·»åŠ  type-c è¾“å‡º 4kï¼Œåªèƒ½æ”¯æŒåˆ°æœ€é«˜ 30Hzï¼Œè¾“å‡º 60Hz ä¼šç›´æŽ¥é»‘å±ã€‚å¯ä»¥å®‰è£…ä¸€ä¸ª &lt;a class="link" href="https://github.com/avibrazil/RDM" target="_blank" rel="noopener"
>RDM&lt;/a> è¿›è¡Œç®¡ç†ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-5.png"
width="1316"
height="696"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-5_hu390d568d81002677c5e0774860cb2cfd_174773_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/2-5_hu390d568d81002677c5e0774860cb2cfd_174773_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2-5"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="453px"
>&lt;/p>
&lt;h2 id="3-è§£é”bios">[3] è§£é”BIOS&lt;/h2>
&lt;p>&lt;strong>è§£é”BIOSï¼Œå­˜åœ¨ä¸€å®šé£Žé™©ï¼Œå¦‚æ‚¨ä½¿ç”¨è¯¥æ•™ç¨‹å¯¹è®¡ç®—æœºè¿›è¡Œæ›´æ”¹ï¼Œæ‰€é€ æˆçš„çš„ä»»ä½•åŽæžœæˆ‘æ¦‚ä¸è´Ÿè´£ï¼ï¼ï¼&lt;/strong>&lt;/p>
&lt;p>é›·è›‡å›½å†…å®˜ç½‘æ²¡æœ‰æä¾›é©±åŠ¨å’ŒBIOSçš„ä¸‹è½½ï¼Œå¦‚æœ‰éœ€è¦ï¼Œéœ€è¦è®¿é—®ç¾Žå›½å®˜ç½‘ã€‚&lt;a class="link" href="https://support.razer.com/gaming-laptops/razer-blade-15-2018-base/" target="_blank" rel="noopener"
>ç‚¹æˆ‘ã€‚&lt;/a>&lt;/p>
&lt;p>è¯¥ç¬”è®°æœ¬ DVMT é¢„åˆ†é…é»˜è®¤ä¸º 32MBï¼Œä¸è¶³ä»¥å¯åŠ¨ MacOSï¼Œåœ¨ BIOS ä¸­è¯¥è®¾ç½®é¡¹é»˜è®¤éšè—ï¼Œæ‰€ä»¥è¦æå–æœ¬æœº BIOS å¹¶ä¸”è¿›è¡Œè§£é”ï¼Œå°† DVMT é¢„åˆ†é…é»˜è®¤è®¾ç½®ä¸º 64MBï¼ˆ1080Pï¼‰ï¼Œåˆ†è¾¨çŽ‡æ›´é«˜è¯·åˆ†é…æ›´å¤§ç©ºé—´ã€‚&lt;/p>
&lt;p>&lt;strong>å»ºè®®åœ¨ windows ä¸‹æ“ä½œã€‚&lt;/strong>&lt;/p>
&lt;h3 id="3-1-æå–æœ¬æœº-bios">[3-1] æå–æœ¬æœº BIOS&lt;/h3>
&lt;p>&lt;strong>æ³¨æ„å¤‡ä»½å¥½ã€‚&lt;/strong>&lt;/p>
&lt;p>æ‰“å¼€ &lt;code>AFUWINGUI.exe&lt;/code>ï¼Œç‚¹å‡» Save æŒ‰é’®ï¼Œå¯¼å‡ºæœ¬æœºå½“å‰ BIOS ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-1.png"
width="625"
height="463"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-1_hu2b3b289386be70a81cfc03a2fd4a6ba9_25755_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-1_hu2b3b289386be70a81cfc03a2fd4a6ba9_25755_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3-1"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;h3 id="3-2-ä¿®æ”¹-bios">[3-2] ä¿®æ”¹ BIOS&lt;/h3>
&lt;ul>
&lt;li>æ‰“å¼€ &lt;code>AMIBCP.exe&lt;/code> ï¼Œç‚¹å‡» File -&amp;gt; open æ‰“å¼€å¯¼å‡ºçš„ BIOSã€‚&lt;/li>
&lt;li>å¦‚å›¾ï¼Œåœ¨å·¦ä¾§é€‰æ‹© / -&amp;gt; Setup -&amp;gt; Chipsetï¼Œå°†å·¦ä¾§çš„ &lt;code>System Agent Configuration&lt;/code> çš„ Access ç”± Default ä¿®æ”¹ä¸º USER&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-2.png"
width="1073"
height="752"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-2_hu504742517ec89fe4fa26edd955452484_46678_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-2_hu504742517ec89fe4fa26edd955452484_46678_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3-2"
class="gallery-image"
data-flex-grow="142"
data-flex-basis="342px"
>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-3.png"
width="981"
height="234"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-3_hu384a5070e96805721cfad18ac4b9c8d8_22227_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-3_hu384a5070e96805721cfad18ac4b9c8d8_22227_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3-3"
class="gallery-image"
data-flex-grow="419"
data-flex-basis="1006px"
>&lt;/p>
&lt;ul>
&lt;li>ä¿®æ”¹å®ŒåŽç‚¹å‡» File -&amp;gt; Save asã€‚é‡å‘½åä¸ºæ–°çš„ BIOSã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="3-3-åˆ·å…¥æ–°-bios">[3-3] åˆ·å…¥æ–° BIOS&lt;/h3>
&lt;p>&lt;strong>ï¼ï¼ï¼ æ³¨æ„ï¼Œè¯¥è¿‡ç¨‹è™½ç„¶ç®€å•ï¼Œä½†æœ‰ä¸€å®šé£Žé™©ï¼Œé€ æˆçš„ä»»ä½•ç»“æžœä¸Žæœ¬äººæ— å…³ã€‚&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é‡æ–°æ‰“å¼€ AFUWINGUI.exeï¼Œç‚¹å‡» Open æ‰“å¼€åˆšåˆšä¿®æ”¹åŽçš„ BIOSã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-4.png"
width="625"
height="463"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-4_hu3d9923cc8e5f7434310ba01f6dc9c068_25929_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-4_hu3d9923cc8e5f7434310ba01f6dc9c068_25929_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3-4"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°½å¯èƒ½çš„é€€å‡ºå…¶ä»–ç¨‹åºï¼Œå°½é‡ä¿æŒåŽå°å¹²å‡€ï¼Œå†ç‚¹å‡» Flash åˆ·å…¥æ–°çš„ BIOSã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-5.png"
width="625"
height="463"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-5_hu3d9923cc8e5f7434310ba01f6dc9c068_27476_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/3-5_hu3d9923cc8e5f7434310ba01f6dc9c068_27476_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3-5"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;ul>
&lt;li>é‡å¯&lt;/li>
&lt;/ul>
&lt;h2 id="4-å®‰è£…å‰å‡†å¤‡">[4] å®‰è£…å‰å‡†å¤‡&lt;/h2>
&lt;h3 id="4-1-å‡†å¤‡macos-catalina-å®‰è£…ç›˜">[4-1] å‡†å¤‡macOS Catalina å®‰è£…ç›˜&lt;/h3>
&lt;p>æŽ¨èä½¿ç”¨&lt;a class="link" href="https://blog.daliansky.net/" target="_blank" rel="noopener"
>é»‘æžœå°å…µ&lt;/a>åˆ¶ä½œçš„é•œåƒï¼Œä½¿ç”¨ &lt;strong>TransMac&lt;/strong> åˆ¶ä½œï¼ˆè½¯ä»¶åœ¨æ–‡ä»¶å¤¹ä¸­å·²æä¾›ï¼‰ã€‚&lt;a class="link" href="https://blog.daliansky.net/macOS-Catalina-10.15.3-19D76-Release-version-with-Clover-5103-original-image-Double-EFI-Version.html" target="_blank" rel="noopener"
>è¿™é‡Œæ˜¯10.15.3çš„é•œåƒ&lt;/a>ã€‚&lt;/p>
&lt;p>å¦‚æžœæ‚¨è¦å®‰è£…æ›´æ–°çš„ç³»ç»Ÿï¼Œè¯·å‡çº§ CLOVERï¼Œå’Œ kexts/ åˆ°å¯¹åº”å…¼å®¹æˆ–æ›´æ–°çš„ç‰ˆæœ¬ï¼Œå¯å°†åˆ¶ä½œå¥½çš„å®‰è£…ç›˜ä¸­ &lt;code>EFI/CLOVER&lt;/code> çš„æ–‡ä»¶è¿›è¡ŒåŒåæ›¿æ¢ã€‚ï¼ˆæœªæ¥çš„æ–°ç‰ˆæœ¬å¯èƒ½ä¸å¯é¢„çŸ¥çš„é—®é¢˜ï¼Œè¯·é…Œæƒ…å‡çº§ï¼‰ã€‚&lt;/p>
&lt;h3 id="4-2-å¯åŠ¨ç›˜åˆ¶ä½œ">[4-2] å¯åŠ¨ç›˜åˆ¶ä½œ&lt;/h3>
&lt;p>è¯·å‚è€ƒï¼Œæˆ–è‡ªè¡Œæœç´¢ï¼Œç½‘ä¸Šæ•™ç¨‹å¾ˆå¤šã€‚&lt;a class="link" href="https://zhuanlan.zhihu.com/p/58630676" target="_blank" rel="noopener"
>ç‚¹æˆ‘ã€‚&lt;/a>&lt;/p>
&lt;h2 id="5-ç³»ç»Ÿå®‰è£…">[5] ç³»ç»Ÿå®‰è£…&lt;/h2>
&lt;h3 id="5-1-bios-è®¾ç½®">[5-1] BIOS è®¾ç½®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>Advanced&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>Thunderbolt(TM) Configuration&lt;/code>
&lt;ul>
&lt;li>&lt;code>Security Level&lt;/code> è®¾ç½®æˆ &lt;code>No Security&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Chipset&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>System Agent (SA) Configuration&lt;/code>
&lt;ul>
&lt;li>&lt;code>Graphics Configuration&lt;/code>
&lt;ul>
&lt;li>&lt;code>DVMT Pre-Allocated&lt;/code> è®¾ç½®æˆ &lt;code>64&lt;/code>&lt;/li>
&lt;li>&lt;code>DVMT Total Gfx Mem&lt;/code> è®¾ç½®æˆ &lt;code>MAX&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Security&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>Secure Boot&lt;/code> è®¾ç½®æˆ &lt;code>Disabled&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Boot&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>Fast Boot&lt;/code> è®¾ç½®æˆ &lt;code>Disabled&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>CSM Configuration&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>CSM Support&lt;/code> è®¾ç½®æˆ &lt;code>Disabled&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="5-2-å®‰è£…è¿‡ç¨‹">[5-2] å®‰è£…è¿‡ç¨‹&lt;/h3>
&lt;p>ç³»ç»Ÿå®‰è£…è¿‡ç¨‹å¤§è‡´ç›¸åŒï¼Œé€‰æ‹©Uç›˜å¯åŠ¨åŽè¿›å…¥å®‰è£…ã€‚å®‰è£…è¿‡ç¨‹ä¼šé‡å¯å‡ æ¬¡ã€‚&lt;/p>
&lt;p>å¯è‡ªè¡Œæœç´¢ï¼Œå‚è€ƒå…¶ä»–äººçš„æ­¥éª¤ã€‚&lt;/p>
&lt;h3 id="5-3-å®‰è£…æ—¶å¯èƒ½å‡ºçŽ°çš„é—®é¢˜">[5-3] å®‰è£…æ—¶å¯èƒ½å‡ºçŽ°çš„é—®é¢˜&lt;/h3>
&lt;p>æ˜¾ç¤ºç¨‹åºå‰¯æœ¬å·²æŸå&lt;/p>
&lt;ul>
&lt;li>æ–­ç½‘&lt;/li>
&lt;li>æ‰“å¼€ç»ˆç«¯&lt;/li>
&lt;li>ä¿®æ”¹æ—¶é—´ä¸ºç³»ç»Ÿå‘å¸ƒå¯¹åº”çš„æ—¶é—´ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚ä¿®æ”¹ä¸º 2019å¹´ã€‚è¾“å…¥ &lt;code>date 000000002019&lt;/code>ã€‚&lt;/p>
&lt;h2 id="6-dsdtssdtåˆ¶ä½œ">[6] DSDTï¼ŒSSDTåˆ¶ä½œ&lt;/h2>
&lt;p>é€šè¿‡ä¿®è¡¥DSDTï¼ŒSSDTé©±åŠ¨è§¦æŽ§æ¿ï¼ŒéŸ³é¢‘ï¼Œç”µæ± çŠ¶æ€ï¼Œäº®åº¦æŽ§åˆ¶ç­‰ã€‚&lt;/p>
&lt;h3 id="6-1-å‡†å¤‡ä¿®è¡¥">[6-1] å‡†å¤‡ä¿®è¡¥&lt;/h3>
&lt;p>[6-1-1]&lt;/p>
&lt;p>å¼€æœºåœ¨ Clover å¼•å¯¼ç•Œé¢ä¸­æŒ‰ &lt;code>F4&lt;/code>ï¼Œæ‰€éœ€æ–‡ä»¶ä¼šåŠ è½½åˆ° &lt;code>EFI/Clover/ACPI/origin&lt;/code> ä¸­ã€‚é€šè¿‡ Clover Configurator æŒ‚è½½å¯åŠ¨çš„ EFIï¼ˆé€šè¿‡Uç›˜å¯åŠ¨å°±æŒ‚è½½Uç›˜ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-1.png"
width="1279"
height="678"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-1_hu144b08cce4e790f431926a2da7d31c39_187647_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-1_hu144b08cce4e790f431926a2da7d31c39_187647_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-1"
class="gallery-image"
data-flex-grow="188"
data-flex-basis="452px"
>&lt;/p>
&lt;p>[6-1-2]&lt;/p>
&lt;p>å°† origin æ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ¡Œé¢ï¼ŒåŒæ—¶å°† &lt;code>iasl&lt;/code> è½¯ä»¶å¤åˆ¶åˆ°æ–‡ä»¶å¤¹ä¸­ã€‚&lt;/p>
&lt;p>[6-1-3]&lt;/p>
&lt;p>æ‰“å¼€ç»ˆç«¯&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ~/Desktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir patched
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./origin/iasl -da -dl DSDT.aml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[6-1-4]&lt;/p>
&lt;p>æ‰“å¼€ originï¼Œä½¿ç”¨ &lt;code>MaciASL&lt;/code> æ‰“å¼€ç”Ÿæˆçš„ &lt;strong>DSDT.dsl&lt;/strong> æ–‡ä»¶ã€‚ç‚¹å‡» Compileï¼Œç¡®ä¿æ²¡æœ‰é”™è¯¯ã€‚ï¼ˆé»˜è®¤åº”è¯¥æ²¡æœ‰ errorï¼Œä½†æœ‰å¾ˆå¤š warningï¼Œwarning ä¸å¿…å…³ç³»ï¼Œè‹¥æœ‰ error è¯·å°† error å¤„ä»£ç æ³¨é‡Šæˆ–åˆ é™¤ï¼‰&lt;/p>
&lt;p>[6-1-5]&lt;/p>
&lt;p>ç¡®ä¿æ²¡æœ‰ errors åŽï¼Œç‚¹å‡» Patchã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-2.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-2_hu66c83b6f1d65cd60613cc338a3dbc89f_356101_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-2_hu66c83b6f1d65cd60613cc338a3dbc89f_356101_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-2"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;h3 id="6-2-ä¿®å¤ç”µæ± ">[6-2] ä¿®å¤ç”µæ± &lt;/h3>
&lt;p>[1] åœ¨å¼¹çª—çš„å·¦ä¾§ç‚¹å‡» &lt;code>_RehabMan Laptop/[bat]Razer Blade (2014)&lt;/code> ï¼Œç­‰å¾…å³ä¾§è¿›è¡ŒåŒ¹é…åŽç‚¹å‡» Applyã€‚&lt;/p>
&lt;p>å¦‚æžœç½‘ç»œä¸å¥½çš„è¯å¯èƒ½æ— æ³•åŠ è½½ï¼ˆgithubï¼‰ï¼Œè¯·åˆ‡æ¢åˆ°åˆé€‚çš„ç½‘ç»œï¼Œæˆ–è®¿é—® &lt;a class="link" href="https://github.com/RehabMan/Laptop-DSDT-Patch/blob/master/battery/battery_Razer-Blade-2014.txt" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a>ï¼Œæˆ–å¤åˆ¶ä»¥ä¸‹ä»£ç ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-3.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-3_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_432072_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-3_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_432072_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-3"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">#Maintained by: RehabMan for: Laptop Patches
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#battery_Razer-Blade-2014.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># created by sidelia 2016-01-17
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># changes for Razer Blade Stealth (Kaby Lake) by BlenderSleuth (minor fixes by RehabMan)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># works for:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Razer Blade (2014)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Razer Blade Stealth (Kaby Lake), per BlenderSleuth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Razer Blade (14&amp;#34;, late 2016)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Razer Blade Pro (2017)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Razer Blade 15 (2018), per JomanJi/blodtanner
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label B1B2 remove_entry;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into definitionblock code_regex . insert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Method (B1B2, 2, NotSerialized) { Return(Or(Arg0, ShiftLeft(Arg1, 8))) }\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BIF1,\s+16, replace_matched begin IF10,8,IF11,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BIF2,\s+16, replace_matched begin IF20,8,IF21,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BIF3,\s+16, replace_matched begin IF30,8,IF31,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BIF4,\s+16, replace_matched begin IF40,8,IF41,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BST0,\s+16, replace_matched begin ST00,8,ST01,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BST1,\s+16, replace_matched begin ST10,8,ST11,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BST2,\s+16, replace_matched begin ST20,8,ST21,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BST3,\s+16, replace_matched begin ST30,8,ST31,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \^\^EC0\.BIF1, replaceall_matched begin B1B2(^^EC0.IF10,^^EC0.IF11), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \^\^EC0\.BIF2, replaceall_matched begin B1B2(^^EC0.IF20,^^EC0.IF21), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \^\^EC0\.BIF3, replaceall_matched begin B1B2(^^EC0.IF30,^^EC0.IF31), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \^\^EC0\.BIF4, replaceall_matched begin B1B2(^^EC0.IF40,^^EC0.IF41), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BST code_regex \^\^EC0\.BST0, replaceall_matched begin B1B2(^^EC0.ST00,^^EC0.ST01), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BST code_regex \^\^EC0\.BST1, replaceall_matched begin B1B2(^^EC0.ST10,^^EC0.ST11), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BST code_regex \^\^EC0\.BST2, replaceall_matched begin B1B2(^^EC0.ST20,^^EC0.ST21), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BST code_regex \^\^EC0\.BST3, replaceall_matched begin B1B2(^^EC0.ST30,^^EC0.ST31), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># added for Razer Blade 15 (2018), per JomanJi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex BIF0,\s+16, replace_matched begin IF00,8,IF01,8, end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \(\^\^EC0.BIF0, replaceall_matched begin (B1B2(\^\^EC0.IF00,\^\^EC0.IF01), end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># utility methods to read/write buffers from/to EC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label RE1B parent_label EC0 remove_entry;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label RECB parent_label EC0 remove_entry;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 insert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Method (RE1B, 1, NotSerialized)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> OperationRegion(ERAM, EmbeddedControl, Arg0, 1)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Field(ERAM, ByteAcc, NoLock, Preserve) { BYTE, 8 }\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Return(BYTE)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Method (RECB, 2, Serialized)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// Arg0 - offset in bytes from zero-based EC\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// Arg1 - size of buffer in bits\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ShiftRight(Add(Arg1,7), 3, Arg1)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name(TEMP, Buffer(Arg1) { })\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Add(Arg0, Arg1, Arg1)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Store(0, Local0)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> While (LLess(Arg0, Arg1))\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Store(RE1B(Arg0), Index(TEMP, Local0))\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Increment(Arg0)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Increment(Local0)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Return(TEMP)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># buffer fields
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into device label EC0 code_regex (ECCM,)\s+(256) replace_matched begin ECCX,%2,//%1%2 end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _BIF code_regex \(\^\^EC0.ECCM, replaceall_matched begin (^^EC0.RECB(0x60,256), end;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[2] ç‚¹å‡» Compileï¼Œç¡®ä¿æ²¡æœ‰é”™è¯¯ã€‚ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰ï¼Œä¸åŒç‰ˆæœ¬BIOSå¯èƒ½æƒ…å†µä¸åŒï¼‰ã€‚&lt;/p>
&lt;h3 id="6-4-ä¿®å¤é‡å¯ä¿å­˜èƒŒå…‰äº®åº¦">[6-4] ä¿®å¤é‡å¯ä¿å­˜èƒŒå…‰äº®åº¦&lt;/h3>
&lt;p>[6-4-1]&lt;/p>
&lt;p>åœ¨å·¦ä¾§èœå•æ å‘ä¸‹æ»‘åŠ¨ï¼Œæ‰¾åˆ° &lt;code>[gfx0] Disable/Enable on _WAK/_PTS (DSDT)&lt;/code>ï¼Œç‚¹å‡»éƒ½å•å‡» Applyã€‚&lt;/p>
&lt;p>ç½‘ç»œä¸å¥½å¯ç‚¹å‡» &lt;a class="link" href="https://github.com/RehabMan/Laptop-DSDT-Patch/blob/master/graphics/graphics_PTS_WAK-disable.txt" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a> æˆ–å¤åˆ¶ä»¥ä¸‹ä»£ç ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#Maintained by: RehabMan for: Laptop Patches
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#graphics_PTS_WAK-disable.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># The purpose of this patch is to add code to to _WAK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># that disables Radeon/nvidia on wake and add code
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># to _PTS that enables it on _PTS.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># The path of _OFF may have to be customized to match your SSDTs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># The patch attempts to identify the correct _REG by using
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># the ACPI PNP identifier for the EC.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Use this patch if you experience trouble shutting down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># or restarting your laptop when disabling nvida/radeon.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _PTS code_regex ([\s\S]*) replace_matched
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">External(\\_SB.PCI0.PEG0.PEGP._ON, MethodObj)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">If (CondRefOf(\\_SB.PCI0.PEG0.PEGP._ON)) { \\_SB.PCI0.PEG0.PEGP._ON() }\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into method label _WAK code_regex (Return\s+\(.*) replace_matched
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">External(\\_SB.PCI0.PEG0.PEGP._OFF, MethodObj)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">If (CondRefOf(\\_SB.PCI0.PEG0.PEGP._OFF)) { \\_SB.PCI0.PEG0.PEGP._OFF() }\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[6-4-2] æŒ‰ command + F æœç´¢ &lt;code>Device (ALSD)&lt;/code>ï¼Œæ‰¾åˆ°å¦‚å›¾ä»£ç ï¼Œå°†å…¶æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-4.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-4_hub68a8a966914faccc2fa404696284489_152896_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-4_hub68a8a966914faccc2fa404696284489_152896_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-4"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">Device (_SB.ALS0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name (_HID, &amp;#34;ACPI0008&amp;#34;) // _HID: Hardware ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name (_CID, &amp;#34;smc-als&amp;#34;) // _STA: Status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name (_ALI, 300) // _ALI: Ambient Light Illuminance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name (_ALR, Package () // _ALR: Ambient Light Response
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Package () { 100, 300 },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-5.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-5_hub980ce45be6280fc8a0a8de2a9044e65_256600_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-5_hub980ce45be6280fc8a0a8de2a9044e65_256600_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-5"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;h3 id="6-3-ä¿®å¤è§¦æŽ§æ¿">[6-3] ä¿®å¤è§¦æŽ§æ¿&lt;/h3>
&lt;p>çµåˆƒ 15 çš„æ ‡å‡†ç‰ˆå’Œç²¾è‹±ç‰ˆä½¿ç”¨çš„è§¦æŽ§æ¿ä¸åŒï¼Œè¯·æ ¹æ®è‡ªå·±çš„ç”µè„‘è¿›è¡Œé€‰æ‹©ä¿®å¤æ–¹æ¡ˆã€‚&lt;/p>
&lt;h4 id="6-3-1-æ ‡å‡†ç‰ˆ">[6-3-1] æ ‡å‡†ç‰ˆ&lt;/h4>
&lt;p>[6-3-1-1]&lt;/p>
&lt;p>ç»§ç»­æœç´¢ &lt;code>SSCN&lt;/code>ã€‚æ‰¾åˆ° Scope ä¸º &lt;code>_SB.PCI0.I2C0&lt;/code> ä¸‹çš„ SSCN æ–¹æ³•ã€‚å¤åˆ¶ SSCN ä¸Ž FMCNï¼ˆåœ¨ SSCN ä¸‹æ–¹ï¼‰è¿™ ä¸¤ä¸ªæ–¹æ³•ã€‚å¹¶å°†è¿™ä¸¤ä¸ªæ–¹æ³•å¦‚å›¾é‡å‘½åï¼ˆä¹Ÿå¯é€‰æ‹©åˆ é™¤ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-6.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-6_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_280587_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-6_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_280587_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-6"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>é‡å‘½åä¸ºï¼š&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-7.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-7_hu3f7d5d77e0868263a4b670cd80a4de9e_282582_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-7_hu3f7d5d77e0868263a4b670cd80a4de9e_282582_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-7"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>[6-3-1-3]&lt;/p>
&lt;p>æœç´¢ TPD0ã€‚å°†ä¹‹å‰å‰ªåˆ‡çš„ä¸¤ä¸ªæ–¹æ³•æ”¾åˆ° &lt;code>_INI&lt;/code> æ–¹æ³•åŽã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-8.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-8_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_154135_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-8_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_154135_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-8"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-9.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-9_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_286656_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-9_hu7d9acb8df49ac7ec09c34c4f5acd4d1b_286656_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-9"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>[6-3-1-4]&lt;/p>
&lt;p>å‘ä¸‹æ‰¾åˆ°å¦‚ä¸‹ä»£ç ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-10.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-10_hu23d7821cfcc16e2238565e92d2428825_290461_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-10_hu23d7821cfcc16e2238565e92d2428825_290461_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-10"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>å°†å…¶æ›´æ”¹ä¸ºå¦‚å›¾ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-11.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-11_hu1c5f5c37fa8eeab89aecaea9b074d8a6_267651_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-11_hu1c5f5c37fa8eeab89aecaea9b074d8a6_267651_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-11"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;h4 id="6-3-2-ç²¾è‹±ç‰ˆ">[6-3-2] ç²¾è‹±ç‰ˆ&lt;/h4>
&lt;p>[6-3-2-1]&lt;/p>
&lt;p>åœ¨ Patch é¡µé¢ä¸­ç²˜è´´ä»¥ä¸‹ä»£ç ä»£ç ï¼Œç‚¹å‡» Applyã€‚&lt;/p>
&lt;p>[6-3-2-2]&lt;/p>
&lt;p>ç‚¹å‡» Compile è¿›è¡Œç¼–è¯‘ç¡®å®šæ—  errorï¼ˆé»˜è®¤æ²¡æœ‰ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">into method label _STA parent_label GPI0 replace_content begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Return (0x0F)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">into_all method label _CRS parent_label TPD0 replace_content begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ConcatenateResTemplate (SBFB, SBFI)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="6-4-ä¿å­˜ä¿®æ”¹å¥½çš„-dsdtaml">[6-4] ä¿å­˜ä¿®æ”¹å¥½çš„ DSDT.aml&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ç‚¹å‡» File -&amp;gt; save as ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>File Format é€‰æ‹© &lt;code>ACPI Machine Language Binary&lt;/code>ã€‚å‘½åä¸º DSDT.amlã€‚å­˜å…¥æ¡Œé¢ä¸­çš„ parched æ–‡ä»¶å¤¹ä¸­ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="6-5-å±è”½-nvdia-æ˜¾å¡">[6-5] å±è”½ Nvdia æ˜¾å¡&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>å¦‚æžœä½ é€‰æ‹©å®‰è£… High Sierra å®‰è£… WebDriver ä½¿ç”¨ Nvidia æ˜¾å¡çš„è¯ï¼Œä¸ç”¨è¯¥è¡¥ä¸&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;p>[ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹æ”¯æŒé©±åŠ¨çš„ High Sierra ](&lt;a class="link" href="https://www.tonymacx86.com/nvidia-drivers/" target="_blank" rel="noopener"
>https&lt;/a> : &lt;a class="link" href="https://www.tonymacx86.com/nvidia-drivers/" target="_blank" rel="noopener"
>//www.tonymacx86.com/nvidia-drivers/&lt;/a>)&lt;/p>
&lt;ul>
&lt;li>&lt;strong>åœ¨çš„ç¬”è®°æœ¬ä¸Šä½¿ç”¨è¯¥è¡¥ä¸ä¼šå¯¼è‡´ type-c è½¬è§†é¢‘æŽ¥å£æ— ä¿¡å·ï¼Œæ— æ³•æ‹“å±•æ˜¾ç¤ºå™¨ï¼Œè‹¥å‡ºçŽ°ç›¸åŒæƒ…å†µè¯·åˆ é™¤è¯¥è¡¥ä¸ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>[6-5-1]&lt;/p>
&lt;p>å†æ¬¡è¿›å…¥ origin æ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨ç»ˆç«¯è¾“å…¥&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">./origin/iasl -da -dl SSDT-12-OptTabl.aml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[6-5-2]&lt;/p>
&lt;p>æ ¹æ®ä¸Šæ–¹ä¿®è¡¥ç”µæ± çŠ¶æ€ï¼Œè§¦æŽ§æ¿çš„æ–¹å¼ç±»ä¼¼ï¼Œä½¿ç”¨ MaciASL æ‰“å¼€ &lt;strong>SSDT-12-OptTabl.dsl&lt;/strong>&lt;/p>
&lt;p>[6-5-3]&lt;/p>
&lt;p>æŒ‰ command + F æœç´¢ä»¥ä¸‹ä»£ç &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">Method (_OFF, 0, Serialized) // _OFF: Power Off
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-12.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-12_hu2676900d025708aa224f75aaa3467a9c_159091_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-12_hu2676900d025708aa224f75aaa3467a9c_159091_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-12"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>[6-5-4]&lt;/p>
&lt;p>åœ¨è¯¥ä»£ç ä¸Šæ–¹ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">Method (_INI) {_OFF() } // added to call _OFF
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[6-5-5]&lt;/p>
&lt;p>ç‚¹å‡» patchï¼Œå°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ°å¼¹çª—ä¸­ï¼Œç‚¹å‡» applyã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">into method label _INI parent_label \_SB.PCI0.GFX0 insert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">begin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//added to turn nvidia/radeon off\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">External(\_SB.PCI0.PEG0.PEGP._OFF, MethodObj)\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">\n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[6-5-6]&lt;/p>
&lt;p>ç‚¹å‡»ç¼–è¯‘ï¼Œå‡ºçŽ°ä¸€ä¸ªé”™è¯¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-13.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-13_hua74e3ca4eeedf7cfd113fba4cc112dcf_385932_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-13_hua74e3ca4eeedf7cfd113fba4cc112dcf_385932_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-13"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>[6-5-7]&lt;/p>
&lt;p>æœç´¢ä¸€ä¸‹ä»£ç ï¼Œå¹¶å°†å…¶åˆ é™¤ï¼Œå†æ¬¡ç¼–è¯‘ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">External &lt;span class="o">(&lt;/span>_SB_.PCI0.PEG0.TGPC, IntObj&lt;span class="o">)&lt;/span> // &lt;span class="o">(&lt;/span>from opcode&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-14.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-14_huc397bebb9da1198e3070ace5d1200979_429156_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-14_huc397bebb9da1198e3070ace5d1200979_429156_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-10"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>[6-5-8]&lt;/p>
&lt;p>ç‚¹å‡» File -&amp;gt; Save Asã€‚å°†æœ€ç»ˆçš„ /aml æ–‡ä»¶ä¿å­˜ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-15.png"
width="1025"
height="725"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-15_huc397bebb9da1198e3070ace5d1200979_427498_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-15_huc397bebb9da1198e3070ace5d1200979_427498_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-11"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;h3 id="6-6-åˆ¶ä½œ-ssdt-usbxaml">[6-6] åˆ¶ä½œ SSDT-USBX.aml&lt;/h3>
&lt;p>å¦‚æžœæƒ³åˆ¶ä½œè‡ªå·±çš„ SSDT-USBX.amlã€‚è¯·å‚è€ƒ &lt;a class="link" href="https://github.com/stonevil/Razer_Blade_Advanced_early_2019_Hackintosh#usb-mapping" target="_blank" rel="noopener"
>ç‚¹æˆ‘ã€‚&lt;/a>&lt;/p>
&lt;p>ä½¿ç”¨ USBMapã€‚&lt;a class="link" href="https://github.com/corpnewt/USBMap" target="_blank" rel="noopener"
>ç‚¹æˆ‘&lt;/a>&lt;/p>
&lt;h3 id="6-7-å¤åˆ¶æä¾›çš„çš„-aml-æ–‡ä»¶">[6-7] å¤åˆ¶æä¾›çš„çš„ .aml æ–‡ä»¶&lt;/h3>
&lt;p>å°†æ–‡ä»¶å¤¹ä¸­çš„ SSDT-PNLF.amlï¼ŒSSDT-UIAC-ALL.amlï¼ŒSSDT-USBX.amlï¼ŒSSDT-XOSI.aml åŒä¸Šé¢ä¿®è¡¥çš„ä¸¤ä¸ªæ–‡ä»¶ä¸€åŒæ”¾å…¥ patched æ–‡ä»¶å¤¹ä¸­ï¼Œæœ€åŽ patched æ–‡ä»¶å¤¹ä¸­åº”è¯¥æœ‰å¦‚ä¸‹6ä¸ªæ–‡ä»¶ã€‚&lt;/p>
&lt;p>&lt;strong>å¦‚æžœ type-c è½¬è§†é¢‘æŽ¥å£æ— ä¿¡å·ï¼Œè¯·åˆ é™¤SSDT-12-OptTabl.aml&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-16.png"
width="618"
height="293"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-16_hu06ceecd71981737f4621cc2ff5d5371e_32019_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/6-16_hu06ceecd71981737f4621cc2ff5d5371e_32019_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6-16"
class="gallery-image"
data-flex-grow="210"
data-flex-basis="506px"
>&lt;/p>
&lt;h2 id="7-ç½‘å¡">[7] ç½‘å¡&lt;/h2>
&lt;h3 id="7-1-æ›´æ¢åšé€šç½‘å¡">[7-1] æ›´æ¢åšé€šç½‘å¡&lt;/h3>
&lt;p>åœ¨ç½‘ä¸Šæ‰¾è¿‡æ‹†æœºå›¾ï¼Œç½‘å¡é™„è¿‘çš„ä½ç½®è¿˜æ˜¯æŒºå¤šçš„ï¼Œæˆ‘çš„é€‰æ‹©æ˜¯æ‹†æœºçš„ &lt;code>BCM94360cs2&lt;/code> + è½¬æŽ¥å¡ï¼Œå¯ç›´æŽ¥å…é©±ä½¿ç”¨ã€‚&lt;/p>
&lt;p>ç›¸æ¯”ä½¿ç”¨åŽŸè£…çš„ç½‘å¡ä½ç½®ç¨æœ‰ç‚¹é«˜ï¼ŒåŽ‹åœ¨ä¸€æ ¹çš„æŽ’çº¿ä¸Šï¼Œä½†æ˜¯ä¸å½±å“ï¼Œå¦‚é€‰æ‹©åŒæ¬¾ç½‘å¡ï¼Œè¯·æ³¨æ„ç»ç¼˜ï¼Œå»ºè®®ä¸Šèžºä¸çš„æ—¶å€™ä¸è¦æ‹§å¤ªç´§ï¼Œä¸æ¾åŠ¨å³å¯ã€‚è£…ä¸Šä¹‹åŽçš„æ•ˆæžœå¦‚å›¾ã€‚&lt;/p>
&lt;p>**å°æç¤º: **æ‹§èžºä¸å‰æœ€å¥½æŠŠæ˜“ç¢Žè´´ç»™æ¸…ç†å¹²å‡€ã€‚è¿™ä¸ªè´´çº¸åˆ†é‡å¤ªè¶³ï¼Œå¡åœ¨èžºä¸å­”ä¸­å¯¼è‡´ä¸€ç›´æ»‘ä¸ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/7-1.png"
width="574"
height="668"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/7-1_hu1161da1d8dba47d941a13aa6ae79cf52_787645_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/7-1_hu1161da1d8dba47d941a13aa6ae79cf52_787645_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="7-1"
class="gallery-image"
data-flex-grow="85"
data-flex-basis="206px"
>&lt;/p>
&lt;p>**ä½¿ç”¨æ•ˆæžœ: **2.4G WIFI å’Œ è“ç‰™æœ‰å¹²æ‰°ï¼Œå°¤å…¶æ˜¯ 2.4G WIFI ä½¿ç”¨å¸¦å®½é«˜çš„æ—¶å€™ï¼Œè“ç‰™å‡ ä¹Žä¸èƒ½ç”¨ã€‚å…¶ä»–ä½¿ç”¨åœºæ™¯åŸºæœ¬è‰¯å¥½ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æƒ³æŠ˜è…¾çš„è¯å¯é€‰æ‹© &lt;code>DW1820A&lt;/code>ï¼Œå¯å‚è€ƒ &lt;a class="link" href="https://blog.daliansky.net/DW1820A_BCM94350ZAE-driver-inserts-the-correct-posture.html" target="_blank" rel="noopener"
>è¿™é‡Œã€‚&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åšé€š &lt;code>BCM94352Z&lt;/code> ï¼ŒçŽ°åœ¨ä»·é’±è¢«ç‚’çš„å¾ˆé«˜ï¼Œç›®å‰å°†è¿‘ 300ï¼Œæœ‰é’±éšæ„ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="7-2-ä½¿ç”¨è‡ªå¸¦ç½‘å¡">[7-2] ä½¿ç”¨è‡ªå¸¦ç½‘å¡&lt;/h3>
&lt;p>Intel è“ç‰™é»˜è®¤å…é©±ï¼ŒWiFi ç›®å‰æ— è§£ã€‚&lt;/p>
&lt;p>è“ç‰™ä»Ž windows é‡å¯è¿›å…¥ macOS å¯ä½¿ç”¨ï¼ˆç½‘å¡æœªæ–­ç”µæ‰€ä»¥ä¸Šä¼ äº†é©±åŠ¨ï¼‰ã€‚&lt;/p>
&lt;p>å°† &lt;a class="link" href="https://github.com/zxystd/IntelBluetoothFirmware/releases" target="_blank" rel="noopener"
>è¯¥é©±åŠ¨&lt;/a> æ”¾å…¥ EFI/CLOVER/kextsï¼Œå¯ä»¥å®žçŽ°å†·å¯åŠ¨é©±åŠ¨è‡ªå¸¦ç½‘å¡è“ç‰™ã€‚&lt;/p>
&lt;p>**ä½¿ç”¨æ•ˆæžœ: **è“ç‰™é”®ç›˜ï¼Œè“ç‰™éŸ³ç®±æ²¡æœ‰é—®é¢˜ï¼Œè“ç‰™é¼ æ ‡è²Œä¼¼ä¸èƒ½ç”¨ã€‚&lt;/p>
&lt;h3 id="7-3-ä½¿ç”¨usbç½‘å¡">[7-3] ä½¿ç”¨USBç½‘å¡&lt;/h3>
&lt;p>usb ç½‘å¡é©±åŠ¨å®‰è£…ã€‚&lt;a class="link" href="https://github.com/chris1111/Wireless-USB-Adapter-Clover/releases" target="_blank" rel="noopener"
>ç‚¹æˆ‘ã€‚&lt;/a>&lt;/p>
&lt;ul>
&lt;li>COMFAST CF-WU815N 150M å•é¢‘&lt;/li>
&lt;li>COMFAST CF-811AC 650M åŒé¢‘&lt;/li>
&lt;li>COMFAST CF-812AC 1300M åŒé¢‘&lt;/li>
&lt;li>æ›´å¤šå…¶ä»–åž‹å·è‡ªè¡Œæœç´¢&lt;/li>
&lt;/ul>
&lt;h2 id="8-ä¸€äº›ä¼˜åŒ–">[8] ä¸€äº›ä¼˜åŒ–&lt;/h2>
&lt;h3 id="8-1-hidpi">[8-1] HIDPI&lt;/h3>
&lt;p>å¼€å¯ HIDPI åŽå¯èƒ½ä¼šå¯¼è‡´å¼€æœºç¬¬äºŒé˜¶æ®µ Logo å˜å¤§ï¼Œå› ä¸ºåˆ†è¾¨çŽ‡æ˜¯ä»¿å†’çš„ï¼Œä¸å½±å“ä½¿ç”¨ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ç»ˆç«¯æ‰§è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">sh -c &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>curl -fsSL https://raw.githubusercontent.com/xzhih/one-key-hidpi/master/hidpi.sh&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>é€‰æ‹© &amp;ldquo;å¼€å¯ HIDPI&amp;rdquo;&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ˜¾ç¤ºçš„ ICON é€‰æ‹© Macbook Proï¼ˆåœ¨è®¾ç½®ç•Œé¢æ˜¾ç¤ºçš„æ ·å¼ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€‰æ‹©åˆ†è¾¨çŽ‡é…ç½® 1080P æ˜¾ç¤ºå™¨ï¼ˆæ ¹æ®è‡ªèº«æƒ…å†µé€‰æ‹©ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šè¯¦ç»†æƒ…å†µå¯å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚&lt;a class="link" href="https://www.sqlsec.com/2018/09/hidpi.html" target="_blank" rel="noopener"
>ç‚¹æˆ‘ã€‚&lt;/a>&lt;/p>
&lt;h3 id="8-2-æ‰“å¼€-trim">[8-2] æ‰“å¼€ TRIM&lt;/h3>
&lt;p>å¦‚æžœä½¿ç”¨ SSDï¼Œä¸€å®šè¦æ‰“å¼€ TRIMï¼Œé˜²æ­¢ç³»ç»Ÿå¤šæ¬¡æ“¦å†™ï¼Œç¡®ä¿ç¡¬ç›˜å¯¿å‘½ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">sudo trimforce &lt;span class="nb">enable&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®ŒæˆåŽç³»ç»Ÿä¼šè¿›è¡Œä¸€æ¬¡é‡å¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/8-1.png"
width="597"
height="392"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/8-1_hu7ef8c94d672dd32ca37ffb306a046a5c_44030_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/8-1_hu7ef8c94d672dd32ca37ffb306a046a5c_44030_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="8-1"
class="gallery-image"
data-flex-grow="152"
data-flex-basis="365px"
>&lt;/p>
&lt;h3 id="8-3-ç¦ç”¨ç¡çœ ">[8-3] ç¦ç”¨ç¡çœ &lt;/h3>
&lt;p>åœ¨ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶åœ¨ è®¾ç½® -&amp;gt; èŠ‚èƒ½ ä¸­å…³é—­ç›¸åº”è®¾ç½®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">sudo pmset -a hibernatemode &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm /var/vm/sleepimage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo mkdir /var/vm/sleepimage
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/8-2.png"
width="668"
height="447"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/8-2_hud42e2df37bc11de06acd6253c0889518_56255_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/8-2_hud42e2df37bc11de06acd6253c0889518_56255_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="8-2"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="358px"
>&lt;/p>
&lt;p>&lt;img src="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/8-3.png"
width="668"
height="447"
srcset="https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/8-3_hu811770682d9683eef53048df303f786e_59426_480x0_resize_box_3.png 480w, https://emerywan.github.io/blog/blog/p/razer-blade-base-hackintosh/8-3_hu811770682d9683eef53048df303f786e_59426_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="8-3"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="358px"
>&lt;/p>
&lt;h3 id="8-4-æ´—ç™½åºåˆ—å·">[8-4] â€œæ´—ç™½â€åºåˆ—å·&lt;/h3>
&lt;p>ç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œè‡ªè¡Œæœä¸€ä¸‹ã€‚&lt;/p>
&lt;h1 id="å‚è€ƒ">å‚è€ƒ&lt;/h1>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/stonevil/Razer_Blade_Advanced_early_2019_Hackintosh" target="_blank" rel="noopener"
>https://github.com/stonevil/Razer_Blade_Advanced_early_2019_Hackintosh&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.tonymacx86.com/threads/guide-razer-blade-15-2018-detailed-install-guide-high-sierra-10-13-6-17g2208-17g5019.264017/" target="_blank" rel="noopener"
>https://www.tonymacx86.com/threads/guide-razer-blade-15-2018-detailed-install-guide-high-sierra-10-13-6-17g2208-17g5019.264017/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.daliansky.net/" target="_blank" rel="noopener"
>https://blog.daliansky.net/&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>