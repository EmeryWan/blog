<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>æŠ€æœ¯ on ä¸€å±‚</title><link>https://blog.letout.cn/categories/%E6%8A%80%E6%9C%AF/</link><description>Recent content in æŠ€æœ¯ on ä¸€å±‚</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sat, 01 Jan 2022 01:00:00 +0800</lastBuildDate><atom:link href="https://blog.letout.cn/categories/%E6%8A%80%E6%9C%AF/index.xml" rel="self" type="application/rss+xml"/><item><title>Redis ç¼“å­˜é—®é¢˜</title><link>https://blog.letout.cn/p/redis/cache-problem/</link><pubDate>Wed, 11 Jan 2023 01:52:45 +0800</pubDate><guid>https://blog.letout.cn/p/redis/cache-problem/</guid><description>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/cache.png" alt="Featured image of post Redis ç¼“å­˜é—®é¢˜" />&lt;h2 id="-ç¼“å­˜é›ªå´©">ğŸŒ¨ï¸ ç¼“å­˜é›ªå´©&lt;/h2>
&lt;p>ä¸ºäº†ä¿è¯ç¼“å­˜ä¸­æ•°æ®ä¸æ•°æ®åº“ä¸­çš„æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé€šå¸¸ Redis ä¸­æ•°æ®ä¼šè®¾ç½®è¿‡æœŸæ—¶é—´ã€‚å¦‚æœï¼ˆ1ï¼‰ç¼“å­˜å±‚åœ¨åŒä¸€æ—¶é—´æœ‰å¤§é‡æ•°æ®å¤±æ•ˆï¼Œæˆ–è€… ï¼ˆ2ï¼‰Redis ç”±äºæŸäº›æƒ…å†µå®•æœºï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚å…¨éƒ¨åˆ°è¾¾æ•°æ®åº“ï¼Œå¯¼è‡´è¯·æ±‚å…¨éƒ¨è®¿é—®æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å®•æœºã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/1.png"
width="1080"
height="660"
srcset="https://blog.letout.cn/p/redis/cache-problem/1_huab116a381b3e5ca6aaa694e3ae424f2c_109299_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/1_huab116a381b3e5ca6aaa694e3ae424f2c_109299_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="392px"
>&lt;/p>
&lt;p>ğŸ’¡ è§£å†³åŠæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ§© ç»™æ•°æ®éšæœºè®¾ç½®è¿‡æœŸæ—¶é—´&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© &lt;a class="link" href="https://www.letout.cn/p/distributed-lock/redis/" target="_blank" rel="noopener"
>äº’æ–¥é”&lt;/a>ï¼Œåªæœ‰ä¸€ä¸ªè¯·æ±‚ä¼šåˆ°æ•°æ®åº“ä¸Šï¼Œå¹¶ä¼šé‡å»ºç¼“å­˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© åŒ Key ç­–ç•¥ï¼Œæœ‰ä¸åŒçš„ Keyï¼Œä½†æœ‰ä¸åŒçš„ Value&lt;/p>
&lt;ul>
&lt;li>ä¸» Keyï¼šè®¾ç½®è¿‡æœŸæ—¶é—´&lt;/li>
&lt;li>å¤‡ Keyï¼šä¸è®¾ç½®è¿‡æœŸæ—¶é—´&lt;/li>
&lt;li>å½“ ä¸» Key è¿‡æœŸåï¼Œå¤§é‡è¯·æ±‚åˆ°è¾¾æ—¶ç›´æ¥è¿”å› å¤‡ Keyï¼Œå¹¶é€šçŸ¥åå°çº¿ç¨‹ï¼Œé‡å»ºä¸» Key&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© åå°æ›´æ–°ç¼“å­˜ï¼Œè®¾ç½® Key æ°¸ä¸è¿‡æœŸï¼ˆå†…å­˜ä¸å¤Ÿæ—¶å¯èƒ½è¢«å†…å­˜æ·˜æ±°ç­–ç•¥æ·˜æ±°ï¼‰&lt;/p>
&lt;ul>
&lt;li>åå°çº¿ç¨‹å®šæ—¶æ›´æ–° æˆ– å®šæ—¶æ£€æµ‹æ˜¯å¦å¤±æ•ˆè¿›è¡Œé‡å»º&lt;/li>
&lt;li>ä¸šåŠ¡ä¸Šå‘ç°è¢«æ·˜æ±°ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥é‡å»º&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ç¼“å­˜å‡»ç©¿">âš¡ ç¼“å­˜å‡»ç©¿&lt;/h2>
&lt;p>ç¼“å­˜ä¸­æŸä¸ªçƒ­ç‚¹ Key æ•°æ®è¿‡æœŸäº†ï¼Œæ­¤æ—¶æœ‰å¤§é‡è¯·æ±‚è®¿é—®è¯¥æ•°æ®ï¼Œå¯¼è‡´è¿™äº›è¯·æ±‚å…¨éƒ¨éƒ½è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå¯¼è‡´æ•°æ®åº“å®•æœºã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/2.png"
width="707"
height="836"
srcset="https://blog.letout.cn/p/redis/cache-problem/2_hu4d851393f6ce96ed0f1e6e1059c88231_81241_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/2_hu4d851393f6ce96ed0f1e6e1059c88231_81241_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="84"
data-flex-basis="202px"
>&lt;/p>
&lt;p>ğŸ’¡ è§£å†³åŠæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ§© &lt;a class="link" href="https://www.letout.cn/p/distributed-lock/redis/" target="_blank" rel="noopener"
>äº’æ–¥é”&lt;/a>ï¼Œåªæœ‰ä¸€ä¸ªè¯·æ±‚ä¼šåˆ°æ•°æ®åº“ä¸Šï¼Œå¹¶é‡å»ºç¼“å­˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼ˆå†…å­˜ä¸å¤Ÿæ—¶å¯èƒ½è¢«å†…å­˜æ·˜æ±°ç­–ç•¥æ·˜æ±°ï¼‰ï¼Œåå°çº¿ç¨‹æ›´æ–°ç¼“å­˜&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ç¼“å­˜ç©¿é€">ğŸŒªï¸ ç¼“å­˜ç©¿é€&lt;/h2>
&lt;p>è¯·æ±‚çš„æ•°æ®æ—¢ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œä¹Ÿä¸å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œæœ‰å¤§é‡è¿™æ ·çš„è¯·æ±‚ï¼Œä¸ä¼šå‘½ä¸­ç¼“å­˜ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›éå¸¸å¤§ã€‚&lt;/p>
&lt;p>å¯èƒ½æ˜¯ç”±äºï¼ˆ1ï¼‰ä¸šåŠ¡è¯¯æ“ä½œ æˆ– ï¼ˆ2ï¼‰é»‘å®¢çš„æ•…æ„æ”»å‡»&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/3.png"
width="576"
height="836"
srcset="https://blog.letout.cn/p/redis/cache-problem/3_hua47220c88eca814bf161e3c4ed6c3627_76648_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/3_hua47220c88eca814bf161e3c4ed6c3627_76648_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="68"
data-flex-basis="165px"
>&lt;/p>
&lt;p>ğŸ’¡ è§£å†³åŠæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ§© ç¼“å†²é»˜è®¤å€¼ï¼Œåç»­çš„è¯·æ±‚ç›´æ¥è¿”å›è¯¥é»˜è®¤å€¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå½“å¸ƒéš†è¿‡æ»¤å™¨è¿”å› 0 æ—¶ï¼Œè¯´æ˜æ•°æ®ä¸€å®šä¸åœ¨æ•°æ®åº“ä¸­&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ§© éæ³•è¯·æ±‚é™åˆ¶ï¼Œåœ¨ä¸šåŠ¡å±‚åˆ¤æ–­æŸ¥è¯¢æ¡ä»¶ï¼Œå¦‚æœæ—¶æ¶æ„è¯·æ±‚ç›´æ¥æ‹’ç»&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-çƒ­ç‚¹-key-é‡å»º">ğŸ”¥ çƒ­ç‚¹ Key é‡å»º&lt;/h2>
&lt;p>å½“çƒ­ç‚¹ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œåç«¯ä¼šæœ‰å¤§é‡è¯·æ±‚ï¼Œåœ¨é‡å»ºç¼“å­˜æ—¶ï¼Œä¼šé€ æˆåç«¯è´Ÿè½½è¿‡å¤§ï¼Œå¯¼è‡´åº”ç”¨å´©æºƒã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ’¡ ä½¿ç”¨äº’æ–¥é”&lt;/p>
&lt;ul>
&lt;li>åªå…è®¸ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…é‡å»ºç¼“å­˜çš„çº¿ç¨‹æ‰§è¡Œå®Œï¼Œæ‰èƒ½ä»ç¼“å­˜è·å–æ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸ’¡ Key æ°¸ä¸è¿‡æœŸ&lt;/p>
&lt;ul>
&lt;li>åˆ©ç”¨åå°çº¿ç¨‹å»å•ç‹¬æ„å»ºç¼“å­˜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ç¼“å­˜ä¸€è‡´æ€§">ğŸ ç¼“å­˜ä¸€è‡´æ€§&lt;/h2>
&lt;h3 id="æ›´æ–°">æ›´æ–°&lt;/h3>
&lt;h4 id="-å…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜">âŒ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜&lt;/h4>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/11.png"
width="893"
height="618"
srcset="https://blog.letout.cn/p/redis/cache-problem/11_hu0a23dc2cab9bf3c3bb634fe5cae7e5fa_53493_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/11_hu0a23dc2cab9bf3c3bb634fe5cae7e5fa_53493_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="144"
data-flex-basis="346px"
>&lt;/p>
&lt;h4 id="-å…ˆæ›´æ–°ç¼“å­˜å†æ›´æ–°æ•°æ®åº“">âŒ å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“&lt;/h4>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/12.png"
width="903"
height="498"
srcset="https://blog.letout.cn/p/redis/cache-problem/12_hub4cf2089e272e09419483674cc55ccc3_51215_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/12_hub4cf2089e272e09419483674cc55ccc3_51215_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="435px"
>&lt;/p>
&lt;h3 id="åˆ é™¤">åˆ é™¤&lt;/h3>
&lt;h4 id="-å…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“">â“ å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“&lt;/h4>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/13.png"
width="903"
height="618"
srcset="https://blog.letout.cn/p/redis/cache-problem/13_hu6883dd3e3299a5dfe5e375db77067d03_50514_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/13_hu6883dd3e3299a5dfe5e375db77067d03_50514_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="146"
data-flex-basis="350px"
>&lt;/p>
&lt;p>å¯ä»¥è€ƒè™‘å»¶è¿ŸåŒåˆ ã€‚åœ¨æ›´æ–°å®Œæ•°æ®åº“åï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´å†åˆ é™¤ä¸€æ¬¡ç¼“å­˜ã€‚&lt;/p>
&lt;h4 id="-å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜">â­• å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜&lt;/h4>
&lt;p>åœ¨å®é™…ä¸­ï¼Œå‡ºç°çš„æ¦‚ç‡éå¸¸ä½ã€‚ç¼“å­˜çš„å†™å…¥è¦è¿œè¿œå¿«äºæ•°æ®åº“çš„å†™å…¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/cache-problem/14.png"
width="1080"
height="660"
srcset="https://blog.letout.cn/p/redis/cache-problem/14_huab116a381b3e5ca6aaa694e3ae424f2c_109299_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/cache-problem/14_huab116a381b3e5ca6aaa694e3ae424f2c_109299_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="392px"
>&lt;/p>
&lt;h3 id="å¼‚æ­¥">å¼‚æ­¥&lt;/h3>
&lt;p>é€šè¿‡ æ›´æ–° + åˆ é™¤ï¼Œæ˜¯ä¸¤ä¸ªä¸åŒçš„æ“ä½œï¼Œä¸å…·å¤‡åŸå­æ€§ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/p>
&lt;ul>
&lt;li>ä¸­é—´ä»¶&lt;/li>
&lt;/ul>
&lt;p>é€šè¿‡ä¸­é—´ä»·ï¼ˆå¦‚ Canal ï¼‰è®¢é˜…æ•°æ®åº“çš„ binlogï¼Œå½“æ›´æ–°å®Œæ•°æ®åº“æ—¶ï¼Œé€šè¿‡ä¸­é—´ä»¶å»åˆ é™¤ç¼“å­˜ã€‚&lt;/p>
&lt;h2 id="-å‚è€ƒ">ğŸ“• å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://xiaolincoding.com/redis/" target="_blank" rel="noopener"
>https://xiaolincoding.com/redis/&lt;/a>&lt;/li>
&lt;li>Redis å¼€å‘ä¸è¿ç»´&lt;/li>
&lt;/ul></description></item><item><title>InnoDB çš„ç¼“å†²æ±  Buffer Pool</title><link>https://blog.letout.cn/p/mysql/innodb/buffer-pool/</link><pubDate>Mon, 09 Jan 2023 18:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/mysql/innodb/buffer-pool/</guid><description>&lt;img src="https://blog.letout.cn/p/mysql/innodb/buffer-pool/cache-page.webp" alt="Featured image of post InnoDB çš„ç¼“å†²æ±  Buffer Pool" />&lt;h2 id="-buffer-pool">ğŸ§Š Buffer Pool&lt;/h2>
&lt;p>MySQL çš„æ•°æ®æ˜¯å­˜åœ¨äºç£ç›˜ä¸­çš„ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼ŒInnoDB è®¾è®¡äº†ä¸€ä¸ªç¼“å­˜æ±  Buffer Poolã€‚æœ¬è´¨ä¸Šæ˜¯ InnoDB å‘æ“ä½œç³»ç»Ÿç”³è¯·çš„ä¸€æ®µè¿ç»­å†…å­˜ç©ºé—´ï¼Œå¯ä»¥é€šè¿‡ &lt;code>innodb_buffer_pool_size&lt;/code> æ¥è¿›è¡Œè°ƒæ•´å¤§å°ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å½“è¯»å–æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å·²ç»åœ¨ Buffer Pool ä¸­ï¼Œä¼šç›´æ¥è¿”å›ï¼›å¦‚æœä¸åœ¨ï¼Œå°±ä¼šå°†æ•°æ®&lt;!-- raw HTML omitted -->å®Œæ•´çš„é¡µä¿¡æ¯&lt;!-- raw HTML omitted -->å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¼šä¿®æ”¹ Buffer Pool ä¸­çš„ç¼“å­˜é¡µï¼ˆ-&amp;gt; å˜æˆè„é¡µï¼‰ï¼Œåœ¨åˆé€‚çš„æ—¶æœºï¼Œç”±åå°çº¿ç¨‹å†™å…¥åˆ°ç£ç›˜ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ç»“æ„">ğŸ§© ç»“æ„&lt;/h3>
&lt;p>Buffer Pool ä¸­çš„è¿ç»­å†…å­˜ï¼Œä¼šè¢«åˆ†å‰²æˆä¸€ä¸ªä¸ªçš„é¡µï¼Œå’Œ InnoDB çš„è¡¨ç©ºé—´ä¸€æ ·ï¼Œéƒ½æ˜¯ &lt;code>16KB&lt;/code>ï¼Œç§°ä¸ºç¼“å­˜é¡µã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/innodb/buffer-pool/cache-page.webp"
width="962"
height="234"
srcset="https://blog.letout.cn/p/mysql/innodb/buffer-pool/cache-page_hucd01fda075157d782d9171d9e071f31a_7000_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/mysql/innodb/buffer-pool/cache-page_hucd01fda075157d782d9171d9e071f31a_7000_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="411"
data-flex-basis="986px"
>&lt;/p>
&lt;p>æ¯ä¸€ä¸ªç¼“å­˜é¡µéƒ½ä¼šç”±ä¸€ä¸ªæ§åˆ¶å—è¿›è¡Œç®¡ç†ï¼ˆä½äº Buffer Pool çš„æœ€å‰é¢ï¼‰ï¼Œæ¯ä¸ª ç¼“å­˜é¡µ ä¸ æ§åˆ¶å— ä¸€ä¸€å¯¹åº”ã€‚&lt;/p>
&lt;h2 id="-ç®¡ç†-buffer-pool-çš„é“¾è¡¨">ğŸ‘·â€â™‚ï¸ ç®¡ç† Buffer Pool çš„é“¾è¡¨&lt;/h2>
&lt;p>InnoDB ä½¿ç”¨äº†è®¸å¤šé“¾è¡¨ç®¡ç† Buffer Poolã€‚&lt;/p>
&lt;h3 id="-free-é“¾è¡¨----ç®¡ç†ç©ºé—²é¡µ">â›“ï¸ Free é“¾è¡¨ &amp;ndash; ç®¡ç†ç©ºé—²é¡µ&lt;/h3>
&lt;p>ğŸ’¡ ç¼“å­˜é¡µï¼šå†…å­˜ä¸­æœªè¢«ä½¿ç”¨çš„é¡µã€‚&lt;/p>
&lt;p>ä¸ºäº†èƒ½å¿«é€Ÿæ‰¾åˆ°ç©ºé—²çš„ç¼“å­˜é¡µï¼Œä½¿ç”¨ Free ç©ºé—²é“¾è¡¨ç®¡ç†ç©ºé—²é¡µã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/innodb/buffer-pool/free-list.webp"
width="1217"
height="597"
srcset="https://blog.letout.cn/p/mysql/innodb/buffer-pool/free-list_hu2194ab0c933cdf7ef8a007d7c52bad5f_28012_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/mysql/innodb/buffer-pool/free-list_hu2194ab0c933cdf7ef8a007d7c52bad5f_28012_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="203"
data-flex-basis="489px"
>&lt;/p>
&lt;p>Free é“¾è¡¨çš„èŠ‚ç‚¹æ˜¯ä¸€ä¸ªä¸ªç©ºé—²é¡µæ‰€å¯¹åº”çš„æ§åˆ¶å—ã€‚&lt;/p>
&lt;p>å½“éœ€è¦ä»ç£ç›˜ä¸­åŠ è½½ä¸€ä¸ªé¡µåˆ° Buffer Pool æ—¶ï¼Œå°±ä» Free é“¾è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªç©ºé—²ä¹Ÿï¼ŒåŠ è½½æ•°æ®å¹¶æ›´æ”¹æ§åˆ¶å—çš„ä¿¡æ¯ï¼Œå¹¶ä» Free é“¾è¡¨ä¸­ç§»é™¤ã€‚&lt;/p>
&lt;h3 id="-flush-é“¾è¡¨----ç®¡ç†è„é¡µ">â›“ï¸ Flush é“¾è¡¨ &amp;ndash; ç®¡ç†è„é¡µ&lt;/h3>
&lt;p>ğŸ’¡ è„é¡µï¼ˆdirty pageï¼‰ï¼šä¿®æ”¹äº†ç¼“å­˜é¡µä¸­çš„æ•°æ®ï¼Œä¸ç£ç›˜ä¸­çš„é¡µæ•°æ®ä¸ä¸€è‡´ï¼Œç§°ä¸ºè„é¡µã€‚&lt;/p>
&lt;p>è¢«ä¿®æ”¹è¿‡çš„ç¼“å­˜é¡µçš„æ§åˆ¶å—ï¼Œä¼šè¢«ä½œä¸ºèŠ‚ç‚¹åŠ å…¥åˆ° Flush é“¾è¡¨ã€‚&lt;/p>
&lt;p>Flush é“¾è¡¨çš„ç»“æ„å’Œ Free é“¾è¡¨å·®ä¸å¤šã€‚åå°çº¿ç¨‹åœ¨ä¸€å®šçš„æ—¶æœºï¼Œé€šè¿‡éå† Flush é“¾è¡¨ï¼Œå°†è„é¡µå†™å…¥å†…å­˜ã€‚&lt;/p>
&lt;h3 id="-lru-é“¾è¡¨----ç®¡ç†è„é¡µ--å¹²å‡€é¡µ">â›“ï¸ LRU é“¾è¡¨ &amp;ndash; ç®¡ç†è„é¡µ + å¹²å‡€é¡µ&lt;/h3>
&lt;p>ğŸ’¡ å¹²å‡€é¡µï¼ˆclean pageï¼‰ï¼šåŠ è½½äº†æ•°æ®æœªä½œä¿®æ”¹çš„ç¼“å­˜é¡µã€‚
ğŸ’¡ è„é¡µï¼ˆdirty pageï¼‰ï¼šåŠ è½½äº†æ•°æ®åšäº†ä¿®æ”¹çš„ç¼“å­˜é¡µã€‚&lt;/p>
&lt;p>Buffer Pool çš„å¤§å°æ˜¯æœ‰é™çš„ï¼ŒinnoDB é€šè¿‡ ï¼ˆä¿®æ”¹è¿‡çš„ï¼‰LRU ç®—æ³•ï¼Œå°†é¢‘ç¹è®¿é—®çš„æ•°æ®åœç•™åœ¨ Buufer Pool ä¸­ã€‚&lt;/p>
&lt;p>ç®€å•çš„ LRU ç®—æ³•åœ¨ MySQL ä¸­å¯èƒ½ä¼šå¯¼è‡´ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é¢„è¯»å¤±æ•ˆï¼ˆé€šè¿‡å°† LRU é“¾è¡¨åˆ’åˆ†ä¸º young åŒºå’Œ old åŒºï¼Œé¢„è¯»æ•°æ®åŠ è½½åˆ° old åŒºåŸŸï¼‰
MySQL ä¼šå°†è¢«åŠ è½½é¡µçš„ä¸´è¿‘é¡µä¸€åŒåŠ è½½åˆ°å†…å­˜ï¼ˆä¸ºäº†å‡å°‘ç£ç›˜ IOï¼‰ï¼Œå¦‚æœè¿™äº›é¡µæ²¡æœ‰è¢«è®¿é—®ï¼Œè¿™ä¸ªé¢„è¯»ç›¸å½“äºæµªè´¹äº†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Buffer Pool æ±¡æŸ“ï¼ˆåŠ è½½åˆ° old åŒºåŸŸçš„æ•°æ®ï¼Œåœç•™æ—¶é—´è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ‰æœ‰èµ„æ ¼æ”¾åˆ° young åŒºåŸŸï¼‰
ä¸€ä¸ª SQL æ‰«æå¤§é‡çš„æ•°æ®ï¼ˆå¦‚ç´¢å¼•å¤±æ•ˆæ—¶ï¼Œè¿›è¡Œå…¨è¡¨æ‰«ææ¥åˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœç©ºé—´æœ‰é™ï¼‰å¯èƒ½ä¼šæŠŠå†…å­˜ä¸­çš„æ‰€æœ‰é¡µå…¨éƒ¨æ›¿æ¢å‡ºå»ï¼Œå¯¼è‡´çƒ­ç‚¹æ•°æ®å…¨éƒ¨å¤±æ•ˆï¼Œåç»­ç¼“å­˜å…¨éƒ¨æ²¡æœ‰å‘½ä¸­ï¼Œå¯¼è‡´å¤§é‡ç£ç›˜ IOã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/innodb/buffer-pool/lru-list.webp"
width="842"
height="212"
srcset="https://blog.letout.cn/p/mysql/innodb/buffer-pool/lru-list_hub80bcb1068b40da49c3759e6a067b1e3_15066_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/mysql/innodb/buffer-pool/lru-list_hub80bcb1068b40da49c3759e6a067b1e3_15066_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="397"
data-flex-basis="953px"
>&lt;/p>
&lt;p>InnoDB çš„ LRU é“¾è¡¨è¢«åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼šï¼ˆ1ï¼‰young åŒºåŸŸï¼›ï¼ˆ2ï¼‰old åŒºåŸŸã€‚&lt;/p>
&lt;p>é¢„è¯»çš„é¡µåªä¼šåŠ è½½åˆ° old åŒºåŸŸçš„å¤´éƒ¨ï¼Œå½“è¯¥é¡µçœŸæ­£è¢«è®¿é—®çš„æ—¶å€™ï¼Œä¼šè¢«ç§»åŠ¨åˆ° young åŒºçš„å¤´éƒ¨ã€‚&lt;/p>
&lt;p>ç§»åŠ¨åˆ° young åŒºåŸŸçš„æ¡ä»¶é™¤äº†è¢«è®¿é—®å¤–ï¼Œè¿˜éœ€è¦åˆ¤æ–­åœç•™åœ¨ old åŒºåŸŸçš„æ—¶é—´ã€‚ï¼ˆé˜²æ­¢å…¨è¡¨æ‰«ææ—¶ï¼Œè¢«è®¿é—®ä¸€æ¬¡åå°±ä¸åœ¨ä½¿ç”¨ï¼‰ã€‚å½“è®¿é—®çš„ç¼“å­˜é¡µå·²ç»åœ¨ old åŒºåŸŸåœç•™æ—¶é—´è¶…è¿‡é˜ˆå€¼ &lt;code>innodb_old_blocks_time=1000ms&lt;/code> æ—¶ï¼Œæ‰ä¼šè¢«æ’å…¥åˆ° young åŒºå¤´éƒ¨ã€‚&lt;/p>
&lt;h2 id="-è„é¡µåˆ·ç›˜">ğŸ’¿ è„é¡µåˆ·ç›˜&lt;/h2>
&lt;p>å½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¿®æ”¹çš„æ˜¯ Buffer Pool ä¸­çš„ç¼“å­˜é¡µï¼Œç„¶åå°†å…¶è®¾ç½®ä¸ºè„é¡µå¹¶åŠ å…¥ Flush é“¾è¡¨ï¼Œç”±åå°çº¿ç¨‹åˆ·æ–°æ•°æ®åˆ°ç£ç›˜ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æƒ…å†µä¼šä¸»åŠ¨åˆ·æ–°æ•°æ®åˆ°ç£ç›˜ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ—ï¸ å½“ redo log æ—¥å¿—å†™æ»¡æ—¶ï¼ˆWALï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ—ï¸ Buffer Pool ç©ºé—´ä¸è¶³æ—¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ—ï¸ MySQL è®¤ä¸ºç©ºé—²æ—¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ—ï¸ MySQL ä¸»åŠ¨æ­£å¸¸å…³é—­å‰&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Redis æŒä¹…åŒ–</title><link>https://blog.letout.cn/p/redis/persistence/</link><pubDate>Fri, 06 Jan 2023 22:07:45 +0800</pubDate><guid>https://blog.letout.cn/p/redis/persistence/</guid><description>&lt;img src="https://blog.letout.cn/p/redis/persistence/cow.png" alt="Featured image of post Redis æŒä¹…åŒ–" />&lt;h2 id="ä¿éšœæ•°æ®ä¸ä¸¢å¤±">ä¿éšœæ•°æ®ä¸ä¸¢å¤±&lt;/h2>
&lt;p>Redis çš„è¯»å†™æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†ä¿è¯å†…å­˜ä¸­çš„æ•°æ®ä¸ä¼šä¸¢å¤±ï¼ŒRedis å®ç°äº†æ•°æ®æŒä¹…åŒ–çš„æœºåˆ¶ï¼ŒæŠŠæ•°æ®å­˜å‚¨åˆ°ç£ç›˜ï¼Œè¿™æ ·åœ¨ Redis é‡å¯å°±èƒ½å¤Ÿä»ç£ç›˜ä¸­æ¢å¤åŸæœ‰çš„æ•°æ®ã€‚&lt;/p>
&lt;ul>
&lt;li>RDB å¿«ç…§&lt;/li>
&lt;li>AOF æ—¥å¿—&lt;/li>
&lt;li>æ··åˆæŒä¹…åŒ–ï¼ˆ4.0+ï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="-rdb-å¿«ç…§">ğŸ“· RDB å¿«ç…§&lt;/h2>
&lt;p>RDB å¿«ç…§å°±æ˜¯è®°å½•æŸä¸€ä¸ªç¬é—´çš„å†…å­˜æ•°æ®ï¼Œè®°å½•çš„æ˜¯å®é™…æ•°æ®ã€‚ï¼ˆå…¨é‡å¤‡ä»½ï¼‰&lt;/p>
&lt;p>å¿«ç…§ï¼Œå°±æ˜¯è®°å½•æŸä¸€ä¸ªç¬é—´ä¸œè¥¿ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬ç»™é£æ™¯æ‹ç…§æ—¶ï¼Œé‚£ä¸€ä¸ªç¬é—´çš„ç”»é¢å’Œä¿¡æ¯å°±è®°å½•åˆ°äº†ä¸€å¼ ç…§ç‰‡ã€‚&lt;/p>
&lt;h3 id="è§¦å‘æ¡ä»¶">è§¦å‘æ¡ä»¶&lt;/h3>
&lt;h4 id="æ‰‹åŠ¨è§¦å‘">æ‰‹åŠ¨è§¦å‘&lt;/h4>
&lt;ul>
&lt;li>save&lt;/li>
&lt;li>bgsave&lt;/li>
&lt;/ul>
&lt;h4 id="è¢«åŠ¨è§¦å‘">è¢«åŠ¨è§¦å‘&lt;/h4>
&lt;ul>
&lt;li>æ ¹æ®é…ç½®æ–‡ä»¶é€‰é¡¹æ¯éš”ä¸€æ®µæ—¶é—´è§¦å‘ä¸€æ¬¡ bgsave&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 300 ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è‡³å°‘æ‰§è¡Œäº† 10 æ¬¡æ“ä½œ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">save 300 10
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>ä»èŠ‚ç‚¹æ‰§è¡Œå…¨é‡å¤åˆ¶æ“ä½œï¼Œä¸»èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ‰§è¡Œ bgsave æ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ shutdown å‘½ä»¤ï¼Œæ²¡æœ‰å¼€å¯ AOF æŒä¹…åŒ–åŠŸèƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œ bgsave&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å®ç°æ–¹å¼">å®ç°æ–¹å¼&lt;/h3>
&lt;p>æ‰§è¡Œ bgsave å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ fork() åˆ›å»ºå­è¿›ç¨‹ï¼Œæ­¤æ—¶å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹æ˜¯å…±äº«åŒä¸€ç‰‡å†…å­˜æ•°æ®ï¼Œbgsave å­è¿›ç¨‹ä¼šæŠŠè¯¥å‰¯æœ¬æ•°æ®å†™å…¥ RDB æ–‡ä»¶ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒRedis ä¾ç„¶å¯ä»¥ç»§ç»­å¤„ç†æ“ä½œå‘½ä»¤ï¼Œå¦‚æœçˆ¶è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œï¼Œå…³é”®çš„æŠ€æœ¯å°±åœ¨äºå†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼ˆCopy-On-Write, COWï¼‰ï¼Œè¢«ä¿®æ”¹çš„æ•°æ®ä¼šå¤åˆ¶ä¸€ä»½å‰¯æœ¬ã€‚ï¼ˆRDB å¿«ç…§ä¿å­˜çš„æ˜¯åŸæœ¬çš„å†…å­˜æ•°æ®ï¼‰&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/persistence/cow.png"
width="969"
height="707"
srcset="https://blog.letout.cn/p/redis/persistence/cow_huef7edcdd3c38f136e9d4b420711ff934_42621_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/persistence/cow_huef7edcdd3c38f136e9d4b420711ff934_42621_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="137"
data-flex-basis="328px"
>&lt;/p>
&lt;h2 id="-aof-æ—¥å¿—">ğŸ“ƒ AOF æ—¥å¿—&lt;/h2>
&lt;p>Redis åœ¨æ‰§è¡Œå®Œä¸€æ¡å‘½ä»¤åï¼Œä¼šæŠŠè¯¥å‘½ä»¤ä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼ˆä¼šå…ˆå†™åˆ°ç¼“å†²åŒºï¼Œé€‰æ‹©åˆé€‚çš„åˆ·ç›˜æ—¶é—´æ‰ä¼šåˆ°ç£ç›˜ä¸­ï¼‰ã€‚&lt;/p>
&lt;p>å½“ Redis é‡å¯æ—¶ï¼Œä¼šè¯»å– AOF æ—¥å¿—çš„å†…å®¹ï¼Œç„¶åé€ä¸€æ‰§è¡Œè¿›è¡Œæ•°æ®æ¢å¤ã€‚&lt;/p>
&lt;h3 id="åå†™æ—¥å¿—">åå†™æ—¥å¿—&lt;/h3>
&lt;p>Reids æ˜¯å…ˆæ‰§è¡Œå†™æ“ä½œå‘½ä»¤åï¼Œæ‰å°†è¯¥å‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—é‡Œã€‚&lt;/p>
&lt;ul>
&lt;li>ä¼˜ç‚¹
&lt;ul>
&lt;li>é¿å…é¢å¤–çš„æ£€æŸ¥å‘½ä»¤çš„å¼€é”€&lt;/li>
&lt;li>å†™æ—¥å¿—çš„æ“ä½œä¸ä¼šé˜»å¡å½“å‰å‘½ä»¤çš„æ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç¼ºç‚¹
&lt;ul>
&lt;li>æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ã€‚åœ¨æ²¡æœ‰å†™åˆ°å†…å­˜ä¸­æ—¶ï¼Œå‘ç”Ÿå®•æœºï¼Œæœ‰ä¸¢å¤±æ•°æ®çš„é£é™©&lt;/li>
&lt;li>å¯èƒ½é˜»å¡åç»­çš„æ“ä½œã€‚æ‰§è¡Œå‘½ä»¤å’Œå†™ AOF æ—¥å¿—éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå½“æŠŠæ—¥å¿—å†™å…¥åˆ°ç£ç›˜æ—¶ï¼Œä¼šé˜»å¡åç»­çš„æ“ä½œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="å†™å›ç­–ç•¥">å†™å›ç­–ç•¥&lt;/h3>
&lt;p>Redis æ‰§è¡Œå®Œå†™æ“ä½œå‘½ä»¤åï¼Œä¼šå°†å‘½ä»¤è¿½åŠ åˆ° server.aof_buf ç¼“å†²åŒºï¼Œä»€ä¹ˆæ—¶å€™å†™å›åˆ°ç£ç›˜ï¼Œç”±é…ç½®å†³å®šã€‚&lt;/p>
&lt;p>Redis.conf å¯é…ç½®å‚æ•° &lt;code>appendfsync&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Always&lt;/p>
&lt;ul>
&lt;li>æ¯æ¬¡éƒ½å†™å›&lt;/li>
&lt;li>å¯é æ€§é«˜ï¼Œæœ€å¤§ç¨‹åº¦ä¼šä¿è¯æ•°æ®ä¸ä¸¢å¤±&lt;/li>
&lt;li>æ¯ä¸ªå‘½ä»¤éƒ½è¦å†™å›ç¡¬ç›˜ï¼Œæ€§èƒ½å¼€é”€å¤§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Everysec&lt;/p>
&lt;ul>
&lt;li>æ¯ç§’å†™å›&lt;/li>
&lt;li>å®•æœºæ—¶ä¼šä¸¢å¤± 1s å†…çš„æ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>No&lt;/p>
&lt;ul>
&lt;li>ç”±æ“ä½œç³»ç»Ÿå†³å®šå†™å›æ—¶æœº&lt;/li>
&lt;li>å®•æœºæ—¶å¯èƒ½ä¼šä¸¢å¤±å¾ˆå¤šæ•°æ®&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="aof-é‡å†™">AOF é‡å†™&lt;/h3>
&lt;p>AOF æ—¥å¿—æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œéšç€æ‰§è¡Œçš„å†™æ“ä½œå‘½ä»¤è¶Šæ¥è¶Šå¤šï¼Œæ–‡ä»¶çš„å¤§å°ä¼šè¶Šæ¥è¶Šå¤§ã€‚ å¦‚æœå½“ AOF æ—¥å¿—æ–‡ä»¶è¿‡å¤§å°±ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚é‡å¯ Redis åï¼Œéœ€è¦è¯» AOF æ–‡ä»¶çš„å†…å®¹ä»¥æ¢å¤æ•°æ®ï¼Œå¦‚æœæ–‡ä»¶è¿‡å¤§ï¼Œæ•´ä¸ªæ¢å¤çš„è¿‡ç¨‹å°±ä¼šå¾ˆæ…¢ã€‚&lt;/p>
&lt;p>ä¸ºäº†é¿å… AOF æ–‡ä»¶è¶Šå†™è¶Šå¤§ï¼Œæä¾›äº† AOF é‡å†™æœºåˆ¶ï¼Œå½“ AOF æ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼åï¼ŒRedis å°±ä¼šå¯ç”¨ AOF é‡å†™æœºåˆ¶ï¼Œæ¥å‹ç¼© AOF æ–‡ä»¶ã€‚&lt;/p>
&lt;p>AOF é‡å†™æ—¶ï¼Œä¼šè¯»å–æ•°æ®åº“ä¸­æ‰€æœ‰çš„é”®å€¼å¯¹ï¼Œç„¶åå°†æ¯ä¸€ä¸ªé”®å€¼å¯¹ç”¨ä¸€æ¡å†™å‘½ä»¤è®°å½•åˆ° æ–°çš„ AOF æ–‡ä»¶ä¸­ï¼Œç­‰åˆ°å…¨éƒ¨è®°å½•å®Œä¹‹åï¼Œå°±å°†æ–°çš„æ–‡ä»¶æ›¿æ¢æ‰æ—§çš„é—®é¢˜ã€‚&lt;/p>
&lt;h4 id="å®ç°æ–¹å¼-1">å®ç°æ–¹å¼&lt;/h4>
&lt;p>é€šè¿‡ fork åå°å­è¿›ç¨‹å®Œæˆã€‚ä½¿ç”¨ COW æŠ€æœ¯ï¼Œå…±äº«ç‰©ç†å†…å­˜ã€‚&lt;/p>
&lt;p>åœ¨é‡å†™æœŸé—´ï¼Œä¾æ—§å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œå†™å‘½ä»¤ä¼šåŒæ—¶ä¿å­˜åœ¨ï¼ˆ1ï¼‰AOF ç¼“å­˜åŒº å’Œ ï¼ˆ2ï¼‰AOF é‡å†™ç¼“å­˜åŒºã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/persistence/aof.png"
width="940"
height="1014"
srcset="https://blog.letout.cn/p/redis/persistence/aof_huf07c02c53918ac63e75c29803edc1708_212356_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/redis/persistence/aof_huf07c02c53918ac63e75c29803edc1708_212356_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="92"
data-flex-basis="222px"
>&lt;/p>
&lt;p>æ‰§è¡Œå®Œæˆä¹‹åï¼Œå°† AOF é‡å†™ç¼“å­˜åŒºçš„å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶æ›¿æ¢æ—§çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;h2 id="-æ··åˆæŒä¹…åŒ–">ğŸ—ƒï¸ æ··åˆæŒä¹…åŒ–&lt;/h2>
&lt;p>æ··åˆæŒä¹…åŒ–å·¥ä½œåœ¨ AOF æ—¥å¿—é‡å†™è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>å½“å¼€å¯äº†æ··åˆæŒä¹…åŒ–æ—¶ï¼Œåœ¨ AOF é‡å†™æ—¥å¿—æ—¶ï¼Œ&lt;/p>
&lt;ul>
&lt;li>fork å‡ºæ¥çš„é‡å†™å­è¿›ç¨‹ä¼šå…ˆå°†ä¸ä¸»çº¿ç¨‹å…±äº«çš„å†…å­˜æ•°æ®ä»¥ RDB æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œ&lt;/li>
&lt;li>ä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ä¼šè¢«è®°å½•åœ¨é‡å†™ç¼“å†²åŒºé‡Œï¼Œé‡å†™ç¼“å†²åŒºé‡Œçš„å¢é‡å‘½ä»¤ä¼šä»¥ AOF æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œ&lt;/li>
&lt;li>å†™å…¥å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹å°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/persistence/mix.jpg"
width="325"
height="356"
srcset="https://blog.letout.cn/p/redis/persistence/mix_huce3a57336b77bba5760b97f3c77136cb_10330_480x0_resize_q75_box.jpg 480w, https://blog.letout.cn/p/redis/persistence/mix_huce3a57336b77bba5760b97f3c77136cb_10330_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="91"
data-flex-basis="219px"
>&lt;/p>
&lt;p>ä½¿ç”¨äº†æ··åˆæŒä¹…åŒ–ï¼ŒAOF æ–‡ä»¶çš„å‰åŠéƒ¨åˆ†æ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒååŠéƒ¨åˆ†æ˜¯ AOF æ ¼å¼çš„å¢é‡æ•°æ®ã€‚&lt;/p></description></item><item><title>ä»£ç†æ¨¡å¼</title><link>https://blog.letout.cn/p/design-pattern/proxy/</link><pubDate>Thu, 05 Jan 2023 20:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/design-pattern/proxy/</guid><description>&lt;img src="https://blog.letout.cn/p/design-pattern/proxy/proxy.png" alt="Featured image of post ä»£ç†æ¨¡å¼" />&lt;h2 id="-ä»‹ç»">ğŸ“– ä»‹ç»&lt;/h2>
&lt;p>ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§&lt;strong>ç»“æ„å‹æ¨¡å¼&lt;/strong>ã€‚&lt;/p>
&lt;p>ä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†æ–¹ä¾¿è®¿é—®æŸäº›èµ„æºï¼Œä½¿å¯¹è±¡ç±»æ›´åŠ æ˜“ç”¨ã€‚ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†æ§åˆ¶è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚&lt;/p>
&lt;p>å¸¸è§çš„åœºæ™¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ”– ä¹°ç«è½¦ç¥¨ä¸ä¸€å®šè¦å»ç«è½¦ç«™ï¼Œä¹Ÿå¯ä»¥å»ä»£å”®ç‚¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ”– Windows ä¸­çš„å¿«æ·æ–¹å¼ï¼ŒLinux ä¸­çš„è½¯é“¾æ¥ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ”– Spring AOPã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ”– å¸¸è§çš„ ORM æ¡†æ¶ï¼Œåªè¦å®šä¹‰ç›¸å…³çš„æ¥å£ï¼Œè€Œä¸éœ€è¦å†™å®ç°ç±»ï¼Œå°±å¯ä»¥å¯¹ XML æˆ–æ³¨è§£ä¸­çš„ SQL è¯­å¥è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ”– ä¸€äº›ä¸­é—´ä»¶å¦‚ RPC æ¡†æ¶ï¼Œåœ¨æ‹¿åˆ° jar åŒ…ä¸­å¯¹æ¥å£çš„æè¿°åï¼Œä¸­é—´ä»¶ä¼šå­—æœåŠ¡å¯åŠ¨æ—¶ï¼Œç”Ÿæˆå¯¹åº”çš„ä»£ç†ç±»ã€‚å½“è°ƒç”¨æ¥å£æ—¶ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ä»£ç†ç±»å‘å‡ºçš„ Socket ä¿¡æ¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-å®ç°æ–¹å¼">ğŸˆ å®ç°æ–¹å¼&lt;/h2>
&lt;p>&lt;img src="https://blog.letout.cn/p/design-pattern/proxy/structure.png"
width="1319"
height="630"
srcset="https://blog.letout.cn/p/design-pattern/proxy/structure_hu34461378bd86a4cce257496a3fe5af00_116540_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/design-pattern/proxy/structure_hu34461378bd86a4cce257496a3fe5af00_116540_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="209"
data-flex-basis="502px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ—ï¸ æ–¹æ³•ï¼ˆ1ï¼‰ï¼šæŠ½å–æ¥å£ï¼Œä»£ç†å¯¹è±¡å’ŒæœåŠ¡å¯¹è±¡å®ç°åŒä¸€ä¸ªæ¥å£ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ—ï¸ æ–¹æ³•ï¼ˆ2ï¼‰ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µéƒ½èƒ½æŠ½å–æ¥å£ï¼ˆå¦‚ä»£ç æ”¹åŠ¨å¾ˆå¤§ã€ä¸èƒ½ä¿®æ”¹æœåŠ¡ç±»ï¼‰ï¼Œå¯ä»¥å°†ä»£ç†ç±»ä½œä¸ºæœåŠ¡ç±»çš„å­ç±»ï¼Œè®©ä»£ç†ç±»ç»§æ‰¿æœåŠ¡ç±»çš„æ‰€æœ‰æ¥å£ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ—ï¸ åˆ›å»ºä»£ç†ç±»ï¼Œä»£ç†ç±»ä¸­å¿…é¡»åŒ…å«ä¸€ä¸ªæœåŠ¡ç±»çš„æˆå‘˜å˜é‡ï¼Œè´Ÿè´£æœåŠ¡ç±»çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚ï¼ˆå¯é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥ï¼Œæˆ–åœ¨å†…éƒ¨åˆ›å»ºï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ—ï¸ æ ¹æ®éœ€æ±‚å®ç°ä»£ç†æ–¹æ³•ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä»£ç†æ–¹æ³•ä¼šè°ƒç”¨æœåŠ¡å¯¹è±¡çš„åŒåæ–¹æ³•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ğŸš¦ å¯è€ƒè™‘è®¾è®¡é€‰é¡¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ„å»ºä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå®¢æˆ·ç«¯åˆ¤æ–­è·å¾—çš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œè¿˜æ˜¯å®é™…æœåŠ¡å¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»£ç†å¯¹è±¡ä¸­æœåŠ¡å¯¹è±¡å¯ä»¥è€ƒè™‘å»¶è¿Ÿåˆå§‹åŒ–ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-java-ä¸­çš„åŠ¨æ€ä»£ç†">â˜• Java ä¸­çš„åŠ¨æ€ä»£ç†&lt;/h2>
&lt;p>åœ¨ Java æ ‡å‡†åº“ä¸­ï¼Œæä¾›äº†åŠ¨æ€ä»£ç†åŠŸèƒ½ï¼Œå…è®¸åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºä¸€ä¸ªæ¥å£çš„å®ä¾‹ã€‚å…¶å®å°±æ˜¯ JVM åœ¨è¿è¡ŒæœŸé—´ï¼ŒåŠ¨æ€åˆ›å»º class å­—èŠ‚ç å¹¶åŠ è½½çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>åŠ¨æ€ä»£ç†é€šè¿‡ &lt;code>Proxy&lt;/code> åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œç„¶åå°†æ¥å£æ–¹æ³•â€œä»£ç†â€ç»™ &lt;code>InvocationHandler&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">InvocationHandler&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">proxy&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Method&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">Throwable&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Proxy
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">newProxyInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ClassLoader&lt;/span> &lt;span class="n">loader&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;[]&lt;/span> &lt;span class="n">interfaces&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">InvocationHandler&lt;/span> &lt;span class="n">h&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IllegalArgumentException&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨è¿è¡ŒæœŸé—´åˆ›å»ºä¸€ä¸ª &lt;code>interface&lt;/code> å®ä¾‹çš„æ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å®šä¹‰ä¸€ä¸ª &lt;code>InvocationHandler&lt;/code> å®ä¾‹ï¼Œè´Ÿè´£å®ç°æ¥å£çš„æ–¹æ³•è°ƒç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€šè¿‡ &lt;code>Proxy.newProxyInstance()&lt;/code> åˆ›å»º &lt;code>interface&lt;/code> å®ä¾‹&lt;/p>
&lt;ul>
&lt;li>&lt;code>ClassLoader loader&lt;/code> ç±»åŠ è½½å™¨ï¼ˆå¦‚å½“å‰ç±»çš„ç±»åŠ è½½å™¨ï¼š&lt;code>CurrentProxy.class.getClassLoader()&lt;/code>ï¼‰&lt;/li>
&lt;li>&lt;code>Class&amp;lt;?&amp;gt;[] interfaces&lt;/code> éœ€è¦å®ç°çš„æ¥å£çš„æ•°ç»„ï¼ˆä»£ç†çš„å¯¹è±¡æ˜¯å®ç°äº†å“ªä¸ªæ¥å£ï¼‰&lt;/li>
&lt;li>&lt;code>InvocationHandler h&lt;/code> ç”¨æ¥å¤„ç†æ¥å£æ–¹æ³•è°ƒç”¨çš„ &lt;code>InvocationHandler&lt;/code> å®ä¾‹ï¼ˆç”Ÿæˆçš„ä»£ç†å¯¹è±¡ä¸­çš„ä»£ç†æ–¹æ³•ï¼Œéœ€è¦åšä»€ä¹ˆï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>è¿”å›ä¸€ä¸ª &lt;code>Object&lt;/code>ï¼Œå¯å¼ºåˆ¶è½¬å‹ä¸ºæ¥å£ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ¨¡æ‹Ÿç»çºªäººä»£ç†æ­Œæ‰‹çš„åœºæ™¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">Star&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">class&lt;/span> &lt;span class="n">Eason&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Star&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// éœ€è¦è¢«ä»£ç†çš„ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ProxyDemo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Star&lt;/span> &lt;span class="nf">createProxy&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Star&lt;/span> &lt;span class="n">star&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// åˆ›å»ºä»£ç†å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Star&lt;/span> &lt;span class="n">starProxy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Star&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">Proxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newProxyInstance&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ProxyDemo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getClassLoader&lt;/span>&lt;span class="o">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">[]{&lt;/span>&lt;span class="n">Star&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">InvocationHandler&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">proxy&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Method&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">Throwable&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ä»£ç†æ–¹æ³•éœ€è¦åšçš„äº‹æƒ…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// æ’é™¤ Object ä¸­çš„é€šç”¨æ–¹æ³•ï¼Œä¸è¿›è¡Œä»£ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaringClass&lt;/span>&lt;span class="o">()))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">methodName&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">methodName&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;sing&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">star&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">methodName&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;dance&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">starProxy&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-é€‚åˆåœºæ™¯">ğŸ² é€‚åˆåœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>ğŸ¨ å»¶è¿Ÿåˆå§‹åŒ–ã€‚å°†å¯¹è±¡çš„åˆå§‹åŒ–å»¶è¿Ÿåˆ°çœŸæ­£æœ‰éœ€è¦çš„æ—¶å€™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ¨ è®¿é—®æ§åˆ¶ã€‚ä»£ç†å¯ä»…åœ¨å®¢æˆ·ç«¯å‡­æ®æ»¡è¶³è¦æ±‚æ—¶å°†è¯·æ±‚ä¼ é€’ç»™æœåŠ¡å¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ¨ æœ¬åœ°æ‰§è¡Œè¿œç¨‹æœåŠ¡ ï¼ˆè¿œç¨‹ä»£ç†ï¼‰ã€‚é€‚ç”¨äºæœåŠ¡å¯¹è±¡ä½äºè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æƒ…å½¢ã€‚ä»£ç†é€šè¿‡ç½‘ç»œä¼ é€’å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰ä¸ç½‘ç»œç›¸å…³çš„å¤æ‚ç»†èŠ‚ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ¨ è®°å½•æ—¥å¿—è¯·æ±‚ï¼ˆæ—¥å¿—è®°å½•ä»£ç†ï¼‰ã€‚å¦‚éœ€è¦ä¿å­˜å¯¹äºæœåŠ¡å¯¹è±¡çš„è¯·æ±‚å†å²è®°å½•æ—¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ¨ ç¼“å­˜è¯·æ±‚ç»“æœï¼ˆç¼“å­˜ä»£ç†ï¼‰ã€‚ å¦‚å¯å¯¹é‡å¤è¯·æ±‚æ‰€éœ€çš„ç›¸åŒç»“æœè¿›è¡Œç¼“å­˜ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-å‚è€ƒ">ğŸ”— å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://refactoringguru.cn/design-patterns/proxy" target="_blank" rel="noopener"
>https://refactoringguru.cn/design-patterns/proxy&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://bugstack.cn/md/develop/design-pattern/2020-06-16-%E9%87%8D%E5%AD%A6%20Java%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8A%E5%AE%9E%E6%88%98%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E3%80%8B.html" target="_blank" rel="noopener"
>https://bugstack.cn/md/develop/design-pattern/2020-06-16-%E9%87%8D%E5%AD%A6%20Java%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8A%E5%AE%9E%E6%88%98%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E3%80%8B.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.runoob.com/design-pattern/proxy-pattern.html" target="_blank" rel="noopener"
>https://www.runoob.com/design-pattern/proxy-pattern.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.liaoxuefeng.com/wiki/1252599548343744/1264804593397984" target="_blank" rel="noopener"
>https://www.liaoxuefeng.com/wiki/1252599548343744/1264804593397984&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ThreadLocal</title><link>https://blog.letout.cn/p/thread/threadlocal/</link><pubDate>Fri, 02 Sep 2022 16:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/thread/threadlocal/</guid><description>&lt;img src="https://blog.letout.cn/imgs/19.jpeg" alt="Featured image of post ThreadLocal" />&lt;h2 id="javalangthreadlocal">java.lang.ThreadLocal&lt;/h2>
&lt;p>ThreadLocal æ˜¯ä¸€ä¸ªåˆ›å»ºçº¿ç¨‹å±€éƒ¨å˜é‡çš„ç±»ã€‚&lt;/p>
&lt;p>é€šå¸¸åˆ›å»ºçš„å…±äº«å˜é‡æ˜¯å¯ä»¥è¢«ä»»ä¸€ä¸ªçº¿ç¨‹è®¿é—®å¹¶ä¿®æ”¹çš„ï¼Œå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä½¿ç”¨ ThreadLocal åˆ›å»ºçš„å˜é‡åªæœ‰å½“å‰çº¿ç¨‹æ‰å¯è®¿é—®ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•ä¿®æ”¹å’Œè®¿é—®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">DateUtils&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">DateFormat&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡å†™ initialValue å¯è®¾ç½®åˆå§‹å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">protected&lt;/span> &lt;span class="n">DateFormat&lt;/span> &lt;span class="nf">initialValue&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SimpleDateFormat&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;yyyy-MM-dd&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DateUtils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">format&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">Date&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åŸç†">åŸç†&lt;/h2>
&lt;p>æ¯ä¸€ä¸ªçº¿ç¨‹çš„ Thread å¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ª &lt;code>ThreadLocal.ThreadLocalMap&lt;/code> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å­˜å‚¨äº†ä¸€ç»„ä»¥ &lt;code>ThreadLocal.threadLocalHashCode&lt;/code> ä¸ºé”®ï¼Œä»¥æœ¬åœ°çº¿ç¨‹å˜é‡ä¸ºå€¼çš„ &lt;code>Key-Value&lt;/code> å¯¹ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/thread/threadlocal/threadlocalmap.png"
width="561"
height="327"
srcset="https://blog.letout.cn/p/thread/threadlocal/threadlocalmap_hu2f3b0d366a0f121060908fa4912e4768_16111_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/thread/threadlocal/threadlocalmap_hu2f3b0d366a0f121060908fa4912e4768_16111_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="threadlocalmap"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="411px"
>&lt;/p>
&lt;p>&lt;code>ThreadLocal&lt;/code> å¯¹è±¡å°±æ˜¯å½“å‰çº¿ç¨‹çš„ &lt;code>ThreadLocalMap&lt;/code> çš„è®¿é—®å…¥å£ï¼Œæ¯ä¸€ä¸ª &lt;code>ThreadLocal&lt;/code> å¯¹è±¡éƒ½åŒ…å«äº†ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ &lt;code>threadLocalHashCode&lt;/code> å€¼ï¼Œä½¿ç”¨è¿™ä¸ªå€¼ï¼Œå°±å¯ä»¥åœ¨çº¿ç¨‹ &lt;code>K-V&lt;/code> å€¼å¯¹ä¸­æ‰¾åˆ°å¯¹åº”çš„æœ¬åœ°çº¿ç¨‹å˜é‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Thread&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ThreadLocalMap&lt;/span> &lt;span class="n">threadLocals&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ThreadLocalMap&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Entry&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">WeakReference&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Enrty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">super&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">Enrty&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">table&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="set">set()&lt;/h3>
&lt;ul>
&lt;li>è·å–å½“å‰çº¿ç¨‹&lt;/li>
&lt;li>åˆ©ç”¨å½“å‰çº¿ç¨‹ä½œä¸ºå¥æŸ„ï¼Œè·å–ä¸€ä¸ª ThreadLocalMap å¯¹è±¡&lt;/li>
&lt;li>å¦‚æœ ThreadLocalMap å¯¹è±¡ä¸ä¸ºç©ºï¼Œåˆ™è®¾ç½®å€¼ï¼Œå¦åˆ™åˆ›å»ºè¿™ä¸ª ThreadLocalMap å¯¹è±¡å¹¶è®¾ç½®å€¼&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">T&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadLocalMap&lt;/span> &lt;span class="n">map&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">createMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">ThreadLocalMap&lt;/span> &lt;span class="nf">getMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">threadLocals&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="nf">createMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="n">firstValue&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">t&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">threadLocals&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadLocalMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">firstValue&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="get">get()&lt;/h3>
&lt;ul>
&lt;li>è·å–å½“å‰çº¿ç¨‹ï¼Œå¹¶è·å–å½“å‰çº¿ç¨‹çš„ ThreadLocalMap å¯¹è±¡&lt;/li>
&lt;li>å¦‚æœå½“å‰çº¿ç¨‹çš„ ThreadLocalMap å·²ç»åˆå§‹åŒ–ï¼Œè¿”å›å½“å‰ ThreadLocal ä¸º Key çš„å€¼&lt;/li>
&lt;li>å¦‚æœ ThreadLocalMap æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œæˆ–è€…ä¸å­˜åœ¨ä»¥ ThreadLocal ä¸º Key çš„å€¼ï¼Œå°†åˆ›å»ºä¸€ä¸ªæ–°çš„ Valueï¼Œå¹¶è¿”å›&lt;/li>
&lt;li>initialValue é»˜è®¤ä¸º nullï¼Œå¯è¿›è¡Œé‡å†™&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ThreadLocal#get
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="nf">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadLocalMap&lt;/span> &lt;span class="n">map&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadLocalMap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getEntry&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@SuppressWarnings&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;unchecked&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">T&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">)&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">setInitialValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ThreadLocal#setInitialValue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">private&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="nf">setInitialValue&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">T&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">initialValue&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// è·å¾—ä¸€ä¸ªåˆå§‹å€¼ï¼Œæœªé‡å†™é»˜è®¤ä¸º null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadLocalMap&lt;/span> &lt;span class="n">map&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">createMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ThreadLocal#initialValue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">protected&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="nf">initialValue&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// é»˜è®¤ä¸º nullï¼Œå¯è¢«é‡å†™
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ThreadLocalMap#createMap
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="nf">createMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="n">firstValue&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">t&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">threadLocals&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadLocalMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">firstValue&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="remove">remove()&lt;/h3>
&lt;ul>
&lt;li>é€šè¿‡è°ƒç”¨ ThreadLocalMap çš„ remove() æ–¹æ³•å®Œæˆç§»é™¤æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">remove&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadLocalMap&lt;/span> &lt;span class="n">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">m&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ThreadLocalMap remove()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">remove&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Entry&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">tab&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">table&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">threadLocalHashCode&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Entry&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tab&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tab&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nextIndex&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">len&lt;/span>&lt;span class="o">)])&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">clear&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">expungeStaleEntry&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å†…å­˜æ³„éœ²">å†…å­˜æ³„éœ²&lt;/h2>
&lt;p>æŒ‡ç¨‹åºç”³è¯·å†…å­˜åï¼Œä¸€ç›´æ— æ³•é‡Šæ”¾å·²ç»ç”³è¯·çš„å†…å­˜ã€‚&lt;/p>
&lt;p>ThreadLocalMap ä½¿ç”¨ ThreadLocal çš„å¼±å¼•ç”¨ä½œä¸º keyï¼Œå¦‚æœä¸€ä¸ª ThreadLocal ä¸å­˜åœ¨å¤–éƒ¨çš„å¼ºå¼•ç”¨æ—¶ï¼Œä¸‹æ¬¡ GC æ—¶ï¼Œè¯¥ key å°±ä¼šè¢«å›æ”¶ï¼Œä½†æ˜¯ value è¿˜å­˜åœ¨ç€å¼ºå¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨åœ° remove() æˆ–è€…çº¿ç¨‹ä¸€ç›´æ²¡æœ‰ç»“æŸï¼ˆä¾‹å¦‚ä½¿ç”¨çº¿ç¨‹æ± ï¼‰ï¼Œvalue å°±ä¼šä¸€ç›´å­˜åœ¨ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/thread/threadlocal/threadlocal.png"
width="691"
height="425"
srcset="https://blog.letout.cn/p/thread/threadlocal/threadlocal_hu332fd7c00cd887225a3bcbd94cc1cc52_26526_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/thread/threadlocal/threadlocal_hu332fd7c00cd887225a3bcbd94cc1cc52_26526_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="threadlocal"
class="gallery-image"
data-flex-grow="162"
data-flex-basis="390px"
>&lt;/p>
&lt;p>è§£å†³åŠæ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ¯æ¬¡ä½¿ç”¨å®Œåè¿›è¡Œ remove()&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨ set()ã€get() æ—¶ï¼ˆéƒ¨åˆ†ï¼‰ï¼Œæ‰©å®¹ rehash() æ—¶ï¼ˆå…¨é‡ï¼‰ï¼Œä¼šåˆ¤æ–­å¯¹ key=null çš„è¿›è¡Œæ¸…ç†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ä»¥å°† ThreadLocal è®¾ç½®ä¸º staic final&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">rehash&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è¿›è¡Œå…¨é‡æ¸…ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">expungeStaleEntries&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">size&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">threshold&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">threshold&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resize&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">expungeStaleEntries&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Entry&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">tab&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">table&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">len&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Entry&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tab&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">expungeStaleEntry&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>çº¿ç¨‹èµ„æºæŒæœ‰ï¼Œä»£æ›¿å‚æ•°æ˜¾ç¤ºä¼ é€’&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…¨å±€å­˜å‚¨ä¿¡æ¯ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹ç›´æ¥è·å–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œè¾¾åˆ°çº¿ç¨‹éš”ç¦»&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>ğŸ”— &lt;a class="link" href="https://www.cnblogs.com/crazymakercircle/p/14491965.html#autoid-h2-2-0-0" target="_blank" rel="noopener"
>https://www.cnblogs.com/crazymakercircle/p/14491965.html#autoid-h2-2-0-0&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>JVM å†…å­˜åŒºåŸŸ</title><link>https://blog.letout.cn/p/java/jvm/memory-area/</link><pubDate>Mon, 08 Aug 2022 15:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/java/jvm/memory-area/</guid><description>&lt;img src="https://blog.letout.cn/imgs/27.jpeg" alt="Featured image of post JVM å†…å­˜åŒºåŸŸ" />&lt;ul>
&lt;li>
&lt;p>çº¿ç¨‹éš”ç¦»&lt;/p>
&lt;ul>
&lt;li>ç¨‹åºè®¡æ•°å™¨&lt;/li>
&lt;li>è™šæ‹Ÿæœºæ ˆ&lt;/li>
&lt;li>æœ¬åœ°æ–¹æ³•æ ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>çº¿ç¨‹å…±äº«&lt;/p>
&lt;ul>
&lt;li>æ–¹æ³•åŒº&lt;/li>
&lt;li>å †&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/memory-area/area.png"
width="875"
height="550"
srcset="https://blog.letout.cn/p/java/jvm/memory-area/area_hu77c5f146be5bf31c819ffe7a07cc3500_205102_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/memory-area/area_hu77c5f146be5bf31c819ffe7a07cc3500_205102_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="area"
class="gallery-image"
data-flex-grow="159"
data-flex-basis="381px"
>&lt;/p>
&lt;h2 id="-ç¨‹åºè®¡æ•°å™¨">ğŸ‹ ç¨‹åºè®¡æ•°å™¨&lt;/h2>
&lt;p>å½“å‰çº¿ç¨‹æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚&lt;/p>
&lt;p>å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç° &lt;code>OutOfMemoryError&lt;/code> çš„å†…å­˜åŒºåŸŸï¼Œéšçº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšçº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚&lt;/p>
&lt;h2 id="-è™šæ‹Ÿæœºæ ˆ">ğŸ‹ è™šæ‹Ÿæœºæ ˆ&lt;/h2>
&lt;p>æ¯ä¸€æ¬¡æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„æ ˆå¸§è¢«å‹å…¥æ ˆä¸­ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ç»“æŸåï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆå¸§è¢«å¼¹å‡ºã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/memory-area/stack.png"
width="302"
height="551"
srcset="https://blog.letout.cn/p/java/jvm/memory-area/stack_hu387fe9e9614436cd46058aff5c85565a_61440_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/memory-area/stack_hu387fe9e9614436cd46058aff5c85565a_61440_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="stack"
class="gallery-image"
data-flex-grow="54"
data-flex-basis="131px"
>&lt;/p>
&lt;p>å½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæœ€å¤§æ·±åº¦æ—¶ï¼Œä¼šæŠ›å‡º &lt;code>StackOverFlowError&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>å±€éƒ¨å˜é‡è¡¨&lt;/li>
&lt;/ul>
&lt;p>å­˜æ”¾ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹ï¼Œå¯¹è±¡å¼•ç”¨åœ°å€ã€‚&lt;/p>
&lt;ul>
&lt;li>æ“ä½œæ•°æ ˆ&lt;/li>
&lt;/ul>
&lt;p>æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è®¡ç®—ç»“æœï¼Œè®¡ç®—è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ã€‚&lt;/p>
&lt;ul>
&lt;li>åŠ¨æ€é“¾æ¥&lt;/li>
&lt;/ul>
&lt;p>æœåŠ¡äºä¸€ä¸ªæ–¹æ³•éœ€è¦è°ƒç”¨å…¶ä»–æ–¹æ³•çš„åœºæ™¯ã€‚&lt;/p>
&lt;ul>
&lt;li>æ–¹æ³•è¿”å›åœ°å€
&lt;ul>
&lt;li>æ­£å¸¸è¿”å›&lt;/li>
&lt;li>å¼‚å¸¸è¿”å›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-æœ¬åœ°æ–¹æ³•æ ˆ">ğŸ‹ æœ¬åœ°æ–¹æ³•æ ˆ&lt;/h2>
&lt;p>æœ¬åœ°æ–¹æ³•æ ˆç”¨äºè™šæ‹Ÿæœºæ‰§è¡Œ Native æ–¹æ³•ï¼Œå…·ä½“ä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ã€‚&lt;/p>
&lt;h2 id="-æ–¹æ³•åŒº">ğŸ æ–¹æ³•åŒº&lt;/h2>
&lt;p>æ–¹æ³•åŒºæ˜¯ Java è™šæ‹Ÿæœºçš„æŠ½è±¡æ¦‚å¿µã€‚å®ç°æ–¹å¼åœ¨ä¸åŒè™šæ‹Ÿæœºä¸­å¯èƒ½ä¸åŒã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>JDK 8 ä¹‹å‰ï¼ŒHotSpot è™šæ‹Ÿæœºä½¿ç”¨æ°¸ä¹…å¸¦å®ç°æ–¹æ³•åŒº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>JDK 8 åŠä¹‹åï¼Œä½¿ç”¨å…ƒç©ºé—´ï¼ˆç›´æ¥å†…å­˜ï¼‰å®ç°&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/memory-area/function-before.png"
width="382"
height="436"
srcset="https://blog.letout.cn/p/java/jvm/memory-area/function-before_hu5ba856b5fa83b596c5da12a50d62fcb1_75748_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/memory-area/function-before_hu5ba856b5fa83b596c5da12a50d62fcb1_75748_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="before"
class="gallery-image"
data-flex-grow="87"
data-flex-basis="210px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/memory-area/function-after.png"
width="484"
height="433"
srcset="https://blog.letout.cn/p/java/jvm/memory-area/function-after_hue0bd0747c11f9c8962eb0e412965ba30_84329_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/memory-area/function-after_hue0bd0747c11f9c8962eb0e412965ba30_84329_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="after"
class="gallery-image"
data-flex-grow="111"
data-flex-basis="268px"
>&lt;/p>
&lt;ul>
&lt;li>ç±»çš„å…ƒä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;p>ç±»åï¼Œè®¿é—®ä¿®é¥°ç¬¦ï¼Œå­—æ®µæè¿°ï¼Œæ–¹æ³•æè¿°ç­‰&lt;/p>
&lt;ul>
&lt;li>è¿è¡Œæ—¶å¸¸é‡æ± &lt;/li>
&lt;/ul>
&lt;p>å­˜æ”¾ç¼–è¯‘åçš„å„ç§å­—é¢é‡ï¼Œç¬¦å·å¼•ç”¨ï¼Œå¸¸é‡ï¼ˆfinalï¼‰æ± è¡¨ç­‰&lt;/p>
&lt;ul>
&lt;li>å­—ç¬¦ä¸²å¸¸é‡æ± &lt;/li>
&lt;/ul>
&lt;p>JVM ä¸ºäº†å‡å°‘å­—ç¬¦ä¸²å¯¹å†…å­˜çš„æ¶ˆè€—ï¼Œå¹¶æå‡æ€§èƒ½ï¼Œä¸“é—¨å¼€è¾Ÿçš„åŒºåŸŸ&lt;/p>
&lt;ul>
&lt;li>é™æ€å˜é‡&lt;/li>
&lt;/ul>
&lt;p>ç±»å˜é‡ï¼ˆstaticï¼‰&lt;/p>
&lt;h2 id="-å †">ğŸ å †&lt;/h2>
&lt;p>ç”¨æ¥å­˜æ”¾å’Œç®¡ç†å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…ã€‚
ï¼ˆå­˜åœ¨é€ƒé€¸åˆ†æï¼Œæ ˆä¸Šåˆ†é…ï¼Œæœ‰äº›å¯¹è±¡ä¸ä¼šåœ¨å †ä¸­ï¼‰&lt;/p>
&lt;p>Java å †æ˜¯åƒåœ¾å›æ”¶çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸º GC å †ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>JDK 8 ä¹‹å‰ï¼Œå †è¢«åˆ†ä¸º&lt;/p>
&lt;ul>
&lt;li>æ–°ç”Ÿä»£ï¼ˆEdenã€Survivor0ã€Survivor1ï¼‰&lt;/li>
&lt;li>è€å¹´ä»£&lt;/li>
&lt;li>æ°¸ä¹…ä»£&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>JDK 8 ä¹‹åï¼Œæ°¸ä¹…ä»£è¢«å–æ¶ˆ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯¹è±¡é¦–å…ˆä¼šåœ¨ Eden åŒºè¿›è¡Œåˆ†é…ï¼›åœ¨ä¸€æ¬¡åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œä¼šè¿›å…¥ S0 æˆ– S1ï¼›å½“å¯¹è±¡å¹´é¾„å¢é•¿åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ 15ï¼‰ï¼Œæˆ–ç´¯ç§¯çš„å¹´é¾„è¶…è¿‡äº† Survivor çš„ä¸€åŠï¼Œä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚&lt;/p></description></item><item><title>JVM åƒåœ¾å›æ”¶</title><link>https://blog.letout.cn/p/java/jvm/garbage-collection/</link><pubDate>Sun, 07 Aug 2022 12:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/java/jvm/garbage-collection/</guid><description>&lt;img src="https://blog.letout.cn/imgs/26.jpeg" alt="Featured image of post JVM åƒåœ¾å›æ”¶" />&lt;h2 id="-å¯¹è±¡å­˜æ´»åˆ¤å®š">ğŸŒ´ å¯¹è±¡å­˜æ´»åˆ¤å®š&lt;/h2>
&lt;h3 id="-å¼•ç”¨è®¡æ•°æ³•">ğŸª¨ å¼•ç”¨è®¡æ•°æ³•&lt;/h3>
&lt;p>ç»™æ¯ä¸ªå¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼š&lt;/p>
&lt;ul>
&lt;li>å½“æœ‰åœ°æ–¹å¼•ç”¨è¯¥å¯¹è±¡ï¼Œè®¡æ•°å™¨ &lt;code>+1&lt;/code>&lt;/li>
&lt;li>å½“å¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨ &lt;code>-1&lt;/code>&lt;/li>
&lt;li>å½“è®¡æ•°å™¨ä¸º &lt;code>0&lt;/code> æ—¶ï¼Œè¡¨ç¤ºå¯¹è±¡ä¸å¯ç”¨&lt;/li>
&lt;/ul>
&lt;p>è¯¥æ–¹æ³•ç®€å•é«˜æ•ˆï¼Œä½†ä¸»æµçš„è™šæ‹Ÿæœºéƒ½æ²¡æœ‰é€‰æ‹©è¯¥æ–¹æ³•ç®¡ç†å†…å­˜ï¼Œéš¾ä»¥è§£å†³å¯¹è±¡ä¹‹é—´å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="-å¯è¾¾æ€§åˆ†ææ³•">ğŸª¨ å¯è¾¾æ€§åˆ†ææ³•&lt;/h3>
&lt;p>é€šè¿‡ä¸€ç³»åˆ—ç§°ä¸º &lt;code>GC Root&lt;/code> çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èµ·ç‚¹å‘ä¸‹æœç´¢ï¼ŒèŠ‚ç‚¹èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡ä¸ &lt;code>GC Root&lt;/code> ä¹‹é—´æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„è¯ï¼Œè¯´æ˜å¯¹è±¡ä¸å¯ç”¨ï¼Œéœ€è¦è¢«å›æ”¶ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/garbage-collection/gcroot.png"
width="935"
height="581"
srcset="https://blog.letout.cn/p/java/jvm/garbage-collection/gcroot_hud8e4c62b0ef63778b91f8329965428a2_102739_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/garbage-collection/gcroot_hud8e4c62b0ef63778b91f8329965428a2_102739_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="gcroot"
class="gallery-image"
data-flex-grow="160"
data-flex-basis="386px"
>&lt;/p>
&lt;p>å¯ä»¥ä½œä¸º &lt;code>GC Root&lt;/code> çš„å¯¹è±¡ï¼š&lt;/p>
&lt;ul>
&lt;li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­å±€éƒ¨å˜é‡è¡¨ï¼‰å¼•ç”¨çš„å¯¹è±¡&lt;/li>
&lt;li>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡&lt;/li>
&lt;li>ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡&lt;/li>
&lt;li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡&lt;/li>
&lt;li>æ‰€æœ‰è¢«åŒæ­¥é”ï¼ˆsynchronizedï¼‰æŒæœ‰çš„å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="-åƒåœ¾å›æ”¶ç®—æ³•">ğŸŒ´ åƒåœ¾å›æ”¶ç®—æ³•&lt;/h2>
&lt;h3 id="-æ ‡è®°-æ¸…é™¤">ğŸªµ æ ‡è®°-æ¸…é™¤&lt;/h3>
&lt;ul>
&lt;li>æ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡&lt;/li>
&lt;li>æ ‡è®°ç»“æŸåï¼Œç»Ÿä¸€å›æ”¶æ‰æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/garbage-collection/clear.png"
width="962"
height="488"
srcset="https://blog.letout.cn/p/java/jvm/garbage-collection/clear_hu3ebff86a38831b55ce513a2b74335841_65435_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/garbage-collection/clear_hu3ebff86a38831b55ce513a2b74335841_65435_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="clear"
class="gallery-image"
data-flex-grow="197"
data-flex-basis="473px"
>&lt;/p>
&lt;ul>
&lt;li>æ‰§è¡Œæ•ˆç‡ä¸ç¨³å®šï¼Œå¤§éƒ¨åˆ†å¯¹è±¡éœ€è¦å›æ”¶æ—¶ï¼Œéœ€è¦å¤§é‡æ ‡è®°å’Œæ¸…é™¤æ“ä½œ&lt;/li>
&lt;li>å†…å­˜ç©ºé—´ç¢ç‰‡åŒ–é—®é¢˜&lt;/li>
&lt;/ul>
&lt;h3 id="-æ ‡è®°-å¤åˆ¶">ğŸªµ æ ‡è®°-å¤åˆ¶&lt;/h3>
&lt;ul>
&lt;li>å°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—&lt;/li>
&lt;li>å½“ä¸€å—å†…å­˜ä½¿ç”¨å®Œåï¼Œå°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—å»&lt;/li>
&lt;li>å°†ä»¥ä½¿ç”¨çš„ç©ºé—´ä¸€æ¬¡æ€§æ¸…é™¤æ‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/garbage-collection/copy.png"
width="955"
height="495"
srcset="https://blog.letout.cn/p/java/jvm/garbage-collection/copy_hu6b5a3b19d23e61d87d481fdc4629a5cf_68281_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/garbage-collection/copy_hu6b5a3b19d23e61d87d481fdc4629a5cf_68281_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="copy"
class="gallery-image"
data-flex-grow="192"
data-flex-basis="463px"
>&lt;/p>
&lt;ul>
&lt;li>å¯ç”¨å†…å­˜å˜å°‘ï¼Œæœ‰ç©ºé—´æµªè´¹é—®é¢˜&lt;/li>
&lt;/ul>
&lt;h3 id="-æ ‡è®°-æ•´ç†">ğŸªµ æ ‡è®°-æ•´ç†&lt;/h3>
&lt;ul>
&lt;li>æ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡&lt;/li>
&lt;li>è®©è¿™äº›å­˜æ´»å¯¹è±¡å‘å†…å­˜çš„ä¸€ç«¯ç§»åŠ¨&lt;/li>
&lt;li>ç›´æ¥æ¸…é™¤æ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/garbage-collection/move.png"
width="944"
height="480"
srcset="https://blog.letout.cn/p/java/jvm/garbage-collection/move_hu0eec74bf9ebb0cbf4f6fd4cbe2be3a39_63153_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/garbage-collection/move_hu0eec74bf9ebb0cbf4f6fd4cbe2be3a39_63153_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="move"
class="gallery-image"
data-flex-grow="196"
data-flex-basis="472px"
>&lt;/p>
&lt;h3 id="-åˆ†ä»£æ”¶é›†">ğŸªµ åˆ†ä»£æ”¶é›†&lt;/h3>
&lt;p>æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒï¼Œå°† Java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œä¾æ®å„ä¸ªåŒºåŸŸçš„ç‰¹ç‚¹ï¼Œé€‰æ‹©å›æ”¶ç®—æ³•ã€‚&lt;/p>
&lt;ul>
&lt;li>åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡æ”¶é›†éƒ½ä¼šæœ‰å¤§é‡çš„å¯¹è±¡æ­»å»ï¼Œé€‰æ‹© &lt;code>æ ‡è®°-å¤åˆ¶&lt;/code> ç®—æ³•&lt;/li>
&lt;li>åœ¨è€å¹´ä»£ä¸­ï¼Œå­˜æ´»å¯¹è±¡çš„å‡ ç‡è¾ƒé«˜ï¼Œæ²¡æœ‰é¢å¤–çš„ç©ºé—´è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œé€‰æ‹© &lt;code>æ ‡è®°-æ¸…é™¤&lt;/code> æˆ– &lt;code>æ ‡è®°-æ•´ç†&lt;/code> ç®—æ³•&lt;/li>
&lt;/ul>
&lt;h2 id="-åƒåœ¾æ”¶é›†æ–¹å¼">ğŸŒ´ åƒåœ¾æ”¶é›†æ–¹å¼&lt;/h2>
&lt;h3 id="-éƒ¨åˆ†æ”¶é›†">ğŸª¨ éƒ¨åˆ†æ”¶é›†&lt;/h3>
&lt;p>æ”¶é›†å †éƒ¨åˆ†åŒºåŸŸã€‚&lt;code>Partial GC&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ–°ç”Ÿä»£æ”¶é›† &lt;code>Minor GC / Young GC&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ç›®æ ‡åªæ˜¯æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†ã€‚&lt;/p>
&lt;ul>
&lt;li>è€å¹´ä»£æ”¶é›† &lt;code>Major GC / Old GC&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ç›®æ ‡åªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œç›®å‰åªæœ‰ CMS æ”¶é›†å™¨ä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚&lt;/p>
&lt;ul>
&lt;li>æ··åˆæ”¶é›† &lt;code>Mixed GC&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ç›®æ ‡æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£å’Œéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œç›®å‰åªæœ‰ G1 æ”¶é›†å™¨ä¼šæœ‰è¿™ç§è¡Œä¸ºã€‚&lt;/p>
&lt;h3 id="-æ•´å †æ”¶é›†">ğŸª¨ æ•´å †æ”¶é›†&lt;/h3>
&lt;p>æ”¶é›†æ•´ä¸ªå †å’Œæ–¹æ³•åŒºã€‚&lt;code>Full GC&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§äºè€å¹´ä»£çš„å‰©ä½™ç©ºé—´&lt;/li>
&lt;li>Minor GC åï¼Œæ–°ç”Ÿä»£å­˜æ´»å¯¹è±¡è¶…è¿‡äº†è€å¹´ä»£çš„ç©ºé—´ï¼ˆåˆ†é…æ‹…ä¿æœºåˆ¶ï¼‰&lt;/li>
&lt;li>æ‰‹åŠ¨ System.gc()&lt;/li>
&lt;li>ï¼ˆJava 8 ä¹‹å‰ï¼‰æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³&lt;/li>
&lt;/ul>
&lt;h2 id="-åƒåœ¾æ”¶é›†å™¨">ğŸŒ´ åƒåœ¾æ”¶é›†å™¨&lt;/h2>
&lt;h3 id="-serial--serial-old">ğŸªµ Serial / Serial Old&lt;/h3>
&lt;p>â€œå•çº¿ç¨‹â€çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹&lt;code>stop the world&lt;/code>ï¼Œç›´åˆ°æ”¶é›†ç»“æŸã€‚&lt;/p>
&lt;ul>
&lt;li>æ–°ç”Ÿä»£é‡‡ç”¨ æ ‡è®°-å¤åˆ¶ ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨ æ ‡è®°-æ•´ç† ç®—æ³•ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/garbage-collection/serial.png"
width="953"
height="209"
srcset="https://blog.letout.cn/p/java/jvm/garbage-collection/serial_hu902bd566aebd83355bfe0e2769bbc345_79667_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/garbage-collection/serial_hu902bd566aebd83355bfe0e2769bbc345_79667_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="serial"
class="gallery-image"
data-flex-grow="455"
data-flex-basis="1094px"
>&lt;/p>
&lt;ul>
&lt;li>ç®€å•é«˜æ•ˆ&lt;/li>
&lt;li>ä¾æ—§æ˜¯ç°åœ¨ HotSpot è™šæ‹Ÿæœºè¿è¡Œåœ¨å®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ–¹å¼&lt;/li>
&lt;/ul>
&lt;h3 id="-parnew">ğŸªµ ParNew&lt;/h3>
&lt;p>Serial çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨å¤šæ¡çº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ã€‚ï¼ˆæ–°ç”Ÿä»£ï¼‰&lt;/p>
&lt;ul>
&lt;li>é‡‡ç”¨æ ‡è®°å¤åˆ¶ç®—æ³•&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/garbage-collection/parnew.png"
width="960"
height="202"
srcset="https://blog.letout.cn/p/java/jvm/garbage-collection/parnew_hub4e3375e7b496e8b6ebc251ec3bf2f26_87679_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/garbage-collection/parnew_hub4e3375e7b496e8b6ebc251ec3bf2f26_87679_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="parnew"
class="gallery-image"
data-flex-grow="475"
data-flex-basis="1140px"
>&lt;/p>
&lt;h3 id="-parallel-scavenge--parallel-old">ğŸªµ Parallel Scavenge / Parallel Old&lt;/h3>
&lt;ul>
&lt;li>åŸºäº æ ‡è®°-å¤åˆ¶ ç®—æ³•å®ç°çš„æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ï¼Œèƒ½å¤Ÿå¹¶è¡Œæ”¶é›†çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼Œç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„â€œååé‡â€ã€‚&lt;/li>
&lt;li>åŸºäº æ ‡è®°-æ•´ç† ç®—æ³•å®ç°çš„è€å¹´ä»£å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/garbage-collection/parallel.png"
width="934"
height="199"
srcset="https://blog.letout.cn/p/java/jvm/garbage-collection/parallel_hu519cfc57a4a5c97f5f81fc0feaeb8730_92362_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/garbage-collection/parallel_hu519cfc57a4a5c97f5f81fc0feaeb8730_92362_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="parallel"
class="gallery-image"
data-flex-grow="469"
data-flex-basis="1126px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Java 8 é»˜è®¤çš„æ”¶é›†å™¨ä¸º Parallel Sacvenge + Parallel Old&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ååé‡ TPS ï¼šç³»ç»Ÿåœ¨å•ä½æ—¶é—´å†…å¤„ç†è¯·æ±‚çš„æ•°é‡&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-cms">ğŸªµ CMS&lt;/h3>
&lt;p>&lt;code>Concurrent Mark Swap&lt;/code> è·å–æœ€çŸ­åœé¡¿æ—¶é—´çš„æ”¶é›†å™¨ã€‚&lt;/p>
&lt;p>æ˜¯ HotSpot è™šæ‹Ÿæœºç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘åƒåœ¾æ”¶é›†å™¨ï¼Œå®ç°äº†ç”¨æˆ·çº¿ç¨‹å’Œåƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶å·¥ä½œã€‚åŸºäº æ ‡è®°-æ¸…é™¤ ç®—æ³•çš„ &lt;strong>è€å¹´ä»£&lt;/strong> æ”¶é›†å™¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/garbage-collection/CMS.png"
width="1121"
height="230"
srcset="https://blog.letout.cn/p/java/jvm/garbage-collection/CMS_hu7a65fd9981325c5387fcf294cec67078_167761_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/garbage-collection/CMS_hu7a65fd9981325c5387fcf294cec67078_167761_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="CMS"
class="gallery-image"
data-flex-grow="487"
data-flex-basis="1169px"
>&lt;/p>
&lt;p>CMS æ”¶é›†å™¨æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>ğŸ¾ åˆå§‹æ ‡è®°&lt;/li>
&lt;/ul>
&lt;p>æ ‡è®°ä¸ GC Root ç›´æ¥å…³è”çš„å¯¹è±¡ã€‚ï¼ˆstop the worldï¼‰æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œä½†é€Ÿåº¦è¾ƒå¿«ã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸ¾ å¹¶å‘æ ‡è®°&lt;/li>
&lt;/ul>
&lt;p>ç”¨æˆ·çº¿ç¨‹å’Œåƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶å·¥ä½œï¼Œä» GC Root ç›´æ¥å…³è”çš„å¯¹è±¡å¼€å§‹éå†ï¼Œæ ¹æ®å¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸ¾ é‡æ–°æ ‡è®°&lt;/li>
&lt;/ul>
&lt;p>ä¿®æ­£å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œç”±äºç¨‹åºç»§ç»­è¿è¡Œï¼Œå¯¼è‡´çš„æ ‡è®°é”™è¯¯ã€‚æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸ¾ å¹¶å‘æ¸…é™¤&lt;/li>
&lt;/ul>
&lt;p>å¹¶å‘åœ°æ¸…ç†æœªè¢«æ ‡è®°çš„åŒºåŸŸã€‚&lt;/p>
&lt;p>ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å¯¹ CPU èµ„æºæ•æ„Ÿ&lt;/li>
&lt;li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼šè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›åƒåœ¾åœ¨å½“æ¬¡æ— æ³•å¤„ç†ï¼Œéœ€è¦ç­‰å¾…ä¸‹æ¬¡åƒåœ¾å›æ”¶&lt;/li>
&lt;li>ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´è¿ç»­ç©ºé—´å‡å°‘ï¼Œå¯¼è‡´ Full GC&lt;/li>
&lt;/ul>
&lt;h3 id="-g1">ğŸªµ G1&lt;/h3>
&lt;p>G1 å¼€åˆ›äº†æ”¶é›†å™¨é¢å‘å±€éƒ¨æ”¶é›†çš„è®¾è®¡æ€è·¯å’ŒåŸºäº Region çš„å†…å­˜å¸ƒå±€å½¢å¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/garbage-collection/g1heap.png"
width="902"
height="676"
srcset="https://blog.letout.cn/p/java/jvm/garbage-collection/g1heap_huc8187154c5204389b583a76e76e7dffa_88685_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/garbage-collection/g1heap_huc8187154c5204389b583a76e76e7dffa_88685_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="g1heap"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
>&lt;/p>
&lt;p>å°† Java å †åˆ†ä¸º 2048 ä¸ªå¤§å°ç›¸åŒçš„ç‹¬ç«‹ Regionï¼Œæ¯ä¸ª Region çš„å¤§å°ä¾æ®å †ç©ºé—´çš„å¤§å°è€Œå®šï¼Œåœ¨ JVM ç”Ÿå‘½å‘¨æœŸä¸­ä¸ä¼šæ”¹å˜ã€‚&lt;/p>
&lt;p>æ¯ä¸ª Region éƒ½å¯ä»¥æ›´å…·éœ€è¦ï¼Œä½œä¸ºæ–°ç”Ÿä»£çš„ Eden åŒºï¼ŒSurvivor åŒºï¼Œæˆ–è€…æ˜¯è€å¹´ä»£ï¼›æ–°ç”Ÿä»£å’Œè€å¹´ä»£åœ¨å†…å­˜ä¸­ä¸æ˜¯è¿ç»­çš„ç©ºé—´ï¼Œæ”¶é›†å™¨ä¼šæ ¹æ®åŒºåŸŸçš„ä¸åŒé‡‡å–ä¸åŒçš„ç­–ç•¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/garbage-collection/g1.png"
width="941"
height="209"
srcset="https://blog.letout.cn/p/java/jvm/garbage-collection/g1_hu2c13cc7a5d500b4a818a8d3a4dfa26ed_139186_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/garbage-collection/g1_hu2c13cc7a5d500b4a818a8d3a4dfa26ed_139186_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="g1"
class="gallery-image"
data-flex-grow="450"
data-flex-basis="1080px"
>&lt;/p>
&lt;p>Region ä¸­è¿˜ä¼šæœ‰ä¸€ç±»ç‰¹æ®Šçš„å·¨å¤§åŒºåŸŸ Humongousï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨å¤§å¯¹è±¡ã€‚å½“å¯¹è±¡çš„å¤§å°è¶…è¿‡äº†ä¸€ä¸ª Region çš„ä¸€åŠï¼Œå°±è¢«åˆ¤å®šä¸ºå¤§å¯¹è±¡ã€‚&lt;/p>
&lt;p>G1 æ”¶é›†å™¨å›æ”¶çš„æ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>ğŸ¾ åˆå§‹æ ‡è®°&lt;/li>
&lt;/ul>
&lt;p>æ ‡è®° GC Root èƒ½å¤Ÿç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œè€—æ—¶è¾ƒçŸ­ã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸ¾ å¹¶å‘æ ‡è®°&lt;/li>
&lt;/ul>
&lt;p>ä» GC Root å¼€å§‹å¯¹å †ä¸­çš„å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºéœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸ¾ æœ€ç»ˆæ ‡è®°&lt;/li>
&lt;/ul>
&lt;p>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨ã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸ¾ ç­›é€‰å›æ”¶&lt;/li>
&lt;/ul>
&lt;p>å¯¹å„ä¸ª Region çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œä¼šé€‰æ‹©ä»·å€¼æœ€å¤§çš„åŒºåŸŸè¿›è¡Œå›æ”¶ã€‚&lt;/p>
&lt;p>å°†å›æ”¶çš„ Region ä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œå¤åˆ¶åˆ°ç©ºçš„ Region ä¸­ï¼Œå†æ¸…ç†æ‰æ•´ä¸ªæ—§çš„ Region åŒºåŸŸã€‚&lt;/p>
&lt;p>æ¶‰åŠå¯¹è±¡çš„ç§»åŠ¨ï¼Œå¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œæœ‰å¤šæ¡åƒåœ¾æ”¶é›†å™¨å¹¶å‘æ‰§è¡Œã€‚ä½†æ˜¯åªå›æ”¶ä¸€éƒ¨åˆ†Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;h2 id="-å¯¹è±¡åˆ†é…å’Œå›æ”¶åŸåˆ™">ğŸŒ´ å¯¹è±¡åˆ†é…å’Œå›æ”¶åŸåˆ™&lt;/h2>
&lt;ul>
&lt;li>ğŸª¨ å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åŒºåˆ†é…&lt;/li>
&lt;/ul>
&lt;p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ Eden åŒºåˆ†é…ï¼Œå½“ Eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå‘èµ·ä¸€æ¬¡ Minor GCã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸª¨ å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£&lt;/li>
&lt;/ul>
&lt;p>éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„ Java å¯¹è±¡ï¼ˆæ•°ç»„ï¼Œå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼‰ï¼Œç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œé¿å…åœ¨ Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºä¹‹é—´æ¥å›å¤åˆ¶ï¼Œäº§ç”Ÿå¤§é‡çš„å†…å­˜å¤åˆ¶æ“ä½œã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸª¨ é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£&lt;/li>
&lt;/ul>
&lt;p>è™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡ä¸€ä¸ªå¯¹è±¡å¹´é¾„è®¡æ•°å™¨ï¼Œæ¯ç»è¿‡ä¸€æ¬¡ MinorGCï¼Œå¹´é¾„å°±ä¼š +1ï¼Œ&lt;/p>
&lt;p>å½“å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ 15ï¼‰ï¼Œæˆ–æŸä¸ªå¹´é¾„è¶…è¿‡äº† Survivor åŒºçš„ä¸€åŠæ—¶ï¼Œä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸª¨ ç©ºé—´åˆ†é…æ‹…ä¿&lt;/li>
&lt;/ul>
&lt;p>ç¡®ä¿åœ¨ Minor GC ä¹‹å‰ï¼Œè€å¹´ä»£è¿˜æœ‰å®¹çº³æ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„å‰©ä½™ç©ºé—´ã€‚&lt;/p>
&lt;p>è¿›è¡Œä¸€æ¬¡ Minor GC ä¹‹åï¼ŒEden åŒºä¸­ä»»ç„¶å­˜åœ¨å¤§é‡å¯¹è±¡ï¼ŒSurvivor ä¸­æ— æ³•å®¹çº³ï¼Œç›´æ¥é€åˆ°è€å¹´ä»£ï¼Œè®©è€å¹´ä»£è¿›è¡Œç©ºé—´åˆ†é…æ‹…ä¿ã€‚&lt;/p></description></item><item><title>JVM å†…å­˜æ¨¡å‹</title><link>https://blog.letout.cn/p/java/jvm/memory-model/</link><pubDate>Sun, 07 Aug 2022 06:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/java/jvm/memory-model/</guid><description>&lt;img src="https://blog.letout.cn/imgs/28.jpeg" alt="Featured image of post JVM å†…å­˜æ¨¡å‹" />&lt;h2 id="jmm">JMM&lt;/h2>
&lt;p>Java å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼‰å±è”½äº†ä¸åŒæ“ä½œç³»ç»Ÿå’Œå„ç§ç¡¬ä»¶çš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œå®ç°äº† Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹ï¼Œéƒ½èƒ½è¾¾åˆ°ä¸€è‡´æ€§çš„è®¿é—®æ•ˆæœã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/memory-model/JMM.png"
width="613"
height="530"
srcset="https://blog.letout.cn/p/java/jvm/memory-model/JMM_hu7e11e9092393e4f5c6cb98b7857d5889_99528_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/memory-model/JMM_hu7e11e9092393e4f5c6cb98b7857d5889_99528_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="JMM"
class="gallery-image"
data-flex-grow="115"
data-flex-basis="277px"
>&lt;/p>
&lt;p>JMM è§„å®šäº†ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å­˜ä¸­&lt;/li>
&lt;li>æ¯æ¡çº¿ç¨‹æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜&lt;/li>
&lt;li>çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»å–ã€èµ‹å€¼ç­‰ï¼‰ï¼Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å­˜ä¸­çš„æ•°æ®ï¼Œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œ&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/memory-model/memory.png"
width="942"
height="383"
srcset="https://blog.letout.cn/p/java/jvm/memory-model/memory_hue7fb17d3eb7c4a77bd28c7215dc28c3d_104935_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/memory-model/memory_hue7fb17d3eb7c4a77bd28c7215dc28c3d_104935_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="memory"
class="gallery-image"
data-flex-grow="245"
data-flex-basis="590px"
>&lt;/p>
&lt;h2 id="åŸå­æ€§å¯è§æ€§æœ‰åºæ€§">åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§&lt;/h2>
&lt;p>Java å†…å­˜æ¨¡å‹æ˜¯å›´ç»•ç€åœ¨å¹¶å‘è¿‡ç¨‹ä¸­å¦‚ä½•å¤„ç†åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ä¸‰ä¸ªç‰¹å¾æ¥å»ºç«‹çš„ã€‚&lt;/p>
&lt;h3 id="-åŸå­æ€§">ğŸ¥ åŸå­æ€§&lt;/h3>
&lt;p>ä¸€æ¬¡æˆ–å¤šæ¬¡æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œä¸”ä¸å—åˆ°ä»»ä½•å¹²æ‰°ï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œã€‚&lt;/p>
&lt;ul>
&lt;li>åˆ©ç”¨é”ï¼Œå¯ä»¥è®©ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ä»£ç å—ã€‚&lt;code>synchronized&lt;/code> &lt;code>Lock&lt;/code>&lt;/li>
&lt;li>åˆ©ç”¨ &lt;code>CAS&lt;/code> åŸå­ç±»ï¼Œä¿è¯åŸå­æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="-å¯è§æ€§">ğŸ¤ å¯è§æ€§&lt;/h3>
&lt;p>ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>volatile&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>è§„å®šæ¯æ¬¡å†™æ“ä½œï¼Œéƒ½ç«‹å³åŒæ­¥åˆ°ä¸»å­˜ï¼›æ¯æ¬¡è¯»æ“ä½œï¼Œéƒ½ä»ä¸»å­˜ä¸­è¯»å–ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>synchronized&lt;/code> &lt;code>lock&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œæ‰§è¡Œ unlock ä¹‹å‰ï¼Œå¿…é¡»æŠŠå˜é‡åŒæ­¥å›ä¸»å­˜ä¸­ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>final&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="-æœ‰åºæ€§">ğŸ£ æœ‰åºæ€§&lt;/h3>
&lt;p>æŒ‡ä»¤é‡æ’é—®é¢˜ï¼Œä»£ç çš„æ‰§è¡Œé¡ºåºä¸ä¸€å®šã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>volatile&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åŒ…å«ç¦æ­¢æŒ‡ä»¤é‡æ’åºçš„è¯­ä¹‰ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>synchronized&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åªæœ‰ä¸€æ¡çº¿ç¨‹èƒ½å¤Ÿè¿›å…¥ä¸´ç•ŒåŒºã€‚&lt;/p>
&lt;h2 id="volatile">volatile&lt;/h2>
&lt;p>Java è™šæ‹Ÿæœºæä¾›çš„è½»é‡çº§å†…å­˜åŒæ­¥æœºåˆ¶ã€‚&lt;/p>
&lt;p>ä½œç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>âœ”ï¸ ä¿éšœäº†æ­¤å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§&lt;/li>
&lt;/ul>
&lt;p>volatile çš„å†™æ“ä½œï¼Œéƒ½ä¼šåˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œå¹¶ä½¿å…¶ä»–çº¿ç¨‹ä¸­çš„ volatile å˜é‡å¤±æ•ˆï¼›volatile çš„è¯»æ“ä½œï¼Œéƒ½ä¼šä»ä¸»å­˜ä¸­è¯»å–ã€‚&lt;/p>
&lt;ul>
&lt;li>âœ”ï¸ ç¦æ­¢æŒ‡ä»¤é‡æ’ä¼˜åŒ–ï¼ˆæœ‰åºæ€§ï¼‰&lt;/li>
&lt;/ul>
&lt;p>é˜²æ­¢å†™æ“ä½œä¹‹å‰çš„ä»£ç ï¼Œé‡æ’åˆ°å†™æ“ä½œä¹‹åï¼›é˜²æ­¢è¯»æ“ä½œä¹‹åçš„ä»£ç ï¼Œé‡æ’åˆ°è¯»æ“ä½œä¹‹å‰ã€‚&lt;/p>
&lt;ul>
&lt;li>â—ï¸æ— æ³•ä¿éšœåŸå­æ€§&lt;/li>
&lt;/ul>
&lt;p>ä¸€æ¡å­—èŠ‚ç åœ¨æ‰§è¡Œæ—¶ï¼Œæ˜¯éœ€è¦è¿è¡Œå¤šæ¡æŒ‡ä»¤æ‰èƒ½å®ç°ã€‚&lt;/p>
&lt;p>å®ç°æ–¹å¼ï¼šå†…å­˜å±éšœã€‚é‡æ’åºæ—¶ï¼Œä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ã€‚&lt;/p>
&lt;p>ä¿è¯ï¼šä¹‹å‰çš„æŒ‡ä»¤ä¸€å®šå…¨éƒ¨æ‰§è¡Œï¼Œä¹‹åçš„æŒ‡ä»¤ä¸€å®šéƒ½æ²¡æœ‰æ‰§è¡Œï¼Œå¹¶ä¸”å‰é¢è¯­å¥çš„ç»“æœå¯¹åé¢çš„è¯­å¥å¯è§ã€‚&lt;/p>
&lt;h2 id="happens-before-åŸåˆ™">happens-before åŸåˆ™&lt;/h2>
&lt;p>å¯¹äºä¸¤ä¸ªæ“ä½œ A å’Œ Bï¼Œè¿™ä¸¤ä¸ªæ“ä½œå¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚å¦‚æœ A happens-before Bï¼ˆA ä¼˜å…ˆäº B æ‰§è¡Œï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ä¿è¯ï¼Œå½“ A æ“ä½œå®Œåï¼ŒA çš„æ“ä½œå¯¹äº B æ“ä½œæ˜¯å¯è§çš„ã€‚&lt;/p>
&lt;p>æŒ‡ä»¤é‡æ’æé«˜äº†å¹¶å‘æ€§èƒ½ï¼Œä½†æ˜¯ Java è™šæ‹Ÿæœºä¼šå¯¹æŒ‡ä»¤é‡æ’åšä¸€äº›è§„åˆ™é™åˆ¶ï¼Œå¹¶ä¸èƒ½è®©æ‰€æœ‰çš„æŒ‡ä»¤éƒ½éšæ„æ”¹å˜æ‰§è¡Œä½ç½®ã€‚&lt;/p>
&lt;p>Java å†…å­˜æ¨¡å‹å¤©ç„¶çš„å…ˆè¡Œå‘ç”Ÿå…³ç³»ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¨‹åºé¡ºåºè§„åˆ™&lt;/p>
&lt;p>åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼Œå‰é¢çš„ä»£ç æ“ä½œä¼˜äºåé¢çš„ä»£ç æ“ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é”å®šè§„åˆ™&lt;/p>
&lt;p>ä¸€ä¸ª unlock æ“ä½œä¼˜äºåé¢å¯¹äºåŒä¸€ä¸ªé”çš„ lock æ“ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>volatile è§„åˆ™&lt;/p>
&lt;p>ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œï¼Œä¼˜äºåé¢è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¼ é€’è§„åˆ™&lt;/p>
&lt;p>å¦‚æœ A happens-before Bï¼Œä¸” B happens-before Cï¼Œé‚£ä¹ˆ A happens-before Cã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>çº¿ç¨‹å¯åŠ¨è§„åˆ™&lt;/p>
&lt;p>Thread å¯¹è±¡çš„ start() æ–¹æ³• happens-before çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œã€‚&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>ç±»åŠ è½½å™¨</title><link>https://blog.letout.cn/p/java/jvm/classloader/</link><pubDate>Sat, 06 Aug 2022 16:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/java/jvm/classloader/</guid><description>&lt;img src="https://blog.letout.cn/imgs/25.jpeg" alt="Featured image of post ç±»åŠ è½½å™¨" />&lt;h2 id="ç±»åŠ è½½å™¨">ç±»åŠ è½½å™¨&lt;/h2>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/classloader/menu.png"
width="1707"
height="638"
srcset="https://blog.letout.cn/p/java/jvm/classloader/menu_hu8b8ca38d973bcbde05d207eb8795320e_321907_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/classloader/menu_hu8b8ca38d973bcbde05d207eb8795320e_321907_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="menu"
class="gallery-image"
data-flex-grow="267"
data-flex-basis="642px"
>&lt;/p>
&lt;h3 id="-bootstrapclassloader">ğŸ™ˆ BootstrapClassLoader&lt;/h3>
&lt;p>å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œæœ€é¡¶å±‚çš„åŠ è½½ç±»ï¼Œç”± C/C++ å®ç°ã€‚&lt;/p>
&lt;p>è´Ÿè´£åŠ è½½ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>%JAVA_HOME%/lib&lt;/code> ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»&lt;/li>
&lt;li>è¢« &lt;code>-Xbootclasspath&lt;/code> å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="-extensionclassloader">ğŸ™‰ ExtensionClassLoader&lt;/h3>
&lt;p>æ‰©å±•ç±»åŠ è½½å™¨ã€‚&lt;/p>
&lt;p>æ˜¯ä¸€ç§ Java ç³»ç»Ÿç±»åº“çš„æ‰©å±•æœºåˆ¶ã€‚è´Ÿè´£åŠ è½½ &lt;code>%JRE_HOME%/lib/ext&lt;/code> ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»ï¼Œæˆ–è¢« &lt;code>java.ext.dirs&lt;/code> ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„ jar åŒ…ã€‚&lt;/p>
&lt;h3 id="-applicationclassloader">ğŸ™Š ApplicationClassLoader&lt;/h3>
&lt;p>é¢å‘ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½å½“å‰åº”ç”¨ &lt;code>classpath&lt;/code> ä¸‹çš„æ‰€æœ‰ jar åŒ…å’Œç±»ã€‚&lt;/p>
&lt;h2 id="åŒäº²å§”æ´¾æ¨¡å‹">åŒäº²å§”æ´¾æ¨¡å‹&lt;/h2>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/classloader/classloader.png"
width="1279"
height="699"
srcset="https://blog.letout.cn/p/java/jvm/classloader/classloader_hu2885d6b96687a867396da9eda76d4bf0_289144_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/classloader/classloader_hu2885d6b96687a867396da9eda76d4bf0_289144_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="classloader"
class="gallery-image"
data-flex-grow="182"
data-flex-basis="439px"
>&lt;/p>
&lt;p>æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼Œç”¨ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº†åŒä¸€ä¸ªé™å®šåçš„ç±»ï¼ŒJVM ä¹Ÿä¼šè®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protected&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">loadClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">resolve&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">ClassNotFoundException&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">getClassLoadingLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// (1) åˆ¤æ–­æ˜¯å¦åŠ è½½è¿‡è¯¥ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findLoadedClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">long&lt;/span> &lt;span class="n">t0&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">nanoTime&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">parent&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parent&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">loadClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// (2) parent == null çº¦å®šä¸ºï¼šparnet ä¸º Bootstracp ClassLoader
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findBootstrapClassOrNull&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ClassNotFoundException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ClassNotFoundException thrown if class not found
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// from the non-null parent class loader
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// (3) è¯´æ˜ parent åŠ è½½ä¸äº†ï¼Œå½“å‰ loader å°è¯•åŠ è½½ class
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">t1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">nanoTime&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// this is the defining class loader; record the stats
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">sun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">misc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PerfCounter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getParentDelegationTime&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">addTime&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">t0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">misc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PerfCounter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getFindClassTime&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">addElapsedTimeFrom&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">t1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">misc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PerfCounter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getFindClasses&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">increment&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">resolve&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resolveClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé™å®šåçš„ç±»åªä¼šè¢«ä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½å¹¶è§£æä½¿ç”¨ï¼Œåœ¨ç¨‹åºä¸­æ˜¯å”¯ä¸€çš„ï¼Œä¸ä¼šäº§ç”Ÿæ­§ä¹‰ã€‚&lt;/p>
&lt;p>åœ¨åŠ è½½æ—¶ï¼Œé¦–å…ˆä¼šåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ï¼Œå¦‚æœå·²ç»åŠ è½½ï¼Œä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ã€‚&lt;/p>
&lt;p>å°è¯•åŠ è½½æ—¶ï¼Œä¸ä¼šè‡ªå·±è¿›è¡ŒåŠ è½½ï¼Œè€Œæ˜¯å°†è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œå½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œæ‰ä¼šç”±è‡ªå·±å¤„ç†ã€‚&lt;/p></description></item><item><title>ç±»åŠ è½½æœºåˆ¶</title><link>https://blog.letout.cn/p/java/jvm/class-loading/</link><pubDate>Sat, 06 Aug 2022 13:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/java/jvm/class-loading/</guid><description>&lt;img src="https://blog.letout.cn/imgs/24.jpeg" alt="Featured image of post ç±»åŠ è½½æœºåˆ¶" />&lt;h2 id="java-ç±»ç”Ÿå‘½å‘¨æœŸ">Java ç±»ç”Ÿå‘½å‘¨æœŸ&lt;/h2>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/class-loading/life.png"
width="973"
height="331"
srcset="https://blog.letout.cn/p/java/jvm/class-loading/life_hue0715323a61c74c3a1d0de4b0a99146c_113100_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/class-loading/life_hue0715323a61c74c3a1d0de4b0a99146c_113100_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="java-class-life"
class="gallery-image"
data-flex-grow="293"
data-flex-basis="705px"
>&lt;/p>
&lt;h2 id="ç±»åŠ è½½è¿‡ç¨‹">ç±»åŠ è½½è¿‡ç¨‹&lt;/h2>
&lt;p>ç±»åŠ è½½ä¸»è¦æœ‰ä¸‰æ­¥ï¼š&lt;code>åŠ è½½ - é“¾æ¥ - åˆå§‹åŒ–&lt;/code>ã€‚&lt;/p>
&lt;h3 id="-åŠ è½½">ğŸ¥ åŠ è½½&lt;/h3>
&lt;p>åŠ è½½æ˜¯ä¸€ä¸ªè¯»å– Class æ–‡ä»¶ï¼Œå°†å…¶è½¬åŒ–ä¸ºæŸç§é™æ€æ•°æ®ç»“æ„å­˜å‚¨åœ¨æ–¹æ³•åŒºå†…ï¼Œå¹¶åœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªä¾¿äºè°ƒç”¨çš„ &lt;code>java.lang.Class&lt;/code> ç±»å‹çš„å¯¹è±¡çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/class-loading/loading.png"
width="707"
height="335"
srcset="https://blog.letout.cn/p/java/jvm/class-loading/loading_hu8b469e8111e2814cd40ca0f04de26462_22328_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/class-loading/loading_hu8b469e8111e2814cd40ca0f04de26462_22328_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="loading"
class="gallery-image"
data-flex-grow="211"
data-flex-basis="506px"
>&lt;/p>
&lt;p>åˆ†ä¸ºä¸‰æ­¥è¿›è¡Œï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>è·å–å®šä¹‰ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼ˆä¸é™åˆ¶ä»å“ªé‡Œè·å–ï¼Œå¯ä»¥ä»æ–‡ä»¶ã€ç½‘ç»œã€å³æ—¶ç”Ÿæˆï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°†å­—èŠ‚æµä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ï¼Œè½¬æ¢æˆæ–¹æ³•åŒºä¸­è¿è¡Œæ—¶æ•°æ®ç»“æ„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ &lt;code>java.lang.Class&lt;/code> å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®è®¿é—®å…¥å£&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-é“¾æ¥">ğŸ¥ é“¾æ¥&lt;/h3>
&lt;h4 id="-éªŒè¯">âš¾ï¸ éªŒè¯&lt;/h4>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/class-loading/verify.png"
width="915"
height="390"
srcset="https://blog.letout.cn/p/java/jvm/class-loading/verify_hu8c1a3959f1e343b5f02da51e1aaf01f3_138925_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/class-loading/verify_hu8c1a3959f1e343b5f02da51e1aaf01f3_138925_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="verify"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="563px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ–‡ä»¶æ ¼å¼éªŒè¯&lt;/p>
&lt;p>éªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆ Class æ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œèƒ½è¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ã€‚&lt;strong>å‘ç”Ÿåœ¨åŠ è½½é˜¶æ®µ&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…ƒæ•°æ®ã€å­—èŠ‚ç éªŒè¯&lt;/p>
&lt;p>å¯¹å­—èŠ‚ç è¿›è¡Œè¯­æ³•ã€è¯­ä¹‰çš„åˆ†æï¼Œä¿è¯å…¶ç¬¦åˆ Java è™šæ‹Ÿæœºçš„è§„èŒƒï¼Œä¸ä¼šæœ‰å±å®³è™šæ‹Ÿæœºçš„è¡Œä¸ºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¬¦å·å¼•ç”¨éªŒè¯&lt;/p>
&lt;p>ç¡®ä¿è§£æè¡Œä¸ºèƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚&lt;strong>å‘ç”Ÿåœ¨è§£æé˜¶æ®µ&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="-å‡†å¤‡">âš¾ï¸ å‡†å¤‡&lt;/h4>
&lt;p>ä¸ºç±»ä¸­å®šä¹‰çš„å˜é‡ï¼ˆé™æ€å˜é‡ &lt;code>static&lt;/code>ï¼‰åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡é›¶å€¼çš„é˜¶æ®µã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/class-loading/prepare.png"
width="482"
height="260"
srcset="https://blog.letout.cn/p/java/jvm/class-loading/prepare_hu58a397643ad84aca2032de9a3ac6155c_29464_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/class-loading/prepare_hu58a397643ad84aca2032de9a3ac6155c_29464_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="prepare"
class="gallery-image"
data-flex-grow="185"
data-flex-basis="444px"
>&lt;/p>
&lt;ul>
&lt;li>&lt;code>static&lt;/code> -&amp;gt; èµ‹é›¶å€¼&lt;/li>
&lt;li>&lt;code>static final&lt;/code> -&amp;gt; èµ‹å®šä¹‰çš„å¸¸é‡å€¼&lt;/li>
&lt;/ul>
&lt;h4 id="-è§£æ">âš¾ï¸ è§£æ&lt;/h4>
&lt;p>è§£ææ˜¯å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¬¦å·å¼•ç”¨ï¼šæè¿°å¼•ç”¨å¯¹è±¡çš„ç¬¦å·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç›´æ¥å¼•ç”¨ï¼šæŒ‡å‘ç›®æ ‡å®é™…åœ°å€çš„æŒ‡é’ˆ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ğŸ¾ è§£æéƒ¨åˆ†æ˜¯çµæ´»çš„ï¼Œå¯ä»¥åœ¨åˆå§‹åŒ–ç¯èŠ‚åå†è¿›è¡Œï¼Œå®ç°æ‰€è°“çš„â€œåæœŸç»‘å®šâ€ã€‚ï¼ˆæ–¹æ³•è°ƒç”¨ç›´åˆ°è¿è¡Œæ—¶æ‰ä¼šè§£æï¼Œå› ä¸ºæ— æ³•åœ¨ç¼–è¯‘æ—¶ç¡®å®šæ–¹æ³•è°ƒç”¨æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ‰€ä»¥æ–¹æ³•å®šä¹‰å’Œæ–¹æ³•è°ƒç”¨ç›´åˆ°è¿è¡Œæ—¶æ‰ç»‘å®šã€‚ï¼‰&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/class-loading/resolve_1.png"
width="163"
height="370"
srcset="https://blog.letout.cn/p/java/jvm/class-loading/resolve_1_hua9ef48196efa3564a4ef1eaa93606c3a_10102_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/class-loading/resolve_1_hua9ef48196efa3564a4ef1eaa93606c3a_10102_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="resolve"
class="gallery-image"
data-flex-grow="44"
data-flex-basis="105px"
>&lt;/p>
&lt;p>å½“ä¸€ä¸ªç±»è¢«ç¼–è¯‘æˆ Class ä¹‹åï¼Œå‡è®¾è¿™ä¸ªç±»ç§°ä¸º &lt;code>A&lt;/code>ï¼Œå¹¶ä¸”åœ¨ç±» &lt;code>A&lt;/code> ä¸­å¼•ç”¨äº†ç±» &lt;code>B&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åœ¨ç¼–è¯‘é˜¶æ®µï¼Œ&lt;code>A&lt;/code> æ— æ³•ç¡®å®š &lt;code>B&lt;/code> æ˜¯å¦è¢«ç¼–è¯‘ï¼ˆç°åœ¨ &lt;code>B&lt;/code> ä¸€å®šæœªåŠ è½½ï¼‰ï¼Œæ­¤æ—¶ &lt;code>A&lt;/code> æ— æ³•çŸ¥é“ &lt;code>B&lt;/code> çš„å®é™…åœ°å€ï¼Œæ‰€æœ‰åœ¨ &lt;code>A.Class&lt;/code> ä¸­ï¼Œä¼šä½¿ç”¨ä¸€ä¸ª&lt;code>å­—ç¬¦ä¸²&lt;/code>ä»£è¡¨ &lt;code>B&lt;/code>ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²è¢«ç§°ä¸º&lt;strong>ç¬¦å·å¼•ç”¨&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨è¿è¡Œé˜¶æ®µï¼Œ&lt;code>A&lt;/code> å‘ç”Ÿäº†åŠ è½½ï¼Œåœ¨è§£ææ—¶ï¼Œå‘ç°å…¶ä¸­çš„ &lt;code>B&lt;/code> è¿˜æœªè¢«åŠ è½½ï¼Œå°±ä¼šè§¦å‘ç±» &lt;code>B&lt;/code> çš„åŠ è½½ï¼Œå°† &lt;code>B&lt;/code> åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­ã€‚æ­¤æ—¶ï¼Œ&lt;code>A&lt;/code> ä¸­çš„ç¬¦å·å¼•ç”¨ä¼šè¢«æ›¿æ¢ä¸º &lt;code>B&lt;/code> ä¸­çš„å®é™…åœ°å€ï¼ˆä¹Ÿå°±æ˜¯ç›´æ¥å¼•ç”¨ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/class-loading/resolve.png"
width="922"
height="538"
srcset="https://blog.letout.cn/p/java/jvm/class-loading/resolve_hu45e5622ef4d0eaddcde37871cfee2a7a_117190_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/class-loading/resolve_hu45e5622ef4d0eaddcde37871cfee2a7a_117190_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="resolve"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="411px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é™æ€è§£æ&lt;/p>
&lt;p>ç±» &lt;code>B&lt;/code> æ˜¯å…·ä½“çš„å®ç°ç±»ï¼Œè§£æçš„å¯¹è±¡ååˆ†æ˜ç¡®ï¼Œå³ä¼šè¿›è¡Œé™æ€è§£æã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŠ¨æ€è§£æ&lt;/p>
&lt;p>Java é€šè¿‡åæœŸç»‘å®šçš„æ–¹å¼å®ç°å¤šæ€ï¼Œé€šè¿‡åŠ¨æ€è§£æå®ç°ã€‚&lt;/p>
&lt;p>å¦‚æœç±» &lt;code>B&lt;/code> æ˜¯æŠ½è±¡ç±»æˆ–è€…æ¥å£ï¼Œæœ‰å…·ä½“çš„å®ç°ç±» &lt;code>C&lt;/code>ã€&lt;code>D&lt;/code>ï¼Œå½“å‰å…·ä½“çš„å®ç°æ–¹å¼å¹¶ä¸æ˜ç¡®ï¼Œæ— æ³•ç¡®å®šä½¿ç”¨å“ªä¸ªå…·ä½“å®ç°ã€‚&lt;/p>
&lt;p>ç›´åˆ°è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†è°ƒç”¨ï¼Œè™šæ‹Ÿæœºè°ƒç”¨æ ˆä¸­ä¼šå¾—åˆ°å…·ä½“ç±»çš„ä¿¡æ¯ï¼Œå†è¿›è¡Œè§£æï¼Œå°±æœ‰æ˜ç¡®çš„ç›´æ¥å¼•ç”¨ä»£æ›¿ç¬¦å·å¼•ç”¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-åˆå§‹åŒ–">ğŸ¥ åˆå§‹åŒ–&lt;/h3>
&lt;p>è™šæ‹ŸæœºçœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­ç¼–å†™çš„ä»£ç ï¼Œå®Œæˆä¸€äº›ä¸»åŠ¨çš„èµ„æºåˆå§‹åŒ–åŠ¨ä½œã€‚&lt;/p>
&lt;p>&lt;strong>æ‰§è¡Œçš„æ˜¯ç±»å±‚é¢çš„åˆå§‹åŒ–ã€‚&lt;/strong> åªæœ‰æ˜¾å¼è°ƒç”¨ new æ‰ä¼šæ‰§è¡Œæ„é€ å‡½æ•°çš„åˆå§‹åŒ–ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/java/jvm/class-loading/init.png"
width="533"
height="388"
srcset="https://blog.letout.cn/p/java/jvm/class-loading/init_hud5162327100fcc16da85dffebeccc0e0_46268_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/java/jvm/class-loading/init_hud5162327100fcc16da85dffebeccc0e0_46268_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="init"
class="gallery-image"
data-flex-grow="137"
data-flex-basis="329px"
>&lt;/p>
&lt;ul>
&lt;li>ç±»å˜é‡ï¼ˆé™æ€å˜é‡ï¼‰çš„èµ‹å€¼ &lt;code>static&lt;/code>&lt;/li>
&lt;li>é™æ€ä»£ç å— &lt;code>static { }&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="å¦‚ä½•åˆ¤æ–­æ— ç”¨ç±»">å¦‚ä½•åˆ¤æ–­æ— ç”¨ç±»&lt;/h2>
&lt;ul>
&lt;li>è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹å¯¹è±¡å…¨éƒ¨è¢« GCï¼Œåœ¨å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹å¯¹è±¡&lt;/li>
&lt;li>è¯¥ç±»å¯¹åº”çš„ &lt;code>java.lang.Class&lt;/code> å¯¹è±¡ï¼Œåœ¨ä»»ä½•åœ°æ–¹éƒ½æ²¡æœ‰è¢«å¼•ç”¨&lt;/li>
&lt;li>è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶&lt;/li>
&lt;/ul>
&lt;p>æ»¡è¶³ä»¥ä¸Šä¸‰ä¸ªæ¡ä»¶ï¼Œè¯´æ˜è¯¥ç±»å¯ä»¥è¢«å›æ”¶ï¼Œä½†æ˜¯ä¸å¯¹è±¡ä¸åŒï¼Œæ— ç”¨ç±»ä¸ä¸€å®šä¼šè¢«å›æ”¶ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://javaguide.cn/java/jvm/class-loading-process.html" target="_blank" rel="noopener"
>https://javaguide.cn/java/jvm/class-loading-process.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.bilibili.com/video/BV14U4y1L75q/?spm_id_from=333.788" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV14U4y1L75q/?spm_id_from=333.788&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>InnoDB å­˜å‚¨å¼•æ“</title><link>https://blog.letout.cn/p/mysql/innodb/</link><pubDate>Sun, 31 Jul 2022 13:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/mysql/innodb/</guid><description>&lt;img src="https://blog.letout.cn/imgs/23.jpeg" alt="Featured image of post InnoDB å­˜å‚¨å¼•æ“" />&lt;h2 id="äº‹åŠ¡">äº‹åŠ¡&lt;/h2>
&lt;p>äº‹åŠ¡æ˜¯ä¸€ç»„é€»è¾‘ä¸Šçš„æ•°æ®åº“æ“ä½œï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚&lt;/p>
&lt;h3 id="ç‰¹æ€§">ç‰¹æ€§&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>åŸå­æ€§ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸€è‡´æ€§ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éš”ç¦»æ€§ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŒä¹…æ€§ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/innodb/1.png"
width="869"
height="333"
srcset="https://blog.letout.cn/p/mysql/innodb/1_hu3fd49fc1a58d123f3498503f7ff7204f_68265_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/innodb/1_hu3fd49fc1a58d123f3498503f7ff7204f_68265_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="260"
data-flex-basis="626px"
>&lt;/p>
&lt;h2 id="redo-log">redo log&lt;/h2>
&lt;p>é‡åšæ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œæŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ã€‚å±äºç‰©ç†æ—¥å¿—ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/innodb/redolog.png"
width="889"
height="359"
srcset="https://blog.letout.cn/p/mysql/innodb/redolog_huec6805565d40a88bf7c70b51e3ee84c7_38212_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/innodb/redolog_huec6805565d40a88bf7c70b51e3ee84c7_38212_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="redolog"
class="gallery-image"
data-flex-grow="247"
data-flex-basis="594px"
>&lt;/p>
&lt;p>redo log ç”¨æ¥ä¿éšœæ•°æ®åº“çš„æŒä¹…æ€§ã€‚&lt;/p>
&lt;p>åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ‰§è¡Œå¤šä¸ªå¢åˆ æ”¹çš„æ“ä½œæ—¶ï¼ŒInnoDB å¼•æ“ä¼šå…ˆæ“ä½œç¼“å†²æ± ä¸­çš„æ•°æ®ï¼Œå¦‚æœç¼“å†²åŒºæ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œä¼šé€šè¿‡åå°çº¿ç¨‹å°†ç£ç›˜ä¸­çš„æ•°æ®åŠ è½½å‡ºæ¥ï¼Œå­˜æ”¾åœ¨ç¼“å†²åŒºä¸­ï¼Œå†å°†ç¼“å†²æ± ä¸­çš„æ•°æ®ä¿®æ”¹ï¼Œä¿®æ”¹åçš„æ•°æ®é¡µæˆ‘ä»¬ç§°ä¸ºè„é¡µã€‚&lt;/p>
&lt;p>è„é¡µåˆ™ä¼šåœ¨ä¸€å®šçš„æ—¶æœºï¼Œé€šè¿‡åå°çº¿ç¨‹åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œä»è€Œä¿è¯ç¼“å†²åŒºä¸ç£ç›˜çš„æ•°æ®ä¸€è‡´ã€‚&lt;/p>
&lt;p>ç¼“å†²åŒºçš„è„é¡µæ•°æ®å¹¶ä¸æ˜¯å®æ—¶åˆ·æ–°çš„ï¼Œè€Œæ˜¯ä¸€æ®µæ—¶é—´ä¹‹åå°†ç¼“å†²åŒºçš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼ˆéšæœºç£ç›˜ IOï¼‰ã€‚&lt;/p>
&lt;p>å½“å¯¹ç¼“å†²åŒºçš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹ä¹‹åï¼Œä¼šé¦–å…ˆå°†æ“ä½œçš„æ•°æ®é¡µçš„å˜åŒ–ï¼Œè®°å½•åœ¨ redo log buffer ä¸­ã€‚åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šå°† redo log buffer ä¸­çš„æ•°æ®åˆ·æ–°åˆ° redo log ç£ç›˜æ–‡ä»¶ä¸­ï¼ˆé¡ºåºç£ç›˜ IOï¼‰ã€‚&lt;/p>
&lt;p>å¦‚æœåˆ·æ–°ç¼“å†²åŒºçš„è„é¡µåˆ°ç£ç›˜æ—¶ï¼Œå‘ç”Ÿé”™è¯¯ï¼Œæ­¤æ—¶å°±å¯ä»¥å€ŸåŠ©äº redo log è¿›è¡Œæ•°æ®æ¢å¤ï¼Œè¿™æ ·å°±ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€‚&lt;/p>
&lt;h2 id="undo-log">undo log&lt;/h2>
&lt;p>å›æ»šæ—¥å¿—ã€‚è®°å½•æ“ä½œæ•°æ®åº“çš„é€†æ“ä½œï¼Œç”¨äºè¿›è¡Œå›æ»šã€‚&lt;/p>
&lt;p>ä½œç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>æä¾›å›æ»šï¼ˆä¿éšœäº‹åŠ¡çš„åŸå­æ€§ï¼‰&lt;/li>
&lt;li>MVCC&lt;/li>
&lt;/ul>
&lt;p>undo log æ˜¯é€»è¾‘æ—¥å¿—ï¼Œå¯ä»¥è®¤ä¸ºå½“ delete ä¸€æ¡è®°å½•æ—¶ï¼Œundo log ä¸­ä¼šè®°å½•ä¸€æ¡å¯¹åº”çš„ insert è®°å½•ï¼›å½“ update ä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒè®°å½•ä¸€æ¡å¯¹åº”ç›¸åçš„ update è®°å½•ã€‚&lt;/p>
&lt;h2 id="mvcc">MVCC&lt;/h2>
&lt;p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ŒåŒä¸€æ¡è®°å½•åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ã€‚&lt;/p>
&lt;ul>
&lt;li>éšå¼å­—æ®µ
&lt;ul>
&lt;li>DB_TRX_ID äº‹åŠ¡ id&lt;/li>
&lt;li>DB_ROLL_PTR å›æ»šæŒ‡é’ˆï¼ˆè®°å½•è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>undo log&lt;/li>
&lt;li>readview&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/innodb/2.png"
width="447"
height="293"
srcset="https://blog.letout.cn/p/mysql/innodb/2_hu6914e1ba0252a0a630b3ee48cb8867a4_30147_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/innodb/2_hu6914e1ba0252a0a630b3ee48cb8867a4_30147_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="152"
data-flex-basis="366px"
>&lt;/p>
&lt;h3 id="å½“å‰è¯»">å½“å‰è¯»&lt;/h3>
&lt;p>è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>&lt;code>update&lt;/code> &lt;code>insert&lt;/code> &lt;code>delete&lt;/code> &lt;code>select ... for update&lt;/code> &lt;code>select ... lock in share mode&lt;/code> éƒ½æ˜¯è¿›è¡Œå½“å‰è¯»ã€‚&lt;/p>
&lt;h3 id="å¿«ç…§è¯»">å¿«ç…§è¯»&lt;/h3>
&lt;p>ç®€å•çš„ä¸åŠ é” &lt;code>select&lt;/code> å°±æ˜¯å¿«ç…§è¯»ã€‚è¯»å–çš„æ˜¯å¿«ç…§ç‰ˆæœ¬ï¼Œé€šè¿‡ MVCC è¿›è¡Œå¹¶å‘æ§åˆ¶ã€‚&lt;/p>
&lt;h2 id="ä¸€è‡´æ€§">ä¸€è‡´æ€§&lt;/h2>
&lt;p>æ•°æ®åº“é€šè¿‡åŸå­æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§æ¥ä¿è¯ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>C(ä¸€è‡´æ€§)æ˜¯ç›®çš„ï¼ŒA(åŸå­æ€§)ã€I(éš”ç¦»æ€§)ã€D(æŒä¹…æ€§)æ˜¯æ˜¯ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ•°æ®åº“æä¾›çš„æ‰‹æ®µã€‚&lt;/p></description></item><item><title>MySQL æŸ¥è¯¢è¯­å¥æ˜¯æ€ä¹ˆæ‰§è¡Œçš„</title><link>https://blog.letout.cn/p/mysql/how-execute/</link><pubDate>Sun, 31 Jul 2022 13:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/mysql/how-execute/</guid><description/></item><item><title>MySQL å­˜å‚¨å¼•æ“</title><link>https://blog.letout.cn/p/mysql/engine/</link><pubDate>Fri, 29 Jul 2022 19:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/mysql/engine/</guid><description>&lt;img src="https://blog.letout.cn/imgs/22.jpeg" alt="Featured image of post MySQL å­˜å‚¨å¼•æ“" />&lt;h2 id="mysql-ä½“ç³»ç»“æ„">MySQL ä½“ç³»ç»“æ„&lt;/h2>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/engine/1.png"
width="1176"
height="639"
srcset="https://blog.letout.cn/p/mysql/engine/1_hu5b4a85ab8f594ef5edc02d326d256cb0_206182_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/engine/1_hu5b4a85ab8f594ef5edc02d326d256cb0_206182_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h3 id="è¿æ¥å±‚">è¿æ¥å±‚&lt;/h3>
&lt;p>ä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>ä¸ºé€šè¿‡è®¤è¯å®‰å…¨æ¥å…¥çš„å®¢æˆ·ç«¯æä¾›çº¿ç¨‹ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚&lt;/p>
&lt;h3 id="æœåŠ¡å±‚">æœåŠ¡å±‚&lt;/h3>
&lt;p>ä¸»è¦å®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ï¼Œå¹¶å®Œæˆç¼“å­˜çš„æŸ¥è¯¢ï¼ŒSQLçš„åˆ†æå’Œä¼˜åŒ–ï¼Œéƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œã€‚&lt;/p>
&lt;p>æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚ è¿‡ç¨‹ã€å‡½æ•°ç­‰ã€‚åœ¨è¯¥å±‚ï¼ŒæœåŠ¡å™¨ä¼šè§£ææŸ¥è¯¢å¹¶åˆ›å»ºç›¸åº”çš„å†…éƒ¨è§£ææ ‘ï¼Œå¹¶å¯¹å…¶å®Œæˆç›¸åº”çš„ä¼˜åŒ–å¦‚ç¡®å®šè¡¨çš„æŸ¥è¯¢çš„é¡ºåºï¼Œæ˜¯å¦åˆ©ç”¨ç´¢å¼•ç­‰ï¼Œæœ€åç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œã€‚&lt;/p>
&lt;p>å¦‚æœæ˜¯selectè¯­å¥ï¼ŒæœåŠ¡å™¨è¿˜ä¼šæŸ¥è¯¢å†…éƒ¨çš„ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ç©ºé—´è¶³å¤Ÿå¤§ï¼Œè¿™æ ·åœ¨è§£å†³å¤§é‡è¯»æ“ä½œçš„ç¯å¢ƒä¸­èƒ½å¤Ÿå¾ˆå¥½çš„æå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚&lt;/p>
&lt;h3 id="å¼•æ“å±‚">å¼•æ“å±‚&lt;/h3>
&lt;p>çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼ŒæœåŠ¡å™¨é€šè¿‡APIå’Œå­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæ¥é€‰å–åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚æ•°æ®åº“ä¸­çš„ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®ç°çš„ã€‚&lt;/p>
&lt;h3 id="å­˜å‚¨å±‚">å­˜å‚¨å±‚&lt;/h3>
&lt;p>æ•°æ®å­˜å‚¨å±‚ï¼Œ ä¸»è¦æ˜¯å°†æ•°æ®ï¼ˆå¦‚: redologã€undologã€æ•°æ®ã€ç´¢å¼•ã€äºŒè¿›åˆ¶æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ï¼‰å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚&lt;/p>
&lt;h2 id="å­˜å‚¨å¼•æ“">å­˜å‚¨å¼•æ“&lt;/h2>
&lt;p>å­˜å‚¨å¼•æ“å°±æ˜¯å­˜å‚¨æ•°æ®ï¼Œå»ºç«‹ç´¢å¼•ï¼Œæ›´æ–°ã€æŸ¥è¯¢æ•°æ®ç­‰æŠ€æœ¯çš„å…·ä½“å®ç°æ–¹å¼ã€‚&lt;/p>
&lt;p>å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„ï¼Œè€Œä¸æ˜¯åŸºäºåº“çš„ï¼Œæ‰€ä»¥å­˜å‚¨å¼•æ“å¯ä»¥è¢«ç§°ä¸ºè¡¨ç±»å‹ï¼Œå¯åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼ŒæŒ‡å®šé€‰æ‹©çš„å­˜å‚¨å¼•æ“ã€‚&lt;/p>
&lt;ul>
&lt;li>å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">engines&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="innodb">InnoDB&lt;/h2>
&lt;p>InnoDB æ˜¯ MySQL 5.5 ä¹‹åé»˜è®¤çš„ MySQL å­˜å‚¨å¼•æ“ã€‚&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>DML æ“ä½œéµå¾ª ACID æ¨¡å‹ï¼Œæ”¯æŒäº‹åŠ¡&lt;/li>
&lt;li>æ”¯æŒè¡Œçº§é”ï¼Œæé«˜å¹¶å‘è®¿é—®æ€§èƒ½&lt;/li>
&lt;li>æ”¯æŒå¤–é”®çº¦æŸï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§&lt;/li>
&lt;/ul>
&lt;p>InnoDB çš„é€»è¾‘å­˜å‚¨ç»“æ„ï¼š&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/engine/innodb.png"
width="1207"
height="503"
srcset="https://blog.letout.cn/p/mysql/engine/innodb_hu255dad38c999e36f2d3fd079c10a9f22_82479_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/engine/innodb_hu255dad38c999e36f2d3fd079c10a9f22_82479_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="innodb"
class="gallery-image"
data-flex-grow="239"
data-flex-basis="575px"
>&lt;/p>
&lt;ul>
&lt;li>è¡¨ç©ºé—´&lt;/li>
&lt;/ul>
&lt;p>InnoDB å­˜å‚¨å¼•æ“é€»è¾‘ç»“æ„çš„æœ€é«˜å±‚ï¼Œidb æ–‡ä»¶å°±æ˜¯è¡¨ç©ºé—´æ–‡ä»¶ã€‚åœ¨è¡¨ç©ºé—´ä¸­å¯ä»¥åŒ…å«å¤šä¸ª Segment æ®µã€‚&lt;/p>
&lt;ul>
&lt;li>æ®µ&lt;/li>
&lt;/ul>
&lt;p>è¡¨ç©ºé—´æ˜¯ç”±å„ä¸ªæ®µç»„æˆçš„ï¼Œå¸¸è§çš„æ®µæœ‰æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µç­‰ã€‚InnoDB å¯¹äºæ®µçš„ç®¡ç†ï¼Œéƒ½æ˜¯å¼•æ“è‡ªèº«å®Œæˆï¼Œä¸éœ€è¦äººä¸ºæ§åˆ¶ï¼Œä¸€ä¸ªæ®µä¸­åŒ…å«å¤šä¸ªåŒºã€‚&lt;/p>
&lt;ul>
&lt;li>åŒºï¼ˆ1Mï¼‰&lt;/li>
&lt;/ul>
&lt;p>åŒºæ˜¯è¡¨ç©ºé—´çš„å•å…ƒç»“æ„ï¼Œæ¯ä¸ªåŒºçš„å¤§å°ä¸º 1Mã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“é¡µçš„å¤§å°ä¸º 16Kï¼Œå³ä¸€ä¸ªåŒºä¸­ä¸€å…±æœ‰ 64 ä¸ªè¿ç»­çš„é¡µã€‚&lt;/p>
&lt;ul>
&lt;li>é¡µï¼ˆ16Kï¼‰&lt;/li>
&lt;/ul>
&lt;p>é¡µæ˜¯ç»„æˆåŒºçš„æœ€å°å•å…ƒï¼Œä¹Ÿæ˜¯ InnoDB å­˜å‚¨å¼•æ“ç£ç›˜ç®¡ç†çš„æœ€å°å•å…ƒï¼Œæ¯ä¸ªé¡µé»˜è®¤ä¸º 16Kã€‚ä¸ºäº†ä¿è¯é¡µçš„è¿ç»­æ€§ï¼ŒInnoDB å­˜å‚¨å¼•æ“æ¯æ¬¡ä»ç£ç›˜ç”³è¯· 4-5 ä¸ªåŒºã€‚&lt;/p>
&lt;ul>
&lt;li>è¡Œ&lt;/li>
&lt;/ul>
&lt;p>InnoDB å­˜å‚¨å¼•æ“æ˜¯é¢å‘è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®æ˜¯æŒ‰è¡Œè¿›è¡Œå­˜æ”¾çš„ï¼Œåœ¨æ¯ä¸€è¡Œä¸­ï¼Œé™¤äº†å®šä¹‰è¡¨æ—¶æŒ‡å®šçš„å­—æ®µå¤–ï¼Œè¿˜åŒ…æ‹¬éšè—å­—æ®µã€‚&lt;/p>
&lt;h2 id="myisam">MyISAM&lt;/h2>
&lt;p>MyISAM æ˜¯ MySQL æ—©æœŸçš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”®&lt;/li>
&lt;li>æ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”&lt;/li>
&lt;li>é€‚åˆ select&lt;/li>
&lt;/ul>
&lt;p>å­˜å‚¨æ–‡ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>.sdi
å­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯&lt;/li>
&lt;li>.MYD
å­˜å‚¨æ•°æ®&lt;/li>
&lt;li>.MYI
å­˜å‚¨ç´¢å¼•&lt;/li>
&lt;/ul>
&lt;h2 id="memory">Memory&lt;/h2>
&lt;p>Memory å¼•æ“çš„è¡¨æ•°æ®æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œç”±äºå—åˆ°ç¡¬ä»¶ã€æ–­ç”µç­‰é—®é¢˜çš„å½±å“ï¼Œåªèƒ½å°†è¿™äº›è¡¨ä½œä¸ºä¸´æ—¶è¡¨æˆ–ç¼“å­˜ä½¿ç”¨ã€‚&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å†…å­˜å­˜æ”¾æ•°æ®ï¼Œå®•æœºåæ•°æ®ä¼šä¸¢å¤±&lt;/li>
&lt;li>hash ç´¢å¼•ï¼ˆé»˜è®¤ï¼‰&lt;/li>
&lt;/ul>
&lt;p>æ–‡ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>.sdi å­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯&lt;/li>
&lt;/ul></description></item><item><title>SQL è¯­å¥ä¼˜åŒ–</title><link>https://blog.letout.cn/p/mysql/sql-optimize/</link><pubDate>Fri, 01 Jul 2022 18:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/mysql/sql-optimize/</guid><description>&lt;img src="https://blog.letout.cn/imgs/20.jpeg" alt="Featured image of post SQL è¯­å¥ä¼˜åŒ–" />&lt;h2 id="-insert-ä¼˜åŒ–">ğŸ¦® insert ä¼˜åŒ–&lt;/h2>
&lt;p>ä¸€æ¬¡æ€§å¾€æ•°æ®åº“ä¸­æ’å…¥å¤šæ¡æ•°æ®ï¼Œå¯ä»ä»¥ä¸‹ä¸‰æ–¹é¢ä¼˜åŒ–ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰¹é‡æ’å…¥æ•°æ®&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">transaction&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Tom&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Cat&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Jerry&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">commit&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ä¸»é”®é¡ºåºæ’å…¥&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ä¸»é”®ä¹±åºæ’å…¥ : 8 1 9 21 88 2 4 15 89 5 7 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ä¸»é”®é¡ºåºæ’å…¥ : 1 2 3 4 5 7 8 9 15 21 88 89
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-order-by-ä¼˜åŒ–">ğŸ¦’ order by ä¼˜åŒ–&lt;/h2>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;ul>
&lt;li>
&lt;p>æ ¹æ®æ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œå¤šå­—æ®µæ’åºæ—¶ï¼Œä¹Ÿéµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°½é‡ä½¿ç”¨ç´¢å¼• / è¦†ç›–ç´¢å¼• &lt;!-- raw HTML omitted -->&lt;/p>
&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="-limit-ä¼˜åŒ–">ğŸ limit ä¼˜åŒ–&lt;/h2>
&lt;p>åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œå¦‚æœè¿›è¡Œ limit åˆ†é¡µæŸ¥è¯¢ï¼Œåœ¨æŸ¥è¯¢æ—¶ï¼Œè¶Šå¾€åï¼Œåˆ†é¡µæŸ¥è¯¢æ•ˆç‡è¶Šä½ã€‚&lt;/p>
&lt;p>å½“åœ¨è¿›è¡Œåˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œå¦‚æœæ‰§è¡Œ &lt;code>limit 2000000,10&lt;/code> ï¼Œæ­¤æ—¶éœ€è¦MySQLæ’åºå‰2000010 è®°
å½•ï¼Œä»…ä»…è¿”å› 2000000 - 2000010 çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§ ã€‚&lt;/p>
&lt;p>ä¼˜åŒ–æ€è·¯:&lt;/p>
&lt;ul>
&lt;li>å¯ä»¥é€šè¿‡å…ˆå®šä½æ•°æ®ï¼Œå…ˆåç§»ï¼Œå† limit&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_sku&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2000000&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>é€šè¿‡è¦†ç›–ç´¢å¼•åŠ å­æŸ¥è¯¢å½¢å¼è¿›è¡Œä¼˜åŒ–ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_sku&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_sku&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2000000&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åœ¨ä¸šä½™å…è®¸çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é™åˆ¶é¡µæ•°ã€‚é€šå¸¸ç”¨æˆ·ä¹Ÿä¸ä¼šå‘åé¢ç¿»å¾ˆå¤šé¡µã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="-count-ä¼˜åŒ–">ğŸ¦¬ count ä¼˜åŒ–&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>count(ä¸»é”®)&lt;/p>
&lt;ul>
&lt;li>InnoDB å¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„ ä¸»é”®id å€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ã€‚æœåŠ¡å±‚æ‹¿åˆ°ä¸»é”®åï¼ŒæŒ‰è¡Œè¿›è¡Œç´¯åŠ ï¼ˆä¸»é”®ä¸å¯èƒ½ä¸ºnullï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>count(å­—æ®µ)ï¼ˆæ³¨æ„ null çº¦æŸï¼‰&lt;/p>
&lt;ul>
&lt;li>æ²¡æœ‰ not null çº¦æŸ: InnoDB å¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚åˆ¤æ–­æ˜¯å¦ä¸º nullï¼Œä¸ä¸º nullï¼Œå°±è®¡æ•°ç´¯åŠ ã€‚&lt;/li>
&lt;li>æœ‰ not null çº¦æŸï¼šInnoDB å¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>count(æ•°å­—)&lt;/p>
&lt;ul>
&lt;li>InnoDB å¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚æœåŠ¡å±‚å¯¹äºè¿”å›çš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­— â€œ1â€ è¿›å»ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>count(*)&lt;/p>
&lt;ul>
&lt;li>InnoDBå¼•æ“å¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ï¼ŒæœåŠ¡å±‚ç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-update-ä¼˜åŒ–">ğŸ¦› update ä¼˜åŒ–&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>é˜²æ­¢ç´¢å¼•å¤±æ•ˆ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é˜²æ­¢å‡çº§ä¸ºè¡¨é”&lt;/p>
&lt;p>InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•åŠ çš„é”ï¼Œå¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™ä¼šä»è¡Œé”å‡çº§ä¸ºè¡¨é”ã€‚&lt;/p>
&lt;p>å¼€å¯å¤šä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œ SQL æ—¶ï¼Œé˜²æ­¢è¡Œé”å‡çº§ä¸ºè¡¨é”ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-ä¸»é”®ä¼˜åŒ–">ğŸˆâ€â¬› ä¸»é”®ä¼˜åŒ–&lt;/h2>
&lt;ul>
&lt;li>æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦ï¼Œå‡å°‘ç£ç›˜ IO&lt;/li>
&lt;li>æ’å…¥æ•°æ®å°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨ auto_increment è‡ªå¢ä¸»é”®&lt;/li>
&lt;li>å°½é‡ä¸è¦ä½¿ç”¨ UUID æˆ–å…¶ä»–è‡ªç„¶ä¸»é”®ï¼ˆå¦‚èº«ä»½è¯å·ï¼‰ ä½œä¸ºä¸»é”®&lt;/li>
&lt;li>ä¸šåŠ¡æ“ä½œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹&lt;/li>
&lt;/ul>
&lt;p>åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œè¡¨æ•°æ®æ˜¯æ ¹æ®ä¸»é”®é¡ºåºç»„ç»‡å­˜æ”¾çš„ã€‚è¿™ç§å­˜å‚¨æ–¹å¼ä¸ºç´¢å¼•ç»„ç»‡è¡¨ï¼ˆindex organized table IOTï¼‰ã€‚&lt;/p>
&lt;p>æ•°æ®è¡Œæ˜¯è®°å½•åœ¨é€»è¾‘ç»“æ„ page é¡µä¸­çš„ï¼Œè€Œæ¯ä¸€ä¸ªé¡µçš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œé»˜è®¤ 16Kã€‚ä¹Ÿå°±æ„å‘³ç€ï¼Œä¸€ä¸ªé¡µä¸­æ‰€å­˜å‚¨çš„è¡Œä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå¦‚æœæ’å…¥çš„æ•°æ®è¡Œåœ¨è¯¥é¡µå­˜å‚¨ä¸ä¸‹ï¼Œå°†ä¼šå­˜å‚¨åˆ°ä¸‹ä¸€ä¸ªé¡µä¸­ï¼Œé¡µä¸é¡µä¹‹é—´ä¼šé€šè¿‡æŒ‡é’ˆè¿æ¥ã€‚&lt;/p>
&lt;h3 id="é¡µåˆ†è£‚">é¡µåˆ†è£‚&lt;/h3>
&lt;p>é¡µå¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥å¡«å……ä¸€åŠï¼Œä¹Ÿå¯ä»¥å¡«å……100%ã€‚æ¯ä¸ªé¡µåŒ…å«äº† 2-N è¡Œæ•°æ®(å¦‚æœä¸€è¡Œæ•°æ®è¿‡å¤§ï¼Œä¼šè¡Œ
æº¢å‡º)ï¼Œæ ¹æ®ä¸»é”®æ’åˆ—ã€‚&lt;/p>
&lt;p>ä¹±åºæ’å…¥ï¼š&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/sql-optimize/primary_index_1.png"
width="898"
height="636"
srcset="https://blog.letout.cn/p/mysql/sql-optimize/primary_index_1_hu563b35cba82cad8802163900e924e8ca_143837_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/sql-optimize/primary_index_1_hu563b35cba82cad8802163900e924e8ca_143837_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="primary_index_1"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="338px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/sql-optimize/primary_index_2.png"
width="915"
height="659"
srcset="https://blog.letout.cn/p/mysql/sql-optimize/primary_index_2_hua83dc9b4ef4e3c90fc06cafc64e9881b_251787_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/sql-optimize/primary_index_2_hua83dc9b4ef4e3c90fc06cafc64e9881b_251787_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="primary_index_2"
class="gallery-image"
data-flex-grow="138"
data-flex-basis="333px"
>&lt;/p>
&lt;h3 id="é¡µåˆå¹¶">é¡µåˆå¹¶&lt;/h3>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/sql-optimize/primary_index_3.png"
width="906"
height="382"
srcset="https://blog.letout.cn/p/mysql/sql-optimize/primary_index_3_hu3b7e2aa6c3e2312a91f1497a31cd1dee_78730_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/sql-optimize/primary_index_3_hu3b7e2aa6c3e2312a91f1497a31cd1dee_78730_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="primary_index_3"
class="gallery-image"
data-flex-grow="237"
data-flex-basis="569px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/sql-optimize/primary_index_4.png"
width="887"
height="573"
srcset="https://blog.letout.cn/p/mysql/sql-optimize/primary_index_4_hu41da46b964a6401e487c72fb3de2f351_108741_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/sql-optimize/primary_index_4_hu41da46b964a6401e487c72fb3de2f351_108741_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="primary_index_4"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="371px"
>&lt;/p></description></item><item><title>MySQL æ—¥å¿—</title><link>https://blog.letout.cn/p/mysql/log/</link><pubDate>Thu, 30 Jun 2022 18:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/mysql/log/</guid><description>&lt;img src="https://blog.letout.cn/imgs/19.jpeg" alt="Featured image of post MySQL æ—¥å¿—" />&lt;h2 id="æ—¥å¿—">æ—¥å¿—&lt;/h2>
&lt;h3 id="é”™è¯¯æ—¥å¿—">é”™è¯¯æ—¥å¿—&lt;/h3>
&lt;p>é”™è¯¯æ—¥å¿—æ˜¯ MySQL ä¸­æœ€é‡è¦çš„æ—¥å¿—ä¹‹ä¸€ï¼Œå®ƒè®°å½•äº†å½“ mysqld å¯åŠ¨å’Œåœæ­¢æ—¶ï¼Œä»¥åŠæœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•ä¸¥é‡é”™è¯¯æ—¶çš„ç›¸å…³ä¿¡æ¯ã€‚&lt;/p>
&lt;p>å½“æ•°æ®åº“å‡ºç°ä»»ä½•æ•…éšœå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨æ—¶ï¼Œå»ºè®®é¦–å…ˆæŸ¥çœ‹æ­¤æ—¥å¿—ã€‚&lt;/p>
&lt;p>æŸ¥çœ‹æ—¥å¿—ä½ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%log_error%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/log/errorlog.png"
width="669"
height="214"
srcset="https://blog.letout.cn/p/mysql/log/errorlog_huaf2aa946fc0c9a4be25a1e7ae77fcd38_27013_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/log/errorlog_huaf2aa946fc0c9a4be25a1e7ae77fcd38_27013_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="errorlog"
class="gallery-image"
data-flex-grow="312"
data-flex-basis="750px"
>&lt;/p>
&lt;h3 id="äºŒè¿›åˆ¶æ—¥å¿—å½’æ¡£æ—¥å¿—">äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆå½’æ¡£æ—¥å¿—ï¼‰&lt;/h3>
&lt;p>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBINLOGï¼‰è®°å½•äº†æ‰€æœ‰çš„ DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰è¯­å¥å’Œ DMLï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰è¯­å¥ã€‚&lt;/p>
&lt;p>ä½œç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>ç¾éš¾æ—¶æ•°æ®æ¢å¤&lt;/li>
&lt;li>MySQL ä¸»ä»å¤åˆ¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%log_bin%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/log/binlog.png"
width="602"
height="240"
srcset="https://blog.letout.cn/p/mysql/log/binlog_hue4b3570af35eb515872cd8390aac573d_28397_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/log/binlog_hue4b3570af35eb515872cd8390aac573d_28397_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="binlog"
class="gallery-image"
data-flex-grow="250"
data-flex-basis="602px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>log_bin_basename&lt;/p>
&lt;ul>
&lt;li>å½“å‰æ•°æ®åº“æœåŠ¡å™¨çš„binlogæ—¥å¿—çš„åŸºç¡€åç§°(å‰ç¼€)ï¼Œå…·ä½“çš„binlogæ–‡ä»¶åéœ€è¦å†è¯¥basenameçš„åŸºç¡€ä¸ŠåŠ ä¸Šç¼–å·(ç¼–å·ä»000001å¼€å§‹)ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>log_bin_index&lt;/p>
&lt;ul>
&lt;li>binlogçš„ç´¢å¼•æ–‡ä»¶ï¼Œé‡Œé¢è®°å½•äº†å½“å‰æœåŠ¡å™¨å…³è”çš„binlogæ–‡ä»¶æœ‰å“ªäº›ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="binlog-æ ¼å¼">binlog æ ¼å¼&lt;/h4>
&lt;p>MySQL æœåŠ¡å™¨ä¸­æä¾›äº†å¤šç§æ ¼å¼æ¥è®°å½•äºŒè¿›åˆ¶æ—¥å¿—ï¼š&lt;/p>
&lt;p>é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ï¼Œåªéœ€è¦åœ¨ /etc/my.cnf ä¸­é…ç½® binlog_format å‚æ•°å³å¯ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>statement&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åŸºäº SQL è¯­å¥çš„æ—¥å¿—è®°å½•ï¼Œè®°å½•çš„æ˜¯ SQL è¯­å¥ï¼Œå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„ SQL éƒ½ä¼šè®°å½•åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>row&lt;/code> ï¼ˆé»˜è®¤ï¼‰&lt;/p>
&lt;ul>
&lt;li>åŸºäºè¡Œçš„æ—¥å¿—è®°å½•ï¼Œè®°å½•çš„æ˜¯æ¯ä¸€è¡Œçš„æ•°æ®å˜æ›´ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>mixed&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ··åˆäº† statememt å’Œ row ä¸¤ç§æ ¼å¼ï¼Œé»˜è®¤é‡‡ç”¨statementï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸º row è¿›è¡Œè®°å½•ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%binlog_format%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/log/binlogformat.png"
width="432"
height="156"
srcset="https://blog.letout.cn/p/mysql/log/binlogformat_hu025aaab383e907dcebf622698b084bf9_13882_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/log/binlogformat_hu025aaab383e907dcebf622698b084bf9_13882_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="binlogformat"
class="gallery-image"
data-flex-grow="276"
data-flex-basis="664px"
>&lt;/p>
&lt;h4 id="æŸ¥çœ‹-binlog">æŸ¥çœ‹ binlog&lt;/h4>
&lt;p>æ—¥å¿—æ˜¯ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨çš„ï¼Œä¸èƒ½ç›´æ¥è¯»å–ï¼Œéœ€è¦é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—æŸ¥è¯¢å·¥å…· &lt;code>mysqlbinlog&lt;/code> æ¥æŸ¥çœ‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mysqlbinlog [å‚æ•°] logfilename
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">å‚æ•°é€‰é¡¹ï¼š
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -d æŒ‡å®šæ•°æ®åº“åç§°ï¼Œåªåˆ—å‡ºæŒ‡å®šçš„æ•°æ®åº“ç›¸å…³æ“ä½œ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -o å¿½ç•¥æ‰æ—¥å¿—ä¸­çš„å‰ n è¡Œå‘½ä»¤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v å°†è¡Œäº‹ä»¶(æ•°æ®å˜æ›´)é‡æ„ä¸ºSQLè¯­å¥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -vv å°†è¡Œäº‹ä»¶(æ•°æ®å˜æ›´)é‡æ„ä¸ºSQLè¯­å¥ï¼Œå¹¶è¾“å‡ºæ³¨é‡Šä¿¡æ¯
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="æ¸…ç†-binlog">æ¸…ç† binlog&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>&lt;code>reset master&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åˆ é™¤å…¨éƒ¨ binlog æ—¥å¿—ï¼Œåˆ é™¤ä¹‹åï¼Œæ—¥å¿—ç¼–å·ï¼Œå°†ä» binlog.000001é‡æ–°å¼€å§‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>purge master logs to 'binlog.000005'&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åˆ é™¤ 000005 ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>purge master logs before 'yyyy-mm-dd hh24:mi:ss'&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åˆ é™¤æ—¥å¿—ä¸º &amp;ldquo;yyyy-mm-dd hh24:mi:ss&amp;rdquo; ä¹‹å‰äº§ç”Ÿçš„æ‰€æœ‰æ—¥å¿—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å¯ä»¥åœ¨ mysql çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„è¿‡æœŸæ—¶é—´ï¼Œè®¾ç½®äº†ä¹‹åï¼ŒäºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸä¼šè‡ªåŠ¨åˆ é™¤ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%binlog_expire_logs_seconds%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/log/binlogexpire.png"
width="541"
height="153"
srcset="https://blog.letout.cn/p/mysql/log/binlogexpire_hua71c1465b703f02a37880ff6dd450f1c_15632_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/log/binlogexpire_hua71c1465b703f02a37880ff6dd450f1c_15632_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="binlogexpire"
class="gallery-image"
data-flex-grow="353"
data-flex-basis="848px"
>&lt;/p>
&lt;h3 id="æŸ¥è¯¢æ—¥å¿—">æŸ¥è¯¢æ—¥å¿—&lt;/h3>
&lt;p>æŸ¥è¯¢æ—¥å¿—ä¸­è®°å½•äº†å®¢æˆ·ç«¯çš„æ‰€æœ‰æ“ä½œè¯­å¥ã€‚ï¼ˆbinlog ä¸åŒ…å«æŸ¥è¯¢æ•°æ®çš„ SQL è¯­å¥ï¼‰&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢æ—¥å¿—æ˜¯æœªå¼€å¯çš„ã€‚&lt;/p>
&lt;p>å¦‚æœéœ€è¦å¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼Œå¯ä»¥ä¿®æ”¹MySQLçš„é…ç½®æ–‡ä»¶ /etc/my.cnf æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># è¯¥é€‰é¡¹ç”¨æ¥å¼€å¯æŸ¥è¯¢æ—¥å¿—
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># å¯é€‰å€¼ 0 å…³é—­ 1 å¼€å¯
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">general_log=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶å
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤çš„æ–‡ä»¶åä¸º host_name.log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">general_log_file=mysql_query.log
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¼€å¯äº†æŸ¥è¯¢æ—¥å¿—ä¹‹åï¼Œ/var/lib/mysql/ ç›®å½•ä¸‹å°±ä¼šå‡ºç° mysql_query.log æ–‡ä»¶ã€‚&lt;/p>
&lt;p>æ‰€æœ‰çš„å®¢æˆ·ç«¯çš„å¢åˆ æ”¹æŸ¥æ“ä½œéƒ½ä¼šè®°å½•åœ¨è¯¥æ—¥å¿—æ–‡ä»¶ä¹‹ä¸­ï¼Œé•¿æ—¶é—´è¿è¡Œåï¼Œè¯¥æ—¥å¿—æ–‡ä»¶å°†ä¼šéå¸¸å¤§ã€‚&lt;/p>
&lt;h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—">æ…¢æŸ¥è¯¢æ—¥å¿—&lt;/h3>
&lt;p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‰§è¡Œæ—¶é—´è¶…è¿‡ &lt;code>long_query_time&lt;/code>&lt;/li>
&lt;li>æ‰«æè®°å½•æ•°å¤§äº &lt;code>min_examined_row_limit&lt;/code>
çš„æ‰€æœ‰çš„SQLè¯­å¥çš„æ—¥å¿—ï¼Œé»˜è®¤æœªå¼€å¯ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœéœ€è¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦åœ¨ MySQL çš„é…ç½®æ–‡ä»¶ /etc/my.cnf ä¸­é…ç½®å¦‚ä¸‹å‚æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># æ…¢æŸ¥è¯¢æ—¥å¿—
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">slow_query_log=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># æ‰§è¡Œæ—¶é—´å‚æ•°
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">long_query_time=2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ä¼šè®°å½•ç®¡ç†è¯­å¥ï¼Œä¹Ÿä¸ä¼šè®°å½•ä¸ä½¿ç”¨ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾çš„æŸ¥è¯¢ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># è®°å½•æ‰§è¡Œè¾ƒæ…¢çš„ç®¡ç†è¯­å¥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">log_slow_admin_statements=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># è®°å½•æ‰§è¡Œè¾ƒæ…¢çš„æœªä½¿ç”¨ç´¢å¼•çš„è¯­å¥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">log_queries_not_using_indexes= 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>MySQL ç´¢å¼•</title><link>https://blog.letout.cn/p/mysql/index/</link><pubDate>Thu, 30 Jun 2022 14:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/mysql/index/</guid><description>&lt;img src="https://blog.letout.cn/imgs/15.jpeg" alt="Featured image of post MySQL ç´¢å¼•" />&lt;h2 id="ç´¢å¼•">ç´¢å¼•&lt;/h2>
&lt;p>ç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ© MySQL é«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¼˜ç‚¹&lt;/p>
&lt;ul>
&lt;li>æé«˜æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦&lt;/li>
&lt;li>é™ä½æ•°æ®åº“çš„ IO æˆæœ¬&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç¼ºç‚¹&lt;/p>
&lt;ul>
&lt;li>å ç”¨ç£ç›˜ç©ºé—´&lt;/li>
&lt;li>å¢åˆ æ”¹éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œæ€§èƒ½å¯èƒ½ä¼šä¸‹é™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="ç´¢å¼•çš„åˆ†ç±»">ç´¢å¼•çš„åˆ†ç±»&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- æŸ¥çœ‹è¡¨ä¸­çš„ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table_name&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¸»é”®ç´¢å¼•">ä¸»é”®ç´¢å¼•&lt;/h3>
&lt;p>å½“ä¸€å¼ è¡¨ï¼ŒæŠŠæŸä¸ªåˆ—è®¾ä¸ºä¸»é”®çš„æ—¶å€™ï¼Œåˆ™è¯¥åˆ—å°±æ˜¯ä¸»é”®ç´¢å¼•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ™®é€šç´¢å¼•">æ™®é€šç´¢å¼•&lt;/h3>
&lt;p>ç”¨è¡¨ä¸­çš„æ™®é€šåˆ—æ„å»ºçš„ç´¢å¼•ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_index_name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_index_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_table&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å”¯ä¸€ç´¢å¼•">å”¯ä¸€ç´¢å¼•&lt;/h3>
&lt;p>ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œå…è®¸æœ‰å¤šä¸ªç©ºå€¼ nullï¼ˆå’Œä¸»é”®ä¸åŒï¼Œä¸»é”®ä¸å…è®¸ä¸ºç©ºï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">unique&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">new_unique_index_name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unique&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">new_unique_index_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_table&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å…¨æ–‡ç´¢å¼•">å…¨æ–‡ç´¢å¼•&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">fulltext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_fulltext_index_content&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç»„åˆç´¢å¼•">ç»„åˆç´¢å¼•&lt;/h3>
&lt;p>ç»„åˆç´¢å¼• / è”åˆç´¢å¼•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo_name_age_index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="èšç°‡ç´¢å¼•">èšç°‡ç´¢å¼•&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ç´¢å¼•å’Œæ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ®ï¼Œæ‰¾åˆ°äº†ç´¢å¼•å°±æ‰¾åˆ°äº†æ•°æ®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è®¿é—®æ•°æ®æ›´å¿«ï¼Œèšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªB+æ ‘ä¸Šã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ›´æ–°èšç°‡ç´¢å¼•åˆ—çš„ä»£ä»·å¾ˆé«˜ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/index8.png"
width="722"
height="369"
srcset="https://blog.letout.cn/p/mysql/index/index8_hu9d45f79d8b338c019791de22ea52eb90_62479_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/index8_hu9d45f79d8b338c019791de22ea52eb90_62479_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="index8"
class="gallery-image"
data-flex-grow="195"
data-flex-basis="469px"
>&lt;/p>
&lt;h3 id="éèšç°‡ç´¢å¼•äºŒçº§ç´¢å¼•">éèšç°‡ç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰&lt;/h3>
&lt;p>å°†æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹å…³è”çš„æ˜¯å¯¹åº”çš„ä¸»é”®ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/clustering-index.png"
width="840"
height="571"
srcset="https://blog.letout.cn/p/mysql/index/clustering-index_hub32172b742ab96d724c643b42699b935_232051_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/clustering-index_hub32172b742ab96d724c643b42699b935_232051_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="clustering-index"
class="gallery-image"
data-flex-grow="147"
data-flex-basis="353px"
>&lt;/p>
&lt;ul>
&lt;li>äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œè¦å›è¡¨ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/index9.png"
width="727"
height="389"
srcset="https://blog.letout.cn/p/mysql/index/index9_hua49cf0193b83cd4f61e5b4747229532b_46178_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/index9_hua49cf0193b83cd4f61e5b4747229532b_46178_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="index9"
class="gallery-image"
data-flex-grow="186"
data-flex-basis="448px"
>&lt;/p>
&lt;h2 id="ç´¢å¼•çš„ç»“æ„">ç´¢å¼•çš„ç»“æ„&lt;/h2>
&lt;h3 id="b-tree">B Tree&lt;/h3>
&lt;p>B æ ‘æ˜¯ä¸€ç§å¤šå‰å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œå…¶ä¸»è¦ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ ‘çš„èŠ‚ç‚¹ä¸­å­˜å‚¨ç€å¤šä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå†…èŠ‚ç‚¹æœ‰å¤šä¸ªåˆ†å‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å‚¨å­˜æ•°æ®ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸­åŒ…å«é”®å€¼å’Œæ•°æ®ï¼ŒèŠ‚ç‚¹ä¸­çš„é”®å€¼ä»å°åˆ°å¤§æ’åˆ—ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>çˆ¶èŠ‚ç‚¹å½“ä¸­çš„å…ƒç´ ä¸ä¼šå‡ºç°åœ¨å­èŠ‚ç‚¹ä¸­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ‰€æœ‰çš„å¶å­ç»“ç‚¹éƒ½ä½äºåŒä¸€å±‚ï¼Œå¶èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ·±åº¦ï¼Œå¶èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰æŒ‡é’ˆè¿æ¥ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/BTree.png"
width="824"
height="496"
srcset="https://blog.letout.cn/p/mysql/index/BTree_hu5a2ea9e01a7974b484f27a03994c1eb9_162577_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/BTree_hu5a2ea9e01a7974b484f27a03994c1eb9_162577_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="BTree"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="398px"
>&lt;/p>
&lt;h3 id="b-tree-1">B+ Tree&lt;/h3>
&lt;p>B+ æ ‘æ˜¯ B æ ‘çš„å‡çº§ç‰ˆã€‚B+ æ ‘åœ¨ç»“æ„ä¸Šå’ŒBæ ‘çš„åŒºåˆ«åœ¨äºï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åªæœ‰å¶å­èŠ‚ç‚¹æ‰ä¼šå­˜å‚¨æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ï¼Œç”¨äºæŸ¥æ‰¾ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¶å­èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨åŒå‘æŒ‡é’ˆè¿æ¥ï¼Œæœ€åº•å±‚çš„å¶å­èŠ‚ç‚¹å½¢æˆäº†ä¸€ä¸ªåŒå‘æœ‰åºé“¾è¡¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¶å­èŠ‚ç‚¹ä¿å­˜äº†çˆ¶èŠ‚ç‚¹æ‰€æœ‰å…³é”®å­—è®°å½•çš„æŒ‡é’ˆã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/BTree2.png"
width="726"
height="486"
srcset="https://blog.letout.cn/p/mysql/index/BTree2_hu9d51150ef65d39ad05b8ca626e16e349_124398_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/BTree2_hu9d51150ef65d39ad05b8ca626e16e349_124398_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="B&amp;#43;Tree"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="358px"
>&lt;/p>
&lt;p>ç›¸æ¯”ä¸ B æ ‘ï¼ŒB+ æ ‘æœ‰ä»¥ä¸‹æå‡ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ‰«è¡¨èƒ½åŠ›æ›´å¼ºï¼ˆè¿›è¡Œå…¨è¡¨æ‰«æï¼Œåªéœ€è¦éå†å¶å­èŠ‚ç‚¹å³å¯ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…·æœ‰æ›´å¥½çš„ç£ç›˜è¯»å†™èƒ½åŠ›ï¼ˆéå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œä½¿æ ‘æ›´çŸ®ï¼ŒIO æ“ä½œæ›´å°‘ï¼Œä¸€æ¬¡ç£ç›˜åŠ è½½æ‰«æèŒƒå›´æ›´å¤§ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŸ¥è¯¢æ•ˆç‡ç¨³å®šï¼ˆæ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼ŒIO æ¬¡æ•°ç¨³å®šï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¢åˆ æ•°æ®æ•ˆç‡æ›´é«˜ï¼ˆæ•°æ®åœ¨å¶å­èŠ‚ç‚¹ä»¥æœ‰åºé“¾è¡¨å­˜å‚¨ï¼Œå¯æé«˜æ•°æ®å¢åˆ æ•ˆç‡ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ•°æ®åº“ä¸­ï¼ŒB+ æ ‘çš„é«˜åº¦ä¸€èˆ¬éƒ½åœ¨ 2~4 å±‚ã€‚ç”±äº MySQL çš„ INNODB å¼•æ“åœ¨è®¾è®¡æ—¶æ˜¯å°† B+ æ ‘çš„æ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜çš„ï¼Œå› æ­¤åœ¨æŸ¥æ‰¾æŸä¸€é”®å€¼çš„è¡Œè®°å½•æ—¶ï¼Œæœ€å¤šåªéœ€è¦ 1~3 æ¬¡ç£ç›˜IOã€‚&lt;/p>
&lt;h3 id="hash">Hash&lt;/h3>
&lt;p>æ”¯æŒ hash ç´¢å¼•çš„æ˜¯ Memory å­˜å‚¨å¼•æ“ã€‚é‡‡ç”¨ä¸€å®šçš„ hash ç®—æ³•ï¼Œå°†é”®å€¼æ¢ç®—æˆæ–°çš„ hash å€¼ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ§½ä½ä¸Šï¼Œç„¶åå­˜å‚¨åœ¨ hash è¡¨ä¸­ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/hash.png"
width="551"
height="297"
srcset="https://blog.letout.cn/p/mysql/index/hash_hu44e081159408b7a12e5ef78d4b9f0b5d_44702_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/hash_hu44e081159408b7a12e5ef78d4b9f0b5d_44702_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="hash"
class="gallery-image"
data-flex-grow="185"
data-flex-basis="445px"
>&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒï¼ˆ=, inï¼‰ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆbetween, &amp;gt;, &amp;lt;ï¼‰&lt;/li>
&lt;li>æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œ&lt;/li>
&lt;li>æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šå¸¸åªéœ€è¦ä¸€æ¬¡æ£€ç´¢ï¼ˆæ—  hash å†²çªçš„æƒ…å†µï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="åˆ›å»ºç´¢å¼•çš„åŸåˆ™">åˆ›å»ºç´¢å¼•çš„åŸåˆ™&lt;/h2>
&lt;h3 id="-å»ºè®®åˆ›å»ºç´¢å¼•">ğŸ™† å»ºè®®åˆ›å»ºç´¢å¼•&lt;/h3>
&lt;ul>
&lt;li>âœ… &lt;code>select&lt;/code> è¯­å¥ï¼Œé¢‘ç¹ä½œä¸º &lt;code>where&lt;/code> æ¡ä»¶çš„å­—æ®µ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- index(first_name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">last_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Cools&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- è”åˆç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(first_name, last_name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- æ³¨æ„æ»¡è¶³ï¼šæœ€å·¦å‰ç¼€åŸåˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(last_name, first_name) -&amp;gt; where first_name=&amp;#34;Georgi&amp;#34; æ— æ³•ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>âœ… &lt;code>update/delete&lt;/code> è¯­å¥çš„ &lt;code>where&lt;/code> æ¡ä»¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">update&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Jim&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;100001&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">delete&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fitst_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>âœ… éœ€è¦åˆ†ç»„ï¼Œæ’åºçš„å­—æ®µ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">group&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>âœ… ä½¿ç”¨ &lt;code>distinct&lt;/code> çš„å­—æ®µ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">distinct&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>âœ… å­—æ®µéœ€è¦å”¯ä¸€æ€§çº¦æŸ&lt;/p>
&lt;ul>
&lt;li>å”¯ä¸€ç´¢å¼•&lt;/li>
&lt;li>ä¸»é”®ç´¢å¼•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>âœ… å¤šè¡¨æŸ¥è¯¢ï¼Œè¿æ¥å­—æ®µåº”åˆ›å»ºç´¢å¼•&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç±»å‹åŠ¡å¿…ä¿æŒä¸€è‡´&lt;/strong>ï¼Œé¿å…éšå¼è£…æ¢&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">departments&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;100001&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- employees.emp_no dept_emp.emp_no ç±»å‹åŠ¡å¿…ä¿æŒä¸€è‡´
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- dept_emp.dept_no departmants.dept_no ç±»å‹åŠ¡å¿…ä¿æŒä¸€è‡´
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-ä¸å»ºè®®åˆ›å»ºç´¢å¼•">ğŸ™… ä¸å»ºè®®åˆ›å»ºç´¢å¼•&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>âŒ &lt;code>where&lt;/code> å­å¥ä¸­ç”¨ä¸åˆ°çš„å­—æ®µ&lt;/p>
&lt;p>ç´¢å¼•çš„ä½œç”¨æ˜¯å¿«é€Ÿå®šä½åˆ°æƒ³è¦çš„æ•°æ®ï¼Œç”¨ä¸åˆ°å°±æ²¡æœ‰å¿…è¦åˆ›å»ºæ•°æ®äº†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âŒ è¡¨é‡Œçš„è®°å½•éå¸¸å°‘&lt;/p>
&lt;p>å¦‚åªæœ‰ 100 æ¡æ•°æ®ï¼Œæœ‰æ— å½±å“ä¸å¤§ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âŒ æœ‰å¤§é‡é‡å¤æ•°æ®ï¼Œé€‰æ‹©æ€§ä½&lt;/p>
&lt;p>å¦‚ï¼šæ€§åˆ«å­—æ®µï¼Œå¯¼è‡´å¤§é‡å›è¡¨ã€‚&lt;/p>
&lt;p>ç´¢å¼•çš„é€‰æ‹©æ€§è¶Šé«˜ï¼ŒæŸ¥è¯¢æ•ˆç‡è¶Šå¥½ï¼Œå¯ä»¥åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­è¿‡æ»¤æ›´å¤šçš„è¡Œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âŒ é¢‘ç¹æ›´æ–°çš„å­—æ®µï¼Œåˆ›å»ºç´¢å¼•è¦è€ƒè™‘ç»´æŠ¤ç´¢å¼•çš„å¼€é”€&lt;/p>
&lt;p>é¢‘ç¹ä¿®æ”¹çš„å­—æ®µï¼Œä¸æ¨èåˆ›å»ºç´¢å¼•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="ç´¢å¼•å¤±æ•ˆä¸è§£å†³æ–¹æ¡ˆ">ç´¢å¼•å¤±æ•ˆä¸è§£å†³æ–¹æ¡ˆ&lt;/h2>
&lt;h3 id="-ç´¢å¼•åˆ—ä¸ç‹¬ç«‹è¿›è¡Œäº†è®¡ç®—æˆ–å˜æˆäº†å‚æ•°">âš ï¸ ç´¢å¼•åˆ—ä¸ç‹¬ç«‹ï¼Œè¿›è¡Œäº†è®¡ç®—æˆ–å˜æˆäº†å‚æ•°&lt;/h3>
&lt;ul>
&lt;li>ç´¢å¼•å­—æ®µè¿›è¡Œäº†è¡¨è¾¾å¼è®¡ç®—&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">form&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100003&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/index1.png"
width="1185"
height="157"
srcset="https://blog.letout.cn/p/mysql/index/index1_huaa761d032e691cca90bef5eef1dadb87_81724_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/index1_huaa761d032e691cca90bef5eef1dadb87_81724_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="754"
data-flex-basis="1811px"
>&lt;/p>
&lt;p>åº”äº‹å…ˆè®¡ç®—å¥½è¡¨è¾¾å¼çš„å€¼ï¼Œå†ä¼ å…¥ï¼Œé¿å…åœ¨ SQL &lt;code>where&lt;/code> çš„å·¦ä¾§åšè®¡ç®—ã€‚&lt;/p>
&lt;ul>
&lt;li>ç´¢å¼•å­—æ®µæ˜¯å‡½æ•°çš„å‚æ•°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">substring&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fitst_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Geo&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>äº‹å…ˆè®¡ç®—å¥½å†ä¼ å…¥ã€‚&lt;/p>
&lt;p>æˆ–è€…ä½¿ç”¨ä¸€äº›ç­‰ä»·çš„ SQLã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Geo%&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- first_name éœ€è¦æ˜¯ç´¢å¼•çš„æƒ…å†µä¸‹æœ‰æ•ˆï¼ˆæ ¹æ®å®é™…åœºæ™¯ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- æ³¨æ„ like ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/index2.png"
width="1169"
height="154"
srcset="https://blog.letout.cn/p/mysql/index/index2_hu58e272ce7b5bb61c6085e6a94f631f41_86327_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/index2_hu58e272ce7b5bb61c6085e6a94f631f41_86327_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="759"
data-flex-basis="1821px"
>&lt;/p>
&lt;h3 id="-ä½¿ç”¨äº†å·¦æ¨¡ç³Š">âš ï¸ ä½¿ç”¨äº†å·¦æ¨¡ç³Š&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;%Geo%&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- æ— æ³•ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employee&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Geo%&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- å¯ä»¥ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœæ— æ³•é¿å…ï¼Œä¸”æœ‰è¾ƒé«˜éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æœç´¢å¼•æ“ã€‚&lt;/p>
&lt;h3 id="-or-æŸ¥è¯¢çš„éƒ¨åˆ†å­—æ®µæ²¡æœ‰ç´¢å¼•">âš ï¸ or æŸ¥è¯¢çš„éƒ¨åˆ†å­—æ®µæ²¡æœ‰ç´¢å¼•&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">or&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">last_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Georgi&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- å‡è®¾å½“å‰ first_name æœ‰ç´¢å¼•ï¼Œlast_name æ²¡æœ‰ç´¢å¼•ï¼Œè¯¥æ¡ sql æ— æ³•ä½¿ç”¨ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(fitst_name)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/index3.png"
width="1148"
height="176"
srcset="https://blog.letout.cn/p/mysql/index/index3_hua5c1e2b296fd025c6e1f6de1e5790543_84429_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/index3_hua5c1e2b296fd025c6e1f6de1e5790543_84429_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="3"
class="gallery-image"
data-flex-grow="652"
data-flex-basis="1565px"
>&lt;/p>
&lt;p>è§£å†³ï¼šæ ¹æ®å®é™…ä¸šåŠ¡ï¼Œæ·»åŠ ç›¸åº”çš„ç´¢å¼•ã€‚&lt;/p>
&lt;p>æ·»åŠ ç´¢å¼•åï¼Œç´¢å¼•åˆå¹¶ï¼Œé¿å…äº†å…¨è¡¨æ‰«æã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/index4.png"
width="1129"
height="139"
srcset="https://blog.letout.cn/p/mysql/index/index4_hu903a3bbf3d6eb2ece40fc0c15484c985_86767_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/index4_hu903a3bbf3d6eb2ece40fc0c15484c985_86767_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="4"
class="gallery-image"
data-flex-grow="812"
data-flex-basis="1949px"
>&lt;/p>
&lt;h3 id="-ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™çš„æŸ¥è¯¢">âš ï¸ ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™çš„æŸ¥è¯¢&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Facello&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- index(last_name, first_name)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/index5.png"
width="1156"
height="155"
srcset="https://blog.letout.cn/p/mysql/index/index5_huc69773c1cc30429ec167298f8192f5a8_78720_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/index5_huc69773c1cc30429ec167298f8192f5a8_78720_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="5"
class="gallery-image"
data-flex-grow="745"
data-flex-basis="1789px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Facello&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- æ›´æ¢ç´¢å¼•é¡ºåº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(first_name, last_name)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/index6.png"
width="1144"
height="179"
srcset="https://blog.letout.cn/p/mysql/index/index6_huc94bdeb83f55eebd5e2d4f615313b023_79724_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/index6_huc94bdeb83f55eebd5e2d4f615313b023_79724_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="6"
class="gallery-image"
data-flex-grow="639"
data-flex-basis="1533px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">last_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- index(first_name, last_name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- MySQL çš„å¼•æ“ä¸ºæ›´å¥½åˆ©ç”¨å¤åˆç´¢å¼•ï¼Œä¼šåŠ¨æ€è°ƒæ•´å­—æ®µé¡ºåº
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å­—ç¬¦ä¸²æ¡ä»¶æ²¡æœ‰ä½¿ç”¨-">âš ï¸ å­—ç¬¦ä¸²æ¡ä»¶æ²¡æœ‰ä½¿ç”¨ &amp;quot;&amp;quot;&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- è¿™é‡Œ dept_no åœ¨æ•°æ®åº“å®šä¹‰ä¸º varchar
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-éšå¼è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ">âš ï¸ éšå¼è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept_emp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">departments&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">dept_no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emp_no&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;100001&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- employees.emp_no dept_emp.emp_no ç±»å‹ä¸ä¸€è‡´æ—¶ä¼šå¯¼è‡´éšå¼è½¬æ¢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- dept_emp de departments.dept_no ç±»å‹ä¸ä¸€è‡´æ—¶ä¼šå¯¼è‡´éšå¼è½¬æ¢
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="null-æ¡ä»¶æŸ¥è¯¢">null æ¡ä»¶æŸ¥è¯¢&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>æŸ¥è¯¢æ—¶ï¼Œé‡‡ç”¨ &lt;code>is null&lt;/code> &lt;code>is not null&lt;/code> æ¡ä»¶ï¼Œæ ¹æ®è¡¨ä¸­çš„æ•°æ®åˆ†å¸ƒï¼Œ&lt;strong>MySQL ä¼šè‡ªè¡Œåˆ¤æ–­æ˜¯å¦èµ°ç´¢å¼•ï¼Œå¹¶ä¸å›ºå®š&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MySQL å®˜æ–¹å»ºè®®å°½é‡æŠŠå­—æ®µå®šä¹‰ä¸º &lt;code>NOT NULL&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/index/index7.png"
width="821"
height="497"
srcset="https://blog.letout.cn/p/mysql/index/index7_hu4d7b4705c5cf93f7dc141b75d9f23067_225180_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/index/index7_hu4d7b4705c5cf93f7dc141b75d9f23067_225180_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="7"
class="gallery-image"
data-flex-grow="165"
data-flex-basis="396px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">explain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mobile&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">is&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="mysql-è¯„ä¼°å…¨è¡¨æ‰«ææ›´å¿«">MySQL è¯„ä¼°å…¨è¡¨æ‰«ææ›´å¿«&lt;/h3>
&lt;p>MySQL åœ¨æŸ¥è¯¢æ—¶ï¼Œä¼šè¯„ä¼°ä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡ä¸èµ°å…¨è¡¨æ‰«æçš„æ•ˆç‡ï¼Œå¦‚æœèµ°å…¨è¡¨æ‰«ææ›´å¿«ï¼Œåˆ™æ”¾å¼ƒç´¢å¼•ï¼Œèµ°å…¨è¡¨æ‰«æã€‚&lt;/p>
&lt;p>å› ä¸ºç´¢å¼•æ˜¯ç”¨æ¥ç´¢å¼•å°‘é‡æ•°æ®çš„ï¼Œå¦‚æœé€šè¿‡ç´¢å¼•æŸ¥è¯¢è¿”å›å¤§æ‰¹é‡çš„æ•°æ®ï¼Œåˆ™è¿˜ä¸å¦‚èµ°å…¨è¡¨æ‰«ææ¥çš„å¿«ï¼Œæ­¤æ—¶ç´¢å¼•å°±ä¼šå¤±æ•ˆã€‚&lt;/p>
&lt;h2 id="æœ€å·¦å‰ç¼€æ³•åˆ™">æœ€å·¦å‰ç¼€æ³•åˆ™&lt;/h2>
&lt;p>æœ€å·¦å‰ç¼€æ³•åˆ™æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚&lt;/p>
&lt;p>å¦‚æœè·³è·ƒæŸä¸€åˆ—ï¼Œç´¢å¼•å°†ä¼šéƒ¨åˆ†å¤±æ•ˆ(åé¢çš„å­—æ®µç´¢å¼•å¤±æ•ˆ)ã€‚&lt;/p>
&lt;p>ä¸­é—´ä¸èƒ½è·³è¿‡æŸä¸€åˆ—ï¼Œå¦åˆ™è¯¥åˆ—åé¢çš„å­—æ®µç´¢å¼•å°†å¤±æ•ˆã€‚&lt;/p>
&lt;h2 id="èŒƒå›´æŸ¥è¯¢">èŒƒå›´æŸ¥è¯¢&lt;/h2>
&lt;p>è”åˆç´¢å¼•ä¸­ï¼Œå‡ºç°èŒƒå›´æŸ¥è¯¢(&amp;gt;, &amp;lt;)ï¼ŒèŒƒå›´æŸ¥è¯¢å³ä¾§çš„åˆ—ç´¢å¼•å¤±æ•ˆã€‚&lt;/p>
&lt;h2 id="è¦†ç›–ç´¢å¼•">è¦†ç›–ç´¢å¼•&lt;/h2>
&lt;p>å¯¹äºç´¢å¼• Xï¼Œ&lt;code>SELECT&lt;/code> çš„å­—æ®µåªéœ€è¦ä»ç´¢å¼•ä¸­å°±èƒ½è·å¾—ï¼Œè€Œæ— éœ€å›è¡¨è·å–ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- index(name, age, pos)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pos&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">staffs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;July&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‰ç¼€ç´¢å¼•">å‰ç¼€ç´¢å¼•&lt;/h2>
&lt;p>å½“å­—æ®µç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼ˆvarcharï¼Œtextï¼Œlongtextç­‰ï¼‰æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¼šè®©
ç´¢å¼•å˜å¾—å¾ˆå¤§ï¼ŒæŸ¥è¯¢æ—¶ï¼Œæµªè´¹å¤§é‡çš„ç£ç›˜ IOï¼Œ å½±å“æŸ¥è¯¢æ•ˆç‡ã€‚&lt;/p>
&lt;p>å¯ä»¥åªå°†å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å‰ç¼€ï¼Œå»ºç«‹ç´¢å¼•ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§èŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œä»è€Œæé«˜ç´¢å¼•æ•ˆç‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- ä¸º email å­—æ®µï¼Œå»ºç«‹ç´¢å¼•é•¿åº¦ä¸º 5 çš„å‰ç¼€ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index_email_5&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tb_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="explain">explain&lt;/h2>
&lt;p>æŸ¥çœ‹ SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€‚å­—æ®µå«ä¹‰ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>id&lt;/p>
&lt;ul>
&lt;li>åœ¨ä¸€ä¸ªå¤§çš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œæ¯ä¸ª select å…³é”®å­—éƒ½å¯¹åº”ä¸€ä¸ªå”¯ä¸€ id&lt;/li>
&lt;li>id ç›¸åŒï¼Œæ‰§è¡Œé¡ºåºä»ä¸Šåˆ°ä¸‹ï¼›id ä¸åŒï¼Œå€¼è¶Šå¤§ï¼Œè¶Šå…ˆæ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>select_type&lt;/p>
&lt;ul>
&lt;li>è¡¨ç¤º select å¯¹åº”çš„æŸ¥è¯¢ç±»å‹&lt;/li>
&lt;li>SIMPLE (ç®€å• select,ä¸ä½¿ç”¨ union æˆ–å­æŸ¥è¯¢ç­‰)&lt;/li>
&lt;li>PRIMARY (æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†,æœ€å¤–å±‚çš„ select è¢«æ ‡è®°ä¸º PRIMARY)&lt;/li>
&lt;li>UNION (union ä¸­çš„ç¬¬äºŒä¸ªæˆ–åé¢çš„ select è¯­å¥)&lt;/li>
&lt;li>SUBQUERY (å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª select)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>table&lt;/p>
&lt;ul>
&lt;li>è¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>type&lt;/p>
&lt;ul>
&lt;li>MySQL åœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼&lt;/li>
&lt;li>æ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿æ¥ç±»å‹ä¸ºï¼šNULLã€systemã€constã€eq_refï¼‰ã€refã€rangeã€indexã€allï¼ˆå…¨è¡¨æ‰«æï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>possible_keys&lt;/p>
&lt;ul>
&lt;li>å¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸Šçš„ç´¢å¼•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>key&lt;/p>
&lt;ul>
&lt;li>å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æœä¸º NULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>key_len&lt;/p>
&lt;ul>
&lt;li>å®é™…ä½¿ç”¨ç´¢å¼•çš„é•¿åº¦ï¼ˆè¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ref&lt;/p>
&lt;ul>
&lt;li>ä¸Šè¿°è¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>rows&lt;/p>
&lt;ul>
&lt;li>MySQL è®¤ä¸ºå¿…é¡»è¦æ‰§è¡ŒæŸ¥è¯¢çš„è¡Œæ•°ï¼Œåœ¨ innodb å¼•æ“çš„è¡¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œä¸æ˜¯å‡†ç¡®çš„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Extra&lt;/p>
&lt;ul>
&lt;li>MySQLè§£å†³æŸ¥è¯¢çš„è¯¦ç»†ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://juejin.cn/post/6936032090546765837" target="_blank" rel="noopener"
>https://juejin.cn/post/6936032090546765837&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>æ•°æ®åº“åŸºç¡€æ€»ç»“</title><link>https://blog.letout.cn/p/mysql/sql-base/</link><pubDate>Wed, 01 Jun 2022 18:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/mysql/sql-base/</guid><description>&lt;img src="https://blog.letout.cn/imgs/29.jpeg" alt="Featured image of post æ•°æ®åº“åŸºç¡€æ€»ç»“" />&lt;h2 id="åˆ›å»ºæ•°æ®åº“">åˆ›å»ºæ•°æ®åº“&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">database&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">use&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ›å»ºè¡¨">åˆ›å»ºè¡¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">not&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">col1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">not&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">col2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">45&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">col3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">primary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ä¿®æ”¹è¡¨">ä¿®æ”¹è¡¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">alter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">add&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">char&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">alter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">drop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">column&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ é™¤è¡¨">åˆ é™¤è¡¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">drop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ’å…¥ä¿¡æ¯">æ’å…¥ä¿¡æ¯&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">insert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">col1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">values&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;val1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;val2&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ›´æ–°ä¿¡æ¯">æ›´æ–°ä¿¡æ¯&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">update&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ é™¤ä¿¡æ¯">åˆ é™¤ä¿¡æ¯&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">delete&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æŸ¥è¯¢">æŸ¥è¯¢&lt;/h2>
&lt;h3 id="distinct">distinct&lt;/h3>
&lt;p>å»é‡&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">distinct&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="limit">limit&lt;/h3>
&lt;p>é™åˆ¶è¿”å›çš„è¡Œæ•°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- è¿”å›å‰5è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- è¿”å› 3-5 è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- offset:2, limit:3 è·³è¿‡2è¡Œå–3ä¸ªç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">offset&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="asc">asc&lt;/h2>
&lt;p>å‡åºï¼ˆé»˜è®¤ï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">asc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="desc">desc&lt;/h2>
&lt;p>é™åº&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">desc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è¿‡æ»¤">è¿‡æ»¤&lt;/h2>
&lt;p>where&lt;/p>
&lt;ul>
&lt;li>
&lt;p>= ç­‰äº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&amp;lt; å°äº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&amp;gt; å¤§äº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>!= ä¸ç­‰äº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&amp;lt;= å°äºç­‰äº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&amp;gt;= å¤§äºç­‰äº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>between &amp;hellip; and &amp;hellip; ä¸¤ä¸ªå€¼ä¹‹é—´ï¼ˆå·¦é—­å³é—­åŒºé—´ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>is null ç©ºå€¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>and&lt;/p>
&lt;/li>
&lt;li>
&lt;p>or&lt;/p>
&lt;/li>
&lt;li>
&lt;p>in&lt;/p>
&lt;/li>
&lt;li>
&lt;p>not&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">is&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="é€šé…ç¬¦">é€šé…ç¬¦&lt;/h2>
&lt;ul>
&lt;li>&lt;code>%&lt;/code>
&lt;ul>
&lt;li>åŒ¹é… &amp;gt;= 0 ä¸ªå­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>_&lt;/code>
&lt;ul>
&lt;li>åŒ¹é…ä¸€ä¸ªå­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>[]&lt;/code>
&lt;ul>
&lt;li>åŒ¹é…é›†åˆå†…ä¸­çš„ä»»ä¸€å­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>[^]&lt;/code>
&lt;ul>
&lt;li>ä¸åŒ¹é…é›†åˆå†…çš„ä»»ä¸€å­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- ä¸ä»¥ A B å¼€å¤´çš„ä»»æ„æ–‡æœ¬
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;[^AB]%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- å­¦å·çš„æœ€åä¸€ä½ä¸æ˜¯2ã€3ã€5çš„å­¦ç”Ÿä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">å­¦ç”Ÿè¡¨&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">å­¦å·&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;%[^235]&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- æŸ¥è¯¢å­¦ç”Ÿè¡¨ä¸­å§“ å¼ ã€æã€åˆ˜ çš„å­¦ç”Ÿçš„æƒ…å†µã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">å­¦ç”Ÿè¡¨&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">å§“å&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;[å¼ æåˆ˜]%&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ†ç»„">åˆ†ç»„&lt;/h2>
&lt;p>GROUP BY&lt;/p>
&lt;p>æŠŠå…·æœ‰ç›¸åŒçš„æ•°æ®å€¼çš„è¡Œï¼Œæ”¾åœ¨åŒä¸€ç»„ä¸­ã€‚&lt;/p>
&lt;p>å¯ä»¥å¯¹åŒä¸€åˆ†ç»„æ•°æ®ï¼Œä½¿ç”¨æ±‡æ€»å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚æ±‚åˆ†ç»„æ•°æ®çš„å¹³å‡å€¼ã€‚&lt;/p>
&lt;p>æŒ‡å®šçš„åˆ†ç»„å­—æ®µï¼Œå¤„ç†èƒ½æŒ‰å­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œä¹Ÿä¼šè‡ªåŠ¨æŒ‰è¯¥å­—æ®µè¿›è¡Œæ’åºã€‚&lt;/p>
&lt;p>HAVING è¿‡æ»¤åˆ†ç»„ã€‚&lt;/p>
&lt;h2 id="å­æŸ¥è¯¢">å­æŸ¥è¯¢&lt;/h2>
&lt;p>å­æŸ¥è¯¢åªèƒ½è¿”å›ä¸€ä¸ªå­—æ®µçš„æ•°æ®ã€‚å¯ä»¥å°†å­æŸ¥è¯¢çš„ç»“æœä½œä¸º where è¯­å¥çš„è¿‡æ»¤æ¡ä»¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cust_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">cust_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">cust_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">corder_num&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cust_name&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è¿æ¥">è¿æ¥&lt;/h2>
&lt;p>æŠŠä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨çš„è¡Œç»“åˆèµ·æ¥&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mysql/sql-base/sql-join.png"
width="966"
height="760"
srcset="https://blog.letout.cn/p/mysql/sql-base/sql-join_hu7ef284e13e9cf28fd7f9189c5de87613_174040_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mysql/sql-base/sql-join_hu7ef284e13e9cf28fd7f9189c5de87613_174040_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="sql-join"
class="gallery-image"
data-flex-grow="127"
data-flex-basis="305px"
>&lt;/p>
&lt;h3 id="join--inner-join">JOIN / INNER JOIN&lt;/h3>
&lt;p>è¡¨ä¸­å­˜åœ¨è‡³å°‘ä¸€ä¸ªåŒ¹é…æ—¶è¿”å›è¡Œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">data&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">inner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--- inner join å’Œ join æ˜¯ä¸€æ ·çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">data&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="left-join">LEFT JOIN&lt;/h3>
&lt;p>ä» å·¦è¡¨ è¿”å›æ‰€æœ‰çš„è¡Œï¼Œå³ä½¿å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…ã€‚ï¼ˆæ²¡æœ‰åŒ¹é…æ˜¾ç¤ºç»“æœä¸º nullï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- è¿”å›æ‰€æœ‰çš„ç½‘ç«™åŠä»–ä»¬çš„è®¿é—®é‡ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- å°† website ä½œä¸ºå·¦è¡¨ï¼Œaccess_log ä½œä¸ºå³è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">left&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">desc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="right-join">RIGHT JOIN&lt;/h3>
&lt;p>ä»å³è¡¨è¿”å›æ‰€æœ‰çš„è¡Œï¼Œå³ä½¿åæ ‡æ²¡æœ‰åŒ¹é…ã€‚ï¼ˆå·¦è¡¨æ²¡æœ‰åŒ¹é…æ˜¾ç¤ºç»“æœä¸º nullï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- è¿”å›æ‰€æœ‰ç½‘ç«™çš„è®¿é—®è®°å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- åœ¨å·¦è¡¨ä¸­æ²¡æœ‰è®°å½•ï¼Œä¹Ÿä¼šæ˜¾ç¤º null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">right&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">desc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="full-joinä¸æ”¯æŒ">FULL JOINï¼ˆä¸æ”¯æŒï¼‰&lt;/h3>
&lt;p>ï¼ˆMySQL ä¸æ”¯æŒï¼Œä½¿ç”¨ union æ‹¼æ¥ï¼‰&lt;/p>
&lt;p>å…¨è¿æ¥ã€‚
åªè¦å·¦è¡¨ï¼Œå³è¡¨ï¼Œå…¶ä¸­ä¸€ä¸ªè¡¨å­˜åœ¨åŒ¹é…ï¼Œåˆ™è¿”å›è¡Œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">full&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">is&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">website&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">site_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access_log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">desc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è‡ªè¿æ¥">è‡ªè¿æ¥&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- æ‰¾å‡ºä¸ jim å¤„åœ¨åŒä¸€éƒ¨é—¨çš„æ‰€æœ‰å‘˜å·¥çš„å§“å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employee&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">department&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">department&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employee&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;jim&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employee&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">inner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">join&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">employee&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">department&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">department&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;jim&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ç»„åˆ">ç»„åˆ&lt;/h2>
&lt;p>union ç»„åˆä¸¤ä¸ªæŸ¥è¯¢ã€‚æ¯ä¸ªæŸ¥è¯¢å¿…é¡»åŒ…å«ç›¸åŒçš„åˆ—ï¼Œè¡¨è¾¾å¼å’Œèšé›†å‡½æ•°ã€‚&lt;/p>
&lt;p>é»˜è®¤å»é™¤ç›¸åŒçš„è¡Œï¼Œå¦‚æœéœ€è¦ä¿ç•™ç›¸åŒçš„è¡Œï¼Œä½¿ç”¨ union allã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">union&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mytable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">where&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‡½æ•°">å‡½æ•°&lt;/h2>
&lt;h3 id="è®¡ç®—å­—æ®µ">è®¡ç®—å­—æ®µ&lt;/h3>
&lt;ul>
&lt;li>avg()
&lt;ul>
&lt;li>å¹³å‡å€¼ï¼ˆä¼šå¿½ç•¥ null è¡Œï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>round()
&lt;ul>
&lt;li>round(x) å››èˆäº”å…¥ï¼›round(x, n) ä¿ç•™ n ä½å°æ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>count()
&lt;ul>
&lt;li>è¿”å›æŸåˆ—çš„è¡Œæ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>max()
&lt;ul>
&lt;li>è¿”å›æŸåˆ—çš„æœ€å¤§å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>min()
&lt;ul>
&lt;li>è¿”å›æŸåˆ—çš„æœ€å°å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>sum()
&lt;ul>
&lt;li>æŸåˆ—ä¹‹å’Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ–‡æœ¬å¤„ç†">æ–‡æœ¬å¤„ç†&lt;/h3>
&lt;ul>
&lt;li>left()
&lt;ul>
&lt;li>å·¦è¾¹çš„å­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>right()
&lt;ul>
&lt;li>å³è¾¹çš„å­—ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>lower()
&lt;ul>
&lt;li>è½¬æ¢æˆå°å†™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>upper()
&lt;ul>
&lt;li>è½¬æ¢æˆå¤§å†™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ltrem()
&lt;ul>
&lt;li>å»é™¤å·¦è¾¹çš„ç©ºæ ¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>rtrem()
&lt;ul>
&lt;li>å»é™¤å³è¾¹çš„ç©ºæ ¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>length()
&lt;ul>
&lt;li>é•¿åº¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>soundex()
&lt;ul>
&lt;li>è½¬æ¢æˆè¯­éŸ³å€¼&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ¡ä»¶å‡½æ•°">æ¡ä»¶å‡½æ•°&lt;/h3>
&lt;ul>
&lt;li>&lt;code>if(expr, v1, v2)&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>expr æˆç«‹ï¼Œè¿”å›ç»“æœ v1ï¼Œå¦åˆ™è¿”å› v2ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- SELECT IF(1 &amp;gt; 0,&amp;#39;æ­£ç¡®&amp;#39;,&amp;#39;é”™è¯¯&amp;#39;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- -&amp;gt;æ­£ç¡®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- --
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- å°†ç”¨æˆ·åˆ’åˆ†ä¸º25å²ä»¥ä¸‹å’Œ25å²åŠä»¥ä¸Šä¸¤ä¸ªå¹´é¾„æ®µï¼Œåˆ†åˆ«æŸ¥çœ‹è¿™ä¸¤ä¸ªå¹´é¾„æ®µç”¨æˆ·æ•°é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;25å²åŠä»¥ä¸Š&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;25å²ä»¥ä¸‹&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age_info&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user_profile&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">group&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age_info&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>ifnull(v1, v2)&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>v1 çš„å€¼ä¸ä¸º nullï¼Œè¿”å› v1ï¼Œå¦åˆ™è¿”å› v2ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ifnull&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">distinct&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Employee&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">order&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">desc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SecondHighestSalary&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>case&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- å°†ç”¨æˆ·åˆ’åˆ†ä¸º25å²ä»¥ä¸‹å’Œ25å²åŠä»¥ä¸Šä¸¤ä¸ªå¹´é¾„æ®µï¼Œåˆ†åˆ«æŸ¥çœ‹è¿™ä¸¤ä¸ªå¹´é¾„æ®µç”¨æˆ·æ•°é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">when&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;25å²åŠä»¥ä¸Š&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;25å²ä»¥ä¸‹&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">end&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age_info&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">number&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user_profile&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">group&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age_info&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- å°†ç”¨æˆ·åˆ’åˆ†ä¸º20å²ä»¥ä¸‹ï¼Œ20-24å²ï¼Œ25å²åŠä»¥ä¸Šä¸‰ä¸ªå¹´é¾„æ®µï¼Œåˆ†åˆ«æŸ¥çœ‹ä¸åŒå¹´é¾„æ®µç”¨æˆ·çš„æ˜ç»†æƒ…å†µ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">select&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">device_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gender&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">when&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;20å²ä»¥ä¸‹&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">when&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;20-24å²&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">when&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;25å²åŠä»¥ä¸Š&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;å…¶ä»–&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">end&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age_cut&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user_profile&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">update&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Salary&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">set&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sex&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">set&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">when&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;m&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;f&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">then&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;f&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">end&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted --></description></item><item><title>Redis æ•°æ®ç»“æ„</title><link>https://blog.letout.cn/p/redis/data-struct/</link><pubDate>Wed, 01 Jun 2022 01:52:45 +0800</pubDate><guid>https://blog.letout.cn/p/redis/data-struct/</guid><description>&lt;img src="https://blog.letout.cn/p/redis/data-struct/redis.jpg" alt="Featured image of post Redis æ•°æ®ç»“æ„" />&lt;p>Redis æä¾›äº†ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œå¸¸è§çš„æœ‰äº”ç§ï¼š&lt;/p>
&lt;ul>
&lt;li>String å­—ç¬¦ä¸²&lt;/li>
&lt;li>List åˆ—è¡¨&lt;/li>
&lt;li>Hash å“ˆå¸Œ&lt;/li>
&lt;li>Set é›†åˆ&lt;/li>
&lt;li>Zset æœ‰åºé›†åˆ&lt;/li>
&lt;/ul>
&lt;p>éšç€ Redis ç‰ˆæœ¬çš„æ›´æ–°ï¼Œåé¢åˆæ”¯æŒäº†å››ç§æ•°æ®ç±»å‹ï¼š&lt;/p>
&lt;ul>
&lt;li>BitMap (2.2)&lt;/li>
&lt;li>HyperLogLog (2.8)&lt;/li>
&lt;li>GEO (3.2)&lt;/li>
&lt;li>Stream (5.0)&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://try.redis.io/" target="_blank" rel="noopener"
>åœ¨çº¿ Redis ä½“éªŒ â†’ https://try.redis.io/&lt;/a>&lt;/p>
&lt;h2 id="-string">ğŸ¦® String&lt;/h2>
&lt;p>String æ˜¯æœ€åŸºæœ¬çš„ &lt;code>key-value&lt;/code> ç»“æ„ã€‚&lt;code>key&lt;/code> æ˜¯å”¯ä¸€æ ‡è¯†ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ï¼‰ï¼Œ&lt;code>value&lt;/code> æ˜¯å…·ä½“çš„å€¼ï¼ˆæœ€é•¿å¯ä»¥å®¹çº³ 521Mï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/string.webp"
width="1698"
height="724"
srcset="https://blog.letout.cn/p/redis/data-struct/string_hu6be3934e7d6496236c063d8dd99c676c_31658_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/string_hu6be3934e7d6496236c063d8dd99c676c_31658_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="562px"
>&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤">ğŸ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>ğŸ§© åŸºæœ¬æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è®¾ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">get name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">exists name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–å­—ç¬¦ä¸²çš„é•¿åº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">strlen name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">del name
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ§© æ‰¹é‡è®¾ç½®&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰¹é‡è®¾ç½® k-v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mset key1 value1 key2 value2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰¹é‡è·å– k-v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mget key1 key2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ§© è®¡æ•°å™¨ï¼ˆvalue ä¸ºæ•´æ•°ï¼‰&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è®¾ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> num &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">incr num
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">incrby num &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">decr num
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">decrby num &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ§© è¿‡æœŸï¼ˆé»˜è®¤ä¸ºæ°¸ä¸è¿‡æœŸï¼‰&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ ex-&amp;gt;ç§’ px-&amp;gt;æ¯«ç§’&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery ex &lt;span class="m">60&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯¹å·²å­˜åœ¨çš„ key è®¾ç½®è¿‡æœŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">expire name &lt;span class="m">60&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹è¿‡æœŸæ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ttl name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç§»é™¤è¿‡æœŸæ—¶é—´ï¼ˆæ— è¿‡æœŸæ—¶é—´ ttl è¿”å› -1ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persist name
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ§© å­˜åœ¨ä¸ä¸å­˜åœ¨&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># key ä¸å­˜åœ¨æ‰æˆåŠŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery nx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># key å­˜åœ¨æ‰æˆåŠŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name emery xx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®ç°æ–¹å¼">ğŸ¡ å®ç°æ–¹å¼&lt;/h3>
&lt;p>String çš„åº•å±‚å®ç°æ˜¯è‡ªå®šä¹‰çš„ SDSï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰ã€‚&lt;/p>
&lt;p>ç›¸æ¯”äº C è¯­è¨€çš„å­—ç¬¦ä¸²ï¼š&lt;/p>
&lt;ul>
&lt;li>SDS ä¸ä»…å¯ä»¥ä¿å­˜æ–‡æœ¬ï¼Œè¿˜å¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>SDS çš„ API éƒ½ä¼šä¸€å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼å¤„ç†ä¿å­˜åœ¨ &lt;code>buf[]&lt;/code> æ•°ç»„ä¸­çš„æ•°æ®ã€‚&lt;/p>
&lt;ul>
&lt;li>SDS è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚&lt;/li>
&lt;/ul>
&lt;p>C è¯­è¨€çš„å­—ç¬¦ä¸²ä¸ä¼šè®°å½•è‡ªèº«é•¿åº¦ï¼Œè·å–éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚SDS ç»“æ„ä¸­è®°å½•äº†é•¿åº¦ã€‚&lt;/p>
&lt;ul>
&lt;li>SDS çš„ API æ˜¯å®‰å…¨çš„ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²ä¸ä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚&lt;/li>
&lt;/ul>
&lt;p>SDS åœ¨æ‹¼æ¥å‰ä¼šæ£€æŸ¥ç©ºé—´æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œä¸å¤Ÿçš„è¯ä¼šè‡ªåŠ¨æ‰©å®¹ã€‚&lt;/p>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯">ğŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸ“ ç¼“å­˜å¯¹è±¡&lt;/p>
&lt;ul>
&lt;li>ç›´æ¥ç¼“å­˜ JSONã€‚ &lt;code>SET user:1 '{&amp;quot;name&amp;quot;:&amp;quot;emery&amp;quot;, &amp;quot;age&amp;quot;:18}'&lt;/code>&lt;/li>
&lt;li>åˆ†ç¦»ä¸º user:id ä½œä¸º keyï¼Œç”¨ mset å­˜å‚¨ã€‚ &lt;code>MSET user:1:name emery user:1:age 18 user:2:name lin user:2:age 20&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸ“ å¸¸è§„è®¡æ•°&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Redis å¤„ç†å‘½ä»¤æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥æ‰§è¡Œå‘½ä»¤çš„è¿‡ç¨‹æ˜¯åŸå­çš„ã€‚å¯ä»¥å¯¹è®¿é—®è®¿é—®æ¬¡æ•°ã€ç‚¹èµã€è½¬å‘ã€åº“å­˜æ•°é‡è¿›è¡Œç»Ÿè®¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> aritcle:readcount:1001 &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åŸå­æ“ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">incr aritcle:readcount:1001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ“ &lt;a class="link" href="https://www.letout.cn/p/distributed-lock/redis/" target="_blank" rel="noopener"
>åˆ†å¸ƒå¼é”&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>NX&lt;/code> å‚æ•°å¯ä»¥å®ç°åœ¨ key å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰æ’å…¥æ•°æ®ï¼Œå¯ä»¥ç”¨æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lock_key åˆ†å¸ƒå¼é”çš„ key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># unique_value å®¢æˆ·ç«¯ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># NX åœ¨ lock_key ä¸å­˜åœ¨æ—¶ï¼Œæ‰è¿›è¡Œæ“ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PX æ¯«ç§’ 10000ms -&amp;gt; 10s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> lock_key unique_value NX PX &lt;span class="m">10000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ“ å…±äº« session ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;p>Session ä¿å­˜åœ¨æœåŠ¡ç«¯ï¼Œé€šå¸¸ç”¨äºä¿å­˜ç”¨æˆ·çš„ä¼šè¯çŠ¶æ€ï¼ˆç™»å½•ï¼‰ã€‚&lt;/p>
&lt;p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¤šæ¬¡è¯·æ±‚ä¸ä¸€å®šéƒ½åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© Redis å¯¹ Session ä¿¡æ¯è¿›è¡Œç»Ÿä¸€çš„å­˜å‚¨å’Œç®¡ç†ï¼ŒæœåŠ¡å™¨éƒ½å»åŒä¸€ä¸ª Redis è·å–ç›¸å…³çš„ Session ä¿¡æ¯ï¼Œè¿™æ ·å°±è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ Session å­˜å‚¨çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/session.webp"
width="473"
height="412"
srcset="https://blog.letout.cn/p/redis/data-struct/session_hua9fef675509e88be48c6a316850a3976_17592_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/session_hua9fef675509e88be48c6a316850a3976_17592_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="114"
data-flex-basis="275px"
>&lt;/p>
&lt;h2 id="-list">ğŸ… List&lt;/h2>
&lt;p>List æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œå¯ä»¥ä»å¤´éƒ¨æˆ–å°¾éƒ¨å‘ List ä¸­æ·»åŠ å…ƒç´ ã€‚æœ€å¤§é•¿åº¦ä¸º &lt;code>2^32 - 1&lt;/code>ã€‚&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-1">ğŸ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/list.webp"
width="1936"
height="684"
srcset="https://blog.letout.cn/p/redis/data-struct/list_huc892bbfdf91688e9656244dd3482dcd2_21712_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/list_huc892bbfdf91688e9656244dd3482dcd2_21712_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="283"
data-flex-basis="679px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ’å…¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lpush key value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rpush key value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç§»é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lpop key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rpop key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿”å›æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ï¼ˆä» 0 å¼€å§‹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lrange key start end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå¹¶é˜»å¡ timeout ç§’ï¼ˆå½“ timeout=0 å°±ä¸€ç›´é˜»å¡ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">blpop key timeout
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">brpop key timeout
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®ç°æ–¹å¼-1">ğŸ¡ å®ç°æ–¹å¼&lt;/h3>
&lt;p>Redis List åº•å±‚ç”±ï¼ˆ1ï¼‰å‹ç¼©åˆ—è¡¨ æˆ– ï¼ˆ2ï¼‰åŒå‘é“¾è¡¨ å®ç°ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å‹ç¼©åˆ—è¡¨ï¼š&lt;/p>
&lt;ul>
&lt;li>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å°äº 512 ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± list-max-ziplist-entries é…ç½®ï¼‰ï¼Œ&lt;/li>
&lt;li>åˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äº 64 å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± list-max-ziplist-value é…ç½®ï¼‰ï¼Œ&lt;/li>
&lt;li>Redis ä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>åŒå‘åˆ—è¡¨ï¼šä¸æ»¡è¶³å‹ç¼©åˆ—è¡¨çš„æ¡ä»¶åº•å±‚å°±ä¼šä½¿ç”¨åŒå‘åˆ—è¡¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>å‹ç¼©åˆ—è¡¨&lt;/p>
&lt;p>æ˜¯ Reids ä¸ºäº†èŠ‚çº¦å†…å­˜è€Œå¼€å‘çš„ï¼Œç”±è¿ç»­å†…å­˜å—ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„ï¼Œæœ‰ç‚¹ç±»å‹äºæ•°ç»„ã€‚&lt;/p>
&lt;p>åœ¨è¡¨å¤´æœ‰ä¸‰ä¸ªå­—æ®µï¼š
ï¼ˆ1ï¼‰zlbytesï¼šå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜å­—èŠ‚æ•°ï¼›
ï¼ˆ2ï¼‰zltailï¼šåˆ—è¡¨å°¾çš„åç§»é‡ï¼ˆå°¾éƒ¨è·ç¦»é¦–éƒ¨æœ‰å¤šå°‘ä¸ªå­—èŠ‚ï¼‰ï¼›
ï¼ˆ3ï¼‰zllenï¼šå‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ï¼›&lt;/p>
&lt;p>åœ¨è¡¨å°¾æœ‰ä¸€ä¸ªå­—æ®µï¼š
ï¼ˆ4ï¼‰zlendï¼šåˆ—è¡¨ç»“æŸçš„æ ‡å¿—ï¼ˆå›ºå®šå€¼ 0xFF -&amp;gt; 255ï¼‰ï¼›&lt;/p>
&lt;p>æŸ¥æ‰¾å®šä½ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(1)
æŸ¥æ‰¾å…¶ä»–å…ƒç´ ï¼Œåªèƒ½é€ä¸ªæŸ¥æ‰¾ï¼ŒO(n)ï¼Œæ‰€ä»¥å‹ç¼©åˆ—è¡¨ä¸é€‚åˆä¿å­˜è¿‡å¤šçš„å…ƒç´ ã€‚&lt;/p>
&lt;p>åœ¨ Redisä¸­ï¼ŒListã€Hashã€Zset å¯¹è±¡ï¼Œåœ¨å…ƒç´ æ•°é‡è¾ƒå°‘ï¼Œå…ƒç´ å€¼ä¸å¤§æ—¶ï¼Œä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-1">ğŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ğŸ“ æ¶ˆæ¯é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/list-mq.webp"
width="1642"
height="374"
srcset="https://blog.letout.cn/p/redis/data-struct/list-mq_hu84909a50c09ec905badb1edece873c1a_26948_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/list-mq_hu84909a50c09ec905badb1edece873c1a_26948_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="439"
data-flex-basis="1053px"
>&lt;/p>
&lt;h2 id="-hash">ğŸ¦› Hash&lt;/h2>
&lt;p>Hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆ &lt;code>key-value&lt;/code>ï¼Œç‰¹åˆ«é€‚åˆå­˜å‚¨å¯¹è±¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/hash.webp"
width="1240"
height="888"
srcset="https://blog.letout.cn/p/redis/data-struct/hash_hu502a0c0c4b1bff1d1b5a1b9e04992920_41732_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/hash_hu502a0c0c4b1bff1d1b5a1b9e04992920_41732_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="139"
data-flex-basis="335px"
>&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-2">ğŸ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å­˜å‚¨ä¸€ä¸ª key=people çš„å“ˆå¸Œè¡¨ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hset people name &lt;span class="s2">&amp;#34;Emery&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–å“ˆå¸Œè¡¨ä¸­çš„å€¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hget people name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å­˜å‚¨å¤šä¸ªé”®å€¼å¯¹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmset people name &lt;span class="s2">&amp;#34;Emery&amp;#34;&lt;/span> age &lt;span class="m">18&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰¹é‡è·å–é”®å€¼å¯¹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmget people name age
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤ä¸€ä¸ªå“ˆå¸Œè¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hdel people
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å¾—å“ˆå¸Œè¡¨ä¸­key-valueå¯¹çš„æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hlen people
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„ key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hgetall people
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®ç°æ–¹å¼-2">ğŸ¡ å®ç°æ–¹å¼&lt;/h3>
&lt;p>Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ç”± ï¼ˆ1ï¼‰å‹ç¼©åˆ—è¡¨ æˆ– ï¼ˆ2ï¼‰å“ˆå¸Œè¡¨ å®ç°ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å‹ç¼©åˆ—è¡¨&lt;/p>
&lt;ul>
&lt;li>å…ƒç´ å°äº 512 ä¸ª&lt;/li>
&lt;li>æ‰€æœ‰çš„å€¼å°äº 64 å­—èŠ‚&lt;/li>
&lt;li>ä½¿ç”¨å‹ç¼©åˆ—è¡¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å“ˆå¸Œè¡¨&lt;/p>
&lt;ul>
&lt;li>ä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ä½¿ç”¨ hash è¡¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-2">ğŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ğŸ“ ç¼“å­˜å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/hash-object.webp"
width="1192"
height="840"
srcset="https://blog.letout.cn/p/redis/data-struct/hash-object_huacd74159ecd6ae063f912243dd43d93b_31326_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/hash-object_huacd74159ecd6ae063f912243dd43d93b_31326_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="340px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">hmset uid:10001 name Tom age &lt;span class="m">15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmset uid:10002 name Jerry age &lt;span class="m">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hmget uid:10001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ String ç±»å‹ç¼“å­˜ JSON ä¹Ÿæ˜¯ç¼“å­˜å¯¹è±¡çš„ä¸€ç§å‡¡æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­æŸäº›å±æ€§é¢‘ç¹å˜åŒ–ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Hashã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸ›’ è´­ç‰©è½¦
&lt;ul>
&lt;li>ğŸ˜ƒ ç”¨æˆ· id -&amp;gt; key&lt;/li>
&lt;li>ğŸª å•†å“ id -&amp;gt; field&lt;/li>
&lt;li>ğŸ”¢ å•†å“æ•°é‡ -&amp;gt; value&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ å•†å“ cart:{ç”¨æˆ·id} {å•†å“id} 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hset cart:10001 &lt;span class="m">22223&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hincrby cart:10001 &lt;span class="m">22223&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å¾—å•†å“æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hget cart:10001 &lt;span class="m">22223&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤å•†å“&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hdel cart:10001 &lt;span class="m">22223&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–è´­ç‰©è½¦æ‰€æœ‰å•†å“&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hgetall cart:10001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼ŒRedis ä¸­åªå­˜å‚¨äº†å•†å“çš„ id ä¿¡æ¯ï¼Œåœ¨å›æ˜¾å•†å“çš„å…·ä½“ä¿¡æ¯æ—¶ï¼Œå†æ‹¿å•†å“ id æŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“ï¼Œè·å–å®Œæ•´çš„å•†å“ä¿¡æ¯ã€‚&lt;/p>
&lt;h2 id="-set">ğŸ‘ Set&lt;/h2>
&lt;p>Set æ˜¯ä¸€ä¸ªæ— åºå¹¶å”¯ä¸€çš„é›†åˆï¼ˆå­˜å‚¨é¡ºåºä¸ä¼šæŒ‰ç…§æ’å…¥çš„å…ˆåé¡ºåºè¿›è¡Œå­˜å‚¨ï¼‰ã€‚&lt;/p>
&lt;p>é›†åˆä¸­æœ€å¤šå¯ä»¥å­˜å‚¨ &lt;code>2^32 - 1&lt;/code> ä¸ªå…ƒç´ ï¼Œé™¤å¢åˆ æ”¹æŸ¥å¤–ï¼Œè¿˜æ”¯æŒå¤šä¸ªé›†åˆçš„äº¤é›†ã€å¹¶é›†å’Œå·®é›†ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/set.webp"
width="1268"
height="654"
srcset="https://blog.letout.cn/p/redis/data-struct/set_hu834a88f1bdb5e75fecc5121b1cadeb66_29462_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/set_hu834a88f1bdb5e75fecc5121b1cadeb66_29462_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="193"
data-flex-basis="465px"
>&lt;/p>
&lt;p>List ä¸ Set çš„åŒºåˆ«ï¼š&lt;/p>
&lt;ul>
&lt;li>List å¯ä»¥å­˜å‚¨é‡å¤å…ƒç´ ï¼ŒSet ä¸å¯ä»¥&lt;/li>
&lt;li>List æŒ‰ç…§å…ƒç´ æ·»åŠ çš„é¡ºåºå­˜å‚¨å…ƒç´ ï¼ŒSet å­˜å‚¨å…ƒç´ æ˜¯æ— åºçš„&lt;/li>
&lt;/ul>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-3">ğŸ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>ğŸ§© å¸¸ç”¨æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ å…ƒç´ ï¼ˆå·²å­˜åœ¨åˆ™å¿½ç•¥ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd key value1 &lt;span class="o">[&lt;/span>value2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srem key value1 &lt;span class="o">[&lt;/span>value2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–æ‰€æœ‰çš„å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">smembers key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scard key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ¤æ–­æ˜¯å¦å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember key value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»é›†åˆä¸­éšæœºé€‰å– count ä¸ªå…ƒç´ ï¼Œä¸ä»ä¸­åˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srandmember key &lt;span class="o">[&lt;/span>count&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»é›†åˆä¸­éšæœºé€‰å– count ä¸ªå…ƒç´ ï¼Œå¹¶åˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spop key &lt;span class="o">[&lt;/span>count&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ§© è¿ç®—æ“ä½œ&lt;/li>
&lt;/ul>
&lt;p>âš  Set çš„äº¤å¹¶å·®é›†è¿ç®—çš„å¤æ‚åº¦è¾ƒé«˜ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œè®¡ç®—ï¼Œä¼šå¯¼è‡´ Redis å®ä¾‹é˜»å¡ã€‚
åœ¨å®é™…ä¸­ï¼Œæ¨èè·å–æ•°æ®åï¼Œåœ¨å®¢æˆ·ç«¯å»å®Œæˆè®¡ç®—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># äº¤é›†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sinter key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># äº¤é›†å¹¶å­˜å‚¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sinterstore destination key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¹¶é›†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sunion key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sunionstore destination key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å·®é›†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sdiff key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sdiffstore destination key1 &lt;span class="o">[&lt;/span>key2 ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®ç°æ–¹å¼-3">ğŸ¡ å®ç°æ–¹å¼&lt;/h3>
&lt;p>Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ç”± ï¼ˆ1ï¼‰å“ˆå¸Œè¡¨ æˆ– ï¼ˆ2ï¼‰æ•´æ•°é›†åˆå®ç°ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ•´æ•°é›†åˆ&lt;/p>
&lt;ul>
&lt;li>å…ƒç´ ä¸ªæ•°å°‘äº 512 ä¸ªï¼Œåº•å±‚é‡‡ç”¨æ•´æ•°é›†åˆä½œä¸ºæ•°æ®ç»“æ„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å“ˆå¸Œè¡¨&lt;/p>
&lt;ul>
&lt;li>ä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-3">ğŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;p>Set ä¸»è¦æ˜¯æ— ç»­ï¼Œä¸å¯é‡å¤ï¼Œå¯æ±‚äº¤å¹¶å·®çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸ“ ç‚¹èµ&lt;/li>
&lt;/ul>
&lt;p>Set ç±»å‹å¯ä»¥ä¿è¯ç”¨æˆ·åªèƒ½ç‚¹ä¸€ä¸ªèµã€‚&lt;/p>
&lt;ul>
&lt;li>key -&amp;gt; æ–‡ç«  id&lt;/li>
&lt;li>value -&amp;gt; ç”¨æˆ· id&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ–‡ç«  1 è¢« id ä¸º 1ã€2ã€3 çš„ç”¨æˆ·ç‚¹èµ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd article:1 uid:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd article:1 uid:2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd article:1 uid:3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å–æ¶ˆç‚¹èµ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srem article:1 uid:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å– æ–‡ç«  1 çš„ç‚¹èµç”¨æˆ· id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">smembers article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å– æ–‡ç«  1 çš„ç‚¹èµæ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scard article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ¤æ–­ ç”¨æˆ· 1 æ˜¯å¦å¯¹æ–‡ç«  1 è¿›è¡Œäº†ç‚¹èµ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember article:1 uid:1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ“ å…±åŒå…³æ³¨&lt;/li>
&lt;/ul>
&lt;p>Set æ”¯æŒäº¤é›†è¿ç®—ï¼Œå¯ä»¥ç”¨æ¥è®¡ç®—å…±åŒå…³æ³¨çš„å¥½å‹ï¼Œå…¬ä¼—å·ç­‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># id ä¸º 1ã€2 çš„ç”¨æˆ·å…³æ³¨çš„å…¬ä¼—å·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd uid:1 &lt;span class="m">5&lt;/span> &lt;span class="m">6&lt;/span> &lt;span class="m">7&lt;/span> &lt;span class="m">8&lt;/span> &lt;span class="m">9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sadd uid:2 &lt;span class="m">7&lt;/span> &lt;span class="m">8&lt;/span> &lt;span class="m">9&lt;/span> &lt;span class="m">10&lt;/span> &lt;span class="m">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å–å…±åŒå…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sinter uid:1 uid:2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç»™ uid:2 æ¨è uid:1 å…³æ³¨çš„å…¬ä¼—å·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sdiff uid:1 uid:2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># éªŒè¯æŸä¸ªå…¬ä¼—å·æ˜¯å¦è¢«åŒæ—¶å…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember uid:1 &lt;span class="m">5&lt;/span> &lt;span class="c1"># -&amp;gt; 1 å…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sismember uid:2 &lt;span class="m">5&lt;/span> &lt;span class="c1"># -&amp;gt; 0 æœªå…³æ³¨&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ“ æŠ½å¥–æ´»åŠ¨&lt;/li>
&lt;/ul>
&lt;p>key-&amp;gt;æ´»åŠ¨åï¼Œvalue-&amp;gt;ç”¨æˆ·åï¼Œå­˜å‚¨æŸæ´»åŠ¨ä¸­ä¸­å¥–çš„ç”¨æˆ·å ï¼ŒSet ç±»å‹å› ä¸ºæœ‰å»é‡åŠŸèƒ½ï¼Œå¯ä»¥ä¿è¯åŒä¸€ä¸ªç”¨æˆ·ä¸ä¼šä¸­å¥–ä¸¤æ¬¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sadd lucky Tom Jerry John Sean Marry Lindy Sary Mark
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŠ½å– 1 ä¸ªä¸€ç­‰å¥–ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srangememeber lucky &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŠ½å– 2 ä¸ªäºŒç­‰å¥–ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srangememeber lucky &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸å…è®¸é‡å¤è·å¥–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spop lucky &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-zset">ğŸ¦¥ Zset&lt;/h2>
&lt;p>Zsetï¼ˆæœ‰åºé›†åˆï¼Œä»å°åˆ°å¤§ï¼‰ ç›¸æ¯”äº Set ç±»å‹å¤šäº†ä¸€ä¸ªæ’åºåˆ†å€¼ socreã€‚&lt;/p>
&lt;p>å¯¹äºæœ‰åºé›†åˆ ZSet æ¥è¯´ï¼Œæ¯ä¸ªå­˜å‚¨çš„å…ƒç´ ç”±ä¸¤ä¸ªå€¼ç»„æˆï¼Œä¸€ä¸ªæ˜¯æœ‰åºé›†åˆçš„å…ƒç´ å€¼ï¼Œä¸€ä¸ªæ˜¯æ’åºå€¼ã€‚&lt;/p>
&lt;p>Zset ä¸­å…ƒç´ ä¸èƒ½é‡å¤ï¼Œåˆ†æ•°å€¼å¯ä»¥é‡å¤ï¼Œå¹¶ä¸”å¯ä»¥æ’åºã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/redis/data-struct/zset.webp"
width="1226"
height="616"
srcset="https://blog.letout.cn/p/redis/data-struct/zset_hudfba1ba2f4862e7afd7997bee0d59f08_21828_480x0_resize_q75_h2_box_2.webp 480w, https://blog.letout.cn/p/redis/data-struct/zset_hudfba1ba2f4862e7afd7997bee0d59f08_21828_1024x0_resize_q75_h2_box_2.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="199"
data-flex-basis="477px"
>&lt;/p>
&lt;h3 id="-å¸¸ç”¨å‘½ä»¤-4">ğŸ—ï¸ å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;ul>
&lt;li>ğŸ§© å¸¸ç”¨æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å‘æœ‰åºé›†åˆä¸­åŠ å…¥å¸¦åˆ†å€¼çš„å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zadd key socre number &lt;span class="o">[[&lt;/span>score number&lt;span class="o">]&lt;/span> ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»æœ‰åºé›†åˆä¸­åˆ é™¤å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrem key number &lt;span class="o">[&lt;/span>number ...&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿”å›æœ‰åºé›†åˆä¸­å…ƒç´ çš„åˆ†æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zscore key number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿”å›æœ‰åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zcard key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸ºæœ‰åºé›†åˆä¸­ member çš„åˆ†å€¼åŠ ä¸Š increment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zincrby key increment member
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ­£åºè·å–æœ‰åºé›†åˆä¸­ start-&amp;gt;end çš„ä¸‹è¡¨å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrange key start end &lt;span class="o">[&lt;/span>withscores&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å€’åºè·å–æœ‰åºé›†åˆä¸­ start-&amp;gt;end çš„ä¸‹æ ‡å…ƒç´ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrevrange key start end &lt;span class="o">[&lt;/span>withscores&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-å®ç°æ–¹å¼-4">ğŸ¡ å®ç°æ–¹å¼&lt;/h3>
&lt;p>æœ‰åºé›†åˆ Zset åº•å±‚ä½¿ç”¨ ï¼ˆ1ï¼‰å‹ç¼©åˆ—è¡¨ æˆ– ï¼ˆ2ï¼‰è·³è¡¨ ä½œä¸ºæ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å‹ç¼©åˆ—è¡¨ï¼šæœ‰åºé›†åˆä¸­å…ƒç´ å°äº 128 ä¸ªï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äº 64 å­—èŠ‚æ—¶ï¼Œä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·³è¡¨ï¼šä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œä½¿ç”¨è°ƒè¡¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-ä½¿ç”¨åœºæ™¯-4">ğŸ§µ ä½¿ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ğŸ“ æ’è¡Œæ¦œ&lt;/li>
&lt;/ul>
&lt;p>ä¾‹å¦‚æ¸¸æˆç§¯åˆ†æ’è¡Œæ¦œï¼Œè§†é¢‘æ’­æ”¾æ’åï¼Œç”µå•†ç³»ç»Ÿä¸­å•†å“çš„é”€é‡æ’åã€‚&lt;/p>
&lt;p>key-&amp;gt;æ’è¡Œæ¦œçš„ç±»å‹ï¼›member-&amp;gt;éœ€æ’è¡Œçš„å†…å®¹ï¼ˆå¦‚æ–‡ç« idï¼‰ï¼›score-&amp;gt;ç‚¹å‡»æ•°ã€ç‚¹èµæ•°ç­‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># emery å‘çš„id=1çš„æ–‡ç« è·å¾—äº† 200 ä¸ªèµ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zadd user:emery:ranking &lt;span class="m">200&lt;/span> arcticle:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç»™æ–‡ç«  1 ç‚¹èµ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zincrby user:emery:ranking &lt;span class="m">1&lt;/span> article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹æŸç¯‡æ–‡ç« çš„ç‚¹èµæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zscore user:emery:ranking article:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹ç‚¹èµæ•°æœ€å¤šçš„ 3 ç¯‡æ–‡ç« &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrevrange user:emery:ranking &lt;span class="m">0&lt;/span> &lt;span class="m">2&lt;/span> withscores
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·å– 100 èµåˆ° 200 èµçš„æ–‡ç« &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zrangebysocre user:emery:ranking &lt;span class="m">100&lt;/span> &lt;span class="m">200&lt;/span> withscores
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ“ å»¶æ—¶é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;p>åˆ©ç”¨ score å­˜å‚¨å»¶æ—¶æ‰§è¡Œçš„æ—¶é—´ï¼Œä½¿ç”¨ zrangebysocre æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œå†è¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="-å‚è€ƒ">ğŸ”— å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://xiaolincoding.com/redis/data_struct/command.html" target="_blank" rel="noopener"
>https://xiaolincoding.com/redis/data_struct/command.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>ä½¿ç”¨ ZooKeeper å®ç°åˆ†å¸ƒå¼é”</title><link>https://blog.letout.cn/p/distributed-lock/zookeeper/</link><pubDate>Wed, 11 May 2022 21:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/distributed-lock/zookeeper/</guid><description>&lt;img src="https://blog.letout.cn/imgs/2.jpeg" alt="Featured image of post ä½¿ç”¨ ZooKeeper å®ç°åˆ†å¸ƒå¼é”" />&lt;h2 id="ä½¿ç”¨-zookeeper-å®ç°">ä½¿ç”¨ ZooKeeper å®ç°&lt;/h2>
&lt;h3 id="åŸç†">åŸç†&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>æŒä¹…èŠ‚ç‚¹ï¼ˆçº¢è‰²ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¬æ—¶èŠ‚ç‚¹ï¼ˆé»„è‰²ï¼‰ï¼šä¸å¯å†æœ‰å­èŠ‚ç‚¹ï¼Œä¼šè¯ç»“æŸåç¬æ—¶èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ¶ˆå¤±&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/distributed-lock/zookeeper/node.png"
width="542"
height="618"
srcset="https://blog.letout.cn/p/distributed-lock/zookeeper/node_hubb94f897927986ed284f5e5898a8688d_78967_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/distributed-lock/zookeeper/node_hubb94f897927986ed284f5e5898a8688d_78967_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="node"
class="gallery-image"
data-flex-grow="87"
data-flex-basis="210px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åˆ©ç”¨ Zookeeper çš„ç¬æ—¶æœ‰åºèŠ‚ç‚¹çš„ç‰¹æ€§ï¼Œå¤šçº¿ç¨‹å¹¶å‘åˆ›å»ºç¬æ—¶èŠ‚ç‚¹æ—¶ï¼Œå¾—åˆ°æœ‰åºçš„åºåˆ—&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åºå·æœ€å°çš„çº¿ç¨‹è·å¾—é”ï¼Œå…¶ä»–çš„çº¿ç¨‹åˆ™ç›‘å¬è‡ªå·±åºå·çš„å‰ä¸€ä¸ªåºå·ï¼›å½“å‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œåˆ é™¤è‡ªå·±åºå·çš„èŠ‚ç‚¹ï¼›ä¸‹ä¸€ä¸ªåºå·çš„çº¿ç¨‹å¾—åˆ°é€šçŸ¥ï¼Œå°†ç»§ç»­æ‰§è¡Œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå·²ç»ç¡®å®šäº†çº¿ç¨‹çš„æ‰§è¡Œé¡ºåº&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/distributed-lock/zookeeper/thread.png"
width="485"
height="297"
srcset="https://blog.letout.cn/p/distributed-lock/zookeeper/thread_hu0d11f519269d68572311b436f0d9b410_73659_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/distributed-lock/zookeeper/thread_hu0d11f519269d68572311b436f0d9b410_73659_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="thread"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="391px"
>&lt;/p>
&lt;h3 id="å®ç°">å®ç°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ZkLock&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">AutoCloseable&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Watcher&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">ZooKeeper&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">znode&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// å½“å‰çº¿ç¨‹åˆ›å»ºçš„è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">ZkLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">connectString&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">sessionTimeout&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IOException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">zooKeeper&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ZooKeeper&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">connectString&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">sessionTimeout&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * try-catch-with-resource
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">clode&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">Exception&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">delete&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">znode&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é‡Šæ”¾é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * è§‚å¯Ÿå™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">process&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">WatchedEvent&lt;/span> &lt;span class="n">watchedEvent&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰ä¸€ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤æ—¶ï¼Œå¯å”¤é†’è·å–é”çš„ç­‰å¾…ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹è·å–äº†é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">watchedEvent&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">Event&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">EventType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">NodeDeleted&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">notify&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * è·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">getLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Stat&lt;/span> &lt;span class="n">stat&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">exists&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">stat&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// å½“å‰ä¸šåŠ¡è‹¥æ²¡æœ‰æŒä¹…èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å…ˆåˆ›å»ºä¸€ä¸ªæŒä¹…èŠ‚ç‚¹ï¼Œåœ¨æŒä¹…èŠ‚ç‚¹é‡Œåˆ›å»ºç¬æ—¶èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getBytes&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">StandardCharsets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">UTF_8&lt;/span>&lt;span class="o">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ZooDefs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Ids&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">OPEN_ACL_UNSAFE&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// å…¬å¼€æƒé™ï¼Œä¸ä½¿ç”¨ç”¨æˆ·åå¯†ç å°±èƒ½è®¿é—®è¿™ä¸ªèŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">CreateMode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PERSISTENT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ›å»ºç¬æ—¶æœ‰åºèŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">subPath&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;_&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">znode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subPath&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">businessCode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getBytes&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">StandardCharsets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">UTF_8&lt;/span>&lt;span class="o">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ZooDefs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Ids&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">OPEN_ACL_UNSAFE&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CreateMode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">EPHEMERAL_SEQUENTIAL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è·å–è¯¥ä¸šåŠ¡ä¸‹çš„æ‰€æœ‰ç¬æ—¶èŠ‚ç‚¹ï¼Œè¿›è¡Œæ¯”è¾ƒæ’åº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">childrenNodes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getChildren&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sort&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">childrenNodes&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æœåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯å½“å‰åˆ›å»ºçš„èŠ‚ç‚¹ï¼Œç›´æ¥è·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">firstNode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">childrenNodes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">znode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">endsWith&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">firstNode&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç­‰å¾…è·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">lastNode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">firstNode&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">childrenNode&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ‰¾åˆ°å½“å‰èŠ‚ç‚¹ï¼Œç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">znode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">endWith&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">zooKeeper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">exists&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">businessCode&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">lastNode&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lastNode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">node&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è®©å½“å‰çº¿ç¨‹é˜»å¡ï¼Œå¹¶ä¸”ä¼šé‡Šæ”¾é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ä¸Šé¢çš„åŒæ­¥ä»£ç å—æ‰ä¼šè·å¾—é”å¹¶æ‰§è¡Œ notify()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">KeeperException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æµ‹è¯•">æµ‹è¯•&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ZkLockController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/zkLock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">zkLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;è¿›å…¥æ–¹æ³•&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ZkLock&lt;/span> &lt;span class="n">zklock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ZkLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;127.0.0.1:2181&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">10000&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">zkLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;order&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;è·å–äº†é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUtil&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ¨¡æ‹Ÿä¸šåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®Œæˆä¸šåŠ¡&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;success&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="curator">Curator&lt;/h2>
&lt;p>&lt;img src="https://blog.letout.cn/p/distributed-lock/zookeeper/curator.png"
width="537"
height="87"
srcset="https://blog.letout.cn/p/distributed-lock/zookeeper/curator_hu690a82169c4c3fdc258308de88a2c62f_35331_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/distributed-lock/zookeeper/curator_hu690a82169c4c3fdc258308de88a2c62f_35331_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="curator"
class="gallery-image"
data-flex-grow="617"
data-flex-basis="1481px"
>&lt;/p>
&lt;h3 id="ä¾èµ–é…ç½®">ä¾èµ–é…ç½®&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.apache.curator&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>curator-recipes&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>4.2.0&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®ç°-1">å®ç°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">DemoTest&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">test&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">zookeeperConnectionString&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;127.0.0.1:2181&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RetryPolicy&lt;/span> &lt;span class="n">retryPolicy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ExponentialBackoffRetry&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CuratorFramework&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">CuratorFrameworkFactory&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newClient&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">zookeeperConnectionString&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">retryPolicy&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">lockPath&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/order&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">InterProcessMutex&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">InterProcessMutex&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">lockPath&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è·å–äº’æ–¥é”ï¼Œé˜»å¡ç›´åˆ°å¯ç”¨ï¼Œæˆ–ç»™å®šæ—¶é—´åˆ°æœŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// åŒä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ acquire() å¯é‡å…¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">acquire&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;è·å–é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¿…é¡»é€šè¿‡ release() é‡Šæ”¾é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">release&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”</title><link>https://blog.letout.cn/p/distributed-lock/redis/</link><pubDate>Wed, 11 May 2022 12:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/distributed-lock/redis/</guid><description>&lt;img src="https://blog.letout.cn/imgs/1.jpeg" alt="Featured image of post ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”" />&lt;h2 id="redis-nx-å®ç°">Redis NX å®ç°&lt;/h2>
&lt;p>åˆ©ç”¨ NX çš„&lt;strong>åŸå­æ€§&lt;/strong>ï¼Œå¤šä¸ªçº¿ç¨‹å¹¶å‘æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¾ç½®æˆåŠŸï¼Œè®¾ç½®æˆåŠŸå³è·å–äº†é”ã€‚&lt;/p>
&lt;p>&lt;strong>å¦‚æœæ²¡æœ‰è·å–é”ï¼Œä¸ä¼šé˜»å¡å½“å‰æ–¹æ³•ï¼Œç›´æ¥è·³è¿‡ä»»åŠ¡ã€‚&lt;/strong>&lt;/p>
&lt;h3 id="è·å–é”">è·å–é”&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set key unique_value NX PX 30000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> product:stock:clothes UUID NX PX &lt;span class="m">30000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>key
&lt;ul>
&lt;li>æ ¹æ®ä¸åŒçš„ä¸šåŠ¡ï¼ŒåŒºåˆ†ä¸åŒçš„é”&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>unique_value
&lt;ul>
&lt;li>ä¿è¯æ¯ä¸ªçº¿ç¨‹çš„éšæœºå€¼éƒ½ä¸åŒï¼Œç”¨äºé‡Šæ”¾é”æ—¶çš„æ ¡éªŒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>NX
&lt;ul>
&lt;li>key ä¸å­˜åœ¨æ—¶è®¾ç½®æˆåŠŸï¼Œkey å­˜åœ¨åˆ™ä¸æˆåŠŸ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>PX
&lt;ul>
&lt;li>è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ã€‚è‹¥å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå¯ä»¥ä¿è¯è¶…æ—¶åï¼Œé”å¯ä»¥è¿‡æœŸå¤±æ•ˆï¼ˆæ¯«ç§’ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="é‡Šæ”¾é”">é‡Šæ”¾é”&lt;/h3>
&lt;p>é‡Šæ”¾é”å°†è¯¥ key åˆ é™¤ï¼Œåœ¨é‡Šæ”¾é”ä¹‹å‰éœ€è¦æ ¡éªŒè®¾ç½®çš„éšæœºæ•°ï¼Œç›¸åŒæ‰è¡¨ç¤ºæ˜¯è¯¥çº¿ç¨‹åŠ çš„é”ï¼Œèƒ½é‡Šæ”¾ã€‚&lt;/p>
&lt;p>éœ€è¦é‡‡ç”¨ LUA è„šæœ¬ï¼Œdel å‘½ä»¤æ²¡æœ‰æä¾›æ ¡éªŒå€¼çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>redis æ‰§è¡Œå‘½ä»¤æ˜¯æŒ‰ç…§ä¸€æ¡æŒ‡ä»¤å®Œæˆä¹‹åï¼Œå†æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œç”¨ lua è„šæœ¬ï¼Œèƒ½ä¿è¯ redis æ‰§è¡Œå®Œè¿™ä¸ªè„šæœ¬æ‰æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œæ‰€ä»¥èƒ½ä¿è¯åˆ¤æ–­ å’Œ åˆ é™¤æ˜¯åŸå­æ€§çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">if&lt;/span> &lt;span class="n">redis.call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;get&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">KEYS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">ARGV&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="kr">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="n">redis.call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;del&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">KEYS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å®ç°">å®ç°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedisLockController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/redisLock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">redisLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è·å–åˆ†å¸ƒå¼é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">RedisCallback&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;)&lt;/span> &lt;span class="n">redisConnection&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Expiration&lt;/span> &lt;span class="n">expiration&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Expiration&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">seconds&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// NX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span> &lt;span class="n">setOption&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ifAbsent&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// éœ€è¦ä½¿ç”¨ redisTemplate ä¸­çš„åºåˆ—åŒ–å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKeySerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisValue&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValueSerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">redisConnection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisKey&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">redisValue&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">expiration&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// è·å–åˆ°äº†é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;è·å–åˆ°äº†é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;if redis.call(\&amp;#34;get\&amp;#34;,KEYS[1])==ARGV[1] then\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn redis.call(\&amp;#34;del\&amp;#34;,KEYS[1])\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;else\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn 0\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;end&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">redisScript&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">of&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Boolean&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisScript&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é‡Šæ”¾é” {}&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ä¸šåŠ¡å®Œæˆ&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;success&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedisLock&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”åç§°ï¼Œä¸åŒä¸šåŠ¡å¯èƒ½é”ä¸åŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">RedisLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">RedisTemplate&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">redisTemplate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">expireTime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">expireTime&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// value å¯ä»¥ä¸æš´éœ²å‡ºå»ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ä¸ä¸€æ ·çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">UUID&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">randomUUID&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * è·å–é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">getLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è·å–åˆ†å¸ƒå¼é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">RedisCallback&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;)&lt;/span> &lt;span class="n">redisConnection&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Expiration&lt;/span> &lt;span class="n">expiration&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Expiration&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">seconds&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">expireTime&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// NX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span> &lt;span class="n">setOption&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisStringCommands&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SetOption&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ifAbsent&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç”±äºè¿™é‡Œéœ€è¦æ¥å— byte, ä¸èƒ½æš´åŠ›çš„ä½¿ç”¨ string.getBytes()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// è¦ä½¿ç”¨æ¨¡æ¿é‡Œé¢çš„ key\value åºåˆ—åŒ–å™¨æ¥å®ç°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKeySerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">redisValue&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValueSerializer&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">serialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redisConnection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisKey&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">redisValue&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">expiration&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">setOption&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * é‡Šæ”¾é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">unLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// lua è„šæœ¬
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;if redis.call(\&amp;#34;get\&amp;#34;,KEYS[1])==ARGV[1] then\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn redis.call(\&amp;#34;del\&amp;#34;,KEYS[1])\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;else\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;\treturn 0\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;end&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">redisScript&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RedisScript&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">of&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Boolean&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Boolean&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Boolean&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">redisTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">redisScript&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="redisson">Redisson&lt;/h2>
&lt;h3 id="ä¾èµ–é…ç½®">ä¾èµ–é…ç½®&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.redisson&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>redisson-spring-boot-starter&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>3.16.7&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®ç°-1">å®ç°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Slf4j&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RedissonLockController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">RedissonClient&lt;/span> &lt;span class="n">redissonClient&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/redissonLock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">redissonLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;æ‰§è¡Œæ–¹æ³•&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;redisson&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redissonClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœæœªè·å¾—é”ï¼Œä¼šé˜»å¡ç­‰å¾…è·å–åˆ°é”ï¼ˆ-1 è¡¨ç¤ºæ²¡æœ‰è¶…æ—¶æ—¶é—´ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;è·å–é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é‡Šæ”¾é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®Œæˆä¸šåŠ¡&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;success&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - CyclicBarrier å®ç°åŸç†</title><link>https://blog.letout.cn/p/thread/cyclicbarrier/</link><pubDate>Tue, 03 May 2022 23:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/thread/cyclicbarrier/</guid><description>&lt;img src="https://blog.letout.cn/imgs/14.jpeg" alt="Featured image of post Java å¹¶å‘ - CyclicBarrier å®ç°åŸç†" />&lt;h2 id="åŸç†">åŸç†&lt;/h2>
&lt;p>&lt;code>CyclicBarrier&lt;/code> é€šè¿‡å¯é‡å…¥é” &lt;code>CyclicBarrier&lt;/code> å®ç°ï¼Œå†…éƒ¨ä½¿ç”¨é™æ€å†…éƒ¨ç±» &lt;code>Generation&lt;/code> ç»´æŠ¤ &lt;code>broken&lt;/code> æ ‡è®°ï¼Œè¡¨ç¤ºå±éšœæ˜¯å¦å¯ç”¨ã€‚&lt;/p>
&lt;p>é€šè¿‡æ„é€ æ–¹æ³•ä¼ å…¥ç­‰å¾…çº¿ç¨‹æ•° &lt;code>parties&lt;/code>ã€‚&lt;/p>
&lt;p>æ¯æ¬¡æœ‰ä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœï¼Œ &lt;code>count - 1&lt;/code>ï¼Œç›´åˆ° &lt;code>count = 0&lt;/code>ï¼Œä¼šé‡Šæ”¾å±éšœï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨ &lt;code>nextGeneration()&lt;/code> å¯¹ &lt;code>count&lt;/code> å’Œ &lt;code>generation&lt;/code> è¿›è¡Œé‡ç½®ï¼Œè¿›è¡Œä¸‹ä¸€è½®å¾ªç¯ã€‚&lt;/p>
&lt;p>æœ‰ä¸‰ç§æƒ…å†µä¼šé€ æˆå±éšœç ´åï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>CyclicBarrier Runnable command æ–¹æ³•æŠ›å‡ºå¼‚å¸¸&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨é‡Šæ”¾æ¡ä»¶è¿˜æœªè¾¾åˆ°æ—¶ï¼ŒæŸä¸ªçº¿ç¨‹æŠ›å‡ºäº†å¼‚å¸¸&lt;/p>
&lt;/li>
&lt;li>
&lt;p>await() ç­‰å¾…è¶…æ—¶&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æºç ">æºç &lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">CyclicBarrier&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å†…éƒ¨ç±»ï¼Œå­˜æ”¾ broken æ ‡è®°ï¼Œè¡¨ç¤ºå±éšœæ˜¯å¦è¢«æŸåï¼ŒæŸååæ— æ³•æ­£å¸¸å·¥ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Generation&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">broken&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¯é‡å…¥é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Condition&lt;/span> &lt;span class="n">trip&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newCondition&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å±éšœé˜»æŒ¡çš„çº¿ç¨‹æ•°ï¼Œæ„é€ æ–¹æ³•ä¼ å…¥çš„åˆå§‹åŒ–å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å±éšœé‡Šæ”¾æ—¶æ‰§è¡Œçš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="n">barrierCommand&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰çš„ Generation å¯¹è±¡ï¼Œæ¯ä¸€è½®éƒ½ä¼šæœ‰ä¸€ä¸ªæ–°çš„ Generation å¯¹è±¡ï¼Œå­˜æ”¾ broken æ ‡è®°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="n">Generation&lt;/span> &lt;span class="n">generation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Generation&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰è¿˜éœ€è¦é˜»æŒ¡å‡ ä¸ªçº¿ç¨‹ï¼Œæ¯æ¬¡ -1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¼€å¯ä¸‹ä¸€è½®å±éšœï¼ˆcount==0 æˆ– resetï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">nextGeneration&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">signalAll&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡ç½® count
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">generation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Generation&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç ´åå½“å‰å±éšœï¼Œå˜ä¸ºä¸å¯ç”¨çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ reset æ¢å¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">breakBarrier&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">generation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">signalAll&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">dowait&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">boolean&lt;/span> &lt;span class="n">timed&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">nanos&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeoutException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åŠ é”ï¼Œæœ‰å¤šä¸ªçº¿ç¨‹ä¼šè°ƒç”¨ await() åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥åŒæ­¥æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">Generation&lt;/span> &lt;span class="n">g&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generation&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// å±éšœæ˜¯å¦æŸå
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">interrupted&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">index&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">index&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// è¾¾åˆ°æ¡ä»¶ï¼Œå¯æ‰“ç ´å±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">ranAction&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="n">command&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">barrierCommand&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">command&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// æ‰§è¡Œæ‰“ç ´å±éšœçš„å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">command&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ranAction&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nextGeneration&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// å¼€å¯ä¸‹ä¸€è½®å¾ªç¯ï¼Œé‡Œé¢ä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">ranAction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// (1) å‡å¦‚ command å‡ºç°å¼‚å¸¸ï¼Œç ´åå±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰è¿˜æœªè¾¾åˆ°å†²ç ´å±éšœçš„çš„æ¡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ä¸€ç›´å¾ªç¯ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾æ‰“ç ´å±éšœçš„æ¡ä»¶ï¼Œä¸­æ–­ï¼Œæˆ–è¶…æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(;;)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">timed&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// æœªè¾¾åˆ°è¶…æ—¶æ—¶é—´ï¼Œè¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°è¢«å”¤é†’
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">nanos&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">L&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nanos&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">trip&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">awaitNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">nanos&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">ie&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// (2) ç­‰å¾…åˆ°è¾¾æ¡ä»¶æ—¶ï¼Œçº¿ç¨‹è¢«ä¸­æ–­ï¼Œç ´åå±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">generation&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="o">!&lt;/span> &lt;span class="n">g&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">ie&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// We&amp;#39;re about to finish waiting even if we had not
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// been interrupted, so this interrupt is deemed to
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// &amp;#34;belong&amp;#34; to subsequent execution.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">interrupt&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// çº¿ç¨‹è¢«å”¤é†’ä¹‹åï¼Œå±éšœè¢«ç ´åï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">g&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">generation&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// è¿”å›å½“å‰çº¿ç¨‹æ˜¯ç¬¬å‡ ä¸ªåˆ°è¾¾çš„çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">timed&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">nanos&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">L&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// (3) ç­‰å¾…è¶…æ—¶ï¼Œç ´åå±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">TimeoutException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">CyclicBarrier&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="n">barrierAction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">parties&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">IllegalArgumentException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">parties&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">barrierCommand&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">barrierAction&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">CyclicBarrier&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">parties&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getParties&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">parties&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¼€å§‹ç­‰å¾… è¿”å›å½“å‰çº¿ç¨‹æ˜¯ç¬¬å‡ ä¸ªåˆ°è¾¾çš„çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BrokenBarrierException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">dowait&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">L&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">TimeoutException&lt;/span> &lt;span class="n">toe&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Error&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">toe&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// cannot happen
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="n">timeout&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BrokenBarrierException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeoutException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">dowait&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">timeout&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ¤æ–­å±éšœæ˜¯å¦è¢«ç ´å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">isBroken&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// éœ€åŠ é”è®¿é—®ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½åœ¨æ‰§è¡Œ dowait()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">generation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">broken&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡ç½®æ“ä½œ å…ˆç ´åå±éšœï¼Œå†è¿›è¡Œä¸‹ä¸€è½®å¾ªç¯å±éšœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">reset&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">breakBarrier&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// break the current generation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">nextGeneration&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// start a new generation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è·å–ç­‰å¾…çº¿ç¨‹æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getNumberWaiting&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">parties&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - CountDownLatch å®ç°åŸç†</title><link>https://blog.letout.cn/p/thread/countdownlatch/</link><pubDate>Tue, 03 May 2022 14:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/thread/countdownlatch/</guid><description>&lt;img src="https://blog.letout.cn/imgs/6.jpeg" alt="Featured image of post Java å¹¶å‘ - CountDownLatch å®ç°åŸç†" />&lt;h2 id="åŸºæœ¬å®ç°æ€è·¯">åŸºæœ¬å®ç°æ€è·¯ï¼š&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>åˆ©ç”¨ &lt;strong>å…±äº«é”&lt;/strong> å®ç°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆå§‹åŒ–æ—¶ï¼Œ&lt;code>state=count&lt;/code> å³å·²ç»ä¸Šäº† &lt;code>count&lt;/code> æ¬¡å…±äº«é”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>await()&lt;/code> å³åŠ å…±äº«é”ï¼Œå¿…é¡» &lt;code>state=0&lt;/code> æ—¶æ‰èƒ½åŠ é”æˆåŠŸï¼Œå¦åˆ™æŒ‰ç…§ AQS æœºåˆ¶ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—é˜»å¡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>countDown()&lt;/code> è§£ä¸€æ¬¡é”ï¼Œç›´åˆ°ä¸º &lt;code>0&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æºç ">æºç &lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">CountDownLatch&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å†…éƒ¨ç±»å®ç° AQS
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Sync&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">AbstractQueuedSynchronizer&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">serialVersionUID&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">4982264981922014374L&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Sync&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ä½¿ç”¨ AQS çš„ state ä½œä¸ºè®¡æ•°å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">setState&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getCount&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">getState&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é‡‡ç”¨ **å…±äº«é”** æœºåˆ¶ï¼Œå› ä¸ºå¯ä»¥è¢«ä¸åŒçš„çº¿ç¨‹ countdown
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">protected&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">tryAcquireShared&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">acquires&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">getState&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">protected&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">tryReleaseShared&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">releases&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¯æ¬¡æ‰§è¡Œå°† state-1ï¼Œç›´åˆ° state=0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(;;)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getState&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">nextc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">compareAndSetState&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">nextc&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="c1">// é€šè¿‡ CAS æ”¹å˜ state çš„å€¼ï¼Œå¤±è´¥ä¼šè¿›è¡Œä¸‹ä¸€è½®å¾ªç¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">nextc&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Sync&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">CountDownLatch&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">IllegalArgumentException&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;count &amp;lt; 0&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sync&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Sync&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é€šè¿‡ acquireSharedInterruptibly è·å–å…±äº«é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// è‹¥ state!=0 ä¼šè¢«æŒç»­é˜»å¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">acquireSharedInterruptibly&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// 1 è¿™é‡Œæ˜¯éšæ„çš„å‚æ•°ï¼Œåœ¨ coutdownlatch ä¸­æ— æ„ä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">await&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="n">timeout&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">tryAcquireSharedNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toNanos&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">timeout&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è§£é”ä¸€æ¬¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">countDown&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">releaseShared&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è·å–å½“å‰è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="nf">getCount&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCount&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kd">super&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;[Count = &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">sync&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCount&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;]&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - å¹¶å‘å®‰å…¨çš„å®¹å™¨</title><link>https://blog.letout.cn/p/thread/collection/</link><pubDate>Fri, 29 Apr 2022 14:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/thread/collection/</guid><description>&lt;img src="https://blog.letout.cn/imgs/16.jpeg" alt="Featured image of post Java å¹¶å‘ - å¹¶å‘å®‰å…¨çš„å®¹å™¨" />&lt;h2 id="-é—ç•™çš„å®‰å…¨é›†åˆ">ğŸš§ é—ç•™çš„å®‰å…¨é›†åˆ&lt;/h2>
&lt;p>å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>Hashtable&lt;/li>
&lt;li>Vector&lt;/li>
&lt;/ul>
&lt;p>è¿™äº›é›†åˆçš„å®ç°æ–¹å¼ç®€å•ç²—æš´ï¼Œåœ¨æ–¹æ³•ä¸Šç›´æ¥ä½¿ç”¨ &lt;code>synchronized&lt;/code> è¿›è¡Œä¿®é¥°ï¼Œåœ¨è¿›è¡Œè¯»å†™ç­‰æ“ä½œæ—¶ï¼Œä¼šé”ä½æ•´ä¸ªå¯¹è±¡ï¼Œå¹¶å‘æ€§èƒ½ä¸å¤ªå¥½ã€‚&lt;/p>
&lt;h2 id="-collections-å®‰å…¨é›†åˆ">ğŸ“¦ Collections å®‰å…¨é›†åˆ&lt;/h2>
&lt;p>å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>Collections.synchronizedCollection(Collection&lt;!-- raw HTML omitted --> c)&lt;/li>
&lt;li>Collections.synchronizedList(List&lt;!-- raw HTML omitted --> list)&lt;/li>
&lt;li>Collections.synchronizedMap(Map&amp;lt;K,V&amp;gt; m)&lt;/li>
&lt;li>Collections.synchronizedSet(Set&lt;!-- raw HTML omitted --> s)&lt;/li>
&lt;li>&amp;hellip;&lt;/li>
&lt;/ul>
&lt;p>ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªçº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆï¼Œè¿”å›ä¸€ä¸ª Collections å†…éƒ¨çš„é™æ€ç±»å¯¹è±¡ï¼Œç”¨äºå°†ä¸€ä¸ªä¸å®‰å…¨çš„é›†åˆå˜æˆä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é›†åˆã€‚&lt;/p>
&lt;p>è¯¥æ–¹æ³•ä¼šå°†ä¼ å…¥çš„é›†åˆä½œä¸ºæˆå‘˜å˜é‡ï¼Œæ¯æ¬¡æ“ä½œæ—¶ï¼Œéƒ½ä½¿ç”¨ &lt;code>synchronized&lt;/code> åŠ é”ï¼Œé”ä½ &lt;code>mutex&lt;/code>ï¼ˆMap ä¸­ä¸ºå½“å‰å¯¹è±¡ thisï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">SynchronizedMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;,&lt;/span> &lt;span class="n">Serializable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">serialVersionUID&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1978198479659022715L&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// Backing Map
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">mutex&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// Object on which to synchronize
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SynchronizedMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Objects&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">requireNonNull&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mutex&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SynchronizedMap&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">mutex&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">mutex&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">mutex&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">size&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">mutex&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>&lt;span class="k">return&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="o">();}&lt;/span> &lt;span class="c1">// æ“ä½œéƒ½ä¼šé”ä½ mutex
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ... å…¶ä»–æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-juc-å®‰å…¨é›†åˆ">ğŸ›  JUC å®‰å…¨é›†åˆ&lt;/h2>
&lt;p>&lt;code>java.util.concurrent&lt;/code> ä¸‹æä¾›çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š&lt;/p>
&lt;ul>
&lt;li>Concurrent ç³»åˆ—ï¼ˆé€‚åˆå†™å¤šçš„åœºæ™¯ï¼Œå†…éƒ¨ä½¿ç”¨ CAS ä¼˜åŒ–ï¼‰&lt;/li>
&lt;li>CopyOnWrite ç³»åˆ—ï¼ˆé€‚åˆäºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼‰&lt;/li>
&lt;li>Blocking ç³»åˆ—ï¼ˆé˜»å¡é˜Ÿåˆ—ï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="concurrent">Concurrent&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>ConcurrentHashMap&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>ConcurrentLinkedQueue&lt;/code> / &lt;code>ConcurrentLinkedDeque&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>ConcurrentSkipListMap&lt;/code> / &lt;code>ConcurrentSkipListSet&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="copyonwrite">CopyOnWrite&lt;/h3>
&lt;ul>
&lt;li>&lt;code>CopyOnWriteArrayList&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>é‡‡ç”¨äº†å†™å…¥æ—¶æ‹·è´çš„æ€æƒ³ï¼Œæ›´æ”¹æ“ä½œä¼šå°†åº•å±‚æ•°ç»„æ‹·è´ä¸€ä»½ï¼Œæ›´æ”¹åœ¨æ–°çš„æ•°ç»„ä¸Šæ‰§è¡Œï¼Œå¹¶å‘æ—¶è¯»å†™æ“ä½œè¾¾åˆ°è¯»å†™åˆ†ç¦»ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">elements&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getArray&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">elements&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">newElements&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">copyOf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">elements&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">len&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">newElements&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setArray&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">newElements&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ›¿æ¢æ•°ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¯»æ“ä½œä¸è¿›è¡ŒåŠ é”ã€‚é€‚åˆäºè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SuppressWarnings&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;unchecked&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="n">E&lt;/span> &lt;span class="nf">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">E&lt;/span> &lt;span class="nf">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">getArray&lt;/span>&lt;span class="o">(),&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>CopyOnWriteArraySet&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>CopyOnWriteArraySet&lt;/code> å†…éƒ¨ç”± &lt;code>CopyOnWriteArrayList&lt;/code> å®ç°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">CopyOnWriteArraySet&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">AbstractSet&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">implements&lt;/span> &lt;span class="n">java&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Serializable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">CopyOnWriteArraySet&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">al&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CopyOnWriteArrayList&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é˜»å¡é˜Ÿåˆ—">é˜»å¡é˜Ÿåˆ—&lt;/h3>
&lt;p>æœ‰ç•Œé˜Ÿåˆ—ï¼šæœ‰å›ºå®šå¤§å°çš„é˜Ÿåˆ—ã€‚&lt;/p>
&lt;p>æ— ç•Œé˜Ÿåˆ—ï¼šæ²¡æœ‰å›ºå®šå¤§å°çš„é˜Ÿåˆ—&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>ArrayBlockingQueue&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æœ‰ç•Œå¸¦ç¼“å†²é˜»å¡é˜Ÿåˆ—ï¼Œæ•°ç»„å®ç°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>LinkedBlockingQueue&lt;/code>&lt;/p>
&lt;ul>
&lt;li>ç”±ç•Œå¸¦ç¼“å†²é˜»å¡é˜Ÿåˆ— (Integer.MAX_VALUE)ï¼Œé“¾è¡¨å®ç°ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸Šé™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>LinkedBlockingDeque&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åŒç«¯é˜Ÿåˆ—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>DelayQueue&lt;/code>&lt;/p>
&lt;ul>
&lt;li>å»¶æ—¶æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œåªå…è®¸å­˜æ”¾å¯ä»¥å»¶æ—¶çš„å…ƒç´ ï¼Œé˜Ÿåˆ— head æ˜¯æœ€å…ˆåˆ°æœŸçš„ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­å…ƒç´ æ²¡æœ‰åˆ°æœŸï¼Œå°±ç®—é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ ä¹Ÿä¸èƒ½è·å–åˆ°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>SynchronousQueue&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ²¡æœ‰å®¹é‡çš„åŒæ­¥é˜Ÿåˆ—ï¼Œä¸å­˜å‚¨å…ƒç´ ï¼Œæ¯ä¸€ä¸ª put å¿…é¡»è¦ç­‰å¾…ä¸€ä¸ª take æ“ä½œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>PriorityBlockingQueue&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ— ç•Œä¼˜å…ˆé˜»å¡é˜Ÿåˆ—ï¼ŒPriorityQueue çš„çº¿ç¨‹å®‰å…¨ç‰ˆï¼Œä¸å…è®¸å­˜æ”¾ null&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">BloockingQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Queue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é˜Ÿåˆ—æ»¡æŠ›å‡ºå¼‚å¸¸
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ— å…ƒç´ æŠ›å‡ºå¼‚å¸¸
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">remove&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">o&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// é˜Ÿåˆ—æ»¡è¿”å› false æˆåŠŸæ·»åŠ  true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">offer&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é˜Ÿåˆ—ä¸ºç©ºè¿”å› null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">E&lt;/span> &lt;span class="nf">poll&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é˜»å¡æ—¶ç­‰å¾…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜»å¡è¿›è¡Œç­‰å¾…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">put&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œé˜»å¡è¿›è¡Œç­‰å¾…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">E&lt;/span> &lt;span class="nf">take&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="linkedblockingqueue">LinkedBlockingQueue&lt;/h4>
&lt;p>åœ¨ &lt;code>LinkedBlockingQeque&lt;/code> ä¸­ä½¿ç”¨äº† dummy èŠ‚ç‚¹å’Œä¸¤æŠŠé”ï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œå¯ä»¥å…è®¸ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰§è¡Œ &lt;code>put&lt;/code> å’Œ &lt;code>take&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">putLock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">takeLock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>put&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">put&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">NullPointerException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Node&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">putLock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">putLock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">AtomicInteger&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">putLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lockInterruptibly&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æœå®¹é‡å·²æ»¡ï¼Œè¿›è¡Œç­‰å¾…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">capacity&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">notFull&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å®¹é‡æœªæ»¡ï¼Œè¿›è¡Œå…¥é˜Ÿ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">enqueue&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAndIncrement&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å…¥é˜Ÿåé˜Ÿåˆ—è¿˜æœ‰ç©ºä½, å”¤é†’å…¶ä»– put çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">capacity&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">notFull&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">signal&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// åªå”¤é†’ä¸€ä¸ªï¼Œå‡å°‘ç«äº‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">putLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æœé˜Ÿåˆ—ä¸­æœ‰ä¸€ä¸ªå…ƒç´ , å”¤é†’ take çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// notEmpty.signal() è€Œä¸æ˜¯ notEmpty.signalAll()ï¼›å‡å°‘ç«äº‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">signalNotEmpty&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>take&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">E&lt;/span> &lt;span class="nf">take&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">InterruptedException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">AtomicInteger&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">takeLock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">takeLock&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">takeLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lockInterruptibly&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">notEmpty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dequeue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAndDecrement&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">notEmpty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">signal&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">takeLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æœé˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªç©ºä½æ—¶, å«é†’ put çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¿›è¡Œå‡ºé˜Ÿ, ç¬¬ä¸€ä¸ªçº¿ç¨‹ c == capacity, åç»­çº¿ç¨‹ c &amp;lt; capacity
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">capacity&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// notFull.signal() è€Œä¸æ˜¯ notFull.signalAll()ï¼Œå‡å°‘ç«äº‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">signalNotFull&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - AQS</title><link>https://blog.letout.cn/p/thread/aqs/</link><pubDate>Wed, 13 Apr 2022 14:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/thread/aqs/</guid><description>&lt;img src="https://blog.letout.cn/imgs/6.jpeg" alt="Featured image of post Java å¹¶å‘ - AQS" />&lt;h2 id="aqs">AQS&lt;/h2>
&lt;p>AQS &lt;code>AbstractQueuedSynchronized&lt;/code> æ˜¯ä¸€ä¸ªç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ï¼Œæ˜¯å¯¹ CAS çš„ä¸€ç§å°è£…å’Œä¸°å¯Œï¼ŒAQS å¼•å…¥äº†ç‹¬å é”ï¼Œå…±äº«é”ç­‰æ€§è´¨ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ AQS èƒ½å¤ŸåŸºäº Java APIï¼Œç®€å•é«˜æ•ˆåœ°æ„å»ºå‡ºåº”ç”¨å¹¿æ³›çš„å¤§é‡åŒæ­¥å™¨ï¼Œç”¨äº Java å¤šçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚&lt;/p>
&lt;h2 id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³&lt;/h2>
&lt;p>AQS ä½¿ç”¨ä¸€ä¸ª &lt;code>volatile int state&lt;/code> æˆå‘˜å˜é‡è¡¨ç¤ºåŒæ­¥çŠ¶æ€ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ CAS &lt;code>compareAndSetState&lt;/code> å¯¹è¯¥åŒæ­¥çŠ¶æ€è¿›è¡ŒåŸå­æ“ä½œï¼Œå®ç°å¯¹å…¶å€¼çš„ä¿®æ”¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å…±äº«å˜é‡ï¼Œä½¿ç”¨ volatile ä¿éšœå¯è§æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">private&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>AQS é€šè¿‡å†…ç½®çš„ &lt;code>FIFO&lt;/code> åŒå‘é˜Ÿåˆ—æ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†ï¼Œè·å–èµ„æºçº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">transient&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="n">Node&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">transient&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="n">Node&lt;/span> &lt;span class="n">tail&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²æ—¶ï¼Œå°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚&lt;/p>
&lt;p>å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œå°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹æ„é€ æˆä¸€ä¸ª Node åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚&lt;/p>
&lt;h2 id="èµ„æºçš„å…±äº«æ–¹å¼">èµ„æºçš„å…±äº«æ–¹å¼&lt;/h2>
&lt;h3 id="ç‹¬å ">ç‹¬å &lt;/h3>
&lt;p>å½“ä¸€ä¸ªçº¿ç¨‹ä»¥ç‹¬å æ¨¡å¼è·å–é”æ—¶ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ã€‚&lt;/p>
&lt;ul>
&lt;li>ReentrantLock&lt;/li>
&lt;/ul>
&lt;h3 id="å…±äº«">å…±äº«&lt;/h3>
&lt;p>å½“ä¸€ä¸ªçº¿ç¨‹ä»¥å…±äº«æ¨¡å¼è·å–é”æ—¶ï¼Œå…¶ä»–ä¹Ÿæƒ³ä»¥å…±äº«æ¨¡å¼è·å–é”çš„çº¿ç¨‹ä¹Ÿèƒ½å¤Ÿä¸€èµ·è®¿é—®å…±äº«èµ„æºï¼Œä½†å…¶ä»–æƒ³ä»¥ç‹¬å æ¨¡å¼è·å–é”çš„çº¿ç¨‹éœ€è¦ç­‰å¾…ã€‚&lt;/p>
&lt;ul>
&lt;li>CountDownLatch&lt;/li>
&lt;li>CyclicBarrier&lt;/li>
&lt;li>Semaphore&lt;/li>
&lt;/ul>
&lt;h2 id="å®ç°">å®ç°&lt;/h2>
&lt;h3 id="countdownlatch">CountDownLatch&lt;/h3>
&lt;p>&lt;code>CountDownLatch&lt;/code> åŒæ­¥å·¥å…·å…è®¸ä¸€æ¡æˆ–å¤šæ¡çº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹ä¸­çš„ä¸€ç»„æ“ä½œå®Œæˆåï¼Œå†ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;p>&lt;code>CountDownLatch&lt;/code> ä»»åŠ¡åˆ†ä¸º &lt;code>n&lt;/code> ä¸ªå­çº¿ç¨‹æ‰§è¡Œï¼Œ&lt;code>state&lt;/code> å°†è¢«åˆå§‹åŒ–ä¸º &lt;code>n&lt;/code>ï¼Œè¿™ &lt;code>n&lt;/code> ä¸ªçº¿ç¨‹å°†ä¼šå¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œåè°ƒç”¨ &lt;code>countDown()&lt;/code> æ–¹æ³•ï¼Œ&lt;code>state&lt;/code> ä¼šé€šè¿‡ &lt;code>CAS - 1&lt;/code>ã€‚å½“æ‰€æœ‰çš„å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œä¹‹åï¼Œ&lt;code>state=0&lt;/code>ï¼Œä¼š unpack ä¸»çº¿ç¨‹ï¼Œç»§ç»­åç»­åŠ¨ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">SearchTask&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">CountDownLatch&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">SearchTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">CountDownLatch&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">latch&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// **å­çº¿ç¨‹**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å„è‡ªå¯»æ‰¾ç›¸åº”ç›®æ ‡çš„é¾™ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ğŸƒâ€â™‚ï¸ å¼€å§‹å¯»æ‰¾&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å·é¾™ç &amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ThreadLocalRandom&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">current&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">seconds&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ğŸ‘ èŠ±äº†&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;ç§’ï¼Œæ‰¾åˆ°äº†&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å·é¾™ç &amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¯å½“ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œå°±è°ƒç”¨ä¸€æ¬¡ countDown() æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">countDown&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// **ä¸»çº¿ç¨‹**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ç­‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åï¼Œæ‰¾åˆ°æ‰€æœ‰é¾™ç ï¼Œå¬å”¤ç¥é¾™
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">idList&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// state åˆå§‹åŒ–ä¸ºä»»åŠ¡çš„ä¸ªæ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">CountDownLatch&lt;/span> &lt;span class="n">latch&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CountDownLatch&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">idList&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">idList&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span> &lt;span class="n">thread&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">SearchTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">latch&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">latch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;æ‰¾åˆ°æ‰€æœ‰é¾™ç äº†ï¼å¬å”¤ç¥é¾™ ğŸ²&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/thread/aqs/countdownlatch.png"
width="605"
height="416"
srcset="https://blog.letout.cn/p/thread/aqs/countdownlatch_hu76805997e75031fb962291546eee5c35_69221_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/thread/aqs/countdownlatch_hu76805997e75031fb962291546eee5c35_69221_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="countdownlatch"
class="gallery-image"
data-flex-grow="145"
data-flex-basis="349px"
>&lt;/p>
&lt;p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»»åŠ¡åˆ†ä¸º 7 ä¸ªå­çº¿ç¨‹æ‰§è¡Œï¼Œå°† &lt;code>CountDownLatch&lt;/code> çš„å€¼åˆå§‹åŒ–ä¸ºä¸çº¿ç¨‹ç›¸åŒçš„æ¬¡æ•°ã€‚ä¸»çº¿ç¨‹é€šè¿‡ &lt;code>await()&lt;/code> ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆã€‚&lt;/p>
&lt;p>è¿™å‡ ä¸ªå­ä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œæˆå &lt;code>countDown()&lt;/code> ä¸€æ¬¡ï¼Œ&lt;code>state&lt;/code> ä¼šé€šè¿‡ CAS æ“ä½œ &lt;code>-1&lt;/code>ã€‚&lt;/p>
&lt;p>ç›´åˆ°æ‰€æœ‰çš„å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œ&lt;code>state=0&lt;/code>ï¼Œä¸»çº¿ç¨‹ä¼šç»“æŸç­‰å¾…ï¼Œç»§ç»­æ‰§è¡Œåç»­ä»»åŠ¡ã€‚&lt;/p>
&lt;h3 id="cyclicbarrier">CyclicBarrier&lt;/h3>
&lt;p>&lt;code>CyclicBarrier&lt;/code> ç”¨äºå¤šä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…å¯¹æ–¹æ‰§è¡Œåˆ°æŸä¸ªçŠ¶æ€åï¼Œè¿™äº›çº¿ç¨‹å†ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/thread/aqs/cyclicbarrier.jpg"
width="890"
height="282"
srcset="https://blog.letout.cn/p/thread/aqs/cyclicbarrier_hu4bbc637d91d993b0f3842d2bee476984_33199_480x0_resize_q75_box.jpg 480w, https://blog.letout.cn/p/thread/aqs/cyclicbarrier_hu4bbc637d91d993b0f3842d2bee476984_33199_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="cyclicbarrier"
class="gallery-image"
data-flex-grow="315"
data-flex-basis="757px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// CyclicBarrier å¯ä»¥è®¾ç½®å­çº¿ç¨‹å…¨éƒ¨åˆ°è¾¾ barrierï¼Œæ‰§è¡Œçš„ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">CyclicBarrier&lt;/span> &lt;span class="n">barrier&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CyclicBarrier&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ğŸ‘Œ äººå‘˜åˆ°é½ï¼å‡†å¤‡çˆ¬å±±ï¼&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å­çº¿ç¨‹ï¼Œæ¨¡æ‹Ÿ 5 ä¸ªåŒå­¦ç›¸çº¦çˆ¬å±±
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;åŒå­¦&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ğŸ‘‹ &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å‡†å¤‡å‡ºå‘å»é›†åˆç‚¹äº†ã€‚&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ThreadLocalRandom&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">current&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ğŸ¦¶ &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;èŠ±äº† &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; ç§’åˆ°è¾¾é›†åˆç‚¹ã€‚&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ç­‰å¾…æ‰€æœ‰çš„åŒå­¦ï¼ˆå­çº¿ç¨‹ï¼‰è¿è¡Œåˆ°æ­¤å¤„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">barrier&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// å½“ await çš„çº¿ç¨‹è¶³å¤Ÿï¼Œå†ç»§ç»­æ‰§è¡Œçº¿ç¨‹åç»­ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">BrokenBarrierException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;å’Œå¤§å®¶ä¸€èµ·çˆ¬å±±äº†ã€‚â›°&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">},&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;åŒå­¦&amp;#34;&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/thread/aqs/cyclicbarrier-result.png"
width="576"
height="450"
srcset="https://blog.letout.cn/p/thread/aqs/cyclicbarrier-result_huabd0a32719e9e0c5e0894dc282a3eb45_80712_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/thread/aqs/cyclicbarrier-result_huabd0a32719e9e0c5e0894dc282a3eb45_80712_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cyclicbarrier result"
class="gallery-image"
data-flex-grow="128"
data-flex-basis="307px"
>&lt;/p>
&lt;p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰ 5 ä¸ªå­çº¿ç¨‹åˆ†åˆ«å¼€å§‹æ‰§è¡Œï¼ˆ5 ä¸ªåŒå­¦ä»å®¶é‡Œå‡ºå‘ï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ°è¾¾æŸä¸ªçŠ¶æ€å &lt;code>await()&lt;/code> è¿›è¡Œç­‰å¾…ï¼ˆæ¯ä¸ªåŒå­¦åˆ°è¾¾é›†åˆç‚¹ä¼šç­‰å¾…å…¶ä»–åŒå­¦åˆ°è¾¾ï¼‰ï¼Œå½“çº¿ç¨‹å…¨éƒ¨è¾¾åˆ°ä¹‹åï¼Œâ€œå±éšœâ€ä¼šé‡Šæ”¾ï¼Œçº¿ç¨‹å°†ç»§ç»­æ‰§è¡Œï¼ˆäººå‘˜åˆ°é½åå¼€å§‹çˆ¬å±±ï¼‰ã€‚&lt;/p>
&lt;blockquote>
&lt;p>CyclicBarrier å¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œå¯ä»¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨é‡ç½®è®¡æ•°ã€‚
ä½¿ç”¨ barrier.reset() ä¼šè¿›è¡Œé‡ç½®ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šæŠ›å‡º BrokenBarrierException&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// CyclicBarrier çš„è®¡æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å­çº¿ç¨‹çš„æ•°é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å°†å­çº¿ç¨‹çš„æ•°é‡è®¾ç½®ä¸º &lt;code>10&lt;/code>ï¼Œå¾ªç¯å±éšœè®¾ç½®ä¸º &lt;code>5&lt;/code>ï¼Œå°†ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼šæ¯æœ‰ &lt;code>5&lt;/code> ä¸ªï¼Œçº¿ç¨‹åˆ°è¾¾â€œå±éšœâ€ç‚¹ï¼Œå°±ä¼šé‡Šæ”¾ä¸€æ¬¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/thread/aqs/cyclicbarrier-result-2.png"
width="585"
height="811"
srcset="https://blog.letout.cn/p/thread/aqs/cyclicbarrier-result-2_hu2373c7ae3a7710cd05edc6f1f466fc13_156183_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/thread/aqs/cyclicbarrier-result-2_hu2373c7ae3a7710cd05edc6f1f466fc13_156183_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="cyclicbarrier result"
class="gallery-image"
data-flex-grow="72"
data-flex-basis="173px"
>&lt;/p>
&lt;h3 id="semaphore">Semaphore&lt;/h3>
&lt;p>é€šè¿‡ä½¿ç”¨ &lt;code>Semaphore&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šæŸä¸ªèµ„æºåŒä¸€æ—¶é—´èƒ½å¤Ÿè¢«è®¿é—®çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œå®ƒç›¸å½“äºå¯¹æŸä¸ªèµ„æºçš„è®¿é—®è¿›è¡Œäº†æµé‡æ§åˆ¶ã€‚&lt;/p>
&lt;p>æ˜¯ä¸€ä¸ªå¯ä»¥è¢« n ä¸ªçº¿ç¨‹å ç”¨çš„æ’å®ƒé”ï¼Œå¯ä»¥åœ¨æœ€å¼€å§‹è®¾å®š &lt;code>Semaphore&lt;/code> è®¸å¯è¯æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è·å¾— 1 ä¸ªæˆ–å¤šä¸ªè®¸å¯è¯ï¼Œå½“è®¸å¯è¯è€—å°½æˆ–ä¸è¶³ä»¥ä¾›å…¶ä»–çº¿ç¨‹è·å–æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°†è¢«é˜»å¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Semaphore&lt;/span> &lt;span class="n">semaphore&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Semaphore&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æœ‰ä¸‰ä¸ªè®¸å¯ï¼Œå‡è®¾æ¯ä¸ªçº¿ç¨‹åªè·å–ä¸€ä¸ªè®¸å¯æ—¶ï¼Œæœ€å¤šä¸¤ä¸ªçº¿ç¨‹å¯è®¿é—®èµ„æº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">semaphore&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">acquire&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// æ— å‚ä¸ºç”³è¯·ä¸€ä¸ªè®¸å¯è¯ï¼Œæ²¡æœ‰è®¸å¯çš„çº¿ç¨‹ä¼šè¿›è¡Œç­‰å¾…
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ç”³è¯·è®¸å¯è¯æˆåŠŸ&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// æ¨¡æ‹Ÿä»»åŠ¡è€—æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">semaphore&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">release&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="reentrantlock">ReentrantLock&lt;/h3>
&lt;p>ç›¸æ¯”äº &lt;code>synchronized&lt;/code>ï¼Œéƒ½æ”¯æŒ âœ¨å¯é‡å…¥ï¼Œè¿˜å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>âœ¨ ç­‰å¾…å¯ä¸­æ–­&lt;/li>
&lt;li>âœ¨ å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´&lt;/li>
&lt;li>âœ¨ å…¬å¹³é”&lt;/li>
&lt;li>âœ¨ æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡&lt;/li>
&lt;/ul>
&lt;p>&lt;code>ReentrantLock&lt;/code> éœ€è¦ä½¿ç”¨ &lt;code>try-finally&lt;/code> æ‰‹åŠ¨åŠ é”å’Œè§£é”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">reentrantLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸´ç•ŒåŒº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reentrantLock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/thread/aqs/ReentrantLock.png"
width="636"
height="318"
srcset="https://blog.letout.cn/p/thread/aqs/ReentrantLock_hub675906c100b4f2e2501a8eca65fd5f6_112932_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/thread/aqs/ReentrantLock_hub675906c100b4f2e2501a8eca65fd5f6_112932_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="ReentrantLock"
class="gallery-image"
data-flex-grow="200"
data-flex-basis="480px"
>&lt;/p>
&lt;p>ReentrantLock é»˜è®¤å®ç°ä¸ºéå…¬å¹³é”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nf">ReentrantLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">NonfairSync&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="å¯é‡å…¥">å¯é‡å…¥&lt;/h4>
&lt;p>ä¸€ä¸ªçº¿ç¨‹è·å–äº†ğŸ”’ é”ä¹‹åï¼Œå¯ä»¥å¤šæ¬¡è·å–åŒä¸€æŠŠé”ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œä¸€ä¸ªå¸¦é”çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­åˆè°ƒç”¨äº†å¦ä¸€ä¸ªéœ€è¦ç›¸åŒé”çš„æ–¹æ³•ï¼Œåˆ™æ”¹çº¿ç¨‹å¯ä»¥ç›´æ¥è·å–é”ï¼Œå¹¶æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¯é‡å…¥é”å¯æœ‰æ•ˆåœ°é¿å…æ­»é”ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method1&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">method1&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// ç¬¬ä¸€æ¬¡è·å–ğŸ”’ é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;do something in method 1&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method2&lt;/span>&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">method2&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// ç¬¬äºŒæ¬¡è·å–ğŸ”’ é”ï¼ˆé‡å…¥ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;do something in method 2&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ç­‰å¾…å¯ä¸­æ–­">ç­‰å¾…å¯ä¸­æ–­&lt;/h4>
&lt;p>&lt;code>lock.lockInterruptibly()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ²¡æœ‰ç«äº‰å°±ä¼šè·å–é”&lt;/li>
&lt;li>æœ‰ç«äº‰è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œä½†æ˜¯å¯ä»¥è¢«ä¸­æ–­ï¼ˆthrow InterruptedExceptionï¼‰&lt;/li>
&lt;/ul>
&lt;p>ä½¿ç”¨ &lt;code>lock.lock()&lt;/code>ï¼Œå³ä½¿è¿›è¡Œ &lt;code>interrupt()&lt;/code> ä¹Ÿä¸ä¼šè®©çº¿ç¨‹ç­‰å¾…ä¸­æ–­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span> &lt;span class="n">thread&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lockInterruptibly&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// å°è¯•è·å–å¯ä¸­æ–­é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;é”åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­è¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;æˆåŠŸè·å¾—äº†é” ğŸ”’&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ä¸»çº¿ç¨‹è·å–äº†é” ğŸ”’&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ä¸»çº¿ç¨‹æ‰“æ–­ thread&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">interrupt&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="n">finlaly&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è¶…æ—¶æ—¶é—´">è¶…æ—¶æ—¶é—´&lt;/h3>
&lt;ul>
&lt;li>&lt;code>boolean tryLock()&lt;/code>ï¼šè·å–é”å¤±è´¥ï¼Œç«‹å³è¿”å›&lt;/li>
&lt;li>&lt;code>boolean tryLock(long timeout, TimeUnit unit)&lt;/code>ï¼šè·å–é”å¤±è´¥ï¼Œç­‰å¾…è¶…æ—¶æ—¶é—´&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Thread&lt;/span> &lt;span class="n">thread&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">tryLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;ç­‰å¾… 2s åï¼ŒæˆåŠŸè·å–äº†é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;æˆåŠŸè·å–äº†é”&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="å…¬å¹³é”">å…¬å¹³é”&lt;/h4>
&lt;p>&lt;code>ReentrantLock&lt;/code> é»˜è®¤æ˜¯éå…¬å¹³é”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nf">ReentrantLock&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">NonfairSync&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nf">ReentrantLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">boolean&lt;/span> &lt;span class="n">fair&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sync&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">fair&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">FairSync&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">NonfairSync&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>å…¬å¹³é”ï¼šè·å–é”çš„çº¿ç¨‹æ ¹æ®è¿›å…¥ç­‰å¾…é˜Ÿåˆ—çš„é¡ºåºè·å–é”&lt;/li>
&lt;li>éå…¬å¹³é”ï¼šæ–°çº¿ç¨‹å…ˆå°è¯•æ’é˜Ÿè·å–é”ï¼Œæ’é˜Ÿå¤±è´¥å†è¿›å…¥ç­‰å¾…é˜Ÿåˆ—æ’åºç­‰å¾…&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è·å–å…¬å¹³é”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="å¤šä¸ªæ¡ä»¶å˜é‡">å¤šä¸ªæ¡ä»¶å˜é‡&lt;/h4>
&lt;p>&lt;code>ReentrantLock&lt;/code> æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼Œå¯ä»¥å¯¹ç­‰å¾…çš„çº¿ç¨‹è¿›è¡Œç²¾å‡†å”¤é†’ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>await()&lt;/code>ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾è·å–çš„é”ï¼Œè¿›å…¥å¯¹åº”çš„ conditionObject è¿›è¡Œç­‰å¾…ï¼›è¢« &lt;code>singnal()&lt;/code> å”¤é†’åï¼Œçº¿ç¨‹é‡æ–°å»ç«äº‰é”ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä¸‰ä¸ªçº¿ç¨‹å¾ªç¯æ‰“å° ABC 10 æ¬¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ThreadDemo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="n">ReentrantLock&lt;/span> &lt;span class="n">lock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReentrantLock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="n">Condition&lt;/span> &lt;span class="n">conditionA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newCondition&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="n">Condition&lt;/span> &lt;span class="n">conditionB&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newCondition&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="n">Condition&lt;/span> &lt;span class="n">conditionC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newCondition&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 0-&amp;gt;print A 1-&amp;gt;print B 2-&amp;gt;print C
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">commonState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">MyTread&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">MyThread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">state&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">commonState&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditionA&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">commonState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditionB&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singnal&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">state&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">commonState&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditionB&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;B&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">commonState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditionC&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singnal&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">state&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">commonState&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditoinC&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">await&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;C&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">commonState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditionA&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singnal&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">finally&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lock&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">MyThread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">)).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">MyThread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">)).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">MyThread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">)).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="reentrantreadwritelock">ReentrantReadWriteLock&lt;/h3>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://tech.meituan.com/2018/11/15/java-lock.html" target="_blank" rel="noopener"
>https://tech.meituan.com/2018/11/15/java-lock.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼</title><link>https://blog.letout.cn/p/thread/singleton/</link><pubDate>Mon, 11 Apr 2022 18:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/thread/singleton/</guid><description>&lt;img src="https://blog.letout.cn/imgs/8.jpeg" alt="Featured image of post çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼" />&lt;p>å•ä¾‹æ¨¡å¼æ‰€è¦å®ç°çš„ç›®æ ‡ï¼šä¿æŒä¸€ä¸ªç±»æœ‰ä¸”åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚&lt;/p>
&lt;p>å‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œä¸å°‘å•ä¾‹æ¨¡å¼éƒ½ä¼šé‡‡ç”¨å»¶è¿ŸåŠ è½½çš„æ–¹å¼ã€‚æ ¹æ®æ˜¯å¦å»¶è¿Ÿåˆ›å»ºå¯¹è±¡ï¼Œå¯ä»¥åˆ†ä¸ºï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ¤© é¥¿æ±‰å¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ˜ª æ‡’æ±‰å¼&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="-æ‡’æ±‰å¼">ğŸ˜ª æ‡’æ±‰å¼&lt;/h2>
&lt;h3 id="å•çº¿ç¨‹çš„å•ä¾‹æ¨¡å¼">å•çº¿ç¨‹çš„å•ä¾‹æ¨¡å¼&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ„é€ å™¨ç§æœ‰ï¼Œå…¶ä»–ç±»æ— æ³•é€šè¿‡ new åˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ›å»ºå¹¶è¿”å›è¯¥ç±»çš„å”¯ä¸€å®ä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">someService&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸€äº›ä¸šåŠ¡ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-åŠ é”çš„å•ä¾‹æ¨¡å¼">ğŸ”’ åŠ é”çš„å•ä¾‹æ¨¡å¼&lt;/h3>
&lt;p>ä½¿ç”¨ &lt;code>synchronized&lt;/code> åŠ é”å®ç°çº¿ç¨‹å®‰å…¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// public static synchronized getInstance()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Singleton&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ä¸æ¨è ğŸ™…â€â™‚ï¸ æ¯æ¬¡åˆ¤ç©ºæ“ä½œï¼Œéƒ½è¦è·å–é”ï¼Œå¼€é”€æå¤§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ä½¿ç”¨åŒé‡æ£€éªŒåˆ¤æ–­&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">synchronized&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Singleton&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ &lt;code>volatile&lt;/code> ä¿®é¥°å®ä¾‹ï¼Œåˆ©ç”¨äº†ä»¥ä¸‹ä¸¤ä¸ªä½œç”¨ï¼š&lt;/p>
&lt;p>(1) ä¿éšœå¯è§æ€§ï¼š&lt;/p>
&lt;p>ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–äº† &lt;code>instance&lt;/code> çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è¯»å–åˆ°ç›¸åº”çš„å€¼ã€‚&lt;/p>
&lt;p>(2) ä¿éšœæœ‰åºæ€§ï¼š&lt;/p>
&lt;p>ä¿éšœä¸€ä¸ªçº¿ç¨‹è¯»å–åˆ°çš„ &lt;code>instance&lt;/code> å¼•ç”¨çš„å®ä¾‹å·²ç»åˆå§‹åŒ–å®Œæ¯•ã€‚&lt;/p>
&lt;p>å¯¹è±¡å®ä¾‹åŒ–ä¼šåˆ†è§£æˆä»¥ä¸‹å‡ ä¸ªå­æ“ä½œï¼š&lt;/p>
&lt;ul>
&lt;li>åˆ†é…å¯¹è±¡æ‰€éœ€çš„ç©ºé—´&lt;/li>
&lt;li>åˆå§‹åŒ– instance å¼•ç”¨çš„å¯¹è±¡&lt;/li>
&lt;li>å°†å¯¹è±¡çš„å¼•ç”¨å†™å…¥å…±äº«å˜é‡&lt;/li>
&lt;/ul>
&lt;p>ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ &lt;code>1-&amp;gt;3-&amp;gt;2&lt;/code>ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼šçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3 åï¼Œæ­¤æ—¶ T2 è°ƒç”¨ &lt;code>getInstance()&lt;/code> åå‘ç° &lt;code>instance&lt;/code> ä¸ä¸ºç©ºï¼Œå› æ­¤ç›´æ¥è¿”å›ï¼Œä½†æ­¤æ—¶ &lt;code>instance&lt;/code> è¿˜æœªè¢«åˆå§‹åŒ–ã€‚&lt;/p>
&lt;h3 id="é™æ€å†…éƒ¨ç±»çš„å•ä¾‹æ¨¡å¼">é™æ€å†…éƒ¨ç±»çš„å•ä¾‹æ¨¡å¼&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">InstanceHolder&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// é™æ€å†…éƒ¨ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ä¿å­˜å¤–éƒ¨ç±»çš„å”¯ä¸€å®ä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">INSTANCE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">InstanceHolder&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">INSTANCE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">someService&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getInstance&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">someService&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“å¤–éƒ¨ç±»åŠ è½½æ—¶ï¼Œå†…éƒ¨ç±»ä¸ä¼šåŠ è½½ï¼Œå¹¶ä¸”é™æ€å˜é‡åªä¼šæœ‰é»˜è®¤å€¼ï¼ˆnullï¼‰ã€‚&lt;/p>
&lt;p>ç±»çš„é™æ€å˜é‡è¢«åˆæ¬¡è®¿é—®æ‰ä¼šè§¦å‘ Java è™šæ‹Ÿæœºå¯¹è¯¥ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¼šå˜ä¸ºå…¶åˆå§‹å€¼ã€‚&lt;/p>
&lt;h3 id="æšä¸¾å•ä¾‹">æšä¸¾å•ä¾‹&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">INSTANCE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ç§æœ‰æ„é€ å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pubilc&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">someService&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä¸šåŠ¡ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å­—æ®µ &lt;code>INSTANCE&lt;/code> æ˜¯æšä¸¾ç±»çš„å”¯ä¸€å®ä¾‹ã€‚åœ¨ &lt;code>Singleton.INSTANCE&lt;/code> åˆæ¬¡è¢«å¼•ç”¨æ—¶æ‰ä¼šè¢«åˆå§‹åŒ–ã€‚&lt;/p>
&lt;h2 id="-é¥¿æ±‰å¼">ğŸ¤© é¥¿æ±‰å¼&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">pubilc&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Singleton&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åœ¨åˆ›å»ºæ—¶ç›´æ¥åˆå§‹åŒ–ï¼Œå¤©ç”Ÿçº¿ç¨‹å®‰å…¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Singleton&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span> &lt;span class="nf">Singleton&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pubilc&lt;/span> &lt;span class="n">staitc&lt;/span> &lt;span class="n">Singleton&lt;/span> &lt;span class="nf">getInstance&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java å¹¶å‘ - é”æœºåˆ¶</title><link>https://blog.letout.cn/p/thread/lock/</link><pubDate>Mon, 11 Apr 2022 14:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/thread/lock/</guid><description>&lt;img src="https://blog.letout.cn/imgs/7.jpeg" alt="Featured image of post Java å¹¶å‘ - é”æœºåˆ¶" />&lt;p>åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šå¯¹åŒä¸€ä¸ªèµ„æºè¿›è¡Œäº‰æŠ¢ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡å¼•å…¥&lt;strong>é”æœºåˆ¶&lt;/strong>ï¼Œä½¿ç”¨ä¸€ç§æŠ½è±¡çš„é”ï¼Œå¯¹èµ„æºè¿›è¡Œé”å®šï¼Œè¾¾åˆ°åŒæ­¥è®¿é—®ã€‚&lt;/p>
&lt;h2 id="å®ç°">å®ç°&lt;/h2>
&lt;p>Java é‡‡ç”¨äº†ä¸¤ç§å®ç°æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é˜»å¡åŒæ­¥ï¼ˆğŸ˜¢ æ‚²è§‚é”ï¼‰ï¼šğŸ“ é€‚åˆäºå†™å¤šè¯»å°‘çš„åœºæ™¯ã€‚å…ˆåŠ é”ï¼Œä¿è¯å†™æ“ä½œæ—¶çš„æ•°æ®æ­£ç¡®ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŸºäº &lt;code>Object&lt;/code> çš„ &lt;code>synchronized&lt;/code> å†…éƒ¨é” ğŸ”’&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŸºäº &lt;code>API&lt;/code> ç±»åº“çš„ &lt;code>java.util.concurrent.locks.Lock&lt;/code> ğŸ”’&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>éé˜»å¡åŒæ­¥ï¼ˆğŸ˜ ä¹è§‚é”ï¼‰ï¼šğŸ“– é€‚åˆäºè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚ä¸åŠ é”ï¼Œå¯ä»¥å¤§å¹…æé«˜è¯»çš„æ€§èƒ½ã€‚&lt;/p>
&lt;ul>
&lt;li>åŸºäº &lt;code>CAS&lt;/code> çš„ä¹è§‚é”&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-æ‚²è§‚é”">ğŸ˜¢ æ‚²è§‚é”&lt;/h2>
&lt;p>&lt;img src="https://blog.letout.cn/p/thread/lock/pessimistic_lock.png"
width="1203"
height="435"
srcset="https://blog.letout.cn/p/thread/lock/pessimistic_lock_hu0c6cbd403a1714d2f5c0f487acc85888_127050_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/thread/lock/pessimistic_lock_hu0c6cbd403a1714d2f5c0f487acc85888_127050_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="pessimistic"
class="gallery-image"
data-flex-grow="276"
data-flex-basis="663px"
>&lt;/p>
&lt;p>åœ¨ Java ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡ï¼ˆObjectï¼‰ï¼Œéƒ½æ‹¥æœ‰ä¸€æŠŠé”ï¼Œå­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ï¼Œè®°å½•äº†å½“å‰å¯¹è±¡è¢«å“ªä¸ªçº¿ç¨‹æ‰€å ç”¨ã€‚&lt;/p>
&lt;h3 id="å†…éƒ¨é”-synchronized">å†…éƒ¨é” synchronized&lt;/h3>
&lt;p>&lt;code>synchronized&lt;/code> å…³é”®å­—å¯ä»¥ç”¨æ¥åŒæ­¥çº¿ç¨‹ï¼Œå…¶è¢«ç¼–è¯‘åï¼Œä¼šç”Ÿæˆ &lt;code>monitorenter&lt;/code> å’Œ &lt;code>moniterexit&lt;/code> ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼Œç”¨æ¥è¿›è¡Œçº¿ç¨‹çš„åŒæ­¥ã€‚&lt;/p>
&lt;p>è¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤éƒ½éœ€è¦ä¸€ä¸ª &lt;code>reference&lt;/code> ç±»å‹çš„å‚æ•°æ¥æŒ‡æ˜è¦é”å®šå’Œè§£é”çš„å¯¹è±¡ã€‚å¦‚æœ &lt;code>Java&lt;/code> æºç ä¸­çš„ &lt;code>synchronized&lt;/code> æ˜ç¡®æŒ‡å®šäº†å¯¹è±¡å‚æ•°ï¼Œé‚£å°±ä»¥è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ä½œä¸º &lt;code>reference&lt;/code>ï¼›å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šï¼Œå°±æ ¹æ® &lt;code>synchronized&lt;/code> ä¿®é¥°çš„æ–¹æ³•ç±»å‹ï¼ˆå®ä¾‹æ–¹æ³•æˆ–ç±»æ–¹æ³•ï¼‰ï¼Œæ¥å†³å®šæ˜¯å–ä»£ç æ‰€åœ¨çš„å¯¹è±¡å®ä¾‹è¿˜æ˜¯å–ç±»å‹å¯¹åº”çš„ Class å¯¹è±¡æ¥ä½œä¸ºçº¿ç¨‹è¦æŒæœ‰çš„é”ã€‚&lt;/p>
&lt;p>åŠ é”æ–¹å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¯¹è±¡é”&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¿®é¥°å®ä¾‹æ–¹æ³• &lt;code>pubilc sychronized void method() { ... }&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»£ç å—é”ä½å½“å‰å¯¹è±¡ &lt;code>synchronized(this)&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç±»é”&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¿®é¥°é™æ€æ–¹æ³• &lt;code>public static synchronized void method() { ... }&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»£ç å—é”å®š class å¯¹è±¡ &lt;code>synchronized(MyClass.class) { ... }&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;code>synchronized&lt;/code> æ˜¯éå…¬å¹³é”ã€‚ä¸€æŠŠé”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è·å–ï¼Œæ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹åªèƒ½ç­‰å¾…ã€‚çº¿ç¨‹å¯¹å†…éƒ¨é”çš„ç”³è¯·å’Œé‡Šæ”¾ç”± &lt;code>Java&lt;/code> è™šæ‹Ÿæœºè´Ÿè´£å®æ–½ã€‚&lt;/p>
&lt;p>&lt;code>synchronized&lt;/code> ä¿®é¥°çš„æ–¹æ³•ï¼Œæ— è®ºæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œè¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šé‡Šæ”¾é”ã€‚&lt;/p>
&lt;h3 id="jdk-16-å¯¹-synchronized-çš„ä¼˜åŒ–">JDK 1.6 å¯¹ synchronized çš„ä¼˜åŒ–&lt;/h3>
&lt;p>&lt;code>synchronized&lt;/code> ä¾èµ–äº &lt;code>JVM&lt;/code>ï¼Œä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿåº•å±‚çš„ &lt;code>Mutex Lock&lt;/code> å®ç°ã€‚&lt;/p>
&lt;p>Java çº¿ç¨‹çš„å®ç°æ˜¯å¯¹æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„æ˜ å°„ï¼Œæ¯å½“å”¤é†’æˆ–æŒ‚èµ·ä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼Œéƒ½è¦åˆ‡æ¢åˆ°æ“ä½œç³»ç»Ÿçš„å†…æ ¸æ€ï¼Œä»£ä»·æ˜¯éå¸¸æ˜‚è´µçš„ã€‚&lt;/p>
&lt;p>JDK 1.6 å¯¹é”çš„å®ç°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚ &lt;code>é”ç²—åŒ–&lt;/code>ï¼Œ&lt;code>é”æ¶ˆé™¤&lt;/code>ï¼Œ&lt;code>è½»é‡çº§é”&lt;/code>ï¼Œ&lt;code>åå‘é”&lt;/code>ï¼Œ&lt;code>è‡ªæ—‹é”&lt;/code>ï¼Œ&lt;code>é€‚åº”æ€§è‡ªæ—‹&lt;/code>ç­‰ã€‚&lt;/p>
&lt;p>å¯¹è±¡é”ä¸€å…±æœ‰å››ç§çŠ¶æ€ï¼š&lt;/p>
&lt;blockquote>
&lt;p>æ— é” -&amp;gt; åå‘é” -&amp;gt; è½»é‡çº§é” -&amp;gt; é‡é‡çº§é”&lt;/p>
&lt;/blockquote>
&lt;p>ä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ï¼ˆä¸å¯ä»¥é™çº§ï¼‰ï¼Œæé«˜è·å–é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ”’ æ— é”çŠ¶æ€&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æŸäº›èµ„æºä¸ä¼šå‡ºç°å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µï¼Œéšæ„å¤šä¸ªçº¿ç¨‹è°ƒç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ©ç”¨å…¶ä»–ä¸€äº›æ–¹å¼æ§åˆ¶åŒæ­¥ã€‚å¦‚ï¼šCAS&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ä¸å¯¹èµ„æºè¿›è¡Œæ“ä½œç³»ç»Ÿçº§åˆ«çš„é”å®šã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ”’ åå‘é”&lt;/p>
&lt;ul>
&lt;li>é€‚åˆåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹çš„ç«äº‰ï¼Œæ¯æ¬¡éƒ½æ˜¯åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–é”ï¼Œé‚£ä¹ˆå¯¹è±¡é”ä¼šâ€œè®°ä½â€è¿™ä¸ªçº¿ç¨‹ï¼Œåªè¦æ˜¯è¿™ä¸ªçº¿ç¨‹è¿‡æ¥ï¼Œå°±ç›´æ¥æŠŠé”äº¤å‡ºå»ã€‚&lt;/p>
&lt;p>å¦‚æœå¯¹è±¡å‘ç°ç›®å‰ä¸æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯æœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç«äº‰é”ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ”’ è½»é‡çº§é”&lt;/p>
&lt;ul>
&lt;li>é€‚åˆåŒæ­¥ä»£ç å—çš„æ‰§è¡Œé€Ÿåº¦éå¸¸å¿«çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å½“é”å‡çº§ä¸ºè½»é‡çº§é”çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡ CAS è¿›è¡Œè‡ªæ—‹ç­‰å¾…æ¥è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸ”’ é‡é‡çº§é”&lt;/p>
&lt;ul>
&lt;li>é€‚åˆåŒæ­¥ä»£ç å—æ‰§è¡Œé€Ÿåº¦è¾ƒé•¿çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å¯¹è±¡é”çŠ¶æ€è¢«æ ‡è®°ä¸ºé‡é‡çº§é”ï¼Œéœ€è¦é€šè¿‡ Monitor æ¥å¯¹çº¿ç¨‹è¿›è¡Œæ§åˆ¶ã€‚&lt;/p>
&lt;h2 id="-ä¹è§‚é”-cas">ğŸ˜ ä¹è§‚é” CAS&lt;/h2>
&lt;p>&lt;img src="https://blog.letout.cn/p/thread/lock/optimistic_lock.png"
width="1037"
height="468"
srcset="https://blog.letout.cn/p/thread/lock/optimistic_lock_hu036037785ffcb4d154b9171a46e6bd40_99684_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/thread/lock/optimistic_lock_hu036037785ffcb4d154b9171a46e6bd40_99684_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="optimistic"
class="gallery-image"
data-flex-grow="221"
data-flex-basis="531px"
>&lt;/p>
&lt;p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒåŒæ­¥ä»£ç å—æ‰§è¡Œçš„æ—¶é—´è¿œè¿œå°äºçº¿ç¨‹åˆ‡æ¢çš„è€—æ—¶ã€‚æ‰€ä»¥å¸Œæœ›èƒ½å¤Ÿåœ¨ç”¨æˆ·æ€ä¸­å¯¹çº¿ç¨‹çš„åˆ‡æ¢è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·æ•ˆç‡æ›´é«˜ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬è®©çº¿ç¨‹â€œä¹è§‚åœ°â€åå¤å°è¯•è·å–å…±äº«èµ„æºï¼Œå½“å‘ç°ç©ºé—²æ—¶ä¾¿è¿›è¡Œä½¿ç”¨ï¼Œå¦åˆ™ç»§ç»­â€œä¹è§‚åœ°â€è¿›è¡Œé‡è¯•ã€‚&lt;/p>
&lt;p>åŸºäºä»¥ä¸Šæƒ³æ³•ï¼Œè¯ç”Ÿäº† &lt;code>CAS (Compare And Swap)&lt;/code> ç®—æ³•ï¼šæ¯”è¾ƒå¹¶äº¤æ¢ã€‚&lt;/p>
&lt;p>CASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>éœ€è¦è¯»å†™çš„å†…å­˜å€¼ addr&lt;/li>
&lt;li>è¿›è¡Œæ¯”è¾ƒçš„å€¼ oldValue&lt;/li>
&lt;li>è¦å†™å…¥çš„æ–°å€¼ newValue&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">cas&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">oldValue&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">newValue&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* Executes atomically. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">addr&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">old&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span>&lt;span class="n">addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ª cas å‡½æ•°çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•åŒæ­¥æªæ–½ï¼Œä¼¼ä¹è¿˜æ˜¯å­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>å½“ A çº¿ç¨‹æ¯”è¾ƒäº† oldValue çš„å€¼æ˜¯æƒ³è¦çš„ï¼Œä½†æ˜¯è¿™ä¸ªç¬é—´ï¼ŒB çº¿ç¨‹çªç„¶æŠ¢åˆ°äº†æ—¶é—´ç‰‡ï¼Œæ›´æ”¹äº†å€¼ï¼›ä½†æ˜¯ A çº¿ç¨‹å¹¶ä¸çŸ¥é“ï¼Œå°†å€¼æ”¹æˆäº† newValueï¼Œè¿™å°±å‡ºç°äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒA B ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è·å¾—äº†èµ„æºã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œ&lt;code>CAS&lt;/code> çš„æ“ä½œå¿…é¡»æ˜¯ &lt;code>åŸå­æ€§&lt;/code> çš„ã€‚è¿™ä¸ªåŸå­æ“ä½œï¼Œ&lt;strong>ç”±è®¡ç®—æœºå¤„ç†å™¨æŒ‡ä»¤é›†æä¾›ï¼Œç›´æ¥ç”±ç¡¬ä»¶ä¿éšœã€‚&lt;/strong>&lt;/p>
&lt;h3 id="åŸå­å˜é‡ç±»">åŸå­å˜é‡ç±»&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>åŸºç¡€æ•°æ®ç±»å‹&lt;/p>
&lt;ul>
&lt;li>AtomicInteger&lt;/li>
&lt;li>AtomicLong&lt;/li>
&lt;li>AtomicBoolean&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>æ•°ç»„ç±»å‹&lt;/p>
&lt;ul>
&lt;li>AtomicIntegerArray&lt;/li>
&lt;li>AtomicLongArray&lt;/li>
&lt;li>AtomicReferenceArray&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å­—æ®µæ›´æ–°ç±»å‹&lt;/p>
&lt;ul>
&lt;li>AtomicIntegerFieldUpdater&lt;/li>
&lt;li>AtomicLongFieldUpdater&lt;/li>
&lt;li>AtomicReferenceFieldUpdater&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å¼•ç”¨ç±»å‹&lt;/p>
&lt;ul>
&lt;li>AtomicReference&lt;/li>
&lt;li>AtomicStampedReference&lt;/li>
&lt;li>AtomicMarkableReference&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">AtomicInteger&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">AtomicInteger&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; : &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">n&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">incrementAndGet&lt;/span>&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">},&lt;/span> &lt;span class="s">&amp;#34;Thread&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>AtomicInteger&lt;/code> ä¸»è¦ç”±ä¸€ä¸ª &lt;code>Unsafe&lt;/code> ç±»å‹çš„å®ä¾‹ &lt;code>unsafe&lt;/code> å’Œ &lt;code>Long&lt;/code> ç±»å‹çš„ &lt;code>offset&lt;/code> å®ç°ã€‚&lt;/p>
&lt;p>Java é€šè¿‡ &lt;code>Unsafe&lt;/code> çš„ CAS æ“ä½œæ¥å¯¹ &lt;code>volatile int&lt;/code> å€¼è¿›è¡Œæ›´æ–°ã€‚æ ¹æ® &lt;code>value&lt;/code> åœ¨å¯¹è±¡ä¸­çš„åç§»é‡ï¼ŒCAS æ“ä½œå†…å­˜æ•°æ®ï¼Œæ‰§è¡Œä¸€äº›åº•å±‚ï¼Œå’Œå¹³å°ç›¸å…³çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// setup to use Unsafe.compareAndSwapInt for updates
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">Unsafe&lt;/span> &lt;span class="n">unsafe&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Unsafe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getUnsafe&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">valueOffset&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">valueOffset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">unsafe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">objectFieldOffset&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">AtomicInteger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclareFiele&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Error&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¾‹å¦‚ &lt;code>incrementAndGet()&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// AtomicInteger.java
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">incrementAndGet&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">unsafe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAndAddInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">valueOffset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Unsafe.java
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getAndAddInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">delta&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">do&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">v&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getIntVolatile&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">while&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">compareAndSwapInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">delta&lt;/span>&lt;span class="o">));&lt;/span> &lt;span class="c1">// è‡ªæ—‹ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°é…ç½®ï¼Œé»˜è®¤æ˜¯ 10
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">compareAndSwapInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">o&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">offset&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">expected&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¾ªç¯å¼€é”€å¤§&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åªèƒ½å¤„ç†ä¸€ä¸ªå…±äº«å˜é‡&lt;/p>
&lt;ul>
&lt;li>å°è£…æˆå¯¹è±¡ AtomicReference&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ABA&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="aba-é—®é¢˜">ABA é—®é¢˜&lt;/h3>
&lt;p>CAS éœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥å†…å­˜å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šæ›´æ–°å†…å­˜å€¼ã€‚&lt;/p>
&lt;p>å¦‚æœå†…å­˜å€¼åŸæ¥æ˜¯ Aï¼Œåæ¥å˜æˆäº† Bï¼Œç„¶ååˆå˜æˆäº† Aï¼Œé‚£ä¹ˆ CAS è¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯æœ‰å˜åŒ–çš„ã€‚&lt;/p>
&lt;p>&lt;code>A -&amp;gt; B -&amp;gt; A&lt;/code>&lt;/p>
&lt;p>å¯ä»¥ä¸ºå…±äº«å˜é‡å¼•å…¥ä¸€ä¸ªä¿®è®¢å·ï¼ˆæ—¶é—´æˆ³ï¼‰ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šæ›´æ–°ç›¸åº”çš„ä¿®è®¢å·ï¼Œåˆ¤æ–­å˜é‡çš„å€¼æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹ç»™ä¿®æ”¹è¿‡ã€‚&lt;code>AtomicStampedReference&lt;/code>&lt;/p>
&lt;p>&lt;code>[A, 0] -&amp;gt; [B, 1] -&amp;gt; [A, 2]&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;World&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// initialRef initialStamp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">AtomicStampedReference&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">reference&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">AtomicStampedReference&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// expectedReference newStamp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">reference&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">attemptStamp&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// å¯¹ç‰ˆæœ¬å·è¿›è¡Œä¿®æ”¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// expectedReference newReference expectedStamp newStamp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">reference&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">compareAndSet&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// CAS æ“ä½œéœ€è¦åŒæ—¶æä¾› é¢„æœŸå€¼ æ–°å€¼ é¢„æœŸç‰ˆæœ¬å· æ–°ç‰ˆæœ¬å·
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://tech.meituan.com/2018/11/15/java-lock.html" target="_blank" rel="noopener"
>https://tech.meituan.com/2018/11/15/java-lock.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Javaå¹¶å‘ - çº¿ç¨‹æ± </title><link>https://blog.letout.cn/p/thread/threadpool/</link><pubDate>Wed, 30 Mar 2022 16:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/thread/threadpool/</guid><description>&lt;img src="https://blog.letout.cn/imgs/9.jpeg" alt="Featured image of post Javaå¹¶å‘ - çº¿ç¨‹æ± " />&lt;h2 id="åˆ›å»º">åˆ›å»º&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nf">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">corePoolSize&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">maximumPoolSize&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">long&lt;/span> &lt;span class="n">keepAliveTime&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TimeUnit&lt;/span> &lt;span class="n">unit&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BlockingQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">workQueue&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ThreadFactory&lt;/span> &lt;span class="n">threadFactory&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RejectedExecutionHandler&lt;/span> &lt;span class="n">handler&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>&lt;code>corePoolSize&lt;/code> æ ¸å¿ƒçº¿ç¨‹æ•°&lt;/p>
&lt;ul>
&lt;li>æ¯æ¬¡å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªå¤šçº¿ç¨‹ä»»åŠ¡ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ¸å¿ƒçº¿ç¨‹ï¼Œæ— è®ºæ˜¯å¦æœ‰ç©ºé—²çº¿ç¨‹ï¼Œç›´åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°çš„æ•°é‡ï¼Œæ‰ä¼šå¼€å§‹å¤ç”¨çº¿ç¨‹èµ„æºã€‚&lt;/li>
&lt;li>ä½¿ç”¨ &lt;code>prestartAllCoreThreads()&lt;/code> ç›´æ¥åˆå§‹åŒ–å…¨éƒ¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>maximumPoolSize&lt;/code> æœ€å¤§çº¿ç¨‹æ•°&lt;/p>
&lt;ul>
&lt;li>å½“æ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä¸”ç­‰å¾…é˜Ÿåˆ—å·²æ»¡ï¼Œä¼šå¼€å§‹åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ï¼Œä½†ä¸è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>keepAliveTime&lt;/code> çº¿ç¨‹æœ€å¤§ç©ºé—²æ—¶é—´&lt;/p>
&lt;ul>
&lt;li>éæ ¸å¿ƒçº¿ç¨‹è¶…è¿‡æœ€å¤§ç©ºé—²æ—¶é—´ï¼Œä¼šè‡ªåŠ¨é”€æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>unit&lt;/code> æœ€å¤§ç©ºé—²æ—¶é—´å•ä½&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>workQueue&lt;/code> çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—&lt;/p>
&lt;ul>
&lt;li>æ ¸å¿ƒçº¿ç¨‹æ•°å·²æ»¡æ—¶ï¼Œä¼šå°†ä»»åŠ¡æš‚å­˜åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼Œç›´åˆ°çº¿ç¨‹èµ„æºå¯ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>threadFactory&lt;/code> çº¿ç¨‹åˆ›å»ºå·¥å‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>handler&lt;/code> æ‹’ç»ç­–ç•¥&lt;/p>
&lt;ul>
&lt;li>å½“ç­‰å¾…é˜Ÿåˆ—å·²æ»¡ï¼Œå¹¶ä¸”è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ–°çš„ä»»åŠ¡ä¼šè¿›è¡Œæ‹’ç»å¤„ç†&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="çº¿ç¨‹æ± çš„å¤§å°">çº¿ç¨‹æ± çš„å¤§å°&lt;/h3>
&lt;ul>
&lt;li>CPU å¯†é›†å‹&lt;/li>
&lt;/ul>
&lt;p>ä¸»è¦æ˜¯æ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼Œç›¸åº”å¾ˆå¿«ï¼ŒCPU åˆ©ç”¨ç‡é«˜ã€‚æ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•° + 1&lt;/p>
&lt;ul>
&lt;li>IO å¯†é›†å‹&lt;/li>
&lt;/ul>
&lt;p>ä¸»è¦æ˜¯è¿›è¡Œ IO æ“ä½œï¼Œå¦‚ç¡¬ç›˜è¯»å–æ•°æ®ç­‰ï¼ŒIO æ“ä½œæ—¶é—´é•¿ï¼ŒCPU åˆ©ç”¨ä¸é«˜ï¼Œæ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•° = 2 * CPU æ ¸å¿ƒæ•°ã€‚&lt;/p>
&lt;h3 id="æ‹’ç»ç­–ç•¥">æ‹’ç»ç­–ç•¥&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>AbortPolicy&lt;/p>
&lt;ul>
&lt;li>æŠ›å‡ºå¼‚å¸¸æ‹’ç»ä»»åŠ¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>DiscardPolicy&lt;/p>
&lt;ul>
&lt;li>ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œæ‹’ç»ä»»åŠ¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>DiscardOldestPolicy&lt;/p>
&lt;ul>
&lt;li>ä¸¢å¼ƒæœ€è€çš„ä»»åŠ¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>CallerRunsPolicy&lt;/p>
&lt;ul>
&lt;li>å°†ä»»åŠ¡äº¤ç»™è°ƒç”¨çº¿ç¨‹æ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="ä½¿ç”¨">ä½¿ç”¨&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// execute
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// submit
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">future&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">submit&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;è¿”å›å€¼&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">future&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å¸¸è§çš„çº¿ç¨‹æ± ">å¸¸è§çš„çº¿ç¨‹æ± &lt;/h2>
&lt;h3 id="newsinglethreadexecutor">newSingleThreadExecutor&lt;/h3>
&lt;ul>
&lt;li>åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± &lt;/li>
&lt;li>å”¯ä¸€çº¿ç¨‹å¯ä»¥ä¿è¯æ‰€æäº¤çš„ä»»åŠ¡é¡ºåºæ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="nf">newSingleThreadExecutor&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">FinalizableDelegatedExecutorService&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span>&lt;span class="n">L&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MILLISECONDS&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedBlockingQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;()));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="newfixedthreadpool">newFixedThreadPool&lt;/h3>
&lt;ul>
&lt;li>å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± &lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="nf">newFixedThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">nThreads&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">nThread&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">nThread&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span>&lt;span class="n">L&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MILLISECONDS&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedBlockingQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="newcachedthreadpool">newCachedThreadPool&lt;/h3>
&lt;ul>
&lt;li>æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± &lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="nf">newCachedThreadPool&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Integer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MAX_VALUE&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">60L&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">SynchronousQueue&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="o">&amp;gt;());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“æäº¤æ–°ä»»åŠ¡æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸ºç©ºæˆ–æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚&lt;/p>
&lt;p>å½“çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTime=60sï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹èµ„æºã€‚é•¿æ—¶é—´ç©ºé—²çš„ CachedThreadPool ä¸ä¼šæŒæœ‰ä»»åŠ¡ä»»ä½•çº¿ç¨‹èµ„æºã€‚&lt;/p>
&lt;h2 id="scheduledthreadpoolexecutor">ScheduledThreadPoolExecutor&lt;/h2>
&lt;p>&lt;code>ScheduledThreadPoolExecutor&lt;/code> å¯ä»¥ç”¨æ¥æäº¤å®šæ—¶ä»»åŠ¡ï¼Œ&lt;code>extends ThreadPoolExecutor&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ScheduledExecutorService&lt;/span> &lt;span class="nf">newScheduledThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">corePoolSize&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ScheduledThreadPoolExecutor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">corePoolSize&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>ScheduledThreadPoolExecutor&lt;/code> æœ€å¤§çº¿ç¨‹æ± å®¹é‡ä¸º &lt;code>Integer.MAX_VALUE&lt;/code>ï¼›éƒ½æ˜¯é‡‡ç”¨çš„&lt;code>DelayedWorkQueue&lt;/code> ä½œä¸ºç­‰å¾…é˜Ÿåˆ—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ScheduledExecutorService&lt;/span> &lt;span class="n">executor&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newScheduledThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å»¶è¿Ÿ 3 s åæ‰§è¡Œä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">schedule&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®šæ—¶ä»»åŠ¡&amp;#34;&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">shutdown&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ScheduledExecutorService&lt;/span> &lt;span class="n">executor&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newScheduledThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å»¶è¿Ÿ 3 s åï¼Œæ¯ 1 s æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">scheduleAtFixedRate&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;å®šæ—¶ä»»åŠ¡&amp;#34;&lt;/span>&lt;span class="o">),&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">TimeUnit&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="forkjoinpool">ForkJoinPool&lt;/h2>
&lt;blockquote>
&lt;p>Fork -&amp;gt; æ‹†åˆ† Pool -&amp;gt; åˆå¹¶&lt;/p>
&lt;/blockquote>
&lt;p>æŠŠå¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå°ä»»åŠ¡ï¼Œæœ€åæ±‡æ€»å¤šä¸ªå°ä»»åŠ¡çš„ç»“æœï¼Œå¾—åˆ°æ•´å¤§ä»»åŠ¡çš„ç»“æœã€‚è¿™äº›å°ä»»åŠ¡éƒ½æ˜¯åŒæ—¶è¿›è¡Œï¼Œå¯æé«˜è¿ç®—æ•ˆç‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ForkJoinTask&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">task&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SubTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ForkJoinPool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">commonPool&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">task&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">SubTask&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">RecursiveTask&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">SubTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">start&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">end&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">protected&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="nf">compute&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">end&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">125&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// ä»»åŠ¡è¶³å¤Ÿå°ï¼Œç›´æ¥è®¡ç®—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; å¼€å§‹è®¡ç®— &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;-&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">end&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;çš„å€¼&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä»»åŠ¡å¤ªå¤§ï¼Œæ‹†åˆ†æˆå­ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">SubTask&lt;/span> &lt;span class="n">subTask1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SubTask&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">end&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subTask1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">fork&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SubTask&lt;/span> &lt;span class="n">subTask2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SubTask&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">end&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subTask2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">fork&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">subTask1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">join&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">subTask2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">join&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å·¥ä½œçªƒå–ï¼š&lt;/p>
&lt;p>å­ä»»åŠ¡ä¼šè¢«æ”¾åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¼šæœ‰å¯¹åº”çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡ã€‚&lt;/p>
&lt;p>è‹¥æŸä¸ªé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è®¡ç®—å®Œæ¯•ï¼Œä½†å…¶ä»–çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­è¿˜æœ‰ä»»åŠ¡ï¼Œä¼šä»å…¶ä»–é˜Ÿåˆ—ä¸­â€œçªƒå–â€ä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://segmentfault.com/a/1190000039267451" target="_blank" rel="noopener"
>https://segmentfault.com/a/1190000039267451&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Java å¤šçº¿ç¨‹</title><link>https://blog.letout.cn/p/thread/thread/</link><pubDate>Wed, 30 Mar 2022 14:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/thread/thread/</guid><description>&lt;img src="https://blog.letout.cn/imgs/9.jpeg" alt="Featured image of post Java å¤šçº¿ç¨‹" />&lt;h2 id="-è¿›ç¨‹ä¸çº¿ç¨‹">ğŸ­ è¿›ç¨‹ä¸çº¿ç¨‹&lt;/h2>
&lt;p>&lt;strong>è¿›ç¨‹&lt;/strong>æ˜¯ç¨‹åºå‘æ“ä½œç³»ç»Ÿç”³è¯·èµ„æºçš„åŸºæœ¬å•ä½ã€‚&lt;/p>
&lt;p>&lt;strong>çº¿ç¨‹&lt;/strong>æ˜¯è¿›ç¨‹ä¸­å¯ç‹¬ç«‹æ‰§è¡Œçš„æœ€å°å•ä½ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ï¼ŒåŒä¸€è¿›ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹ä¸­çš„èµ„æºã€‚&lt;/p>
&lt;h3 id="æ— å¤„ä¸åœ¨çš„çº¿ç¨‹">æ— å¤„ä¸åœ¨çš„çº¿ç¨‹&lt;/h3>
&lt;ul>
&lt;li>main çº¿ç¨‹&lt;/li>
&lt;li>åƒåœ¾å›æ”¶çº¿ç¨‹&lt;/li>
&lt;li>Web æœåŠ¡å™¨è¯·æ±‚å¤„ç†çº¿ç¨‹&lt;/li>
&lt;/ul>
&lt;h2 id="-å¹¶å‘ä¸å¹¶è¡Œ">ğŸ¹ å¹¶å‘ä¸å¹¶è¡Œ&lt;/h2>
&lt;p>&lt;img src="https://blog.letout.cn/p/thread/thread/concurrent-and-parallel.jpg"
width="600"
height="451"
srcset="https://blog.letout.cn/p/thread/thread/concurrent-and-parallel_hufc79b6e20e4f7d694c9a67d5fcfb6f12_40736_480x0_resize_q75_box.jpg 480w, https://blog.letout.cn/p/thread/thread/concurrent-and-parallel_hufc79b6e20e4f7d694c9a67d5fcfb6f12_40736_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="ConcurrentAndParallel"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="319px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¹¶å‘ &lt;code>Concurrent&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æŒ‡åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œäº¤æ›¿çš„å®Œæˆå¤šä¸ªä»»åŠ¡ï¼ˆä¸€ä¸ª CPU æ ¸å¿ƒäº¤æ›¿æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å¹¶è¡Œ &lt;code>Parallel&lt;/code>&lt;/p>
&lt;ul>
&lt;li>é½å¤´å¹¶è¿›åœ°æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼ˆå¤šä¸ª CPU æ ¸å¿ƒåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-åŒæ­¥ä¸å¼‚æ­¥">ğŸ¦Š åŒæ­¥ä¸å¼‚æ­¥&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>åŒæ­¥&lt;/p>
&lt;ul>
&lt;li>éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å¼‚æ­¥&lt;/p>
&lt;ul>
&lt;li>ä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œå°±èƒ½ç»§ç»­è¿è¡Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-çº¿ç¨‹çš„åˆ›å»º">ğŸ» çº¿ç¨‹çš„åˆ›å»º&lt;/h2>
&lt;h3 id="extends-thread">extends Thread&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">MyThread&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Thread&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="implement-runnable">implement Runnable&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">RunnableThread&lt;/span> &lt;span class="n">implement&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">RunnableThread&lt;/span>&lt;span class="o">()).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="implement-callable">implement Callable&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Callable å¯ä»¥æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼é€šè¿‡ &lt;code>FutureTask&lt;/code> è¿›è¡Œå°è£…ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>call() æ–¹æ³•å…è®¸æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">CallbaleThead&lt;/span> &lt;span class="n">implement&lt;/span> &lt;span class="n">Callbale&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="nf">call&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">Exception&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">666&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">FutureTask&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">futureTask&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">FutureTask&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">CallbaleThead&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">Thread&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">futureTask&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">futureTask&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.letout.cn/p/thread/thread/FutureTask.png"
width="964"
height="706"
srcset="https://blog.letout.cn/p/thread/thread/FutureTask_hu6b05634f3a5f84702cb4db413d8bbef5_51410_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/thread/thread/FutureTask_hu6b05634f3a5f84702cb4db413d8bbef5_51410_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="FutureTask"
class="gallery-image"
data-flex-grow="136"
data-flex-basis="327px"
>&lt;/p>
&lt;h3 id="çº¿ç¨‹æ± ">çº¿ç¨‹æ± &lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="n">executorService&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newFixThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">executorService&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execute&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Demo&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="n">executorService&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Executors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newFixThreadPool&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Future&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">future&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">executorService&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">submit&lt;/span>&lt;span class="o">(()&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">666&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">future&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ">ğŸ¼ çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Thread&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Runnable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">enum&lt;/span> &lt;span class="n">State&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">NEW&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RUNNABLE&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BLOCKED&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">WAITING&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TIMED_WAITING&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TERMINATED&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ–°å»º &lt;code>New&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åˆ›å»ºåå°šæœªå¯åŠ¨ã€‚&lt;/p>
&lt;ul>
&lt;li>å¯è¿è¡Œ &lt;code>Runnable&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å¯èƒ½æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½æ­£åœ¨ç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚&lt;/p>
&lt;ul>
&lt;li>é˜»å¡ &lt;code>Blocked&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ç­‰å¾…è·å–ä¸€ä¸ªæ’å®ƒé”ï¼Œå¦‚æœå…¶çº¿ç¨‹é‡Šæ”¾äº†é”å°±ä¼šç»“æŸæ­¤çŠ¶æ€ã€‚ï¼ˆæœªè·å–è¿‡é”ï¼‰&lt;/p>
&lt;ul>
&lt;li>æ— é™æœŸç­‰å¾… &lt;code>Waiting&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œå¦åˆ™ä¸ä¼šè¢«åˆ†é… CPU æ—¶é—´ç‰‡ã€‚ï¼ˆè·å–è¿‡é”ï¼Œä½†æ˜¯æ”¾å¼ƒäº†é”ï¼‰&lt;/p>
&lt;ul>
&lt;li>é™æœŸç­‰å¾… &lt;code>Timed Waiting&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ— éœ€ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ã€‚&lt;/p>
&lt;ul>
&lt;li>æ­»äº¡ &lt;code>Terminated&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>çº¿ç¨‹ç»“æŸä»»åŠ¡ä¹‹åè‡ªå·±ç»“æŸï¼Œæˆ–è€…äº§ç”Ÿäº†å¼‚å¸¸è€Œç»“æŸã€‚&lt;/p>
&lt;h2 id="-ä¸­æ–­çº¿ç¨‹">ğŸ° ä¸­æ–­çº¿ç¨‹&lt;/h2>
&lt;h2 id="-å®ˆæŠ¤çº¿ç¨‹">ğŸ¦Š å®ˆæŠ¤çº¿ç¨‹&lt;/h2>
&lt;p>Java ç¨‹åºçš„å…¥å£æ˜¯ç”± JVM å¯åŠ¨çš„ main çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œmain çº¿ç¨‹å¯ä»¥å¯åŠ¨å…¶ä»–çº¿ç¨‹ã€‚å½“æ‰€æœ‰çº¿ç¨‹è¿è¡Œéƒ½ç»“æŸæ—¶ï¼Œç¨‹åºç»ˆæ­¢ï¼Œåªè¦æœ‰ä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰é€€å‡ºï¼Œç¨‹åºå°±ä¸ä¼šç»ˆæ­¢ã€‚&lt;/p>
&lt;p>å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰æ˜¯ä¸€ç§åœ¨åå°ä¸ºå…¶ä»–çº¿ç¨‹æœåŠ¡çš„çº¿ç¨‹ã€‚åœ¨ JVM ä¸­ï¼Œåªè¦ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œæ— è®ºå®ˆæŠ¤çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œéƒ½ä¼šé€€å‡ºç¨‹åºã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">thread&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setDaemon&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>JVM çš„åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯ä¸€ç§å®ˆæŠ¤çº¿ç¨‹ã€‚&lt;/p>
&lt;h2 id="-æŸ¥çœ‹è¿›ç¨‹">ğŸ»â€â„ï¸ æŸ¥çœ‹è¿›ç¨‹&lt;/h2>
&lt;h3 id="linux">Linux&lt;/h3>
&lt;ul>
&lt;li>&lt;code>ps&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>ps -ef&lt;/code> ï¼šæŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹&lt;/p>
&lt;ul>
&lt;li>&lt;code>top&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å‘½ä»¤ä¸‹å¯é€šè¿‡æŒ‰ &lt;code>H&lt;/code> åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºçº¿ç¨‹&lt;/p>
&lt;p>&lt;code>top -H -p 4262&lt;/code> ï¼š æŸ¥çœ‹ PID=4262 è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯&lt;/p>
&lt;h3 id="java">Java&lt;/h3>
&lt;ul>
&lt;li>&lt;code>jps&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹&lt;/p>
&lt;ul>
&lt;li>&lt;code>jstack&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>jstack 4262&lt;/code> ï¼š æŸ¥çœ‹ PID=4262 çš„ Java è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯&lt;/p>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://pdai.tech/md/java/thread/java-thread-x-thread-basic.html#%e5%ae%9e%e7%8e%b0-callable-%e6%8e%a5%e5%8f%a3" target="_blank" rel="noopener"
>https://pdai.tech/md/java/thread/java-thread-x-thread-basic.html#%e5%ae%9e%e7%8e%b0-callable-%e6%8e%a5%e5%8f%a3&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>é€šç”¨ç¨‹åºè®¾è®¡</title><link>https://blog.letout.cn/p/effective-java/general-programming/</link><pubDate>Wed, 30 Mar 2022 14:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/effective-java/general-programming/</guid><description>&lt;img src="https://blog.letout.cn/p/effective-java/general-programming/effective-java.png" alt="Featured image of post é€šç”¨ç¨‹åºè®¾è®¡" />&lt;h1 id="-é€šç”¨ç¨‹åºè®¾è®¡">â˜˜ï¸ é€šç”¨ç¨‹åºè®¾è®¡&lt;/h1>
&lt;p>Effective Java é˜…è¯»ç¬”è®°ã€‚æœ¬ç« ä¸»è¦è®¨è®ºäº† &lt;code>Java&lt;/code> è¯­è¨€çš„å…·ä½“ç»†èŠ‚ã€‚åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>å±€éƒ¨å˜é‡&lt;/li>
&lt;li>æ§åˆ¶ç»“æ„&lt;/li>
&lt;li>ç±»åº“&lt;/li>
&lt;li>æ•°æ®ç»“æ„&lt;/li>
&lt;li>ä¸æ˜¯ç”±è¯­è¨€æœ¬èº«æä¾›çš„æœºåˆ¶&lt;/li>
&lt;li>ä¼˜åŒ–å’Œå‘½åæƒ¯ä¾‹ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="57-å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–">57. å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ–&lt;/h2>
&lt;h3 id="-å»ºè®®">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ± æœ€å°åŒ–å±€éƒ¨å˜é‡çš„èŒƒå›´ï¼Œå¯æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œé™ä½å‡ºé”™çš„å¯èƒ½æ€§ã€‚&lt;strong>åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å®ƒçš„åœ°æ–¹å£°æ˜å˜é‡ã€‚&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ æ¯ä¸ªå±€éƒ¨å˜é‡å£°æ˜éƒ½åº”è¯¥åŒ…å«ä¸€ä¸ªåˆå§‹åŒ–è¡¨è¾¾å¼ã€‚&lt;code>try-catch&lt;/code> è¯­å¥é™¤å¤–ã€‚&lt;/p>
&lt;p>å¦‚æœä¸€ä¸ªå˜é‡åˆå§‹åŒ–ï¼Œä¼šæŠ›å‡ºä¸€ä¸ª checked å¼‚å¸¸ï¼Œå¿…é¡»åœ¨ &lt;code>try&lt;/code> ä¸­åˆå§‹åŒ–ï¼ˆé™¤éæ‰€åŒ…å«çš„æ–¹æ³•å¯ä»¥æŠ›å¼‚å¸¸ï¼‰ã€‚&lt;/p>
&lt;p>å¦‚æœè¯¥å€¼å¿…é¡»åœ¨ &lt;code>try&lt;/code> å—ä¹‹å¤–ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åœ¨ &lt;code>try&lt;/code> å—ä¹‹å‰å£°æ˜ï¼Œæ­¤æ—¶å®ƒè¿˜ä¸èƒ½â€œåˆç†åœ°åˆå§‹åŒ–â€œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cons&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ğŸ€ å¾ªç¯ç»“æŸåä¸å†éœ€è¦å¾ªç¯å˜é‡ï¼Œ&lt;code>for&lt;/code> å¾ªç¯å°±ä¼˜äº &lt;code>while&lt;/code> å¾ªç¯ï¼ˆ&lt;code>for&lt;/code> å¾ªç¯å…è®¸å£°æ˜å¾ªç¯å˜é‡ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± ä¿æŒæ–¹æ³•å°è€Œé›†ä¸­ï¼Œæ¯ä¸ªæ“ä½œéƒ½ç”¨ä¸€ä¸ªæ–¹æ³•æ¥å®Œæˆã€‚é¿å…ä¸€ä¸ªæ“ä½œç›¸å…³çš„å±€éƒ¨å˜é‡å¯èƒ½åœ¨å¦ä¸€ä¸ªæ“ä½œä¸­ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹">ğŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ¾ éå†é›†åˆçš„é¦–é€‰ä¹ æƒ¯ç”¨æ³•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Element&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do something with e
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ğŸ’ éœ€è¦è®¿é—® &lt;code>Iterator&lt;/code> / è°ƒç”¨ &lt;code>Iterator&lt;/code> çš„ &lt;code>remove()&lt;/code>ï¼Œé¦–é€‰ &lt;code>for&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// i is loop variable
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Element&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do something with i and e
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ğŸ’ å¾ªç¯ä¹ æƒ¯ç”¨æ³•ï¼šæœ€å°åŒ–å±€éƒ¨å˜é‡çš„èŒƒå›´&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ¯æ¬¡å¾ªç¯éƒ½ä¼šè°ƒç”¨ expensiveComputation()ï¼Œä¸”è¿”å›ç»“æœç›¸åŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">expensiveComputation&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// do something with i
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®ƒæœ‰ä¸¤ä¸ªå¾ªç¯å˜é‡ï¼ši å’Œ nï¼Œéƒ½å…·æœ‰å®Œå…¨æ­£ç¡®çš„ä½œç”¨åŸŸã€‚ç¬¬äºŒä¸ªå˜é‡ n ç”¨äºå­˜å‚¨ç¬¬ä¸€ä¸ªå˜é‡çš„æé™ï¼Œé¿å…äº†æ¯æ¬¡è¿­ä»£ä¸­å†—ä½™è®¡ç®—çš„æˆæœ¬ã€‚
å¦‚æœå¾ªç¯æ¶‰åŠä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸”ä¿è¯åœ¨æ¯æ¬¡è¿­ä»£ä¸­è¿”å›ç›¸åŒçš„ç»“æœï¼Œåº”è¯¥ä½¿ç”¨è¿™ä¸ªä¹ æƒ¯ç”¨æ³•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="58-for-each-å¾ªç¯ä¼˜äºä¼ ç»Ÿçš„-for-å¾ªç¯">58. for-each å¾ªç¯ä¼˜äºä¼ ç»Ÿçš„ for å¾ªç¯&lt;/h2>
&lt;h3 id="-å»ºè®®-1">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ± &lt;code>for-each&lt;/code> éšè—è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡ï¼Œå¯æ¶ˆé™¤æ··ä¹±å’Œå‡ºé”™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± &lt;code>:&lt;/code> è¡¨ç¤º â€œåœ¨&amp;hellip;é‡Œé¢â€ã€‚ä½¿ç”¨ &lt;code>for-each&lt;/code> å¾ªç¯ä¸ä¼šé™ä½æ€§èƒ½ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ¥€ ä»¥ä¸‹æƒ…å†µä¸åº”è¯¥ä½¿ç”¨ &lt;code>for-each&lt;/code>ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ° ç ´åæ€§è¿‡æ»¤ã€‚å¦‚æœéœ€è¦éå†ä¸€ä¸ªé›†åˆå¹¶åˆ é™¤é€‰å®šå…ƒç´ ï¼Œéœ€è¦ä½¿ç”¨æ˜¾å¼çš„è¿­ä»£å™¨ï¼Œä»¥ä¾¿è°ƒç”¨å…¶ &lt;code>remove()&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ° è½¬æ¢ã€‚éå†æ—¶éœ€è¦æ›¿æ¢å…¶ä¸­å…ƒç´ çš„å€¼ï¼Œéœ€è¦ &lt;code>List&lt;/code> è¿­ä»£å™¨æˆ–æ•°ç»„ç´¢å¼•æ¥æ›¿æ¢å…ƒç´ çš„å€¼ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ° å¹¶è¡Œè¿­ä»£ã€‚å¦‚æœéœ€è¦å¹¶è¡Œéå†å¤šä¸ªé›†åˆï¼Œé‚£ä¹ˆéœ€è¦æ˜¾å¼åœ°æ§åˆ¶è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡ï¼Œä»¥ä¾¿æ‰€æœ‰è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡éƒ½å¯ä»¥åŒæ­¥æ‰§è¡Œã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-1">ğŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸ’ ä½¿ç”¨ &lt;code>Collection.removeIf()&lt;/code> å¯é¿å…æ˜¾å¼çš„éå†ï¼ˆJava8ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">Collection&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Iterable&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Predicate&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">filter&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Objects&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">requireNonNull&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">removed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">each&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">interator&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">each&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">test&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">each&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">each&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">removed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">removed&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h2 id="59-äº†è§£å¹¶ä½¿ç”¨åº“">59. äº†è§£å¹¶ä½¿ç”¨åº“&lt;/h2>
&lt;h3 id="-å»ºè®®-2">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;p>&lt;strong>èƒ½ç”¨åº“æ–¹æ³•å°±ç”¨åº“æ–¹æ³•ã€‚&lt;/strong>&lt;/p>
&lt;p>å…·æœ‰ç®—æ³•èƒŒæ™¯çš„é«˜çº§å·¥ç¨‹å¸ˆèŠ±äº†å¤§é‡æ—¶é—´è®¾è®¡ã€å®ç°å’Œæµ‹è¯•åº“æ–¹æ³•ï¼Œç„¶åå°†åº“æ–¹æ³•å±•ç¤ºç»™è¯¥é¢†åŸŸçš„å‡ ä½ä¸“å®¶ï¼Œä»¥ç¡®ä¿åº“æ–¹æ³•æ˜¯æ­£ç¡®çš„ã€‚
è¿™äº›åº“æ–¹æ³•ç»è¿‡ beta æµ‹è¯•ã€å‘å¸ƒï¼Œå¹¶è¢«æ•°ç™¾ä¸‡ç¨‹åºå‘˜å¹¿æ³›ä½¿ç”¨äº†è¿‘ 20 å¹´ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ± ä½¿ç”¨æ ‡å‡†ç±»åº“çš„å¥½å¤„ï¼š&lt;/p>
&lt;ul>
&lt;li>ğŸŒ° åˆ©ç”¨ç¼–å†™å®ƒçš„ä¸“å®¶çš„çŸ¥è¯†å’Œä»¥å‰ä½¿ç”¨å®ƒçš„äººçš„ç»éªŒã€‚&lt;/li>
&lt;li>ğŸŒ° ä¸å¿…æµªè´¹æ—¶é—´ä¸ºé‚£äº›ä¸ä½ çš„å·¥ä½œæ— å…³çš„é—®é¢˜ç¼–å†™ä¸“é—¨çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/li>
&lt;li>ğŸŒ° éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå®ƒä»¬çš„æ€§èƒ½ä¼šä¸æ–­æé«˜ï¼Œæ— éœ€ä»˜å‡ºä»»ä½•åŠªåŠ›ã€‚ï¼ˆç‰ˆæœ¬æ›´æ–°ï¼‰&lt;/li>
&lt;li>ğŸŒ° å¯ä»¥å°†ä»£ç æ”¾åœ¨ä¸»å¹²ä¸­ã€‚è¿™æ ·çš„ä»£ç æ›´å®¹æ˜“è¢«å¼€å‘äººå‘˜é˜…è¯»ã€ç»´æŠ¤å’Œå¤ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± åœ¨æ¯ä¸ªä¸»è¦ç‰ˆæœ¬ä¸­ï¼Œéƒ½ä¼šå‘åº“ä¸­æ·»åŠ è®¸å¤šç‰¹æ€§ï¼Œäº†è§£è¿™äº›æ–°å¢ç‰¹æ€§æ˜¯å€¼å¾—çš„ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ æ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥ç†Ÿæ‚‰ &lt;code>java.lang&lt;/code>ã€&lt;code>java.util&lt;/code> å’Œ &lt;code>java.io&lt;/code> çš„åŸºç¡€çŸ¥è¯†åŠå…¶å­åŒ…ã€‚ å…¶ä»–åº“çš„çŸ¥è¯†å¯ä»¥æ ¹æ®éœ€è¦è·å¾—ã€‚å°¤å…¶æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>ğŸŒ° &lt;code>java.util.Collections&lt;/code>&lt;/li>
&lt;li>ğŸŒ° &lt;code>java.util.Streams&lt;/code>&lt;/li>
&lt;li>ğŸŒ° &lt;code>java.util.concurrent&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ å¦‚æœä½ åœ¨ Java å¹³å°åº“ä¸­æ‰¾ä¸åˆ°ä½ éœ€è¦çš„ä¸œè¥¿ï¼Œä½ çš„ä¸‹ä¸€ä¸ªé€‰æ‹©åº”è¯¥æ˜¯å¯»æ‰¾é«˜è´¨é‡çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚è°·æ­Œçš„ä¼˜ç§€çš„å¼€æº &lt;code>Guava&lt;/code> åº“ã€‚å¦‚æœä½ æ— æ³•åœ¨ä»»ä½•é€‚å½“çš„åº“ä¸­æ‰¾åˆ°æ‰€éœ€çš„åŠŸèƒ½ï¼Œåªèƒ½è‡ªå·±å®ç°å®ƒã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-2">ğŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸ’ ä» Java 7 å¼€å§‹ï¼Œå°±ä¸åº”è¯¥å†ä½¿ç”¨ Randomã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ° åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé€‰æ‹©çš„éšæœºæ•°ç”Ÿæˆå™¨ç°åœ¨æ˜¯ &lt;code>ThreadLocalRandom&lt;/code>ã€‚ å®ƒèƒ½äº§ç”Ÿæ›´é«˜è´¨é‡çš„éšæœºæ•°ï¼Œè€Œä¸”é€Ÿåº¦éå¸¸å¿«ã€‚&lt;code>ThreadLocalRandom.current().nextInt(100)&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ° å¯¹äº &lt;code>Fork Join Pool&lt;/code> å’Œå¹¶è¡Œ &lt;code>Stream&lt;/code>ï¼Œä½¿ç”¨ &lt;code>SplittableRandom&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å‡è®¾ä½ æƒ³è¦ç”Ÿæˆ 0 åˆ°æŸä¸ªä¸Šç•Œä¹‹é—´çš„éšæœºæ•´æ•°ï¼Œè®¸å¤šç¨‹åºå‘˜ä¼šç¼–å†™ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„å°æ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æœ‰ä¸¥é‡ç¼ºé™·
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">static&lt;/span> &lt;span class="n">Random&lt;/span> &lt;span class="n">rnd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Random&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">random&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">Math&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">abs&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">rad&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®ƒæœ‰ä¸‰ä¸ªç¼ºç‚¹:&lt;/p>
&lt;ul>
&lt;li>ğŸŒ© n æ˜¯å°çš„å¹³æ–¹æ•°ï¼Œéšæœºæ•°åºåˆ—ä¼šåœ¨ç›¸å½“çŸ­çš„æ—¶é—´å†…é‡å¤&lt;/li>
&lt;li>ğŸŒ© å¦‚æœ n ä¸æ˜¯ 2 çš„å¹‚ï¼Œé‚£ä¹ˆå¹³å‡è€Œè¨€ï¼Œä¸€äº›æ•°å­—å°†æ¯”å…¶ä»–æ•°å­—æ›´é¢‘ç¹åœ°è¿”å›&lt;/li>
&lt;li>ğŸŒ© åœ¨æå°‘æ•°æƒ…å†µä¸‹ä¼šè¿”å›è¶…å‡ºæŒ‡å®šèŒƒå›´çš„æ•°å­— &lt;code>Integer.MAX_VALUE&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>åº”è¯¥ç›´æ¥ä½¿ç”¨ç±»åº“ &lt;code>Ramdom.nextInt(n)&lt;/code> ï¼Œè€Œä¸æ˜¯è‡ªå·±å°è£…&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">nextInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ğŸŒ¾ Linux &lt;code>curl&lt;/code> in Java 9&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å‡è®¾ä½ æƒ³ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥æ‰“å°å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„ URL çš„å†…å®¹ï¼ˆè¿™å¤§è‡´æ˜¯ Linux &lt;code>curl&lt;/code> å‘½ä»¤æ‰€åšçš„ï¼‰ã€‚åœ¨ Java 9 ä¹‹å‰ï¼Œè¿™æ®µä»£ç æœ‰ç‚¹ä¹å‘³ï¼Œä½†æ˜¯åœ¨ Java 9 ä¸­ï¼Œ&lt;code>transferTo()&lt;/code> è¢«æ·»åŠ åˆ° &lt;code>InputStream&lt;/code> ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨è¿™ä¸ªæ–°æ–¹æ³•æ‰§è¡Œè¿™é¡¹ä»»åŠ¡çš„å®Œæ•´ç¨‹åºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IOException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InputStream&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">URL&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">]).&lt;/span>&lt;span class="na">openStream&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">in&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">transferTo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="60-è‹¥éœ€è¦ç²¾ç¡®ç­”æ¡ˆå°±åº”é¿å…ä½¿ç”¨-float-double">60. è‹¥éœ€è¦ç²¾ç¡®ç­”æ¡ˆå°±åº”é¿å…ä½¿ç”¨ float double&lt;/h2>
&lt;h3 id="-å»ºè®®-3">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>ğŸŒ± &lt;code>float&lt;/code> å’Œ &lt;code>double&lt;/code> ç±»å‹ç‰¹åˆ«ä¸é€‚åˆè¿›è¡Œè´§å¸è®¡ç®—ï¼Œå› ä¸ºä¸èƒ½å°† 0.1ï¼ˆæˆ– 10 çš„ä»»æ„è´Ÿæ¬¡å¹‚ï¼‰ç²¾ç¡®åœ°è¡¨ç¤ºã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 0.6100000000000001
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mf">1.03&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mf">0.42&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ğŸ€ æ•°å€¼ä¸æ˜¯å¤ªå¤§ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>int&lt;/code> æˆ– &lt;code>long&lt;/code>
&lt;ul>
&lt;li>ğŸŒ° å¦‚æœæ•°å€¼ä¸è¶…è¿‡ 9 ä½å°æ•°ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>int&lt;/code>&lt;/li>
&lt;li>ğŸŒ° å¦‚æœä¸è¶…è¿‡ 18 ä½ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>long&lt;/code>&lt;/li>
&lt;li>ğŸŒ° å¦‚æœæ•°é‡å¯èƒ½è¶…è¿‡ 18 ä½ï¼Œåˆ™ä½¿ç”¨ &lt;code>BigDecimal&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>ä¾‹å¦‚ï¼šåœ¨å¾®ä¿¡æ”¯ä»˜çš„ &lt;code>Java SDK&lt;/code> ä¸­ï¼Œè´§å¸çš„ç±»å‹ä¸º &lt;code>int&lt;/code>ï¼Œç»“ç®—å•ä½ä¸º åˆ†ï¼›
åœ¨æ”¯ä»˜å®æ”¯ä»˜çš„ &lt;code>Java SDK&lt;/code> ä¸­ï¼Œè´§å¸çš„ç±»å‹ä¸º &lt;code>String&lt;/code>ï¼Œç»“ç®—å•ä½ä¸º å…ƒ&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>ğŸŒ± ä½¿ç”¨ &lt;code>BigDecimal&lt;/code> ç±»å‹ä»£æ›¿ &lt;code>double / float&lt;/code>ã€‚æ³¨æ„ï¼Œ&lt;strong>ä½¿ç”¨ &lt;code>BigDecimal&lt;/code> çš„ &lt;code>String&lt;/code> æ„é€ å‡½æ•°è€Œä¸æ˜¯å®ƒçš„ &lt;code>double / float&lt;/code> æ„é€ å‡½æ•°ã€‚&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h2 id="61-åŸºæœ¬æ•°æ®ç±»å‹ä¼˜äºåŒ…è£…ç±»">61. åŸºæœ¬æ•°æ®ç±»å‹ä¼˜äºåŒ…è£…ç±»&lt;/h2>
&lt;h3 id="-å»ºè®®-4">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ± Java ç±»å‹ç³»ç»Ÿç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š&lt;/p>
&lt;ul>
&lt;li>ğŸŒ° åŸºæœ¬ç±»å‹ï¼ˆprimitive typeï¼‰ï¼š&lt;code>int double boolean&lt;/code>&lt;/li>
&lt;li>ğŸŒ° å¼•ç”¨ç±»å‹ï¼ˆreference typeï¼‰ï¼š&lt;code>String List&lt;/code>
æ¯ä¸ªåŸºæœ¬ç±»å‹éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å¼•ç”¨ç±»å‹ï¼Œç§°ä¸ºåŒ…è£…ç±»å‹ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹ä¹‹é—´æœ‰ä¸‰ä¸ªä¸»è¦åŒºåˆ«ï¼š&lt;/p>
&lt;ul>
&lt;li>ğŸŒ° åŸºæœ¬ç±»å‹åªæœ‰å®ƒä»¬çš„å€¼ï¼Œè€ŒåŒ…è£…ç±»å‹å…·æœ‰ä¸å…¶å€¼ä¸åŒçš„æ ‡è¯†&lt;/li>
&lt;li>ğŸŒ° åŸºæœ¬ç±»å‹åªæœ‰å…¨åŠŸèƒ½å€¼ï¼Œè€Œæ¯ä¸ªåŒ…è£…ç±»å‹é™¤äº†å¯¹åº”çš„åŸºæœ¬ç±»å‹çš„æ‰€æœ‰åŠŸèƒ½å€¼å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéåŠŸèƒ½å€¼ï¼Œå³ &lt;code>null&lt;/code>&lt;/li>
&lt;li>ğŸŒ° åŸºæœ¬ç±»å‹æ¯”åŒ…è£…ç±»å‹æ›´èŠ‚çœæ—¶é—´å’Œç©ºé—´&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ è¦æœ‰é€‰æ‹©ï¼Œå°±åº”è¯¥ä¼˜å…ˆä½¿ç”¨åŸºæœ¬ç±»å‹ï¼Œè€Œä¸æ˜¯åŒ…è£…ç±»å‹ã€‚åŸºæœ¬ç±»å‹æ›´ç®€å•ã€æ›´å¿«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ¥€ ä»¥ä¸‹æƒ…å†µå¿…é¡»ä½¿ç”¨åŒ…è£…ç±»å‹ï¼š&lt;/p>
&lt;ul>
&lt;li>ğŸŒ° ä½œä¸ºé›†åˆä¸­çš„å…ƒç´ ã€é”®å’Œå€¼&lt;/li>
&lt;li>ğŸŒ° å¿…é¡»ä½¿ç”¨åŒ…è£…ç±»å‹ä½œä¸ºç±»å‹å‚æ•°ï¼Œ&lt;code>Java&lt;/code> ä¸å…è®¸ä½¿ç”¨åŸºæœ¬ç±»å‹ã€‚å¦‚ &lt;code>ThreadLocal&amp;lt;Integer&amp;gt;&lt;/code>&lt;/li>
&lt;li>ğŸŒ° è¿›è¡Œåå°„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¿…é¡»ä½¿ç”¨åŒ…è£…ç±»å‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-3">ğŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ¾ ä»¥ä¸‹ä¸‰ä¸ªä¾‹å­ä¸ºå¸¸è§çš„åŒ…è£…ç±»å‹é—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ© å°† &lt;code>==&lt;/code> æ“ä½œç¬¦åº”ç”¨äºåŒ…è£…ç±»å‹å‡ ä¹éƒ½æ˜¯é”™è¯¯çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ğŸ™…â€â™‚ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Comparator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">naturalOrder&lt;/span> &lt;span class="o">=(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¡¨è¾¾å¼ &lt;code>i &amp;lt; j&lt;/code> ä¼šä½¿ i å’Œ j å¼•ç”¨çš„ &lt;code>Integer&lt;/code> å®ä¾‹è‡ªåŠ¨æ‹†ç®±ã€‚
è¡¨è¾¾å¼ &lt;code>i == j&lt;/code> å¯¹ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ‰§è¡Œæ¯”è¾ƒï¼Œè¿”å› &lt;code>false&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ğŸ™†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Comparator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">naturalOrder&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">iBoxed&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">jBoxed&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iBoxed&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">jBoxed&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// è‡ªåŠ¨æ‹†ç®±
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ğŸŒ© &lt;code>NullPointerException&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Unbelievable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span> &lt;span class="n">Integer&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">42&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Unbelievable&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è®¡ç®—è¡¨è¾¾å¼ &lt;code>i == 42&lt;/code> æ—¶æŠ›å‡º &lt;code>NullPointerException&lt;/code>ã€‚ç©ºå¯¹è±¡å¼•ç”¨è‡ªåŠ¨æ‹†ç®±ï¼Œå°†å¾—åˆ°ä¸€ä¸ª &lt;code>NullPointerException&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ© ä¸¥é‡çš„æ€§èƒ½é—®é¢˜&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Long&lt;/span> &lt;span class="n">sum&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">L&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">long&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">Integer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">MAX_VALUE&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å±€éƒ¨å˜é‡ &lt;code>sum&lt;/code>ï¼Œå®ƒæ˜¯åŒ…è£…ç±»å‹ &lt;code>Long&lt;/code>ï¼Œè€Œä¸æ˜¯åŸºæœ¬ç±»å‹ &lt;code>long&lt;/code>ã€‚å˜é‡è¢«åå¤è£…ç®±å’Œæ‹†ç®±ï¼ˆè¶…å‡ºç¼“å­˜éƒ¨åˆ†æ—¶ï¼‰ï¼Œå¯¼è‡´äº§ç”Ÿæ˜æ˜¾çš„æ€§èƒ½ä¸‹é™ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="62-å…¶ä»–ç±»å‹æ›´åˆé€‚æ—¶åº”é¿å…ä½¿ç”¨å­—ç¬¦ä¸²">62. å…¶ä»–ç±»å‹æ›´åˆé€‚æ—¶ï¼Œåº”é¿å…ä½¿ç”¨å­—ç¬¦ä¸²&lt;/h2>
&lt;h3 id="-å»ºè®®-5">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ± å½“å­˜åœ¨æˆ–å¯ä»¥ç¼–å†™æ›´å¥½çš„æ•°æ®ç±»å‹æ—¶ï¼Œåº”é¿å…å°†å­—ç¬¦ä¸²ç”¨æ¥è¡¨ç¤ºå¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± å¦‚æœä½¿ç”¨ä¸å½“ï¼Œå­—ç¬¦ä¸²æ¯”å…¶ä»–ç±»å‹æ›´éº»çƒ¦ã€çµæ´»æ€§æ›´å·®ã€é€Ÿåº¦æ›´æ…¢ã€æ›´å®¹æ˜“å‡ºé”™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿å…¶ä»–çš„å€¼ç±»å‹ã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸŒ° å¦‚æœæ˜¯æ•°å€¼ç±»å‹ï¼Œåˆ™åº”å°†å…¶è½¬æ¢ä¸ºé€‚å½“çš„æ•°å€¼ç±»å‹ï¼Œå¦‚ &lt;code>int&lt;/code>ã€&lt;code>float&lt;/code> æˆ– &lt;code>BigInteger&lt;/code>ã€‚&lt;/li>
&lt;li>ğŸŒ° å¦‚æœæ˜¯é—®é¢˜çš„ç­”æ¡ˆï¼Œå¦‚â€œæ˜¯â€æˆ–â€œå¦â€è¿™ç±»å½¢å¼ï¼Œåˆ™åº”å°†å…¶è½¬æ¢ä¸ºé€‚å½“çš„ &lt;code>Enum&lt;/code> æˆ– &lt;code>boolean&lt;/code>ã€‚&lt;/li>
&lt;li>ğŸŒ° æ›´ä¸€èˆ¬åœ°ï¼Œå¦‚æœæœ‰åˆé€‚çš„å€¼ç±»å‹ï¼Œæ— è®ºæ˜¯åŸºæœ¬ç±»å‹è¿˜æ˜¯å¯¹è±¡å¼•ç”¨ï¼Œéƒ½åº”è¯¥ä½¿ç”¨å®ƒï¼›å¦‚æœæ²¡æœ‰ï¼Œåº”è¯¥å†™ä¸€ä¸ªã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿æšä¸¾ç±»å‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿èšåˆç±»å‹ã€‚&lt;/p>
&lt;p>å¦‚æœä¸€ä¸ªå®ä½“æœ‰å¤šä¸ªç»„ä»¶ï¼Œå°†å…¶è¡¨ç¤ºä¸ºå•ä¸ªå­—ç¬¦ä¸²é€šå¸¸æ˜¯å¾ˆä¸åˆé€‚çš„ã€‚
ä¾‹å¦‚ï¼Œä¸‹é¢è¿™è¡Œä»£ç æ¥è‡ªä¸€ä¸ªçœŸå®çš„ç³»ç»Ÿæ ‡è¯†ç¬¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">compoundKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">className&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;#&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ç§æ–¹æ³•æœ‰å¾ˆå¤šç¼ºç‚¹ï¼šå¦‚æœç”¨äºåˆ†éš”å­—æ®µ &lt;code>#&lt;/code> çš„å­—ç¬¦å‡ºç°åœ¨å…¶ä¸­ä¸€ä¸ªå­—æ®µä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ··ä¹±ã€‚è¦è®¿é—®å„ä¸ªå­—æ®µï¼Œä½ å¿…é¡»è§£æå­—ç¬¦ä¸²ã€‚ä¸èƒ½æä¾› &lt;code>equals&lt;/code>ã€&lt;code>toString&lt;/code> æˆ– &lt;code>compareTo&lt;/code> æ–¹æ³•ï¼Œä½†å¿…é¡»æ¥å— &lt;code>String&lt;/code> æä¾›çš„è¡Œä¸ºã€‚
æ›´å¥½çš„æ–¹æ³•æ˜¯ç¼–å†™ä¸€ä¸ªç±»æ¥è¡¨ç¤ºèšåˆï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç§æœ‰é™æ€æˆå‘˜ç±»ã€‚ï¼ˆItem-24ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿ capabilities&lt;/p>
&lt;p>æœ‰æ—¶ï¼Œå­—ç¬¦ä¸²ç”¨äºæˆäºˆå¯¹æŸäº›åŠŸèƒ½çš„è®¿é—®æƒã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼Œè€ƒè™‘çº¿ç¨‹æœ¬åœ°å˜é‡æœºåˆ¶çš„è®¾è®¡ã€‚è¿™æ ·çš„æœºåˆ¶æä¾›äº†æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å˜é‡å€¼ã€‚
è¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼šå­—ç¬¦ä¸²é”®è¡¨ç¤ºçº¿ç¨‹æœ¬åœ°å˜é‡çš„å…±äº«å…¨å±€åç§°ç©ºé—´ã€‚
ä¸ºäº†ä½¿è¿™ç§æ–¹æ³•æœ‰æ•ˆï¼Œå®¢æˆ·ç«¯æä¾›çš„å­—ç¬¦ä¸²é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼šå¦‚æœä¸¤ä¸ªå®¢æˆ·ç«¯å„è‡ªå†³å®šä¸ºå®ƒä»¬çš„çº¿ç¨‹æœ¬åœ°å˜é‡ä½¿ç”¨ç›¸åŒçš„åç§°ï¼Œå®ƒä»¬æ— æ„ä¸­å°±ä¼šå…±äº«ä¸€ä¸ªå˜é‡ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´ä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½å¤±è´¥ã€‚
è€Œä¸”å®‰å…¨æ€§å¾ˆå·®ã€‚æ¶æ„å®¢æˆ·ç«¯å¯ä»¥æ•…æ„ä½¿ç”¨ä¸å¦ä¸€ä¸ªå®¢æˆ·ç«¯ç›¸åŒçš„å­—ç¬¦ä¸²å¯†é’¥æ¥éæ³•è®¿é—®å¦ä¸€ä¸ªå®¢æˆ·ç«¯çš„æ•°æ®ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="63-å½“å¿ƒå­—ç¬¦ä¸²è¿æ¥å¼•èµ·çš„æ€§èƒ½é—®é¢˜">63. å½“å¿ƒå­—ç¬¦ä¸²è¿æ¥å¼•èµ·çš„æ€§èƒ½é—®é¢˜&lt;/h2>
&lt;h3 id="-å»ºè®®-6">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ± ä¸è¦ä½¿ç”¨å­—ç¬¦ä¸²è¿æ¥æ“ä½œç¬¦åˆå¹¶å¤šä¸ªå­—ç¬¦ä¸²ï¼Œé™¤éæ€§èƒ½æ— å…³ç´§è¦ã€‚ä½¿ç”¨å­—ç¬¦ä¸²ä¸²è”è¿ç®—ç¬¦ &lt;code>+&lt;/code>ï¼Œé‡å¤ä¸²è” n ä¸ªå­—ç¬¦ä¸²ï¼Œéœ€è¦ n çš„å¹³æ–¹çº§æ—¶é—´ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ ä½¿ç”¨ &lt;code>StringBuilder&lt;/code> ä»£æ›¿ &lt;code>String&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="64-é€šè¿‡æ¥å£å¼•ç”¨å¯¹è±¡">64. é€šè¿‡æ¥å£å¼•ç”¨å¯¹è±¡&lt;/h2>
&lt;h3 id="-å»ºè®®-7">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸ€ ä¼˜å…ˆä½¿ç”¨æ¥å£è€Œä¸æ˜¯ç±»æ¥å¼•ç”¨å¯¹è±¡ã€‚å¦‚æœå­˜åœ¨åˆé€‚çš„æ¥å£ç±»å‹ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨æ¥å£ç±»å‹å£°æ˜å‚æ•°ã€è¿”å›å€¼ã€å˜é‡å’Œå­—æ®µã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± ä½¿ç”¨æ¥å£ä½œä¸ºç±»å‹çš„ä¹ æƒ¯ï¼Œç¨‹åºå°†æ›´åŠ çµæ´»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ¥€ ä»¥ä¸‹æƒ…å†µä½¿ç”¨ ç±» æ¥å¼•ç”¨å¯¹è±¡ï¼š&lt;/p>
&lt;ul>
&lt;li>ğŸŒ° æ²¡æœ‰åˆé€‚çš„æ¥å£å­˜åœ¨
&lt;ul>
&lt;li>&lt;code>String&lt;/code> å’Œ &lt;code>BigInteger&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ğŸŒ° æ¡†æ¶çš„åŸºæœ¬ç±»å‹æ˜¯ç±»ï¼Œä¸æ˜¯æ¥å£
&lt;ul>
&lt;li>&lt;code>java.io&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ğŸŒ° å®ç°æ¥å£çš„ç±»æä¾›äº†æ¥å£ä¸­ä¸å­˜åœ¨çš„é¢å¤–æ–¹æ³•
&lt;ul>
&lt;li>&lt;code>PriorityQueue&lt;/code> ä¸­å®ç°äº† &lt;code>Queue&lt;/code> ä¸å­˜åœ¨çš„ &lt;code>comparator&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="-æ¡ˆä¾‹-4">ğŸŒ» æ¡ˆä¾‹&lt;/h3>
&lt;ul>
&lt;li>ğŸŒ¾ ä¼˜å…ˆä½¿ç”¨æ¥å£ä½œä¸ºç±»å‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ğŸ™†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Son&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">sonSet&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedHashSet&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">ğŸ™…â€â™‚ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">LinkedHashSet&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Son&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">sonSet&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">LinkedHashSet&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="65-æ¥å£ä¼˜å…ˆåå°„æœºåˆ¶">65. æ¥å£ä¼˜å…ˆåå°„æœºåˆ¶&lt;/h2>
&lt;h3 id="-å»ºè®®-8">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ± æ ¸å¿ƒåå°„æœºåˆ¶ &lt;code>java.lang.reflect&lt;/code> æä¾›å¯¹ä»»æ„ç±»çš„ç¼–ç¨‹è®¿é—®ã€‚ç»™å®šä¸€ä¸ª Class å¯¹è±¡ï¼Œå¯ä»¥è·å¾— &lt;code>Constructor&lt;/code>ã€&lt;code>Method&lt;/code>ã€&lt;code>Filed&lt;/code> å®ä¾‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± é€šè¿‡è¿‡è°ƒç”¨ &lt;code>Constructor&lt;/code>ã€&lt;code>Method&lt;/code>ã€&lt;code>Filed&lt;/code> å®ä¾‹ä¸Šçš„æ–¹æ³•ï¼Œå¯ä»¥æ„é€ åº•å±‚çš„å®ä¾‹ã€è°ƒç”¨åº•å±‚ç±»çš„æ–¹æ³•ã€è®¿é—®åº•å±‚ç±»ä¸­çš„å­—æ®µã€‚&lt;/p>
&lt;ul>
&lt;li>ğŸŒ° &lt;code>Method.invoke()&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸ¥€ åå°„å…è®¸ä¸€ä¸ªç±»ä½¿ç”¨å¦ä¸€ä¸ªç±»ï¼Œå³ä½¿åœ¨ç¼–è¯‘å‰è€…æ—¶åè€…å¹¶ä¸å­˜åœ¨ã€‚ç„¶è€Œï¼Œè¿™ç§èƒ½åŠ›æ˜¯æœ‰ä»£ä»·çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>ğŸŒ° å¤±å»äº†ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥çš„æ‰€æœ‰å¥½å¤„ï¼ŒåŒ…æ‹¬å¼‚å¸¸æ£€æŸ¥ã€‚&lt;/li>
&lt;li>ğŸŒ° æ‰§è¡Œåå°„è®¿é—®æ‰€éœ€çš„ä»£ç æ—¢ç¬¨æ‹™åˆå†—é•¿ã€‚å†™èµ·æ¥å¾ˆä¹å‘³ï¼Œè¯»èµ·æ¥ä¹Ÿå¾ˆå›°éš¾ã€‚&lt;/li>
&lt;li>ğŸŒ° æ€§èƒ½é™ä½ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ å¦‚æœä½ å¯¹åº”ç”¨ç¨‹åºæ˜¯å¦éœ€è¦åå°„æœ‰ä»»ä½•ç–‘é—®ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¸éœ€è¦ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± å¦‚æœå¿…é¡»ç”¨åˆ°åœ¨ç¼–è¯‘æ—¶æ— æ³•è·å–çš„ç±»ï¼Œåœ¨ç¼–è¯‘æ—¶å­˜åœ¨ä¸€ä¸ªé€‚å½“çš„æ¥å£æˆ–è¶…ç±»æ¥ï¼Œå¯ä»¥ç”¨åå°„æ–¹å¼åˆ›å»ºå®ä¾‹ï¼Œå¹¶é€šè¿‡å®ƒä»¬çš„æ¥å£æˆ–è¶…ç±»æ­£å¸¸åœ°è®¿é—®å®ƒä»¬ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Translate the class name into a Class object
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">cl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">cl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forNmae&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">])&lt;/span> &lt;span class="c1">// Unchecked cast
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ClassNotFoundException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Class not found.&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Get the constructor
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Constructor&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">cons&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cons&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredConstructor&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">NoSuchMethodException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;No parameterless constructor&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Instantiate the set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// ğŸ™‹â€â™‚ï¸ use interface
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cons&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">IllegalAccessException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Constructor not accessible&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InstantiationException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Class not instantiable.&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">InvocationTargetException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Constructor threw &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCause&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ClassCastException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fatalError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Class doesn&amp;#39;t implement Set&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Exercise the set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">addAll&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Arrays&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">subList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ğŸ¥€ ä¸Šä¾‹ä¸­åå°„æœºåˆ¶çš„ç¼ºç‚¹&lt;/p>
&lt;ul>
&lt;li>ğŸŒ° äº§ç”Ÿ 6 ä¸ªè¿è¡Œæ—¶å¼‚å¸¸&lt;/li>
&lt;li>ğŸŒ° æ ¹æ®ç±»åç”Ÿäº§å®ä¾‹éœ€è¦ 25 è¡Œå†—é•¿ä»£ç ï¼Œè€Œè°ƒç”¨æ„é€ å™¨åªéœ€è¦ä¸€è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± åå°„çš„åˆæ³•ç”¨é€”ï¼ˆå¾ˆå°‘ï¼‰æ˜¯ç®¡ç†ç±»å¯¹è¿è¡Œæ—¶å¯èƒ½ä¸å­˜åœ¨çš„å…¶ä»–ç±»ã€æ–¹æ³•æˆ–å­—æ®µçš„ä¾èµ–å…³ç³»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± å¦‚æœç¼–å†™çš„ç¨‹åºå¿…é¡»åœ¨ç¼–è¯‘æ—¶å¤„ç†æœªçŸ¥çš„ç±»ï¼Œåˆ™åº”è¯¥å°½å¯èƒ½åªä½¿ç”¨åå°„å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨åœ¨ç¼–è¯‘æ—¶å·²çŸ¥çš„æ¥å£æˆ–è¶…ç±»è®¿é—®å¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="66-è°¨æ…åœ°ä½¿ç”¨æœ¬åœ°æ–¹æ³•">66. è°¨æ…åœ°ä½¿ç”¨æœ¬åœ°æ–¹æ³•&lt;/h2>
&lt;h3 id="-å»ºè®®-9">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>ğŸŒ± éå¸¸ä¸å»ºè®®ä½¿ç”¨æœ¬åœ°æ–¹æ³•ã€‚JVM å˜å¾—æ›´å¿«äº†ï¼Œå¹¶ä¸” Java å¹³å°çš„æˆç†Ÿï¼Œå®ƒæä¾›äº†å¯¹è®¸å¤šä»¥å‰åªèƒ½åœ¨å®¿ä¸»å¹³å°ä¸­ä¸Šæ‰¾åˆ°çš„ç‰¹æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>ä¾‹å¦‚ï¼ŒJava 9 ä¸­æ·»åŠ çš„æµ API æä¾›äº†å¯¹ OS æµç¨‹çš„è®¿é—®ã€‚&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>ğŸ¥€ ä½¿ç”¨æœ¬åœ°æ–¹æ³•æœ‰ä¸¥é‡çš„ç¼ºç‚¹ï¼š
&lt;ul>
&lt;li>ğŸŒ° æœ¬åœ°è¯­è¨€ä¸å®‰å…¨ï¼ˆItem-50ï¼‰ï¼Œä½¿ç”¨æœ¬åœ°æ–¹æ³•çš„åº”ç”¨ç¨‹åºä¸å†èƒ½å…å—å†…å­˜æ¯åé”™è¯¯çš„å½±å“ã€‚&lt;/li>
&lt;li>ğŸŒ° Java æ›´ä¾èµ–äºå¹³å°ï¼Œå› æ­¤ä½¿ç”¨æœ¬åœ°æ–¹æ³•çš„ç¨‹åºçš„å¯ç§»æ¤æ€§è¾ƒå·®ã€‚&lt;/li>
&lt;li>ğŸŒ° å®ƒä»¬æ›´éš¾è°ƒè¯•ã€‚&lt;/li>
&lt;li>ğŸŒ° å¦‚æœä¸å°å¿ƒï¼Œæœ¬åœ°æ–¹æ³•å¯èƒ½ä¼šé™ä½æ€§èƒ½ï¼Œå› ä¸ºåƒåœ¾æ”¶é›†å™¨æ— æ³•è‡ªåŠ¨è·Ÿè¸ªæœ¬åœ°å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œè€Œä¸”è¿›å‡ºæœ¬åœ°ä»£ç ä¼šäº§ç”Ÿç›¸å…³çš„æˆæœ¬ã€‚&lt;/li>
&lt;li>ğŸŒ° æœ¬åœ°æ–¹æ³•éœ€è¦â€œç²˜åˆä»£ç â€ï¼Œè¿™å¾ˆéš¾é˜…è¯»ï¼Œè€Œä¸”ç¼–å†™èµ·æ¥å¾ˆä¹å‘³ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="67-è°¨æ…åœ°è¿›è¡Œä¼˜åŒ–">67. è°¨æ…åœ°è¿›è¡Œä¼˜åŒ–&lt;/h2>
&lt;h3 id="-å»ºè®®-10">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸ€ ä¼˜åŒ–å¼Šå¤§äºåˆ©ï¼Œå°¤å…¶æ˜¯å¦‚æœè¿‡æ—©åœ°è¿›è¡Œä¼˜åŒ–ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šç”Ÿæˆæ—¢ä¸å¿«é€Ÿä¹Ÿä¸æ­£ç¡®ä¸”æ— æ³•è½»æ¾ä¿®å¤çš„è½¯ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ ä¸è¦ä¸ºäº†æ€§èƒ½è€Œç‰ºç‰²åˆç†çš„æ¶æ„ã€‚åŠªåŠ›ç¼–å†™å¥½çš„ç¨‹åºï¼Œè€Œä¸æ˜¯å¿«é€Ÿçš„ç¨‹åºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ å¥½çš„ç¨‹åºä½“ç°äº†ä¿¡æ¯éšè—çš„åŸåˆ™ï¼šåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬åœ¨å•ä¸ªç»„ä»¶ä¸­æœ¬åœ°åŒ–è®¾è®¡å†³ç­–ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸å½±å“ç³»ç»Ÿå…¶ä½™éƒ¨åˆ†çš„æƒ…å†µä¸‹æ›´æ”¹å•ä¸ªå†³ç­–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ ä¸ä¼˜åŒ–ä¸æ„å‘³ç€åœ¨ç¨‹åºå®Œæˆä¹‹å‰å¯ä»¥å¿½ç•¥æ€§èƒ½é—®é¢˜ã€‚å®ç°ä¸Šçš„é—®é¢˜å¯ä»¥é€šè¿‡ä»¥åçš„ä¼˜åŒ–æ¥è§£å†³ï¼Œä½†æ˜¯å¯¹äºæ¶æ„ç¼ºé™·ï¼Œå¦‚æœä¸é‡å†™ç³»ç»Ÿï¼Œå°±ä¸å¯èƒ½è§£å†³é™åˆ¶æ€§èƒ½çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾è®¡APIã€çº¿è·¯å±‚åè®®å’ŒæŒä¹…æ•°æ®æ ¼å¼æ—¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ğŸ€ å†å¤šçš„åº•å±‚ä¼˜åŒ–ä¹Ÿä¸èƒ½å¼¥è¡¥ç®—æ³•é€‰æ‹©çš„ä¸è¶³ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="68-éµå®ˆè¢«å¹¿æ³›è®¤å¯çš„å‘½åçº¦å®š">68. éµå®ˆè¢«å¹¿æ³›è®¤å¯çš„å‘½åçº¦å®š&lt;/h2>
&lt;h3 id="-å»ºè®®-11">ğŸŒ¸ å»ºè®®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ğŸŒ± Java å¹³å°æœ‰ä¸€ç»„å®Œå–„çš„å‘½åçº¦å®šï¼Œå…¶ä¸­è®¸å¤šçº¦å®šåŒ…å«åœ¨ã€ŠThe Java Language Specificationã€‹&lt;/p>
&lt;ul>
&lt;li>ğŸŒ° typographical å­—é¢çº¦å®š&lt;/li>
&lt;li>ğŸŒ° grammatical è¯­æ³•çº¦å®š&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± å­—é¢æƒ¯ä¾‹ç¤ºä¾‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">&lt;strong>Identifier Type&lt;/strong>&lt;/th>
&lt;th style="text-align:center">&lt;strong>Example&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">Package or module&lt;/td>
&lt;td style="text-align:center">&lt;code>org.junit.jupiter.api&lt;/code>, &lt;code>com.google.common.collect&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Class or Interface&lt;/td>
&lt;td style="text-align:center">&lt;code>Stream&lt;/code>, &lt;code>FutureTask&lt;/code>, &lt;code>LinkedHashMap&lt;/code>, &lt;code>HttpClient&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Method or Field&lt;/td>
&lt;td style="text-align:center">&lt;code>remove()&lt;/code>, &lt;code>groupingBy()&lt;/code>, &lt;code>getCrc()&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Constant Field&lt;/td>
&lt;td style="text-align:center">MIN_VALUE, NEGATIVE_INFINITY&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Local Variable&lt;/td>
&lt;td style="text-align:center">i, denom, houseNum&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Type Parameter&lt;/td>
&lt;td style="text-align:center">T, E, K, V, X, R, U, V, T1, T2&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;li>
&lt;p>ğŸŒ± è¯­æ³•å‘½åçº¦å®šæ¯”æ’ç‰ˆçº¦å®šæ›´çµæ´»ï¼Œä¹Ÿæ›´æœ‰äº‰è®®ã€‚&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>æ³¨è§£ä¸åå°„</title><link>https://blog.letout.cn/p/java/annotation-and-reflection/</link><pubDate>Fri, 28 Jan 2022 01:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/java/annotation-and-reflection/</guid><description>&lt;h2 id="æ³¨è§£">æ³¨è§£&lt;/h2>
&lt;h3 id="å†…ç½®æ³¨è§£">å†…ç½®æ³¨è§£&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>@Override&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>@Deprecated&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>@SuppressWarning&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å…ƒæ³¨è§£">å…ƒæ³¨è§£&lt;/h3>
&lt;p>å…ƒæ³¨è§£çš„ä½œç”¨æ˜¯ï¼šæ³¨è§£å…¶ä»–æ³¨è§£ã€‚Java ä¸­å®šä¹‰äº†å››ä¸ªå…ƒæ³¨è§£ç±»å‹ï¼Œç”¨æ¥å¯¹å…¶ä»–æ³¨è§£ç±»å‹åšè¯´æ˜ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>@Target&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æè¿°æ³¨è§£çš„ä½¿ç”¨èŒƒå›´ï¼Œæ˜¯ç”¨äºç±»ã€æ–¹æ³•è¿˜æ˜¯å±æ€§ç­‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è¯¥æ³¨è§£çš„ä½œç”¨èŒƒå›´ä¸º
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// TYPE æè¿°ç±»ã€æ¥å£(åŒ…æ‹¬æ³¨è§£ç±»å‹) æˆ–enumå£°æ˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// FIELD æè¿°åŸŸå³ç±»æˆå‘˜å˜é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// METHOD æè¿°æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// PARAMETER æè¿°å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// CONSTRUCTOR æè¿°æ„é€ å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// LOCAL_VARIABLE æè¿°å±€éƒ¨å˜é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nd">@Target&lt;/span>&lt;span class="o">({&lt;/span>&lt;span class="n">TYPE&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">FIELD&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">METHOD&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">PARAMETER&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">CONSTRUCTOR&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">LOCAL_VARIABLE&lt;/span>&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Retention&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">RetentionPolicy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SOURCE&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nd">@interface&lt;/span> &lt;span class="n">SuppressWarning&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="nf">value&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>@Retention&lt;/code>
&lt;ul>
&lt;li>SOURCE æºæ–‡ä»¶ä¸­æœ‰æ•ˆ&lt;/li>
&lt;li>CLASS classæ–‡ä»¶ä¸­æœ‰æ•ˆ&lt;/li>
&lt;li>RUNTIME è¿è¡Œæ—¶æœ‰æ•ˆ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨ä»€ä¹ˆçº§åˆ«ä¿ç•™æ³¨è§£ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Target&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ElementType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">METHOD&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Retention&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">RetentionPolicy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SOURCE&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// æºæ–‡ä»¶ä¸­æœ‰æ•ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="nd">@interface&lt;/span> &lt;span class="n">Override&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>@Documented&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>è¯´æ˜è¯¥æ³¨è§£å°†è¢«åŒ…å«åœ¨ javadoc ä¸­&lt;/p>
&lt;ul>
&lt;li>&lt;code>@Inherited&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>è¯´æ˜å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»ä¸­çš„è¯¥æ³¨è§£&lt;/p>
&lt;h3 id="è‡ªå®šä¹‰æ³¨è§£">è‡ªå®šä¹‰æ³¨è§£&lt;/h3>
&lt;p>ä½¿ç”¨ &lt;code>@interface&lt;/code> è‡ªå®šä¹‰æ³¨è§£ï¼Œä¼šé»˜è®¤ç»§æ‰¿ &lt;code>java.lang.annotation.Annotation&lt;/code> æ¥å£ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¸€èˆ¬ç”¨ &lt;code>value&lt;/code> ä½œä¸ºå‚æ•°åã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ä»¥ç”¨ &lt;code>default&lt;/code> å£°æ˜é»˜è®¤å€¼ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>String value() default &amp;quot;&amp;quot;;&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="åå°„">åå°„&lt;/h2>
&lt;p>åå°„æœºåˆ¶å…è®¸ç¨‹åºåœ¨æ‰§è¡ŒæœŸé—´ï¼Œä½¿ç”¨åå°„ API è·å–ç±»çš„ä¿¡æ¯ï¼Œå¹¶æ“ä½œä»»æ„å¯¹è±¡çš„å†…éƒ¨å±æ€§åŠæ–¹æ³•ã€‚&lt;/p>
&lt;p>ç±»åŠ è½½åï¼Œåœ¨æ–¹æ³•åŒºä¸­ä¼šäº§ç”Ÿä¸€ä¸ª &lt;code>java.lang.Class&lt;/code> ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…å«äº†ç±»çš„ä¿¡æ¯ã€‚åå°„é€šè¿‡è¿™ä¸ªç±»ï¼Œå¯ä»¥è·å–ç±»çš„ç»“æ„ä¸ä¿¡æ¯ã€‚&lt;/p>
&lt;p>åœ¨ JVM ä¸­ï¼Œæ¯ä¸ªç±»åªå­˜åœ¨ä¸€ä¸ª &lt;code>Class&lt;/code> å¯¹è±¡ï¼Œæ— è®ºä½¿ç”¨ä»€ä¹ˆæ–¹å¼è·å–ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ã€‚ï¼ˆåŠ è½½å™¨æ¯ä¸ªç±»åªä¼šåŠ è½½ä¸€æ¬¡ï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;cn.letout.Person&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">person&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Person&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è·å–ç±»çš„ä¿¡æ¯">è·å–ç±»çš„ä¿¡æ¯&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">clazz&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;cn.letout.Test&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç±»çš„ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// åŒ…å + ç±»å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getSimpleName&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// ç±»å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç±»çš„å±æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Field&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">publicFields&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getFields&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// è·å– public å±æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Field&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">fields&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredFields&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// è·å–æ‰€æœ‰å±æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Field&lt;/span> &lt;span class="n">nameField&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getField&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// è·å¾—æŒ‡å®šå±æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nameField&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// è·å¾—å±æ€§å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nameField&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getType&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// è·å¾—å±æ€§ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç±»çš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Method&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">publicMethods&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getMethods&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Method&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">methods&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredMethods&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Method&lt;/span> &lt;span class="n">getNameMethod&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;getName&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// è·å¾—æŒ‡å®šæ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Method&lt;/span> &lt;span class="n">setNameMethod&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;setName&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">setNameMethod&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// è·å–æ–¹æ³•å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">setNameMethod&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getReturnType&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">// è·å–æ–¹æ³•è¿”å›ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç±»çš„æ„é€ å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Constructor&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">publicConstructors&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getConstructors&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Constructor&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">constructors&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredConstructors&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç±»çš„æ³¨è§£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Annotation&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">annotations&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAnnotations&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Annotation&lt;/span> &lt;span class="n">testAnnotation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAnnotation&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">TestAnnotation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">testAnnotation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åˆ›å»ºç±»çš„å¯¹è±¡">åˆ›å»ºç±»çš„å¯¹è±¡&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Person&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">clazz&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Person&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Person&lt;/span> &lt;span class="n">person&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getConstructor&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Person&lt;/span> &lt;span class="n">person&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getConstructor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è·å–ç§æœ‰æ„é€ æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä½¿ç”¨ getDeclaredConstructor() è·å–é public æ„é€ æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Constructor&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Person&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">constructor&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredConstructor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">constructor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAccessible&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Person&lt;/span> &lt;span class="n">person&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">constructor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è°ƒç”¨ç±»çš„æ–¹æ³•">è°ƒç”¨ç±»çš„æ–¹æ³•&lt;/h3>
&lt;p>ä½¿ç”¨åå°„æœºåˆ¶ï¼Œè°ƒç”¨ç±»çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span> &lt;span class="n">clazz&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;cn.letout.Person&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Object&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è·å– public æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Method&lt;/span> &lt;span class="n">method&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;test&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;å‚æ•°&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è·å–é public æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Method&lt;/span> &lt;span class="n">privateMethod&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;fun&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">privateMethod&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAccessible&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">privateMethod&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;å‚æ•°&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¿®æ”¹ç±»çš„å±æ€§">ä¿®æ”¹ç±»çš„å±æ€§&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span> &lt;span class="n">clazz&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;cn.letout.Person&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Object&lt;/span> &lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Field&lt;/span> &lt;span class="n">filed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredField&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">field&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAccessible&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">field&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;Emery&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>åå°„å¯ä»¥ä¿®æ”¹ final ä¿®é¥°çš„å¸¸é‡å±æ€§ã€‚&lt;/strong>
å¦‚æœ JVM æ²¡æœ‰è¿›è¡Œå†…è”ä¼˜åŒ–ï¼Œå¯ç›´æ¥è·å–å¯¹åº”çš„å€¼ã€‚å¦‚æœ JVM å¯¹å…¶è¿›è¡Œäº†å†…è”ä¼˜åŒ–ï¼Œç¼–è¯‘é˜¶æ®µå·²ç»å°†å…¶æ›¿æ¢æˆäº†å¸¸é‡çš„å€¼ï¼ŒåŸä»£ç å¯èƒ½è¾“å‡ºåŸå€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// final name
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">person&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">name&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å†…è”ä¼˜åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Emery&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åå°„è·å–æ³¨è§£">åå°„è·å–æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è·å–ç±»æ³¨è§£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Annotation&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">annotations&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAnnotations&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Annotation&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Test&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">testAnnotation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAnnotation&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Test&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è·å–å±æ€§æ³¨è§£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Field&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">declaredFields&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredFields&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Field&lt;/span> &lt;span class="n">field&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">declaredFields&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Annotation&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Test&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">testAnnotation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">field&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getAnnotation&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Test&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">testAnnotation&lt;/span> &lt;span class="o">!&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">testAnnotation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ... ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Java Map æ“ä½œ</title><link>https://blog.letout.cn/p/java-map-traversal/</link><pubDate>Thu, 28 Oct 2021 21:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/java-map-traversal/</guid><description>&lt;img src="https://blog.letout.cn/imgs/11.jpeg" alt="Featured image of post Java Map æ“ä½œ" />&lt;p>åšè‡ªç„¶è¯­è¨€å¤„ç†å†™äº†æŒºä¹…çš„ &lt;code>Python&lt;/code> ï¼Œç»å¸¸è¦å¤„ç†æ•°æ®ã€‚ç”¨ &lt;code>Python&lt;/code> ä¸­çš„å¤„ç†æ•°æ®çœŸçš„æŒºçˆ½çš„ ğŸ«£ï¼Œæˆ‘å¹³å¸¸éƒ½å–œæ¬¢æŠŠå„ç§æ•°æ®éƒ½å¾€ &lt;code>dict&lt;/code>ï¼ˆä¹Ÿå°±æ˜¯ &lt;code>Java&lt;/code> ä¸­çš„ &lt;code>map&lt;/code>ï¼‰ å’Œ &lt;code>json&lt;/code> ä¸Šè½¬ï¼Œç”¨ &lt;code>Python&lt;/code> å¤„ç†è¿™ä¸ªå„ç§æ–¹ä¾¿ã€‚ æœ€è¿‘å†å†™ &lt;code>Java&lt;/code> å°±ç»å¸¸â€œæ‰‹æ®‹â€ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹ &lt;code>Java&lt;/code> ä¸­å¤„ç† &lt;code>Map&lt;/code>ã€‚&lt;/p>
&lt;h2 id="-éå†æ–¹å¼">â­ï¸ éå†æ–¹å¼&lt;/h2>
&lt;p>Java éå† Mapï¼Œè¦ä¹ˆå°±æ˜¯éå†å®ƒçš„ &lt;code>Map.Entry&amp;lt;K,V&amp;gt; &amp;lt;- entrySet()&lt;/code>ï¼Œè¦ä¹ˆå°±æ˜¯éå†å®ƒçš„ key &lt;code>KeySet &amp;lt;- keySet()&lt;/code>ã€‚ä¸»è¦å¯ä»¥ç”¨ä¸‹é¢å››ç§æ–¹å¼éå†ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Iterator&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ForEach&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Lambda&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Stream&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>é™¤éç‰¹æ®Šéœ€è¦ï¼Œå°½é‡ä½¿ç”¨å 3 ç§éå†æ–¹å¼ï¼Œä½¿ç”¨ &lt;code>Iterator&lt;/code> å¯èƒ½æ›´å®¹æ˜“é€ æˆä¸€äº›é”™è¯¯ï¼ˆEffective Java - 58ï¼š&lt;code>for-each&lt;/code> ä¼˜å…ˆäº &lt;code>for&lt;/code> å¾ªç¯ï¼‰ã€‚&lt;/p>
&lt;p>åœ¨ä¸€äº› &lt;code>for-each&lt;/code> ä¸èƒ½èƒœä»»çš„åœ°æ–¹ï¼Œå…¶å®ä¹Ÿæœ‰å¾ˆå¯¹å†…ç½®æ–¹æ³•èƒ½å¤Ÿå®Œæˆæ“ä½œï¼Œä¸ä»…æ›´åŠ ç›´è§‚ï¼Œè€Œä¸”éå¸¸æ˜“ç”¨ã€‚æ¯”å¦‚åˆ é™¤æ“ä½œï¼š&lt;code>Collection#removeIf()&lt;/code> &lt;code>Java 1.8+&lt;/code>ã€‚&lt;/p>
&lt;h3 id="foreach">ForEach&lt;/h3>
&lt;h4 id="entryset">EntrySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="nf">entrySet&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="keyset">KeySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">keySet&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">keySet&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="lambda">Lambda&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">AbstractMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;,&lt;/span> &lt;span class="n">Cloneable&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Serializable&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">forEach&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Biconsumer&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">action&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// key
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// value
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="stream">Stream&lt;/h3>
&lt;h4 id="steram">Steram&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">stream&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="parallelstream">parallelStream&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">parallelStream&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="interator">Interator&lt;/h3>
&lt;h4 id="entryset-1">EntrySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">iterator&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ ¹æ® Effective Java - 57ï¼Œæ›´æ¨èä»¥ä¸‹è¿™ç§å†™æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Iterator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">iterator&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="keyset-1">KeySet&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Iteator&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">iterator&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">keySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iterator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-ä¸€äº›æ“ä½œ">ğŸŒŸ ä¸€äº›æ“ä½œ&lt;/h2>
&lt;h3 id="åˆ¤ç©º">åˆ¤ç©º&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="err">ğŸ™‹â€â™‚ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">ğŸ™…â€â™‚ï¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">boolean&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è®¡æ•°--merge">è®¡æ•° / merge()&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">merge&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BiFunction&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">remappingFunction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">merge&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Integer&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="removeif">removeIf()&lt;/h3>
&lt;blockquote>
&lt;p>ğŸš§ æ³¨æ„ï¼š&lt;/p>
&lt;p>&lt;code>Map&lt;/code> æœ¬èº«æ˜¯æ²¡æœ‰ &lt;code>removeIf()&lt;/code>ã€‚&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">entry&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">keySet&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">values&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">removeIf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="o">{});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="absent">absent&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">putIfAbsent&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä¸å­˜åœ¨ key æ—¶ï¼ŒæŒ‰ mappingFunction æ·»åŠ  value
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å­˜åœ¨ key ä¸æ”¹å˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">computeIfAbsent&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Function&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">mappingFunction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="nf">computeIfPresent&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">BiFunction&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">K&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">super&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">remappingFunction&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="default">default&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">map&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getOrDefault&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="-å‚è€ƒ">ğŸ”— å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://mp.weixin.qq.com/s/zQBN3UvJDhRTKP6SzcZFKw" target="_blank" rel="noopener"
>https://mp.weixin.qq.com/s/zQBN3UvJDhRTKP6SzcZFKw&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Modularized Interaction Network for Named Entity Recognition</title><link>https://blog.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/</link><pubDate>Wed, 01 Sep 2021 21:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/</guid><description>&lt;img src="https://blog.letout.cn/imgs/9.jpeg" alt="Featured image of post Modularized Interaction Network for Named Entity Recognition" />&lt;p>ç°æœ‰NERæ¨¡å‹ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŸºäºåºåˆ—æ ‡æ³¨çš„NERæ¨¡å‹ï¼ˆThe sequence labeling-based NERmodelsï¼‰&lt;/p>
&lt;ul>
&lt;li>é•¿å®ä½“è¯†åˆ«ä¸ä½³ï¼Œåªå…³æ³¨è¯çº§ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>åŸºäºåˆ†æ®µçš„NERæ¨¡å‹ï¼ˆThe segment-based NERmodelsï¼‰&lt;/p>
&lt;ul>
&lt;li>å¤„ç†åˆ†æ®µï¼Œè€Œéå•ä¸ªè¯ï¼Œä¸èƒ½æ•è·åˆ†æ®µä¸­çš„è¯çº§ä¾èµ–å…³ç³»&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>è¾¹ç•Œæ£€æµ‹ï¼ˆboundary detectionï¼‰å’Œç±»å‹é¢„æµ‹ï¼ˆtype pre-dictionï¼‰å¯ä»¥ç›¸äº’é…åˆï¼Œä¸¤ä¸ªå­ä»»åŠ¡å¯å…±äº«ä¿¡æ¯ï¼Œç›¸äº’åŠ å¼ºã€‚&lt;/p>
&lt;p>æå‡ºæ¨¡å—åŒ–äº¤äº’ç½‘ç»œæ¨¡å‹MINï¼ˆModularized Interaction Networkï¼‰&lt;/p>
&lt;p>åˆ©ç”¨æ®µçº§ä¿¡æ¯å’Œè¯çº§ä¾èµ–å…³ç³»ï¼Œç»“åˆä¸€ç§äº¤äº’æœºåˆ¶ï¼Œæ”¯æŒè¾¹ç•Œæ£€æµ‹å’Œç±»å‹é¢„æµ‹ä¹‹é—´çš„ä¿¡æ¯å…±äº«ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/1.png"
width="493"
height="408"
srcset="https://blog.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/1_huf69a1b5e1975a497801b13aa3110264f_41598_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/1_huf69a1b5e1975a497801b13aa3110264f_41598_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="120"
data-flex-basis="290px"
>&lt;/p>
&lt;p>a recurrentneural network encoder-decoder framework with apointer network is used to detect entity segmentsfor segment information.&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/2.png"
width="790"
height="399"
srcset="https://blog.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/2_hu67c580ff6778a63552a8e24eeebbd582_54929_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/modularizedinteractionnetworkfornamed-entityrecognition/2_hu67c580ff6778a63552a8e24eeebbd582_54929_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="197"
data-flex-basis="475px"
>&lt;/p></description></item><item><title>A Sequence-to-Set Network for Nested Named Entity Recognition</title><link>https://blog.letout.cn/p/sequence-to-set/</link><pubDate>Mon, 07 Jun 2021 21:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/sequence-to-set/</guid><description>&lt;img src="https://blog.letout.cn/imgs/14.jpeg" alt="Featured image of post A Sequence-to-Set Network for Nested Named Entity Recognition" />&lt;p>å€Ÿé‰´å›¾åƒé¢†åŸŸçš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡ï¼Œå°†åµŒå¥—ä»»åŠ¡è½¬åŒ–æˆspançš„é¢„æµ‹ï¼Œè§£å†³åµŒå¥—å‘½åå®ä½“è¯†åˆ«ä»»åŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/sequence-to-set/model.png"
width="693"
height="366"
srcset="https://blog.letout.cn/p/sequence-to-set/model_hu04a3cb5aafa3b0d4955b742068e6104d_64624_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/sequence-to-set/model_hu04a3cb5aafa3b0d4955b742068e6104d_64624_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="model"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="454px"
>&lt;/p>
&lt;p>å…·ä½“æ˜¯é‡‡ç”¨ä¸¤é˜¶æ®µï¼š&lt;/p>
&lt;ul>
&lt;li>ç¬¬ä¸€æ­¥ Locateï¼Œå³å®šä½å®ä½“çš„è¾¹ç•Œ&lt;/li>
&lt;li>ç¬¬äºŒæ­¥ Labelï¼Œå³å¯¹è¯†åˆ«spanè¿›è¡Œå®ä½“ç±»å‹åˆ¤æ–­ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/sequence-to-set/1.png"
width="357"
height="52"
srcset="https://blog.letout.cn/p/sequence-to-set/1_huec6c826749de8343d0aee5d973132caa_9180_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/sequence-to-set/1_huec6c826749de8343d0aee5d973132caa_9180_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="1"
class="gallery-image"
data-flex-grow="686"
data-flex-basis="1647px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/sequence-to-set/2.png"
width="347"
height="320"
srcset="https://blog.letout.cn/p/sequence-to-set/2_hu4391112aaed5160844ed6f4005b28fce_42441_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/sequence-to-set/2_hu4391112aaed5160844ed6f4005b28fce_42441_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="2"
class="gallery-image"
data-flex-grow="108"
data-flex-basis="260px"
>&lt;/p></description></item><item><title>Named Entity Recognition As Dependency Parsing</title><link>https://blog.letout.cn/p/namedentityrecognitionasdependencyparsing/</link><pubDate>Tue, 01 Jun 2021 21:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/namedentityrecognitionasdependencyparsing/</guid><description>&lt;img src="https://blog.letout.cn/imgs/7.jpeg" alt="Featured image of post Named Entity Recognition As Dependency Parsing" />&lt;p>æ–‡ä¸­å°†æ¯ä¸ª token ç”¨ BERT å’Œ fastText è¿›è¡Œ embeddingï¼Œæ‹¼æ¥ä¸Šç”¨ CNN ç¼–ç çš„å­—ç¬¦çº§åˆ«å‘é‡ï¼Œé€å…¥ä¸€ä¸ªåŒå‘ LSTM ç¼–ç ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè·å¾—æ¯ä¸ªè¯çš„è¡¨è¾¾ã€‚ä¹‹åé‡‡ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„ FFNN æ¥å¾—åˆ°ä½œä¸ºå®ä½“å¼€å§‹å’Œç»“æŸçš„ä½ç½®çš„è¡¨è¾¾ã€‚&lt;/p>
&lt;p>æœ€åç”¨ä¸€ä¸ªä»¿å°„æ¨¡å‹å¾—åˆ°ä¸€ä¸ª $lÃ—lÃ—c$ çš„ tensorï¼Œå…¶ä¸­ l æ˜¯å¥å­é•¿åº¦ï¼Œc æ˜¯å®ä½“ç±»åˆ«æ•°é‡åŠ ä¸€ï¼ˆè¡¨ç¤ºæ— å®ä½“ï¼‰ã€‚è¿ç”¨è¯¥çŸ©é˜µï¼Œæ–‡ä¸­å¯¹äºåµŒå¥—å’ŒéåµŒå¥—é‡‡ç”¨äº†ä¸¤ç§ä¸åŒçš„ç­–ç•¥ï¼Œä»è€Œå¾—åˆ°äº†å®ä½“çš„èµ·æ­¢ä½ç½®ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/namedentityrecognitionasdependencyparsing/model.png"
width="500"
height="501"
srcset="https://blog.letout.cn/p/namedentityrecognitionasdependencyparsing/model_hue39a704d975d112c4ae2b387bb0aa5be_45180_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/namedentityrecognitionasdependencyparsing/model_hue39a704d975d112c4ae2b387bb0aa5be_45180_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="model"
class="gallery-image"
data-flex-grow="99"
data-flex-basis="239px"
>&lt;/p>
&lt;p>code: &lt;a class="link" href="https://github.com/juntaoy/biaffine-ner" target="_blank" rel="noopener"
>https://github.com/juntaoy/biaffine-ner&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/namedentityrecognitionasdependencyparsing/ner.png"
width="325"
height="669"
srcset="https://blog.letout.cn/p/namedentityrecognitionasdependencyparsing/ner_huff0969dccbb13cbf7d246862faeafc4d_75035_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/namedentityrecognitionasdependencyparsing/ner_huff0969dccbb13cbf7d246862faeafc4d_75035_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="ner"
class="gallery-image"
data-flex-grow="48"
data-flex-basis="116px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/namedentityrecognitionasdependencyparsing/nested.png"
width="323"
height="618"
srcset="https://blog.letout.cn/p/namedentityrecognitionasdependencyparsing/nested_hu30723d7bae4f05520cc9500a93ac4824_73991_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/namedentityrecognitionasdependencyparsing/nested_hu30723d7bae4f05520cc9500a93ac4824_73991_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="nested"
class="gallery-image"
data-flex-grow="52"
data-flex-basis="125px"
>&lt;/p></description></item><item><title>PyTorch ç«é€Ÿä¸Šæ‰‹</title><link>https://blog.letout.cn/p/pytorch-handbook/</link><pubDate>Thu, 01 Apr 2021 21:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/pytorch-handbook/</guid><description>&lt;img src="https://blog.letout.cn/imgs/10.jpeg" alt="Featured image of post PyTorch ç«é€Ÿä¸Šæ‰‹" />&lt;h2 id="pytorch-æ˜¯ä»€ä¹ˆ">PyTorch æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2>
&lt;p>åŸºäº Python çš„ç§‘å­¦è®¡ç®—åŒ…ï¼ŒæœåŠ¡äºä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼š&lt;/p>
&lt;ul>
&lt;li>Numpy çš„æ›¿ä»£å“ï¼Œå¯ä»¥ä½¿ç”¨ GPU çš„å¼ºå¤§è®¡ç®—åŠ›&lt;/li>
&lt;li>æä¾›æœ€å¤§çš„çµæ´»æ€§å’Œé«˜é€Ÿçš„æ·±åº¦å­¦ä¹ ç ”ç©¶å¹³å°&lt;/li>
&lt;/ul>
&lt;h2 id="tensors">Tensors&lt;/h2>
&lt;p>Tensors ä¸ Numpy ä¸­çš„ ndarrays ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ PyTorch ä¸­ Tensors å¯ä»¥ä½¿ç”¨ GPU è¿›è¡Œè®¡ç®—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">__future__&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">print_function&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 1 ] åˆ›å»ºä¸€ä¸ª 5x3 çš„çŸ©é˜µï¼Œä½†ä¸åˆå§‹åŒ–ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">empty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.0000, 0.0000, 0.0000]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 2 ] åˆ›å»ºä¸€ä¸ªéšæœºåˆå§‹åŒ–çš„çŸ©ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[0.6972, 0.0231, 0.3087],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.2083, 0.6141, 0.6896],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.7228, 0.9715, 0.5304],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.7727, 0.1621, 0.9777],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0.6526, 0.6170, 0.2605]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 3 ] åˆ›å»ºä¸€ä¸ª 0 å¡«å……çš„çŸ©é˜µï¼Œæ•°æ®ç±»å‹ä¸º longï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">long&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 0, 0]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 4 ] åˆ›å»ºä¸€ä¸ª tensor ä½¿ç”¨ç°æœ‰æ•°æ®åˆå§‹åŒ–ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="mf">5.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([5.5000, 3.0000])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 5 ] æ ¹æ®ç°æœ‰çš„ tensor åˆ›å»º tensorã€‚è¿™äº›æ–¹æ³•å°†é‡ç”¨è¾“å…¥ tensor çš„å±æ€§ï¼ˆå¦‚ï¼šdtypeï¼Œé™¤éè®¾ç½®æ–°çš„å€¼è¿›è¡Œè¦†ç›–ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ©ç”¨ new_* æ–¹æ³•åˆ›å»ºå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">new_ones&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">double&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1., 1., 1.]], dtype=torch.float64)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¦†ç›– dtype&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯¹è±¡ size ç›¸åŒï¼Œåªæ˜¯ å€¼å’Œç±»å‹ å‘ç”Ÿå˜åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.5691, -2.0126, -0.4064],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0863, 0.4692, -1.1209],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-1.1177, -0.5764, -0.5363],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.4390, 0.6688, 0.0889],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.3334, -1.1600, 1.8457]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 6 ] è·å– sizeï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># torch.Size([5, 3])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>&lt;code>torch.Size&lt;/code> è¿”å› &lt;code>tuple&lt;/code> ç±»å‹ï¼Œæ”¯æŒ &lt;code>tuple&lt;/code> ç±»å‹æ‰€æœ‰çš„æ“ä½œã€‚&lt;/p>
&lt;/blockquote>
&lt;p>[ 7 ] æ“ä½œ&lt;/p>
&lt;p>[ 7.1 ] åŠ æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æä¾›è¾“å‡º tensor ä½œä¸ºå‚æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">empty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">out&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 7.2 ] æ›¿æ¢ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># add x to y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.7808, -1.4388, 0.3151],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.0076, 1.0716, -0.8465],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [-0.8175, 0.3625, -0.2005],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0.2435, 0.8512, 0.7142],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 1.4737, -0.8545, 2.4833]])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>{% note info %}
&lt;code>_&lt;/code> ç»“å°¾çš„æ“ä½œä¼šæ›¿æ¢åŸå˜é‡ã€‚
å¦‚ï¼š&lt;code>x_copy_(y)&lt;/code>ï¼Œ&lt;code>x.t_()&lt;/code> ä¼šæ”¹å˜ &lt;code>x&lt;/code>
{% endnote %}&lt;/p>
&lt;p>[ 7.3 ] ä½¿ç”¨ Numpy ä¸­ç´¢å¼•æ–¹å¼ï¼Œå¯¹ tensor è¿›è¡Œæ“ä½œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">[:,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([-2.0126, 0.4692, -0.5764, 0.6688, -1.1600])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 8 ] &lt;code>torch.view&lt;/code> æ”¹å˜ tensor çš„ç»´åº¦å’Œå¤§å° ï¼ˆä¸ Numpy ä¸­ reshape ç±»ä¼¼ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">z&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># -1 ä»å…¶ä»–ç»´åº¦æ¨æ–­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">z&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># torch.Size([4, 4]) torch.Size([16]) torch.Size([2, 8])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 9 ] å¦‚æœåªæœ‰ä¸€ä¸ªå…ƒç´ çš„ tensorï¼Œä½¿ç”¨ &lt;code>item()&lt;/code> è·å– Python æ•°æ®ç±»å‹çš„æ•°å€¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([-0.2368])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -0.23680149018764496&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="numpy-è½¬æ¢">Numpy è½¬æ¢&lt;/h3>
&lt;p>Torch Tensor ä¸ Numpy æ•°ç»„ä¹‹é—´è¿›è¡Œè½¬æ¢éå¸¸è½»æ¾ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ones&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">numpy&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([1., 1., 1., 1., 1.])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># [1. 1. 1. 1. 1.]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Torch Tensor ä¸ Numpy æ•°ç»„å…±äº«åº•å±‚å†…å­˜åœ°å€ï¼Œä¿®æ”¹ä¸€ä¸ªä¼šå¯¼è‡´å¦ä¸€ä¸ªçš„å˜åŒ–ã€‚&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([2., 2., 2., 2., 2.])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># [2. 2. 2. 2. 2.]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">numpy&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">np&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ones&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_numpy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">out&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># [2. 2. 2. 2. 2.]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([2., 2., 2., 2., 2.], dtype=torch.float64)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>æ‰€æœ‰çš„ Tensor ç±»å‹é»˜è®¤éƒ½æ˜¯åŸºäº CPUï¼Œ CharTensor ç±»å‹ä¸æ”¯æŒåˆ° Numpy çš„è£…æ¢ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="cuda-å¼ é‡">CUDA å¼ é‡&lt;/h3>
&lt;p>ä½¿ç”¨ &lt;code>.to()&lt;/code> å¯ä»¥å°† Tensor ç§»åŠ¨åˆ°ä»»ä½•è®¾å¤‡ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cuda&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">is_available&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">device&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cuda&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># CUDA è®¾å¤‡å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ones_like&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># ç›´æ¥ä» GPU åˆ›å»ºå¼ é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">z&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># tensor([0.7632], device=&amp;#39;cuda:0&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">z&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cpu&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">double&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># tensor([0.7632], dtype=torch.float64)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="autograd-è‡ªåŠ¨æ±‚å¯¼">Autograd è‡ªåŠ¨æ±‚å¯¼&lt;/h2>
&lt;p>autograd åŒ…ä¸º Tensor ä¸Šæ‰€æœ‰çš„æ“ä½œæä¾›äº†è‡ªåŠ¨æ±‚å¯¼ã€‚å®ƒæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å®šä¹‰çš„æ¡†æ¶ï¼Œè¿™æ„å‘³ç€åå‘ä¼ æ’­æ˜¯æ ¹æ®ä½ çš„ä»£ç æ¥ç¡®å®šå¦‚ä½•è¿è¡Œï¼Œå¹¶ä¸”æ¯æ¬¡è¿­ä»£å¯ä»¥æ˜¯ä¸åŒçš„ã€‚&lt;/p>
&lt;h3 id="æ­£å‘ä¼ æ’­-åå‘ä¼ æ’­">æ­£å‘ä¼ æ’­ åå‘ä¼ æ’­&lt;/h3>
&lt;p>ç¥ç»ç½‘ç»œï¼ˆNNï¼‰æ˜¯åœ¨æŸäº›è¾“å…¥æ•°æ®ä¸Šæ‰§è¡ŒåµŒå¥—å‡½æ•°çš„é›†åˆã€‚
è¿™äº›å‡½æ•°ç”±å‚æ•°ï¼ˆæƒé‡å’Œåå·®ç»„æˆï¼‰å®šä¹‰ï¼Œå‚æ•°åœ¨ PyTorch ä¸­å­˜å‚¨åœ¨å¼ é‡ä¸­ã€‚&lt;/p>
&lt;p>è®­ç»ƒ NN åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>æ­£å‘ä¼ æ’­ï¼šåœ¨æ­£å‘ä¼ æ’­ä¸­ï¼ŒNN å¯¹æ­£ç¡®çš„è¾“å‡ºè¿›è¡Œæœ€ä½³çŒœæµ‹ã€‚å®ƒé€šè¿‡æ¯ä¸ªå‡½æ•°è¿è¡Œè¾“å…¥æ•°æ®ä»¥è¿›è¡ŒçŒœæµ‹ã€‚&lt;/li>
&lt;li>åå‘ä¼ æ’­ï¼šåœ¨åå‘ä¼ æ’­ä¸­ï¼ŒNN æ ¹æ®å…¶çŒœæµ‹ä¸­çš„è¯¯å·®è°ƒæ•´å…¶å‚æ•°ã€‚å®ƒé€šè¿‡ä»è¾“å‡ºå‘åéå†ï¼Œæ”¶é›†æœ‰å…³å‚æ•°ï¼ˆæ¢¯åº¦ï¼‰çš„è¯¯å·®å¯¼æ•°å¹¶ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ¥ä¼˜åŒ–å‚æ•°æ¥å®ç°ã€‚&lt;/li>
&lt;/ul>
&lt;p>[ 1 ] æˆ‘ä»¬ä» torchvision åŠ è½½äº†ç»è¿‡é¢„è®­ç»ƒçš„ resnet18 æ¨¡å‹ã€‚åˆ›å»ºä¸€ä¸ªéšæœºæ•°æ®å¼ é‡æ¥è¡¨ç¤ºå…·æœ‰ 3 ä¸ªé€šé“çš„å•ä¸ªå›¾åƒï¼Œé«˜åº¦å’Œå®½åº¦ä¸º 64ï¼Œå…¶å¯¹åº”çš„labelåˆå§‹åŒ–ä¸ºä¸€äº›éšæœºå€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="nn">torchvision&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torchvision&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">resnet18&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pretrained&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 2 ] æ¥ä¸‹æ¥ï¼Œé€šè¿‡æ¨¡å‹çš„æ¯ä¸€å±‚è¿è¡Œè¾“å…¥æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚&lt;strong>æ­£å‘ä¼ æ’­&lt;/strong>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">prediction&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 3 ] ä½¿ç”¨æ¨¡å‹çš„é¢„æµ‹ï¼ˆpredicationï¼‰å’Œç›¸åº”çš„æ ‡ç­¾ï¼ˆlabelsï¼‰æ¥è®¡ç®—è¯¯å·®ï¼ˆlossï¼‰ã€‚
ä¸‹ä¸€æ­¥é€šè¿‡åå‘ä¼ æ’­æ­¤è¯¯å·®ã€‚æˆ‘ä»¬åœ¨ loss tensor ä¸Šè°ƒç”¨ &lt;code>.backward()&lt;/code> æ—¶ï¼Œå¼€å§‹åå‘ä¼ æ’­ã€‚Autograd ä¼šä¸ºæ¯ä¸ªæ¨¡å‹å‚æ•°è®¡ç®—æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å‚æ•° &lt;code>.grad&lt;/code> å±æ€§ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">prediction&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backword&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># backword pass&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 4 ] æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ è½½ä¸€ä¸ªä¼˜åŒ–å™¨ï¼ˆSDGï¼‰ï¼Œå­¦ä¹ ç‡ä¸º 0.01ï¼ŒåŠ¨é‡ä¸º 0.9ã€‚åœ¨ optim ä¸­æ³¨å†Œæ¨¡å‹çš„æ‰€æœ‰å‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">optim&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SDG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">1e-2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">momentum&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>[ 5 ] æœ€åï¼Œè°ƒç”¨ &lt;code>.step()&lt;/code> å¯åŠ¨æ¢¯åº¦ä¸‹é™ã€‚ä¼˜åŒ–å™¨é€šè¿‡ &lt;code>.grad&lt;/code> ä¸­å­˜å‚¨çš„æ¢¯åº¦æ¥è°ƒæ•´æ¯ä¸ªå‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># gradient descent&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç¥ç»ç½‘ç»œçš„å¾®åˆ†">ç¥ç»ç½‘ç»œçš„å¾®åˆ†&lt;/h3>
&lt;p>è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ autograd å¦‚ä½•æ”¶é›†æ¢¯åº¦ã€‚
æˆ‘ä»¬åœ¨åˆ›å»º Tensor æ—¶ï¼Œä½¿ç”¨ &lt;code>requires_grad=True&lt;/code> å‚æ•°ï¼Œè¡¨ç¤ºå°†è·Ÿè¸ª Tensor çš„æ‰€æœ‰æ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="mf">2.&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">3.&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">require_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="mf">6.&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">4.&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">require_grad&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä» tensor a, b åˆ›å»ºå¦ä¸€ä¸ª tensor Q&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Q&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">3&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å‡è®¾ tensor aï¼Œb æ˜¯ç¥ç»ç½‘ç»œçš„å‚æ•°ï¼Œtensor Q æ˜¯è¯¯å·®ã€‚åœ¨ NN è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬æƒ³è¦è·å¾—ç›¸å¯¹äºå‚æ•°çš„è¯¯å·®ï¼Œå³å„è‡ªå¯¹åº”çš„åå¯¼ï¼š&lt;/p>
&lt;p>$$\frac{\partial Q}{\partial a}=9a^2$$&lt;/p>
&lt;p>å½“æˆ‘ä»¬åœ¨ tensor Q ä¸Šè°ƒç”¨ &lt;code>.backward()&lt;/code> æ—¶ï¼ŒAutograd å°†è®¡ç®—è¿™äº›æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å„ä¸ªå¼ é‡çš„ &lt;code>.grad&lt;/code> å±æ€§ä¸­ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬éœ€è¦åœ¨ &lt;code>Q.backword()&lt;/code> ä¸­æ˜¾å¼ä¼ é€’ &lt;code>gradient&lt;/code> å‚æ•°ï¼ˆä¸ Q å½¢çŠ¶ç›¸åŒçš„å¼ é‡ï¼Œè¡¨ç¤º Q ç›¸å¯¹æœ¬èº«çš„æ¢¯åº¦ï¼‰ã€‚&lt;/p>
&lt;p>$$\frac{\partial Q}{\partial b}=-2b$$&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">external_grad&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tensor&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="mf">1.&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">1.&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Q&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gradient&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">external_grad&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æœ€åï¼Œæ¢¯åº¦è®°å½•åœ¨ a.grad b.grad ä¸­ï¼ŒæŸ¥çœ‹æ”¶é›†çš„æ¢¯åº¦æ˜¯å¦æ­£ç¡®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([True, True])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">b&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([True, True])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°† Q èšåˆä¸ºä¸€ä¸ªæ ‡é‡ï¼Œç„¶åéšå¼åœ°å‘åè°ƒç”¨ï¼Œå¦‚ï¼š&lt;code>Q.sum().backward()&lt;/code>ã€‚&lt;/p>
&lt;h2 id="ç¥ç»ç½‘ç»œ">ç¥ç»ç½‘ç»œ&lt;/h2>
&lt;p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬äº†è§£åˆ° nn åŒ…ä¾èµ– autograd åŒ…æ¥å®šä¹‰æ¨¡å‹å¹¶æ±‚å¯¼ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•å®šä¹‰ä¸€ä¸ªç½‘ç»œã€‚ä¸€ä¸ª nn.Module åŒ…å«ä¸ª layer å’Œä¸€ä¸ª forward(input) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å› outputã€‚&lt;/p>
&lt;p>å¦‚ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹æ‰‹å†™æ•°å­—å›¾åƒè¿›è¡Œåˆ†ç±»çš„å·ç§¯ç¥ç»ç½‘ç»œï¼š&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/pytorch-handbook/CNN.png"
width="759"
height="209"
srcset="https://blog.letout.cn/p/pytorch-handbook/CNN_hufa4266fb90da2cc9816f33e05e560204_9416_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/pytorch-handbook/CNN_hufa4266fb90da2cc9816f33e05e560204_9416_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="CNN"
class="gallery-image"
data-flex-grow="363"
data-flex-basis="871px"
>&lt;/p>
&lt;p>ç¥ç»ç½‘ç»œçš„å…¸å‹è®­ç»ƒè¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>å®šä¹‰åŒ…å«ä¸€äº›å¯å­¦ä¹ çš„å‚æ•°ï¼ˆæƒé‡ï¼‰ç¥ç»ç½‘ç»œæ¨¡å‹&lt;/li>
&lt;li>åœ¨æ•°æ®é›†ä¸Šè¿­ä»£&lt;/li>
&lt;li>é€šè¿‡ç¥ç»ç½‘ç»œå¤„ç†è¾“å…¥&lt;/li>
&lt;li>è®¡ç®—æŸå¤±ï¼ˆè¾“å‡ºç»“æœå’Œæ­£ç¡®å€¼çš„å·®å€¼å¤§å°ï¼‰&lt;/li>
&lt;li>å°†æ¢¯åº¦åå‘ä¼ æ’­å›ç½‘ç»œçš„å‚æ•°&lt;/li>
&lt;li>æ›´æ–°ç½‘ç»œçš„å‚æ•°ï¼ˆæ¢¯åº¦ä¸‹é™ï¼‰ï¼šweight = weight - learning_rate * gradient&lt;/li>
&lt;/ul>
&lt;h3 id="å®šä¹‰ç½‘ç»œ">å®šä¹‰ç½‘ç»œ&lt;/h3>
&lt;p>åœ¨æ¨¡å‹ä¸­å¿…é¡»å®šä¹‰ &lt;code>forward()&lt;/code>ï¼Œ &lt;code>backword&lt;/code>ï¼ˆç”¨æ¥è®¡ç®—æ¢¯åº¦ï¼‰ä¼šè¢« autograd è‡ªåŠ¨åˆ›å»ºã€‚å¯åœ¨ &lt;code>forward()&lt;/code> ä¸­ä½¿ç”¨ä»»ä½•é’ˆå¯¹ Tensor çš„æ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">nn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn.functional&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">F&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Model&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 1 input image channel, 6 output channels, 3x3 square convolution&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># kernel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv_1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv_2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># an affine operation: y = Wx + b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">16&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">6&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">120&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">120&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">84&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">84&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Max Pooling over a (2, 2) window&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max_pool2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># If the size is a square you can only specify a single number&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max_pool2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">num_flat_features&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">x&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">num_flat_features&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sefl&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">]&lt;/span> &lt;span class="c1"># all dimensions except the batch dimension&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num_features&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num_features&lt;/span> &lt;span class="o">*=&lt;/span> &lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">num_features&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Net&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Net(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (conv1): Conv2d(1, 6, kernel_size=(3, 3), stride=(1, 1))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (conv2): Conv2d(6, 16, kernel_size=(3, 3), stride=(1, 1))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (fc1): Linear(in_features=576, out_features=120, bias=True)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (fc2): Linear(in_features=120, out_features=84, bias=True)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (fc3): Linear(in_features=84, out_features=10, bias=True)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># )&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>parameters()&lt;/code> è¿”å›å¯è¢«å­¦ä¹ çš„å‚æ•°ï¼ˆæƒé‡ï¼‰åˆ—è¡¨å’Œå€¼&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">params&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1"># conv1 çš„ weight torch.Size([6, 1, 3, 3])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æµ‹è¯•éšæœºè¾“å…¥ 32x32ã€‚æ³¨ï¼šè¿™ä¸ªç½‘ç»œï¼ˆLeNetï¼‰çš„æœŸæœ›çš„è¾“å…¥å¤§å°æ˜¯ 32x32ï¼Œå¦‚æœä½¿ç”¨ MINIST æ•°æ®é›†æ¥è®­ç»ƒè¿™ä¸ªç½‘ç»œï¼Œè¯·æŠŠå›¾ç‰‡å¤§å°é‡æ–°è°ƒæ•´åˆ° 32x32ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">input&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">32&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">out&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tensor([[ 0.1120, 0.0713, 0.1014, -0.0696, -0.1210, 0.0084, -0.0206, 0.1366,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -0.0455, -0.0036]], grad_fn=&amp;lt;AddmmBackward&amp;gt;)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å°†æ‰€æœ‰çš„å‚æ•°çš„æ¢¯åº¦ç¼“å­˜æ¸…é›¶ï¼Œè¿›è¡Œéšæœºæ¢¯åº¦çš„åå‘ä¼ æ’­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>&lt;code>torch.nn&lt;/code> ä»…æ”¯æŒå°æ‰¹é‡è¾“å…¥ã€‚æ•´ä¸ª &lt;code>torch.nn&lt;/code> åŒ…éƒ½åªæ”¯æŒå°æ‰¹é‡æ ·æœ¬ï¼Œè€Œä¸æ”¯æŒå•ä¸ªæ ·æœ¬ã€‚
å¦‚ï¼š&lt;code>nn.Conv2d&lt;/code>æ¥å—ä¸€ä¸ª4ç»´ Tensorï¼Œåˆ†åˆ«ç»´ sSamples * nChannels * Height * Width ï¼ˆæ ·æœ¬æ•°* é€šé“æ•° * é«˜ * å®½ï¼‰ã€‚å¦‚æœä½ æœ‰å•ä¸ªæ ·æœ¬ï¼Œåªéœ€è¦ä½¿ç”¨ &lt;code>input.unsqueeze(0)&lt;/code> æ¥æ·»åŠ å…¶ä»–çš„ç»´æ•°ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº†å¦‚ä½•æ„å»ºä¸€ä¸ªç½‘ç»œï¼Œå›é¡¾ä¸€ä¸‹åˆ°ç›®å‰ä¸ºæ­¢ä½¿ç”¨åˆ°çš„ç±»ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>torch.Tensor&lt;/code>ï¼š ä¸€ä¸ªå¤šç»´æ•°ç»„ã€‚ æ”¯æŒä½¿ç”¨ backward() è¿›è¡Œè‡ªåŠ¨æ¢¯åº¦è®¡ç®—ï¼Œå¹¶ä¿å­˜å…³äºè¿™ä¸ªå‘é‡çš„æ¢¯åº¦ w.r.t.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>nn.Model&lt;/code>ï¼š ç¥ç»ç½‘ç»œæ¨¡å—ã€‚å®ç°å°è£…å‚æ•°ã€ç§»åŠ¨åˆ° GPU ä¸Šè¿è¡Œã€å¯¼å‡ºã€åŠ è½½ç­‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>nn.Parameter&lt;/code>ï¼š ä¸€ç§å¼ é‡ã€‚å°†å…¶åˆ†é…ä¸º Model çš„å±æ€§æ—¶ï¼Œè‡ªåŠ¨æ³¨å†Œä¸ºå‚æ•°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>autograd.Function&lt;/code>ï¼š å®ç°ä¸€ä¸ªè‡ªåŠ¨æ±‚å¯¼æ“ä½œçš„å‰å‘å’Œåå‘å®šä¹‰ã€‚æ¯ä¸ª Tensor æ“ä½œéƒ½ä¼šåˆ›å»ºè‡³å°‘ä¸€ä¸ª Function èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹è¿æ¥åˆ°åˆ›å»º Tensor çš„å‡½æ•°ï¼Œå¹¶ç¼–ç å…¶å†å²è®°å½•ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æŸå¤±å‡½æ•°">æŸå¤±å‡½æ•°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">target&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># ä¾‹å­ï¼šä¸€ä¸ªå‡è®¾çš„ç»“æœ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">target&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">target&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># è®© target ä¸ output çš„å½¢çŠ¶ç›¸åŒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">criterion&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MSELoss&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">criterion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">target&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">loss&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åå‘ä¼ æ’­">åå‘ä¼ æ’­&lt;/h3>
&lt;p>è¦å®ç°åå‘ä¼ æ’­è¯¯å·®ï¼Œåªéœ€è¦ &lt;code>loss.backward()&lt;/code>ã€‚
ä½†æ˜¯ï¼Œéœ€è¦æ¸…é™¤ç°æœ‰çš„æ¢¯åº¦ï¼Œå¦åˆ™æ¢¯åº¦å°†ç´¯ç§¯åˆ°ç°æœ‰çš„æ¢¯åº¦ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># å°†æ‰€æœ‰çš„æ¢¯åº¦ç¼“å†²å½’é›¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bias&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># conv1.bias.grad åå‘ä¼ æ’­å‰ tensor([0., 0., 0., 0., 0., 0.])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bias&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grad&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># åå‘ä¼ æ’­å tensor([0.0111, -0.0064, 0.0053, -0.0047, 0.0026, -0.0153])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ›´æ–°æƒé‡">æ›´æ–°æƒé‡&lt;/h3>
&lt;p>åœ¨ä½¿ç”¨ PyTorch æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>torch.optim&lt;/code> ä¸­æä¾›çš„æ–¹æ³•è¿›è¡Œæ¢¯åº¦ä¸‹é™ã€‚å¦‚ï¼šSDGï¼ŒNesterov-SDGï¼ŒAdamï¼ŒRMSprop ç­‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.optim&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">optim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºä¸€ä¸ª optimizer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SDG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.01&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨è®­ç»ƒä¸­å¾ªç¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># å°†æ¢¯åº¦ç¼“å†²åŒºæ¸…é›¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">criterion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">target&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loass&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backword&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># æ›´æ–°&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è®­ç»ƒåˆ†ç±»å™¨">è®­ç»ƒåˆ†ç±»å™¨&lt;/h2>
&lt;h3 id="æ•°æ®ä»å“ªé‡Œæ¥">æ•°æ®ä»å“ªé‡Œæ¥ï¼Ÿ&lt;/h3>
&lt;p>é€šå¸¸ï¼Œéœ€è¦å¤„ç†å›¾åƒã€æ–‡æœ¬ã€éŸ³é¢‘æˆ–è§†é¢‘æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å°†æ•°æ®åŠ è½½åˆ° NumPy æ•°ç»„ä¸­çš„æ ‡å‡† Python åŒ…ï¼Œå†å°†è¯¥æ•°å€¼è½¬æ¢ä¸º &lt;code>torch.*Tensor&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>å¤„ç†å›¾åƒï¼Œå¯ä»¥ä½¿ç”¨ Pillowï¼ŒOpenCV&lt;/li>
&lt;li>å¤„ç†éŸ³é¢‘ï¼Œå¯ä»¥ä½¿ç”¨ SciPyï¼Œlibrosa&lt;/li>
&lt;li>å¤„ç†æ–‡æœ¬ï¼Œå¯åŸºäº Python æˆ– Cython çš„åŸå§‹åŠ è½½ï¼Œæˆ– NLTK å’Œ SpaCy&lt;/li>
&lt;/ul>
&lt;p>å¯¹äºå›¾åƒä»»åŠ¡ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ª &lt;code>torchvision&lt;/code> çš„åŒ…ï¼Œå«æœ‰å¸¸è§çš„æ•°æ®é›†ï¼ˆImagenetï¼ŒCIFAR10ï¼ŒMNISTç­‰ï¼‰çš„æ•°æ®åŠ è½½å™¨ï¼Œä»¥åŠç”¨äºå›¾åƒçš„æ•°æ®è½¬æ¢å™¨ï¼ˆtorchvision.datasets å’Œ torch.utils.data.DataLoaderï¼‰ã€‚&lt;/p>
&lt;p>åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œå°†ä½¿ç”¨ CIFAR10 æ•°æ®é›†ã€‚å…¶ä¸­åŒ…å« 10 åˆ†ç±»çš„å›¾åƒï¼šâ€œé£æœºâ€ï¼Œâ€œæ±½è½¦â€ï¼Œâ€œé¸Ÿâ€ï¼Œâ€œçŒ«â€ï¼Œâ€œé¹¿â€ï¼Œâ€œç‹—â€ï¼Œâ€œé’è›™â€ï¼Œâ€œé©¬â€ï¼Œâ€œèˆ¹â€ï¼Œâ€œå¡è½¦â€ã€‚å›¾åƒçš„å°ºå¯¸ä¸º 3 * 32 * 32ï¼Œå³å°ºå¯¸ä¸º 32 * 32 åƒç´ çš„ 3 é€šé“å½©è‰²å›¾åƒã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/pytorch-handbook/CIFAR-10.png"
width="472"
height="369"
srcset="https://blog.letout.cn/p/pytorch-handbook/CIFAR-10_hubd3e6b51c00827c9a17b1eaa7622a23e_30944_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/pytorch-handbook/CIFAR-10_hubd3e6b51c00827c9a17b1eaa7622a23e_30944_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="CIFAR-10"
class="gallery-image"
data-flex-grow="127"
data-flex-basis="306px"
>&lt;/p>
&lt;p>æ¥ä¸‹æ¥ï¼Œä½œä¸ºæ¼”ç¤ºï¼Œå°†æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ­¥éª¤è®­ç»ƒå›¾åƒåˆ†ç±»å™¨ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;code>torchvision&lt;/code> åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10 è®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†&lt;/li>
&lt;li>å®šä¹‰ CNN&lt;/li>
&lt;li>å®šä¹‰æŸå¤±å‡½æ•°&lt;/li>
&lt;li>æ ¹æ®è®­ç»ƒæ•°æ®è®­ç»ƒç½‘ç»œ&lt;/li>
&lt;li>åœ¨æµ‹è¯•æ•°æ®ä¸Šæµ‹è¯•ç½‘ç»œ&lt;/li>
&lt;/ul>
&lt;h3 id="åŠ è½½å¹¶æ ‡å‡†åŒ–-cifar10">åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torchvision&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torchvision.transforms&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">transforms&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>torchvision çš„è¾“å‡ºæ˜¯ [0, 1] çš„ PILImage å›¾åƒï¼Œæˆ‘ä»¬è¦æŠŠå®ƒè½¬æ¢ä¸ºå½’ä¸€åŒ–èŒƒå›´ä¸º [-1, 1] çš„å¼ é‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">transform&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">transforms&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Compose&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="n">transforms&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ToTensor&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">transforms&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Normalize&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="p">))]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">trainset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torchvision&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">datasets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CIFAR10&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;./data&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">download&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">transform&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">transform&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">trainloader&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataLoader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">trainset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">batch_size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shuffle&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_workers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">testset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">trochvision&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">datasets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CIFAR10&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;./data&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">train&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">download&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">transform&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">transform&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">testloader&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataLoader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">testset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">barch_size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shuffle&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num_workers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">classes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;plane&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;car&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;bird&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;cat&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;deer&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;dog&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;frog&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;horse&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ship&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;truck&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®šä¹‰-cnn">å®šä¹‰ CNN&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">nn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.nn.functional&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">F&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Module&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Net&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># in_channels, out_channels, kernel_size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è¾“å…¥çš„ä¸º 3 é€šé“å›¾åƒï¼Œæå– 6 ä¸ªç‰¹å¾ï¼Œå¾—åˆ° 6 ä¸ª feature mapï¼Œå·ç§¯æ ¸ä¸ºä¸€ä¸ª 5*5 çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MaxPool2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Conv2d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å·ç§¯å±‚è¾“å‡ºäº† 16 ä¸ª feature mapï¼Œæ¯ä¸ª feature map æ˜¯ 6*6 çš„äºŒç»´æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">16&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">120&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Linear&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">120&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">84&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">84&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">forward&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pool&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pool&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conv2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">F&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">relu&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fc3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">x&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">net&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨">å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨&lt;/h3>
&lt;p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº¤å‰ç†µä½œä¸ºæŸå¤±å‡½æ•°ï¼Œä½¿ç”¨å¸¦åŠ¨é‡çš„éšæœºæ¢¯åº¦ä¸‹é™ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">torch.optim&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">optim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">criterion&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CrossEntropyLoss&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">optimizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">optim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SDG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parameters&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.001&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">momentum&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.9&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è®­ç»ƒç½‘ç»œ">è®­ç»ƒç½‘ç»œ&lt;/h3>
&lt;p>æ¥ä¸‹æ¥ï¼Œåªéœ€è¦åœ¨è¿­ä»£æ•°æ®ï¼Œå°†æ•°æ®è¾“å…¥ç½‘ç»œä¸­å¹¶ä¼˜åŒ–ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">epoch&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">enumerate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">trainloader&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="c1"># è·å–è¾“å…¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># å°†æ¢¯åº¦ç¼“å†²åŒºæ¸…é›¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">inputs&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># æ­£å‘ä¼ æ’­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">criterion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lables&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># åå‘ä¼ æ’­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># ä¼˜åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">2000&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1999&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="c1"># æ¯ 2000 æ‰¹æ¬¡æ‰“å°ä¸€æ¬¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;[]&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">epoch&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="mi">2000&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">running_loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ•°æ®">åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ•°æ®&lt;/h3>
&lt;p>åœ¨ä¸Šé¢çš„è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬è®­ç»ƒäº† 2 æ¬¡ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦æ£€æµ‹ç½‘ç»œæ˜¯å¦ä»æ•°æ®é›†ä¸­å­¦ä¹ åˆ°äº†æœ‰ç”¨çš„ä¸œè¥¿ã€‚é€šè¿‡é¢„æµ‹ç¥ç»ç½‘ç»œè¾“å‡ºçš„ç±»åˆ«æ ‡ç­¾ä¸å®é™…æƒ…å†µæ ‡ç­¾å¯¹æ¯”è¿›è¡Œæ£€æµ‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">corrent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">total&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">no_grad&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">testloader&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">images&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lobels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">images&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">predicted&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">outputs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">total&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">corrent&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">predicted&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Accuracy of the network on the 10000 test images: &lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1"> &lt;/span>&lt;span class="si">%%&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">corrent&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of the network on the 10000 test images: 9%&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨è®­ç»ƒä¸¤æ¬¡çš„ç½‘ç»œä¸­ï¼Œéšæœºé€‰æ‹©çš„æ­£ç¡®ç‡ä¸º 10%ã€‚ç½‘ç»œä¼¼ä¹å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ã€‚&lt;/p>
&lt;p>é‚£è¿™ä¸ªç½‘ç»œï¼Œè¯†åˆ«å“ªä¸€ç±»å¥½ï¼Œå“ªä¸€ç±»ä¸å¥½å‘¢ï¼Ÿ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">class_corrent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">class_total&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">no_grad&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">testloader&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">images&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">images&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">predicted&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">outputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">predicted&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">squeeze&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">label&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">labels&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">class_correct&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">label&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">class_total&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">label&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Accuracy of &lt;/span>&lt;span class="si">%5s&lt;/span>&lt;span class="s1"> : &lt;/span>&lt;span class="si">%2d&lt;/span>&lt;span class="s1"> &lt;/span>&lt;span class="si">%%&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">classes&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">class_correct&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">class_total&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of plane : 99 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of car : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of bird : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of cat : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of deer : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of dog : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of frog : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of horse : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of ship : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accuracy of truck : 0 %&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ä½¿ç”¨-gpu">ä½¿ç”¨ GPU&lt;/h2>
&lt;p>ä¸å°† tensor ç§»åˆ° GPU ä¸Šä¸€æ ·ï¼Œç¥ç»ç½‘ç»œä¹Ÿå¯ä»¥ç§»åŠ¨åˆ° GPU ä¸Šã€‚
å¦‚æœå¯ä»¥ä½¿ç”¨ CUDAï¼Œå°†è®¾å¤‡å®šä¹‰ä¸ºç¬¬ä¸€ä¸ª cuda è®¾å¤‡ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">device&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cuda:0&amp;#39;&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cuda&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">is_available&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="s1">&amp;#39;cpu&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cuda:0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¤åˆ¶ nn å’Œ tensor åˆ° GPU ä¸Šã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">inputs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Tip:&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>.to(device)&lt;/code> å¹¶æ²¡æœ‰å¤åˆ¶ nn / tensor åˆ° GPU ä¸Šï¼Œè€Œæ˜¯è¿”å›äº†ä¸€ä¸ª copyã€‚éœ€è¦èµ‹å€¼åˆ°ä¸€ä¸ªæ–°çš„å˜é‡ååœ¨ GPU ä¸Šä½¿ç”¨è¿™ä¸ª nn / tensorã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="å‚è€ƒ">å‚è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://pytorch.apachecn.org/#/docs/1.7/02" target="_blank" rel="noopener"
>https://pytorch.apachecn.org/#/docs/1.7/02&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>React Hooks</title><link>https://blog.letout.cn/p/react-hooks/</link><pubDate>Thu, 28 Jan 2021 21:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/react-hooks/</guid><description>&lt;img src="https://blog.letout.cn/imgs/9.jpeg" alt="Featured image of post React Hooks" />&lt;h1 id="react-hooks-ç®€ä»‹">React Hooks ç®€ä»‹&lt;/h1>
&lt;h2 id="hook-å«ä¹‰">Hook å«ä¹‰&lt;/h2>
&lt;h1 id="ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶">ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶&lt;/h1>
&lt;h1 id="usestate">useState&lt;/h1>
&lt;h2 id="ä½¿ç”¨">ä½¿ç”¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useState&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">Example&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å£°æ˜äº†ä¸€ä¸ª count çš„ state å˜é‡ï¼Œå¹¶åˆå§‹åŒ–ä¸º 0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// setCount è®¾ç½® state å€¼ count çš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œå°† count çš„å€¼ +1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">You&lt;/span> &lt;span class="nx">clicked&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">times&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">button&lt;/span> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Click&lt;/span> &lt;span class="nx">me&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="nx">Example&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è¯­æ³•">è¯­æ³•&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å£°æ˜ä¸€ä¸ª state å˜é‡ï¼Œå¹¶åŒæ—¶åˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setState&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">initialState&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>useState è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„
&lt;ul>
&lt;li>state å˜é‡ï¼ŒæŒ‡å‘çŠ¶æ€å½“å‰å€¼&lt;/li>
&lt;li>setState æ›´æ–° state å€¼çš„æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>initialState çŠ¶æ€åˆå§‹å€¼å¯ä»¥æ˜¯æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ç­‰&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸ç±»ä¸­ä½¿ç”¨-setstate-å¼‚åŒ">ä¸ç±»ä¸­ä½¿ç”¨ &lt;code>setState&lt;/code> å¼‚åŒ&lt;/h2>
&lt;ul>
&lt;li>ç›¸åŒç‚¹
&lt;ul>
&lt;li>åœ¨ä¸€æ¬¡æ¸²æŸ“å‘¨æœŸä¸­è°ƒç”¨å¤šæ¬¡ setStateï¼Œæ•°æ®åªæ”¹å˜ä¸€æ¬¡&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¸åŒç‚¹
&lt;ul>
&lt;li>ç±»ç»„ä»¶ä¸­ setState ä¸ºåˆå¹¶&lt;/li>
&lt;li>å‡½æ•°ç»„ä»¶ä¸­ setState ä¸ºæ›¿æ¢&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="useeffect">useEffect&lt;/h1>
&lt;p>useEffect ç”¨æ¥æ‰§è¡Œå‰¯ä½œç”¨ã€‚å¯ä»¥å°† useEffect Hook çœ‹åš &lt;code>componentDidMount, componentDidUpdate, componentWillMount&lt;/code> ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„ç»„åˆã€‚&lt;/p>
&lt;p>å¸¸ç”¨åœ¨ï¼š&lt;/p>
&lt;ul>
&lt;li>æœåŠ¡å™¨è¯·æ±‚&lt;/li>
&lt;li>è®¿é—®å…ƒç´  dom å…ƒç´ &lt;/li>
&lt;li>æœ¬åœ°æŒä¹…åŒ–ç¼“å­˜&lt;/li>
&lt;li>ç»‘å®š/è§£ç»‘äº‹ä»¶&lt;/li>
&lt;li>æ·»åŠ è®¢é˜…&lt;/li>
&lt;li>è®¾ç½®å®šæ—¶å™¨&lt;/li>
&lt;li>è®°å½•æ—¥å¿—&lt;/li>
&lt;li>ç­‰&lt;/li>
&lt;/ul>
&lt;p>useEffect æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¸²æŸ“å®Œæ¯•åæ‰æ‰§è¡Œï¼Œè¯¥å‡½æ•°æœ‰è¦æ±‚ï¼šè¦ä¹ˆè¿”å›ä¸€ä¸ªèƒ½æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¦ä¹ˆå°±ä¸è¿”å›ä»»ä½•å†…å®¹ã€‚&lt;/p>
&lt;h2 id="ä¸éœ€è¦æ¸…é™¤çš„-effect">ä¸éœ€è¦æ¸…é™¤çš„ effect&lt;/h2>
&lt;p>åœ¨ React æ›´æ–° DOM ä¹‹åï¼Œæˆ‘ä»¬æƒ³è¿è¡Œä¸€äº›é¢å¤–çš„ä»£ç ã€‚æ¯”å¦‚å‘é€ç½‘ç»œè¯·æ±‚ï¼Œæ‰‹åŠ¨å˜æ›´ DOMï¼Œè®°å½•æ—¥å¿—ï¼Œè¿™äº›éƒ½æ˜¯å¸¸è§çš„æ— éœ€æ¸…é™¤çš„æ“ä½œã€‚
å› ä¸ºæˆ‘ä»¬åœ¨æ‰§è¡Œå®Œè¿™äº›æ“ä½œä¹‹åï¼Œå°±å¯ä»¥å¿½ç•¥ä»–ä»¬äº†ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹ä¸ºä½¿ç”¨ class å’Œ Hook éƒ½æ˜¯æ€ä¹ˆå®ç°è¿™äº›å‰¯ä½œç”¨çš„å¯¹æ¯”ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨ç±»ç»„ä»¶">ä½¿ç”¨ç±»ç»„ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åœ¨ React æ›´æ–° DOM æ“ä½œåï¼Œç«‹å³æ›´æ–° document çš„ title å±æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">class&lt;/span> &lt;span class="nx">Example&lt;/span> &lt;span class="kr">extends&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Component&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç»„ä»¶åŠ è½½æ—¶éœ€è¦æ›´æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">componentDidMount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç»„ä»¶æ›´æ–°æ—¶éœ€è¦æ›´æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">componentDidUpdate&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åœ¨ render() ä¸èƒ½æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚åº”è¯¥åœ¨ react æ›´æ–° DOM åå†æ‰§è¡Œå‰¯ä½œç”¨ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">render&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">You&lt;/span> &lt;span class="nx">clicked&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">times&lt;/span>&lt;span class="p">.&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">button&lt;/span> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">})}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">click&lt;/span> &lt;span class="nx">me&lt;/span>&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä½¿ç”¨-hook">ä½¿ç”¨ Hook&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">useState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">Example&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="c1">// ç»è¿‡æ¸²æŸ“æˆ–æ›´æ–°ï¼Œ DOM æ›´æ–°å®Œæ¯•ä¹‹åï¼Œä¼šè¿è¡Œè¯¥ effect
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You click &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">You&lt;/span> &lt;span class="nx">clicked&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">times&lt;/span>&lt;span class="p">.&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">button&lt;/span> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">})}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">click&lt;/span> &lt;span class="nx">me&lt;/span>&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åå’Œæ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šæ‰§è¡Œ useEffectã€‚ä¸” React ä¿è¯æ¯æ¬¡è¿è¡Œ effect çš„åŒæ—¶ï¼ŒDOM å·²ç»æ›´æ–°å®Œæ¯•ã€‚&lt;/li>
&lt;li>useEffect æ”¾åœ¨ç»„ä»¶å†…éƒ¨è®©æˆ‘ä»¬å¯ä»¥åœ¨ effect ä¸­ç›´æ¥è®¿é—® state / propsã€‚æˆ‘ä»¬ä¸éœ€è¦ç‰¹æ®Šçš„ API æ¥è¯»å–ã€‚&lt;/li>
&lt;li>ä¸ componentDidMount æˆ– componentDidUpdate ä¸åŒï¼Œä½¿ç”¨ useEffect è°ƒåº¦çš„ effect ä¸ä¼šé˜»å¡æµè§ˆå™¨æ›´æ–°å±å¹•ï¼Œè¿™è®©ä½ çš„åº”ç”¨çœ‹èµ·æ¥å“åº”æ›´å¿«ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œeffect ä¸éœ€è¦åŒæ­¥åœ°æ‰§è¡Œã€‚åœ¨ä¸ªåˆ«æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚æµ‹é‡å¸ƒå±€ï¼‰ï¼Œæœ‰å•ç‹¬çš„ useLayoutEffect Hook ä¾›ä½ ä½¿ç”¨ï¼Œå…¶ API ä¸ useEffect ç›¸åŒã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="éœ€è¦æ¸…é™¤çš„-effect">éœ€è¦æ¸…é™¤çš„ effect&lt;/h2>
&lt;p>æœ‰ä¸€äº›å‰¯ä½œç”¨æ˜¯éœ€è¦æ¸…é™¤çš„ï¼Œå¦‚è®¢é˜…å¤–éƒ¨æ•°æ®æºã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ¸…é™¤å·¥ä½œæ˜¯éå¸¸é‡è¦çš„ï¼Œå¯ä»¥é˜²æ­¢å¼•èµ·å†…å­˜æ³„éœ²ï¼&lt;/p>
&lt;h3 id="ä½¿ç”¨ç±»ç»„ä»¶-1">ä½¿ç”¨ç±»ç»„ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">class&lt;/span> &lt;span class="nx">FriendStatus&lt;/span> &lt;span class="kr">extends&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Component&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">null&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bind&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentDidMount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentDidUpdate&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentWillUnmount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åœ¨ç»„ä»¶å¸è½½æ—¶ï¼Œå…³é—­è®¢é˜…çš„æ•°æ®æº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">render&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s1">&amp;#39;Loading...&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;Online&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Offline&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä½¿ç”¨å‡½æ•°ç»„ä»¶">ä½¿ç”¨å‡½æ•°ç»„ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">useState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">FriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">isOnline&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// effect å¯é€‰æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¿”å›å‡½æ•°ä¸ä¸€å®šéœ€è¦å‘½å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">cleanup&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s1">&amp;#39;Loading...&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">isOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;Online&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Offline&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>React ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œæ¸…é™¤æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å¤šä¸ª-effect-å®ç°å…³æ³¨ç‚¹åˆ†ç¦»">å¤šä¸ª Effect å®ç°å…³æ³¨ç‚¹åˆ†ç¦»&lt;/h2>
&lt;p>ä½¿ç”¨ Hook çš„å…¶ä¸­ä¸€ä¸ªç›®çš„æ˜¯è¦è§£å†³ï¼š class ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ç»å¸¸åŒ…å«ä¸ç›¸å…³é€»è¾‘ï¼Œç›¸å…³é€»è¾‘åˆåˆ†ç¦»åœ¨å‡ ä¸ªä¸åŒçš„æ–¹æ³•ä¸­ã€‚&lt;/p>
&lt;p>å¦‚ä¸‹ä¸ºä¸Šæ–‡ä¸­è®¡æ•°å™¨å’Œå¥½å‹çŠ¶æ€æŒ‡ç¤ºå™¨é€»è¾‘ç»„åˆåœ¨ä¸€èµ·çš„ç»„ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">class&lt;/span> &lt;span class="nx">FriendStatusWithCounter&lt;/span> &lt;span class="kr">extends&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Component&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">constructor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">count&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStautsChange&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bind&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç›¸åº”çš„é€»è¾‘è¢«åˆ†é…åœ¨ä¸‰ä¸ªä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">componentDidMount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// counter
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// friend status
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">fried&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentDidUpdate&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">componentWillUnmount&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">handleStatusChange&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setState&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isOnline&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOnline&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è‹¥ä½¿ç”¨ Hookï¼Œå’Œä½¿ç”¨å¤šä¸ª state çš„ Hook ä¸€æ ·ï¼Œé€šè¿‡ä½¿ç”¨å¤šä¸ª effectï¼Œå°†ä¸ç›¸å…³çš„é€»è¾‘åˆ†ç¦»åˆ°ä¸åŒçš„ effect ä¸­ã€‚&lt;/p>
&lt;p>Hook å…è®¸æŒ‰ç…§ä»£ç çš„ç”¨é€”è¿›è¡Œåˆ†ç¦»ï¼Œä¸åŒäºç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚å°†æŒ‰ç…§ effect å£°æ˜çš„é¡ºåºä¾æ¬¡è°ƒç”¨ç»„ä»¶ä¸­çš„æ¯ä¸€ä¸ª effectã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">FriendStatusWithCounter&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setCount&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">isOneline&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useIsOneline&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setIsOneline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOneline&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubscribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è·³è¿‡-effect-è¿›è¡Œæ€§èƒ½ä¼˜åŒ–">è·³è¿‡ Effect è¿›è¡Œæ€§èƒ½ä¼˜åŒ–&lt;/h2>
&lt;p>åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code>componentDidUpdate&lt;/code> ä¸­ &lt;code>prevProps&lt;/code> å’Œ &lt;code>prevState&lt;/code> çš„ props / state çš„å˜åŒ–æ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡ŒæŸäº›å‰¯ä½œç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">componentDidUpdate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">prevProps&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">prevState&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">prevState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ Hook ä¸­ï¼Œå¯ä»¥é€šè¿‡å¯¹ useEffect ä¼ é€’æ•°ç»„ä½œä¸ºç¬¬äºŒå¯é€‰å‚æ•°ï¼Œé€šçŸ¥ React è·³è¿‡å¯¹ effect çš„è°ƒç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`You clicked &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> times`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">]);&lt;/span> &lt;span class="c1">// è¡¨ç¤º count æ›´æ”¹æ—¶ä¼šè¿›è¡Œæ›´æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// {... , [5]} å½“ count === 5 æ—¶ï¼Œè·³è¿‡ effect
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>è‹¥åªæƒ³è¿è¡Œä¸€æ¬¡ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ [] ä½œä¸ºç¬¬äºŒå‚æ•°ã€‚
&lt;ul>
&lt;li>ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ï¼Œeffect å†…éƒ¨çš„ props å’Œ state ä¼šä¸€ç›´æ‹¥æœ‰å…¶åˆå§‹å€¼ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä½¿ç”¨è¯¥ä¼˜åŒ–ï¼Œè¯·ç¡®ä¿æ•°ç»„ä¸­åŒ…å«äº†æ‰€æœ‰å¤–éƒ¨ä½œç”¨åŸŸä¸­ä¼šéšæ—¶é—´å˜åŒ–ä¸”åœ¨ effect ä¸­ä½¿ç”¨çš„å˜é‡ï¼Œå¦åˆ™ä»£ç ä¼šç”¨åˆ°å…ˆå‰æ¸²æŸ“ä¸­çš„æ—§å˜é‡ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ-effect-çš„åŸå› ">æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ Effect çš„åŸå› &lt;/h2>
&lt;h1 id="è‡ªå®šä¹‰-hook">è‡ªå®šä¹‰ Hook&lt;/h1>
&lt;p>è‡ªå®šä¹‰ Hook å¯ä»¥å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ã€‚&lt;/p>
&lt;p>ç›®å‰ä¸ºæ­¢ï¼Œåœ¨ React ä¸­æœ‰ä¸¤ç§æµè¡Œçš„æ–¹å¼å…±äº«ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘ï¼š&lt;/p>
&lt;ul>
&lt;li>render props&lt;/li>
&lt;li>é«˜é˜¶ç»„ä»¶
ä½¿ç”¨ Hook å¯ä»¥åœ¨ä¸å¢åŠ ç»„ä»¶çš„æƒ…å†µä¸‹è§£å†³ç›¸åŒçš„é—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="åˆ›å»ºè‡ªå®šä¹‰-hook">åˆ›å»ºè‡ªå®šä¹‰ Hook&lt;/h2>
&lt;p>å½“æˆ‘ä»¬æƒ³åœ¨å‡½æ•°é—´å…±äº«é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæå–åˆ°å¦å¤–ä¸€ä¸ªå‡½æ•°ä¸­ã€‚ç”±äºç»„ä»¶å’Œ Hook éƒ½æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ä¹ŸåŒæ ·ä½¿ç”¨äºè¿™ç§æ–¹å¼ã€‚&lt;/p>
&lt;p>è‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åç§°ä»¥ &amp;ldquo;use&amp;rdquo; å¼€å¤´ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–çš„ Hookã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯æ ¹æ®ä¸Šæ–‡ä¸­ &lt;code>FriendStatus&lt;/code> å®ä¾‹ï¼Œæ‰€æå–çš„è‡ªå®šä¹‰ Hookã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useEffect&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åç§°ä¸€å®šä»¥ use å¼€å¤´
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friendID&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">isOnline&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setIsOnline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isOneline&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribeToFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friendID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ChatAPI&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unsubcribeFromFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friendID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">handleStatusChange&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">isOnline&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨è¿™ä¸ªè‡ªå®šä¹‰ Hook ä¸­ï¼Œæ²¡æœ‰åŒ…å«ä»»ä½•æ–°å†…å®¹ï¼ˆé€»è¾‘ä¸ç»„ä»¶ä¸­çš„å®Œå…¨ä¸€è‡´ï¼‰&lt;/p>
&lt;h2 id="ä½¿ç”¨è‡ªå®šä¹‰-hook">ä½¿ç”¨è‡ªå®šä¹‰ Hook&lt;/h2>
&lt;p>ä¸ç»„ä»¶ä¸€è‡´ï¼Œè¯·ç¡®ä¿åªåœ¨è‡ªå®šä¹‰ Hook çš„é¡¶å±‚æ— æ¡ä»¶åœ°è°ƒç”¨å…¶ä»– Hookã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">function&lt;/span> &lt;span class="nx">FriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">isOnline&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">isOnline&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s2">&amp;#34;Loading...&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">isOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;Online&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Offline&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ®µä»£ç ä¸ä¹‹å‰çš„å·¥ä½œæ–¹å¼å®Œå…¨ä¸€æ ·ï¼Œæˆ‘ä»¬åªæ˜¯å°†å‡½æ•°ä¸­éœ€è¦å…±äº«çš„é€»è¾‘æå–åˆ°å•ç‹¬çš„å‡½æ•°ä¸­ã€‚&lt;/p>
&lt;ul>
&lt;li>è‡ªå®šä¹‰ Hook æ˜¯ä¸€ç§è‡ªç„¶éµå¾ª Hook è®¾è®¡çš„çº¦å®šï¼Œä¸æ˜¯ React çš„ç‰¹æ€§ã€‚&lt;/li>
&lt;li>è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ &amp;ldquo;use&amp;rdquo; å¼€å¤´&lt;/li>
&lt;li>ä¸åŒç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ Hook ä¸ä¼šå…±äº« stateã€‚
&lt;ul>
&lt;li>è‡ªå®šä¹‰ Hook æ˜¯é‡ç”¨çŠ¶æ€é€»è¾‘çš„æœºåˆ¶ï¼ˆä¾‹å¦‚è®¾ç½®ä¸ºè®¢é˜…å¹¶å­˜å‚¨å½“å‰å€¼ï¼‰ï¼Œæ¯æ¬¡ä½¿ç”¨è‡ªå®šä¹‰ Hook æ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰ state å’Œå‰¯ä½œç”¨å®Œå…¨éš”ç¦»ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="åœ¨å¤šä¸ª-hook-ä¹‹é—´ä¼ é€’ä¿¡æ¯">åœ¨å¤šä¸ª Hook ä¹‹é—´ä¼ é€’ä¿¡æ¯&lt;/h2>
&lt;p>ç”±äº Hook æœ¬èº«å°±æ˜¯å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è¿™æ˜¯ä¸€ä¸ªèŠå¤©æ¶ˆæ¯æ¥æ”¶è€…çš„é€‰æ‹©å™¨ï¼Œå®ƒä¼šæ˜¾ç¤ºå½“å‰é€‰å®šçš„å¥½å‹æ˜¯å¦åœ¨çº¿
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">ChatRecipientPicker&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“å‰é€‰æ‹©çš„å¥½å‹ ID ä¿å­˜åœ¨ recipientID çŠ¶æ€å˜é‡ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">recipientID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setRecipientID&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å½“æ›´æ–° recipientID çŠ¶æ€å˜é‡æ—¶ï¼ŒuseFriendStatus Hook ä¼šå–æ¶ˆè®¢é˜…ä¹‹å‰é€‰ä¸­çš„å¥½å‹ï¼Œå¹¶è®¢é˜…æ–°é€‰ä¸­çš„å¥½å‹çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">isRecipientOnline&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useFriendStatus&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">recipientID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">Circle&lt;/span> &lt;span class="nx">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">isRecipientOnline&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;green&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;red&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">select&lt;/span> &lt;span class="c1">// &amp;lt;select&amp;gt; ä¸­é€‰æ‹©å…¶ä»–å¥½å‹æ—¶æ›´æ–° recipientID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">recipientID&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">onChange&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">e&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">setRecipientID&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">Number&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">target&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span>&lt;span class="p">))}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">friendList&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">friend&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">option&lt;/span> &lt;span class="nx">key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nx">friend&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">/option&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">/select&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘ä»¬å°†å½“å‰é€‰æ‹©çš„å¥½å‹ ID ä¿å­˜åœ¨ recipientID çŠ¶æ€å˜é‡ä¸­ï¼Œå¹¶ä¼šåœ¨ç”¨æˆ·ä» &amp;lt;select&amp;gt; ä¸­é€‰æ‹©å…¶ä»–å¥½å‹æ—¶æ›´æ–°è¿™ä¸ª stateã€‚&lt;/p>
&lt;p>ç”±äº useState ä¼šæä¾› recipientID çŠ¶æ€å˜é‡çš„æœ€æ–°å€¼ï¼Œå¯ä»¥å°†å®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™è‡ªå®šä¹‰çš„ useFriendStatus Hookã€‚å½“æˆ‘ä»¬é€‰æ‹©ä¸åŒçš„å¥½å‹å¹¶æ›´æ–° recipientID çŠ¶æ€å˜é‡æ—¶ï¼ŒuseFriendStatus Hook ä¼šå–æ¶ˆè®¢é˜…ä¹‹å‰é€‰ä¸­çš„å¥½å‹ï¼Œå¹¶è®¢é˜…æ–°é€‰ä¸­çš„å¥½å‹çŠ¶æ€ã€‚&lt;/p>
&lt;h1 id="hook-è§„åˆ™">Hook è§„åˆ™&lt;/h1>
&lt;h1 id="é¢å¤–çš„-hook">é¢å¤–çš„ Hook&lt;/h1>
&lt;h1 id="å‚è€ƒ">å‚è€ƒ&lt;/h1>
&lt;ul>
&lt;li>&lt;a class="link" href="https://juejin.im/post/6844903814349193229" target="_blank" rel="noopener"
>https://juejin.im/post/6844903814349193229&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://juejin.im/post/6844903985338400782" target="_blank" rel="noopener"
>https://juejin.im/post/6844903985338400782&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.ruanyifeng.com/blog/2019/09/react-hooks.html" target="_blank" rel="noopener"
>https://www.ruanyifeng.com/blog/2019/09/react-hooks.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://zh-hans.reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener"
>https://zh-hans.reactjs.org/docs/hooks-intro.html&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>NumPy</title><link>https://blog.letout.cn/p/numpy/</link><pubDate>Tue, 01 Dec 2020 21:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/numpy/</guid><description>&lt;img src="https://blog.letout.cn/imgs/3.jpeg" alt="Featured image of post NumPy" />&lt;h1 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹&lt;/h1>
&lt;h1 id="æ•°ç»„-numpyarray">æ•°ç»„ numpy.array&lt;/h1>
&lt;h4 id="npzeros">np.zeros&lt;/h4>
&lt;p>åˆ›å»ºæŒ‡å®šå¤§å°çš„æ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ä»¥ 0 å¡«å……ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.zeros(shape, dtype=None, order = &amp;lsquo;C&amp;rsquo;)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>shape æ•°ç»„å½¢çŠ¶&lt;/li>
&lt;li>dtype æ•°æ®ç±»å‹&lt;/li>
&lt;li>order &amp;lsquo;C&amp;rsquo; ç”¨äº C çš„è¡Œæ•°ç»„ï¼Œæˆ–è€… &amp;lsquo;F&amp;rsquo; ç”¨äº FORTRAN çš„åˆ—æ•°ç»„&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0. 0. 0. 0. 0.]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0 0 0 0 0]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># ä¸‰è¡Œäº”åˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">shape&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0., 0., 0., 0.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0., 0., 0., 0.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0., 0., 0., 0.],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="npones">np.ones&lt;/h4>
&lt;p>åˆ›å»ºæŒ‡å®šå¤§å°çš„æ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ä»¥ 1 å¡«å……ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.ones(shape, dtype=None, order=&amp;lsquo;C&amp;rsquo;)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h4 id="npfull">np.full&lt;/h4>
&lt;p>åˆ›å»ºæŒ‡å®šå¤§å°å’Œæ•°æ®çš„æ•°ç»„&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.full(shape, fill_value, dtype=None, order=&amp;lsquo;C&amp;rsquo;)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºä¸€ä¸ª ä¸‰è¡Œäº”åˆ— å€¼ä¸º 666.0 çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">full&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="mf">666.0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="nparange">np.arange&lt;/h4>
&lt;p>åœ¨æ•°ç»„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ range åˆ›å»ºæŒ‡å®šèŒƒå›´çš„æ•°ç»„ï¼ˆä¸èƒ½ä¼ é€’æµ®ç‚¹æ•°ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 20) æ­¥é•¿ä¸º 2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 2, 4, 6, 8, 10, 12, 14, 16, 18]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ numpy ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ arange åˆ›å»ºæ•°ç»„èŒƒå›´å¹¶è¿”å› ndarray å¯¹è±¡ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.arange(start, stop, step, dtype)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>start èµ·å§‹å€¼ï¼Œé»˜è®¤ä¸º 0&lt;/li>
&lt;li>stop ç»ˆæ­¢å€¼ï¼Œä¸åŒ…å«&lt;/li>
&lt;li>step æ­¥é•¿ï¼Œé»˜è®¤ä¸º 1&lt;/li>
&lt;li>dtype æ•°æ®ç±»å‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯ä»¥ä¼ é€’æµ®ç‚¹æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 0.2, 0.4, 0.6, 0.8]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="nplinspace">np.linspace&lt;/h4>
&lt;p>åˆ›å»ºä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œæ„æˆä¸€ä¸ªç­‰å·®æ•°åˆ—ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.linspace(start, stop, num=50, endpoint=True, retstep=False,dtype=None, axis=0)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>start èµ·å§‹å€¼&lt;/li>
&lt;li>stop ç»ˆæ­¢å€¼ï¼ˆé»˜è®¤åŒ…å« endpoint=Trueï¼‰&lt;/li>
&lt;li>endpoint å½“ä¸º True æ—¶ï¼Œä¼šåŒ…å« stop çš„å€¼&lt;/li>
&lt;li>retstep å½“ä¸º True æ—¶ï¼Œç”Ÿæˆçš„æ•°ç»„ä¸­ä¼šæ˜¾ç¤ºé—´è·&lt;/li>
&lt;li>dtype æ•°æ®ç±»å‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿæˆ [0, 20] é—´è·ä¸º 2 çš„ 10 ä¸ªæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">linspace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">11&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0., 2., 4., 6., 8., 10., 12., 14., 16., 18., 20.]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="nprandom">np.random&lt;/h4>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.random.randint(low, high=None, size=None, dtype=None)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ç”ŸæˆæŒ‡å®šçš„æ•´æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ [0, 10) é—´ç”Ÿæˆä¸€ä¸ªéšæœºæ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ [0, 10) é—´ç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º 10 çš„ä¸€ç»´æ•°ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [7, 7, 7, 7, 7, 4, 5, 6, 4, 7]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ [0, 10) é—´ç”Ÿæˆä¸€ä¸ª 3è¡Œ6åˆ— çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŒ‡å®šéšæœºç§å­ï¼Œä½¿ç”Ÿæˆçš„æ•°æ®åœ¨æµ‹è¯•æ—¶ä¿æŒä¸€è‡´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">666&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>numpy.random.random(size=None)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ç”Ÿæˆ [0.0, 1.0) é—´çš„æµ®ç‚¹æ•°ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>numpy.random.normal(loc=0.0, scale=1.0, size=None)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ç”Ÿæˆä¸€ä¸ªç¬¦åˆæ­£æ€åˆ†å¸ƒçš„æµ®ç‚¹æ•°ã€‚&lt;/p>
&lt;ul>
&lt;li>loc å‡å€¼&lt;/li>
&lt;li>scale æ–¹å·®&lt;/li>
&lt;li>size å¤§å°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿæˆ å‡å€¼ä¸º 10 æ–¹å·®ä¸º 100 çš„æµ®ç‚¹æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿæˆ å‡å€¼ä¸º 0 æ–¹å·®ä¸º 1 çš„ 3è¡Œ5åˆ—çš„çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="numpyarray-åŸºæœ¬æ“ä½œ">numpy.array åŸºæœ¬æ“ä½œ&lt;/h1>
&lt;p>å‡è®¾æœ‰å¦‚ä¸‹ä¸€ä¸ªä¸€ç»´çš„æ•°ç»„ x å’Œ ä¸€ä¸ªä¸‰è¡Œäº”åˆ—çš„çŸ©é˜µ Xï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">numpy&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">np&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">np&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 0, 1, 2, 3, 4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [ 5, 6, 7, 8, 9],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [10, 11, 12, 13, 14]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="reshape">Reshape&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°† x è½¬ç½®ä¸º 2è¡Œ5åˆ—çš„ çŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">A&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ] &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°†å‘é‡è£…ç½®æˆçŸ©é˜µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -1ï¼šè®© numpy è‡ªå·±å†³å®šç»´åº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 10åˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 10è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">D&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [1],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [2],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [3],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [5],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [6],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [7],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [8],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [9],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">E&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [0, 1, 2, 3, 4],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [5, 6, 7, 8, 9]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ•°æ®ä¸èƒ½æ•´é™¤çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½ reshape&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">F&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reshape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åŸºæœ¬å±æ€§">åŸºæœ¬å±æ€§&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ndarray.ndim ç§©ï¼Œå³è½´çš„æ•°é‡æˆ–ç»´åº¦çš„æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ndim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ndim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ndarray.shape æ•°ç»„ç»´åº¦ï¼Œå¯¹äºçŸ©é˜µä¸ºnè¡Œmåˆ—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (10, )&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shape&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (3, 5)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ndarray.size æ•°ç»„å…ƒç´ çš„æ€»ä¸ªæ•°ï¼Œå¯¹äºçŸ©é˜µä¸º n*m ä¸ª&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 15&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ•°æ®è®¿é—®">æ•°æ®è®¿é—®&lt;/h2>
&lt;p>ä¸€ç»´ numpy.array å¯ä»¥å’Œæ•°ç»„ä¸€æ ·è¿›è¡Œè®¿é—®ã€‚&lt;/p>
&lt;p>å¤šç»´ numpy.array åœ¨è®¿é—®æ—¶ï¼Œæ¨èä¼ å…¥å¤šä¸ªå‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸€ç»´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>æœºå™¨å­¦ä¹ åŸºç¡€</title><link>https://blog.letout.cn/p/mechine-learning-basics/</link><pubDate>Mon, 28 Sep 2020 14:02:02 +0800</pubDate><guid>https://blog.letout.cn/p/mechine-learning-basics/</guid><description>&lt;h1 id="æœºå™¨å­¦ä¹ ">æœºå™¨å­¦ä¹ &lt;/h1>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/machinelearning.png"
width="887"
height="316"
srcset="https://blog.letout.cn/p/mechine-learning-basics/machinelearning_hu13b17d6db5217e228d729d78505e197d_53854_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/machinelearning_hu13b17d6db5217e228d729d78505e197d_53854_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="machinelearning"
class="gallery-image"
data-flex-grow="280"
data-flex-basis="673px"
>&lt;/p>
&lt;h2 id="åŸºæœ¬æœ¯è¯­">åŸºæœ¬æœ¯è¯­&lt;/h2>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/lris_table.png"
width="497"
height="282"
srcset="https://blog.letout.cn/p/mechine-learning-basics/lris_table_hu260d85a8756d54afc32312bc0e6db2f3_34466_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/lris_table_hu260d85a8756d54afc32312bc0e6db2f3_34466_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_table"
class="gallery-image"
data-flex-grow="176"
data-flex-basis="422px"
>&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºè¡¨æ ¼ï¼Œæ˜¯é¸¢å°¾èŠ±ï¼ˆlrisï¼‰ç›¸å…³ä¿¡æ¯çš„æ•°æ®ï¼Œå…¶ä¸­ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°æ®æ•´ä½“ç§°ä¸ºæ•°æ®é›†ï¼ˆdata setï¼‰&lt;/li>
&lt;li>æ¯ä¸€è¡Œæ•°æ®ç§°ä¸ºä¸€ä¸ªæ ·æœ¬ï¼ˆsampleï¼‰&lt;/li>
&lt;li>æ¯ä¸€åˆ—ï¼ˆé™¤è¡¨æ ¼æœ€åä¸€åˆ—ï¼‰è¡¨è¾¾æ ·æœ¬çš„ä¸€ä¸ªç‰¹å¾ï¼ˆfeatureï¼‰&lt;/li>
&lt;li>æœ€åä¸€åˆ—ï¼Œæˆä¸ºæ ‡è®°ï¼ˆlabelï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/lris_feature.png"
width="729"
height="277"
srcset="https://blog.letout.cn/p/mechine-learning-basics/lris_feature_hueb1f2deb5cb4168dcc54624d0c16003a_37076_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/lris_feature_hueb1f2deb5cb4168dcc54624d0c16003a_37076_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature"
class="gallery-image"
data-flex-grow="263"
data-flex-basis="631px"
>&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºä¿¡æ¯ï¼Œå…¶ä¸­ è¼ç‰‡é•¿åº¦ã€å®½åº¦ï¼ŒèŠ±ç“£çš„é•¿åº¦ã€å®½åº¦ç§°ä¸º ç‰¹å¾ï¼›æ¯ä¸€è¡Œç‰¹å¾çš„å€¼ç§°ä¸ºç‰¹å¾å‘é‡ï¼ˆæ•°å­¦ä¸Šé€šå¸¸ä¼šå°†å…¶è¡¨ç¤ºä¸ºåˆ—å‘é‡ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/lris_feature2.png"
width="740"
height="267"
srcset="https://blog.letout.cn/p/mechine-learning-basics/lris_feature2_hu711adcd4960fbcd7b6d08efae6dde377_37358_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/lris_feature2_hu711adcd4960fbcd7b6d08efae6dde377_37358_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature2"
class="gallery-image"
data-flex-grow="277"
data-flex-basis="665px"
>&lt;/p>
&lt;p>è‹¥å°†è¯¥å›¾ä¸­çš„æ•°æ®è¡¨ç¤ºä¸ºçŸ©é˜µçš„æ–¹å¼ï¼Œç»“æœå¦‚å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/lris_array.png"
width="214"
height="248"
srcset="https://blog.letout.cn/p/mechine-learning-basics/lris_array_hu72a83eec8e112bcbfe072659d9d3f18d_16930_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/lris_array_hu72a83eec8e112bcbfe072659d9d3f18d_16930_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_array"
class="gallery-image"
data-flex-grow="86"
data-flex-basis="207px"
>&lt;/p>
&lt;p>é€‰æ‹©ä¸¤ç§é¸¢å°¾èŠ±çš„ç‰¹å¾ä¸ºä¾‹ï¼Œå°†å…¶è¡¨ç¤ºä¸ºå¦‚å›¾çš„äºŒç»´ç©ºé—´ï¼ˆå¤šç»´ç‰¹å¾å°†å…¶è¡¨ç¤ºä¸ºå¤šç»´ç©ºé—´ï¼‰ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å°†è¿™æ ·çš„ç©ºé—´ç§°ä¸º ç‰¹å¾ç©ºé—´ï¼ˆfeature spaceï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/lris_feature_space.png"
width="519"
height="361"
srcset="https://blog.letout.cn/p/mechine-learning-basics/lris_feature_space_hu3ac3a516a704dd018abbe59f3e7cdabc_44237_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/lris_feature_space_hu3ac3a516a704dd018abbe59f3e7cdabc_44237_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature_space"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="345px"
>&lt;/p>
&lt;p>åˆ†ç±»ä»»åŠ¡æœ¬è´¨å°±æ˜¯åœ¨ç‰¹å¾ç©ºé—´åˆ‡åˆ†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨ç‰¹å¾ç©ºé—´ä¸­ï¼Œå°†é¸¢å°¾èŠ±æ ¹æ®ä¸¤ç§ç‰¹å¾åˆ†ä¸ºäº†ä¸¤ç±»ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/lris_feature_space2.png"
width="514"
height="396"
srcset="https://blog.letout.cn/p/mechine-learning-basics/lris_feature_space2_hu50eafd2c36f314e6e36adfce0dde2c44_59204_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/lris_feature_space2_hu50eafd2c36f314e6e36adfce0dde2c44_59204_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="lris_feature_space2"
class="gallery-image"
data-flex-grow="129"
data-flex-basis="311px"
>&lt;/p>
&lt;h2 id="æœºå™¨å­¦ä¹ çš„åŸºæœ¬ä»»åŠ¡">æœºå™¨å­¦ä¹ çš„åŸºæœ¬ä»»åŠ¡&lt;/h2>
&lt;p>æœºå™¨å­¦ä¹ çš„åŸºæœ¬ä»»åŠ¡åŸºæœ¬æœ‰ä¸¤ç±»ï¼Œåˆ†åˆ«ä¸ºï¼š&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>åˆ†ç±»&lt;/li>
&lt;li>å›å½’&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="åˆ†ç±»ä»»åŠ¡">åˆ†ç±»ä»»åŠ¡&lt;/h3>
&lt;blockquote>
&lt;ul>
&lt;li>ä¸€äº›ç®—æ³•åªæ”¯æŒå®ŒæˆäºŒåˆ†ç±»çš„ä»»åŠ¡&lt;/li>
&lt;li>å¤šåˆ†ç±»çš„ä»»åŠ¡å¯ä»¥è½¬æ¢æˆäºŒåˆ†ç±»çš„ä»»åŠ¡&lt;/li>
&lt;li>ä¸€äº›ç®—æ³•å¤©ç„¶çš„æ”¯æŒå¤šåˆ†ç±»é—®é¢˜&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h4 id="äºŒåˆ†ç±»">äºŒåˆ†ç±»&lt;/h4>
&lt;p>äºŒåˆ†ç±»é—®é¢˜çš„å¸¸è§å®ä¾‹ï¼š&lt;/p>
&lt;ul>
&lt;li>åˆ¤æ–­é‚®ä»¶æ˜¯åƒåœ¾é‚®ä»¶ï¼›ä¸æ˜¯åƒåœ¾é‚®ä»¶&lt;/li>
&lt;li>åˆ¤æ–­å‘æ”¾ç»™å®¢æˆ·ä¿¡ç”¨å¡æœ‰é£é™©ï¼›æ— é£é™©&lt;/li>
&lt;li>åˆ¤æ–­ç—…æ‚£è‰¯æ€§è‚¿ç˜¤ï¼›æ¶æ€§è‚¿ç˜¤&lt;/li>
&lt;li>åˆ¤æ–­æŸæ”¯è‚¡ç¥¨æ¶¨ï¼›è·Œ&lt;/li>
&lt;/ul>
&lt;h4 id="å¤šåˆ†ç±»">å¤šåˆ†ç±»&lt;/h4>
&lt;p>å¤šåˆ†ç±»é—®é¢˜çš„å¸¸è§å®ä¾‹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ•°å­—è¯†åˆ«&lt;/li>
&lt;li>å›¾åƒè¯†åˆ«&lt;/li>
&lt;li>åˆ¤æ–­å‘æ”¾ç»™å®¢æˆ·ä¿¡ç”¨å¡çš„é£é™©è¯„çº§&lt;/li>
&lt;li>å›´æ£‹æ¸¸æˆç­‰&lt;/li>
&lt;li>è‡ªåŠ¨é©¾é©¶è¯†åˆ«&lt;/li>
&lt;/ul>
&lt;h4 id="å¤šæ ‡ç­¾åˆ†ç±»">å¤šæ ‡ç­¾åˆ†ç±»&lt;/h4>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œä¸ºå¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜çš„å¸¸è§å®ä¾‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/label_classification.png"
width="873"
height="383"
srcset="https://blog.letout.cn/p/mechine-learning-basics/label_classification_hud280503f45d6bb1349e14ec6a2810ad7_406716_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/label_classification_hud280503f45d6bb1349e14ec6a2810ad7_406716_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="label_classification"
class="gallery-image"
data-flex-grow="227"
data-flex-basis="547px"
>&lt;/p>
&lt;h3 id="å›å½’ä»»åŠ¡">å›å½’ä»»åŠ¡&lt;/h3>
&lt;p>å›å½’é—®é¢˜çš„ç»“æœä¸åˆ†ç±»é—®é¢˜çš„ç»“æœä¸åŒï¼Œå›å½’é—®é¢˜çš„ç»“æœæ˜¯ä¸€ä¸ªè¿ç»­æ•°å­—çš„å€¼ï¼Œè€Œéä¸€ä¸ªç±»åˆ«ã€‚&lt;/p>
&lt;p>å¸¸è§çš„å›å½’é—®é¢˜æœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>æˆ¿å±‹ä»·æ ¼&lt;/li>
&lt;li>å¸‚åœºåˆ†æ&lt;/li>
&lt;li>å­¦æœ¯æˆç»©&lt;/li>
&lt;li>è‚¡ç¥¨ä»·æ ¼&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œå›å½’ä»»åŠ¡å¯ä»¥ç®€åŒ–æˆåˆ†ç±»ä»»åŠ¡ã€‚&lt;/p>
&lt;h2 id="æœºå™¨å­¦ä¹ ç®—æ³•åˆ†ç±»">æœºå™¨å­¦ä¹ ç®—æ³•åˆ†ç±»&lt;/h2>
&lt;h3 id="ç›‘ç£å­¦ä¹ ">ç›‘ç£å­¦ä¹ &lt;/h3>
&lt;p>ç›‘ç£å­¦ä¹  &lt;code>supervised learning&lt;/code> ä¸»è¦å¤„ç†çš„æ˜¯åˆ†ç±»é—®é¢˜å’Œå›å½’é—®é¢˜ã€‚&lt;/p>
&lt;p>ç›‘ç£å­¦ä¹ çš„å«ä¹‰æ˜¯ç»™æœºå™¨çš„è®­ç»ƒæ•°æ®ä¸­æ‹¥æœ‰â€œæ ‡è®°â€æˆ–è€…â€œç­”æ¡ˆâ€ã€‚æ ¹æ®è¿™äº›æ•°æ®è¿›è¡Œæ¨¡å‹çš„è®­ç»ƒã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/supervised_learning.png"
width="871"
height="313"
srcset="https://blog.letout.cn/p/mechine-learning-basics/supervised_learning_huf7d45c74be41f0f4fbb77506581979b3_52561_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/supervised_learning_huf7d45c74be41f0f4fbb77506581979b3_52561_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="supervised_learning"
class="gallery-image"
data-flex-grow="278"
data-flex-basis="667px"
>&lt;/p>
&lt;ul>
&lt;li>å¦‚æ ¹æ®å›¾ç‰‡åˆ¤æ–­çŒ«ç‹—ï¼ˆå›¾åƒå·²ç»æ‹¥æœ‰äº†æ ‡å®šä¿¡æ¯ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/supervised_learning_2.png"
width="738"
height="291"
srcset="https://blog.letout.cn/p/mechine-learning-basics/supervised_learning_2_hu2b9853d4704d9cf5e3f903309b997aeb_170020_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/supervised_learning_2_hu2b9853d4704d9cf5e3f903309b997aeb_170020_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="supervised_learning_2"
class="gallery-image"
data-flex-grow="253"
data-flex-basis="608px"
>&lt;/p>
&lt;ul>
&lt;li>å¦‚æ›´å…·æ‰‹å†™å­—ä½“è¯†åˆ«æ•°å­—ï¼ˆç»™å‡ºç»“æœæ ‡è®°ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/supervised_learning_3.png"
width="707"
height="408"
srcset="https://blog.letout.cn/p/mechine-learning-basics/supervised_learning_3_hub5f7e5166008572d41af8d4590a4d11f_201016_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/supervised_learning_3_hub5f7e5166008572d41af8d4590a4d11f_201016_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="supervised_learning_3"
class="gallery-image"
data-flex-grow="173"
data-flex-basis="415px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é“¶è¡Œå·²ç»ç§¯ç´¯äº†ä¸€å®šçš„å®¢æˆ·ä¿¡æ¯å’Œä»–ä»¬ä¿¡ç”¨å¡çš„ä¿¡ç”¨æƒ…å†µ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŒ»é™¢å·²ç»ç§¯ç´¯äº†ä¸€å®šçš„ç—…äººä¿¡æ¯å’Œä»–ä»¬æœ€ç»ˆç¡®è¯Šæ˜¯å¦æ‚£ç—…çš„æƒ…å†µã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å¸¸è§çš„ç›‘ç£å­¦ä¹ ç®—æ³•æœ‰ï¼š&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>kè¿‘é‚»&lt;/li>
&lt;li>çº¿æ€§å›å½’å’Œå¤šé¡¹å¼å›å½’&lt;/li>
&lt;li>é€»è¾‘å›å½’&lt;/li>
&lt;li>SVM&lt;/li>
&lt;li>å†³ç­–æ ‘å’Œéšæœºæ£®æ—&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h3 id="éç›‘ç£å­¦ä¹ ">éç›‘ç£å­¦ä¹ &lt;/h3>
&lt;p>éç›‘ç£å­¦ä¹  &lt;code>unsupervised learning&lt;/code> ç»™æœºå™¨çš„è®­ç»ƒæ•°æ®æ²¡æœ‰ä»»ä½•â€œæ ‡è®°â€æˆ–è€…â€œç­”æ¡ˆâ€ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning.png"
width="431"
height="320"
srcset="https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning_hu23cfcedd7d7c0433075d3be27fb1b699_35769_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning_hu23cfcedd7d7c0433075d3be27fb1b699_35769_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;p>å¯¹æ²¡æœ‰â€œæ ‡è®°â€çš„æ•°æ®è¿›è¡Œåˆ†ç±» &amp;ndash; èšç±»åˆ†æã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning_2.png"
width="529"
height="305"
srcset="https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning_2_hua6076421e113c36653c61737a036f410_62650_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning_2_hua6076421e113c36653c61737a036f410_62650_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning_2"
class="gallery-image"
data-flex-grow="173"
data-flex-basis="416px"
>&lt;/p>
&lt;h4 id="æ„ä¹‰">æ„ä¹‰&lt;/h4>
&lt;h5 id="å¯¹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†">å¯¹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†&lt;/h5>
&lt;ul>
&lt;li>ç‰¹å¾æå–ï¼šè¡Œç”¨å¡çš„ä¿¡ç”¨è¯„çº§å’Œäººçš„èƒ–ç˜¦æ— å…³ï¼Ÿ&lt;/li>
&lt;li>ç‰¹å¾å‹ç¼©ï¼šPCA&lt;/li>
&lt;/ul>
&lt;p>é™ç»´å¤„ç†çš„æ„ä¹‰ï¼šæ–¹ä¾¿å¯è§†åŒ–&lt;/p>
&lt;p>æˆ‘ä»¬æ— æ³•ç†è§£å››ç»´ä»¥ä¸Šç©ºé—´ï¼Œæ‰€ä»¥å¯ä»¥å°†å…¶é™ç»´åˆ°ä¸‰ç»´æˆ–è€…äºŒç»´ç©ºé—´ï¼Œæ–¹ä¾¿ç†è§£ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning_3.png"
width="441"
height="308"
srcset="https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning_3_hu38269c3322bdeea39e5dc5fabf9129df_91476_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning_3_hu38269c3322bdeea39e5dc5fabf9129df_91476_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning_3"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="343px"
>&lt;/p>
&lt;h5 id="å¼‚å¸¸æ£€æµ‹">å¼‚å¸¸æ£€æµ‹&lt;/h5>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning_4.png"
width="658"
height="343"
srcset="https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning_4_hu1a0363349b68a744dcaab61af015c7ec_76718_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/unsupervised_learning_4_hu1a0363349b68a744dcaab61af015c7ec_76718_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="unsupervised_learning_4"
class="gallery-image"
data-flex-grow="191"
data-flex-basis="460px"
>&lt;/p>
&lt;h3 id="åŠç›‘ç£å­¦ä¹ ">åŠç›‘ç£å­¦ä¹ &lt;/h3>
&lt;p>&lt;code>semi-supervised learning&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸€éƒ¨åˆ†æ•°æ®æœ‰â€œæ ‡è®°â€æˆ–è€…ç­”æ¡ˆï¼Œå¦ä¸€éƒ¨åˆ†æ•°æ®æ²¡æœ‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¸¸è§çš„åœºæ™¯ï¼šå„ç§åŸå› äº§ç”Ÿçš„æ ‡è®°ç¼ºå¤±ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æˆ‘ä»¬é€šå¸¸éƒ½å…ˆä½¿ç”¨æ— ç›‘ç£å­¦ä¹ æ‰‹æ®µå¯¹æ•°æ®åšå¤„ç†ï¼Œä¹‹åä½¿ç”¨ç›‘ç£å­¦ä¹ æ‰‹æ®µåšæ¨¡å‹çš„è®­ç»ƒå’Œé¢„æµ‹ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å¢å¼ºå­¦ä¹ ">å¢å¼ºå­¦ä¹ &lt;/h3>
&lt;p>æ ¹æ®å‘¨å›´ç¯å¢ƒçš„æƒ…å†µï¼Œé‡‡å–è¡ŒåŠ¨ï¼Œæ ¹æ®é‡‡å–è¡ŒåŠ¨çš„ç»“æœï¼Œå­¦ä¹ è¡ŒåŠ¨æ–¹å¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/reinforcement_learning.png"
width="734"
height="290"
srcset="https://blog.letout.cn/p/mechine-learning-basics/reinforcement_learning_hu54ff37564e23648f6ad43f62f0917611_39669_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/reinforcement_learning_hu54ff37564e23648f6ad43f62f0917611_39669_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="reinforcement_learning"
class="gallery-image"
data-flex-grow="253"
data-flex-basis="607px"
>&lt;/p>
&lt;ul>
&lt;li>æ— äººé©¾é©¶&lt;/li>
&lt;li>æœºå™¨äºº&lt;/li>
&lt;/ul>
&lt;p>åœ¨å¢å¼ºå­¦ä¹ ä¸­ï¼Œç›‘ç£å­¦ä¹ å’ŒåŠç›‘ç£å­¦ä¹ æ˜¯åŸºç¡€ã€‚&lt;/p>
&lt;h2 id="æœºå™¨å­¦ä¹ çš„å…¶ä»–åˆ†ç±»">æœºå™¨å­¦ä¹ çš„å…¶ä»–åˆ†ç±»&lt;/h2>
&lt;h3 id="åœ¨çº¿å­¦ä¹ å’Œæ‰¹é‡å­¦ä¹ ">åœ¨çº¿å­¦ä¹ å’Œæ‰¹é‡å­¦ä¹ &lt;/h3>
&lt;h4 id="åœ¨çº¿å­¦ä¹ ">åœ¨çº¿å­¦ä¹ &lt;/h4>
&lt;p>&lt;code>Online Learning&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/online_learning.png"
width="881"
height="356"
srcset="https://blog.letout.cn/p/mechine-learning-basics/online_learning_hufd2519c1c5cf57144a0949d734813375_60298_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/online_learning_hufd2519c1c5cf57144a0949d734813375_60298_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="online_learning"
class="gallery-image"
data-flex-grow="247"
data-flex-basis="593px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¼˜ç‚¹ï¼šåŠæ—¶åæ˜ æ–°çš„ç¯å¢ƒå˜åŒ–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é—®é¢˜ï¼šæ–°çš„æ•°æ®å¯èƒ½å¸¦æ¥ä¸å¥½çš„å˜åŒ–ï¼Œé”™è¯¯çš„æ•°æ®å¯èƒ½å¸¦æ¥é”™è¯¯çš„ç»“æœ&lt;/p>
&lt;ul>
&lt;li>è§£å†³æ–¹æ¡ˆï¼šéœ€è¦åŠ å¼ºå¯¹æ•°æ®çš„ç›‘æ§&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ä¹Ÿé€‚ç”¨äºæ•°æ®é‡å·¨å¤§ï¼Œå®Œå…¨æ— æ³•æ‰¹é‡å­¦ä¹ çš„ç¯å¢ƒ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="æ‰¹é‡å­¦ä¹ ç¦»çº¿å­¦ä¹ ">æ‰¹é‡å­¦ä¹ ï¼ˆç¦»çº¿å­¦ä¹ ï¼‰&lt;/h4>
&lt;p>&lt;code>Batch Learning / Offline Learning&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/batch_learning.png"
width="887"
height="316"
srcset="https://blog.letout.cn/p/mechine-learning-basics/batch_learning_hu13b17d6db5217e228d729d78505e197d_53854_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/batch_learning_hu13b17d6db5217e228d729d78505e197d_53854_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="batch_learning"
class="gallery-image"
data-flex-grow="280"
data-flex-basis="673px"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¼˜ç‚¹ï¼šç®€å•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é—®é¢˜ï¼šè¦è€ƒè™‘å¦‚å¦‚ä½•é€‚åº”ç¯å¢ƒå˜åŒ–&lt;/p>
&lt;ul>
&lt;li>è§£å†³æ–¹æ¡ˆï¼šå®šæ—¶é‡æ–°æ‰¹é‡å­¦ä¹ &lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>ç¼ºç‚¹ï¼šæ¯æ¬¡é‡æ–°æ‰¹é‡å­¦ä¹ ï¼Œè¿è¡Œé‡å·¨å¤§ã€‚åœ¨æŸäº›ç¯å¢ƒå˜åŒ–éå¸¸å¿«çš„æƒ…å†µä¸‹ï¼Œç”šè‡³æ˜¯ä¸å¯èƒ½çš„ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å‚æ•°å­¦ä¹ å’Œéå‚æ•°å­¦ä¹ ">å‚æ•°å­¦ä¹ å’Œéå‚æ•°å­¦ä¹ &lt;/h3>
&lt;h4 id="å‚æ•°å­¦ä¹ ">å‚æ•°å­¦ä¹ &lt;/h4>
&lt;p>&lt;code>Parametric Learning&lt;/code>&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œä¸ºæˆ¿å±‹é¢ç§¯ä¸ä»·æ ¼çš„å…³ç³»æ›²çº¿ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/mechine-learning-basics/parametric_learning.png"
width="729"
height="405"
srcset="https://blog.letout.cn/p/mechine-learning-basics/parametric_learning_hu2c1f09a65fb7d83b5cf239a816caf4d4_38988_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/mechine-learning-basics/parametric_learning_hu2c1f09a65fb7d83b5cf239a816caf4d4_38988_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="parametric_learning"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="432px"
>&lt;/p>
&lt;p>ç‰¹ç‚¹ï¼šä¸€æ—¦å­¦ä¹ åˆ°äº†å‚æ•°ï¼Œå°±ä¸éœ€è¦åŸæœ‰çš„æ•°æ®é›†ã€‚&lt;/p>
&lt;h4 id="éå‚æ•°å­¦ä¹ ">éå‚æ•°å­¦ä¹ &lt;/h4>
&lt;p>&lt;code>Nonparametric Learning&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸å¯¹æ¨¡å‹è¿›è¡Œè¿‡å¤šå‡è®¾&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éå‚æ•°ä¸ç­‰äºæ²¡æœ‰å‚æ•°ï¼Œè€Œæ˜¯å¯¹æ•´ä¸ªä¸è¿›è¡Œå»ºæ¨¡ï¼Œä¸å­¦ä¹ ä¸€äº›å‚æ•°&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Spring Cloud Hystrix æœåŠ¡å®¹é”™</title><link>https://blog.letout.cn/p/spring-cloud-hystrix/</link><pubDate>Wed, 29 Jul 2020 21:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/spring-cloud-hystrix/</guid><description>&lt;h1 id="spring-cloud-hystrix">Spring Cloud Hystrix&lt;/h1>
&lt;p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿæ‹†åˆ†æˆäº†ä¸€ä¸ªä¸ªçš„æœåŠ¡å•å…ƒï¼Œå„å•å…ƒåº”ç”¨é—´é€šè¿‡æœåŠ¡æ³¨å†Œä¸è®¢é˜…çš„æ–¹å¼äº’ç›¸ä¾èµ–ã€‚ç”±äºæ¯ä¸ªå•å…ƒéƒ½åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­è¿è¡Œï¼Œå¦‚æœæŸä¸ªæœåŠ¡ä¸å¯ç”¨ï¼Œå¯èƒ½å¯¼è‡´çº§è”æ•…éšœï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨çš„æƒ…å†µï¼ˆé›ªå´©æ•ˆåº”ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œäº§ç”Ÿäº†æ–­è·¯å™¨ç­‰ä¸€ç³»åˆ—çš„æœåŠ¡ä¿æŠ¤æœºåˆ¶ã€‚&lt;/p>
&lt;h1 id="ç®€ä»‹">ç®€ä»‹&lt;/h1>
&lt;p>Spring Cloud Hystrixï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº Netflix çš„å¼€æºæ¡†æ¶ï¼Œå…·æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>æœåŠ¡é™çº§&lt;/li>
&lt;li>ä¾èµ–éš”ç¦»&lt;/li>
&lt;li>æœåŠ¡ç†”æ–­&lt;/li>
&lt;li>ç›‘æ§ï¼ˆHystrix Dashboardï¼‰&lt;/li>
&lt;/ul>
&lt;h1 id="å®ç°ä¸€ä¸ª-hystrix-server">å®ç°ä¸€ä¸ª Hystrix Server&lt;/h1>
&lt;h2 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-netflix-hystrix&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ·»åŠ æ³¨è§£">æ·»åŠ æ³¨è§£&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableCircuitBreaker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">HystrixApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">HystrixApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hystrix-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="hystrix-åº”ç”¨">Hystrix åº”ç”¨&lt;/h1>
&lt;h2 id="æœåŠ¡é™çº§">æœåŠ¡é™çº§&lt;/h2>
&lt;p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæ¥å£ &lt;code>/user/{id}&lt;/code> è·å–ç”¨æˆ·ä¿¡æ¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@PathVariable&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">userService&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ UserService ä¸­æ·»åŠ è°ƒç”¨æ–¹æ³•çš„æœåŠ¡é™çº§ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@HystrixCommand&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">fallbackMethod&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;userFallback&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ­£å¸¸çš„æœåŠ¡è°ƒç”¨å’Œä¸šåŠ¡ æ­¤å¤„ä»¥ restTemplate ä¸ºä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">url&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/user/{1}&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">userFallback&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å¤„ç†æœåŠ¡é™çº§éœ€è¦è¿”å›çš„å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æœåŠ¡é™çº§-openfiegn">æœåŠ¡é™çº§ OpenFiegn&lt;/h2>
&lt;h3 id="é…ç½®æ–‡ä»¶-1">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">feign&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hystrix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="openfeign-client-ç«¯å®ç°">OpenFeign Client ç«¯å®ç°&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@FeignClient&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;user&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// è¿œç¨‹æœåŠ¡å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">fallback&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">UserClientFallback&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span> &lt;span class="c1">// æŒ‡å®š å½“æœåŠ¡é™çº§æ—¶ï¼Œé‡‡ç”¨çš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">UserClient&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@GetMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/user/{id}&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@PathVariable&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å®ç° UserClient æ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">UserClientFallback&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">UserClient&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ResultVo&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="nf">getUserInfo&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@PathVariable&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å®ç°é™çº§å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ä¾èµ–éš”ç¦»">ä¾èµ–éš”ç¦»&lt;/h2>
&lt;p>SpringCloud Hystrix çš„ ä¾èµ–éš”ç¦» ç±»ä¼¼äºdockerçš„â€œèˆ±å£æ¨¡å¼â€ã€‚
dockeré€šè¿‡â€èˆ±å£æ¨¡å¼â€å®ç°è¿›ç¨‹éš”ç¦»ï¼Œä½¿å¾—å®¹å™¨ä¹‹é—´äº’ä¸å½±å“ã€‚
è€ŒHystrixä½¿ç”¨è¯¥æ¨¡å¼å®ç°ï¼šâ€œçº¿ç¨‹æ± éš”ç¦»â€ï¼Œä¼šä¸ºæ¯ä¸€ä¸ªHystrixCommandåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹æ± ï¼Œè¿™æ ·å°±ç®—æŸä¸ªåœ¨HystrixåŒ…è£…ä¸‹çš„ä¾èµ–æœåŠ¡å‡ºç°å»¶è¿Ÿè¿‡é«˜æƒ…å†µï¼Œä¹Ÿåªæ˜¯å¯¹è¯¥ä¾èµ–æœåŠ¡çš„è°ƒç”¨äº§ç”Ÿå½±å“ï¼Œå¹¶ä¸ä¼šæ‹–æ…¢å…¶ä»–æœåŠ¡ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ @HystrixCommand æ¥å°†æŸä¸ªå‡½æ•°åŒ…è£…æˆäº† Hystrix å‘½ä»¤æ—¶ï¼ŒHystrixæ¡†æ¶è‡ªåŠ¨åœ°ä¸ºè¿™ä¸ªå‡½æ•°å®ç°äº†ä¾èµ–éš”ç¦»ã€‚æ‰€ä»¥ä¾èµ–éš”ç¦»ï¼ŒæœåŠ¡é™çº§åœ¨ä½¿ç”¨æ—¶å€™éƒ½æ˜¯ä¸€ä½“åŒ–å®ç°çš„ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æœåŠ¡å®¹é”™ä¿æŠ¤ã€‚åœ¨ç¼–ç¨‹æ¨¡å‹ä¸Šå°±ä¼šéå¸¸æ–¹ä¾¿ã€‚&lt;/p>
&lt;h2 id="æœåŠ¡ç†”æ–­">æœåŠ¡ç†”æ–­&lt;/h2></description></item><item><title>Spring Cloud Zuul æœåŠ¡ç½‘å…³</title><link>https://blog.letout.cn/p/spring-cloud-zuul/</link><pubDate>Tue, 28 Jul 2020 15:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/spring-cloud-zuul/</guid><description>&lt;h1 id="spring-cloud-zuul">Spring Cloud Zuul&lt;/h1>
&lt;p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œåç«¯æœåŠ¡å¾€å¾€ä¸ç›´æ¥å¼€æ”¾ç»™è°ƒç”¨ç«¯ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªAPIç½‘å…³æ ¹æ®è¯·æ±‚çš„urlï¼Œè·¯ç”±åˆ°ç›¸åº”çš„æœåŠ¡ã€‚
å½“æ·»åŠ APIç½‘å…³åï¼Œåœ¨ç¬¬ä¸‰æ–¹è°ƒç”¨ç«¯å’ŒæœåŠ¡æä¾›æ–¹ä¹‹é—´å°±åˆ›å»ºäº†ä¸€é¢å¢™ï¼Œè¿™é¢å¢™ç›´æ¥ä¸è°ƒç”¨æ–¹é€šä¿¡è¿›è¡Œæƒé™æ§åˆ¶ï¼Œåå°†è¯·æ±‚å‡è¡¡åˆ†å‘ç»™åå°æœåŠ¡ç«¯ã€‚
Spring Cloud Zuul æ˜¯ä¸€ä¸ªåŸºäºJVMè·¯ç”±å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæä¾›åŠ¨æ€è·¯ç”±ï¼Œç›‘æ§ï¼Œå¼¹æ€§ï¼Œå®‰å…¨ç­‰çš„è¾¹ç¼˜æœåŠ¡ã€‚&lt;/p>
&lt;h1 id="ç®€ä»‹">ç®€ä»‹&lt;/h1>
&lt;p>Zuul çš„ä¸»è¦åŠŸèƒ½æ˜¯è·¯ç”±è½¬å‘å’Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰ã€‚ä¸åŒç±»å‹çš„ Filter ç”¨äºå¤„ç†è¯·æ±‚ï¼Œå¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>æƒé™æ§åˆ¶å’Œå®‰å…¨æ€§ï¼šå¯ä»¥è¯†åˆ«è®¤è¯éœ€è¦çš„ä¿¡æ¯å’Œæ‹’ç»ä¸æ»¡è¶³æ¡ä»¶çš„è¯·æ±‚&lt;/li>
&lt;li>ç›‘æ§ï¼šç›‘æ§è¯·æ±‚ä¿¡æ¯&lt;/li>
&lt;li>åŠ¨æ€è·¯ç”±ï¼šæ ¹æ®éœ€è¦åŠ¨æ€åœ°è·¯ç”±è¯·æ±‚åˆ°åå°çš„ä¸åŒæœåŠ¡é›†ç¾¤&lt;/li>
&lt;li>å‹åŠ›æµ‹è¯•ï¼šé€æ¸å¢å¤§åˆ°é›†ç¾¤çš„æµé‡ï¼Œä»¥ä¾¿è¿›è¡Œæ€§èƒ½è¯„ä¼°&lt;/li>
&lt;li>è´Ÿè½½å‡è¡¡ï¼šä¸ºæ¯ç§ç±»å‹çš„è¯·æ±‚åˆ†é…å®¹é‡å¹¶ä¸¢å¼ƒè¶…è¿‡é™é¢çš„è¯·æ±‚&lt;/li>
&lt;li>é™æµ&lt;/li>
&lt;li>é»‘ç™½åå•è¿‡æ»¤&lt;/li>
&lt;li>é™æ€èµ„æºå¤„ç†ï¼šç›´æ¥åœ¨zuulå¤„ç†é™æ€èµ„æºçš„å“åº”è€Œä¸éœ€è¦è½¬å‘è¿™äº›è¯·æ±‚åˆ°å†…éƒ¨é›†ç¾¤ä¸­&lt;/li>
&lt;/ul>
&lt;h1 id="åŸºç¡€ä½¿ç”¨">åŸºç¡€ä½¿ç”¨&lt;/h1>
&lt;h2 id="åˆ›å»ºä¸€ä¸ª-api-gateway">åˆ›å»ºä¸€ä¸ª api-gateway&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-zuul&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ·»åŠ æ³¨è§£">æ·»åŠ æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableZuulProxy&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ApiGatewayApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ApiGatewayApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">api-gateway&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">9000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># è‡ªå®šä¹‰è·¯ç”±è§„åˆ™&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">routes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">user&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/user/**&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">user &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æµ‹è¯•">æµ‹è¯•&lt;/h3>
&lt;p>é€šè¿‡ä»¥ä¸Šé…ç½®æ–‡ä»¶é…ç½®ï¼Œå³å¯é€šè¿‡ api-gateway æœåŠ¡å»è¯·æ±‚ user æœåŠ¡ã€‚&lt;/p>
&lt;p>å‡è®¾ user æœåŠ¡çš„ç«¯å£ä¸º 8080ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª api ä¸º &lt;code>/info&lt;/code>ã€‚
é€šè¿‡è®¿é—® &lt;code>http://localhost:9000/user/info&lt;/code>ï¼Œå³å¯è®¿é—®è¯¥ apiã€‚ï¼ˆè‹¥åŸæ¥å£åŒ…å«è·¯ç”±å‰ç¼€ /userï¼Œéœ€è¦ä½¿ç”¨ /user/user/info è®¿é—®ï¼‰&lt;/p>
&lt;h2 id="å¸¸ç”¨åŠŸèƒ½">å¸¸ç”¨åŠŸèƒ½&lt;/h2>
&lt;h3 id="ç»Ÿä¸€å‰ç¼€">ç»Ÿä¸€å‰ç¼€&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">prefix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/proxy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="header-è¿‡æ»¤åŠé‡å®šå‘æ·»åŠ -host">Header è¿‡æ»¤åŠé‡å®šå‘æ·»åŠ  Host&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># é»˜è®¤ä¸ºè¯¥é…ç½®ï¼Œä¼šè¿‡æ»¤ Cookie Set-Cookie Authorization ä¿¡æ¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># è®¾ç½®ä¸ºç©ºå³ä¸ä¼šè¿‡æ»¤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sensitive-headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cookie,Set-Cookie,Authorization&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">zuul&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">add-host-header&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># é‡å®šå‘ä¼šæ·»åŠ  host è¯·æ±‚å¤´&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æŸ¥çœ‹è·¯ç”±ä¿¡æ¯">æŸ¥çœ‹è·¯ç”±ä¿¡æ¯&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–-1">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.boot&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-boot-starter-actuator&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶-1">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">9000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">management&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">endpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exposure&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;routes&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è®¿é—®æ¥å£">è®¿é—®æ¥å£&lt;/h3>
&lt;ul>
&lt;li>è®¿é—® &lt;code>http://localhost:9000/actuator/routes&lt;/code> è·å–ä¿¡æ¯&lt;/li>
&lt;li>è®¿é—® &lt;code>http://localhost:9000/actuator/routes/details&lt;/code> è·å–è¯¦ç»†ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;h1 id="zuul-åº”ç”¨">Zuul åº”ç”¨&lt;/h1>
&lt;h2 id="zuul-filter">Zuul Filter&lt;/h2>
&lt;p>Filteræ˜¯Zuulçš„æ ¸å¿ƒï¼Œç”¨æ¥å®ç°å¯¹å¤–æœåŠ¡çš„æ§åˆ¶ã€‚Filteræœ‰4ä¸ªç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;ul>
&lt;li>pre
&lt;ul>
&lt;li>åœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡å‰æ‰§è¡Œã€‚&lt;/li>
&lt;li>æ¯”å¦‚æƒé™æ ¡éªŒã€æ‰“å°æ—¥å¿—ç­‰åŠŸèƒ½ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>routing
&lt;ul>
&lt;li>åœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡æ—¶æ‰§è¡Œã€‚&lt;/li>
&lt;li>ç”¨äºæ„å»ºå‘é€ç»™å¾®æœåŠ¡çš„è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ Apache HttpClient æˆ– Netfilx Ribbon è¯·æ±‚å¾®æœåŠ¡ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>post
&lt;ul>
&lt;li>è¿™ç§è¿‡æ»¤å™¨åœ¨è·¯ç”±åˆ°å¾®æœåŠ¡ä»¥åæ‰§è¡Œã€‚&lt;/li>
&lt;li>ä¸ºå“åº”æ·»åŠ æ ‡å‡†çš„HTTP Headerã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯å’ŒæŒ‡æ ‡ã€å°†å“åº”ä»å¾®æœåŠ¡å‘é€ç»™å®¢æˆ·ç«¯ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>error
&lt;ul>
&lt;li>å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œè¯¥è¿‡æ»¤å™¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.letout.cn/p/spring-cloud-zuul/zuul-core.png"
width="921"
height="566"
srcset="https://blog.letout.cn/p/spring-cloud-zuul/zuul-core_hu334c91cd99c88cb1ff369a39dfc29056_46538_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/spring-cloud-zuul/zuul-core_hu334c91cd99c88cb1ff369a39dfc29056_46538_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="zuul-core"
class="gallery-image"
data-flex-grow="162"
data-flex-basis="390px"
>&lt;/p>
&lt;h3 id="è‡ªå®šä¹‰-filter">è‡ªå®šä¹‰ Filter&lt;/h3>
&lt;p>å®ç°è‡ªå®šä¹‰ Filterï¼Œéœ€ç»§æ‰¿ &lt;code>com.netflix.zuul.ZuulFilter&lt;/code>ï¼Œå¹¶è¦†ç›–ç»§æ‰¿çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">MyFilter&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">ZuulFilter&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="nf">filterType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å®šä¹‰filterçš„ç±»å‹ï¼Œpreã€routeã€postã€error
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="nf">filterOrder&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å®šä¹‰filterçš„é¡ºåºï¼Œæ•°å­—è¶Šå°è¡¨ç¤ºé¡ºåºè¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">shouldFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ˜¯å¦éœ€è¦æ‰§è¡Œè¯¥filterï¼Œtrueè¡¨ç¤ºæ‰§è¡Œï¼Œfalseè¡¨ç¤ºä¸æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// filteréœ€è¦æ‰§è¡Œçš„å…·ä½“æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="zuul-é™æµ">Zuul é™æµ&lt;/h3>
&lt;p>é™æµåœ¨å‰ç½®è¿‡æ»¤å™¨ï¼ˆpreï¼‰å‰ä½¿ç”¨ï¼Œåœ¨è¯·æ±‚è¢«è½¬å‘å‰è°ƒç”¨ï¼Œä¸”ä¼˜å…ˆçº§æœ€é«˜ã€‚&lt;/p>
&lt;p>ä»¤ç‰Œæ¡¶é™æµç¤ºä¾‹ã€‚ä»¤ç‰Œæ¡¶ç®—æ³•èƒ½å¤Ÿåœ¨é™åˆ¶æ•°æ®çš„å¹³å‡ä¼ è¾“é€Ÿç‡çš„åŒæ—¶è¿˜å…è®¸æŸç§ç¨‹åº¦çš„çªå‘ä¼ è¾“ã€‚&lt;/p>
&lt;p>ä»¤ç‰Œæ¡¶ç®—æ³•ä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿåº¦å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼Œè€Œå¦‚æœè¯·æ±‚éœ€è¦è¢«å¤„ç†ï¼Œåˆ™éœ€è¦å…ˆä»æ¡¶é‡Œè·å–ä¸€ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œå¯å–æ—¶ï¼Œåˆ™æ‹’ç»æœåŠ¡ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/spring-cloud-zuul/token-bucket.png"
width="595"
height="428"
srcset="https://blog.letout.cn/p/spring-cloud-zuul/token-bucket_hu1695d7ffe20c41b60543bc6e8b7c644d_101106_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/spring-cloud-zuul/token-bucket_hu1695d7ffe20c41b60543bc6e8b7c644d_101106_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="token-bucket"
class="gallery-image"
data-flex-grow="139"
data-flex-basis="333px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">org.springframework.cloud.netflix.zuul.filters.support.FilterConstants&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">RateLimiterFilter&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">ZuulFilter&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç›´æ¥ä½¿ç”¨ guava ä¸­çš„ RateLimiter å®ç°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">RateLimiter&lt;/span> &lt;span class="n">RATE_LIMITER&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RateLimiter&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">filterType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">FilterConstants&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PRE_TYPE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">filterOrder&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é™æµæ˜¯æœ€é«˜ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥æ¯”æœ€é«˜ä¼˜å…ˆçº§ -3 è¿˜è¦å°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">FilterConstants&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">SERVLET_DETECTION_FILTER_ORDER&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">shouldFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">ZuulException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æœæ²¡æœ‰æ‹¿åˆ°ä»¤ç‰Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">RATE_LIMITER&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">tryAcquire&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RuntimeException&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="zuul-é‰´æƒ">Zuul é‰´æƒ&lt;/h3>
&lt;p>åœ¨è¯·æ±‚æœåŠ¡å‰ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æƒé™è®¿é—®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Component&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">TokenFilter&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">ZuulFilter&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">filterType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">FilterConstants&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">PRE_TYPE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">filterOrder&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è¶Šå°è¶Šé å‰ï¼Œæ”¾åœ¨ PRE_DECORATION_FILTER_ORDER ä¹‹å‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">PRE_DECORATION_FILTER_ORDER&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">shouldFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// éœ€è¦å®šä¹‰çš„é€»è¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">ZuulException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RequestContext&lt;/span> &lt;span class="n">requestContext&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RequestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCurrentContext&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">HttpServletRequest&lt;/span> &lt;span class="n">request&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">requestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getRequest&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// éœ€è¦æ ¹æ®å®é™…æƒ…å†µï¼Œä» header / cookie ä¸­è·å–ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">token&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">...;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæ ¡éªŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(...)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é¦–å…ˆè®¾ç½® zuul
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">requestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setSendZuulResponse&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è®¾ç½®è¿”å›ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">requestContext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setResponseStatusCode&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">HttpStatus&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">UNAUTHORIZED&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="zuul-è·¨åŸŸ">Zuul è·¨åŸŸ&lt;/h2>
&lt;p>åœ¨æµè§ˆå™¨ä¸­çš„ ajax è¯·æ±‚æ˜¯æœ‰åŒæºç­–ç•¥çš„ï¼Œå¦‚æœè¿åäº†åŒæºç­–ç•¥ï¼Œå°±ä¼šæœ‰è·¨åŸŸé—®é¢˜ã€‚åœ¨ Zuul ä¸­æ·»åŠ  CorsFilter è¿‡æ»¤å™¨ï¼Œæ˜¯è·¨åŸŸé—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">CorsConfig&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">CorsFilter&lt;/span> &lt;span class="nf">corsFilter&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">UrlBaseCorsConfigurationSource&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">UrlBaseCorsConfigrationSOurce&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">CorsConfiguration&lt;/span> &lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CorsConfiguration&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowCredentials&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowedOrigins&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singletonList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowedHeaders&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singletonList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span>&lt;span class="err">ï¼›&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setAllowedMethods&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Collections&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">singletonList&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setMaxAge&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="mi">300L&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">registerCorsConfiguration&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/**&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CorsFilter&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Spring Cloud Config ç»Ÿä¸€é…ç½®ä¸­å¿ƒ</title><link>https://blog.letout.cn/p/spring-cloud-config/</link><pubDate>Mon, 27 Jul 2020 12:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/spring-cloud-config/</guid><description>&lt;h1 id="spring-cloud-config">Spring Cloud Config&lt;/h1>
&lt;p>Spring Cloud Config æ˜¯ä¸€ä¸ªè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ç®¡ç†æ–¹æ¡ˆã€‚&lt;/p>
&lt;ul>
&lt;li>Server
&lt;ul>
&lt;li>æä¾›é…ç½®æ–‡ä»¶çš„å­˜å‚¨ï¼Œä»¥æ¥å£çš„å½¢å¼æä¾›é…ç½®æ–‡ä»¶çš„å†…å®¹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Client
&lt;ul>
&lt;li>é€šè¿‡æ¥å£è·å–æ•°æ®ï¼Œå¹¶ä¾æ®æ­¤æ•°æ®åˆå§‹åŒ–åº”ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="config-server">Config Server&lt;/h1>
&lt;h2 id="æ–°å»ºä¸€ä¸ª-git-ä»“åº“">æ–°å»ºä¸€ä¸ª git ä»“åº“&lt;/h2>
&lt;p>åœ¨ git æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œç”¨æ¥å­˜æ”¾é…ç½®æ–‡ä»¶ã€‚&lt;/p>
&lt;p>å¹¶åœ¨ä»“åº“ä¸­æ·»åŠ ç›¸åº”çš„é…ç½®æ–‡ä»¶ã€‚&lt;/p>
&lt;ul>
&lt;li>user-dev.yml&lt;/li>
&lt;li>user-test.yml&lt;/li>
&lt;li>user-prod.yml&lt;/li>
&lt;/ul>
&lt;h2 id="å…·ä½“å®ç°">å…·ä½“å®ç°&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-config-server&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ·»åŠ æ³¨è§£">æ·»åŠ æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableConfigServer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ConfigApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ConfigApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">config&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">git&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://github.com/xxx/confg &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># é…ç½®æ–‡ä»¶ä»“åº“åœ°å€&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">username&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">password&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">searchpath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">config-repo &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># gitä»“åº“åœ°å€ä¸‹çš„ç›¸å¯¹åœ°å€ï¼Œå¯é…ç½®å¤šä¸ª&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é€šè¿‡æ¥å£æŸ¥çœ‹é…ç½®">é€šè¿‡æ¥å£æŸ¥çœ‹é…ç½®&lt;/h3>
&lt;p>ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ä¼šè¢«è½¬æ¢æˆwebæ¥å£ï¼Œå¯åŠ¨åº”ç”¨åï¼Œå¯åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼ˆè‹¥é…ç½®æ–‡ä»¶çš„æ ¼å¼æœ‰é”™è¯¯ï¼Œå°†æ— æ³•è®¿é—®ï¼‰ã€‚&lt;/p>
&lt;p>å¦‚è®¿é—® &lt;code>http://localhost:8000/user/dev&lt;/code> å³å¯è¿”å› user-dev.yml çš„é…ç½®ä¿¡æ¯ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>/{application}/{profile}[/{label}]&lt;/code>&lt;/li>
&lt;li>&lt;code>/{application}-{profile}.yml&lt;/code>&lt;/li>
&lt;li>&lt;code>/{label}/{application}-{profile}.yml&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>profileï¼šé…ç½®ç¯å¢ƒï¼Œlabelï¼šä»“åº“åˆ†æ”¯ã€‚&lt;/p>
&lt;h1 id="config-client">Config Client&lt;/h1>
&lt;h2 id="åœ¨é¡¹ç›®ä¸­åˆ›å»º-bootstrapyml">åœ¨é¡¹ç›®ä¸­åˆ›å»º bootstrap.yml&lt;/h2>
&lt;p>åœ¨é¡¹ç›®ä¸­ï¼Œbootstrap.yml ä¼šä¼˜å…ˆäº application.yml åŠ è½½ã€‚&lt;/p>
&lt;h3 id="applicationyml-åº”ç”¨åœºæ™¯">application.yml åº”ç”¨åœºæ™¯&lt;/h3>
&lt;p>ä¸»è¦ç”¨äº Spring Boot é¡¹ç›®çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚&lt;/p>
&lt;h3 id="bootstrapyml-åº”ç”¨åœºæ™¯">bootstrap.yml åº”ç”¨åœºæ™¯&lt;/h3>
&lt;ul>
&lt;li>ä»é¢å¤–çš„èµ„æºåŠ è½½é…ç½®ä¿¡æ¯ï¼ˆå¦‚ä½¿ç”¨ Spring Cloud Config æ—¶ï¼‰&lt;/li>
&lt;li>ä¸€äº›å›ºå®šä¸èƒ½è¢«è¦†ç›–çš„å±æ€§ï¼ˆå…·æœ‰é«˜ä¼˜å…ˆçº§ï¼Œä¸€èˆ¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®æˆ–applicationä¸­åŒåé…ç½®è¦†ç›–ï¼‰&lt;/li>
&lt;li>ä¸€äº› åŠ å¯†/è§£å¯† çš„åœºæ™¯&lt;/li>
&lt;/ul>
&lt;h2 id="å…·ä½“å®ç°-1">å…·ä½“å®ç°&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–-1">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-config&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶-1">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">user &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># è¯¥åº”ç”¨è·å–ä¹‹å‰é…ç½®å¥½çš„ user-dev.yml &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8000/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">profile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">master&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloud&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">discovery&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å¯ç”¨æœåŠ¡å‘ç° (Eureka)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">config &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># spring cloud config server åº”ç”¨åç§°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">profile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">master&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å¯åŠ¨æœåŠ¡">å¯åŠ¨æœåŠ¡&lt;/h3>
&lt;p>å¯åŠ¨æœåŠ¡æ—¶ï¼Œå³ä¼šå…ˆå» git ä»“åº“è·å–é…ç½®ä¿¡æ¯ã€‚&lt;/p>
&lt;h1 id="é…ç½®ä¿¡æ¯è‡ªåŠ¨æ›´æ–°">é…ç½®ä¿¡æ¯è‡ªåŠ¨æ›´æ–°&lt;/h1>
&lt;p>å½“ git ä»“åº“ä¸­çš„é…ç½®ä¿¡æ¯æ›´æ–°åï¼Œä½¿ç”¨é…ç½®çš„å®¢æˆ·ç«¯å¹¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°é…ç½®ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€äº›æœºåˆ¶å»è§¦å‘é…ç½®çš„æ›´æ–°ã€‚&lt;/p>
&lt;h2 id="actuator">actuator&lt;/h2>
&lt;h3 id="æ·»åŠ ä¾èµ–-2">æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.boot&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-boot-starter-actuator&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ·»åŠ æ³¨è§£æ‰“å¼€æ›´æ–°æœºåˆ¶">æ·»åŠ æ³¨è§£ï¼Œæ‰“å¼€æ›´æ–°æœºåˆ¶&lt;/h3>
&lt;p>é€šè¿‡åœ¨éœ€è¦åŠ è½½æ›´æ–°é…ç½®çš„ç±»ä¸Šæ·»åŠ  &lt;code>@RefreshScope&lt;/code>ï¼Œå½“å®¢æˆ·ç«¯é€šè¿‡è§¦å‘ POST æ–¹å¼çš„ &lt;code>/refresh&lt;/code> æ—¶ï¼Œä¼šè‡ªåŠ¨å°†æ–°çš„é…ç½®æ›´æ–°åˆ°ç›¸åº”çš„å­—æ®µä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RefreshScope&lt;/span> &lt;span class="c1">// è¯¥ç±»ä¸­é…ç½®ç›¸å…³ä¼šè‡ªåŠ¨åˆ·æ–°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nd">@RestController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ActuatorController&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Value&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;${env}&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@RequestMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;/env&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">env&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">env&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="é…ç½®æ–‡ä»¶-2">é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># server ç«¯æ·»åŠ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">management&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">endpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exposure&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># client ç«¯æ·»åŠ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">management&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">endpoints&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exposure&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">refresh&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æµ‹è¯•è‡ªåŠ¨åˆ·æ–°">æµ‹è¯•è‡ªåŠ¨åˆ·æ–°&lt;/h3>
&lt;p>å½“ git ä»“åº“ä¸­é…ç½®æ–‡ä»¶æ›´æ–°åï¼Œé€šè¿‡å‘é€ POST è¯·æ±‚åˆ° &lt;code>/refresh&lt;/code> åï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨è·å–æœ€æ–°é…ç½®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl -v -X POST http://localhost:8080/actuator/refresh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="spring-cloud-bus-æ¨è">Spring Cloud Bus ï¼ˆæ¨èï¼‰&lt;/h2>
&lt;p>é€šè¿‡ spring cloud busï¼Œé€šè¿‡ POST è¯·æ±‚ &lt;code>/bus-refresh&lt;/code>ï¼Œå®ç°è‡ªåŠ¨è·å–æœ€æ–°é…ç½®ã€‚&lt;/p>
&lt;p>è‡³æ­¤ä¸¤ç§æ¶ˆæ¯ä»£ç†ï¼š&lt;/p>
&lt;ul>
&lt;li>RabbitMQ&lt;/li>
&lt;li>Kafka&lt;/li>
&lt;/ul>
&lt;h2 id="webhook">WebHook&lt;/h2>
&lt;p>WebHook æ˜¯å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé€šè¿‡å‘é€ http post è¯·æ±‚çš„æ–¹å¼æ¥é€šçŸ¥ä¿¡æ¯æ¥æ”¶æ–¹ã€‚&lt;/p>
&lt;p>é€šè¿‡åˆ›å»º WebHook å³å¯è‡ªåŠ¨è§¦å‘ POST è¯·æ±‚ï¼Œè®©å®¢æˆ·ç«¯åŠ¨æ€åˆ·æ–°é…ç½®ã€‚&lt;/p></description></item><item><title>Spring Cloud æœåŠ¡é€šä¿¡</title><link>https://blog.letout.cn/p/spring-cloud-openfeign/</link><pubDate>Sun, 26 Jul 2020 21:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/spring-cloud-openfeign/</guid><description>&lt;h1 id="spring-cloud-æœåŠ¡é€šä¿¡">Spring Cloud æœåŠ¡é€šä¿¡&lt;/h1>
&lt;ul>
&lt;li>
&lt;p>åŒæ­¥é€šä¿¡ï¼š&lt;/p>
&lt;ul>
&lt;li>dobbo é€šè¿‡ RPC è¿œç¨‹è°ƒç”¨ã€‚&lt;/li>
&lt;li>spring cloud é€šè¿‡ REST æ¥å£è°ƒç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å¼‚æ­¥é€šä¿¡ï¼š&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡æ¶ˆæ¯å¯¹åˆ—ï¼Œå¦‚ï¼šRabbitMQï¼ŒKafkaï¼ŒActiveM ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>æœ¬æ–‡ä¸»è¦ä»‹ç» Spring Cloud ä½¿ç”¨ RestTemplate / OpenFeign è¿›è¡Œ REST æ¥å£è°ƒç”¨ã€‚&lt;/p>
&lt;h1 id="resttemplate">RestTemplate&lt;/h1>
&lt;h2 id="é€šè¿‡-resttemplate-è¿›è¡Œè°ƒç”¨">é€šè¿‡ RestTemplate è¿›è¡Œè°ƒç”¨&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="nf">getProductMsg&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="n">restTemplate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RestTemplate&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="n">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;http://example.com/product/info&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// è¿œç¨‹è°ƒç”¨åœ°å€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">ProductInfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="c1">// response ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">id&lt;/span> &lt;span class="c1">// éœ€è¦ä¼ é€’çš„å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ©ç”¨-loadbalancerclient-è·å–ä¿¡æ¯">åˆ©ç”¨ LoadBalancerClient è·å–ä¿¡æ¯&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="n">LoadBalancerClient&lt;/span> &lt;span class="n">loadBalancerClient&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="nf">getProductMsg&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="n">restTemplate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RestTemplate&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ServiceInstance&lt;/span> &lt;span class="n">serviceInstance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">loadBalancerClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">choose&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;PRODUCT&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ©ç”¨ loadBalancerClient é€šè¿‡åº”ç”¨åï¼ˆspring.application.nameï¼‰è·å–ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">format&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;http://%s:%s&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">serviceInstance&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getHost&lt;/span>&lt;span class="o">(),&lt;/span> &lt;span class="n">serviceInstance&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getPort&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;/product/info&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="n">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">ProductInfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ©ç”¨-loadbalance-åœ¨-resttemplate-ä¸­ç›´æ¥ä½¿ç”¨åº”ç”¨åç§°">åˆ©ç”¨ LoadBalance åœ¨ RestTemplate ä¸­ç›´æ¥ä½¿ç”¨åº”ç”¨åç§°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">RestTemplateConfig&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Bean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@LoadBalance&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="nf">restTemplate&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RestTemplate&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="n">RestTemplate&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="nf">getProductMsg&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ©ç”¨ @LoadBalance å¯ä»¥åœ¨ RestTemplate ä¸­ä½¿ç”¨åº”ç”¨åç§°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">ProductInfo&lt;/span> &lt;span class="n">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">restTemplate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getForObject&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;http://PRODUCT/product/msg&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">ProductInfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="openfeign-æ¨è">OpenFeign ï¼ˆæ¨èï¼‰&lt;/h1>
&lt;h2 id="å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-openfeign&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ·»åŠ å¯åŠ¨æ³¨è§£">æ·»åŠ å¯åŠ¨æ³¨è§£&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">org.springframework.cloud.openfeign.EnableFeignClients&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableFeignClients&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">FeignApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">FeignApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å…·ä½“å®ç°">å…·ä½“å®ç°&lt;/h2>
&lt;p>ç°åœ¨æœ‰ä¸¤ä¸ªæœåŠ¡ï¼Œåˆ†åˆ«ä¸º Prodcut å’Œ Order ã€‚
éœ€æ±‚ï¼š Order æœåŠ¡ä¸­ï¼Œå®¢æˆ·è¿›è¡Œäº†ä¸‹å•æ“ä½œåï¼Œè°ƒç”¨ Productï¼ˆFeignï¼‰ çš„è¿›è¡Œå‡åº“å­˜æ“ä½œã€‚&lt;/p>
&lt;ul>
&lt;li>Product æœåŠ¡ä¸­ï¼Œå®šä¹‰è¿œç¨‹è°ƒç”¨ç«¯ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">DecreaseStockInput&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@FeignClient&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;product&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1">// name: è¿œç¨‹æœåŠ¡å(Spring.application.name)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">ProductClient&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@RequestMapping&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/product/decrease_stock&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">decreaseStock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nd">@RequestBody&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">DecreaseStockInput&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">decreaseStockInputList&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Order æœåŠ¡ä¸­ï¼Œå¯¹ Product Client è¿›è¡Œè°ƒç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">OrderServiceImpl&lt;/span> &lt;span class="kd">implements&lt;/span> &lt;span class="n">OrderService&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ³¨å…¥çš„ä¸º Product ä¸­çš„ ProductClient
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// é€šè¿‡ä¾èµ–çš„æ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nd">@Autowired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">ProductClient&lt;/span> &lt;span class="n">productClient&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">OrderDTO&lt;/span> &lt;span class="nf">create&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">OrderDTO&lt;/span> &lt;span class="n">orderDTO&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// è°ƒç”¨ Product æœåŠ¡ä¸­çš„ api è¿›è¡Œå‡åº“å­˜æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">productClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">decreaseStock&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">decreaseStockInputList&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Spring Cloud Eureka æœåŠ¡æ³¨å†Œä¸å‘ç°</title><link>https://blog.letout.cn/p/spring-cloud-eureka/</link><pubDate>Sat, 25 Jul 2020 13:14:45 +0800</pubDate><guid>https://blog.letout.cn/p/spring-cloud-eureka/</guid><description>&lt;h1 id="eureka-æ‰¾åˆ°å•¦">Eureka æ‰¾åˆ°å•¦ï¼&lt;/h1>
&lt;p>æœåŠ¡æ³¨å†Œä¸å‘ç°&lt;/p>
&lt;h1 id="ç®€ä»‹">ç®€ä»‹&lt;/h1>
&lt;ul>
&lt;li>Spring Cloud å°è£…äº† Netflix å…¬å¸å¼€å‘çš„ Eureka æ¨¡å—æ¥å®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç°ã€‚é‡‡ç”¨äº† C-S çš„è®¾è®¡æ¶æ„ã€‚ç”¨æ¥ç®€åŒ–ä¸æœåŠ¡å™¨çš„äº¤äº’ã€ä½œä¸ºè½®è¯¢è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶æä¾›æœåŠ¡çš„æ•…éšœåˆ‡æ¢æ”¯æŒã€‚&lt;/li>
&lt;li>ç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆã€‚
&lt;ul>
&lt;li>Ereka Serverã€‚ æ³¨å†Œä¸­å¿ƒ&lt;/li>
&lt;li>Ereka Clientã€‚ æœåŠ¡æ³¨å†Œ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>Eureka é‡‡ç”¨äº†&lt;strong>å®¢æˆ·ç«¯å‘ç°&lt;/strong>çš„æ–¹å¼ï¼Œåœ¨æœåŠ¡è¿è¡Œæ—¶ï¼Œé€šè¿‡(è½®è®­ã€hashç­‰è´Ÿè½½å‡è¡¡æœºåˆ¶ç­‰æ–¹å¼)æ³¨å†Œä¸­å¿ƒæ‰¾åˆ°éœ€è¦æœåŠ¡ï¼ˆå³ A é€šè¿‡ æ³¨å†Œä¸­å¿ƒ æ‰¾ Bï¼Œéœ€è¦è°æ‰¾è°ï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/spring-cloud-eureka/eureka-server-discovery.png"
width="1202"
height="571"
srcset="https://blog.letout.cn/p/spring-cloud-eureka/eureka-server-discovery_huebe0236b66186033cdf1592e4bf67abe_104496_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/spring-cloud-eureka/eureka-server-discovery_huebe0236b66186033cdf1592e4bf67abe_104496_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-server-discovery"
class="gallery-image"
data-flex-grow="210"
data-flex-basis="505px"
>&lt;/p>
&lt;h1 id="eureka-server">Eureka Server&lt;/h1>
&lt;p>æ³¨å†Œä¸­å¿ƒè®°å½•ç€æ‰€æœ‰åº”ç”¨çš„ä¿¡æ¯å’ŒçŠ¶æ€(å¦‚ï¼šåº”ç”¨åï¼Œæ‰€åœ¨æœåŠ¡å™¨ï¼Œæ˜¯å¦æ­£å¸¸å·¥ä½œ)ã€‚&lt;/p>
&lt;h2 id="å®ç°ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ">å®ç°ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ&lt;/h2>
&lt;h3 id="1-å¼•å…¥ä¾èµ–">1. å¼•å…¥ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-eureka-server&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-æ·»åŠ å¯åŠ¨æ³¨è§£">2. æ·»åŠ å¯åŠ¨æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableEurekaServer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">EurekaServerApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">EurekaServerApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-é…ç½®æ–‡ä»¶">3. é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverï¼Œä½œä¸º Server ç«¯ä¸éœ€è¦&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æ˜¯å¦ä»Eureka Serverè·å–æ³¨å†Œä¿¡æ¯ï¼Œä½œä¸º Server ç«¯ä¸éœ€è¦&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æ¥æ”¶çš„æ˜¯ä¸€ä¸ª Map ç»“æ„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="4-å¯åŠ¨ç¨‹åº">4. å¯åŠ¨ç¨‹åº&lt;/h3>
&lt;p>å¯åŠ¨åï¼Œè®¿é—® http://localhost:8761/ï¼Œå³å¯çœ‹åˆ° Spring Eureka ç•Œé¢ã€‚&lt;/p>
&lt;h2 id="å®ç°-eureka-é›†ç¾¤">å®ç° Eureka é›†ç¾¤&lt;/h2>
&lt;p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯æœ€é‡è¦çš„åŸºç¡€éƒ¨åˆ†ï¼Œç†åº”éšæ—¶å¤„äºå¯ä»¥æä¾›æœåŠ¡çš„çŠ¶æ€ã€‚ä¸ºäº†ç»´æŒå…¶å¯ç”¨æ€§ï¼Œé€šå¸¸ä¼šé‡‡ç”¨é›†ç¾¤çš„æ–¹æ¡ˆã€‚Eurekaé€šè¿‡&lt;strong>äº’ç›¸æ³¨å†Œ&lt;/strong>çš„æ–¹å¼æ¥å®ç°é«˜å¯ç”¨çš„éƒ¨ç½²&lt;/p>
&lt;h3 id="åŒèŠ‚ç‚¹æ³¨å†Œ">åŒèŠ‚ç‚¹æ³¨å†Œ&lt;/h3>
&lt;p>åˆ›å»ºä¸¤å°æœåŠ¡å™¨ï¼Œç«¯å£åˆ†åˆ«ä¸º 8761 å’Œ 8762ã€‚&lt;/p>
&lt;p>å°† 8761 çš„æœåŠ¡å™¨é…ç½®æŒ‡å‘ 8761ï¼Œå°† 8762 çš„æœåŠ¡å™¨æŒ‡å‘ 8761ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å°† service-url æŒ‡å‘ 8762&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8762/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8762&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service-url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å°† service-url æŒ‡å‘ 8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯åŠ¨ç¨‹åºåï¼Œé€šè¿‡ http://localhost:8761/ å’Œ http://localhost:8762/ éƒ½å¯è®¿é—® Eureka ç•Œé¢ã€‚å¹¶ä¸”å¯ä»¥çœ‹åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¿¡æ¯èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-1.png"
width="1849"
height="596"
srcset="https://blog.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-1_huba86fcdb4b5d0d0d30bd35cfb721e86e_55103_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-1_huba86fcdb4b5d0d0d30bd35cfb721e86e_55103_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-server-cluster-1"
class="gallery-image"
data-flex-grow="310"
data-flex-basis="744px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-2.png"
width="1745"
height="582"
srcset="https://blog.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-2_hu2962bd37558dde85fe30af951e20dc3b_54772_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/spring-cloud-eureka/eureka-server-cluster-2_hu2962bd37558dde85fe30af951e20dc3b_54772_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-server-cluster-2"
class="gallery-image"
data-flex-grow="299"
data-flex-basis="719px"
>&lt;/p>
&lt;h3 id="å¤šèŠ‚ç‚¹æ³¨å†Œ">å¤šèŠ‚ç‚¹æ³¨å†Œ&lt;/h3>
&lt;p>åœ¨ç”Ÿäº§ä¸­æˆ‘ä»¬éœ€è¦ä¸‰å°æˆ–è€…å¤§äºä¸‰å°çš„æ³¨å†Œä¸­å¿ƒæ¥ä¿è¯æœåŠ¡çš„ç¨³å®šæ€§ï¼Œé…ç½®çš„åŸç†å…¶å®éƒ½ä¸€æ ·ï¼šå°†æ³¨å†Œä¸­å¿ƒåˆ†åˆ«æŒ‡å‘å…¶å®ƒçš„æ³¨å†Œä¸­å¿ƒã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8761&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8762/eureka/,http://localhost:8763/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8762&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/,http://localhost:8763/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8763&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register-with-eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-registry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/,http://localhost:8762/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="eureka-client">Eureka Client&lt;/h1>
&lt;h2 id="å®ç°ä¸€ä¸ªæœåŠ¡æ³¨å†Œ">å®ç°ä¸€ä¸ªæœåŠ¡æ³¨å†Œ&lt;/h2>
&lt;h3 id="1-ä¾èµ–é…ç½®">1. ä¾èµ–é…ç½®&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.springframework.cloud&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>spring-cloud-starter-eureka&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-æ·»åŠ å¯åŠ¨æ³¨è§£-1">2. æ·»åŠ å¯åŠ¨æ³¨è§£&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">org.springframework.cloud.netflix.eureka.server.EnableEurekaServer&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@EnableDiscoveryClient&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@SpringBootApplication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ClientApplication&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SpringApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ClientApplication&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-é…ç½®æ–‡ä»¶-1">3. é…ç½®æ–‡ä»¶&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">spring&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">application&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eureka-client&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">eureka&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">defaultZone&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://localhost:8761/eureka/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># instance: # è‡ªå®šä¹‰é“¾æ¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># hostname: example.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="4-å¯åŠ¨ç¨‹åº-1">4. å¯åŠ¨ç¨‹åº&lt;/h3>
&lt;p>å¯åŠ¨ç¨‹åºåï¼Œè¿›å…¥ Eureka é¡µé¢ http://localhost:8761/eureka/ï¼Œå³å¯çœ‹åˆ°æ³¨å†Œçš„æœåŠ¡ eureka-clientã€‚&lt;/p>
&lt;p>&lt;img src="https://blog.letout.cn/p/spring-cloud-eureka/eureka-client.png"
width="1888"
height="356"
srcset="https://blog.letout.cn/p/spring-cloud-eureka/eureka-client_hu7c72d91007eb8a4a1109447929086548_37277_480x0_resize_box_3.png 480w, https://blog.letout.cn/p/spring-cloud-eureka/eureka-client_hu7c72d91007eb8a4a1109447929086548_37277_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="eureka-client"
class="gallery-image"
data-flex-grow="530"
data-flex-basis="1272px"
>&lt;/p>
&lt;h1 id="æ€»ç»“">æ€»ç»“&lt;/h1>
&lt;ul>
&lt;li>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯æœ€é‡è¦çš„åŸºç¡€éƒ¨åˆ†&lt;/li>
&lt;li>@EnableEurekaServer @EnableEurekaClient&lt;/li>
&lt;li>å…·æœ‰ å¿ƒè·³æ£€æµ‹ï¼Œå¥åº·æ£€æŸ¥ï¼Œè´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½&lt;/li>
&lt;li>ä¸ºä¿è¯é«˜å¯ç”¨ï¼Œå»ºè®®é›†ç¾¤éƒ¨ç½²&lt;/li>
&lt;/ul></description></item></channel></rss>