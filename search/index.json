[{"content":"è¯´æ˜ Ubuntu æœ‰äº›ç¬¬ä¸‰æ–¹è½¯ä»¶åªæä¾›äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ï¼ˆå‹ç¼©åŒ…æˆ– AppImageï¼‰ï¼Œè€Œä¸æ˜¯å®‰è£…åŒ…æˆ–è€… apt æºï¼Œè¿™æ—¶å€™éœ€è¦æˆ‘ä»¬å»è‡ªå·±è§£å‹æ–‡ä»¶ï¼Œæ”¾åœ¨è‡ªå®šä¹‰ç›®å½•ï¼Œå¹¶è¿›è¡Œé…ç½®ã€‚\nå¹³å¸¸ä½¿ç”¨æ¡Œé¢ç¯å¢ƒçš„è¯ï¼Œè¿™æ ·å®‰è£…åï¼Œæ›´æ–°è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦çš„ï¼Œä¸€æ›´æ–°å°±è¦ä¿®æ”¹å¾ˆå¤šåœ°æ–¹ã€‚\nè¿™é‡Œä»‹ç»æˆ‘å¹³å¸¸çš„é…ç½®æ–¹å¼ï¼Œæ¯æ¬¡æ›´æ–°åï¼Œåªéœ€è¦ä¿®æ”¹è½¯é“¾æ¥å³å¯ï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºæ–¹ä¾¿çš„ã€‚\næ–¹å¼ ä»¥ cfw å®‰è£…ä¸ºä¾‹ï¼ŒLinux æä¾› .tar.gz çš„æ‰§è¡Œæ–‡ä»¶ã€‚\næˆ‘é€šå¸¸éƒ½æŠŠè¿™æ ·çš„è½¯ä»¶éƒ½ç»Ÿä¸€æ”¾åˆ° ~/Applications ä¸­ã€‚\nğŸ•ï¸ é¦–å…ˆåˆ›å»ºä¸€ä¸ªå®‰è£…çš„è½¯ä»¶çš„æ–‡ä»¶å¤¹ 1 mkdir -p ~/Application/clash ğŸï¸ å°†ä¸‹è½½çš„æ–‡ä»¶è§£å‹åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­ 1 tar -xzvf Clash.for.Windows-0.19.12 -C ~/Application/clash ğŸœï¸ åˆ›å»ºå¯åŠ¨æ–‡ä»¶çš„è½¯è¿æ¥ 1 ln -s ./Clash\\ for\\ Windows-0.19.12-x64-linux/cfw ./clash é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¯æ¬¡å¯åŠ¨åº”ç”¨éƒ½ä½¿ç”¨è¿™ä¸ªè½¯é“¾æ¥è¿›è¡Œæ“ä½œï¼Œå½“éœ€è¦å‡çº§åº”ç”¨æ—¶ï¼Œåªéœ€è¦åˆ›å»ºæ–°çš„è½¯é“¾æ¥ï¼ŒæŒ‡å‘æ–°çš„å¯åŠ¨æ–‡ä»¶ã€‚æœ€åçš„æ•ˆæœå¦‚ä¸‹ï¼š\n1 2 3 4 5 $ tree . -L 1 . â”œâ”€â”€ clash -\u0026gt; ./Clash for Windows-0.19.12-x64-linux/cfw â”œâ”€â”€ Clash for Windows-0.19.12-x64-linux â””â”€â”€ Clash for Windows-0.19.2-x64-linux ğŸ–ï¸ æ·»åŠ æ¡Œé¢å›¾æ ‡ 1 vim ~/.local/share/applications/clw.desktop æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 2 3 4 5 6 7 8 9 [Desktop Entry] Name=Clash for Linux Icon=/home/emery/Applications/icon/clash_icon.png # æ›¿æ¢ä¸ºè‡ªå·±çš„ç›®å½• Comment=Clash for Linux Exec=\u0026#34;/home/emery/Applications/Clash/clash\u0026#34; %u # æ›¿æ¢ä¸ºè‡ªå·±çš„ç›®å½• Type=Application Categories=Network Terminal=false StartupNotify=true ","date":"2022-06-02T02:02:02+08:00","image":"https://emerywan.github.io/blog/imgs/4.jpeg","permalink":"https://emerywan.github.io/blog/p/ubuntu-software-install/","title":"Ubuntu å®‰è£…è½¯ä»¶æ¨èæ–¹å¼"},{"content":"ä½¿ç”¨ ZooKeeper å®ç° åŸç† æŒä¹…èŠ‚ç‚¹ï¼ˆçº¢è‰²ï¼‰\nç¬æ—¶èŠ‚ç‚¹ï¼ˆé»„è‰²ï¼‰ï¼šä¸å¯å†æœ‰å­èŠ‚ç‚¹ï¼Œä¼šè¯ç»“æŸåç¬æ—¶èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ¶ˆå¤±\nåˆ©ç”¨ Zookeeper çš„ç¬æ—¶æœ‰åºèŠ‚ç‚¹çš„ç‰¹æ€§ï¼Œå¤šçº¿ç¨‹å¹¶å‘åˆ›å»ºç¬æ—¶èŠ‚ç‚¹æ—¶ï¼Œå¾—åˆ°æœ‰åºçš„åºåˆ—\nåºå·æœ€å°çš„çº¿ç¨‹è·å¾—é”ï¼Œå…¶ä»–çš„çº¿ç¨‹åˆ™ç›‘å¬è‡ªå·±åºå·çš„å‰ä¸€ä¸ªåºå·ï¼›å½“å‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œåˆ é™¤è‡ªå·±åºå·çš„èŠ‚ç‚¹ï¼›ä¸‹ä¸€ä¸ªåºå·çš„çº¿ç¨‹å¾—åˆ°é€šçŸ¥ï¼Œå°†ç»§ç»­æ‰§è¡Œ\nåˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå·²ç»ç¡®å®šäº†çº¿ç¨‹çš„æ‰§è¡Œé¡ºåº\nå®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 public class ZkLock implements AutoCloseable, Watcher { private ZooKeeper zooKeeper; private String znode; // å½“å‰çº¿ç¨‹åˆ›å»ºçš„è·¯å¾„ public ZkLock(String connectString, int sessionTimeout) throws IOException { this.zooKeeper = new ZooKeeper(connectString, sessionTimeout, this); } /** * try-catch-with-resource */ public void clode() throws Exception { zooKeeper.delete(znode, -1); zooKeeper.close(); log.info(\u0026#34;é‡Šæ”¾é”\u0026#34;); } /** * è§‚å¯Ÿå™¨ */ @Override public void process(WatchedEvent watchedEvent) { // å½“å‰ä¸€ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤æ—¶ï¼Œå¯å”¤é†’è·å–é”çš„ç­‰å¾…ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹è·å–äº†é” if (watchedEvent.getType() == Event.EventType.NodeDeleted) { synchronized (this) { notify(); } } } /** * è·å–é” */ public boolean getLock(String businessCode) { try { String path = \u0026#34;/\u0026#34; + businessCode; Stat stat = zooKeeper.exists(path, false); if (null == stat) { // å½“å‰ä¸šåŠ¡è‹¥æ²¡æœ‰æŒä¹…èŠ‚ç‚¹ // å…ˆåˆ›å»ºä¸€ä¸ªæŒä¹…èŠ‚ç‚¹ï¼Œåœ¨æŒä¹…èŠ‚ç‚¹é‡Œåˆ›å»ºç¬æ—¶èŠ‚ç‚¹ zooKeeper.create( path, businessCode.getBytes(StandardCharsets.UTF_8), ZooDefs.Ids.OPEN_ACL_UNSAFE, // å…¬å¼€æƒé™ï¼Œä¸ä½¿ç”¨ç”¨æˆ·åå¯†ç å°±èƒ½è®¿é—®è¿™ä¸ªèŠ‚ç‚¹ CreateMode.PERSISTENT ); } // åˆ›å»ºç¬æ—¶æœ‰åºèŠ‚ç‚¹ String subPath = \u0026#34;/\u0026#34; + businessCode + \u0026#34;/\u0026#34; + businessCode + \u0026#34;_\u0026#34;; znode = zooKeeper.create( subPath, businessCode.getBytes(StandardCharsets.UTF_8), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL ); // è·å–è¯¥ä¸šåŠ¡ä¸‹çš„æ‰€æœ‰ç¬æ—¶èŠ‚ç‚¹ï¼Œè¿›è¡Œæ¯”è¾ƒæ’åº List\u0026lt;String\u0026gt; childrenNodes = zooKeeper.getChildren(path, false); Collections.sort(childrenNodes); // å¦‚æœåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯å½“å‰åˆ›å»ºçš„èŠ‚ç‚¹ï¼Œç›´æ¥è·å–é” String firstNode = childrenNodes.get(0); if (znode.endsWith(firstNode)) { return true; } // ç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç­‰å¾…è·å–é” String lastNode = firstNode; for (String node : childrenNode) { // æ‰¾åˆ°å½“å‰èŠ‚ç‚¹ï¼Œç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹ if (znode.endWith(node)) { zooKeeper.exists(\u0026#34;/\u0026#34; + businessCode + \u0026#34;/\u0026#34; + lastNode, this); break; } else { lastNode = node; } } synchronized (this) { // è®©å½“å‰çº¿ç¨‹é˜»å¡ï¼Œå¹¶ä¸”ä¼šé‡Šæ”¾é” // ä¸Šé¢çš„åŒæ­¥ä»£ç å—æ‰ä¼šè·å¾—é”å¹¶æ‰§è¡Œ notify() wait(); } return true; } catch (KeeperException e) { e.printStackTrace(); } catch (InterruptedException e) { e.printStackTrace(); } return false; } } æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Slf4j @RestController public class ZkLockController { @GetMapping(\u0026#34;/zkLock\u0026#34;) public String zkLock() { log.info(\u0026#34;è¿›å…¥æ–¹æ³•\u0026#34;); try (ZkLock zklock = new ZkLock(\u0026#34;127.0.0.1:2181\u0026#34;, 10000)) { if (zkLock.getLock(\u0026#34;order\u0026#34;)) { log.info(\u0026#34;è·å–äº†é”\u0026#34;); try { TimeUtil.SECONDS.sleep(10); // æ¨¡æ‹Ÿä¸šåŠ¡ } catch (InterruptedException e) { e.printStackTrace(); } } log.info(\u0026#34;å®Œæˆä¸šåŠ¡\u0026#34;); } catch (Exception e) { e.printStackTrace(); } return \u0026#34;success\u0026#34;; } } Curator ä¾èµ–é…ç½® 1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.curator\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;curator-recipes\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 @Slf4j public class DemoTest { @Test public void test() { String zookeeperConnectionString = \u0026#34;127.0.0.1:2181\u0026#34;; RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000, 3); CuratorFramework client = CuratorFrameworkFactory.newClient(zookeeperConnectionString, retryPolicy); client.start(); String lockPath = \u0026#34;/order\u0026#34;; InterProcessMutex lock = new InterProcessMutex(client, lockPath); try { // è·å–äº’æ–¥é”ï¼Œé˜»å¡ç›´åˆ°å¯ç”¨ï¼Œæˆ–ç»™å®šæ—¶é—´åˆ°æœŸ // åŒä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ acquire() å¯é‡å…¥ if (lock.acquire(30, TimeUnit.SECONDS)) { try { log.info(\u0026#34;è·å–é”\u0026#34;); } finally { // å¿…é¡»é€šè¿‡ release() é‡Šæ”¾é” lock.release(); } } } catch (Exception e) { e.printStackTrace(); } } } ","date":"2022-05-11T21:14:45+08:00","image":"https://emerywan.github.io/blog/imgs/2.jpeg","permalink":"https://emerywan.github.io/blog/p/distributed-lock/zookeeper/","title":"ä½¿ç”¨ ZooKeeper å®ç°åˆ†å¸ƒå¼é”"},{"content":"Redis NX å®ç° åˆ©ç”¨ NX çš„åŸå­æ€§ï¼Œå¤šä¸ªçº¿ç¨‹å¹¶å‘æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¾ç½®æˆåŠŸï¼Œè®¾ç½®æˆåŠŸå³è·å–äº†é”ã€‚\nå¦‚æœæ²¡æœ‰è·å–é”ï¼Œä¸ä¼šé˜»å¡å½“å‰æ–¹æ³•ï¼Œç›´æ¥è·³è¿‡ä»»åŠ¡ã€‚\nè·å–é” 1 2 # set key unique_value NX PX 30000 set product:stock:clothes UUID NX PX 30000 key æ ¹æ®ä¸åŒçš„ä¸šåŠ¡ï¼ŒåŒºåˆ†ä¸åŒçš„é” unique_value ä¿è¯æ¯ä¸ªçº¿ç¨‹çš„éšæœºå€¼éƒ½ä¸åŒï¼Œç”¨äºé‡Šæ”¾é”æ—¶çš„æ ¡éªŒ NX key ä¸å­˜åœ¨æ—¶è®¾ç½®æˆåŠŸï¼Œkey å­˜åœ¨åˆ™ä¸æˆåŠŸ PX è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ã€‚è‹¥å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå¯ä»¥ä¿è¯è¶…æ—¶åï¼Œé”å¯ä»¥è¿‡æœŸå¤±æ•ˆï¼ˆæ¯«ç§’ï¼‰ é‡Šæ”¾é” é‡Šæ”¾é”å°†è¯¥ key åˆ é™¤ï¼Œåœ¨é‡Šæ”¾é”ä¹‹å‰éœ€è¦æ ¡éªŒè®¾ç½®çš„éšæœºæ•°ï¼Œç›¸åŒæ‰è¡¨ç¤ºæ˜¯è¯¥çº¿ç¨‹åŠ çš„é”ï¼Œèƒ½é‡Šæ”¾ã€‚\néœ€è¦é‡‡ç”¨ LUA è„šæœ¬ï¼Œdel å‘½ä»¤æ²¡æœ‰æä¾›æ ¡éªŒå€¼çš„åŠŸèƒ½ã€‚\nredis æ‰§è¡Œå‘½ä»¤æ˜¯æŒ‰ç…§ä¸€æ¡æŒ‡ä»¤å®Œæˆä¹‹åï¼Œå†æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œç”¨ lua è„šæœ¬ï¼Œèƒ½ä¿è¯ redis æ‰§è¡Œå®Œè¿™ä¸ªè„šæœ¬æ‰æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œæ‰€ä»¥èƒ½ä¿è¯åˆ¤æ–­ å’Œ åˆ é™¤æ˜¯åŸå­æ€§çš„\n1 2 3 4 5 if redis.call(\u0026#34;get\u0026#34;, KEYS[1]) == ARGV[1] then return redis.call(\u0026#34;del\u0026#34;, KEYS[1]) else return 0 end å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 @Slf4j @RestController public class RedisLockController { @Autowired private RedisTemplate redisTemplate; @GetMapping(\u0026#34;/redisLock\u0026#34;) public String redisLock() { // è·å–åˆ†å¸ƒå¼é” Boolean lock = redisTemplate.execute((RedisCallback\u0026lt;Boolean\u0026gt;) redisConnection -\u0026gt; { Expiration expiration = Expiration.seconds(30); // NX RedisStringCommands.SetOption setOption = RedisStringCommands.SetOption.ifAbsent(); // éœ€è¦ä½¿ç”¨ redisTemplate ä¸­çš„åºåˆ—åŒ–å™¨ byte[] redisKey = redisTemplate.getKeySerializer().serialize(key); byte[] redisValue = redisTemplate.getValueSerializer().serialize(value); return redisConnection.set(redisKey, redisValue, expiration); }); if (lock) { // è·å–åˆ°äº†é” log.info(\u0026#34;è·å–åˆ°äº†é”\u0026#34;); try { TimeUnit.SECONDS.sleep(15); // æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç† } catch (InterruptedException e) { e.printStackTrace(); } finally { String script = \u0026#34;if redis.call(\\\u0026#34;get\\\u0026#34;,KEYS[1])==ARGV[1] then\\n\u0026#34; + \u0026#34;\\treturn redis.call(\\\u0026#34;del\\\u0026#34;,KEYS[1])\\n\u0026#34; + \u0026#34;else\\n\u0026#34; + \u0026#34;\\treturn 0\\n\u0026#34; + \u0026#34;end\u0026#34;; RedisScript\u0026lt;Boolean\u0026gt; redisScript = RedisScript.of(script, Boolean.class); boolean result = redisTemplate.execute(redisScript, Arrays.asList(key), value); log.info(\u0026#34;é‡Šæ”¾é” {}\u0026#34;, result); } } log.info(\u0026#34;ä¸šåŠ¡å®Œæˆ\u0026#34;); return \u0026#34;success\u0026#34;; } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 @Slf4j @RestController public class RedisLock { private RedisTemplate redisTemplate; // é”åç§°ï¼Œä¸åŒä¸šåŠ¡å¯èƒ½é”ä¸åŒ private String key; private String value; // é”è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ private int expireTime; public RedisLock(RedisTemplate redisTemplate, String key, int expireTime) { this.redisTemplate = redisTemplate; this.key = key; this.expireTime = expireTime; // value å¯ä»¥ä¸æš´éœ²å‡ºå»ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ä¸ä¸€æ ·çš„ this.value = UUID.randomUUID().toString(); } /** * è·å–é” */ public boolean getLock() { // è·å–åˆ†å¸ƒå¼é” Boolean lock = (Boolean) redisTemplate.execute((RedisCallback\u0026lt;Boolean\u0026gt;) redisConnection -\u0026gt; { Expiration expiration = Expiration.seconds(expireTime); // NX RedisStringCommands.SetOption setOption = RedisStringCommands.SetOption.ifAbsent(); // ç”±äºè¿™é‡Œéœ€è¦æ¥å— byte, ä¸èƒ½æš´åŠ›çš„ä½¿ç”¨ string.getBytes() // è¦ä½¿ç”¨æ¨¡æ¿é‡Œé¢çš„ key\\value åºåˆ—åŒ–å™¨æ¥å®ç° byte[] redisKey = redisTemplate.getKeySerializer().serialize(key); byte[] redisValue = redisTemplate.getValueSerializer().serialize(value); Boolean result = redisConnection.set(redisKey, redisValue, expiration, setOption); return result; }); return lock; } /** * é‡Šæ”¾é” */ public boolean unLock() { // lua è„šæœ¬ String script = \u0026#34;if redis.call(\\\u0026#34;get\\\u0026#34;,KEYS[1])==ARGV[1] then\\n\u0026#34; + \u0026#34;\\treturn redis.call(\\\u0026#34;del\\\u0026#34;,KEYS[1])\\n\u0026#34; + \u0026#34;else\\n\u0026#34; + \u0026#34;\\treturn 0\\n\u0026#34; + \u0026#34;end\u0026#34;; RedisScript\u0026lt;Boolean\u0026gt; redisScript = RedisScript.of(script, Boolean.class); Boolean result = (Boolean) redisTemplate.execute(redisScript, Arrays.asList(key), value); return result; } } Redisson ä¾èµ–é…ç½® 1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.redisson\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;redisson-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.16.7\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 @Slf4j @RestController public class RedissonLockController { @Autowired private RedissonClient redissonClient; @GetMapping(\u0026#34;/redissonLock\u0026#34;) public String redissonLock() { log.info(\u0026#34;æ‰§è¡Œæ–¹æ³•\u0026#34;); final String key = \u0026#34;redisson\u0026#34;; RLock lock = redissonClient.getLock(key); // é”è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœæœªè·å¾—é”ï¼Œä¼šé˜»å¡ç­‰å¾…è·å–åˆ°é”ï¼ˆ-1 è¡¨ç¤ºæ²¡æœ‰è¶…æ—¶æ—¶é—´ï¼‰ lock.lock(30, TimeUnit.SECONDS); log.info(\u0026#34;è·å–é”\u0026#34;); try { TimeUnit.SECONDS.sleep(10); } catch (InterruptedException e) { e.printStackTrace(); } finally { log.info(\u0026#34;é‡Šæ”¾é”\u0026#34;); lock.unlock(); } log.info(\u0026#34;å®Œæˆä¸šåŠ¡\u0026#34;); return \u0026#34;success\u0026#34;; } } ","date":"2022-05-11T12:14:45+08:00","image":"https://emerywan.github.io/blog/imgs/1.jpeg","permalink":"https://emerywan.github.io/blog/p/distributed-lock/redis/","title":"ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”"},{"content":"ğŸŒ± ä»‹ç» è®¸å¤šå¹³å°éƒ½æä¾›äº†å…è´¹çš„é™æ€é¡µé¢æ‰˜ç®¡çš„æœåŠ¡ï¼Œå¦‚ Github Pagesï¼ŒVercelï¼ŒNetlifyç­‰ã€‚ä½†åœ¨å›½å†…ç”±äºä¸€äº›â€œåŸå› â€ï¼Œè¿™äº›å›½å¤–çš„æœåŠ¡åœ¨å›½å†…çš„è®¿é—®å¹¶ä¸ç¨³å®šã€‚\nå›½å†…çš„å…è´¹æ‰˜ç®¡å¹³å°å¦‚ Gitee é™åˆ¶å¾ˆå¤šï¼Œä¸å¯ä»¥è‡ªå®šä¹‰åŸŸåè€Œä¸”ä¹‹å‰å‡ºç°äº†é˜²ç›—é“¾é—®é¢˜ï¼Œè®¿é—®ä¹Ÿä¸æ˜¯å¾ˆå¿«ï¼Œä¸å¤ªæ¨èä½œä¸ºæ‰˜ç®¡å¹³å°ã€‚\nè…¾è®¯äº‘æ¨å‡ºçš„äº‘å¼€å‘ CloudBase ä¹Ÿæœ‰é™æ€é¡µé¢æ‰˜ç®¡æœåŠ¡ã€‚å…¶å®å®ƒç›¸æ¯”è¿™äº›é™æ€æ‰˜ç®¡å¹³å°ï¼Œæœ‰æ›´å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œç”šè‡³èƒ½å¤Ÿæ­ä¸€æ•´å¥—ç³»ç»Ÿã€‚è™½ç„¶æ˜¯ä»˜è´¹æœåŠ¡ï¼Œä½†æ˜¯åœ¨æŒ‰é‡ä»˜è´¹çš„æƒ…å†µä¸‹èµ„è´¹ä¸æ˜¯å¾ˆé«˜ï¼Œåœ¨åšå®¢è®¿é—®é‡ä¸æ˜¯å¾ˆé«˜çš„æƒ…å†µä¸‹ååˆ†åˆé€‚ã€‚\nç›®å‰åœ¨è…¾è®¯äº‘ä¸­æš‚æ—¶è¿˜æ²¡æœ‰ Hugo çš„æ¨¡æ¿ã€‚ç›®å‰æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è¾¾åˆ°è‡ªåŠ¨éƒ¨ç½²çš„åŠŸèƒ½ï¼š\nğŸŒ° ä½¿ç”¨ Github Actions ç¼–è¯‘ï¼Œé€šè¿‡ Tencent CloudBase Github Action è‡ªåŠ¨éƒ¨ç½²åˆ° CloudBaseã€‚\nğŸŒ° ä½¿ç”¨ Github Actions ç¼–è¯‘ï¼Œæ¨é€åˆ° Web åº”ç”¨æ‰˜ç®¡ï¼ˆwebifyï¼‰ çš„ç®€æ˜“é™æ€é¡µé¢æ¨¡æ¿ã€‚\nğŸ– ä½¿ç”¨ CloudBase ä½¿ç”¨ CloudBse æ—¶ï¼Œä½¿ç”¨æŒ‰é‡è®¡è´¹ç¯å¢ƒä¼šæœ‰ä¸€äº›å…è´¹ç”¨é‡ã€‚\nâ˜ï¸ è…¾è®¯äº‘ åˆ›å»ºç¯å¢ƒ åœ¨ äº‘å¼€å‘ CloudBase æ–°å»ºä¸€ä¸ªåº”ç”¨ï¼Œé€‰æ‹© ç©ºæ¨¡æ¿ï¼Œæ ¹æ®è‡ªèº«éœ€æ±‚å¡«å†™ä¿¡æ¯ã€‚\nåˆ›å»ºæˆåŠŸåï¼Œè·å¾— ç¯å¢ƒIDã€‚\nè·å– API å¯†é’¥ ä¸ºéƒ¨ç½²æ–°å»ºä¸€ä¸ªå¯†é’¥å¯¹ã€‚åœ¨ è®¿é—®ç®¡ç† -\u0026gt; ç”¨æˆ·åˆ—è¡¨ -\u0026gt; æ–°å»ºç”¨æˆ· -\u0026gt; è‡ªå®šä¹‰åˆ›å»º -\u0026gt; å¯è®¿é—®èµ„æºå¹¶æ¥æ”¶æ¶ˆæ¯ã€‚ğŸ”— ä¼ é€é—¨\næ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæ–°å»ºç”¨æˆ·ååé€‰æ‹© ç¼–ç¨‹è®¿é—®ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚\nåœ¨è‡ªå®šä¹‰ç­–ç•¥ä¸­å‹¾é€‰ï¼š\nQcloudAccessForTCBRoleï¼šæˆäºˆäº‘å¼€å‘ï¼ˆTCBï¼‰å¯¹äº‘èµ„æºçš„è®¿é—®æƒé™ï¼› QcloudAccessForTCBRoleInAccessCloudBaseRunï¼šä¾›äº‘å¼€å‘ï¼ˆTCBï¼‰æœåŠ¡è§’è‰²ï¼ˆTCB_QcsRoleï¼‰è¿›è¡Œå…³è”ï¼Œç”¨äº TCB è®¿é—®å…¶ä»–äº‘æœåŠ¡èµ„æºã€‚åŒ…å«ç§æœ‰ç½‘ç»œ VPCã€äº‘æœåŠ¡å™¨ CVM ç›¸å…³æ“ä½œæƒé™ã€‚ ç‚¹ä¸€ä¸‹ä¸€æ­¥åï¼Œæ–°å»ºç”¨æˆ·æˆåŠŸã€‚å¯ä»¥è·å¾— SecretId å’Œ SecretKeyã€‚\nâš™ï¸ Github Actions è®¾ç½® Github Secrets åœ¨é¡¹ç›®çš„ Settings -\u0026gt; Secrets -\u0026gt; Actions ä¸­æ·»åŠ ä¸Šè¿°å¾—åˆ°çš„ ENV_IDï¼ŒSECRET_IDï¼ŒSECRET_KEYï¼ˆåç§°å¯ä»¥è‡ªå®šä¹‰ï¼‰ã€‚\næ·»åŠ  workflows å¯ä»¥åœ¨ä»“åº“çš„ Actions ä¸­ new workflowï¼Œæˆ–è€…åœ¨é¡¹ç›®ä¸­ .github/workflows æ·»åŠ ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 name: Tencent CloudBase on: push: branches: - main jobs: hugo-publish: name: publish content to static website runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@v3 with: submodules: true fetch-depth: 0 - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: latest extended: true - name: Build run: hugo --minify --gc # ä½¿ç”¨äº‘å¼€å‘ Github Action éƒ¨ç½² - name: Deploy to Tencent CloudBase uses: TencentCloudBase/cloudbase-action@v2 with: secretId: ${{ secrets.QCLOUD_SECRET_ID }} secretKey: ${{ secrets.QCLOUD_SECRET_KEY }} envId: ${{ secrets.QCLOUD_ENV_ID }} ğŸš§ æç¤ºï¼š\nè¿™é‡Œä½¿ç”¨äº† TencentCloudBase/cloudbase-action@v2ï¼Œéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ  cloudbaserc.jsonã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 { \u0026#34;envId\u0026#34;: \u0026#34;{{env.ENV_ID}}\u0026#34;, // è¿™é‡Œéœ€è¦æ›´æ”¹ä¸ºä½ çš„ ç¯å¢ƒIDï¼Œæˆ–è€…åœ¨ .env æ–‡ä»¶ä¸­é…ç½® \u0026#34;$schema\u0026#34;: \u0026#34;https://framework-1258016615.tcloudbaseapp.com/schema/latest.json\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;framework\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;hugo-blog\u0026#34;, \u0026#34;plugins\u0026#34;: { \u0026#34;client\u0026#34;: { \u0026#34;use\u0026#34;: \u0026#34;@cloudbase/framework-plugin-website\u0026#34;, \u0026#34;inputs\u0026#34;: { \u0026#34;outputPath\u0026#34;: \u0026#34;public\u0026#34;, \u0026#34;ignore\u0026#34;: [ \u0026#34;.git\u0026#34;, \u0026#34;.github\u0026#34;, \u0026#34;cloudbaserc.js\u0026#34; ] } } } } } ğŸš§ æç¤ºï¼š\nè¿™é‡Œä¹Ÿå¯ä»¥é€‰æ‹© Tencent CloudBase Github Action V1ã€‚ğŸ™‹â€â™‚ï¸ ï¼ˆæ¨èï¼‰\nV2 æ¯” V1 æœ‰æ›´å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚æ‹‰å–ä»£ç åœ¨è…¾è®¯äº‘ç«¯ç¼–è¯‘ï¼Œä½†ç›®å‰æ²¡æœ‰ Hugo æ¨¡æ¿ã€‚æˆ‘ä»¬å·²ç»åœ¨ Github Actions äº§å‡ºäº†é™æ€æ–‡ä»¶ï¼Œç›´æ¥æ¨é€å³å¯ã€‚æ‰€ä»¥ç›®å‰å¯¹äº hugo æ¥è¯´ï¼Œæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½¿ç”¨ç”šè‡³ V1 æ›´å¿«æ›´ç®€æ´ã€‚\n1 2 3 4 5 6 7 8 # å°†ä¸Šè¿° jobs å†…æ›¿æ¢ä¸º - name: Deploy to Tencent CloudBase uses: TencentCloudBase/cloudbase-action@v1.1.1 with: secretId: ${{ secrets.QCLOUD_SECRET_ID }} secretKey: ${{ secrets.QCLOUD_SECRET_KEY }} envId: ${{ secrets.QCLOUD_ENV_ID }} staticSrcPath: public ğŸ ä½¿ç”¨ webify ä½¿ç”¨ Web åº”ç”¨æ‰˜ç®¡ï¼ˆwebifyï¼‰ä¸»è¦æ˜¯åˆ©ç”¨ Github Actions ç”Ÿæˆ é™æ€é¡µé¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œå†æ‰˜ç®¡è¿™ä¸ªåˆ†æ”¯çš„å†…å®¹ã€‚\nâ˜ï¸ åˆ›å»ºæœåŠ¡ åœ¨ Web åº”ç”¨æ‰˜ç®¡ -\u0026gt; æ–°å»ºåº”ç”¨ æ–°å»ºä¸€ä¸ªç®€æ˜“é™æ€é¡µé¢æ¨¡æ¿ã€‚æ ¹æ®éœ€æ±‚å¡«å†™ä¿¡æ¯ã€‚é€‰æ‹©çº¯é™æ€é¡µé¢ã€‚\nåœ¨ åº”ç”¨åˆ—è¡¨ -\u0026gt; åº”ç”¨è®¾ç½® ä¸­é…ç½®ä»“åº“ä¿¡æ¯ï¼Œå¹¶æ ¹æ®è‡ªèº«æƒ…å†µé€‰æ‹©é™æ€æ–‡ä»¶çš„éƒ¨ç½²åˆ†æ”¯ã€‚ï¼ˆå¦‚æœå½“å‰æ²¡æœ‰ç”Ÿæˆé™æ€é¡µé¢çš„åˆ†æ”¯ï¼Œå¯å®Œæˆåé¢æ“ä½œåå†è¿›è¡Œæ­¤æ­¥éª¤ï¼‰ã€‚\nâš™ï¸ Github Actions è®¾ç½® Github Token åœ¨ç”¨æˆ·çš„ Settings -\u0026gt; Developer settings -\u0026gt; Personal access tokens -\u0026gt; Generate new token è·å–ä¸€ä¸ª Repo Tokenã€‚ğŸ”— ä¼ é€é—¨\nåœ¨é¡¹ç›®çš„ Settings -\u0026gt; Secrets -\u0026gt; Actions ä¸­æ·»åŠ ä¸Šè¿°å¾—åˆ°çš„ Tokenã€‚\næ·»åŠ  workflows 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 name: Tencent CloudBase on: push: branches: - main jobs: hugo-publish: name: publish content to static website runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@v3 with: submodules: true fetch-depth: 0 - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: latest extended: true - name: Build run: hugo --minify --gc - name: Deploy to Branch uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.ACCESS_TOKEN }} keep_files: false publish_branch: gh-pages # æ›´æ”¹ä¸ºä½ æƒ³è¦ç”Ÿæˆçš„åˆ†æ”¯ publich_dir: ./public commit_message: ${{ github.event.head_commit.message }} â›“ å‚è€ƒ ğŸ”— https://blog.wangjunfeng.com/post/hugo-cloudbase/ ğŸ”— https://cloud.tencent.com/document/product/1210/43389 ğŸ”— https://github.com/TencentCloudBase/cloudbase-action ğŸ”— https://github.com/TencentCloudBase/cloudbase-action/blob/3354b442713265aa9d7c5bf03b0b8cb0173f546f/README.md ","date":"2022-05-01T21:14:45+08:00","image":"https://emerywan.github.io/blog/imgs/3.jpeg","permalink":"https://emerywan.github.io/blog/p/hugo-in-cloudbase/","title":"ä½¿ç”¨ Github Actions åœ¨è…¾è®¯äº‘ CloudBase éƒ¨ç½² Hugo"},{"content":"AQS AQS AbstractQueuedSynchronized æ˜¯ä¸€ä¸ªç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ï¼Œæ˜¯å¯¹ CAS çš„ä¸€ç§å°è£…å’Œä¸°å¯Œï¼ŒAQS å¼•å…¥äº†ç‹¬å é”ï¼Œå…±äº«é”ç­‰æ€§è´¨ã€‚\nä½¿ç”¨ AQS èƒ½å¤ŸåŸºäº Java APIï¼Œç®€å•é«˜æ•ˆåœ°æ„å»ºå‡ºåº”ç”¨å¹¿æ³›çš„å¤§é‡åŒæ­¥å™¨ï¼Œç”¨äº Java å¤šçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚\næ ¸å¿ƒæ€æƒ³ AQS ä½¿ç”¨ä¸€ä¸ª int æˆå‘˜å˜é‡è¡¨ç¤ºåŒæ­¥çŠ¶æ€ã€‚\nä½¿ç”¨ CAS å¯¹è¯¥åŒæ­¥çŠ¶æ€è¿›è¡ŒåŸå­æ“ä½œï¼Œå®ç°å¯¹å…¶å€¼çš„ä¿®æ”¹ã€‚\n1 2 // å…±äº«å˜é‡ï¼Œä½¿ç”¨ volatile ä¿éšœå¯è§æ€§ private volatile int state; AQS é€šè¿‡å†…ç½®çš„ FIFO åŒå‘é˜Ÿåˆ—æ¥å®Œæˆè·å–èµ„æºçº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œã€‚\n1 2 private transient volatile Node head; private transient volatile Node tail; å½“è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²æ—¶ï¼Œå°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚\nå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œå°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚\nèµ„æºçš„å…±äº«æ–¹å¼ ç‹¬å  å½“ä¸€ä¸ªçº¿ç¨‹ä»¥ç‹¬å æ¨¡å¼è·å–é”æ—¶ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ã€‚\nReentrantLock å…±äº« å½“ä¸€ä¸ªçº¿ç¨‹ä»¥å…±äº«æ¨¡å¼è·å–é”æ—¶ï¼Œå…¶ä»–ä¹Ÿæƒ³ä»¥å…±äº«æ¨¡å¼è·å–é”çš„çº¿ç¨‹ä¹Ÿèƒ½å¤Ÿä¸€èµ·è®¿é—®å…±äº«èµ„æºï¼Œä½†å…¶ä»–æƒ³ä»¥ç‹¬å æ¨¡å¼è·å–é”çš„çº¿ç¨‹éœ€è¦ç­‰å¾…ã€‚\nCountDownLatch CyclicBarrier Semaphore å®ç° CountDownLatch CountDownLatch åŒæ­¥å·¥å…·å…è®¸ä¸€æ¡æˆ–å¤šæ¡çº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹ä¸­çš„ä¸€ç»„æ“ä½œå®Œæˆåï¼Œå†ç»§ç»­æ‰§è¡Œã€‚\nCountDownLatch ä»»åŠ¡åˆ†ä¸º n ä¸ªå­çº¿ç¨‹æ‰§è¡Œï¼Œstate å°†è¢«åˆå§‹åŒ–ä¸º nï¼Œè¿™ n ä¸ªçº¿ç¨‹å°†ä¼šå¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œåè°ƒç”¨ countDown() æ–¹æ³•ï¼Œstate ä¼šé€šè¿‡ CAS - 1ã€‚å½“æ‰€æœ‰çš„å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œä¹‹åï¼Œstate=0ï¼Œä¼š unpack ä¸»çº¿ç¨‹ï¼Œç»§ç»­åç»­åŠ¨ä½œã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 public class Demo { static class SearchTask implements Runnable { private Integer id; private CountDownLatch latch; public SearchTask(int id, CountDownLatch latch) { this.id = id; this.latch = latch; } // **å­çº¿ç¨‹** // å„è‡ªå¯»æ‰¾ç›¸åº”ç›®æ ‡çš„é¾™ç  @Override public void run() { System.out.println(\u0026#34;å¼€å§‹å¯»æ‰¾\u0026#34; + id + \u0026#34;å·é¾™ç \u0026#34;); int seconds = ThreadLocalRandom.current().nextInt(20); try { Thread.sleep(seconds * 1000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(\u0026#34;èŠ±äº†\u0026#34; + seconds + \u0026#34;ç§’ï¼Œæ‰¾åˆ°äº†\u0026#34; + id + \u0026#34;å·é¾™ç \u0026#34;); // æ¯å½“ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œå°±è°ƒç”¨ä¸€ä¸ª countDown() æ–¹æ³• latch.countDown(); } } // **ä¸»çº¿ç¨‹** // ç­‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åï¼Œæ‰¾åˆ°æ‰€æœ‰é¾™ç ï¼Œå¬å”¤ç¥é¾™ public static void main(String[] args) { List\u0026lt;Integer\u0026gt; idList = Arrays.asList(1, 2, 3, 4, 5, 6, 7); // state åˆå§‹åŒ–ä¸ºä»»åŠ¡çš„ä¸ªæ•° CountDownLatch latch = new CountDownLatch(idList.size()); for (int id : idList) { Thead thread = new Thead(new SearchTask(id, latch)); thread.start(); } try { latch.await(); // ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆ } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(\u0026#34;æ‰¾åˆ°æ‰€æœ‰é¾™ç äº†ï¼å¬å”¤ç¥é¾™\u0026#34;); } } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»»åŠ¡åˆ†ä¸º 7 ä¸ªå­çº¿ç¨‹æ‰§è¡Œï¼Œå°† CountDownLatch çš„å€¼åˆå§‹åŒ–ä¸ºä¸çº¿ç¨‹ç›¸åŒçš„æ¬¡æ•°ã€‚ä¸»çº¿ç¨‹é€šè¿‡ await() ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆã€‚\nè¿™å‡ ä¸ªå­ä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œæˆå countDown() ä¸€æ¬¡ï¼Œstate ä¼šé€šè¿‡ CAS æ“ä½œ -1ã€‚\nç›´åˆ°æ‰€æœ‰çš„å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œstate=0ï¼Œä¸»çº¿ç¨‹ä¼šè¢« unparkï¼Œç»§ç»­æ‰§è¡Œåç»­ä»»åŠ¡ã€‚\nCyclicBarrier CyclicBarrier ç”¨äºå¤šä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…å¯¹æ–¹æ‰§è¡Œåˆ°æŸä¸ªçŠ¶æ€åï¼Œè¿™äº›çº¿ç¨‹å†ç»§ç»­æ‰§è¡Œã€‚\nSemaphore ReentrantLock ReentrantReadWriteLock ","date":"2022-04-03T14:02:02+08:00","image":"https://emerywan.github.io/blog/imgs/6.jpeg","permalink":"https://emerywan.github.io/blog/p/thread/aqs/","title":"Java å¹¶å‘ - AQS"},{"content":"å•ä¾‹æ¨¡å¼ å•ä¾‹æ¨¡å¼æ‰€è¦å®ç°çš„ç›®æ ‡ï¼šä¿æŒä¸€ä¸ªç±»æœ‰ä¸”åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚\nå‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œä¸å°‘å•ä¾‹æ¨¡å¼éƒ½ä¼šé‡‡ç”¨å»¶è¿ŸåŠ è½½çš„æ–¹å¼ã€‚\næ ¹æ®æ˜¯å¦å»¶è¿ŸåŠ è½½ï¼Œå¯ä»¥åˆ†ä¸ºï¼š\né¥¿æ±‰å¼\næ‡’æ±‰å¼\nå•çº¿ç¨‹çš„å•ä¾‹æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public class Singleton { private static Singleton instance = null; // æ„é€ å™¨ç§æœ‰ï¼Œå…¶ä»–ç±»æ— æ³•é€šè¿‡ new åˆå§‹åŒ– private Singleton() { } // åˆ›å»ºå¹¶è¿”å›è¯¥ç±»çš„å”¯ä¸€å®ä¾‹ public static Singleton getInstance() { if (null == instance) { instance = new Singleton(); } } public void someService() { // ä¸€äº›ä¸šåŠ¡ä»£ç  } } åŠ é”çš„å•ä¾‹æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 public class Singleton { private static Singleton instance = null; private Singleton() { } public static Singleton getInstance() { sychronized (Singleton.class) { // æ¯æ¬¡åˆ¤ç©ºæ“ä½œï¼Œéƒ½è¦è·å–é”ï¼Œå¼€é”€æå¤§ if (null == instance) { instance = new Singleton(); } } return instance; } } ä½¿ç”¨åŒé‡æ£€éªŒåˆ¤æ–­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public class Singleton { private volatile static Singleton instance = null; private Singleton() { } public static Singleton getInstance() { if (instance == null) { synchronized (Singleton.class) { if (instance == null) { instance = new Singleton(); } } } return instance; } } ä½¿ç”¨ volatile ä¿®é¥°å®ä¾‹ï¼Œåˆ©ç”¨äº†ä»¥ä¸‹ä¸¤ä¸ªä½œç”¨ï¼š\n(1) ä¿éšœå¯è§æ€§ï¼š\nä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–äº† instance çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è¯»å–åˆ°ç›¸åº”çš„å€¼ã€‚\n(2) ä¿éšœæœ‰åºæ€§ï¼š\nä¿éšœä¸€ä¸ªçº¿ç¨‹è¯»å–åˆ°çš„ instance å¼•ç”¨çš„å®ä¾‹å·²ç»åˆå§‹åŒ–å®Œæ¯•ã€‚\nå¯¹è±¡å®ä¾‹åŒ–ä¼šåˆ†è§£æˆä»¥ä¸‹å‡ ä¸ªå­æ“ä½œï¼š\nåˆ†é…å¯¹è±¡æ‰€éœ€çš„ç©ºé—´ åˆå§‹åŒ– instance å¼•ç”¨çš„å¯¹è±¡ å°†å¯¹è±¡çš„åº”ç”¨å†™å…¥å…±äº«å˜é‡ ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ 1-\u0026gt;3-\u0026gt;2ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚\nä¾‹å¦‚ï¼šçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3 åï¼Œæ­¤æ—¶ T2 è°ƒç”¨ getInstance() åå‘ç° instance ä¸ä¸ºç©ºï¼Œå› æ­¤ç›´æ¥è¿”å›ï¼Œä½†æ­¤æ—¶ instance è¿˜æœªè¢«åˆå§‹åŒ–ã€‚\né™æ€å†…éƒ¨ç±»çš„å•ä¾‹æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public class Singleton { private Singleton() { } private static class InstanceHolder { // é™æ€å†…éƒ¨ç±» // ä¿å­˜å¤–éƒ¨ç±»çš„å”¯ä¸€å®ä¾‹ final static Singleton INSTANCE = new Singleton(); } public static Singleton getInstance() { return InstanceHolder.INSTANCE; } public void someService() { // ... } public static void main(String[] args) { Singleton.getInstace().someService(); } } å½“å¤–éƒ¨ç±»åŠ è½½æ—¶ï¼Œå†…éƒ¨ç±»ä¸ä¼šåŠ è½½ï¼Œå¹¶ä¸”é™æ€å˜é‡åªä¼šæœ‰é»˜è®¤å€¼ï¼ˆnullï¼‰ã€‚\nç±»çš„é™æ€å˜é‡è¢«åˆæ¬¡è®¿é—®æ‰ä¼šè§¦å‘ Java è™šæ‹Ÿæœºå¯¹è¯¥ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¼šå˜ä¸ºå…¶åˆå§‹å€¼ã€‚\næšä¸¾å•ä¾‹ 1 2 3 4 5 6 7 8 9 10 public static enum Singleton { INSTANCE; Singleton() { // ç§æœ‰æ„é€ å™¨ } pubilc void someService() { // ä¸šåŠ¡åˆ°å— } } å­—æ®µ INSTANCE æ˜¯æšä¸¾ç±»çš„å”¯ä¸€å®ä¾‹ã€‚åœ¨ Singleton.INSTANCE åˆæ¬¡è¢«å¼•ç”¨æ—¶æ‰ä¼šè¢«åˆå§‹åŒ–ã€‚\n","date":"2022-04-01T14:02:02+08:00","image":"https://emerywan.github.io/blog/imgs/8.jpeg","permalink":"https://emerywan.github.io/blog/p/thread/singleton/","title":"çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼"},{"content":"åˆ›å»º 1 2 3 4 5 6 7 8 9 public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u0026lt;Runnable\u0026gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) { // ... } corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°\næ¯æ¬¡å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªå¤šçº¿ç¨‹ä»»åŠ¡ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ¸å¿ƒçº¿ç¨‹ï¼Œæ— è®ºæ˜¯å¦æœ‰ç©ºé—²çº¿ç¨‹ï¼Œç›´åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°çš„æ•°é‡ï¼Œæ‰ä¼šå¼€å§‹å¤ç”¨çº¿ç¨‹èµ„æºã€‚ ä½¿ç”¨ prestartAllCoreThreads() ç›´æ¥åˆå§‹åŒ–å…¨éƒ¨ maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°\nå½“æ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä¸”ç­‰å¾…é˜Ÿåˆ—å·²æ»¡ï¼Œä¼šå¼€å§‹åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ï¼Œä½†ä¸è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•° keepAliveTime çº¿ç¨‹æœ€å¤§ç©ºé—²æ—¶é—´\néæ ¸å¿ƒçº¿ç¨‹è¶…è¿‡æœ€å¤§ç©ºé—²æ—¶é—´ï¼Œä¼šè‡ªåŠ¨é”€æ¯ unit æœ€å¤§ç©ºé—²æ—¶é—´å•ä½\nworkQueue çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—\næ ¸å¿ƒçº¿ç¨‹æ•°å·²æ»¡æ—¶ï¼Œä¼šå°†ä»»åŠ¡æš‚å­˜åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼Œç›´åˆ°çº¿ç¨‹èµ„æºå¯ç”¨ threadFactory çº¿ç¨‹åˆ›å»ºå·¥å‚\nhandler æ‹’ç»ç­–ç•¥\nå½“ç­‰å¾…é˜Ÿåˆ—å·²æ»¡ï¼Œå¹¶ä¸”è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ–°çš„ä»»åŠ¡ä¼šè¿›è¡Œæ‹’ç»å¤„ç† çº¿ç¨‹æ± çš„å¤§å° CPU å¯†é›†å‹ ä¸»è¦æ˜¯æ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼Œç›¸åº”å¾ˆå¿«ï¼ŒCPU åˆ©ç”¨ç‡é«˜ã€‚æ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•° + 1\nIO å¯†é›†å‹ ä¸»è¦æ˜¯è¿›è¡Œ IO æ“ä½œï¼Œå¦‚ç¡¬ç›˜è¯»å–æ•°æ®ç­‰ï¼ŒIO æ“ä½œæ—¶é—´é•¿ï¼ŒCPU åˆ©ç”¨ä¸é«˜ï¼Œæ¨èï¼šæ ¸å¿ƒçº¿ç¨‹æ•° = 2 * CPU æ ¸å¿ƒæ•°ã€‚\næ‹’ç»ç­–ç•¥ AbortPolicy\næŠ›å‡ºå¼‚å¸¸æ‹’ç»ä»»åŠ¡ DiscardPolicy\nä¸æŠ›å‡ºå¼‚å¸¸ï¼Œæ‹’ç»ä»»åŠ¡ DiscardOldestPolicy\nä¸¢å¼ƒæœ€è€çš„ä»»åŠ¡ CallerRunsPolicy\nå°†ä»»åŠ¡äº¤ç»™è°ƒç”¨çº¿ç¨‹æ‰§è¡Œ ä½¿ç”¨ 1 2 3 4 // execute executor.execute(() -\u0026gt; { // do ... }); 1 2 3 4 5 6 7 // submit Future\u0026lt;String\u0026gt; future = executor.submit(() -\u0026gt; { // do... return \u0026#34;è¿”å›å€¼\u0026#34;; }); String res = future.get(); å¸¸è§çš„çº¿ç¨‹æ±  newSingleThreadExecutor åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ±  å”¯ä¸€çº¿ç¨‹å¯ä»¥ä¿è¯æ‰€æäº¤çš„ä»»åŠ¡é¡ºåºæ‰§è¡Œ 1 2 3 4 5 6 public static ExecutorService newSingleThreadExecutor() { return new FinalizableDelegatedExecutorService( new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;())); } newFixedThreadPool å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ±  1 2 3 4 5 public static ExecutorService newFixedThreadPool(int nThreads) { return new ThreadPoolExecutor(nThread, nThread, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;()); } newCachedThreadPool æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ±  1 2 3 4 5 public static ExecutorService newCachedThreadPool() { return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue\u0026lt;Runnable\u0026gt;()); } å½“æäº¤æ–°ä»»åŠ¡æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸ºç©ºæˆ–æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚\nå½“çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTime=60sï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹èµ„æºã€‚é•¿æ—¶é—´ç©ºé—²çš„ CachedThreadPool ä¸ä¼šæŒæœ‰ä»»åŠ¡ä»»ä½•çº¿ç¨‹èµ„æºã€‚\nForkJoin ","date":"2022-03-30T16:02:02+08:00","image":"https://emerywan.github.io/blog/imgs/9.jpeg","permalink":"https://emerywan.github.io/blog/p/thread/","title":"Java çº¿ç¨‹æ± "},{"content":"åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šå¯¹åŒä¸€ä¸ªèµ„æºè¿›è¡Œäº‰æŠ¢ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡å¼•å…¥é”æœºåˆ¶ï¼Œä½¿ç”¨ä¸€ç§æŠ½è±¡çš„é”ï¼Œå¯¹èµ„æºè¿›è¡Œé”å®šï¼Œè¾¾åˆ°åŒæ­¥è®¿é—®ã€‚\nå®ç° Java é‡‡ç”¨äº†ä¸¤ç§å®ç°æ–¹å¼ï¼š\nåŸºäº Object çš„æ‚²è§‚é”\nåŸºäº CAS çš„ä¹è§‚é”\næ‚²è§‚é” åœ¨ Java ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡ï¼ˆObjectï¼‰ï¼Œéƒ½æ‹¥æœ‰ä¸€æŠŠé”ï¼Œå­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ï¼Œè®°å½•äº†å½“å‰å¯¹è±¡è¢«å“ªä¸ªçº¿ç¨‹æ‰€å ç”¨ã€‚\nå†…éƒ¨é” synchronized synchronized å…³é”®å­—å¯ä»¥ç”¨æ¥åŒæ­¥çº¿ç¨‹ï¼Œå…¶è¢«ç¼–è¯‘åï¼Œä¼šç”Ÿæˆ monitorenter å’Œ moniterexit ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼Œç”¨æ¥è¿›è¡Œçº¿ç¨‹çš„åŒæ­¥ã€‚\nsynchronized æ˜¯éå…¬å¹³é”ã€‚ä¸€æŠŠé”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è·å–ï¼Œæ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹åªèƒ½ç­‰å¾…ã€‚çº¿ç¨‹å¯¹å†…éƒ¨é”çš„ç”³è¯·å’Œé‡Šæ”¾ç”± Java è™šæ‹Ÿæœºè´Ÿè´£å®æ–½ã€‚\nåŠ é”æ–¹å¼ï¼š\nå¯¹è±¡é”\nä¿®é¥°å®ä¾‹æ–¹æ³• pubilc sychronized void method() { ... }\nä»£ç å—é”ä½å½“å‰å¯¹è±¡ synchronized(this)\nç±»é”\nä¿®é¥°é™æ€æ–¹æ³• public static synchronized void method() { ... }\nä»£ç å—é”å®š class å¯¹è±¡ synchronized(MyClass.class) { ... }\nsynchronized ä¿®é¥°çš„æ–¹æ³•ï¼Œæ— è®ºæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œè¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šé‡Šæ”¾é”ã€‚\nJDK 1.6 å¯¹ synchronized çš„ä¼˜åŒ– synchronized ä¾èµ–äº JVMï¼Œä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿåº•å±‚çš„ Mutex Lock å®ç°ã€‚\nJava çº¿ç¨‹çš„å®ç°æ˜¯å¯¹æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„æ˜ å°„ï¼Œæ¯å½“å”¤é†’æˆ–æŒ‚èµ·ä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼Œéƒ½è¦åˆ‡æ¢åˆ°æ“ä½œç³»ç»Ÿçš„å†…æ ¸æ€ï¼Œä»£ä»·æ˜¯éå¸¸æ˜‚è´µçš„ã€‚\nJDK 1.6 å¯¹é”çš„å®ç°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚ é”ç²—åŒ–ï¼Œé”æ¶ˆé™¤ï¼Œè½»é‡çº§é”ï¼Œåå‘é”ï¼Œé€‚åº”æ€§è‡ªæ—‹ç­‰ã€‚\nå¯¹è±¡é”ä¸€å…±æœ‰å››ç§çŠ¶æ€ï¼š\næ— é” -\u0026gt; åå‘é” -\u0026gt; è½»é‡çº§é” -\u0026gt; é‡é‡çº§é”\nä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ï¼ˆä¸å¯ä»¥é™çº§ï¼‰ï¼Œæé«˜è·å–é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚\nğŸ”’ æ— é”çŠ¶æ€\næŸäº›èµ„æºä¸ä¼šå‡ºç°å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µï¼Œéšæ„å¤šä¸ªçº¿ç¨‹è°ƒç”¨\nåˆ©ç”¨å…¶ä»–ä¸€äº›æ–¹å¼æ§åˆ¶åŒæ­¥ã€‚å¦‚ï¼šCAS\nä¸å¯¹èµ„æºè¿›è¡Œæ“ä½œç³»ç»Ÿçº§åˆ«çš„é”å®šã€‚\nğŸ”’ åå‘é”\né€‚åˆåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—çš„åœºæ™¯ åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹çš„ç«äº‰ï¼Œæ¯æ¬¡éƒ½æ˜¯åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–é”ï¼Œé‚£ä¹ˆå¯¹è±¡é”ä¼šâ€œè®°ä½â€è¿™ä¸ªçº¿ç¨‹ï¼Œåªè¦æ˜¯è¿™ä¸ªçº¿ç¨‹è¿‡æ¥ï¼Œå°±ç›´æ¥æŠŠé”äº¤å‡ºå»ã€‚\nå¦‚æœå¯¹è±¡å‘ç°ç›®å‰ä¸æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯æœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç«äº‰é”ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚\nğŸ”’ è½»é‡çº§é”\né€‚åˆåŒæ­¥ä»£ç å—çš„æ‰§è¡Œé€Ÿåº¦éå¸¸å¿«çš„åœºæ™¯ å½“é”å‡çº§ä¸ºè½»é‡çº§é”çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡ CAS è¿›è¡Œè‡ªæ—‹ç­‰å¾…æ¥è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚\nğŸ”’ é‡é‡çº§é”\né€‚åˆåŒæ­¥ä»£ç å—æ‰§è¡Œé€Ÿåº¦è¾ƒé•¿çš„åœºæ™¯ å¯¹è±¡é”çŠ¶æ€è¢«æ ‡è®°ä¸ºé‡é‡çº§é”ï¼Œéœ€è¦é€šè¿‡ Monitor æ¥å¯¹çº¿ç¨‹è¿›è¡Œæ§åˆ¶ã€‚\nä¹è§‚é” CAS åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒåŒæ­¥ä»£ç å—æ‰§è¡Œçš„æ—¶é—´è¿œè¿œå°äºçº¿ç¨‹åˆ‡æ¢çš„è€—æ—¶ã€‚æ‰€ä»¥å¸Œæœ›èƒ½å¤Ÿåœ¨ç”¨æˆ·æ€ä¸­å¯¹çº¿ç¨‹çš„åˆ‡æ¢è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·æ•ˆç‡æ›´é«˜ã€‚\næˆ‘ä»¬è®©çº¿ç¨‹â€œä¹è§‚åœ°â€åå¤å°è¯•è·å–å…±äº«èµ„æºï¼Œå½“å‘ç°ç©ºé—²æ—¶ä¾¿è¿›è¡Œä½¿ç”¨ï¼Œå¦åˆ™ç»§ç»­â€œä¹è§‚åœ°â€è¿›è¡Œé‡è¯•ã€‚\nåŸºäºä»¥ä¸Šæƒ³æ³•ï¼Œè¯ç”Ÿäº† CAS (Compare And Swap) ç®—æ³•ï¼šæ¯”è¾ƒå¹¶äº¤æ¢ã€‚\nCASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°ï¼š\néœ€è¦è¯»å†™çš„å†…å­˜å€¼ addr è¿›è¡Œæ¯”è¾ƒçš„å€¼ oldValue è¦å†™å…¥çš„æ–°å€¼ newValue 1 2 3 4 5 6 7 8 int cas(long *addr, long oldValue, long newValue) { /* Executes atomically. */ if(*addr != old) return 0; *addr = new; return 1; } è¿™ä¸ª cas å‡½æ•°çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•åŒæ­¥æªæ–½ï¼Œä¼¼ä¹è¿˜æ˜¯å­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ã€‚\nå½“ A çº¿ç¨‹æ¯”è¾ƒäº† oldValue çš„å€¼æ˜¯æƒ³è¦çš„ï¼Œä½†æ˜¯è¿™ä¸ªç¬é—´ï¼ŒB çº¿ç¨‹çªç„¶æŠ¢åˆ°äº†æ—¶é—´ç‰‡ï¼Œæ›´æ”¹äº†å€¼ï¼›ä½†æ˜¯ A çº¿ç¨‹å¹¶ä¸çŸ¥é“ï¼Œå°†å€¼æ”¹æˆäº† newValueï¼Œè¿™å°±å‡ºç°äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒA B ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è·å¾—äº†èµ„æºã€‚\næ‰€ä»¥ï¼ŒCAS çš„æ“ä½œå¿…é¡»æ˜¯ åŸå­æ€§ çš„ã€‚è¿™ä¸ªåŸå­æ“ä½œï¼Œç”±è®¡ç®—æœºå¤„ç†å™¨æŒ‡ä»¤é›†æä¾›ï¼Œç›´æ¥ç”±ç¡¬ä»¶ä¿éšœã€‚\nåŸå­å˜é‡ç±» åŸºç¡€æ•°æ®ç±»å‹\nAtomicInteger AtomicLong AtomicBoolean æ•°ç»„ç±»å‹\nAtomicIntegerArray AtomicLongArray AtomicReferenceArray å­—æ®µæ›´æ–°ç±»å‹\nAtomicIntegerFieldUpdater AtomicLongFieldUpdater AtomicReferenceFieldUpdater å¼•ç”¨ç±»å‹\nAtomicReference AtomicStampedReference AtomicMarkableReference 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public class Demo { private static AtomicInteger n = new AtomicInteger(0); public static void main(String[] args) { for (int i = 0; i \u0026lt; 3; i++) { new Thread(() -\u0026gt; { while (n.get() \u0026lt; 1000) { System.out.println( Thread.currentThread().getName() + \u0026#34; : \u0026#34; + n.incrementAndGet() ); } }, \u0026#34;Thread\u0026#34; + i).start(); } } } AtomicInteger ä¸»è¦ç”±ä¸€ä¸ª Unsafe ç±»å‹çš„å®ä¾‹ unsafe å’Œ Long ç±»å‹çš„ offset å®ç°ã€‚\nJava é€šè¿‡ Unsafe çš„ CAS æ“ä½œæ¥å¯¹ volatile int å€¼è¿›è¡Œæ›´æ–°ã€‚æ ¹æ® value åœ¨å¯¹è±¡ä¸­çš„åç§»é‡ï¼ŒCAS æ“ä½œå†…å­˜æ•°æ®ï¼Œæ‰§è¡Œä¸€äº›åº•å±‚ï¼Œå’Œå¹³å°ç›¸å…³çš„æ–¹æ³•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 // setup to use Unsafe.compareAndSwapInt for updates private static final Unsafe unsafe = Unsafe.getUnsafe(); private static final long valueOffset; static { try { valueOffset = unsafe.objectFieldOffset(AtomicInteger.class.getDeclareFiele(\u0026#34;value\u0026#34;)); } catch (Exception e) { throw new Error(ex); } } private volatile int value; ä¾‹å¦‚ incrementAndGet()ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // AtomicInteger.java public final int incrementAndGet() { return unsafe.getAndAddInt(this, valueOffset, 1) + 1; } // Unsafe.java public final int getAndAddInt(Object o, long offset, int delta) { int v; do { v = getIntVolatile(o, offset); } while (!compareAndSwapInt(o, offset, v, v + delta)); // è‡ªæ—‹ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°é…ç½®ï¼Œé»˜è®¤æ˜¯ 10 return v; } public final native boolean compareAndSwapInt(Object o, long offset, int expected, int x); ç¼ºç‚¹ï¼š\nå¾ªç¯å¼€é”€å¤§\nåªèƒ½å¤„ç†ä¸€ä¸ªå…±äº«å˜é‡\nå°è£…æˆå¯¹è±¡ AtomicReference ABA\nABA é—®é¢˜ CAS éœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥å†…å­˜å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šæ›´æ–°å†…å­˜å€¼ã€‚\nå¦‚æœå†…å­˜å€¼åŸæ¥æ˜¯ Aï¼Œåæ¥å˜æˆäº† Bï¼Œç„¶ååˆå˜æˆäº† Aï¼Œé‚£ä¹ˆ CAS è¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯æœ‰å˜åŒ–çš„ã€‚\nA -\u0026gt; B -\u0026gt; A\nå¯ä»¥ä¸ºå…±äº«å˜é‡å¼•å…¥ä¸€ä¸ªä¿®è®¢å·ï¼ˆæ—¶é—´æˆ³ï¼‰ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šæ›´æ–°ç›¸åº”çš„ä¿®è®¢å·ï¼Œåˆ¤æ–­å˜é‡çš„å€¼æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹ç»™ä¿®æ”¹è¿‡ã€‚AtomicStampedReference\n[A, 0] -\u0026gt; [B, 1] -\u0026gt; [A, 2]\n1 2 3 4 5 6 7 8 9 10 11 public static void main(String[] args) { String a = \u0026#34;Hello\u0026#34;; String b = \u0026#34;World\u0026#34;; // initialRef initialStamp AtomicStampedReference\u0026lt;String\u0026gt; reference = new AtomicStampedReference\u0026lt;\u0026gt;(a, 1); // expectedReference newStamp reference.attemptStamp(a, 2); // å¯¹ç‰ˆæœ¬å·è¿›è¡Œä¿®æ”¹ // expectedReference newReference expectedStamp newStamp reference.compareAndSet(a, b, 2, 3); // CAS æ“ä½œéœ€è¦åŒæ—¶æä¾› é¢„æœŸå€¼ æ–°å€¼ é¢„æœŸç‰ˆæœ¬å· æ–°ç‰ˆæœ¬å· } ","date":"2022-03-30T14:02:02+08:00","image":"https://emerywan.github.io/blog/imgs/7.jpeg","permalink":"https://emerywan.github.io/blog/p/thread/lock/","title":"Java å¹¶å‘ - é”æœºåˆ¶"},{"content":"è¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹æ˜¯ç¨‹åºå‘æ“ä½œç³»ç»Ÿç”³è¯·èµ„æºçš„åŸºæœ¬å•ä½ã€‚\nçº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­å¯ç‹¬ç«‹æ‰§è¡Œçš„æœ€å°å•ä½ã€‚\nä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ï¼ŒåŒä¸€è¿›ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹ä¸­çš„èµ„æºã€‚\næ— å¤„ä¸åœ¨çš„çº¿ç¨‹ main çº¿ç¨‹ åƒåœ¾å›æ”¶çº¿ç¨‹ Web æœåŠ¡å™¨è¯·æ±‚å¤„ç†çº¿ç¨‹ çº¿ç¨‹çš„åˆ›å»º extends Thread 1 2 3 4 5 6 class MyThread extends Thread { @Override public void run() { System.out.println(Thread.currentThread().getName()); } } implement Runnable 1 2 3 4 5 6 7 8 9 10 class RunnableThread implement Runnable { @Override public void run() { System.out.println(Thread.currentThread().getName()); } public static void main(String[] args) { new Thread(new RunnableThread()).start(); } } implement Callable\u0026lt;\u0026gt; Callable å¯ä»¥æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼é€šè¿‡ FutureTask è¿›è¡Œå°è£…ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 class CallbaleThead implement Callbale\u0026lt;Integer\u0026gt; { @Override public Integer call() throws Exception { return 666; } public static void main(String[] args) { FutureTask\u0026lt;Integer\u0026gt; futureTask = new FutureTask\u0026lt;\u0026gt;(new CallbaleThead()); new Thread(futureTask).start(); int result = futureTask.get(); } } çº¿ç¨‹æ±  1 2 3 4 5 6 7 8 9 public class Demo { public static void main(String[] args) { ExecutorService executorService = Executors.newFixThreadPool(10); for (int i = 0; i \u0026lt; 10; i++) { executorService.execute(() -\u0026gt; System.out.println(Thread.currentThread().getName())); } } } 1 2 3 4 5 6 7 8 9 10 11 12 public class Demo { public static void main(String[] args) { ExecutorService executorService = Executors.newFixThreadPool(10); Future\u0026lt;Integer\u0026gt; future = executorService.submit(() -\u0026gt; { Thread.sleep(1000); return 666; }); int result = future.get(); } } çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ 1 2 3 4 5 6 7 8 9 10 public class Thread implements Runnable { public enum State { NEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING, TErMINATED; } } æ–°å»º New åˆ›å»ºåå°šæœªå¯åŠ¨ã€‚\nå¯è¿è¡Œ Runnable å¯èƒ½æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½æ­£åœ¨ç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚\né˜»å¡ Blocking ç­‰å¾…è·å–ä¸€ä¸ªæ’å®ƒé”ï¼Œå¦‚æœå…¶çº¿ç¨‹é‡Šæ”¾äº†é”å°±ä¼šç»“æŸæ­¤çŠ¶æ€ã€‚\næ— é™æœŸç­‰å¾… Waiting ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œå¦åˆ™ä¸ä¼šè¢«åˆ†é… CPU æ—¶é—´ç‰‡ã€‚\né™æœŸç­‰å¾… Timed Waiting æ— éœ€ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ã€‚\næ­»äº¡ Terminated çº¿ç¨‹ç»“æŸä»»åŠ¡ä¹‹åè‡ªå·±ç»“æŸï¼Œæˆ–è€…äº§ç”Ÿäº†å¼‚å¸¸è€Œç»“æŸã€‚\nå‚è€ƒ https://pdai.tech/md/java/thread/java-thread-x-thread-basic.html#%e5%ae%9e%e7%8e%b0-callable-%e6%8e%a5%e5%8f%a3 ","date":"2022-03-30T14:02:02+08:00","image":"https://emerywan.github.io/blog/imgs/9.jpeg","permalink":"https://emerywan.github.io/blog/p/thread/","title":"Java å¤šçº¿ç¨‹"},{"content":"â˜˜ï¸ é€šç”¨ç¨‹åºè®¾è®¡ Effective Java é˜…è¯»ç¬”è®°ã€‚æœ¬ç« ä¸»è¦è®¨è®ºäº† Java è¯­è¨€çš„å…·ä½“ç»†èŠ‚ã€‚åŒ…æ‹¬ï¼š\nå±€éƒ¨å˜é‡ æ§åˆ¶ç»“æ„ ç±»åº“ æ•°æ®ç»“æ„ ä¸æ˜¯ç”±è¯­è¨€æœ¬èº«æä¾›çš„æœºåˆ¶ ä¼˜åŒ–å’Œå‘½åæƒ¯ä¾‹ã€‚ 57. å°†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæœ€å°åŒ– ğŸŒ¸ å»ºè®® ğŸŒ± æœ€å°åŒ–å±€éƒ¨å˜é‡çš„èŒƒå›´ï¼Œå¯æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œé™ä½å‡ºé”™çš„å¯èƒ½æ€§ã€‚åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å®ƒçš„åœ°æ–¹å£°æ˜å˜é‡ã€‚\nğŸ€ æ¯ä¸ªå±€éƒ¨å˜é‡å£°æ˜éƒ½åº”è¯¥åŒ…å«ä¸€ä¸ªåˆå§‹åŒ–è¡¨è¾¾å¼ã€‚try-catch è¯­å¥é™¤å¤–ã€‚\nå¦‚æœä¸€ä¸ªå˜é‡åˆå§‹åŒ–ï¼Œä¼šæŠ›å‡ºä¸€ä¸ª checked å¼‚å¸¸ï¼Œå¿…é¡»åœ¨ try ä¸­åˆå§‹åŒ–ï¼ˆé™¤éæ‰€åŒ…å«çš„æ–¹æ³•å¯ä»¥æŠ›å¼‚å¸¸ï¼‰ã€‚\nå¦‚æœè¯¥å€¼å¿…é¡»åœ¨ try å—ä¹‹å¤–ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åœ¨ try å—ä¹‹å‰å£°æ˜ï¼Œæ­¤æ—¶å®ƒè¿˜ä¸èƒ½â€œåˆç†åœ°åˆå§‹åŒ–â€œã€‚\n1 2 3 4 5 Set\u0026lt;String\u0026gt; set = null; try { set = cons.newInstance(); } catch () { } ğŸ€ å¾ªç¯ç»“æŸåä¸å†éœ€è¦å¾ªç¯å˜é‡ï¼Œfor å¾ªç¯å°±ä¼˜äº while å¾ªç¯ï¼ˆfor å¾ªç¯å…è®¸å£°æ˜å¾ªç¯å˜é‡ï¼‰ã€‚\nğŸŒ± ä¿æŒæ–¹æ³•å°è€Œé›†ä¸­ï¼Œæ¯ä¸ªæ“ä½œéƒ½ç”¨ä¸€ä¸ªæ–¹æ³•æ¥å®Œæˆã€‚é¿å…ä¸€ä¸ªæ“ä½œç›¸å…³çš„å±€éƒ¨å˜é‡å¯èƒ½åœ¨å¦ä¸€ä¸ªæ“ä½œä¸­ã€‚\nğŸŒ» æ¡ˆä¾‹ ğŸŒ¾ éå†é›†åˆçš„é¦–é€‰ä¹ æƒ¯ç”¨æ³•\n1 2 3 for (Element e : c) { // do something with e } ğŸ’ éœ€è¦è®¿é—® Iterator / è°ƒç”¨ Iterator çš„ remove()ï¼Œé¦–é€‰ for\n1 2 3 4 for (Iterator\u0026lt;Element\u0026gt; i = c.iterator(); i.hasNext(); ) { // i is loop variable Element e = i.next(); // do something with i and e } ğŸ’ å¾ªç¯ä¹ æƒ¯ç”¨æ³•ï¼šæœ€å°åŒ–å±€éƒ¨å˜é‡çš„èŒƒå›´\n1 2 3 4 // æ¯æ¬¡å¾ªç¯éƒ½ä¼šè°ƒç”¨ expensiveComputation()ï¼Œä¸”è¿”å›ç»“æœç›¸åŒ for (int i = 0, n = expensiveComputation(); i \u0026lt; n; i++) { // do something with i } å®ƒæœ‰ä¸¤ä¸ªå¾ªç¯å˜é‡ï¼ši å’Œ nï¼Œéƒ½å…·æœ‰å®Œå…¨æ­£ç¡®çš„ä½œç”¨åŸŸã€‚ç¬¬äºŒä¸ªå˜é‡ n ç”¨äºå­˜å‚¨ç¬¬ä¸€ä¸ªå˜é‡çš„æé™ï¼Œé¿å…äº†æ¯æ¬¡è¿­ä»£ä¸­å†—ä½™è®¡ç®—çš„æˆæœ¬ã€‚ å¦‚æœå¾ªç¯æ¶‰åŠä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸”ä¿è¯åœ¨æ¯æ¬¡è¿­ä»£ä¸­è¿”å›ç›¸åŒçš„ç»“æœï¼Œåº”è¯¥ä½¿ç”¨è¿™ä¸ªä¹ æƒ¯ç”¨æ³•ã€‚\n58. for-each å¾ªç¯ä¼˜äºä¼ ç»Ÿçš„ for å¾ªç¯ ğŸŒ¸ å»ºè®® ğŸŒ± for-each éšè—è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡ï¼Œå¯æ¶ˆé™¤æ··ä¹±å’Œå‡ºé”™ã€‚\nğŸŒ± : è¡¨ç¤º â€œåœ¨\u0026hellip;é‡Œé¢â€ã€‚ä½¿ç”¨ for-each å¾ªç¯ä¸ä¼šé™ä½æ€§èƒ½ã€‚\nğŸ¥€ ä»¥ä¸‹æƒ…å†µä¸åº”è¯¥ä½¿ç”¨ for-eachï¼š\nğŸŒ° ç ´åæ€§è¿‡æ»¤ã€‚å¦‚æœéœ€è¦éå†ä¸€ä¸ªé›†åˆå¹¶åˆ é™¤é€‰å®šå…ƒç´ ï¼Œéœ€è¦ä½¿ç”¨æ˜¾å¼çš„è¿­ä»£å™¨ï¼Œä»¥ä¾¿è°ƒç”¨å…¶ remove()ã€‚\nğŸŒ° è½¬æ¢ã€‚éå†æ—¶éœ€è¦æ›¿æ¢å…¶ä¸­å…ƒç´ çš„å€¼ï¼Œéœ€è¦ List è¿­ä»£å™¨æˆ–æ•°ç»„ç´¢å¼•æ¥æ›¿æ¢å…ƒç´ çš„å€¼ã€‚\nğŸŒ° å¹¶è¡Œè¿­ä»£ã€‚å¦‚æœéœ€è¦å¹¶è¡Œéå†å¤šä¸ªé›†åˆï¼Œé‚£ä¹ˆéœ€è¦æ˜¾å¼åœ°æ§åˆ¶è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡ï¼Œä»¥ä¾¿æ‰€æœ‰è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡éƒ½å¯ä»¥åŒæ­¥æ‰§è¡Œã€‚\nğŸŒ» æ¡ˆä¾‹ ğŸ’ ä½¿ç”¨ Collection.removeIf() å¯é¿å…æ˜¾å¼çš„éå†ï¼ˆJava8ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 public interface Collection\u0026lt;E\u0026gt; extends Iterable\u0026lt;E\u0026gt; { default boolean removeIf(Predicate\u0026lt;? super E\u0026gt; filter) { Objects.requireNonNull(filter); boolean removed = false; final Iterator\u0026lt;E\u0026gt; each = interator(); while (each.hasNext()) { if (filter.test(each.next)) { each.remove(); removed = true; } } return removed; } } 59. äº†è§£å¹¶ä½¿ç”¨åº“ ğŸŒ¸ å»ºè®® èƒ½ç”¨åº“æ–¹æ³•å°±ç”¨åº“æ–¹æ³•ã€‚\nå…·æœ‰ç®—æ³•èƒŒæ™¯çš„é«˜çº§å·¥ç¨‹å¸ˆèŠ±äº†å¤§é‡æ—¶é—´è®¾è®¡ã€å®ç°å’Œæµ‹è¯•åº“æ–¹æ³•ï¼Œç„¶åå°†åº“æ–¹æ³•å±•ç¤ºç»™è¯¥é¢†åŸŸçš„å‡ ä½ä¸“å®¶ï¼Œä»¥ç¡®ä¿åº“æ–¹æ³•æ˜¯æ­£ç¡®çš„ã€‚ è¿™äº›åº“æ–¹æ³•ç»è¿‡ beta æµ‹è¯•ã€å‘å¸ƒï¼Œå¹¶è¢«æ•°ç™¾ä¸‡ç¨‹åºå‘˜å¹¿æ³›ä½¿ç”¨äº†è¿‘ 20 å¹´ã€‚\nğŸŒ± ä½¿ç”¨æ ‡å‡†ç±»åº“çš„å¥½å¤„ï¼š\nğŸŒ° åˆ©ç”¨ç¼–å†™å®ƒçš„ä¸“å®¶çš„çŸ¥è¯†å’Œä»¥å‰ä½¿ç”¨å®ƒçš„äººçš„ç»éªŒã€‚ ğŸŒ° ä¸å¿…æµªè´¹æ—¶é—´ä¸ºé‚£äº›ä¸ä½ çš„å·¥ä½œæ— å…³çš„é—®é¢˜ç¼–å†™ä¸“é—¨çš„è§£å†³æ–¹æ¡ˆã€‚ ğŸŒ° éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå®ƒä»¬çš„æ€§èƒ½ä¼šä¸æ–­æé«˜ï¼Œæ— éœ€ä»˜å‡ºä»»ä½•åŠªåŠ›ã€‚ï¼ˆç‰ˆæœ¬æ›´æ–°ï¼‰ ğŸŒ° å¯ä»¥å°†ä»£ç æ”¾åœ¨ä¸»å¹²ä¸­ã€‚è¿™æ ·çš„ä»£ç æ›´å®¹æ˜“è¢«å¼€å‘äººå‘˜é˜…è¯»ã€ç»´æŠ¤å’Œå¤ç”¨ã€‚ ğŸŒ± åœ¨æ¯ä¸ªä¸»è¦ç‰ˆæœ¬ä¸­ï¼Œéƒ½ä¼šå‘åº“ä¸­æ·»åŠ è®¸å¤šç‰¹æ€§ï¼Œäº†è§£è¿™äº›æ–°å¢ç‰¹æ€§æ˜¯å€¼å¾—çš„ã€‚\nğŸ€ æ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥ç†Ÿæ‚‰ java.langã€java.util å’Œ java.io çš„åŸºç¡€çŸ¥è¯†åŠå…¶å­åŒ…ã€‚ å…¶ä»–åº“çš„çŸ¥è¯†å¯ä»¥æ ¹æ®éœ€è¦è·å¾—ã€‚å°¤å…¶æ˜¯ï¼š\nğŸŒ° java.util.Collections ğŸŒ° java.util.Streams ğŸŒ° java.util.concurrent ğŸ€ å¦‚æœä½ åœ¨ Java å¹³å°åº“ä¸­æ‰¾ä¸åˆ°ä½ éœ€è¦çš„ä¸œè¥¿ï¼Œä½ çš„ä¸‹ä¸€ä¸ªé€‰æ‹©åº”è¯¥æ˜¯å¯»æ‰¾é«˜è´¨é‡çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚è°·æ­Œçš„ä¼˜ç§€çš„å¼€æº Guava åº“ã€‚å¦‚æœä½ æ— æ³•åœ¨ä»»ä½•é€‚å½“çš„åº“ä¸­æ‰¾åˆ°æ‰€éœ€çš„åŠŸèƒ½ï¼Œåªèƒ½è‡ªå·±å®ç°å®ƒã€‚\nğŸŒ» æ¡ˆä¾‹ ğŸ’ ä» Java 7 å¼€å§‹ï¼Œå°±ä¸åº”è¯¥å†ä½¿ç”¨ Randomã€‚\nğŸŒ° åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé€‰æ‹©çš„éšæœºæ•°ç”Ÿæˆå™¨ç°åœ¨æ˜¯ ThreadLocalRandomã€‚ å®ƒèƒ½äº§ç”Ÿæ›´é«˜è´¨é‡çš„éšæœºæ•°ï¼Œè€Œä¸”é€Ÿåº¦éå¸¸å¿«ã€‚ThreadLocalRandom.current().nextInt(100)\nğŸŒ° å¯¹äº Fork Join Pool å’Œå¹¶è¡Œ Streamï¼Œä½¿ç”¨ SplittableRandomã€‚\nå‡è®¾ä½ æƒ³è¦ç”Ÿæˆ 0 åˆ°æŸä¸ªä¸Šç•Œä¹‹é—´çš„éšæœºæ•´æ•°ï¼Œè®¸å¤šç¨‹åºå‘˜ä¼šç¼–å†™ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„å°æ–¹æ³•ï¼š\n1 2 3 4 5 // æœ‰ä¸¥é‡ç¼ºé™· static Random rnd = new Random(); static int random(int n) { return Math.abs(rad.nextInt()) % n; } å®ƒæœ‰ä¸‰ä¸ªç¼ºç‚¹:\nğŸŒ© n æ˜¯å°çš„å¹³æ–¹æ•°ï¼Œéšæœºæ•°åºåˆ—ä¼šåœ¨ç›¸å½“çŸ­çš„æ—¶é—´å†…é‡å¤ ğŸŒ© å¦‚æœ n ä¸æ˜¯ 2 çš„å¹‚ï¼Œé‚£ä¹ˆå¹³å‡è€Œè¨€ï¼Œä¸€äº›æ•°å­—å°†æ¯”å…¶ä»–æ•°å­—æ›´é¢‘ç¹åœ°è¿”å› ğŸŒ© åœ¨æå°‘æ•°æƒ…å†µä¸‹ä¼šè¿”å›è¶…å‡ºæŒ‡å®šèŒƒå›´çš„æ•°å­— Integer.MAX_VALUE åº”è¯¥ç›´æ¥ä½¿ç”¨ç±»åº“ Ramdom.nextInt(n) ï¼Œè€Œä¸æ˜¯è‡ªå·±å°è£…\n1 public int nextInt(int n); ğŸŒ¾ Linux curl in Java 9\nå‡è®¾ä½ æƒ³ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥æ‰“å°å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„ URL çš„å†…å®¹ï¼ˆè¿™å¤§è‡´æ˜¯ Linux curl å‘½ä»¤æ‰€åšçš„ï¼‰ã€‚åœ¨ Java 9 ä¹‹å‰ï¼Œè¿™æ®µä»£ç æœ‰ç‚¹ä¹å‘³ï¼Œä½†æ˜¯åœ¨ Java 9 ä¸­ï¼ŒtransferTo() è¢«æ·»åŠ åˆ° InputStream ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨è¿™ä¸ªæ–°æ–¹æ³•æ‰§è¡Œè¿™é¡¹ä»»åŠ¡çš„å®Œæ•´ç¨‹åºï¼š\n1 2 3 4 5 public static void main(String[] args) throws IOException { try (InputStream in = new URL(args[0]).openStream()) { in.transferTo(System.out); } } 60. è‹¥éœ€è¦ç²¾ç¡®ç­”æ¡ˆå°±åº”é¿å…ä½¿ç”¨ float double ğŸŒ¸ å»ºè®® ğŸŒ± float å’Œ double ç±»å‹ç‰¹åˆ«ä¸é€‚åˆè¿›è¡Œè´§å¸è®¡ç®—ï¼Œå› ä¸ºä¸èƒ½å°† 0.1ï¼ˆæˆ– 10 çš„ä»»æ„è´Ÿæ¬¡å¹‚ï¼‰ç²¾ç¡®åœ°è¡¨ç¤ºã€‚ 1 2 // 0.6100000000000001 System.out.println(1.03 - 0.42); ğŸ€ æ•°å€¼ä¸æ˜¯å¤ªå¤§ï¼Œå¯ä»¥ä½¿ç”¨ int æˆ– long ğŸŒ° å¦‚æœæ•°å€¼ä¸è¶…è¿‡ 9 ä½å°æ•°ï¼Œå¯ä»¥ä½¿ç”¨ int ğŸŒ° å¦‚æœä¸è¶…è¿‡ 18 ä½ï¼Œå¯ä»¥ä½¿ç”¨ long ğŸŒ° å¦‚æœæ•°é‡å¯èƒ½è¶…è¿‡ 18 ä½ï¼Œåˆ™ä½¿ç”¨ BigDecimal ä¾‹å¦‚ï¼šåœ¨å¾®ä¿¡æ”¯ä»˜çš„ Java SDK ä¸­ï¼Œè´§å¸çš„ç±»å‹ä¸º intï¼Œç»“ç®—å•ä½ä¸º åˆ†ï¼› åœ¨æ”¯ä»˜å®æ”¯ä»˜çš„ Java SDK ä¸­ï¼Œè´§å¸çš„ç±»å‹ä¸º Stringï¼Œç»“ç®—å•ä½ä¸º å…ƒ\nğŸŒ± ä½¿ç”¨ BigDecimal ç±»å‹ä»£æ›¿ double / floatã€‚æ³¨æ„ï¼Œä½¿ç”¨ BigDecimal çš„ String æ„é€ å‡½æ•°è€Œä¸æ˜¯å®ƒçš„ double / float æ„é€ å‡½æ•°ã€‚ 61. åŸºæœ¬æ•°æ®ç±»å‹ä¼˜äºåŒ…è£…ç±» ğŸŒ¸ å»ºè®® ğŸŒ± Java ç±»å‹ç³»ç»Ÿç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š\nğŸŒ° åŸºæœ¬ç±»å‹ï¼ˆprimitive typeï¼‰ï¼šint double boolean ğŸŒ° å¼•ç”¨ç±»å‹ï¼ˆreference typeï¼‰ï¼šString List æ¯ä¸ªåŸºæœ¬ç±»å‹éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å¼•ç”¨ç±»å‹ï¼Œç§°ä¸ºåŒ…è£…ç±»å‹ã€‚ ğŸŒ± åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹ä¹‹é—´æœ‰ä¸‰ä¸ªä¸»è¦åŒºåˆ«ï¼š\nğŸŒ° åŸºæœ¬ç±»å‹åªæœ‰å®ƒä»¬çš„å€¼ï¼Œè€ŒåŒ…è£…ç±»å‹å…·æœ‰ä¸å…¶å€¼ä¸åŒçš„æ ‡è¯† ğŸŒ° åŸºæœ¬ç±»å‹åªæœ‰å…¨åŠŸèƒ½å€¼ï¼Œè€Œæ¯ä¸ªåŒ…è£…ç±»å‹é™¤äº†å¯¹åº”çš„åŸºæœ¬ç±»å‹çš„æ‰€æœ‰åŠŸèƒ½å€¼å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéåŠŸèƒ½å€¼ï¼Œå³ null ğŸŒ° åŸºæœ¬ç±»å‹æ¯”åŒ…è£…ç±»å‹æ›´èŠ‚çœæ—¶é—´å’Œç©ºé—´ ğŸ€ è¦æœ‰é€‰æ‹©ï¼Œå°±åº”è¯¥ä¼˜å…ˆä½¿ç”¨åŸºæœ¬ç±»å‹ï¼Œè€Œä¸æ˜¯åŒ…è£…ç±»å‹ã€‚åŸºæœ¬ç±»å‹æ›´ç®€å•ã€æ›´å¿«ã€‚\nğŸ¥€ ä»¥ä¸‹æƒ…å†µå¿…é¡»ä½¿ç”¨åŒ…è£…ç±»å‹ï¼š\nğŸŒ° ä½œä¸ºé›†åˆä¸­çš„å…ƒç´ ã€é”®å’Œå€¼ ğŸŒ° å¿…é¡»ä½¿ç”¨åŒ…è£…ç±»å‹ä½œä¸ºç±»å‹å‚æ•°ï¼ŒJava ä¸å…è®¸ä½¿ç”¨åŸºæœ¬ç±»å‹ã€‚å¦‚ ThreadLocal\u0026lt;Integer\u0026gt; ğŸŒ° è¿›è¡Œåå°„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¿…é¡»ä½¿ç”¨åŒ…è£…ç±»å‹ ğŸŒ» æ¡ˆä¾‹ ğŸŒ¾ ä»¥ä¸‹ä¸‰ä¸ªä¾‹å­ä¸ºå¸¸è§çš„åŒ…è£…ç±»å‹é—®é¢˜ï¼š\nğŸŒ© å°† == æ“ä½œç¬¦åº”ç”¨äºåŒ…è£…ç±»å‹å‡ ä¹éƒ½æ˜¯é”™è¯¯çš„\n1 2 ğŸ™…â€â™‚ï¸ Comparator\u0026lt;Integer\u0026gt; naturalOrder =(i, j) -\u0026gt; (i \u0026lt; j) ? -1 : (i == j ? 0 : 1); è¡¨è¾¾å¼ i \u0026lt; j ä¼šä½¿ i å’Œ j å¼•ç”¨çš„ Integer å®ä¾‹è‡ªåŠ¨æ‹†ç®±ã€‚ è¡¨è¾¾å¼ i == j å¯¹ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ‰§è¡Œæ¯”è¾ƒï¼Œè¿”å› falseã€‚\n1 2 3 4 5 ğŸ™† Comparator\u0026lt;Integer\u0026gt; naturalOrder = (iBoxed, jBoxed) -\u0026gt; { int i = iBoxed, j = jBoxed; // è‡ªåŠ¨æ‹†ç®± return i \u0026lt; j ? -1 : (i == j ? 0 : 1); }; ğŸŒ© NullPointerException\n1 2 3 4 5 6 7 public class Unbelievable { static Integer i; public static void main(String[] args) { if (i == 42) System.out.println(\u0026#34;Unbelievable\u0026#34;); } } è®¡ç®—è¡¨è¾¾å¼ i == 42 æ—¶æŠ›å‡º NullPointerExceptionã€‚ç©ºå¯¹è±¡å¼•ç”¨è‡ªåŠ¨æ‹†ç®±ï¼Œå°†å¾—åˆ°ä¸€ä¸ª NullPointerExceptionã€‚\nğŸŒ© ä¸¥é‡çš„æ€§èƒ½é—®é¢˜\n1 2 3 4 5 6 7 public static void main(String[] args) { Long sum = 0L; for (long i = 0; i \u0026lt; Integer.MAX_VALUE; i++) { sum += i; } System.out.println(sum); } å±€éƒ¨å˜é‡ sumï¼Œå®ƒæ˜¯åŒ…è£…ç±»å‹ Longï¼Œè€Œä¸æ˜¯åŸºæœ¬ç±»å‹ longã€‚å˜é‡è¢«åå¤è£…ç®±å’Œæ‹†ç®±ï¼ˆè¶…å‡ºç¼“å­˜éƒ¨åˆ†æ—¶ï¼‰ï¼Œå¯¼è‡´äº§ç”Ÿæ˜æ˜¾çš„æ€§èƒ½ä¸‹é™ã€‚\n62. å…¶ä»–ç±»å‹æ›´åˆé€‚æ—¶ï¼Œåº”é¿å…ä½¿ç”¨å­—ç¬¦ä¸² ğŸŒ¸ å»ºè®® ğŸŒ± å½“å­˜åœ¨æˆ–å¯ä»¥ç¼–å†™æ›´å¥½çš„æ•°æ®ç±»å‹æ—¶ï¼Œåº”é¿å…å°†å­—ç¬¦ä¸²ç”¨æ¥è¡¨ç¤ºå¯¹è±¡ã€‚\nğŸŒ± å¦‚æœä½¿ç”¨ä¸å½“ï¼Œå­—ç¬¦ä¸²æ¯”å…¶ä»–ç±»å‹æ›´éº»çƒ¦ã€çµæ´»æ€§æ›´å·®ã€é€Ÿåº¦æ›´æ…¢ã€æ›´å®¹æ˜“å‡ºé”™ã€‚\nğŸ€ å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿å…¶ä»–çš„å€¼ç±»å‹ã€‚\nğŸŒ° å¦‚æœæ˜¯æ•°å€¼ç±»å‹ï¼Œåˆ™åº”å°†å…¶è½¬æ¢ä¸ºé€‚å½“çš„æ•°å€¼ç±»å‹ï¼Œå¦‚ intã€float æˆ– BigIntegerã€‚ ğŸŒ° å¦‚æœæ˜¯é—®é¢˜çš„ç­”æ¡ˆï¼Œå¦‚â€œæ˜¯â€æˆ–â€œå¦â€è¿™ç±»å½¢å¼ï¼Œåˆ™åº”å°†å…¶è½¬æ¢ä¸ºé€‚å½“çš„ Enum æˆ– booleanã€‚ ğŸŒ° æ›´ä¸€èˆ¬åœ°ï¼Œå¦‚æœæœ‰åˆé€‚çš„å€¼ç±»å‹ï¼Œæ— è®ºæ˜¯åŸºæœ¬ç±»å‹è¿˜æ˜¯å¯¹è±¡å¼•ç”¨ï¼Œéƒ½åº”è¯¥ä½¿ç”¨å®ƒï¼›å¦‚æœæ²¡æœ‰ï¼Œåº”è¯¥å†™ä¸€ä¸ªã€‚ ğŸŒ± å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿æšä¸¾ç±»å‹ã€‚\nğŸŒ± å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿èšåˆç±»å‹ã€‚\nå¦‚æœä¸€ä¸ªå®ä½“æœ‰å¤šä¸ªç»„ä»¶ï¼Œå°†å…¶è¡¨ç¤ºä¸ºå•ä¸ªå­—ç¬¦ä¸²é€šå¸¸æ˜¯å¾ˆä¸åˆé€‚çš„ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢è¿™è¡Œä»£ç æ¥è‡ªä¸€ä¸ªçœŸå®çš„ç³»ç»Ÿæ ‡è¯†ç¬¦ï¼š\n1 String compoundKey = className + \u0026#34;#\u0026#34; + i.next(); è¿™ç§æ–¹æ³•æœ‰å¾ˆå¤šç¼ºç‚¹ï¼šå¦‚æœç”¨äºåˆ†éš”å­—æ®µ # çš„å­—ç¬¦å‡ºç°åœ¨å…¶ä¸­ä¸€ä¸ªå­—æ®µä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ··ä¹±ã€‚è¦è®¿é—®å„ä¸ªå­—æ®µï¼Œä½ å¿…é¡»è§£æå­—ç¬¦ä¸²ã€‚ä¸èƒ½æä¾› equalsã€toString æˆ– compareTo æ–¹æ³•ï¼Œä½†å¿…é¡»æ¥å— String æä¾›çš„è¡Œä¸ºã€‚ æ›´å¥½çš„æ–¹æ³•æ˜¯ç¼–å†™ä¸€ä¸ªç±»æ¥è¡¨ç¤ºèšåˆï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç§æœ‰é™æ€æˆå‘˜ç±»ã€‚ï¼ˆItem-24ï¼‰ã€‚\nğŸ€ å­—ç¬¦ä¸²ä¸é€‚åˆä»£æ›¿ capabilities\næœ‰æ—¶ï¼Œå­—ç¬¦ä¸²ç”¨äºæˆäºˆå¯¹æŸäº›åŠŸèƒ½çš„è®¿é—®æƒã€‚\nä¾‹å¦‚ï¼Œè€ƒè™‘çº¿ç¨‹æœ¬åœ°å˜é‡æœºåˆ¶çš„è®¾è®¡ã€‚è¿™æ ·çš„æœºåˆ¶æä¾›äº†æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å˜é‡å€¼ã€‚ è¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼šå­—ç¬¦ä¸²é”®è¡¨ç¤ºçº¿ç¨‹æœ¬åœ°å˜é‡çš„å…±äº«å…¨å±€åç§°ç©ºé—´ã€‚ ä¸ºäº†ä½¿è¿™ç§æ–¹æ³•æœ‰æ•ˆï¼Œå®¢æˆ·ç«¯æä¾›çš„å­—ç¬¦ä¸²é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼šå¦‚æœä¸¤ä¸ªå®¢æˆ·ç«¯å„è‡ªå†³å®šä¸ºå®ƒä»¬çš„çº¿ç¨‹æœ¬åœ°å˜é‡ä½¿ç”¨ç›¸åŒçš„åç§°ï¼Œå®ƒä»¬æ— æ„ä¸­å°±ä¼šå…±äº«ä¸€ä¸ªå˜é‡ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´ä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½å¤±è´¥ã€‚ è€Œä¸”å®‰å…¨æ€§å¾ˆå·®ã€‚æ¶æ„å®¢æˆ·ç«¯å¯ä»¥æ•…æ„ä½¿ç”¨ä¸å¦ä¸€ä¸ªå®¢æˆ·ç«¯ç›¸åŒçš„å­—ç¬¦ä¸²å¯†é’¥æ¥éæ³•è®¿é—®å¦ä¸€ä¸ªå®¢æˆ·ç«¯çš„æ•°æ®ã€‚\n63. å½“å¿ƒå­—ç¬¦ä¸²è¿æ¥å¼•èµ·çš„æ€§èƒ½é—®é¢˜ ğŸŒ¸ å»ºè®® ğŸŒ± ä¸è¦ä½¿ç”¨å­—ç¬¦ä¸²è¿æ¥æ“ä½œç¬¦åˆå¹¶å¤šä¸ªå­—ç¬¦ä¸²ï¼Œé™¤éæ€§èƒ½æ— å…³ç´§è¦ã€‚ä½¿ç”¨å­—ç¬¦ä¸²ä¸²è”è¿ç®—ç¬¦ +ï¼Œé‡å¤ä¸²è” n ä¸ªå­—ç¬¦ä¸²ï¼Œéœ€è¦ n çš„å¹³æ–¹çº§æ—¶é—´ã€‚\nğŸ€ ä½¿ç”¨ StringBuilder ä»£æ›¿ String\n64. é€šè¿‡æ¥å£å¼•ç”¨å¯¹è±¡ ğŸŒ¸ å»ºè®® ğŸ€ ä¼˜å…ˆä½¿ç”¨æ¥å£è€Œä¸æ˜¯ç±»æ¥å¼•ç”¨å¯¹è±¡ã€‚å¦‚æœå­˜åœ¨åˆé€‚çš„æ¥å£ç±»å‹ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨æ¥å£ç±»å‹å£°æ˜å‚æ•°ã€è¿”å›å€¼ã€å˜é‡å’Œå­—æ®µã€‚\nğŸŒ± ä½¿ç”¨æ¥å£ä½œä¸ºç±»å‹çš„ä¹ æƒ¯ï¼Œç¨‹åºå°†æ›´åŠ çµæ´»ã€‚\nğŸ¥€ ä»¥ä¸‹æƒ…å†µä½¿ç”¨ ç±» æ¥å¼•ç”¨å¯¹è±¡ï¼š\nğŸŒ° æ²¡æœ‰åˆé€‚çš„æ¥å£å­˜åœ¨ String å’Œ BigInteger ğŸŒ° æ¡†æ¶çš„åŸºæœ¬ç±»å‹æ˜¯ç±»ï¼Œä¸æ˜¯æ¥å£ java.io ğŸŒ° å®ç°æ¥å£çš„ç±»æä¾›äº†æ¥å£ä¸­ä¸å­˜åœ¨çš„é¢å¤–æ–¹æ³• PriorityQueue ä¸­å®ç°äº† Queue ä¸å­˜åœ¨çš„ comparator ğŸŒ» æ¡ˆä¾‹ ğŸŒ¾ ä¼˜å…ˆä½¿ç”¨æ¥å£ä½œä¸ºç±»å‹ 1 2 3 4 5 ğŸ™† Set\u0026lt;Son\u0026gt; sonSet = new LinkedHashSet\u0026lt;\u0026gt;(); ğŸ™…â€â™‚ï¸ LinkedHashSet\u0026lt;Son\u0026gt; sonSet = new LinkedHashSet\u0026lt;\u0026gt;(); 65. æ¥å£ä¼˜å…ˆåå°„æœºåˆ¶ ğŸŒ¸ å»ºè®® ğŸŒ± æ ¸å¿ƒåå°„æœºåˆ¶ java.lang.reflect æä¾›å¯¹ä»»æ„ç±»çš„ç¼–ç¨‹è®¿é—®ã€‚ç»™å®šä¸€ä¸ª Class å¯¹è±¡ï¼Œå¯ä»¥è·å¾— Constructorã€Methodã€Filed å®ä¾‹ã€‚\nğŸŒ± é€šè¿‡è¿‡è°ƒç”¨ Constructorã€Methodã€Filed å®ä¾‹ä¸Šçš„æ–¹æ³•ï¼Œå¯ä»¥æ„é€ åº•å±‚çš„å®ä¾‹ã€è°ƒç”¨åº•å±‚ç±»çš„æ–¹æ³•ã€è®¿é—®åº•å±‚ç±»ä¸­çš„å­—æ®µã€‚\nğŸŒ° Method.invoke() ğŸ¥€ åå°„å…è®¸ä¸€ä¸ªç±»ä½¿ç”¨å¦ä¸€ä¸ªç±»ï¼Œå³ä½¿åœ¨ç¼–è¯‘å‰è€…æ—¶åè€…å¹¶ä¸å­˜åœ¨ã€‚ç„¶è€Œï¼Œè¿™ç§èƒ½åŠ›æ˜¯æœ‰ä»£ä»·çš„ï¼š\nğŸŒ° å¤±å»äº†ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥çš„æ‰€æœ‰å¥½å¤„ï¼ŒåŒ…æ‹¬å¼‚å¸¸æ£€æŸ¥ã€‚ ğŸŒ° æ‰§è¡Œåå°„è®¿é—®æ‰€éœ€çš„ä»£ç æ—¢ç¬¨æ‹™åˆå†—é•¿ã€‚å†™èµ·æ¥å¾ˆä¹å‘³ï¼Œè¯»èµ·æ¥ä¹Ÿå¾ˆå›°éš¾ã€‚ ğŸŒ° æ€§èƒ½é™ä½ã€‚ ğŸ€ å¦‚æœä½ å¯¹åº”ç”¨ç¨‹åºæ˜¯å¦éœ€è¦åå°„æœ‰ä»»ä½•ç–‘é—®ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¸éœ€è¦ã€‚\nğŸŒ± å¦‚æœå¿…é¡»ç”¨åˆ°åœ¨ç¼–è¯‘æ—¶æ— æ³•è·å–çš„ç±»ï¼Œåœ¨ç¼–è¯‘æ—¶å­˜åœ¨ä¸€ä¸ªé€‚å½“çš„æ¥å£æˆ–è¶…ç±»æ¥ï¼Œå¯ä»¥ç”¨åå°„æ–¹å¼åˆ›å»ºå®ä¾‹ï¼Œå¹¶é€šè¿‡å®ƒä»¬çš„æ¥å£æˆ–è¶…ç±»æ­£å¸¸åœ°è®¿é—®å®ƒä»¬ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 public static void main(String[] args) { // Translate the class name into a Class object Class\u0026lt;? extends Set\u0026lt;String\u0026gt;\u0026gt; cl = null; try { cl = (Class\u0026lt;? extends Set\u0026lt;String\u0026gt;\u0026gt; cl = null) Class.forNmae(args[0]) // Unchecked cast } catch (ClassNotFoundException e) { fatalError(\u0026#34;Class not found.\u0026#34;); } // Get the constructor Constructor\u0026lt;? extends Set\u0026lt;String\u0026gt;\u0026gt; cons = null; try { cons = cl.getDeclaredConstructor(); } catch (NoSuchMethodException e) { fatalError(\u0026#34;No parameterless constructor\u0026#34;); } // Instantiate the set Set\u0026lt;String\u0026gt; s = null; // ğŸ™‹â€â™‚ï¸ use interface try { s = cons.newInstance(); } catch (IllegalAccessException e) { fatalError(\u0026#34;Constructor not accessible\u0026#34;); } catch (InstantiationException e) { fatalError(\u0026#34;Class not instantiable.\u0026#34;); } catch (InvocationTargetException e) { fatalError(\u0026#34;Constructor threw \u0026#34; + e.getCause()); } catch (ClassCastException e) { fatalError(\u0026#34;Class doesn\u0026#39;t implement Set\u0026#34;); } // Exercise the set s.addAll(Arrays.asList(args).subList(1, args.length)); System.out.println(s); } ğŸ¥€ ä¸Šä¾‹ä¸­åå°„æœºåˆ¶çš„ç¼ºç‚¹\nğŸŒ° äº§ç”Ÿ 6 ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ ğŸŒ° æ ¹æ®ç±»åç”Ÿäº§å®ä¾‹éœ€è¦ 25 è¡Œå†—é•¿ä»£ç ï¼Œè€Œè°ƒç”¨æ„é€ å™¨åªéœ€è¦ä¸€è¡Œã€‚ ğŸŒ± åå°„çš„åˆæ³•ç”¨é€”ï¼ˆå¾ˆå°‘ï¼‰æ˜¯ç®¡ç†ç±»å¯¹è¿è¡Œæ—¶å¯èƒ½ä¸å­˜åœ¨çš„å…¶ä»–ç±»ã€æ–¹æ³•æˆ–å­—æ®µçš„ä¾èµ–å…³ç³»ã€‚\nğŸŒ± å¦‚æœç¼–å†™çš„ç¨‹åºå¿…é¡»åœ¨ç¼–è¯‘æ—¶å¤„ç†æœªçŸ¥çš„ç±»ï¼Œåˆ™åº”è¯¥å°½å¯èƒ½åªä½¿ç”¨åå°„å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨åœ¨ç¼–è¯‘æ—¶å·²çŸ¥çš„æ¥å£æˆ–è¶…ç±»è®¿é—®å¯¹è±¡ã€‚\n66. è°¨æ…åœ°ä½¿ç”¨æœ¬åœ°æ–¹æ³• ğŸŒ¸ å»ºè®® ğŸŒ± éå¸¸ä¸å»ºè®®ä½¿ç”¨æœ¬åœ°æ–¹æ³•ã€‚JVM å˜å¾—æ›´å¿«äº†ï¼Œå¹¶ä¸” Java å¹³å°çš„æˆç†Ÿï¼Œå®ƒæä¾›äº†å¯¹è®¸å¤šä»¥å‰åªèƒ½åœ¨å®¿ä¸»å¹³å°ä¸­ä¸Šæ‰¾åˆ°çš„ç‰¹æ€§ã€‚ ä¾‹å¦‚ï¼ŒJava 9 ä¸­æ·»åŠ çš„æµ API æä¾›äº†å¯¹ OS æµç¨‹çš„è®¿é—®ã€‚\nğŸ¥€ ä½¿ç”¨æœ¬åœ°æ–¹æ³•æœ‰ä¸¥é‡çš„ç¼ºç‚¹ï¼š ğŸŒ° æœ¬åœ°è¯­è¨€ä¸å®‰å…¨ï¼ˆItem-50ï¼‰ï¼Œä½¿ç”¨æœ¬åœ°æ–¹æ³•çš„åº”ç”¨ç¨‹åºä¸å†èƒ½å…å—å†…å­˜æ¯åé”™è¯¯çš„å½±å“ã€‚ ğŸŒ° Java æ›´ä¾èµ–äºå¹³å°ï¼Œå› æ­¤ä½¿ç”¨æœ¬åœ°æ–¹æ³•çš„ç¨‹åºçš„å¯ç§»æ¤æ€§è¾ƒå·®ã€‚ ğŸŒ° å®ƒä»¬æ›´éš¾è°ƒè¯•ã€‚ ğŸŒ° å¦‚æœä¸å°å¿ƒï¼Œæœ¬åœ°æ–¹æ³•å¯èƒ½ä¼šé™ä½æ€§èƒ½ï¼Œå› ä¸ºåƒåœ¾æ”¶é›†å™¨æ— æ³•è‡ªåŠ¨è·Ÿè¸ªæœ¬åœ°å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œè€Œä¸”è¿›å‡ºæœ¬åœ°ä»£ç ä¼šäº§ç”Ÿç›¸å…³çš„æˆæœ¬ã€‚ ğŸŒ° æœ¬åœ°æ–¹æ³•éœ€è¦â€œç²˜åˆä»£ç â€ï¼Œè¿™å¾ˆéš¾é˜…è¯»ï¼Œè€Œä¸”ç¼–å†™èµ·æ¥å¾ˆä¹å‘³ã€‚ 67. è°¨æ…åœ°è¿›è¡Œä¼˜åŒ– ğŸŒ¸ å»ºè®® ğŸ€ ä¼˜åŒ–å¼Šå¤§äºåˆ©ï¼Œå°¤å…¶æ˜¯å¦‚æœè¿‡æ—©åœ°è¿›è¡Œä¼˜åŒ–ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šç”Ÿæˆæ—¢ä¸å¿«é€Ÿä¹Ÿä¸æ­£ç¡®ä¸”æ— æ³•è½»æ¾ä¿®å¤çš„è½¯ä»¶ã€‚\nğŸ€ ä¸è¦ä¸ºäº†æ€§èƒ½è€Œç‰ºç‰²åˆç†çš„æ¶æ„ã€‚åŠªåŠ›ç¼–å†™å¥½çš„ç¨‹åºï¼Œè€Œä¸æ˜¯å¿«é€Ÿçš„ç¨‹åºã€‚\nğŸ€ å¥½çš„ç¨‹åºä½“ç°äº†ä¿¡æ¯éšè—çš„åŸåˆ™ï¼šåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬åœ¨å•ä¸ªç»„ä»¶ä¸­æœ¬åœ°åŒ–è®¾è®¡å†³ç­–ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸å½±å“ç³»ç»Ÿå…¶ä½™éƒ¨åˆ†çš„æƒ…å†µä¸‹æ›´æ”¹å•ä¸ªå†³ç­–\nğŸ€ ä¸ä¼˜åŒ–ä¸æ„å‘³ç€åœ¨ç¨‹åºå®Œæˆä¹‹å‰å¯ä»¥å¿½ç•¥æ€§èƒ½é—®é¢˜ã€‚å®ç°ä¸Šçš„é—®é¢˜å¯ä»¥é€šè¿‡ä»¥åçš„ä¼˜åŒ–æ¥è§£å†³ï¼Œä½†æ˜¯å¯¹äºæ¶æ„ç¼ºé™·ï¼Œå¦‚æœä¸é‡å†™ç³»ç»Ÿï¼Œå°±ä¸å¯èƒ½è§£å†³é™åˆ¶æ€§èƒ½çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾è®¡APIã€çº¿è·¯å±‚åè®®å’ŒæŒä¹…æ•°æ®æ ¼å¼æ—¶ã€‚\nğŸ€ å†å¤šçš„åº•å±‚ä¼˜åŒ–ä¹Ÿä¸èƒ½å¼¥è¡¥ç®—æ³•é€‰æ‹©çš„ä¸è¶³ã€‚\n68. éµå®ˆè¢«å¹¿æ³›è®¤å¯çš„å‘½åçº¦å®š ğŸŒ¸ å»ºè®® ğŸŒ± Java å¹³å°æœ‰ä¸€ç»„å®Œå–„çš„å‘½åçº¦å®šï¼Œå…¶ä¸­è®¸å¤šçº¦å®šåŒ…å«åœ¨ã€ŠThe Java Language Specificationã€‹\nğŸŒ° typographical å­—é¢çº¦å®š ğŸŒ° grammatical è¯­æ³•çº¦å®š ğŸŒ± å­—é¢æƒ¯ä¾‹ç¤ºä¾‹ï¼š\nIdentifier Type Example Package or module org.junit.jupiter.api, com.google.common.collect Class or Interface Stream, FutureTask, LinkedHashMap, HttpClient Method or Field remove(), groupingBy(), getCrc() Constant Field MIN_VALUE, NEGATIVE_INFINITY Local Variable i, denom, houseNum Type Parameter T, E, K, V, X, R, U, V, T1, T2 ğŸŒ± è¯­æ³•å‘½åçº¦å®šæ¯”æ’ç‰ˆçº¦å®šæ›´çµæ´»ï¼Œä¹Ÿæ›´æœ‰äº‰è®®ã€‚\n","date":"2022-03-30T14:02:02+08:00","image":"https://emerywan.github.io/blog/p/effective-java/general-programming/effective-java_hu8285674e0bb74a2ea271ae0a19ba75ab_128063_120x120_fill_box_smart1_3.png","permalink":"https://emerywan.github.io/blog/p/effective-java/general-programming/","title":"é€šç”¨ç¨‹åºè®¾è®¡"},{"content":"è¿™ä¸€èŠ‚ï¼Œå°†ä»‹ç» LSTM (Long Shorter Term Memory)ï¼Œä»¥åŠç”¨ pytorch å®ç° LSTM ã€‚\nLSTM æ˜¯ä¸€ç§ RNN æ¨¡å‹ï¼Œæ˜¯å¯¹ simple RNN çš„æ”¹è¿›ï¼ŒLSTM å¯ä»¥é¿å…æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼Œå¯ä»¥æœ‰æ›´é•¿çš„è®°å¿†ã€‚LSTM çš„è®ºæ–‡åœ¨ 1997 å¹´å‘è¡¨ã€‚\nHochreiter and Schmidhuber.\tLong short-term\tmemory. Neural computation, 1997.\nğŸ”– LSTM LSTM ä¹Ÿæ˜¯ä¸€ç§å¾ªç¯ç¥ç»ç½‘ç»œï¼ŒåŸç†è·Ÿ simple RNN å·®ä¸å¤šï¼Œæ¯å½“è¯»å–ä¸€ä¸ªæ–°çš„è¾“å…¥ $x$ï¼Œå°±ä¼šæ›´æ–°çŠ¶æ€ $h$ã€‚\nLSTM çš„ç»“æ„æ¯” simple RNN è¦å¤æ‚å¾ˆå¤šï¼Œsimple RNN åªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µï¼Œ LSTM æœ‰å››ä¸ªå‚æ•°çŸ©é˜µã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å…·ä½“æ¥çœ‹çœ‹ LSTM çš„å†…éƒ¨ç»“æ„ã€‚\nğŸš  ä¼ é€å¸¦ LSTM æœ€é‡è¦çš„è®¾è®¡æ˜¯è¿™ä¸ªä¼ é€å¸¦ Conveyor beltï¼Œå³ä¸ºå‘é‡ $C$ã€‚è¿‡å»çš„ä¿¡æ¯é€šè¿‡ä¼ é€å¸¦ï¼Œç›´æ¥é€åˆ°ä¸‹ä¸€ä¸ªæ—¶åˆ»ï¼Œä¸ä¼šå‘ç”Ÿå¤ªå¤§çš„å˜åŒ–ã€‚LSTM å°±æ˜¯é ä¼ é€å¸¦æ¥é¿å…æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚\nLSTM ä¸­æœ‰å¾ˆå¤šä¸ªé—¨ gateï¼Œå¯ä»¥æœ‰é€‰æ‹©çš„è®©ä¿¡æ¯é€šè¿‡ã€‚\nğŸšª Forgate Gate é¦–å…ˆä»‹ç» forget gate é—å¿˜é—¨ã€‚é—å¿˜é—¨ç”± â˜˜ï¸ sigmoid å‡½æ•°ï¼Œå’Œ ğŸ€ å…ƒç´ ç§¯ element wise multiplication ä¸¤éƒ¨åˆ†ç»„æˆã€‚\nğŸŒ¼ è¾“å…¥ sigmoid çš„æ˜¯ä¸€ä¸ªå‘é‡ $a$ï¼Œsigmoid ä½œç”¨åˆ°å‘é‡ $a$ çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼ŒæŠŠæ¯ä¸€ä¸ªå…ƒç´ éƒ½å‹åˆ° 0 å’Œ 1 ä¹‹é—´ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚å‘é‡ $a$ æ˜¯ï¼š[1, 3, 0, -2]ï¼Œé‚£ä¹ˆï¼Œsigmoid å‡½æ•°å°†åˆ†åˆ«ä½œç”¨åœ¨è¿™å››ä¸ªå…ƒç´ ä¸Šã€‚ç„¶ååˆ†åˆ«è¾“å‡ºï¼š[0.73, 0.95, 0.5, 0.12] ã€‚\nè¾“å…¥çš„å‘é‡ $a$ï¼Œä¸è¾“å‡ºçš„å‘é‡ $f$ åº”è¯¥æœ‰ç›¸åŒçš„ç»´åº¦ï¼Œè¿™ä¸ªä¾‹å­é‡Œï¼Œå‘é‡ $a$ æ˜¯å››ç»´çš„ï¼Œå‘é‡ $f$ ä¹Ÿä¼šæ˜¯å››ç»´çš„ã€‚\nğŸŒ¸ ç®—å‡º $f$ å‘é‡ä¹‹åï¼Œè®¡ç®—ä¼ é€å¸¦å‘é‡ $c$ ä¸é—å¿˜é—¨å‘é‡ $f$ çš„å…ƒç´ ç§¯ã€‚å…ƒç´ ç§¯ element wise multiplication æ˜¯è¿™æ ·ç®—çš„ï¼š\n$c$ å’Œ $f$ éƒ½æ˜¯å››ç»´çš„å‘é‡ï¼Œå°†å®ƒä»¬çš„æ¯ä¸€ä¸ªå…ƒç´ åˆ†åˆ«ç›¸ä¹˜ã€‚æ‰€ä»¥å…ƒç´ ç§¯çš„ç»“æœä¹Ÿæ˜¯ä¸ªå››ç»´çš„å‘é‡ã€‚\nè¿™ä¸ªé—å¿˜é—¨ $f$ï¼Œæœ‰é€‰æ‹©çš„è®©ä¼ é€å¸¦ $c$ çš„å€¼é€šè¿‡ï¼š\nğŸŒ° å‡å¦‚ $f$ çš„ä¸€ä¸ªå…ƒç´ æ˜¯ $0$ï¼Œé‚£ä¹ˆ $c$ å¯¹åº”çš„å…ƒç´ ä¸èƒ½é€šè¿‡ï¼Œå¯¹åº”çš„è¾“å‡ºæ˜¯ $0$ï¼›\nğŸŒ° å‡å¦‚ $f$ çš„ä¸€ä¸ªå…ƒç´ æ˜¯ $1$ï¼Œé‚£ä¹ˆ $c$ å¯¹åº”çš„å…ƒç´ å°±å…¨éƒ¨é€šè¿‡ï¼Œå¯¹åº”çš„è¾“å‡ºæ˜¯ $c$ æœ¬èº«ã€‚\né—å¿˜é—¨ $f$ å…·ä½“æ˜¯è¿™ä¹ˆç®—å‡ºæ¥çš„ï¼šé¦–å…ˆçœ‹è¿™å¼ ç»“æ„å›¾ï¼Œ$f_t$ æ˜¯ä¸Šä¸€ä¸ªçŠ¶æ€ $h_{t-1}$ï¼Œä¸å½“å‰è¾“å…¥ $x$ çš„å‡½æ•°ã€‚\næŠŠçŠ¶æ€ $h_{t-1}$ ä¸è¾“å…¥ $x_t$ åšæ‹¼æ¥ concatnationï¼Œå¾—åˆ°æ›´é«˜ç»´åº¦çš„å‘é‡ã€‚ç„¶åè®¡ç®—çŸ©é˜µ $w_f$ ä¸è¿™ä¸ªå‘é‡çš„ä¹˜ç§¯ï¼Œå¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œå†ç”¨ sigmoid å‡½æ•°ï¼Œå¾—åˆ°å‘é‡ $f_t$ï¼Œ$f_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä»‹äº 0 å’Œ 1 ä¹‹é—´ï¼Œé—å¿˜é—¨æœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µ $w_f$ï¼Œéœ€è¦é€šè¿‡ åå‘ä¼ æ’­ ä»è®­ç»ƒæ•°æ®é‡Œå­¦ä¹ ã€‚\nğŸšª Input Gate åˆšæ‰è®²äº†é—å¿˜é—¨ï¼Œç°åœ¨æ¥çœ‹ä¸€çœ‹ input gate è¾“å…¥é—¨ã€‚åœ¨è¿™å¼ ç»“æ„å›¾é‡Œï¼Œè¾“å…¥é—¨ $i_t$ï¼Œä¾èµ–äºæ—§çš„çŠ¶æ€å‘é‡ $h_{t-1}$ï¼Œå’Œæ–°çš„è¾“å…¥ $x_t$ã€‚\nè¾“å…¥é—¨ $i_t$ çš„è®¡ç®—ç±»ä¼¼äºé—å¿˜é—¨ï¼ŒæŠŠæ—§çš„çŠ¶æ€ $h_{t-1}$ï¼Œä¸æ–°çš„è¾“å…¥ $x_t$ åšæ‹¼æ¥ concatnationï¼Œå¾—åˆ°æ›´é«˜ç»´çš„å‘é‡ã€‚\nç„¶åè®¡ç®—çŸ©é˜µ $w_i$ ä¸è¿™ä¸ªå‘é‡çš„ä¹˜ç§¯å¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œæœ€åä½¿ç”¨æ¿€æ´»å‡½æ•° sigmodï¼Œå¾—åˆ°å‘é‡ $i_t$ï¼ˆ$i_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä»‹äº $0$ å’Œ $1$ ä¹‹é—´ï¼‰ã€‚\nè¾“å…¥é—¨ä¹Ÿæœ‰è‡ªå·±çš„å‚æ•°çŸ©é˜µï¼Œè®¡ä½œ $W_i$ï¼Œ$W_i$ ä¹Ÿéœ€è¦ä»è®­ç»ƒæ•°æ®ä¸­å­¦ä¹ ã€‚\nğŸ†• New Value è¿˜éœ€è¦è®¡ç®—æ–°çš„è¾“å…¥å€¼ new value $\\widetilde{c}_t$ï¼Œ$\\widetilde{c}_t$ æ˜¯ä¸ªå‘é‡ï¼Œè®¡ç®—æ–¹æ³•è·Ÿé—å¿˜é—¨å’Œè¾“å…¥é—¨éƒ½å¾ˆåƒã€‚ä¹Ÿæ˜¯æŠŠæ—§çŠ¶æ€ $h_{t-1}$ï¼Œä¸æ–°è¾“å…¥ $x_t$ åšæ‹¼æ¥ï¼Œå†ä¹˜åˆ°å‚æ•°çŸ©é˜µä¸Šã€‚\nåŒºåˆ«åœ¨äºæ¿€æ´»å‡½æ•°ä¸æ˜¯ sigmoidï¼Œè€Œæ˜¯åŒæ›²æ­£åˆ‡å‡½æ•° tanhï¼Œæ‰€ä»¥ç®—å‡ºçš„å‘é‡ $\\widetilde{c}_t$ çš„å…ƒç´ éƒ½ä»‹äº (-1, +1)ã€‚\nè®¡ç®— new value $\\widetilde{c}_t$ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªå•ç‹¬çš„å‚æ•°çŸ©é˜µçŸ©é˜µ $w_c$ã€‚\nğŸš‚ æ›´æ–° ä¼ è¾“å¸¦ æˆ‘ä»¬å·²ç»ç®—å‡ºäº†é—å¿˜é—¨ $f_t$ï¼Œè¾“å…¥é—¨ $i_t$ï¼Œä»¥åŠæ–°çš„è¾“å…¥å€¼ $\\widetilde{c}_t$ï¼Œæˆ‘ä»¬è¿˜çŸ¥é“ä¼ é€å¸¦æ—§çš„å€¼ $c_{t-1}$ï¼Œç°åœ¨å¯ä»¥æ›´æ–°ä¼ é€å¸¦ $c$ äº†ã€‚\n1ï¸âƒ£ è®¡ç®—é—å¿˜é—¨ $f_t$ å’Œä¼ é€å¸¦æ—§çš„å€¼ $c_{t-1}$ çš„å…ƒç´ ç§¯ã€‚\né—å¿˜é—¨ $f_t$ï¼Œå’Œä¼ é€å¸¦ $c_{t-1}$ æ˜¯ç»´åº¦ç›¸åŒçš„å‘é‡ï¼Œç®—å‡ºçš„ä¹˜ç§¯ä¹Ÿæ˜¯ä¸ªå‘é‡ã€‚é—å¿˜é—¨ $f_t$ï¼Œå¯ä»¥é€‰æ‹©æ€§çš„é—å¿˜ $c_{t-1}$ ä¸­çš„ä¸€äº›å…ƒç´ ï¼Œå¦‚æœ $f_t$ ä¸­çš„ä¸€ä¸ªå…ƒç´ æ˜¯ $0$ï¼Œé‚£ä¹ˆ $c_{t-1}$ ç›¸åº”çš„å…ƒç´ å°±ä¼šè¢«é—å¿˜ã€‚\nä¸Šä¸€æ­¥é€šè¿‡ ğŸšª é—å¿˜é—¨ é€‰æ‹©æ€§åˆ é™¤æ‰äº†ä¼ é€å¸¦ $c_{t-1}$ çš„ä¸€äº›å…ƒç´ ï¼Œç°åœ¨è¦å¾€ä¼ é€å¸¦ä¸Šæ·»åŠ æ–°çš„ä¿¡æ¯ã€‚\n2ï¸âƒ£ è®¡ç®—è¾“å…¥é—¨ $i_t$ï¼Œå’Œæ–°çš„è¾“å…¥å€¼ $\\widetilde{c}_t$ çš„å…ƒç´ ç§¯ã€‚\nè¾“å…¥é—¨ $i_t$ å’Œæ–°çš„å€¼ $\\widetilde{c}_t$ éƒ½æ˜¯ç»´åº¦ç›¸åŒçš„å‘é‡ï¼Œä»–ä»¬çš„ä¹˜ç§¯ä¹Ÿæ˜¯ç»´åº¦ç›¸åŒçš„å‘é‡ï¼ŒæŠŠä¹˜ç§¯åŠ åˆ°ä¼ é€å¸¦ä¸Šï¼Œè¿™æ ·å°±å®Œæˆäº†å¯¹ä¼ é€å¸¦çš„ä¸€è½®æ›´æ–°ã€‚\nç”¨é—å¿˜é—¨åˆ é™¤äº†ä¼ é€å¸¦ä¸Šçš„ä¸€äº›ä¿¡æ¯ï¼Œç„¶åç”¨é—å¿˜é—¨è¾“å…¥åŠ å…¥æ–°çš„ä¿¡æ¯ï¼Œå¾—åˆ°äº†ä¼ é€å¸¦æ–°çš„å€¼ $c_t$ï¼Œåˆ°ç°åœ¨ï¼Œå·²ç»æ›´æ–°å®Œä¼ é€å¸¦ $c$ ã€‚\nğŸšª Output Gate æœ€åä¸€æ­¥æ˜¯è®¡ç®— LSTM çš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯çŠ¶æ€å‘é‡ $h_t$ã€‚\n$h_t$ æ˜¯è¿™ä¹ˆè®¡ç®—çš„ï¼šé¦–å…ˆè®¡ç®—è¾“å‡ºé—¨ $o_t$ï¼Œè¾“å‡ºé—¨ $o_t$ è·Ÿå‰é¢çš„é—å¿˜é—¨ï¼Œè¾“å…¥é—¨çš„è®¡ç®—åŸºæœ¬ä¸€æ ·ã€‚\næŠŠæ—§çš„çŠ¶æ€ $h_{t-1}$ï¼Œä¸æ–°çš„è¾“å…¥ $x_t$ åšæ‹¼æ¥ï¼Œå¾—åˆ°æ›´é«˜ç»´çš„å‘é‡ï¼Œç„¶åç®—çŸ©é˜µ $W_o$ ä¸è¿™ä¸ªå‘é‡çš„ä¹˜ç§¯ï¼Œå¾—åˆ°ä¸€ä¸ªå‘é‡ï¼Œæœ€åä½¿ç”¨æ¿€æ´»å‡½æ•° sigmod å¾—åˆ°å‘é‡ $o_t$ã€‚$o_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä»‹äº (0, 1)ï¼Œè¾“å‡ºé—¨ä¹Ÿæœ‰è‡ªå·±çš„å‚æ•°å‘é‡ $W_o$ï¼Œ$W_o$ ä¹Ÿéœ€è¦ä»è®­ç»ƒæ•°æ®ä¸­å­¦ä¹ ã€‚\nç°åœ¨è®¡ç®—çŠ¶æ€å‘é‡ $h_t$ï¼Œå¯¹ä¼ é€å¸¦ $c_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ æ±‚åŒæ›²æ­£åˆ‡tanhï¼ŒæŠŠå…ƒç´ å…¨éƒ½å‹åˆ° (-1, +1) åŒºé—´ã€‚\nç„¶åï¼Œæ±‚è¿™ä¸¤ä¸ªå‘é‡çš„å…ƒç´ ç§¯ï¼Œè¿™ä¸ªçº¢è‰²å‘é‡æ˜¯åˆšåˆšæ±‚å‡ºçš„è¾“å‡ºé—¨ $o_t$ï¼Œè¿™æ ·å°±å¾—åˆ°äº†çŠ¶æ€å‘é‡ $h_t$ã€‚\nçœ‹ä¸€ä¸‹ç»“æ„å›¾ï¼Œ$h_t$ ä»–æœ‰ä¸¤ä»½ copysï¼Œ$h_t$ çš„ä¸€ä»½ copy ä¼ è¾“åˆ°äº†ä¸‹ä¸€æ­¥ï¼Œå¦ä¸€ä»½ copy æˆäº† LSTM çš„è¾“å‡ºã€‚\nåˆ°ç¬¬ t æ­¥ä¸ºæ­¢ï¼Œä¸€å…±æœ‰ t ä¸ªå‘é‡ $x$ è¢«è¾“å…¥äº† LSTMï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ‰€æœ‰è¿™äº› $x$ å‘é‡çš„ä¿¡æ¯ï¼Œéƒ½ç§¯ç´¯åœ¨äº†çŠ¶æ€ $h_t$ é‡Œé¢ã€‚\nğŸ§® LSTM çš„å‚æ•°æ•°é‡ æˆ‘ä»¬æ¥ç®—ä¸€ä¸‹ LSTM çš„å‚æ•°æ•°é‡ï¼ŒLSTM æœ‰ â¶ é—å¿˜é—¨ï¼›â· è¾“å…¥é—¨ï¼›â¸ æ–°çš„è¾“å…¥ï¼›â¹ è¾“å‡ºé—¨ã€‚\nè¿™å››ä¸ªæ¨¡å—éƒ½æœ‰å„è‡ªçš„å‚æ•°çŸ©é˜µ $w$ï¼Œæ‰€ä»¥ä¸€å…±æœ‰ 4 ä¸ªå‚æ•°çŸ©é˜µï¼ŒçŸ©é˜µçš„è¡Œæ•°æ˜¯ï¼š$shape(h)$ï¼Œåˆ—æ•°æ˜¯ï¼š $shape(h)+shape(x)$\næ‰€ä»¥ï¼ŒLSTM å‚æ•°çš„æ•°é‡æ˜¯ï¼š\n$4 * shape(h) * [ shape(h) + shape(x)]$\nğŸ›  å®ç° LSTM Doing\nğŸ æ€»ç»“ æ€»ç»“ä¸€ä¸‹è¿™ä¸€èŠ‚çš„å†…å®¹ï¼Œè¿™èŠ‚ä»‹ç»äº† LSTM æ¨¡å‹å’Œç”¨ PyTorch çš„å®ç°ã€‚\nLSTM å’Œ simple RNN ä¸»è¦çš„åŒºåˆ«ï¼Œæ˜¯ç”¨äº†ä¸€æ¡ä¼ é€å¸¦ï¼Œè®©è¿‡å»çš„ä¿¡æ¯å¯ä»¥å¾ˆå®¹æ˜“ä¼ è¾“åˆ°ä¸‹ä¸€æ—¶åˆ»ï¼Œè¿™æ ·å°±æœ‰äº†æ›´é•¿çš„è®°å¿†ã€‚\nLSTM çš„è¡¨ç°æ€»æ˜¯æ¯” simple RNN è¦å¥½ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æƒ³ä½¿ç”¨ RNN çš„æ—¶å€™å°±ç”¨ ğŸ™‹â€â™‚ï¸ LSTM æ¨¡å‹ï¼Œè€Œä¸è¦ç”¨ ğŸ™…â€â™‚ï¸ simple RNN æ¨¡å‹ã€‚\nLSTM æœ‰å››ä¸ªç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼š\nğŸšª Forget Gate é—å¿˜é—¨ ğŸšª Input Gate è¾“å…¥é—¨ ğŸ†• New Value æ–°çš„è¾“å…¥ ğŸšª Output Gate è¾“å‡ºé—¨ è¿™å››ä¸ªç»„ä»¶å„è‡ªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µï¼Œæ‰€ä»¥ä¸€å…±æœ‰å››ä¸ªå‚æ•°çŸ©é˜µï¼ŒLSTM å‚æ•°çš„æ•°é‡æ˜¯ï¼š\n$4 * shape(h) * [ shape(h) + shape(x)]$\nä¸‹ä¸€èŠ‚å°†ä»‹ç»ï¼š\nstacked RNN bi-directional RNN é¢„è®­ç»ƒ â›“ å‚è€ƒ ğŸ”— https://github.com/wangshusen/DeepLearning/blob/master/Slides/9_RNN_3.pdf ğŸ”— https://colah.github.io/posts/2015-08-Understanding-LSTMs/ ğŸ”— https://www.youtube.com/watch?v=vTouAvxlphc ğŸ”— https://www.bilibili.com/video/BV1UK4y1d7xa ","date":"2022-03-19T20:36:14+08:00","image":"https://nlp.letout.cn/img/nlp/banner.png","permalink":"https://emerywan.github.io/blog/p/nlp-in-action/long-short-term-memory/","title":"Long Shorter Term Memory"},{"content":"æœ¬èŠ‚ä¸»è¦å†…å®¹ä¸º æ–‡æœ¬å¤„ç† Text Processing å’Œ è¯åµŒå…¥ Word Embeddingã€‚æœ¬èŠ‚å’Œä¸‹é¢ä¸¤èŠ‚å†…å®¹éƒ½ä¼šä½¿ç”¨ IMDb ç”µå½±è¯„è®ºçš„æ•°æ®ï¼Œç”¨æ¥æ­å»ºæœºå™¨å­¦ä¹ æ¨¡å‹åˆ†æç”µå½±è¯„è®ºã€‚\nğŸŒ± IMDb IMDb æ˜¯æœ€æœ‰åçš„ç”µå½±è¯„è®ºç½‘ç«™ï¼Œç”¨æˆ·å¯ä»¥åœ¨ IMDb ä¸Šç»™ç”µå½±æ‰“åˆ†ï¼Œ1 åˆ†æ˜¯éå¸¸è®¨åŒï¼Œ10 åˆ†æ˜¯éå¸¸å–œæ¬¢ï¼Œå¦‚æœä¹æ„ï¼Œè¿˜å¯ä»¥å†™ä¸€æ®µç”µå½±è¯„è®ºã€‚\nå¦‚æœä¸ç»™ä½ çœ‹åˆ†æ•°ï¼Œåªç»™ä½ çœ‹è¯„è®ºï¼Œä½ å¤§æ¦‚èƒ½çŒœåˆ°ç”¨æˆ·æ‰“çš„åˆ†æ•°ï¼Œä½†ä½ çš„çŒœæµ‹å¯èƒ½ä¸å¤ªå‡†ç¡®ã€‚å¦‚æœæ¢ç§æ–¹å¼ï¼Œè®©ä½ åˆ¤æ–­ç”µå½±è¯„è®ºæ˜¯ æ­£é¢ positive çš„è¿˜æ˜¯ è´Ÿé¢ negative çš„ï¼Œä½ åº”è¯¥ä¼šæœ‰å¾ˆé«˜çš„å‡†ç¡®ç‡ã€‚æœ‰äººä» IMDb ä¸Šçˆ¬äº† 5 ä¸‡æ¡ç”µå½±è¯„è®ºï¼Œè¿™äº›è¯„è®ºéƒ½æ˜¯å¾ˆæç«¯çš„ï¼Œéƒ½æ˜¯å¼ºçƒˆçš„å–œæ¬¢ï¼Œæˆ–è€…å¼ºçƒˆåæ„Ÿã€‚è¿™ä¸ªäºŒåˆ†ç±»é—®é¢˜å¯¹äºäººæ¥è¯´å¾ˆç®€å•ï¼Œäººè¯»ä¸€ä¸‹ç”µå½±è¯„è®ºå°±èƒ½è½»æ˜“çŸ¥é“è¿™æ˜¯æ­£é¢è¯„ä»·è¿˜æ˜¯è´Ÿé¢è¯„ä»·ï¼Œäººåº”è¯¥èƒ½æœ‰ 100% çš„å‡†ç¡®ç‡ï¼Œè¿™ä¸ªæ•°æ®é›†è¢«åˆ†æˆä¸¤åŠï¼Œ2 ä¸‡ 5 åƒæ¡ä½œä¸ºè®­ç»ƒæ•°æ® Trainï¼Œå¦å¤– 2 ä¸‡ 5 åƒæ¡ä½œä¸ºæµ‹è¯•æ•°æ® Testã€‚\nä½ å¯ä»¥åœ¨ä¸‹é¢çš„é“¾æ¥ä¸­è·å–åˆ°æ•°æ®é›†ï¼šhttps://ai.stanford.edu/~amaas/data/sentiment/\nğŸ”– æ–‡æœ¬å¤„ç†æ–‡æœ¬å¤„ç† åœ¨è¯åµŒå…¥ Word Embedding å’Œæ­å»ºæœºå™¨å­¦ä¹ æ¨¡å‹ä¹‹å‰ï¼Œé¦–å…ˆè¦è¿›è¡Œæ–‡æœ¬å¤„ç†ï¼Œå°†æ–‡æœ¬å˜æˆåºåˆ— Sequenceï¼Œæ–‡æœ¬å¤„ç†å¾ˆæ— èŠï¼Œä½†æˆ‘ä»¬åº”è¯¥é‡è§†å®ƒï¼Œæ–‡æœ¬å¤„ç†çš„å¥½åï¼Œä¼šç›´æ¥å½±å“æœºå™¨å­¦ä¹ æ¨¡å‹çš„å‡†ç¡®ç‡ã€‚\nğŸš€ Tokenization æ–‡æœ¬å¤„ç†çš„ç¬¬ä¸€æ­¥æ˜¯ Tokenizationï¼ŒæŠŠæ–‡æœ¬åˆ†å‰²æˆå¾ˆå¤š tokensï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠæ–‡æœ¬åˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œä¸€ä¸ª token å°±æ˜¯ä¸€ä¸ªå•è¯ï¼ˆå‡å¦‚ä½ æŠŠæ–‡æœ¬åˆ†å‰²æˆå­—ç¬¦ï¼Œé‚£ä¹ˆä¸€ä¸ª token å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼‰ï¼Œåšå®Œ Tokenizationï¼Œä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²å°±è¢«åˆ†å‰²æˆä¸€ä¸ªå¾ˆå¤šå•è¯çš„åˆ—è¡¨ã€‚\nTokenization çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯è®²ç©¶å¾ˆå¤šã€‚æ¯”å¦‚ï¼š\nğŸŒ° æ˜¯å¦åº”è¯¥æŠŠå¤§å†™å˜æˆå°å†™ï¼Ÿ é€šå¸¸æƒ…å†µä¸‹åº”è¯¥æŠŠå¤§å†™å˜æˆå°å†™ï¼Œå¤§å°å†™å•è¯é€šå¸¸æ˜¯ä¸€ä¸ªæ„æ€ï¼›ä½†æœ‰æ—¶å€™ä¼šæ··æ·†å•è¯ï¼ˆApple -\u0026gt; appleï¼‰ï¼Œæ¯”å¦‚ Apple æ˜¯è‹¹æœå…¬å¸ï¼Œapple æ˜¯æ°´æœï¼Œå¤§å°å†™çš„ apple å¹¶ä¸æ˜¯ç›¸åŒçš„å•è¯ã€‚\nğŸŒ° å»é™¤åœç”¨è¯ã€‚stop word æœ‰äº›åº”ç”¨ä¼šå»é™¤ stop wordï¼Œå®ƒæ˜¯ theã€aã€of ç­‰æœ€é«˜é¢‘çš„å•è¯ï¼Œè¿™äº›è¯å‡ ä¹å‡ºç°åœ¨æ‰€æœ‰çš„å¥å­é‡Œï¼Œå¯¹è¿™ä¸ªäºŒåˆ†ç±»é—®é¢˜å‡ ä¹æ˜¯æ²¡æœ‰å¸®åŠ©ã€‚\nğŸŒ° æ‹¼å†™çº é”™ã€‚ ç”¨æˆ·å‘ç”µå½±è¯„è®ºçš„æ—¶å€™ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹å¹¶ä¸ä¼šä»”ç»†æ£€æŸ¥ï¼Œæ‰€ä»¥å†™çš„ä¸œè¥¿éš¾å…ä¼šæœ‰æ‹¼å†™é”™è¯¯ï¼Œæ‰€ä»¥åšæ‹¼å†™çº é”™é€šå¸¸æ˜¯æœ‰ç”¨çš„ã€‚\nè¿™é‡Œåªæ˜¯ä¸¾äº†å‡ ä¸ªä¾‹å­ï¼Œå®é™…ä¸Šåš Tokenization çš„æ—¶å€™éœ€è¦åšå¤§é‡çš„å·¥ä½œï¼ŒTokenization çœ‹ä¼¼ç®€å•ï¼Œä½†å®é™…ä¸Šå¹¶ä¸å®¹æ˜“ã€‚\nğŸ§° Build Dictionary ç¬¬äºŒæ­¥æ˜¯å»ºç«‹ä¸€ä¸ªå­—å…¸ã€‚å¯ä»¥å…ˆç»Ÿè®¡è¯é¢‘ï¼Œå»æ‰ä¸€äº›ä½é¢‘è¯ï¼Œè®©åè®©æ¯ä¸ªå•è¯å¯¹åº”ä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ¯”å¦‚è®© the -\u0026gt; 1; cat -\u0026gt; 2; sat -\u0026gt; 3ã€‚æœ‰äº†è¿™ä¸ªå­—å…¸ï¼Œå°±å¯ä»¥æŠŠæ¯ä¸ªå•è¯å¯¹åº”åˆ°ä¸€ä¸ªæ•´æ•°ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸€å¥è¯å°±å¯ä»¥ç”¨æ­£æ•´æ•°çš„åˆ—è¡¨è¡¨ç¤ºï¼Œè¿™ä¸ªåˆ—è¡¨è¢«ç§°ä¸ºåºåˆ— Sequencesã€‚\nå¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œè¿˜å¾—è¿›ä¸€æ­¥åš one-hot encodingï¼ŒæŠŠå•è¯è¡¨ç¤ºæˆ one-hot å‘é‡ã€‚\nåœ¨ç”µå½±è¯„è®ºçš„ä¾‹å­é‡Œï¼Œæ•°æ®æ˜¯ 5 ä¸‡æ¡ç”µå½±è¯„è®ºï¼Œæ¯æ¡ç”µå½±è¯„è®ºå¯ä»¥è¡¨ç¤ºæˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åšå®Œ Tokenization å’Œ Encoding åï¼Œæ¯æ¡ç”µå½±è¯„è®ºéƒ½ä¼šè½¬æ¢æˆä¸€ä¸ª Sequencesï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ­£æ•´æ•°çš„åˆ—è¡¨ã€‚\nç”µå½±è¯„è®ºæœ‰é•¿æœ‰çŸ­ï¼Œæœ‰äººåªèƒ½å†™å‡ ä¸ªå­—çš„è¯„è®ºï¼Œæœ‰äººèƒ½æ´‹æ´‹æ´’æ´’å†™å‡ åƒå­—ï¼Œæ‰€ä»¥å¾—åˆ°çš„è¿™äº› Sequences çš„é•¿åº¦ä¹Ÿå„ä¸ç›¸åŒã€‚æ¯”å¦‚è¿™ä¸¤æ¡ Sequences çš„é•¿åº¦åˆ†åˆ«æ˜¯ 52 å’Œ 90ã€‚\nè¿™å°±é€ æˆäº†ä¸€ä¸ªé—®é¢˜ï¼Œè®­ç»ƒæ•°æ®æ²¡æœ‰å¯¹é½ï¼Œæ¯æ¡ Sequences éƒ½æœ‰ä¸åŒçš„é•¿åº¦ã€‚åšæœºå™¨å­¦ä¹ çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®å­˜å‚¨åˆ°çŸ©é˜µæˆ–è€…å¼ é‡é‡Œï¼Œæ¯æ¡åºåˆ—éƒ½å¾—æœ‰ç›¸åŒçš„é•¿åº¦ï¼Œéœ€è¦æŠŠåºåˆ—å¯¹é½ã€‚\nè§£å†³æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬å¯ä»¥å›ºå®šé•¿åº¦ä¸º $w$ã€‚å‡å¦‚ä¸€ä¸ªåºåˆ—é•¿åº¦å¤ªé•¿ï¼Œè¶…è¿‡äº† $w$ ä¸ªè¯ï¼Œå°±ç æ‰å‰é¢çš„è¯ï¼Œåªä¿ç•™æœ€åé¢ $w$ä¸ªè¯ï¼ˆå½“ç„¶ä¿ç•™æœ€å‰é¢ $w$ ä¸ªè¯ä¹ŸåŒæ ·å¯ä»¥ï¼‰ï¼›å‡å¦‚ä¸€ä¸ªåºåˆ—å¤ªçŸ­ï¼Œä¸åˆ° $w$ ä¸ªè¯ï¼Œé‚£ä¹ˆå°±åš zero padding ç”¨ 0 æ¥è¡¥é½ï¼ŒæŠŠé•¿åº¦å¢åŠ åˆ° $w$ã€‚\nè¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰åºåˆ—çš„é•¿åº¦éƒ½æ˜¯ $w$ï¼Œå¯ä»¥å­˜å‚¨åˆ°ä¸€ä¸ªçŸ©é˜µé‡Œã€‚\nğŸ€ï¸ è¯åµŒå…¥ æ–‡æœ¬å¤„ç†å·²ç»å®Œæˆäº†ï¼Œç°åœ¨æ¯ä¸ªè¯éƒ½ç”¨ä¸€ä¸ªæ­£æ•´æ•°æ¥è¡¨ç¤ºï¼Œä¸‹ä¸€æ­¥æ˜¯ Word Embeddingï¼ŒæŠŠæ¯ä¸ªè¯éƒ½è¡¨ç¤ºä¸ºä¸€ä¸ªä¸€ç»´å‘é‡ã€‚\nç°åœ¨æ¯ä¸ªå•è¯éƒ½ç”¨ä¸€ä¸ªæ•°å­—æ¥è¡¨ç¤ºï¼Œè¯¥æ€ä¹ˆæŠŠè¿™äº› Categorical ç‰¹å¾è¡¨ç¤ºä¸ºæ•°å€¼å‘é‡å‘¢ï¼Ÿ\næ˜¾ç„¶å¯ä»¥åš one-hot encodingï¼Œç”¨ä¸€ä¸ª one-hot å‘é‡æ¥è¡¨ç¤ºä¸€ä¸ªå•è¯ã€‚ æ¯”å¦‚ good: index = 2ï¼Œäºæ˜¯ä½¿ç”¨æ ‡å‡†æ­£äº¤ç§¯ $e_2$ æ¥è¡¨ç¤ºï¼Œå®ƒçš„ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ï¼Œ$e_2=[0, 1, 0, 0, \u0026hellip;, 0]$\nå‡å¦‚ vocabulary = vï¼Œä¹Ÿå°±æ˜¯è¯´å­—å…¸é‡Œä¸€å…±æœ‰ $v$ ä¸ªå•è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦ç»´åº¦ dimension = v çš„ one-hot å‘é‡ï¼Œè¦æ˜¯å­—å…¸é‡Œæœ‰ 1 ä¸‡ä¸ªå•è¯ï¼Œé‚£ä¹ˆè¿™äº› one-hot å‘é‡éƒ½æ˜¯ 1 ä¸‡ç»´çš„ï¼Œè¿™æ ·çš„å‘é‡ç»´åº¦æ˜¯åœ¨å¤ªé«˜äº†ã€‚ä¸‹ä¸€èŠ‚ä»‹ç» RNN çš„æ—¶å€™ä½ ä¼šçœ‹åˆ°ï¼ŒRNN çš„å‚æ•°æ•°é‡æ­£æ¯”äºè¾“å…¥å‘é‡çš„ç»´åº¦ï¼Œæˆ‘ä»¬è‚¯å®šä¸æƒ³è®©è¾“å…¥çš„å‘é‡æ˜¯ 1 ä¸‡ç»´çš„ï¼Œå¦åˆ™ä¸€å±‚ RNN å°†ä¼šæœ‰å¥½å‡ åä¸‡ä¸ªå‚æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åš Word Embeddingï¼ŒæŠŠè¿™äº›é«˜ç»´ one-hot å‘é‡æ˜ å°„åˆ°ä½ç»´å‘é‡ã€‚\nå…·ä½“åšæ³•æ˜¯å§ one-hot å‘é‡ $e_i$ ä¹˜åˆ°å‚æ•°çŸ©é˜µ $P^T$ ä¸Šï¼ŒçŸ©é˜µ $P^T$ çš„å¤§å°æ˜¯ $d*v$ã€‚å…¶ä¸­ $d$ æ˜¯è¯å‘é‡çš„ç»´åº¦ï¼Œç”±ç”¨æˆ·è‡ªå·±å†³å®šï¼›$v$ æ˜¯ vocabularyï¼Œè¡¨ç¤ºå­—å…¸é‡Œå•è¯çš„æ•°é‡ã€‚\nçŸ©é˜µçš„ä¹˜æ³•çš„ç»“æœè®°åšå‘é‡ $x_i$ï¼Œ$x_i$ å°±æ˜¯ä¸€ä¸ªè¯å‘é‡ï¼Œç»´åº¦æ˜¯ $d*1$ï¼Œå¦‚æœ one-hot å‘é‡ $e$ çš„ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯ 1ï¼Œé‚£ä¹ˆ $x_i$ å°±æ˜¯ $P^T$ çŸ©é˜µçš„ç¬¬ä¸‰åˆ—ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ$P^T$ çŸ©é˜µæ¯ä¸€åˆ—éƒ½æ˜¯ä¸€ä¸ªè¯å‘é‡ã€‚\nåŒç†ï¼Œä¸‹é¢è¿™ä¸ªå‚æ•°çŸ©é˜µ $P$ çš„æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªè¯å‘é‡ã€‚è¿™ä¸ªçŸ©é˜µçš„è¡Œæ•°æ˜¯ $v$ï¼Œä¹Ÿå°±æ˜¯ vocabularyï¼›æ¯ä¸€è¡Œå¯¹åº”ä¸€ä¸ªå•è¯ï¼ŒçŸ©é˜µçš„åˆ—æ•°æ˜¯ $d$ï¼Œ$d$ æ˜¯ç”¨æˆ·å†³å®šçš„ï¼Œ$d$ çš„å¤§å°ä¼šå½±å“æœºå™¨å­¦ä¹ æ¨¡å‹çš„è¡¨ç°ï¼Œåº”è¯¥ç”¨ äº¤å‰éªŒè¯ Cross Validation ç”¨æ¥é€‰æ‹©ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ $d$ã€‚\nå­—å…¸é‡Œçš„ç¬¬ä¸€ä¸ªè¯çš„æ˜¯ movieï¼Œé‚£ä¹ˆç¬¬ä¸€è¡Œå°±æ˜¯ movie çš„è¯å‘é‡ï¼›å­—å…¸é‡Œçš„ç¬¬äºŒä¸ªè¯æ˜¯ goodï¼Œé‚£ä¹ˆç¬¬äºŒè¡Œå°±æ˜¯ good çš„è¯å‘é‡ã€‚\næˆ‘ä»¬çš„ä»»åŠ¡æ˜¯åˆ¤æ–­ç”µå½±è¯„è®ºæ˜¯æ­£é¢çš„è¿˜æ˜¯è´Ÿé¢çš„ï¼Œè¿™ä¸ªå‚æ•°çŸ©é˜µæ˜¯ä»è®­ç»ƒæ•°æ®ä¸­å­¦ä¹ å‡ºæ¥çš„ï¼Œæ‰€ä»¥è¿™äº›è¯å‘é‡éƒ½å¸¦æœ‰æ„Ÿæƒ…è‰²å½©ï¼Œå‡å¦‚è¿™äº›è¯å‘é‡éƒ½æ˜¯äºŒç»´çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å¹³é¢åæ ‡ç³»ä¸­æ ‡å‡ºè¿™äº›è¯å‘é‡ã€‚\nfantastic; good; fun è¿™äº›è¯å‘é‡éƒ½å¸¦æœ‰æ­£é¢æƒ…æ„Ÿï¼Œæ‰€ä»¥è¿™ä¸‰ä¸ªè¯çš„è¯å‘é‡å­¦å‡ºæ¥éƒ½æ¯”è¾ƒæ¥è¿‘ï¼›åŒç†ï¼Œpoor; boring; mediocre è¿™äº›è¯å¸¦æœ‰è´Ÿé¢æƒ…æ„Ÿï¼Œæ‰€ä»¥å­¦å‡ºæ¥çš„è¯åŒæ ·ä¹Ÿåº”è¯¥æ¯”è¾ƒæ¥è¿‘ï¼Œä½†æ˜¯è¿™äº›è¯çš„è¯å‘é‡åº”è¯¥è¿œç¦»æ­£é¢è‰²å½©çš„è¯å‘é‡ã€‚åƒ movie; is è¿™æ ·çš„ä¸­æ€§è¯ï¼Œæ²¡æœ‰æ„Ÿæƒ…è‰²å½©ï¼Œå®ƒä»¬åº”è¯¥åœ¨ä¸­é—´ã€‚\nğŸ æ€»ç»“ æœ€åæ€»ç»“ä¸€ä¸‹è¿™ä¸€ç« çš„å†…å®¹ã€‚\nè¿™ä¸€èŠ‚ä¸ŠåŠéƒ¨åˆ†ï¼Œè¯´æ˜äº†æ–‡æœ¬å¤„ç†æ˜¯ä»€ä¹ˆæ ·çš„ã€‚ç»™æˆ‘ä»¬ä¸€æ¡ç”µå½±è¯„è®ºï¼Œé¦–å…ˆåš Tokenizationï¼ŒæŠŠç”µå½±è¯„è®ºåˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œç„¶åæŠŠå¾ˆå¤šå•è¯ç¼–ç æˆæ•°å­—ï¼Œè¿™æ ·ä¸€æ•´æ¡ç”µå½±è¯„è®ºå°±å¯ä»¥å¾ˆå¤šæ­£æ•´æ•°æ¥è¡¨ç¤ºï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ­£æ•´æ•°åºåˆ—å«åš Sequencesï¼Œå°±æ˜¯ç¥ç»ç½‘ç»œä¸­ Embedding å±‚çš„è¾“å…¥ã€‚ç”±äºç”µå½±è¯„è®ºçš„é•¿çŸ­ä¸ä¸€ï¼Œå¾—åˆ°çš„ Sequence çš„é•¿çŸ­ä¹Ÿä¸ä¸€æ ·ï¼Œæ²¡åŠæ³•å­˜å‚¨åœ¨ä¸€ä¸ªçŸ©é˜µé‡Œï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ Alignment å¯¹é½ã€‚å‡è®¾æœ€å¤§é•¿åº¦ä¸º 20ï¼Œå¦‚æœé•¿åº¦å¤§äº20ï¼Œå°±åªä¿ç•™æœ€å 20 ä¸ªå•è¯ï¼›å¦‚æœé•¿åº¦ä¸åˆ° 20ï¼Œå°±ç”¨ 0 è¡¥é½ï¼ŒæŠŠé•¿åº¦å¢åŠ åˆ° 20ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ª Sequences é•¿åº¦éƒ½ç›¸åŒã€‚\n","date":"2022-03-11T21:14:45+08:00","image":"https://nlp.letout.cn/img/nlp/banner.png","permalink":"https://emerywan.github.io/blog/p/nlp-in-action/text-processing-and-word-embedding/","title":"æ–‡æœ¬å¤„ç†ä¸è¯åµŒå…¥"},{"content":"è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥å­¦ä¹ å¾ªç¯ç¥ç»ç½‘ç»œRecurrent Neural Networksã€‚æœ¬èŠ‚çš„å†…å®¹æ˜¯ Simple RNNï¼Œä»¥åŠç”¨ Pytorch ç¼–ç¨‹å®ç° Simple RNNã€‚\nğŸŒ± ç®€ä»‹ ç°åœ¨ RNN æ²¡æœ‰ä»¥å‰æµè¡Œï¼Œå°¤å…¶æ˜¯åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸Šï¼ŒRNN å·²ç»æœ‰ä¸€äº›è¿‡æ—¶äº†ï¼Œå¦‚æœè®­ç»ƒçš„æ•°æ®è¶³å¤Ÿå¤šï¼ŒRNN çš„æ•ˆæœä¸å¦‚ Transformer æ¨¡å‹ï¼Œä½†æ˜¯åœ¨å°è§„æ¨¡çš„é—®é¢˜ä¸Šï¼ŒRNN è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚\nğŸ”– å¦‚ä½•å»ºæ¨¡æ—¶åºæ•°æ®ï¼Ÿ æœºå™¨å­¦ä¹ ä¸­ç»å¸¸ç”¨åˆ°æ–‡æœ¬ã€è¯­éŸ³ç­‰ æ—¶åºæ•°æ®sequential dataï¼ˆæŒ‰æ—¶é—´é¡ºåºè®°å½•çš„æ•°æ®åˆ—ï¼Œæœ‰é•¿åº¦ä¸å›ºå®šçš„ç‰¹ç‚¹ï¼‰ã€‚\né¦–å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæ€ä¹ˆå¯¹è¿™æ ·çš„æ—¶åºæ•°æ®è¿›è¡Œå»ºæ¨¡ï¼Ÿ åœ¨ä¸Šä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€æ®µæ–‡å­—æ•´ä½“è¾“å…¥åˆ°ä¸€ä¸ªé€»è¾‘å›å½’ Logistic Regression æ¨¡å‹ä¸­ï¼Œè®©æ¨¡å‹æ¥åšäºŒåˆ†ç±»ï¼Œè¿™å±äºä¸€ä¸ª one-to-one æ¨¡å‹ï¼Œä¸€ä¸ªè¾“å…¥å¯¹åº”ä¸€ä¸ªè¾“å‡ºã€‚\nå…¨è¿æ¥ç¥ç»ç½‘ç»œå’Œå·ç§¯ç¥ç»ç½‘ç»œéƒ½å±äº one-to-one æ¨¡å‹ã€‚\näººè„‘å¹¶ä¸ä¼šä½¿ç”¨ one-to-one æ¨¡å‹å¤„ç†æ—¶åºæ•°æ®ï¼Œä¸ä¼šæŠŠä¸€æ•´æ®µæ–‡å­—å…¨éƒ¨è¾“å…¥åˆ°å¤§è„‘ï¼Œæˆ‘ä»¬åœ¨é˜…è¯»çš„æ—¶å€™ï¼Œä¼šä»å·¦åˆ°å³é˜…è¯»ä¸€æ®µæ–‡å­—ï¼Œä¸æ–­åœ°åœ¨å¤§è„‘é‡Œç§¯ç´¯ä¿¡æ¯ï¼Œé˜…è¯»ä¸€æ®µè¯ä¹‹åï¼Œä½ è„‘å­é‡Œå°±ç§¯ç´¯äº†ä¸€æ®µæ–‡å­—çš„å¤§æ„ã€‚\none-to-one æ¨¡å‹è¦æ±‚ä¸€ä¸ªè¾“å…¥å¯¹åº”ä¸€ä¸ªè¾“å‡ºï¼Œæ¯”å¦‚ï¼šè¾“å…¥ä¸€å¼ å›¾ç‰‡ï¼Œè¾“å‡ºæ¯ä¸€ç±»çš„æ¦‚ç‡å€¼ï¼Œone-to-one çš„æ¨¡å‹æ¯”è¾ƒé€‚åˆè¿™ç±»å›¾ç‰‡é—®é¢˜ï¼Œä½†æ˜¯ä¸å¤ªé€‚åˆæ–‡æœ¬é—®é¢˜ã€‚\nå¯¹äºæ–‡æœ¬é—®é¢˜ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„é•¿åº¦å¹¶ä¸å›ºå®šï¼Œä¸€æ®µè¯å¯é•¿å¯çŸ­ï¼Œæ‰€ä»¥è¾“å…¥çš„é•¿åº¦å¹¶ä¸å›ºå®šï¼›è¾“å‡ºçš„é•¿åº¦ä¹Ÿä¸å›ºå®šï¼Œæ¯”å¦‚å°†è‹±è¯­ç¿»è¯‘æˆæ±‰è¯­ï¼Œä¸€å¥è‹±è¯­æœ‰åä¸ªå•è¯ï¼Œç¿»è¯‘æˆæ±‰è¯­å¯èƒ½æœ‰åä¸ªå­—ï¼Œå¯èƒ½æœ‰å…«ä¸ªå­—ï¼Œä¹Ÿå¯èƒ½æ˜¯å››ä¸ªå­—çš„æˆè¯­ï¼Œè¾“å‡ºæ±‰è¯­çš„å­—æ•°å¹¶ä¸å›ºå®šï¼Œç”±äºè¾“å…¥å’Œè¾“å‡ºçš„é•¿åº¦ä¸å›ºå®šï¼Œone-to-one æ¨¡å‹å°±ä¸å¤ªé€‚åˆäº†ã€‚\nå¯¹äºæ—¶åºæ•°æ®ï¼Œæ›´å¥½çš„æ˜¯ many-to-one æˆ–è€…æ˜¯ many-to-many æ¨¡å‹ï¼ŒRNN å°±æ˜¯è¿™æ ·çš„æ¨¡å‹ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„é•¿åº¦éƒ½ä¸å›ºå®šã€‚æ‰€ä»¥ RNN å¾ˆé€‚åˆè¯­éŸ³ï¼Œæ–‡æœ¬ç­‰æ—¶åºåºåˆ—æ•°æ®ã€‚\nğŸ€ï¸ RNN RNN å’Œè·Ÿäººçš„é˜…è¯»ä¹ æƒ¯å¾ˆç±»ä¼¼ï¼šäººæ¯æ¬¡çœ‹ä¸€ä¸ªè¯ï¼Œä¼šé€æ¸åœ¨å¤§è„‘é‡Œç§¯ç´¯ä¿¡æ¯ï¼›RNN æ¯çœ‹ä¸€ä¸ªè¯ï¼Œä¼šç”¨çŠ¶æ€å‘é‡ $h$ æ¥ç§¯ç´¯é˜…è¯»è¿‡çš„ä¿¡æ¯ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬å°†è¾“å…¥çš„æ¯ä¸ªè¯ç”¨ è¯åµŒå…¥word embedding å˜æˆä¸€ä¸ªè¯å‘é‡ $x$ã€‚\næ¯æ¬¡æŠŠä¸€ä¸ªè¯å‘é‡è¾“å…¥ RNNï¼Œå°±ä¼šæ›´æ–°çŠ¶æ€ $h$ ï¼ŒæŠŠæ–°çš„è¾“å…¥ç§¯ç´¯åˆ°çŠ¶æ€ $h$ é‡Œé¢ã€‚\nåœ¨ $h_0$ä¸­ï¼ŒåŒ…å«äº†ç¬¬ä¸€ä¸ªè¯ the çš„ä¿¡æ¯ï¼Œåœ¨ $h_1$ é‡Œé¢ï¼ŒåŒ…å«äº†å‰ä¸¤ä¸ª the cat çš„ä¿¡æ¯ï¼›ä»¥æ­¤ç±»æ¨ï¼ŒçŠ¶æ€ $h_2$ åŒ…å« äº†å‰ä¸‰ä¸ªè¯ the cat sat çš„ä¿¡æ¯ï¼Œæœ€åä¸€ä¸ªçŠ¶æ€ $h_t$ åŒ…å«äº†æ•´å¥è¯çš„ä¿¡æ¯ï¼Œå¯ä»¥æŠŠ $h_t$ çœ‹åš RNN ä»æ•´å¥è¯ the cat sat on the mat æŠ½å–çš„ç‰¹å¾å‘é‡ï¼Œåœ¨æ›´æ–°çŠ¶æ€ $h$ çš„æ—¶å€™ï¼Œéœ€è¦ç”¨åˆ°å‚æ•°çŸ©é˜µ $A$ã€‚\næ³¨æ„ï¼šæ•´ä¸ª RNN åªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µ $A$ã€‚æ— è®ºè¿™æ¡é“¾æœ‰å¤šé•¿ï¼Œå‚æ•° $A$ åªæœ‰ä¸€ä¸ªï¼Œ$A$ éšæœºåˆå§‹åŒ–ï¼Œç„¶ååˆ©ç”¨è®­ç»ƒæ•°æ®æ¥å­¦ä¹  $A$ã€‚ä¸‹é¢é¦–å…ˆè®²è§£ Simple RNN Modelã€‚\nğŸš€ Simple RNN æˆ‘ä»¬å…·ä½“çœ‹çœ‹ï¼ŒSimple RNN ç®€å•å¾ªç¯ç¥ç»ç½‘ç»œæ˜¯æ€ä¹ˆæŠŠè¾“å…¥çš„è¯å‘é‡ $x$ï¼Œç»“åˆåˆ°çŠ¶æ€ $h$ ä¸­çš„ã€‚\næˆ‘ä»¬å°†ä¸Šä¸€ä¸ªçŠ¶æ€è®°åš $h_t-1$ï¼Œæ–°è¾“å…¥è¯å‘é‡è®°åš $x_t$ï¼Œå°†è¿™ä¸¤ä¸ªå‘é‡åšæ‹¼æ¥ concatenationï¼Œå¾—åˆ°ä¸€ä¸ªæ›´é«˜ç»´çš„å‘é‡ã€‚\nå›¾ä¸­è¿™ä¸ªçŸ©é˜µ $A$ æ˜¯ RNN çš„æ¨¡å‹å‚æ•°ï¼Œè¿™é‡Œè®¡ç®—çŸ©é˜µ $A$ å’Œè¿™ä¸ªå‘é‡çš„ä¹˜ç§¯ï¼ˆæ‹¼æ¥åçš„å‘é‡ï¼‰ï¼ŒçŸ©é˜µå’Œå‘é‡çš„ä¹˜ç§¯æ˜¯ä¸€ä¸ªå‘é‡ï¼Œç„¶åä½¿ç”¨æ¿€æ´»å‡½æ•° tanh ä½œç”¨åœ¨å‘é‡çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œæœ€åæŠŠæ¿€æ´»å‡½æ•°çš„è¾“å‡ºè®°åšæ–°çš„çŠ¶æ€ $h_t$ã€‚\nè¿™ä¸ªæ¿€æ´»å‡½æ•°å¼ åŒæ›²æ­£åˆ‡å‡½æ•° hyperbolic tangent functionï¼Œè¾“å…¥æ˜¯ä»»æ„å®æ•°ï¼Œè¾“å‡ºåœ¨ $(-1, +1)$ ä¹‹é—´ã€‚ç”±äºç”¨äº†åŒæ›²æ­£åˆ‡æ¿€æ´»å‡½æ•°ï¼Œå‘é‡ $h_t$ çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½åœ¨ $(-1, +1)$ ä¹‹é—´ã€‚\nè¿™ä¸ªç¥ç»ç½‘ç»œçš„ç»“æ„å›¾å¯ä»¥è¿™æ ·ç†è§£ï¼šæ–°çš„çŠ¶æ€ $h_t$ï¼Œæ˜¯æ—§çŠ¶æ€ $h_{t-1}$ å’Œæ–°çš„è¾“å…¥ $x_t$ çš„å‡½æ•°ï¼Œç¥ç»ç½‘ç»œæ¨¡å‹çš„å‚æ•°æ˜¯ $A$ï¼šæ–°çš„çŠ¶æ€ $h_t$ï¼Œä¾èµ–äºå‘é‡ $h_{t-1}$, å‘é‡ $x_t$ ä»¥åŠçŸ©é˜µ $A$ã€‚\nğŸ¨ ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ tanh ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Ÿ æˆ‘ä»¬æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ tanh ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Ÿèƒ½å¦å°†è¿™ä¸ªæ¿€æ´»å‡½æ•°å»æ‰ï¼Œå»æ‰ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ\né¦–å…ˆæˆ‘ä»¬åšä¸ªç®€åŒ–ï¼Œå‡è®¾è¾“å…¥çš„è¯å‘é‡çš„å…ƒç´ éƒ½æ˜¯ $0$ã€‚å¦‚å›¾ï¼Œè¿™ç­‰åŒäºè¾“å…¥çš„è¯å‘é‡ $x_t$ éƒ½å»æ‰ï¼ŒæŠŠçŸ©é˜µ $A$ å³è¾¹ä¸€åŠä¹Ÿå»æ‰ã€‚\n$x_0 = x_1 = \u0026hellip; = x_{100} = 0$\nè¿™ä¹ˆä¸€æ¥ï¼Œç¬¬ 100 ç»´çš„ç‰¹å¾å‘é‡ $h_{100} = Ah_{99} = A^2h_{98} = \u0026hellip; = A^{100}h_0$ã€‚\nğŸŒ° å‡è®¾çŸ©é˜µ $A$ æœ€å¤§çš„ç‰¹å¾å€¼ç•¥å°äº 1 æ¯”å¦‚ï¼Œæœ€å¤§çš„ç‰¹å¾å€¼ç­‰äº 0.9ã€‚é‚£ä¹ˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ\n$0.9^{100}$ éå¸¸æ¥è¿‘äº 0 äº†ï¼Œæ‰€ä»¥çŸ©é˜µ $A^{100}$ éå¸¸æ¥è¿‘äº 0ï¼Œé‚£ä¹ˆæ–°çš„ç‰¹å¾å‘é‡ $h_{100}$ ä¹Ÿå‡ ä¹ä¹Ÿæ˜¯ä¸€ä¸ªå…¨é›¶çš„å‘é‡ã€‚\nğŸŒ° å‡è®¾çŸ©é˜µ $A$ æœ€å¤§çš„ç‰¹å¾å€¼ç•¥å¤§äº 1 æ¯”å¦‚ï¼Œæœ€å¤§çš„ç‰¹å¾å€¼ç­‰äº 1.2ã€‚\n$1.2^{100}=82817974.522$ï¼Œæ‰€ä»¥çŸ©é˜µ $A^{100}$ çš„å…ƒç´ éƒ½è¶…çº§å¤§ï¼Œ$A^{100}$çš„æ¯ä¸ªå…ƒç´ éƒ½å¾ˆå¤§ï¼Œå‡å¦‚å¾ªç¯çš„æ¬¡æ•°æ›´å¤šä¸€äº›ï¼Œæˆ–è€… $A$ çš„ç‰¹å¾å€¼å†å¤§ä¸€äº›ï¼ŒçŠ¶æ€å‘é‡çš„å€¼å°±ä¼šçˆ†ç‚¸ã€‚\nå‡å¦‚æ²¡æœ‰è¿™ä¸ªæ¿€æ´»å‡½æ•° tanhï¼Œæ•°å€¼è®¡ç®—çš„æ—¶å€™å¾ˆæœ‰å¯èƒ½ä¼šå‡ºé—®é¢˜ï¼Œè¦ä¹ˆè®¡ç®—å‡ºçš„ç»“æœå…¨éƒ¨ç­‰äº 0ï¼Œè¦ä¹ˆçˆ†ç‚¸äº†å…¨éƒ¨æ˜¯ NaN: Not a Numberã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ¿€æ´»å‡½æ•°ï¼Œæ¯æ¬¡æ›´æ–°çŠ¶æ€ $h$ åï¼Œéƒ½ä¼šåšä¸€ä¸ªæ ‡å‡†åŒ–æ“ä½œ normalizationï¼Œè®© $h$ æ¢å¤åˆ° $(-1, +1)$ è¿™ä¸ªåˆé€‚çš„åŒºé—´é‡Œã€‚\nğŸï¸ Simple RNN æ¨¡å‹å‚æ•°æ•°é‡ æˆ‘ä»¬æ¥æ•°ä¸€ä¸‹ Simple RNN æœ‰å¤šå°‘ä¸ªæ¨¡å‹å‚æ•°ã€‚\nå¦‚å›¾ï¼Œå…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªæ‹¼æ¥åå‘é‡ï¼Œè¿™ä¸ªå‘é‡çš„ç»´åº¦æ˜¯ $h_{t-1}$ çš„ç»´åº¦åŠ ä¸Š $x_t$ çš„ç»´åº¦ï¼š\næ‰€ä»¥ $A$ ä¸€å®šè¦æœ‰ $shape(h)+shape(x)$ ç»´åº¦è¿™ä¹ˆå¤šåˆ—ï¼š\n$A$ çš„è¡Œæ•°ç­‰äº $h$ çš„ç»´åº¦ï¼š\næ‰€ä»¥ï¼Œæœ€ç»ˆçŸ©é˜µ $A$ çš„å¤§å°ç­‰äºï¼š\n$parameter(A) = shape(h) * [shape(h) + shape(x)]$\nè¿™ä¸ªä¹˜ç§¯ $parameter(A)$ å°±æ˜¯ simple RNN çš„æœ€ç»ˆçš„å‚æ•°æ•°é‡ã€‚\nğŸ“– (TODO) Simple RNN çš„ç”µå½±è¯„è®ºåˆ†æ Doing\nğŸ§° simple RNN çš„ç¼ºé™· ä¸‹é¢çœ‹ä¸€ä¸‹ simple RNN è¿™ç§ç®€å•çš„æ¨¡å‹æœ‰ä»€ä¹ˆç¼ºé™·ã€‚\nä¸¾ä¸ªæ —å­ ğŸŒ° ï¼Œç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œç»™å®šåŠå¥è¯ï¼Œè¦æ±‚é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ã€‚\nè¾“å…¥æ˜¯ clouds are in theï¼Œæ­£ç¡®çš„è¾“å‡ºåº”è¯¥æ˜¯ skyï¼Œå¦‚æœåœ¨å¤§é‡æ–‡æœ¬ä¸­é¢„æµ‹ RNNï¼Œåº”è¯¥æ˜¯æœ‰èƒ½åŠ›åšå‡ºè¿™æ ·çš„é¢„æµ‹çš„ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼ŒRNN åªéœ€è¦çœ‹æœ€è¿‘çš„å‡ ä¸ªè¯ï¼Œå°¤å…¶æ˜¯ clouds areï¼Œå¹¶ä¸éœ€è¦æ›´å¤šçš„ä¸Šä¸‹æ–‡çœ‹çš„æ›´è¿œã€‚\nè¿™ä¸ªä¾‹å­æ˜¯å¯¹ simple RNN ååˆ†æœ‰åˆ©ï¼Œsimple RNN ç‰¹åˆ«æ“…é•¿è¿™ç§ short-term dependenceï¼Œsimple RNN ä¸æ“…é•¿çš„æ˜¯ long-term dependenceã€‚\nRNN çš„çŠ¶æ€ $h$ï¼Œå’Œä¹‹å‰æ‰€æœ‰çš„è¾“å…¥ $x$ éƒ½æœ‰å‡½æ•°ä¾èµ–å…³ç³»ï¼Œç…§ç†æ¥è¯´ï¼Œå¦‚æœæ”¹å˜è¾“å…¥çš„å•è¯ $x_1$ï¼Œæ‰€æœ‰çš„çŠ¶æ€ $h$ éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†å®é™…ä¸Šï¼Œsimple RNN å¹¶æ²¡æœ‰è¿™ç§æ€§è´¨ï¼Œæ‰€ä»¥å¾ˆä¸åˆç†ã€‚å¦‚æœæŠŠç¬¬ 100 ä¸ªçŠ¶æ€å‘é‡ $h_{100}$ï¼Œå…³äºè¾“å…¥ $x_1$ æ±‚å¯¼ï¼Œä½ ä¼šå‘ç°å¯¼æ•°å‡ ä¹ç­‰äº 0ã€‚\n$\\frac{\\partial h_{100}}{\\partial x_1} \\approx 0$\nå¯¼æ•°å‡ ä¹ç­‰äº 0 è¯´æ˜ä»€ä¹ˆå‘¢ï¼Ÿè¯´æ˜å½“æˆ‘ä»¬æ”¹å˜ $x_1$æ—¶ï¼Œ$h_{100}$ å‡ ä¹ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´çŠ¶æ€ $h_{100}$ å’Œ 100 æ­¥ä¹‹å‰çš„è¾“å…¥ $x_1$ å‡ ä¹æ²¡æœ‰å…³ç³»ï¼Œè¿™æ˜¾ç„¶ä¸åˆç†ï¼Œè¯´æ˜çŠ¶æ€ $h_{100}$ å‡ ä¹æŠŠå¾ˆå¤šæ­¥ä¹‹å‰çš„è¾“å…¥éƒ½ç»™å¿˜è®°äº†ï¼Œsimple RNN çš„è¿™ç§é—å¿˜ä¼šç»™åç»­æ“ä½œé€ æˆå¾ˆå¤šé—®é¢˜ã€‚\nå†ä¸¾ä¸ªæ —å­ ğŸŒ° ï¼Œè¿™æ˜¯å¾ˆé•¿çš„ä¸€æ®µè¯ï¼Œä¸€å¼€å§‹æ˜¯ I grow up in China when I was a child, ... ... åˆ°äº†å¾ˆå¤šå¥è¯ä¹‹åï¼Œæœ‰è¿™æ ·ä¸€å¥ï¼ŒI speak fluent ...ã€‚\nä¸‹ä¸€ä¸ªè¯åº”è¯¥æ˜¯ Chineseï¼Œæˆ‘å°æ—¶å€™åœ¨ä¸­å›½ï¼Œæ‰€æœ‰ä¼šè¯´æµåˆ©çš„ä¸­æ–‡ï¼Œç„¶è€Œ simple RNN ä¸å¤ªå¯èƒ½ä¼šåšå‡º Chinese è¿™ä¸ªæ­£ç¡®çš„é¢„æµ‹ï¼Œå› ä¸º RNN å·²ç»æŠŠå‰æ–‡ç»™å¿˜è®°äº†ã€‚simple RNN æ“…é•¿çš„æ˜¯ short-term dependenceï¼ŒRNN çœ‹åˆ°æœ€è¿‘çš„å•è¯æ˜¯ speak fluentï¼Œæ‰€ä»¥ RNN çŸ¥é“ä¸‹ä¸€ä¸ªå•è¯å¯èƒ½æ˜¯æŸç§è¯­è¨€ï¼Œå¯èƒ½æ˜¯ Chineseã€Englishã€Frenchã€Japanese ç­‰ç­‰ï¼Œä½†æ­£ç¡®ç­”æ¡ˆæ˜¯ Chineseï¼Œå› ä¸ºä¸Šæ–‡æœ‰ I grow up in china when i was childï¼Œsimple RNN å°±åƒé‡‘é±¼ä¸€æ ·è®°å¿†åŠ›åªæœ‰ 7 ç§’ï¼ŒRNN æ ¹æœ¬å°±ä¸è®°å¾—ä¸Šæ–‡æœ‰è¿™å¥è¯ï¼Œæ‰€ä»¥ I speak fluent ... é¢„æµ‹å•è¯å¯èƒ½æ˜¯ English , French ç­‰ä»»ä½•ä¸€ç§è¯­è¨€ï¼Œæœªå¿…æ˜¯ Chineseã€‚\nğŸ æ€»ç»“ æœ€åæ€»ç»“ä¸€ä¸‹è¿™ä¸€èŠ‚çš„å†…å®¹ï¼š\nRNN æ˜¯ä¸€ç§ç¥ç»ç½‘ç»œï¼Œä½†æ˜¯ä»–çš„ç»“æ„ä¸åŒäºå…¨è¿æ¥ç½‘ç»œå’Œå·ç§¯ç½‘ç»œï¼ŒRNN é€‚ç”¨äºæ–‡æœ¬ï¼Œè¯­éŸ³ç­‰æ—¶åºåºåˆ—æ•°æ®ï¼ŒRNN æŒ‰ç…§é¡ºåºè¯»å–æ¯ä¸€ä¸ªè¯å‘é‡ï¼Œå¹¶ä¸”åœ¨çŠ¶æ€å‘é‡ $h$ ä¸­ç§¯ç´¯çœ‹åˆ°è¿‡å¾—ä¿¡æ¯ï¼Œ$h_0$ ä¸­åŒ…å«äº† $x_0$ çš„ä¿¡æ¯ï¼Œ$h_1$ ä¸­åŒ…å«äº† $x_0$ å’Œ $x_1$ çš„ä¿¡æ¯ï¼Œ$h_t$ ä¸­ç§¯ç´¯äº†ä¹‹å‰æ‰€æœ‰ $x={x_0, x_1, \u0026hellip;, x_t}$ çš„ä¿¡æ¯ã€‚\næœ‰ä¸€ç§é”™è¯¯çš„çœ‹æ³•æ˜¯ $h_t$ ä¸­åªåŒ…å«äº† $x_t$ çš„ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸å¯¹çš„ï¼Œ$h_t$ ä¸­åŒ…å«äº†ä¹‹å‰æ‰€æœ‰è¾“å…¥çš„ä¿¡æ¯ï¼Œå¯ä»¥è®¤ä¸º $h_t$ ä»£è¡¨äº† RNN ä»æ•´ä¸ªåºåˆ—ä¸­æŠ½å–çš„ç‰¹å¾å‘é‡ï¼Œæ‰€æœ‰æˆ‘ä»¬åªéœ€è¦ $h_t$ å°±å¯ä»¥åˆ¤æ–­ç”µå½±è¯„ä»·æ˜¯æ­£é¢çš„è¿˜æ˜¯è´Ÿé¢çš„ã€‚\nsimple RNN æœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µ $A$ï¼Œå®ƒå¯èƒ½è¿˜ä¼šä¸€ä¸ª intercept å‚æ•°å‘é‡ $b$ï¼Œä¸Šé¢çš„ä»‹ç»ä¸­å¿½ç•¥äº†è¿™ä¸ªå‚æ•°å‘é‡ $b$ï¼Œè¿™ä¸ªå‚æ•°çŸ©é˜µ $A$ çš„ç»´åº¦æ˜¯ï¼š\n$shape(h) * [shape(h) + shape(x)]$\nå‚æ•°çŸ©é˜µ $A$ ä¸€å¼€å§‹éšæœºåˆå§‹åŒ–ï¼Œç„¶åä»è®­ç»ƒæ•°æ®ä¸Šå­¦ä¹ ã€‚æ³¨æ„ï¼šsimple RNN åªæœ‰ä¸€ä¸ªå‚æ•°çŸ©é˜µï¼Œä¸ç®¡è¿™ä¸ªåºåˆ—æœ‰å¤šé•¿ï¼Œå‚æ•°çŸ©é˜µåªæœ‰ä¸€ä¸ªï¼Œæ‰€æœ‰æ¨¡å—é‡Œçš„å‚æ•°éƒ½æ˜¯ä¸€æ ·çš„ã€‚\nRNN æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼ŒRNN çš„è®°å¿†æ¯”è¾ƒçŸ­ï¼Œä¼šé—å¿˜å¾ˆä¹…ä¹‹å‰çš„è¾“å…¥ $x$ï¼Œå¦‚æœè¿™ä¸ªæ—¶é—´åºåˆ—å¾ˆé•¿ï¼Œæœ‰å¥½å‡ åæ­¥ï¼Œæœ€ç»ˆ RNN å°±ä¼šå¿˜è®°äº†ä¹‹å‰çš„è¾“å…¥ã€‚ä¸‹ä¸€èŠ‚å°†ä»‹ç» LSTMï¼ŒLSTM çš„è®°å¿†ä¼šæ¯” simple RNN é•¿å¾ˆå¤šï¼Œä½†æ˜¯ RNN ä¹Ÿè¿˜æ˜¯ä¼šæœ‰é—å¿˜çš„é—®é¢˜ã€‚\n","date":"2022-03-08T20:36:14+08:00","image":"https://nlp.letout.cn/img/nlp/banner.png","permalink":"https://emerywan.github.io/blog/p/nlp-in-action/simple-rnn/","title":"RNN"},{"content":"ğŸŒ± ç±»åˆ«ç‰¹å¾ æœºå™¨å­¦ä¹ çš„æ•°æ®é€šå¸¸æœ‰ ç±»åˆ«ç‰¹å¾ Categorical Features ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç±»åˆ«ç‰¹å¾ Categorical Features è½¬åŒ–æˆæœºå™¨å­¦ä¹ æ¨¡å‹èƒ½ç†è§£çš„æ•°å€¼ç‰¹å¾ï¼Œä¸‹é¢ä½¿ç”¨ä¸€ä¸ªä¾‹å­æ¥å…·ä½“è®²è§£ç±»åˆ«ç‰¹å¾æ•°æ®çš„å¤„ç†ã€‚\nè¿™å¼ è¡¨çš„æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªäººçš„æ•°æ®ï¼ŒåŒ…æ‹¬ï¼šå¹´é¾„ã€æ€§åˆ«ã€å›½ç±ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™äº›æ•°æ®å˜æˆæœºå™¨å­¦ä¹ æ¨¡å‹å¯ä»¥ç†è§£çš„æ•°å€¼ç‰¹å¾ã€‚\nè¡¨æ ¼çš„ç¬¬ä¸€åˆ—æ˜¯å¹´é¾„ï¼Œå¹´é¾„æœ¬èº«å°±æ˜¯æ•°å€¼ç‰¹å¾ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨åšå¤„ç†ï¼Œæ•°å€¼ç‰¹å¾çš„ç‰¹ç‚¹æ˜¯å¯ä»¥æ¯”è¾ƒå¤§å°ï¼Œæ¯”å¦‚ 35 å²çš„äººæ¯” 31 å²çš„å¹´é¾„å¤§ã€‚\nç¬¬äºŒåˆ—æ˜¯æ€§åˆ«ï¼Œæ€§åˆ«æ˜¯äºŒå…ƒç‰¹å¾ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ•°æ¥è¡¨ç¤ºæ€§åˆ«ã€‚ç”¨ 0 è¡¨ç¤ºå¥³æ€§ï¼Œç”¨ 1 è¡¨ç¤ºç”·æ€§ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ€§åˆ«å°±è¡¨ç¤ºä¸ºä¸€ä¸ªæ ‡é‡ï¼š0 / 1ã€‚\nç¬¬ä¸‰åˆ—æ˜¯å›½ç±ï¼Œæ¯”å¦‚ä¸­å›½ï¼Œç¾å›½ï¼Œå°åº¦ã€‚å›½ç±æ˜¯ç±»åˆ«ç‰¹å¾ï¼Œæœºå™¨å­¦ä¹ å¹¶ä¸ç†è§£å›½ç±ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠå›½ç±ç¼–ç æˆæ•°å€¼å‘é‡ã€‚ä¸–ç•Œä¸Šçº¦æœ‰ 197 ä¸ªå›½å®¶ï¼Œæˆ‘ä»¬å…ˆç”¨ä¸€ä¸ª [1 - 197] çš„æ•´æ•°è¡¨ç¤ºä¸€ä¸ªå›½å®¶ã€‚å¯ä»¥å»ºç«‹ä¸€ä¸ªå­—å…¸ï¼ŒæŠŠå›½ç±æ˜ å°„æˆä¸€ä¸ª [1 - 197] çš„æ•´æ•°ã€‚æ¯”å¦‚ï¼šChina:1; US:2; India:3; Japan:4; Germany:5ã€‚\næˆ‘ä»¬è¦ä» 1 å¼€å§‹è®¡ç®—ï¼Œè€Œä¸èƒ½ä» 0 å¼€å§‹è®¡ç®—ã€‚\nåšè¿™ç§æ˜ å°„ï¼Œå›½ç±å°±è¡¨ç¤ºæˆ [1 - 197] ä¹‹é—´çš„æ•´æ•°ã€‚ä»…ä»…æŠŠå›½ç±è¡¨ç¤ºæˆ [1 - 197] çš„æ•´æ•°è¿˜æ˜¯ä¸è¡Œï¼Œä¸€ä¸ªæ•´æ•°åªæ˜¯ä¸€ç§ç±»åˆ«ï¼Œå®ƒä»¬ä¹‹é—´ä¸èƒ½æ¯”è¾ƒå¤§å°ã€‚US:2; India:3 è¿™ä¸ªæ•°å­—å¹¶ä¸è¡¨ç¤ºå°åº¦å¤§äºç¾å›½ï¼Œè¿™äº›æ•´æ•°åªæ˜¯ç±»åˆ«è€Œå·²ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„æ•°å€¼ç‰¹å¾ã€‚\næ‰€ä»¥è¦è¿›ä¸€æ­¥å¯¹å›½ç±åš one-hot encoding ï¼Œç”¨ one-hot å‘é‡æ¥è¡¨ç¤ºå›½ç±ï¼š\n1 2 China -\u0026gt; 1 -\u0026gt; [1,0,0,0,...,0] US -\u0026gt; 2 -\u0026gt; [0,1,0,0,...,0] æ¯”å¦‚ï¼Œä¸­å›½å¯¹åº” 1ï¼Œæ‰€ä»¥ç”¨ 197 ç»´çš„ one-hot å‘é‡ [1,0,0,0...,0] æ¥è¡¨ç¤ºï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ï¼›ç¾å›½å¯¹åº” 2ï¼Œè¿™ä¸ª 197 ç»´çš„å‘é‡ [0,1,0,0...,0] ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªå›½ç±å°±ç”±ä¸€ä¸ª one-hot å‘é‡è¡¨ç¤ºï¼Œä¸€å…±æœ‰ 197 ä¸ªå›½å®¶ï¼Œæ‰€ä»¥æ¯ä¸ªå‘é‡éƒ½æ˜¯ 197 ç»´çš„ã€‚\næˆ‘ä»¬è¦ä» 1 å¼€å§‹è®¡ç®—ï¼Œè€Œä¸èƒ½ä» 0 å¼€å§‹è®¡ç®—ã€‚ å› ä¸ºæˆ‘ä»¬è¦æŠŠ 0 ä¿ç•™ï¼Œç”¨æ¥è¡¨ç¤ºæœªçŸ¥æˆ–è€…ç¼ºå¤±çš„å›½ç±ã€‚æ•°æ®åº“é‡Œé¢ç»å¸¸ä¼šæœ‰ç¼ºå¤±çš„æ•°æ®ï¼ˆæ¯”å¦‚ç”¨æˆ·æ²¡æœ‰å¡«å†™å›½ç±ï¼‰ï¼Œè¿™æ ·ç¼ºå¤±çš„å›½ç±å°±ç”¨ 0 æ¥è¡¨ç¤ºï¼Œå®ƒçš„ one-hot å‘é‡å°±æ˜¯ä¸€ä¸ªå…¨ 0 çš„å‘é‡[0,0,0,0...,0]ã€‚\nä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª 199 ç»´è¡¨ç¤ºä¸€ä¸ªäººçš„ç‰¹å¾ã€‚æ¯”å¦‚è¿™ä¸ªäºº 28 å²ï¼Œå¥³æ€§ï¼Œå›½ç±æ˜¯ä¸­å›½ã€‚\nå…¶ä¸­ï¼Œä¸€ä¸ªç»´åº¦è¡¨ç¤ºå¹´é¾„ï¼Œä¸€ä¸ªç»´åº¦è¡¨ç¤ºæ€§åˆ«ï¼Œä¸€ä¸ª 197 ç»´çš„ one-hot å‘é‡è¡¨ç¤ºå›½ç±ã€‚\nè¿™ä¸ªä¾‹å­é‡Œï¼Œè¿™ä¸ª 36 å²ï¼Œç”·æ€§ï¼Œå›½ç±æœªçŸ¥çš„äººçš„ç‰¹å¾æ˜¯è¿™ä¸ª 199 ç»´çš„å‘é‡ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª 197 ç»´çš„å…¨ 0 å‘é‡è¡¨ç¤ºæœªçŸ¥å›½ç±ã€‚\nğŸ”– ä¸ºä»€ä¹ˆè¦ç”¨ one-hot å‘é‡è¡¨ç¤ºç‰¹å¾ åœ¨å¤„ç†ç±»åˆ«ç‰¹å¾çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨ one-hot å‘é‡è¡¨ç¤ºå›½ç±ï¼Œæ¯ä¸ªå›½ç±éƒ½ç”¨ 197 ç»´çš„å‘é‡è¡¨ç¤ºã€‚ä¸ºä»€ä¹ˆè¦ç”¨ one-hot å‘é‡è€Œä¸ç”¨ä¸€ä¸ªæ•°å­—è¡¨ç¤ºå‘¢ï¼Ÿæ¯”å¦‚ç”¨ 1 è¡¨ç¤ºä¸­å›½ï¼Œ2 è¡¨ç¤ºç¾å›½ï¼Œ3 è¡¨ç¤ºå°åº¦ã€‚è¿™æ ·ä¸€æ¥ï¼Œåå­—å°±å˜æˆäº†æ•°å­—ï¼Œå¯ä»¥åšæ•°å€¼è®¡ç®—ï¼Œè€Œä¸”ç”¨ä¸€ä¸ªæ•°å­—è¡¨ç¤ºçš„è¯ï¼Œå¯ä»¥èŠ‚çœ 197 å€çš„å­˜å‚¨ç©ºé—´ã€‚å½“ç„¶è¿™æ˜¯ä¸è¡Œçš„ã€‚å¦åˆ™æˆ‘ä»¬å°±ä¸éœ€è¦ one-hot encoding äº†ã€‚\nå‡è®¾æˆ‘ä»¬ä½¿ç”¨ 1 -\u0026gt; China; 2 -\u0026gt; US; 3 -\u0026gt; Indiaã€‚é‚£ä¹ˆå°†ä¸­å›½ 1 å’Œç¾å›½ 2 çš„ç‰¹å¾åŠ èµ·æ¥ï¼š1+2=3 ï¼Œç›¸å½“äº â€œä¸­å›½ + ç¾å›½ = å°åº¦â€ã€‚è¿™æ ·çš„ç‰¹å¾å®Œå…¨ä¸åˆç†ã€‚\nä½¿ç”¨ one-hot ç‰¹å¾å‘é‡æ›´åˆç†ã€‚å°† China å’Œ US çš„ one-hot å‘é‡åŠ èµ·æ¥ï¼Œå¾—åˆ° [1,1,0,0,...,0]ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå…ƒç´ éƒ½æ˜¯ 1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯ 0ï¼Œè¿™ä¸ªç‰¹å¾å‘é‡çš„è§£é‡Šæ˜¯ï¼šæ—¢æœ‰ä¸­å›½å›½ç±ï¼Œåˆæœ‰ç¾å›½å›½ç±ã€‚\næ‰€ä»¥åšæœºå™¨å­¦ä¹ çš„æ—¶å€™ï¼Œä¸èƒ½ç”¨ä¸€ä¸ªæ ‡é‡æ¥è¡¨ç¤ºä¸€ä¸ªç±»åˆ«ç‰¹å¾ï¼Œè¿™ç§ç‰¹å¾åšæ³•æ±‚å’Œç­‰æ•°å€¼è®¡ç®—æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨ one-hot å‘é‡æ¥è¡¨ç¤ºç±»åˆ«ç‰¹å¾ã€‚\nğŸš€ å¤„ç†æ–‡æœ¬æ•°æ®çš„æµç¨‹ åœ¨è‡ªç„¶è¯­è¨€å¤„ç†çš„åº”ç”¨ä¸­ï¼Œæ•°æ®å°±æ˜¯æ–‡æœ¬ documentï¼Œæ–‡æœ¬å¯ä»¥åˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå•è¯è¡¨ç¤ºæˆæ•°å€¼å‘é‡ã€‚å…¶ä¸­æ¯ä¸ªå•è¯éƒ½æ˜¯ä¸€ä¸ªç±»åˆ«ï¼Œå¦‚æœå­—å…¸é‡Œæœ‰ä¸€ä¸‡ä¸ªå•è¯ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€ä¸‡çš„ç±»åˆ«ï¼Œæ˜¾ç„¶å•è¯å°±æ˜¯ç±»åˆ«ç‰¹å¾ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¤„ç†ç±»åˆ«ç‰¹å¾çš„æ–¹æ³•ï¼ŒæŠŠå•è¯å˜æˆæ•°å€¼å‘é‡ã€‚\næ–‡æœ¬å¤„ç†ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š\nğŸ”” æŠŠæ–‡æœ¬åˆ†å‰²æˆå•è¯ ğŸ”” è®¡ç®—æ¯ä¸ªå•è¯å‡ºç°çš„æ¬¡æ•° ğŸ”” è¿›è¡Œ one-hot ç¼–ç  æ–‡æœ¬å¤„ç†çš„ç¬¬ä¸€æ­¥æ˜¯æŠŠæ–‡æœ¬åˆ†å‰²æˆå•è¯ã€‚ä¸€æ®µè¯ï¼Œä¸€ç¯‡æ–‡ç« æˆ–è€…ä¸€æœ¬ä¹¦å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥æŠŠæ–‡æœ¬åˆ†å‰²æˆå¾ˆå¤šå•è¯ï¼Œè¿™ä¸ªæ­¥éª¤ç§°ä¸º Tokenizationã€‚\næ¯”å¦‚è¯´è¿™å¥è¯ ... to be or not to be ...ï¼Œ å¯ä»¥åˆ†å‰²æˆè¿™äº›å•è¯ [to, be, or, not, to, be]ã€‚Tokenization å°±æ˜¯æŠŠæ–‡æœ¬å˜æˆå•è¯çš„åˆ—è¡¨ã€‚\næ–‡æœ¬å¤„ç†çš„ç¬¬äºŒæ­¥æ˜¯è®¡ç®—è¯é¢‘ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå•è¯å‡ºç°çš„æ¬¡æ•°ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ hash Map æ¥è®¡ç®—ï¼Œè®¡ç®—å¼€å§‹ä¹‹å‰ï¼Œå“ˆå¸Œè¡¨æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬æ ¹æ®ä»¥ä¸‹æ–¹å¼æ›´æ–°å“ˆå¸Œè¡¨ï¼šå¦‚æœå•è¯ w ä¸åœ¨è¡¨é‡Œé¢ï¼Œè¯´æ˜åˆ°ç›®å‰ä¸ºæ­¢ï¼Œw è¿˜æ²¡æœ‰å‡ºç°åœ¨æ–‡æœ¬é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠ w åŠ å…¥å“ˆå¸Œè¡¨ï¼Œå¹¶è®©å®ƒçš„è¯é¢‘ç­‰äº 1ï¼›å¦‚æœ w åœ¨å“ˆå¸Œè¡¨é‡Œé¢ï¼Œè¯´æ˜ w ä¹‹å‰åœ¨æ–‡æœ¬é‡Œå‡ºç°è¿‡ï¼Œåªéœ€è¦æŠŠ w çš„è¯é¢‘åŠ  1 å³å¯ã€‚\næ¥ä¸‹æ¥ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†æŒ¨ä¸ªå¤„ç†è¿™ä¸ªåˆ—è¡¨é‡Œçš„å•è¯ã€‚å½“å¤„ç†åˆ°å•è¯ to çš„æ—¶å€™ï¼Œé¦–å…ˆæŸ¥ä¸€ä¸‹å“ˆå¸Œè¡¨ï¼Œå‘ç°å“ˆå¸Œè¡¨é‡Œé¢æœ‰ toï¼Œå®ƒçš„è¯é¢‘æ˜¯ 398ï¼Œè¯´æ˜ to åœ¨æ–‡ç« é‡Œå·²ç»å‡ºç°è¿‡ 398 æ¬¡äº†ï¼Œç°åœ¨è¿™ä¸ªå•è¯åˆå‡ºç°äº†ä¸€æ¬¡ï¼Œäºæ˜¯æŠŠè¡¨é‡Œçš„è¯é¢‘åŠ  1ï¼Œå˜æˆäº† 399ï¼›å½“å¤„ç†åˆ°å•è¯ orçš„æ—¶å€™ï¼Œåœ¨è¡¨é‡Œæ‰¾ä¸åˆ°ï¼Œè¿™è¯´æ˜æ–‡ç« é‡Œè¿˜æ²¡æœ‰å‡ºç°è¿‡ or è¿™ä¸ªå•è¯ï¼Œç¬¬ä¸€æ¬¡å‡ºç°åœ¨æ–‡ç« é‡Œï¼Œäºæ˜¯æˆ‘ä»¬æŠŠ or æ’å…¥è¡¨é‡Œï¼Œå°†è¯é¢‘è®¾ç½®ä¸º 1ã€‚\nå®Œæˆç»Ÿè®¡è¯é¢‘ä¹‹åï¼Œéœ€è¦æŠŠå“ˆå¸Œè¡¨åšä¸€ä¸ªæ’åºï¼ŒæŒ‰ç…§è¯é¢‘é€’å‡çš„é¡ºåºè¿›è¡Œæ’åˆ—ï¼Œè¡¨çš„æœ€å‰é¢æ˜¯è¯é¢‘æœ€é«˜çš„ï¼Œè¡¨æœ€åæ˜¯è¯é¢‘æœ€ä½çš„ã€‚ç„¶åå°±æŠŠè¯é¢‘æ¢æˆä¸‹æ ‡ indexï¼Œä» 1 å¼€å§‹æ•°è®¡æ•°ï¼Œè¯é¢‘æœ€é«˜çš„è¯çš„ index æ˜¯ 1ã€‚è¿™ä¸ªä¾‹å­é‡Œï¼Œä¸€å…±æœ‰ 8 ä¸ªå•è¯ï¼Œæ¯ä¸ªè¯å¯¹åº”ä¸€ä¸ª [1, 8] ä¹‹é—´çš„æ­£æ•´æ•°ã€‚è¿™ä¸ªè¡¨ç§°ä¸ºå­—å…¸ ï¼Œå¯ä»¥æŠŠå•è¯æ˜ å°„ä¸ºä¸€ä¸ªæ•°å­—ã€‚\nå­—å…¸é‡Œå•è¯çš„ä¸ªæ•°ç§°ä¸ºè¯æ±‡é‡ vocabularyã€‚è¿™ä¾‹å­é‡Œè¯æ±‡é‡ç­‰äº 8ã€‚\nè‹±è¯­é‡Œå¤§æ¦‚æœ‰ 1 ä¸‡ä¸ªå¸¸ç”¨è¯ï¼Œä½†æ˜¯ç»Ÿè®¡è¯é¢‘ä¹‹åï¼Œä½ ä¼šå‘ç°å­—å…¸ä¼šæœ‰å‡ åä¸‡ç”šè‡³ä¸Šç™¾ä¸‡ä¸ªå•è¯ã€‚ç»Ÿè®¡è¯é¢‘çš„ç›®çš„å°±æ˜¯ä¿ç•™å¸¸ç”¨è¯ï¼Œå»æ‰ä½é¢‘è¯ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¿ç•™è¯é¢‘æœ€é«˜çš„ 1 ä¸‡ä¸ªå•è¯ï¼Œåˆ æ‰å…¶ä½™å•è¯ã€‚\nä¸ºä»€ä¹ˆè¦åˆ æ‰ä½é¢‘è¯å‘¢ï¼Ÿ\nğŸŒ° ä½é¢‘è¯é€šå¸¸æ²¡æœ‰æ„ä¹‰ å¾ˆå¤šä½é¢‘è¯éƒ½æ˜¯åå­—å®ä½“ name entitiesï¼Œæ¯”å¦‚æˆ‘ä»¬çš„åå­—å°±æ˜¯ä¸ªåå­—å®ä½“ï¼Œå‡å¦‚æˆ‘ä»¬çš„åå­—å‡ºç°åœ¨ä¸€ä¸ªæ•°æ®é›†é‡Œé¢ï¼Œä»–çš„é¢‘ç‡è‚¯å®šä¼šå¾ˆä½ï¼Œåœ¨å¤§å¤šæ•°çš„åº”ç”¨é‡Œåå­—å®ä½“æ²¡æœ‰æ„ä¹‰ã€‚\nä½é¢‘è¯å¾ˆå¤šéƒ½æ˜¯æ‹¼å†™é”™è¯¯é€ æˆçš„ï¼Œå¦‚æœæŠŠ prince çš„ c è¯¯å†™æˆ sï¼Œprinseï¼Œé‚£ä¹ˆå°±åˆ›é€ äº†ä¸€ä¸ªæ–°çš„å•è¯ï¼Œè¿™ç§è¯çš„é¢‘ç‡ä¹Ÿå¾ˆä½ï¼Œåœ¨å¾ˆå¤šåº”ç”¨é‡Œï¼Œå»æ‰è¿™ç§è¯æ²¡æœ‰å±å®³ã€‚\nğŸŒ° å»æ‰ä½é¢‘è¯çš„å¦ä¸€ä¸ªåŸå› æ˜¯æˆ‘ä»¬ä¸å¸Œæœ› vocabulary å¤ªå¤§ã€‚ ä¸‹ä¸€ä¸ªæ­¥éª¤åš one-hot encoding çš„æ—¶å€™ï¼Œå‘é‡çš„ç»´åº¦å°±æ˜¯å­—å…¸çš„å¤§å°ã€‚å­—å…¸è¶Šå¤§ï¼Œå‘é‡çš„ç»´åº¦å°±è¶Šé«˜ï¼Œè¿™ä¼šè®©è®¡ç®—å˜æ…¢ã€‚ä¸‹ä¸€èŠ‚è¯¦ç»†è¯´æ˜è¯åµŒå…¥ Word Embedding çš„æ—¶å€™å°±ä¼šçœ‹åˆ°ï¼Œå­—å…¸è¶Šå¤§ï¼Œæ¨¡å‹çš„å‚æ•°å°±è¶Šä¼šè¶Šå¤šï¼Œå°±ä¼šå®¹æ˜“é€ æˆè¿‡æ‹Ÿåˆ overfittingï¼Œåˆ æ‰ä½é¢‘è¯å°±ä¼šå¤§å¹…å‡å° vocabularyã€‚\næ–‡æœ¬å¤„ç†çš„ç¬¬ä¸‰æ­¥å°±æ˜¯å¯¹å•è¯åš one-hot encodingï¼Œé€šè¿‡æŸ¥å­—å…¸ï¼ŒæŠŠå•è¯æ˜ å°„æˆä¸€ä¸ªæ­£æ•´æ•°ï¼Œä¸€ä¸ªå•è¯çš„åˆ—è¡¨å°±æ˜ å°„æˆäº†ä¸€ä¸ªæ­£æ•´æ•°çš„åˆ—è¡¨ï¼›å¦‚æœæœ‰å¿…è¦å°±ç»§ç»­æŠŠè¿™äº›æ­£æ•´æ•°å˜æˆ one-hot å‘é‡ã€‚è¿™äº› one-hot å‘é‡çš„ç»´åº¦æ­£å¥½ç­‰äº vocabularyï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œå­—å…¸çš„é•¿åº¦æ˜¯ 8ï¼Œæ‰€ä»¥ one-hot ç»´åº¦å°±ç­‰äº 8ã€‚\nä¸Šé¢è¯´è¿‡ï¼Œå­—å…¸é‡Œçš„ä½é¢‘è¯å¯èƒ½ä¼šè¢«åˆ æ‰ï¼Œæ‰€ä»¥æœ‰äº›è¯åœ¨å­—å…¸é‡Œæ‰¾ä¸åˆ°ï¼Œä¾‹å¦‚æŠŠ be é”™è¯¯æ‹¼å†™æˆå•è¯ biï¼Œè¿™ä¸ªè¯åœ¨å­—å…¸é‡Œæ‰¾ä¸åˆ°ï¼Œone-hot encoding æ—¶ï¼Œå¯ä»¥å¿½ç•¥è¿™ä¸ªè¯ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒç¼–ç æˆå…¨ 0 å‘é‡ã€‚\nğŸ æ€»ç»“ æœ€åæ€»ç»“ä¸€ä¸‹è¿™ä¸€èŠ‚çš„å†…å®¹ã€‚\néƒ¨åˆ†æœºå™¨å­¦ä¹ çš„æ•°æ®ä¼šå…·å¤‡ç±»åˆ«ç‰¹å¾ Categorical Featuresï¼Œæœºå™¨å­¦ä¹ æ¨¡å‹æ— æ³•ç†è§£ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è½¬æ¢æˆæ•°å€¼ç‰¹å¾ã€‚ç±»åˆ«ç‰¹å¾çš„ç±»åˆ«ä¼šè¢«æ˜ å°„æˆä¸€ä¸ªä» 1 å¼€å§‹è®¡ç®—çš„æ•´æ•°ï¼Œ0 è¢«ç”¨æ¥è¡¨ç¤ºç¼ºå¤±æˆ–è€…æœªçŸ¥çš„ç±»åˆ«ï¼Œå¹¶ä¸”ä½¿ç”¨ one-hot å‘é‡ï¼Œèƒ½å¾ˆå¥½çš„è¡¨ç¤ºç±»åˆ«ç‰¹å¾çš„æ„ä¹‰ã€‚\næ–‡æœ¬å¤„ç†ä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€æ­¥ tokenization æŠŠæ–‡æœ¬åˆ†å‰²æˆå•è¯çš„åˆ—è¡¨ï¼›ç¬¬äºŒæ­¥å»ºç«‹äº†ä¸€ä¸ªå­—å…¸vocabularyï¼ŒæŠŠå•è¯æ˜ å°„æˆä¸€ä¸ªæ­£æ•´æ•°ï¼›ç¬¬ä¸‰æ­¥è¿›è¡Œ one-hot encodingï¼Œå°†åˆ†å‰²åçš„å•è¯åˆ—è¡¨æ˜ å°„æˆæ­£æ•´æ•°çš„åˆ—è¡¨æˆ–å˜æˆ one-hot å‘é‡ã€‚\n","date":"2022-03-01T02:02:02+08:00","image":"https://nlp.letout.cn/img/nlp/banner.png","permalink":"https://emerywan.github.io/blog/p/nlp-in-action/data-processing/","title":"æ•°æ®å¤„ç†åŸºç¡€"},{"content":"åšè‡ªç„¶è¯­è¨€å¤„ç†å†™äº†æŒºä¹…çš„ Python ï¼Œç»å¸¸è¦å¤„ç†æ•°æ®ã€‚ç”¨ Python ä¸­çš„å¤„ç†æ•°æ®çœŸçš„æŒºçˆ½çš„ ğŸ«£ï¼Œæˆ‘å¹³å¸¸éƒ½å–œæ¬¢æŠŠå„ç§æ•°æ®éƒ½å¾€ dictï¼ˆä¹Ÿå°±æ˜¯ Java ä¸­çš„ mapï¼‰ å’Œ json ä¸Šè½¬ï¼Œç”¨ Python å¤„ç†è¿™ä¸ªå„ç§æ–¹ä¾¿ã€‚ æœ€è¿‘å†å†™ Java å°±ç»å¸¸â€œæ‰‹æ®‹â€ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹ Java ä¸­å¤„ç† Mapã€‚\nâ­ï¸ éå†æ–¹å¼ Java éå† Mapï¼Œè¦ä¹ˆå°±æ˜¯éå†å®ƒçš„ Map.Entry\u0026lt;K,V\u0026gt; \u0026lt;- entrySet()ï¼Œè¦ä¹ˆå°±æ˜¯éå†å®ƒçš„ key KeySet \u0026lt;- keySet()ã€‚ä¸»è¦å¯ä»¥ç”¨ä¸‹é¢å››ç§æ–¹å¼éå†ï¼š\nIterator\nForEach\nLambda\nStream\né™¤éç‰¹æ®Šéœ€è¦ï¼Œå°½é‡ä½¿ç”¨å 3 ç§éå†æ–¹å¼ï¼Œä½¿ç”¨ Iterator å¯èƒ½æ›´å®¹æ˜“é€ æˆä¸€äº›é”™è¯¯ï¼ˆEffective Java - 58ï¼šfor-each ä¼˜å…ˆäº for å¾ªç¯ï¼‰ã€‚\nåœ¨ä¸€äº› for-each ä¸èƒ½èƒœä»»çš„åœ°æ–¹ï¼Œå…¶å®ä¹Ÿæœ‰å¾ˆå¯¹å†…ç½®æ–¹æ³•èƒ½å¤Ÿå®Œæˆæ“ä½œï¼Œä¸ä»…æ›´åŠ ç›´è§‚ï¼Œè€Œä¸”éå¸¸æ˜“ç”¨ã€‚æ¯”å¦‚åˆ é™¤æ“ä½œï¼šCollection#removeIf() Java 1.8+ã€‚\nForEach EntrySet 1 2 3 4 for (Map.Entry\u0026lt;String, String\u0026gt; entry : map.entrySet()) { String key = entry.getKey(); String value = entry.getValue(); } KeySet 1 2 3 for (String key : map.keySet()) { String value = map.get(key); } Lambda 1 2 3 4 map.forEach((key, value) -\u0026gt; { // key // value }) 1 2 3 4 5 public class HashMap\u0026lt;K,V\u0026gt; extends AbstractMap\u0026lt;K,V\u0026gt; implements Map\u0026lt;K,V\u0026gt;, Cloneable, Serializable { @Override public void forEach(Biconsumer\u0026lt;? super K, ? super V\u0026gt; action) { } } Stream Steram 1 2 3 4 map.entrySet().stream().forEach((entry) -\u0026gt; { String key = entry.getKey(); String value = entry.getValue(); }) parallelStream 1 2 3 4 map.entrySet().parallelStream().forEach((entry) -\u0026gt; { String key = entry.getKey(); String value = entry.getValue(); }) Interator EntrySet 1 2 3 4 5 6 7 Iterator\u0026lt;Map.Entry\u0026lt;String, String\u0026gt;\u0026gt; iterator = map.entrySet().iterator(); while(iterator.hasNext()) { Map.Entry\u0026lt;String, String\u0026gt; entry = iterator.next(); String key = entry.getKey(); String value = entry.getValue(); } æ ¹æ® Effective Java - 57ï¼Œæ›´æ¨èä»¥ä¸‹è¿™ç§å†™æ³•ï¼š\n1 2 3 4 5 for (Iterator\u0026lt;Map.Entry\u0026lt;String, String\u0026gt;\u0026gt; iterator = map.entrySet().iterator(); iterator.hasNext(); ) { Map.Entry\u0026lt;String, String\u0026gt; entry = iterator.next(); String key = entry.getKey(); String value = entry.getValue(); } KeySet 1 2 3 4 for (Iteator\u0026lt;String\u0026gt; iterator = map.keySet().iterator(); iterator.hasNext(); ) { String key = iterator.next(); String value = map.get(key); } ğŸŒŸ ä¸€äº›æ“ä½œ åˆ¤ç©º 1 2 3 4 5 ğŸ™‹â€â™‚ï¸ map.isEmpty(); ğŸ™…â€â™‚ï¸ boolean b = map.size() == 0; è®¡æ•° / merge() 1 2 public V merge(K key, V value, BiFunction\u0026lt;? super V, ? super V, ? extends V\u0026gt; remappingFunction) { } 1 map.merge(key, 1, Integer::sum); removeIf() ğŸš§ æ³¨æ„ï¼š\nMap æœ¬èº«æ˜¯æ²¡æœ‰ removeIf()ã€‚\n1 2 3 map.entrySet().removeIf(entry -\u0026gt; {}); map.keySet().removeIf(key -\u0026gt; {}); map.values().removeIf(value -\u0026gt; {}); absent 1 public V putIfAbsent(K key, V value); 1 2 3 4 5 6 7 // ä¸å­˜åœ¨ key æ—¶ï¼ŒæŒ‰ mappingFunction æ·»åŠ  value // å­˜åœ¨ key ä¸æ”¹å˜ public V computeIfAbsent(K key, Function\u0026lt;? super K, ? extends V\u0026gt; mappingFunction) { } public V computeIfPresent(K key, BiFunction\u0026lt;? super K, ? super V, ? extends V\u0026gt; remappingFunction) { } default 1 map.getOrDefault(key, 0); ğŸ”— å‚è€ƒ https://mp.weixin.qq.com/s/zQBN3UvJDhRTKP6SzcZFKw ","date":"2021-10-28T21:14:45+08:00","image":"https://emerywan.github.io/blog/imgs/11.jpeg","permalink":"https://emerywan.github.io/blog/p/java-map-traversal/","title":"Java Map æ“ä½œ"},{"content":"PyTorch æ˜¯ä»€ä¹ˆï¼Ÿ åŸºäº Python çš„ç§‘å­¦è®¡ç®—åŒ…ï¼ŒæœåŠ¡äºä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼š\nNumpy çš„æ›¿ä»£å“ï¼Œå¯ä»¥ä½¿ç”¨ GPU çš„å¼ºå¤§è®¡ç®—åŠ› æä¾›æœ€å¤§çš„çµæ´»æ€§å’Œé«˜é€Ÿçš„æ·±åº¦å­¦ä¹ ç ”ç©¶å¹³å° Tensors Tensors ä¸ Numpy ä¸­çš„ ndarrays ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ PyTorch ä¸­ Tensors å¯ä»¥ä½¿ç”¨ GPU è¿›è¡Œè®¡ç®—ã€‚\n1 2 from __future__ import print_function import torch [ 1 ] åˆ›å»ºä¸€ä¸ª 5x3 çš„çŸ©é˜µï¼Œä½†ä¸åˆå§‹åŒ–ï¼š\n1 2 3 4 5 6 7 x = torch.empty(5, 3) print(x) # tensor([[0.0000, 0.0000, 0.0000], # [0.0000, 0.0000, 0.0000], # [0.0000, 0.0000, 0.0000], # [0.0000, 0.0000, 0.0000], # [0.0000, 0.0000, 0.0000]]) [ 2 ] åˆ›å»ºä¸€ä¸ªéšæœºåˆå§‹åŒ–çš„çŸ©ï¼š\n1 2 3 4 5 6 7 x = torch.rand(5, 3) print(x) # tensor([[0.6972, 0.0231, 0.3087], # [0.2083, 0.6141, 0.6896], # [0.7228, 0.9715, 0.5304], # [0.7727, 0.1621, 0.9777], # [0.6526, 0.6170, 0.2605]]) [ 3 ] åˆ›å»ºä¸€ä¸ª 0 å¡«å……çš„çŸ©é˜µï¼Œæ•°æ®ç±»å‹ä¸º longï¼š\n1 2 3 4 5 6 7 x = torch.zero(5, 3, dtype=torch.long) print(x) # tensor([[0, 0, 0], # [0, 0, 0], # [0, 0, 0], # [0, 0, 0], # [0, 0, 0]]) [ 4 ] åˆ›å»ºä¸€ä¸ª tensor ä½¿ç”¨ç°æœ‰æ•°æ®åˆå§‹åŒ–ï¼š\n1 2 3 4 5 x = torch.tensor( [5.5, 3] ) print(x) # tensor([5.5000, 3.0000]) [ 5 ] æ ¹æ®ç°æœ‰çš„ tensor åˆ›å»º tensorã€‚è¿™äº›æ–¹æ³•å°†é‡ç”¨è¾“å…¥ tensor çš„å±æ€§ï¼ˆå¦‚ï¼šdtypeï¼Œé™¤éè®¾ç½®æ–°çš„å€¼è¿›è¡Œè¦†ç›–ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ©ç”¨ new_* æ–¹æ³•åˆ›å»ºå¯¹è±¡ x = x.new_ones(5, 3, dtype=torch.double) print(x) # tensor([[1., 1., 1.], # [1., 1., 1.], # [1., 1., 1.], # [1., 1., 1.], # [1., 1., 1.]], dtype=torch.float64) # è¦†ç›– dtype # å¯¹è±¡ size ç›¸åŒï¼Œåªæ˜¯ å€¼å’Œç±»å‹ å‘ç”Ÿå˜åŒ– print(x) # tensor([[ 0.5691, -2.0126, -0.4064], # [-0.0863, 0.4692, -1.1209], # [-1.1177, -0.5764, -0.5363], # [-0.4390, 0.6688, 0.0889], # [ 1.3334, -1.1600, 1.8457]]) [ 6 ] è·å– sizeï¼š\n1 2 print(x.size()) # torch.Size([5, 3]) Tip:\ntorch.Size è¿”å› tuple ç±»å‹ï¼Œæ”¯æŒ tuple ç±»å‹æ‰€æœ‰çš„æ“ä½œã€‚\n[ 7 ] æ“ä½œ\n[ 7.1 ] åŠ æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 y = torch.rand(5, 3) print(x+y) # tensor([[ 0.7808, -1.4388, 0.3151], # [-0.0076, 1.0716, -0.8465], # [-0.8175, 0.3625, -0.2005], # [ 0.2435, 0.8512, 0.7142], # [ 1.4737, -0.8545, 2.4833]]) print(torch.add(x, y)) # tensor([[ 0.7808, -1.4388, 0.3151], # [-0.0076, 1.0716, -0.8465], # [-0.8175, 0.3625, -0.2005], # [ 0.2435, 0.8512, 0.7142], # [ 1.4737, -0.8545, 2.4833]]) æä¾›è¾“å‡º tensor ä½œä¸ºå‚æ•°ï¼š\n1 2 3 4 5 6 7 8 result = torch.empty(5, 3) torch.add(x, y, out=result) print(result) # tensor([[ 0.7808, -1.4388, 0.3151], # [-0.0076, 1.0716, -0.8465], # [-0.8175, 0.3625, -0.2005], # [ 0.2435, 0.8512, 0.7142], # [ 1.4737, -0.8545, 2.4833]]) [ 7.2 ] æ›¿æ¢ï¼š\n1 2 3 4 5 6 7 8 # add x to y y.add_(x) print(y) # tensor([[ 0.7808, -1.4388, 0.3151], # [-0.0076, 1.0716, -0.8465], # [-0.8175, 0.3625, -0.2005], # [ 0.2435, 0.8512, 0.7142], # [ 1.4737, -0.8545, 2.4833]]) {% note info %} _ ç»“å°¾çš„æ“ä½œä¼šæ›¿æ¢åŸå˜é‡ã€‚ å¦‚ï¼šx_copy_(y)ï¼Œx.t_() ä¼šæ”¹å˜ x {% endnote %}\n[ 7.3 ] ä½¿ç”¨ Numpy ä¸­ç´¢å¼•æ–¹å¼ï¼Œå¯¹ tensor è¿›è¡Œæ“ä½œï¼š\n1 2 print(x[:, 1]) # tensor([-2.0126, 0.4692, -0.5764, 0.6688, -1.1600]) [ 8 ] torch.view æ”¹å˜ tensor çš„ç»´åº¦å’Œå¤§å° ï¼ˆä¸ Numpy ä¸­ reshape ç±»ä¼¼ï¼‰ï¼š\n1 2 3 4 5 6 x = torch.randn(4, 4) y = x.view(16) z = x.view(-1, 8) # -1 ä»å…¶ä»–ç»´åº¦æ¨æ–­ print(x.size(), y.size(), z.size()) # torch.Size([4, 4]) torch.Size([16]) torch.Size([2, 8]) [ 9 ] å¦‚æœåªæœ‰ä¸€ä¸ªå…ƒç´ çš„ tensorï¼Œä½¿ç”¨ item() è·å– Python æ•°æ®ç±»å‹çš„æ•°å€¼ï¼š\n1 2 3 4 5 x = torch.randn(1) print(x) print(x.item()) # tensor([-0.2368]) # -0.23680149018764496 Numpy è½¬æ¢ Torch Tensor ä¸ Numpy æ•°ç»„ä¹‹é—´è¿›è¡Œè½¬æ¢éå¸¸è½»æ¾ã€‚\n1 2 3 4 5 a = torch.ones(5) b = a.numpy() print(a) # tensor([1., 1., 1., 1., 1.]) print(b) # [1. 1. 1. 1. 1.] Torch Tensor ä¸ Numpy æ•°ç»„å…±äº«åº•å±‚å†…å­˜åœ°å€ï¼Œä¿®æ”¹ä¸€ä¸ªä¼šå¯¼è‡´å¦ä¸€ä¸ªçš„å˜åŒ–ã€‚\n1 2 3 4 a.add_(1) print(a) # tensor([2., 2., 2., 2., 2.]) print(b) # [2. 2. 2. 2. 2.] 1 2 3 4 5 6 7 import numpy as np a = np.ones(5) b = torch.from_numpy(a) np.add(a, 1, out=a) print(a) # [2. 2. 2. 2. 2.] print(b) # tensor([2., 2., 2., 2., 2.], dtype=torch.float64) Tip:\næ‰€æœ‰çš„ Tensor ç±»å‹é»˜è®¤éƒ½æ˜¯åŸºäº CPUï¼Œ CharTensor ç±»å‹ä¸æ”¯æŒåˆ° Numpy çš„è£…æ¢ã€‚\nCUDA å¼ é‡ ä½¿ç”¨ .to() å¯ä»¥å°† Tensor ç§»åŠ¨åˆ°ä»»ä½•è®¾å¤‡ä¸­ã€‚\n1 2 3 4 5 6 7 if torch.cuda.is_available(): device = torch.device(\u0026#39;cuda\u0026#39;) # CUDA è®¾å¤‡å¯¹è±¡ y = torch.ones_like(x, device=device) # ç›´æ¥ä» GPU åˆ›å»ºå¼ é‡ x = x.to(device) z = x + y print(z) # tensor([0.7632], device=\u0026#39;cuda:0\u0026#39;) print(z.to(\u0026#39;cpu\u0026#39;, torch.double)) # tensor([0.7632], dtype=torch.float64) Autograd è‡ªåŠ¨æ±‚å¯¼ autograd åŒ…ä¸º Tensor ä¸Šæ‰€æœ‰çš„æ“ä½œæä¾›äº†è‡ªåŠ¨æ±‚å¯¼ã€‚å®ƒæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å®šä¹‰çš„æ¡†æ¶ï¼Œè¿™æ„å‘³ç€åå‘ä¼ æ’­æ˜¯æ ¹æ®ä½ çš„ä»£ç æ¥ç¡®å®šå¦‚ä½•è¿è¡Œï¼Œå¹¶ä¸”æ¯æ¬¡è¿­ä»£å¯ä»¥æ˜¯ä¸åŒçš„ã€‚\næ­£å‘ä¼ æ’­ åå‘ä¼ æ’­ ç¥ç»ç½‘ç»œï¼ˆNNï¼‰æ˜¯åœ¨æŸäº›è¾“å…¥æ•°æ®ä¸Šæ‰§è¡ŒåµŒå¥—å‡½æ•°çš„é›†åˆã€‚ è¿™äº›å‡½æ•°ç”±å‚æ•°ï¼ˆæƒé‡å’Œåå·®ç»„æˆï¼‰å®šä¹‰ï¼Œå‚æ•°åœ¨ PyTorch ä¸­å­˜å‚¨åœ¨å¼ é‡ä¸­ã€‚\nè®­ç»ƒ NN åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š\næ­£å‘ä¼ æ’­ï¼šåœ¨æ­£å‘ä¼ æ’­ä¸­ï¼ŒNN å¯¹æ­£ç¡®çš„è¾“å‡ºè¿›è¡Œæœ€ä½³çŒœæµ‹ã€‚å®ƒé€šè¿‡æ¯ä¸ªå‡½æ•°è¿è¡Œè¾“å…¥æ•°æ®ä»¥è¿›è¡ŒçŒœæµ‹ã€‚ åå‘ä¼ æ’­ï¼šåœ¨åå‘ä¼ æ’­ä¸­ï¼ŒNN æ ¹æ®å…¶çŒœæµ‹ä¸­çš„è¯¯å·®è°ƒæ•´å…¶å‚æ•°ã€‚å®ƒé€šè¿‡ä»è¾“å‡ºå‘åéå†ï¼Œæ”¶é›†æœ‰å…³å‚æ•°ï¼ˆæ¢¯åº¦ï¼‰çš„è¯¯å·®å¯¼æ•°å¹¶ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ¥ä¼˜åŒ–å‚æ•°æ¥å®ç°ã€‚ [ 1 ] æˆ‘ä»¬ä» torchvision åŠ è½½äº†ç»è¿‡é¢„è®­ç»ƒçš„ resnet18 æ¨¡å‹ã€‚åˆ›å»ºä¸€ä¸ªéšæœºæ•°æ®å¼ é‡æ¥è¡¨ç¤ºå…·æœ‰ 3 ä¸ªé€šé“çš„å•ä¸ªå›¾åƒï¼Œé«˜åº¦å’Œå®½åº¦ä¸º 64ï¼Œå…¶å¯¹åº”çš„labelåˆå§‹åŒ–ä¸ºä¸€äº›éšæœºå€¼ã€‚\n1 2 3 4 5 import torch, torchvision model = torchvision.models.resnet18(pretrained=True) data = torch.rand(1, 3, 64, 64) labels = torch.rand(1, 1000) [ 2 ] æ¥ä¸‹æ¥ï¼Œé€šè¿‡æ¨¡å‹çš„æ¯ä¸€å±‚è¿è¡Œè¾“å…¥æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚æ­£å‘ä¼ æ’­ã€‚\n1 prediction = model(data) [ 3 ] ä½¿ç”¨æ¨¡å‹çš„é¢„æµ‹ï¼ˆpredicationï¼‰å’Œç›¸åº”çš„æ ‡ç­¾ï¼ˆlabelsï¼‰æ¥è®¡ç®—è¯¯å·®ï¼ˆlossï¼‰ã€‚ ä¸‹ä¸€æ­¥é€šè¿‡åå‘ä¼ æ’­æ­¤è¯¯å·®ã€‚æˆ‘ä»¬åœ¨ loss tensor ä¸Šè°ƒç”¨ .backward() æ—¶ï¼Œå¼€å§‹åå‘ä¼ æ’­ã€‚Autograd ä¼šä¸ºæ¯ä¸ªæ¨¡å‹å‚æ•°è®¡ç®—æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å‚æ•° .grad å±æ€§ä¸­ã€‚\n1 2 loss = (prediction - labels).sum() loss.backword() # backword pass [ 4 ] æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ è½½ä¸€ä¸ªä¼˜åŒ–å™¨ï¼ˆSDGï¼‰ï¼Œå­¦ä¹ ç‡ä¸º 0.01ï¼ŒåŠ¨é‡ä¸º 0.9ã€‚åœ¨ optim ä¸­æ³¨å†Œæ¨¡å‹çš„æ‰€æœ‰å‚æ•°ã€‚\n1 optim = torch.optim.SDG(model.parameters(), lr=1e-2, momentum=0.9) [ 5 ] æœ€åï¼Œè°ƒç”¨ .step() å¯åŠ¨æ¢¯åº¦ä¸‹é™ã€‚ä¼˜åŒ–å™¨é€šè¿‡ .grad ä¸­å­˜å‚¨çš„æ¢¯åº¦æ¥è°ƒæ•´æ¯ä¸ªå‚æ•°ã€‚\n1 optim.step() # gradient descent ç¥ç»ç½‘ç»œçš„å¾®åˆ† è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ autograd å¦‚ä½•æ”¶é›†æ¢¯åº¦ã€‚ æˆ‘ä»¬åœ¨åˆ›å»º Tensor æ—¶ï¼Œä½¿ç”¨ requires_grad=True å‚æ•°ï¼Œè¡¨ç¤ºå°†è·Ÿè¸ª Tensor çš„æ‰€æœ‰æ“ä½œã€‚\n1 2 3 4 5 6 7 import torch a = torch.tensor([2., 3.], require_grad=True) b = torch.tensor([6., 4.], require_grad=True) # ä» tensor a, b åˆ›å»ºå¦ä¸€ä¸ª tensor Q Q = 3*a**3 - b**2 å‡è®¾ tensor aï¼Œb æ˜¯ç¥ç»ç½‘ç»œçš„å‚æ•°ï¼Œtensor Q æ˜¯è¯¯å·®ã€‚åœ¨ NN è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬æƒ³è¦è·å¾—ç›¸å¯¹äºå‚æ•°çš„è¯¯å·®ï¼Œå³å„è‡ªå¯¹åº”çš„åå¯¼ï¼š\n$$\\frac{\\partial Q}{\\partial a}=9a^2$$\nå½“æˆ‘ä»¬åœ¨ tensor Q ä¸Šè°ƒç”¨ .backward() æ—¶ï¼ŒAutograd å°†è®¡ç®—è¿™äº›æ¢¯åº¦å¹¶å°†å…¶å­˜å‚¨åœ¨å„ä¸ªå¼ é‡çš„ .grad å±æ€§ä¸­ã€‚\næˆ‘ä»¬éœ€è¦åœ¨ Q.backword() ä¸­æ˜¾å¼ä¼ é€’ gradient å‚æ•°ï¼ˆä¸ Q å½¢çŠ¶ç›¸åŒçš„å¼ é‡ï¼Œè¡¨ç¤º Q ç›¸å¯¹æœ¬èº«çš„æ¢¯åº¦ï¼‰ã€‚\n$$\\frac{\\partial Q}{\\partial b}=-2b$$\n1 2 3 4 5 6 7 8 external_grad = torch.tensor([1., 1.]) Q.backward(gradient=external_grad) # æœ€åï¼Œæ¢¯åº¦è®°å½•åœ¨ a.grad b.grad ä¸­ï¼ŒæŸ¥çœ‹æ”¶é›†çš„æ¢¯åº¦æ˜¯å¦æ­£ç¡® print(9*a**2 == a.grad) # tensor([True, True]) print(-2*b == b.grad) # tensor([True, True]) æˆ‘ä»¬ä¹Ÿå¯ä»¥å°† Q èšåˆä¸ºä¸€ä¸ªæ ‡é‡ï¼Œç„¶åéšå¼åœ°å‘åè°ƒç”¨ï¼Œå¦‚ï¼šQ.sum().backward()ã€‚\nç¥ç»ç½‘ç»œ ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬äº†è§£åˆ° nn åŒ…ä¾èµ– autograd åŒ…æ¥å®šä¹‰æ¨¡å‹å¹¶æ±‚å¯¼ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•å®šä¹‰ä¸€ä¸ªç½‘ç»œã€‚ä¸€ä¸ª nn.Module åŒ…å«ä¸ª layer å’Œä¸€ä¸ª forward(input) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å› outputã€‚\nå¦‚ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹æ‰‹å†™æ•°å­—å›¾åƒè¿›è¡Œåˆ†ç±»çš„å·ç§¯ç¥ç»ç½‘ç»œï¼š\nç¥ç»ç½‘ç»œçš„å…¸å‹è®­ç»ƒè¿‡ç¨‹å¦‚ä¸‹ï¼š\nå®šä¹‰åŒ…å«ä¸€äº›å¯å­¦ä¹ çš„å‚æ•°ï¼ˆæƒé‡ï¼‰ç¥ç»ç½‘ç»œæ¨¡å‹ åœ¨æ•°æ®é›†ä¸Šè¿­ä»£ é€šè¿‡ç¥ç»ç½‘ç»œå¤„ç†è¾“å…¥ è®¡ç®—æŸå¤±ï¼ˆè¾“å‡ºç»“æœå’Œæ­£ç¡®å€¼çš„å·®å€¼å¤§å°ï¼‰ å°†æ¢¯åº¦åå‘ä¼ æ’­å›ç½‘ç»œçš„å‚æ•° æ›´æ–°ç½‘ç»œçš„å‚æ•°ï¼ˆæ¢¯åº¦ä¸‹é™ï¼‰ï¼šweight = weight - learning_rate * gradient å®šä¹‰ç½‘ç»œ åœ¨æ¨¡å‹ä¸­å¿…é¡»å®šä¹‰ forward()ï¼Œ backwordï¼ˆç”¨æ¥è®¡ç®—æ¢¯åº¦ï¼‰ä¼šè¢« autograd è‡ªåŠ¨åˆ›å»ºã€‚å¯åœ¨ forward() ä¸­ä½¿ç”¨ä»»ä½•é’ˆå¯¹ Tensor çš„æ“ä½œã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 import torch import torch.nn as nn import torch.nn.functional as F class Net(nn.Model): def __init__(self): super(Net, self).__init__() # 1 input image channel, 6 output channels, 3x3 square convolution # kernel self.conv_1 = nn.Conv2d(1, 6, 3) self.conv_2 = nn.Conv2d(6, 16, 3) # an affine operation: y = Wx + b self.fc1 = nn.Linear(16 * 6 *6, 120) self.fc2 = nn.Linear(120, 84) self.fc3 = nn.Linear(84, 10) def forward(self, x): # Max Pooling over a (2, 2) window x = F.max_pool2d(F.relu(self.conv1(x)), (2, 2)) # If the size is a square you can only specify a single number x = F.max_pool2d(F.relu(self.conv2(x)), 2) x = x.view(-1, self.num_flat_features(x)) x = F.relu(self.fc1(x)) x = F.relu(self.fc2(x)) x = self.fc3(x) return x def num_flat_features(sefl, x): size = x.size()[1: ] # all dimensions except the batch dimension num_features = 1 for s in size: num_features *= s return num_features net = Net() print(net) # Net( # (conv1): Conv2d(1, 6, kernel_size=(3, 3), stride=(1, 1)) # (conv2): Conv2d(6, 16, kernel_size=(3, 3), stride=(1, 1)) # (fc1): Linear(in_features=576, out_features=120, bias=True) # (fc2): Linear(in_features=120, out_features=84, bias=True) # (fc3): Linear(in_features=84, out_features=10, bias=True) # ) parameters() è¿”å›å¯è¢«å­¦ä¹ çš„å‚æ•°ï¼ˆæƒé‡ï¼‰åˆ—è¡¨å’Œå€¼\n1 2 3 4 params = list(net.parameters()) print(len(params)) # 10 print(params[0].size()) # conv1 çš„ weight torch.Size([6, 1, 3, 3]) æµ‹è¯•éšæœºè¾“å…¥ 32x32ã€‚æ³¨ï¼šè¿™ä¸ªç½‘ç»œï¼ˆLeNetï¼‰çš„æœŸæœ›çš„è¾“å…¥å¤§å°æ˜¯ 32x32ï¼Œå¦‚æœä½¿ç”¨ MINIST æ•°æ®é›†æ¥è®­ç»ƒè¿™ä¸ªç½‘ç»œï¼Œè¯·æŠŠå›¾ç‰‡å¤§å°é‡æ–°è°ƒæ•´åˆ° 32x32ã€‚\n1 2 3 4 5 input = torch.randn(1, 1, 32, 32) out = net(input) print(out) # tensor([[ 0.1120, 0.0713, 0.1014, -0.0696, -0.1210, 0.0084, -0.0206, 0.1366, # -0.0455, -0.0036]], grad_fn=\u0026lt;AddmmBackward\u0026gt;) å°†æ‰€æœ‰çš„å‚æ•°çš„æ¢¯åº¦ç¼“å­˜æ¸…é›¶ï¼Œè¿›è¡Œéšæœºæ¢¯åº¦çš„åå‘ä¼ æ’­ã€‚\n1 2 net.zero_grad() out.backward(torch.randn(1, 10)) Tip:\ntorch.nn ä»…æ”¯æŒå°æ‰¹é‡è¾“å…¥ã€‚æ•´ä¸ª torch.nn åŒ…éƒ½åªæ”¯æŒå°æ‰¹é‡æ ·æœ¬ï¼Œè€Œä¸æ”¯æŒå•ä¸ªæ ·æœ¬ã€‚ å¦‚ï¼šnn.Conv2dæ¥å—ä¸€ä¸ª4ç»´ Tensorï¼Œåˆ†åˆ«ç»´ sSamples * nChannels * Height * Width ï¼ˆæ ·æœ¬æ•°* é€šé“æ•° * é«˜ * å®½ï¼‰ã€‚å¦‚æœä½ æœ‰å•ä¸ªæ ·æœ¬ï¼Œåªéœ€è¦ä½¿ç”¨ input.unsqueeze(0) æ¥æ·»åŠ å…¶ä»–çš„ç»´æ•°ã€‚\nè‡³æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº†å¦‚ä½•æ„å»ºä¸€ä¸ªç½‘ç»œï¼Œå›é¡¾ä¸€ä¸‹åˆ°ç›®å‰ä¸ºæ­¢ä½¿ç”¨åˆ°çš„ç±»ã€‚\ntorch.Tensorï¼š ä¸€ä¸ªå¤šç»´æ•°ç»„ã€‚ æ”¯æŒä½¿ç”¨ backward() è¿›è¡Œè‡ªåŠ¨æ¢¯åº¦è®¡ç®—ï¼Œå¹¶ä¿å­˜å…³äºè¿™ä¸ªå‘é‡çš„æ¢¯åº¦ w.r.t.\nnn.Modelï¼š ç¥ç»ç½‘ç»œæ¨¡å—ã€‚å®ç°å°è£…å‚æ•°ã€ç§»åŠ¨åˆ° GPU ä¸Šè¿è¡Œã€å¯¼å‡ºã€åŠ è½½ç­‰ã€‚\nnn.Parameterï¼š ä¸€ç§å¼ é‡ã€‚å°†å…¶åˆ†é…ä¸º Model çš„å±æ€§æ—¶ï¼Œè‡ªåŠ¨æ³¨å†Œä¸ºå‚æ•°ã€‚\nautograd.Functionï¼š å®ç°ä¸€ä¸ªè‡ªåŠ¨æ±‚å¯¼æ“ä½œçš„å‰å‘å’Œåå‘å®šä¹‰ã€‚æ¯ä¸ª Tensor æ“ä½œéƒ½ä¼šåˆ›å»ºè‡³å°‘ä¸€ä¸ª Function èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹è¿æ¥åˆ°åˆ›å»º Tensor çš„å‡½æ•°ï¼Œå¹¶ç¼–ç å…¶å†å²è®°å½•ã€‚\næŸå¤±å‡½æ•° 1 2 3 4 5 6 7 8 9 output = net(input) target = torch.randn(10) # ä¾‹å­ï¼šä¸€ä¸ªå‡è®¾çš„ç»“æœ target = target.view(1, -1) # è®© target ä¸ output çš„å½¢çŠ¶ç›¸åŒ criterion = nn.MSELoss() loss = criterion(output, target) print(loss) åå‘ä¼ æ’­ è¦å®ç°åå‘ä¼ æ’­è¯¯å·®ï¼Œåªéœ€è¦ loss.backward()ã€‚ ä½†æ˜¯ï¼Œéœ€è¦æ¸…é™¤ç°æœ‰çš„æ¢¯åº¦ï¼Œå¦åˆ™æ¢¯åº¦å°†ç´¯ç§¯åˆ°ç°æœ‰çš„æ¢¯åº¦ä¸­ã€‚\n1 2 3 4 5 6 7 net.zero_grad() # å°†æ‰€æœ‰çš„æ¢¯åº¦ç¼“å†²å½’é›¶ print(net.conv1.bias.grad) # conv1.bias.grad åå‘ä¼ æ’­å‰ tensor([0., 0., 0., 0., 0., 0.]) loss.backward() print(net.conv1.bias.grad) # åå‘ä¼ æ’­å tensor([0.0111, -0.0064, 0.0053, -0.0047, 0.0026, -0.0153]) æ›´æ–°æƒé‡ åœ¨ä½¿ç”¨ PyTorch æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ torch.optim ä¸­æä¾›çš„æ–¹æ³•è¿›è¡Œæ¢¯åº¦ä¸‹é™ã€‚å¦‚ï¼šSDGï¼ŒNesterov-SDGï¼ŒAdamï¼ŒRMSprop ç­‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 import torch.optim as optim # åˆ›å»ºä¸€ä¸ª optimizer optimizer = optim.SDG(net.parameters(), lr=0.01) # åœ¨è®­ç»ƒä¸­å¾ªç¯ optimizer.zero_grad() # å°†æ¢¯åº¦ç¼“å†²åŒºæ¸…é›¶ output = net(input) loss = criterion(output, target) loass.backword() optimizer.step() # æ›´æ–° è®­ç»ƒåˆ†ç±»å™¨ æ•°æ®ä»å“ªé‡Œæ¥ï¼Ÿ é€šå¸¸ï¼Œéœ€è¦å¤„ç†å›¾åƒã€æ–‡æœ¬ã€éŸ³é¢‘æˆ–è§†é¢‘æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å°†æ•°æ®åŠ è½½åˆ° NumPy æ•°ç»„ä¸­çš„æ ‡å‡† Python åŒ…ï¼Œå†å°†è¯¥æ•°å€¼è½¬æ¢ä¸º torch.*Tensorã€‚\nå¤„ç†å›¾åƒï¼Œå¯ä»¥ä½¿ç”¨ Pillowï¼ŒOpenCV å¤„ç†éŸ³é¢‘ï¼Œå¯ä»¥ä½¿ç”¨ SciPyï¼Œlibrosa å¤„ç†æ–‡æœ¬ï¼Œå¯åŸºäº Python æˆ– Cython çš„åŸå§‹åŠ è½½ï¼Œæˆ– NLTK å’Œ SpaCy å¯¹äºå›¾åƒä»»åŠ¡ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ª torchvision çš„åŒ…ï¼Œå«æœ‰å¸¸è§çš„æ•°æ®é›†ï¼ˆImagenetï¼ŒCIFAR10ï¼ŒMNISTç­‰ï¼‰çš„æ•°æ®åŠ è½½å™¨ï¼Œä»¥åŠç”¨äºå›¾åƒçš„æ•°æ®è½¬æ¢å™¨ï¼ˆtorchvision.datasets å’Œ torch.utils.data.DataLoaderï¼‰ã€‚\nåœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œå°†ä½¿ç”¨ CIFAR10 æ•°æ®é›†ã€‚å…¶ä¸­åŒ…å« 10 åˆ†ç±»çš„å›¾åƒï¼šâ€œé£æœºâ€ï¼Œâ€œæ±½è½¦â€ï¼Œâ€œé¸Ÿâ€ï¼Œâ€œçŒ«â€ï¼Œâ€œé¹¿â€ï¼Œâ€œç‹—â€ï¼Œâ€œé’è›™â€ï¼Œâ€œé©¬â€ï¼Œâ€œèˆ¹â€ï¼Œâ€œå¡è½¦â€ã€‚å›¾åƒçš„å°ºå¯¸ä¸º 3 * 32 * 32ï¼Œå³å°ºå¯¸ä¸º 32 * 32 åƒç´ çš„ 3 é€šé“å½©è‰²å›¾åƒã€‚\næ¥ä¸‹æ¥ï¼Œä½œä¸ºæ¼”ç¤ºï¼Œå°†æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ­¥éª¤è®­ç»ƒå›¾åƒåˆ†ç±»å™¨ï¼š\nä½¿ç”¨ torchvision åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10 è®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›† å®šä¹‰ CNN å®šä¹‰æŸå¤±å‡½æ•° æ ¹æ®è®­ç»ƒæ•°æ®è®­ç»ƒç½‘ç»œ åœ¨æµ‹è¯•æ•°æ®ä¸Šæµ‹è¯•ç½‘ç»œ åŠ è½½å¹¶æ ‡å‡†åŒ– CIFAR10 1 2 3 import torch import torchvision import torchvision.transforms as transforms torchvision çš„è¾“å‡ºæ˜¯ [0, 1] çš„ PILImage å›¾åƒï¼Œæˆ‘ä»¬è¦æŠŠå®ƒè½¬æ¢ä¸ºå½’ä¸€åŒ–èŒƒå›´ä¸º [-1, 1] çš„å¼ é‡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 transform = transforms.Compose( [transforms.ToTensor(), transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))] ) trainset = torchvision.datasets.CIFAR10(root=\u0026#39;./data\u0026#39;, train=True, download=True, transform=transform) trainloader = torch.utils.data.DataLoader(trainset, batch_size=4, shuffle=True, num_workers=2) testset = trochvision.datasets.CIFAR10(root=\u0026#39;./data\u0026#39;, train=False, download=True, transform=transform) testloader = torch.utils.data.DataLoader(testset, barch_size=4, shuffle=False, num_workers=2) classes = (\u0026#39;plane\u0026#39;, \u0026#39;car\u0026#39;, \u0026#39;bird\u0026#39;, \u0026#39;cat\u0026#39;, \u0026#39;deer\u0026#39;, \u0026#39;dog\u0026#39;, \u0026#39;frog\u0026#39;, \u0026#39;horse\u0026#39;, \u0026#39;ship\u0026#39;, \u0026#39;truck\u0026#39;) å®šä¹‰ CNN 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 import torch.nn as nn import torch.nn.functional as F class Net(nn.Module): def __init__(self): super(Net, self).__init__() # in_channels, out_channels, kernel_size # è¾“å…¥çš„ä¸º 3 é€šé“å›¾åƒï¼Œæå– 6 ä¸ªç‰¹å¾ï¼Œå¾—åˆ° 6 ä¸ª feature mapï¼Œå·ç§¯æ ¸ä¸ºä¸€ä¸ª 5*5 çš„çŸ©é˜µ self.conv1 = nn.Conv2d(3, 6, 5) self.pool = nn.MaxPool2d(2, 2) self.conv2 = nn.Conv2d(6, 16, 5) # å·ç§¯å±‚è¾“å‡ºäº† 16 ä¸ª feature mapï¼Œæ¯ä¸ª feature map æ˜¯ 6*6 çš„äºŒç»´æ•°æ® self.fc1 = nn.Linear(16 * 5 * 5, 120) self.fc2 = nn.Linear(120, 84) self.fc3(84, 10) def forward(self, x): x = self.pool(F.relu(self.conv1(x))) x = self.pool(F.relu(self.conv2(x))) x = x.view(-1, 16 * 5 * 5) x = F.relu(self.fc1(x)) x = F.relu(self.fc2(x)) x = self.fc3(x) return x net = Net(s) å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº¤å‰ç†µä½œä¸ºæŸå¤±å‡½æ•°ï¼Œä½¿ç”¨å¸¦åŠ¨é‡çš„éšæœºæ¢¯åº¦ä¸‹é™ã€‚\n1 2 3 4 import torch.optim as optim criterion = nn.CrossEntropyLoss() optimizer = optim.SDG(net.parameters(), lr=0.001, momentum=0.9) è®­ç»ƒç½‘ç»œ æ¥ä¸‹æ¥ï¼Œåªéœ€è¦åœ¨è¿­ä»£æ•°æ®ï¼Œå°†æ•°æ®è¾“å…¥ç½‘ç»œä¸­å¹¶ä¼˜åŒ–ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 for epoch in range(2): running_loss = 0.0 for i, data in enumerate(trainloader, 0): inputs, labels = data # è·å–è¾“å…¥ optimizer.zero_grad() # å°†æ¢¯åº¦ç¼“å†²åŒºæ¸…é›¶ outputs = net(inputs) # æ­£å‘ä¼ æ’­ loss = criterion(outputs, lables) loss.backward() # åå‘ä¼ æ’­ optimizer.step() # ä¼˜åŒ– running_loss += loss.item() if i % 2000 == 1999: # æ¯ 2000 æ‰¹æ¬¡æ‰“å°ä¸€æ¬¡ print(\u0026#39;[]\u0026#39; % (epoch+1, i+1, running_loss / 2000)) running_loss = 0.0 åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ•°æ® åœ¨ä¸Šé¢çš„è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬è®­ç»ƒäº† 2 æ¬¡ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦æ£€æµ‹ç½‘ç»œæ˜¯å¦ä»æ•°æ®é›†ä¸­å­¦ä¹ åˆ°äº†æœ‰ç”¨çš„ä¸œè¥¿ã€‚é€šè¿‡é¢„æµ‹ç¥ç»ç½‘ç»œè¾“å‡ºçš„ç±»åˆ«æ ‡ç­¾ä¸å®é™…æƒ…å†µæ ‡ç­¾å¯¹æ¯”è¿›è¡Œæ£€æµ‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 corrent = 0 total = 0 with torch.no_grad(): for data in testloader: images, lobels = data outputs = net(images) _, predicted = torch.max(outputs.data, 1) total += labels.size(0) corrent += (predicted == labels).sum().item() print(\u0026#39;Accuracy of the network on the 10000 test images: %d %%\u0026#39; % (100 *corrent / total)) # Accuracy of the network on the 10000 test images: 9% åœ¨è®­ç»ƒä¸¤æ¬¡çš„ç½‘ç»œä¸­ï¼Œéšæœºé€‰æ‹©çš„æ­£ç¡®ç‡ä¸º 10%ã€‚ç½‘ç»œä¼¼ä¹å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ã€‚\né‚£è¿™ä¸ªç½‘ç»œï¼Œè¯†åˆ«å“ªä¸€ç±»å¥½ï¼Œå“ªä¸€ç±»ä¸å¥½å‘¢ï¼Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 class_corrent = list(0. for i in range(10)) class_total = list(0. for i in range(10)) with torch.no_grad(): for data in testloader: images, labels = data outputs = net(images) _, predicted = torch.max(outputs, 1) c = (predicted == labels).squeeze() for i in range(4): label = labels[i] class_correct[label] += c[i].item() class_total[label] += 1 for i in range(10): print(\u0026#39;Accuracy of %5s : %2d %%\u0026#39; % (classes[i], 100 * class_correct[i] / class_total[i])) # Accuracy of plane : 99 % # Accuracy of car : 0 % # Accuracy of bird : 0 % # Accuracy of cat : 0 % # Accuracy of deer : 0 % # Accuracy of dog : 0 % # Accuracy of frog : 0 % # Accuracy of horse : 0 % # Accuracy of ship : 0 % # Accuracy of truck : 0 % ä½¿ç”¨ GPU ä¸å°† tensor ç§»åˆ° GPU ä¸Šä¸€æ ·ï¼Œç¥ç»ç½‘ç»œä¹Ÿå¯ä»¥ç§»åŠ¨åˆ° GPU ä¸Šã€‚ å¦‚æœå¯ä»¥ä½¿ç”¨ CUDAï¼Œå°†è®¾å¤‡å®šä¹‰ä¸ºç¬¬ä¸€ä¸ª cuda è®¾å¤‡ï¼š\n1 2 3 4 device = torch.device(\u0026#39;cuda:0\u0026#39; if torch.cuda.is_available() else \u0026#39;cpu\u0026#39;) print(device) # cuda:0 å¤åˆ¶ nn å’Œ tensor åˆ° GPU ä¸Šã€‚\n1 2 3 model = net.to(device) inputs, labels = data[0].to(device), data[1].to(device) Tip:\nä½¿ç”¨ .to(device) å¹¶æ²¡æœ‰å¤åˆ¶ nn / tensor åˆ° GPU ä¸Šï¼Œè€Œæ˜¯è¿”å›äº†ä¸€ä¸ª copyã€‚éœ€è¦èµ‹å€¼åˆ°ä¸€ä¸ªæ–°çš„å˜é‡ååœ¨ GPU ä¸Šä½¿ç”¨è¿™ä¸ª nn / tensorã€‚\nå‚è€ƒ https://pytorch.apachecn.org/#/docs/1.7/02 ","date":"2021-05-01T21:14:45+08:00","image":"https://emerywan.github.io/blog/imgs/10.jpeg","permalink":"https://emerywan.github.io/blog/p/pytorch-handbook/","title":"PyTorch ç«é€Ÿä¸Šæ‰‹"},{"content":"React Hooks ç®€ä»‹ Hook å«ä¹‰ ç»„ä»¶ç±»å’Œå‡½æ•°ç»„ä»¶ useState ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import React, { useState } from \u0026#39;react\u0026#39;; const Example() { // å£°æ˜äº†ä¸€ä¸ª count çš„ state å˜é‡ï¼Œå¹¶åˆå§‹åŒ–ä¸º 0 // setCount è®¾ç½® state å€¼ count çš„æ–¹æ³• const [count, setCount] = useState(0); // æ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œå°† count çš„å€¼ +1 return ( \u0026lt;\u0026gt; \u0026lt;p\u0026gt;You clicked {count} times\u0026lt;/p\u0026gt; \u0026lt;button onClick={() =\u0026gt; setCount(count + 1)}\u0026gt; Click me \u0026lt;/button\u0026gt; \u0026lt;/\u0026gt; ) } export default Example; è¯­æ³• 1 2 // å£°æ˜ä¸€ä¸ª state å˜é‡ï¼Œå¹¶åŒæ—¶åˆå§‹åŒ– const [state, setState] = useState(initialState) useState è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ state å˜é‡ï¼ŒæŒ‡å‘çŠ¶æ€å½“å‰å€¼ setState æ›´æ–° state å€¼çš„æ–¹æ³• initialState çŠ¶æ€åˆå§‹å€¼å¯ä»¥æ˜¯æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ç­‰ ä¸ç±»ä¸­ä½¿ç”¨ setState å¼‚åŒ ç›¸åŒç‚¹ åœ¨ä¸€æ¬¡æ¸²æŸ“å‘¨æœŸä¸­è°ƒç”¨å¤šæ¬¡ setStateï¼Œæ•°æ®åªæ”¹å˜ä¸€æ¬¡ ä¸åŒç‚¹ ç±»ç»„ä»¶ä¸­ setState ä¸ºåˆå¹¶ å‡½æ•°ç»„ä»¶ä¸­ setState ä¸ºæ›¿æ¢ useEffect useEffect ç”¨æ¥æ‰§è¡Œå‰¯ä½œç”¨ã€‚å¯ä»¥å°† useEffect Hook çœ‹åš componentDidMount, componentDidUpdate, componentWillMount ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„ç»„åˆã€‚\nå¸¸ç”¨åœ¨ï¼š\næœåŠ¡å™¨è¯·æ±‚ è®¿é—®å…ƒç´  dom å…ƒç´  æœ¬åœ°æŒä¹…åŒ–ç¼“å­˜ ç»‘å®š/è§£ç»‘äº‹ä»¶ æ·»åŠ è®¢é˜… è®¾ç½®å®šæ—¶å™¨ è®°å½•æ—¥å¿— ç­‰ useEffect æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¸²æŸ“å®Œæ¯•åæ‰æ‰§è¡Œï¼Œè¯¥å‡½æ•°æœ‰è¦æ±‚ï¼šè¦ä¹ˆè¿”å›ä¸€ä¸ªèƒ½æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¦ä¹ˆå°±ä¸è¿”å›ä»»ä½•å†…å®¹ã€‚\nä¸éœ€è¦æ¸…é™¤çš„ effect åœ¨ React æ›´æ–° DOM ä¹‹åï¼Œæˆ‘ä»¬æƒ³è¿è¡Œä¸€äº›é¢å¤–çš„ä»£ç ã€‚æ¯”å¦‚å‘é€ç½‘ç»œè¯·æ±‚ï¼Œæ‰‹åŠ¨å˜æ›´ DOMï¼Œè®°å½•æ—¥å¿—ï¼Œè¿™äº›éƒ½æ˜¯å¸¸è§çš„æ— éœ€æ¸…é™¤çš„æ“ä½œã€‚ å› ä¸ºæˆ‘ä»¬åœ¨æ‰§è¡Œå®Œè¿™äº›æ“ä½œä¹‹åï¼Œå°±å¯ä»¥å¿½ç•¥ä»–ä»¬äº†ã€‚\nä»¥ä¸‹ä¸ºä½¿ç”¨ class å’Œ Hook éƒ½æ˜¯æ€ä¹ˆå®ç°è¿™äº›å‰¯ä½œç”¨çš„å¯¹æ¯”ã€‚\nä½¿ç”¨ç±»ç»„ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // åœ¨ React æ›´æ–° DOM æ“ä½œåï¼Œç«‹å³æ›´æ–° document çš„ title å±æ€§ class Example extends React.Component { constructor(props) { super(props); this.state = { count: 0 }; } // ç»„ä»¶åŠ è½½æ—¶éœ€è¦æ›´æ–° componentDidMount() { document.title = `You clicked ${this.state.count} times`; } // ç»„ä»¶æ›´æ–°æ—¶éœ€è¦æ›´æ–° componentDidUpdate() { document.title = `You clicked ${this.state.count} times`; } // åœ¨ render() ä¸èƒ½æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚åº”è¯¥åœ¨ react æ›´æ–° DOM åå†æ‰§è¡Œå‰¯ä½œç”¨ã€‚ render() { return ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;You clicked {this.state.count} times.\u0026lt;/p\u0026gt; \u0026lt;button onClick={() =\u0026gt; this.setState({ count: this.state.count + 1})}\u0026gt; click me. \u0026lt;/button\u0026gt; \u0026lt;div/\u0026gt; ) } } ä½¿ç”¨ Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import React, {useState, useEffect} from \u0026#39;react\u0026#39;; export default function Example() { const [count, setCount] = useState(0); useEffect(() =\u0026gt; { // ç»è¿‡æ¸²æŸ“æˆ–æ›´æ–°ï¼Œ DOM æ›´æ–°å®Œæ¯•ä¹‹åï¼Œä¼šè¿è¡Œè¯¥ effect document.title = `You click ${count} times`; }); return ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;You clicked {this.state.count} times.\u0026lt;/p\u0026gt; \u0026lt;button onClick={() =\u0026gt; this.setState({ count: this.state.count + 1})}\u0026gt; click me. \u0026lt;/button\u0026gt; \u0026lt;div/\u0026gt; ); } ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åå’Œæ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šæ‰§è¡Œ useEffectã€‚ä¸” React ä¿è¯æ¯æ¬¡è¿è¡Œ effect çš„åŒæ—¶ï¼ŒDOM å·²ç»æ›´æ–°å®Œæ¯•ã€‚ useEffect æ”¾åœ¨ç»„ä»¶å†…éƒ¨è®©æˆ‘ä»¬å¯ä»¥åœ¨ effect ä¸­ç›´æ¥è®¿é—® state / propsã€‚æˆ‘ä»¬ä¸éœ€è¦ç‰¹æ®Šçš„ API æ¥è¯»å–ã€‚ ä¸ componentDidMount æˆ– componentDidUpdate ä¸åŒï¼Œä½¿ç”¨ useEffect è°ƒåº¦çš„ effect ä¸ä¼šé˜»å¡æµè§ˆå™¨æ›´æ–°å±å¹•ï¼Œè¿™è®©ä½ çš„åº”ç”¨çœ‹èµ·æ¥å“åº”æ›´å¿«ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œeffect ä¸éœ€è¦åŒæ­¥åœ°æ‰§è¡Œã€‚åœ¨ä¸ªåˆ«æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚æµ‹é‡å¸ƒå±€ï¼‰ï¼Œæœ‰å•ç‹¬çš„ useLayoutEffect Hook ä¾›ä½ ä½¿ç”¨ï¼Œå…¶ API ä¸ useEffect ç›¸åŒã€‚ éœ€è¦æ¸…é™¤çš„ effect æœ‰ä¸€äº›å‰¯ä½œç”¨æ˜¯éœ€è¦æ¸…é™¤çš„ï¼Œå¦‚è®¢é˜…å¤–éƒ¨æ•°æ®æºã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ¸…é™¤å·¥ä½œæ˜¯éå¸¸é‡è¦çš„ï¼Œå¯ä»¥é˜²æ­¢å¼•èµ·å†…å­˜æ³„éœ²ï¼\nä½¿ç”¨ç±»ç»„ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 class FriendStatus extends React.Component { constructor(props) { super(props); this.state = { isOnline: null }; this.handleStatusChange = this.handleStatusChange.bind(this); } componentDidMount() { ChatAPI.subscribeToFriendStatus( this.props.friend.id, this.handleStatusChange ); } componentDidUpdate () { // ... } componentWillUnmount() { // åœ¨ç»„ä»¶å¸è½½æ—¶ï¼Œå…³é—­è®¢é˜…çš„æ•°æ®æº ChatAPI.unsubscribeFromFriendStatus( this.props.friend.id, this.handleStatusChange ); } handleStatusChange(status) { this.setState({ isOnline: status.isOnline }); } render() { if (this.state.isOnline === null) { return \u0026#39;Loading...\u0026#39;; } return this.state.isOnline ? \u0026#39;Online\u0026#39; : \u0026#39;Offline\u0026#39;; } } ä½¿ç”¨å‡½æ•°ç»„ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import React, {useState, useEffect} from \u0026#39;react\u0026#39;; export default function FriendStatus(props) { const [isOnline, setIsOnline] = useState(null); useEffect(() =\u0026gt; { function handleStatusChange(status) { setIsOnline(status.isOnline); } ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange); // effect å¯é€‰æ¸…é™¤å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œè¿”å›å‡½æ•°ä¸ä¸€å®šéœ€è¦å‘½å return function cleanup() { ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange); }; }); if (isOnline === null) { return \u0026#39;Loading...\u0026#39;; } return isOnline ? \u0026#39;Online\u0026#39; : \u0026#39;Offline\u0026#39;; } React ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œæ¸…é™¤æ“ä½œã€‚ å¤šä¸ª Effect å®ç°å…³æ³¨ç‚¹åˆ†ç¦» ä½¿ç”¨ Hook çš„å…¶ä¸­ä¸€ä¸ªç›®çš„æ˜¯è¦è§£å†³ï¼š class ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ç»å¸¸åŒ…å«ä¸ç›¸å…³é€»è¾‘ï¼Œç›¸å…³é€»è¾‘åˆåˆ†ç¦»åœ¨å‡ ä¸ªä¸åŒçš„æ–¹æ³•ä¸­ã€‚\nå¦‚ä¸‹ä¸ºä¸Šæ–‡ä¸­è®¡æ•°å™¨å’Œå¥½å‹çŠ¶æ€æŒ‡ç¤ºå™¨é€»è¾‘ç»„åˆåœ¨ä¸€èµ·çš„ç»„ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 class FriendStatusWithCounter extends React.Component { constructor(props) { super(props); this.state = { count: 0, isOnline: null }; this.handleStautsChange = this.handleStatusChange.bind(this); } // ç›¸åº”çš„é€»è¾‘è¢«åˆ†é…åœ¨ä¸‰ä¸ªä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ componentDidMount() { // counter document.title = `You clicked ${this.state.count} times`; // friend status ChatAPI.subscribeToFriendStatus( this.props.fried.id, this.handleStatusChange ) } componentDidUpdate() { document.title = `You clicked ${this.state.count} times`; } componentWillUnmount() { ChatAPI.unsubscribeFromFriendStatus( this.props.friend.id, this.handleStatusChange ); } handleStatusChange(status) { this.setState({ isOnline: status.isOnline }); } // ... } è‹¥ä½¿ç”¨ Hookï¼Œå’Œä½¿ç”¨å¤šä¸ª state çš„ Hook ä¸€æ ·ï¼Œé€šè¿‡ä½¿ç”¨å¤šä¸ª effectï¼Œå°†ä¸ç›¸å…³çš„é€»è¾‘åˆ†ç¦»åˆ°ä¸åŒçš„ effect ä¸­ã€‚\nHook å…è®¸æŒ‰ç…§ä»£ç çš„ç”¨é€”è¿›è¡Œåˆ†ç¦»ï¼Œä¸åŒäºç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚å°†æŒ‰ç…§ effect å£°æ˜çš„é¡ºåºä¾æ¬¡è°ƒç”¨ç»„ä»¶ä¸­çš„æ¯ä¸€ä¸ª effectã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 export default const FriendStatusWithCounter = () =\u0026gt; { const [count, setCount] = useState(0); useEffect(() =\u0026gt; { document.title = `You clicked ${this.state.count} times`; }); const [isOneline, useIsOneline] = useState(null); useEffect(() =\u0026gt; { function handleStatusChange(status) { setIsOneline(status.isOneline); } ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange); return () =\u0026gt; { ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange); }; }); // ... } è·³è¿‡ Effect è¿›è¡Œæ€§èƒ½ä¼˜åŒ– åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ componentDidUpdate ä¸­ prevProps å’Œ prevState çš„ props / state çš„å˜åŒ–æ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡ŒæŸäº›å‰¯ä½œç”¨ã€‚\n1 2 3 4 5 componentDidUpdate(prevProps, prevState) { if (prevState.count !== this.state.count) { document.title = `You clicked ${this.state.count} times`; } } åœ¨ Hook ä¸­ï¼Œå¯ä»¥é€šè¿‡å¯¹ useEffect ä¼ é€’æ•°ç»„ä½œä¸ºç¬¬äºŒå¯é€‰å‚æ•°ï¼Œé€šçŸ¥ React è·³è¿‡å¯¹ effect çš„è°ƒç”¨ã€‚\n1 2 3 4 5 useEffect(() =\u0026gt; { document.title = `You clicked ${count} times`; }, [count]); // è¡¨ç¤º count æ›´æ”¹æ—¶ä¼šè¿›è¡Œæ›´æ–° // {... , [5]} å½“ count === 5 æ—¶ï¼Œè·³è¿‡ effect è‹¥åªæƒ³è¿è¡Œä¸€æ¬¡ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ [] ä½œä¸ºç¬¬äºŒå‚æ•°ã€‚ ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ï¼Œeffect å†…éƒ¨çš„ props å’Œ state ä¼šä¸€ç›´æ‹¥æœ‰å…¶åˆå§‹å€¼ã€‚ ä½¿ç”¨è¯¥ä¼˜åŒ–ï¼Œè¯·ç¡®ä¿æ•°ç»„ä¸­åŒ…å«äº†æ‰€æœ‰å¤–éƒ¨ä½œç”¨åŸŸä¸­ä¼šéšæ—¶é—´å˜åŒ–ä¸”åœ¨ effect ä¸­ä½¿ç”¨çš„å˜é‡ï¼Œå¦åˆ™ä»£ç ä¼šç”¨åˆ°å…ˆå‰æ¸²æŸ“ä¸­çš„æ—§å˜é‡ã€‚ æ¯æ¬¡æ›´æ–°çš„æ—¶å€™éƒ½è¦è¿è¡Œ Effect çš„åŸå›  è‡ªå®šä¹‰ Hook è‡ªå®šä¹‰ Hook å¯ä»¥å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ã€‚\nç›®å‰ä¸ºæ­¢ï¼Œåœ¨ React ä¸­æœ‰ä¸¤ç§æµè¡Œçš„æ–¹å¼å…±äº«ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘ï¼š\nrender props é«˜é˜¶ç»„ä»¶ ä½¿ç”¨ Hook å¯ä»¥åœ¨ä¸å¢åŠ ç»„ä»¶çš„æƒ…å†µä¸‹è§£å†³ç›¸åŒçš„é—®é¢˜ã€‚ åˆ›å»ºè‡ªå®šä¹‰ Hook å½“æˆ‘ä»¬æƒ³åœ¨å‡½æ•°é—´å…±äº«é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæå–åˆ°å¦å¤–ä¸€ä¸ªå‡½æ•°ä¸­ã€‚ç”±äºç»„ä»¶å’Œ Hook éƒ½æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ä¹ŸåŒæ ·ä½¿ç”¨äºè¿™ç§æ–¹å¼ã€‚\nè‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åç§°ä»¥ \u0026ldquo;use\u0026rdquo; å¼€å¤´ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–çš„ Hookã€‚\nä»¥ä¸‹æ˜¯æ ¹æ®ä¸Šæ–‡ä¸­ FriendStatus å®ä¾‹ï¼Œæ‰€æå–çš„è‡ªå®šä¹‰ Hookã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import { useState, useEffect } from \u0026#39;react\u0026#39;; // åç§°ä¸€å®šä»¥ use å¼€å¤´ function useFriendStatus(friendID) { const [isOnline, setIsOnline] = useState(null); useEffect(() =\u0026gt; { function handleStatusChange(status) { setIsOnline(status.isOneline); } ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange); return () =\u0026gt; { ChatAPI.unsubcribeFromFriendStatus(friendID, handleStatusChange); }; }); return isOnline; } export default useFriendStatus; åœ¨è¿™ä¸ªè‡ªå®šä¹‰ Hook ä¸­ï¼Œæ²¡æœ‰åŒ…å«ä»»ä½•æ–°å†…å®¹ï¼ˆé€»è¾‘ä¸ç»„ä»¶ä¸­çš„å®Œå…¨ä¸€è‡´ï¼‰\nä½¿ç”¨è‡ªå®šä¹‰ Hook ä¸ç»„ä»¶ä¸€è‡´ï¼Œè¯·ç¡®ä¿åªåœ¨è‡ªå®šä¹‰ Hook çš„é¡¶å±‚æ— æ¡ä»¶åœ°è°ƒç”¨å…¶ä»– Hookã€‚\n1 2 3 4 5 6 7 8 function FriendStatus(props) { const isOnline = useFriendStatus(props.friend.id); if (isOnline === null) { return \u0026#34;Loading...\u0026#34;; } return isOnline ? \u0026#39;Online\u0026#39; : \u0026#39;Offline\u0026#39;; } è¿™æ®µä»£ç ä¸ä¹‹å‰çš„å·¥ä½œæ–¹å¼å®Œå…¨ä¸€æ ·ï¼Œæˆ‘ä»¬åªæ˜¯å°†å‡½æ•°ä¸­éœ€è¦å…±äº«çš„é€»è¾‘æå–åˆ°å•ç‹¬çš„å‡½æ•°ä¸­ã€‚\nè‡ªå®šä¹‰ Hook æ˜¯ä¸€ç§è‡ªç„¶éµå¾ª Hook è®¾è®¡çš„çº¦å®šï¼Œä¸æ˜¯ React çš„ç‰¹æ€§ã€‚ è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ \u0026ldquo;use\u0026rdquo; å¼€å¤´ ä¸åŒç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ Hook ä¸ä¼šå…±äº« stateã€‚ è‡ªå®šä¹‰ Hook æ˜¯é‡ç”¨çŠ¶æ€é€»è¾‘çš„æœºåˆ¶ï¼ˆä¾‹å¦‚è®¾ç½®ä¸ºè®¢é˜…å¹¶å­˜å‚¨å½“å‰å€¼ï¼‰ï¼Œæ¯æ¬¡ä½¿ç”¨è‡ªå®šä¹‰ Hook æ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰ state å’Œå‰¯ä½œç”¨å®Œå…¨éš”ç¦»ã€‚ åœ¨å¤šä¸ª Hook ä¹‹é—´ä¼ é€’ä¿¡æ¯ ç”±äº Hook æœ¬èº«å°±æ˜¯å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // è¿™æ˜¯ä¸€ä¸ªèŠå¤©æ¶ˆæ¯æ¥æ”¶è€…çš„é€‰æ‹©å™¨ï¼Œå®ƒä¼šæ˜¾ç¤ºå½“å‰é€‰å®šçš„å¥½å‹æ˜¯å¦åœ¨çº¿ function ChatRecipientPicker() { // å½“å‰é€‰æ‹©çš„å¥½å‹ ID ä¿å­˜åœ¨ recipientID çŠ¶æ€å˜é‡ä¸­ const [recipientID, setRecipientID] = useState(1); // å½“æ›´æ–° recipientID çŠ¶æ€å˜é‡æ—¶ï¼ŒuseFriendStatus Hook ä¼šå–æ¶ˆè®¢é˜…ä¹‹å‰é€‰ä¸­çš„å¥½å‹ï¼Œå¹¶è®¢é˜…æ–°é€‰ä¸­çš„å¥½å‹çŠ¶æ€ const isRecipientOnline = useFriendStatus(recipientID); return ( \u0026lt;\u0026gt; \u0026lt;Circle color={isRecipientOnline ? \u0026#39;green\u0026#39; : \u0026#39;red\u0026#39;} /\u0026gt; \u0026lt;select // \u0026lt;select\u0026gt; ä¸­é€‰æ‹©å…¶ä»–å¥½å‹æ—¶æ›´æ–° recipientID value={recipientID} onChange={e =\u0026gt; setRecipientID(Number(e.target.value))} \u0026gt; { friendList.map(friend =\u0026gt; ( \u0026lt;option key={friend.id} value={friend.id}\u0026gt; {friend.name} \u0026lt;/option\u0026gt; )) } \u0026lt;/select\u0026gt; \u0026lt;/\u0026gt; ) } æˆ‘ä»¬å°†å½“å‰é€‰æ‹©çš„å¥½å‹ ID ä¿å­˜åœ¨ recipientID çŠ¶æ€å˜é‡ä¸­ï¼Œå¹¶ä¼šåœ¨ç”¨æˆ·ä» \u0026lt;select\u0026gt; ä¸­é€‰æ‹©å…¶ä»–å¥½å‹æ—¶æ›´æ–°è¿™ä¸ª stateã€‚\nç”±äº useState ä¼šæä¾› recipientID çŠ¶æ€å˜é‡çš„æœ€æ–°å€¼ï¼Œå¯ä»¥å°†å®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™è‡ªå®šä¹‰çš„ useFriendStatus Hookã€‚å½“æˆ‘ä»¬é€‰æ‹©ä¸åŒçš„å¥½å‹å¹¶æ›´æ–° recipientID çŠ¶æ€å˜é‡æ—¶ï¼ŒuseFriendStatus Hook ä¼šå–æ¶ˆè®¢é˜…ä¹‹å‰é€‰ä¸­çš„å¥½å‹ï¼Œå¹¶è®¢é˜…æ–°é€‰ä¸­çš„å¥½å‹çŠ¶æ€ã€‚\nHook è§„åˆ™ é¢å¤–çš„ Hook å‚è€ƒ https://juejin.im/post/6844903814349193229 https://juejin.im/post/6844903985338400782 https://www.ruanyifeng.com/blog/2019/09/react-hooks.html https://zh-hans.reactjs.org/docs/hooks-intro.html ","date":"2021-01-28T21:14:45+08:00","image":"https://emerywan.github.io/blog/imgs/9.jpeg","permalink":"https://emerywan.github.io/blog/p/react-hooks/","title":"React Hooks"},{"content":"Ubuntu è€³æœºæ²¡æœ‰å£°éŸ³ ç¬”è®°æœ¬ä½¿ç”¨ Ubuntu æ’æœ‰çº¿è€³æœºåï¼Œå¹¶æ²¡æœ‰ååº”ï¼Œè¯¥å¤–æ”¾è¿˜æ˜¯å¤–æ”¾ã€‚\næ„Ÿè§‰æ˜¯é€‚é…é—®é¢˜ï¼Œwindows ä¸‹æ²¡æœ‰é—®é¢˜ã€‚æ‰¾äº†ä¸€åœˆåŠæ³•ï¼Œåªèƒ½é€šè¿‡è½¯ä»¶æ‰‹åŠ¨åˆ‡æ¢äº†ï¼Œæ•ˆæœè¿˜ä¸é”™ã€‚\n1 sudo apt install pavucontrol å¯ä»¥åœ¨è¿™é‡Œåˆ‡æ¢è¾“å‡ºè®¾å¤‡ï¼š\nåˆ‡æ¢è¾“å…¥è®¾å¤‡ï¼š\n","date":"2021-01-02T02:02:02+08:00","image":"https://emerywan.github.io/blog/imgs/5.jpeg","permalink":"https://emerywan.github.io/blog/p/ubuntu-sound/","title":"Ubuntu è€³æœºæ²¡æœ‰å£°éŸ³"},{"content":"æœºå™¨å­¦ä¹  åŸºæœ¬æœ¯è¯­ å¦‚å›¾æ‰€ç¤ºè¡¨æ ¼ï¼Œæ˜¯é¸¢å°¾èŠ±ï¼ˆlrisï¼‰ç›¸å…³ä¿¡æ¯çš„æ•°æ®ï¼Œå…¶ä¸­ï¼š\næ•°æ®æ•´ä½“ç§°ä¸ºæ•°æ®é›†ï¼ˆdata setï¼‰ æ¯ä¸€è¡Œæ•°æ®ç§°ä¸ºä¸€ä¸ªæ ·æœ¬ï¼ˆsampleï¼‰ æ¯ä¸€åˆ—ï¼ˆé™¤è¡¨æ ¼æœ€åä¸€åˆ—ï¼‰è¡¨è¾¾æ ·æœ¬çš„ä¸€ä¸ªç‰¹å¾ï¼ˆfeatureï¼‰ æœ€åä¸€åˆ—ï¼Œæˆä¸ºæ ‡è®°ï¼ˆlabelï¼‰ å¦‚å›¾æ‰€ç¤ºä¿¡æ¯ï¼Œå…¶ä¸­ è¼ç‰‡é•¿åº¦ã€å®½åº¦ï¼ŒèŠ±ç“£çš„é•¿åº¦ã€å®½åº¦ç§°ä¸º ç‰¹å¾ï¼›æ¯ä¸€è¡Œç‰¹å¾çš„å€¼ç§°ä¸ºç‰¹å¾å‘é‡ï¼ˆæ•°å­¦ä¸Šé€šå¸¸ä¼šå°†å…¶è¡¨ç¤ºä¸ºåˆ—å‘é‡ï¼‰ã€‚\nè‹¥å°†è¯¥å›¾ä¸­çš„æ•°æ®è¡¨ç¤ºä¸ºçŸ©é˜µçš„æ–¹å¼ï¼Œç»“æœå¦‚å›¾ï¼š\né€‰æ‹©ä¸¤ç§é¸¢å°¾èŠ±çš„ç‰¹å¾ä¸ºä¾‹ï¼Œå°†å…¶è¡¨ç¤ºä¸ºå¦‚å›¾çš„äºŒç»´ç©ºé—´ï¼ˆå¤šç»´ç‰¹å¾å°†å…¶è¡¨ç¤ºä¸ºå¤šç»´ç©ºé—´ï¼‰ã€‚\næˆ‘ä»¬å°†è¿™æ ·çš„ç©ºé—´ç§°ä¸º ç‰¹å¾ç©ºé—´ï¼ˆfeature spaceï¼‰ã€‚\nåˆ†ç±»ä»»åŠ¡æœ¬è´¨å°±æ˜¯åœ¨ç‰¹å¾ç©ºé—´åˆ‡åˆ†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨ç‰¹å¾ç©ºé—´ä¸­ï¼Œå°†é¸¢å°¾èŠ±æ ¹æ®ä¸¤ç§ç‰¹å¾åˆ†ä¸ºäº†ä¸¤ç±»ã€‚\næœºå™¨å­¦ä¹ çš„åŸºæœ¬ä»»åŠ¡ æœºå™¨å­¦ä¹ çš„åŸºæœ¬ä»»åŠ¡åŸºæœ¬æœ‰ä¸¤ç±»ï¼Œåˆ†åˆ«ä¸ºï¼š\nåˆ†ç±» å›å½’ åˆ†ç±»ä»»åŠ¡ ä¸€äº›ç®—æ³•åªæ”¯æŒå®ŒæˆäºŒåˆ†ç±»çš„ä»»åŠ¡ å¤šåˆ†ç±»çš„ä»»åŠ¡å¯ä»¥è½¬æ¢æˆäºŒåˆ†ç±»çš„ä»»åŠ¡ ä¸€äº›ç®—æ³•å¤©ç„¶çš„æ”¯æŒå¤šåˆ†ç±»é—®é¢˜ äºŒåˆ†ç±» äºŒåˆ†ç±»é—®é¢˜çš„å¸¸è§å®ä¾‹ï¼š\nåˆ¤æ–­é‚®ä»¶æ˜¯åƒåœ¾é‚®ä»¶ï¼›ä¸æ˜¯åƒåœ¾é‚®ä»¶ åˆ¤æ–­å‘æ”¾ç»™å®¢æˆ·ä¿¡ç”¨å¡æœ‰é£é™©ï¼›æ— é£é™© åˆ¤æ–­ç—…æ‚£è‰¯æ€§è‚¿ç˜¤ï¼›æ¶æ€§è‚¿ç˜¤ åˆ¤æ–­æŸæ”¯è‚¡ç¥¨æ¶¨ï¼›è·Œ å¤šåˆ†ç±» å¤šåˆ†ç±»é—®é¢˜çš„å¸¸è§å®ä¾‹ï¼š\næ•°å­—è¯†åˆ« å›¾åƒè¯†åˆ« åˆ¤æ–­å‘æ”¾ç»™å®¢æˆ·ä¿¡ç”¨å¡çš„é£é™©è¯„çº§ å›´æ£‹æ¸¸æˆç­‰ è‡ªåŠ¨é©¾é©¶è¯†åˆ« å¤šæ ‡ç­¾åˆ†ç±» å¦‚å›¾æ‰€ç¤ºï¼Œä¸ºå¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜çš„å¸¸è§å®ä¾‹ï¼š\nå›å½’ä»»åŠ¡ å›å½’é—®é¢˜çš„ç»“æœä¸åˆ†ç±»é—®é¢˜çš„ç»“æœä¸åŒï¼Œå›å½’é—®é¢˜çš„ç»“æœæ˜¯ä¸€ä¸ªè¿ç»­æ•°å­—çš„å€¼ï¼Œè€Œéä¸€ä¸ªç±»åˆ«ã€‚\nå¸¸è§çš„å›å½’é—®é¢˜æœ‰ï¼š\næˆ¿å±‹ä»·æ ¼ å¸‚åœºåˆ†æ å­¦æœ¯æˆç»© è‚¡ç¥¨ä»·æ ¼ åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œå›å½’ä»»åŠ¡å¯ä»¥ç®€åŒ–æˆåˆ†ç±»ä»»åŠ¡ã€‚\næœºå™¨å­¦ä¹ ç®—æ³•åˆ†ç±» ç›‘ç£å­¦ä¹  ç›‘ç£å­¦ä¹  supervised learning ä¸»è¦å¤„ç†çš„æ˜¯åˆ†ç±»é—®é¢˜å’Œå›å½’é—®é¢˜ã€‚\nç›‘ç£å­¦ä¹ çš„å«ä¹‰æ˜¯ç»™æœºå™¨çš„è®­ç»ƒæ•°æ®ä¸­æ‹¥æœ‰â€œæ ‡è®°â€æˆ–è€…â€œç­”æ¡ˆâ€ã€‚æ ¹æ®è¿™äº›æ•°æ®è¿›è¡Œæ¨¡å‹çš„è®­ç»ƒã€‚\nå¦‚æ ¹æ®å›¾ç‰‡åˆ¤æ–­çŒ«ç‹—ï¼ˆå›¾åƒå·²ç»æ‹¥æœ‰äº†æ ‡å®šä¿¡æ¯ï¼‰ å¦‚æ›´å…·æ‰‹å†™å­—ä½“è¯†åˆ«æ•°å­—ï¼ˆç»™å‡ºç»“æœæ ‡è®°ï¼‰ é“¶è¡Œå·²ç»ç§¯ç´¯äº†ä¸€å®šçš„å®¢æˆ·ä¿¡æ¯å’Œä»–ä»¬ä¿¡ç”¨å¡çš„ä¿¡ç”¨æƒ…å†µ\nåŒ»é™¢å·²ç»ç§¯ç´¯äº†ä¸€å®šçš„ç—…äººä¿¡æ¯å’Œä»–ä»¬æœ€ç»ˆç¡®è¯Šæ˜¯å¦æ‚£ç—…çš„æƒ…å†µã€‚\nå¸¸è§çš„ç›‘ç£å­¦ä¹ ç®—æ³•æœ‰ï¼š\nkè¿‘é‚» çº¿æ€§å›å½’å’Œå¤šé¡¹å¼å›å½’ é€»è¾‘å›å½’ SVM å†³ç­–æ ‘å’Œéšæœºæ£®æ— éç›‘ç£å­¦ä¹  éç›‘ç£å­¦ä¹  unsupervised learning ç»™æœºå™¨çš„è®­ç»ƒæ•°æ®æ²¡æœ‰ä»»ä½•â€œæ ‡è®°â€æˆ–è€…â€œç­”æ¡ˆâ€ã€‚\nå¯¹æ²¡æœ‰â€œæ ‡è®°â€çš„æ•°æ®è¿›è¡Œåˆ†ç±» \u0026ndash; èšç±»åˆ†æã€‚\næ„ä¹‰ å¯¹æ•°æ®è¿›è¡Œé™ç»´å¤„ç† ç‰¹å¾æå–ï¼šè¡Œç”¨å¡çš„ä¿¡ç”¨è¯„çº§å’Œäººçš„èƒ–ç˜¦æ— å…³ï¼Ÿ ç‰¹å¾å‹ç¼©ï¼šPCA é™ç»´å¤„ç†çš„æ„ä¹‰ï¼šæ–¹ä¾¿å¯è§†åŒ–\næˆ‘ä»¬æ— æ³•ç†è§£å››ç»´ä»¥ä¸Šç©ºé—´ï¼Œæ‰€ä»¥å¯ä»¥å°†å…¶é™ç»´åˆ°ä¸‰ç»´æˆ–è€…äºŒç»´ç©ºé—´ï¼Œæ–¹ä¾¿ç†è§£ã€‚\nå¼‚å¸¸æ£€æµ‹ åŠç›‘ç£å­¦ä¹  semi-supervised learning\nä¸€éƒ¨åˆ†æ•°æ®æœ‰â€œæ ‡è®°â€æˆ–è€…ç­”æ¡ˆï¼Œå¦ä¸€éƒ¨åˆ†æ•°æ®æ²¡æœ‰\nå¸¸è§çš„åœºæ™¯ï¼šå„ç§åŸå› äº§ç”Ÿçš„æ ‡è®°ç¼ºå¤±ã€‚\næˆ‘ä»¬é€šå¸¸éƒ½å…ˆä½¿ç”¨æ— ç›‘ç£å­¦ä¹ æ‰‹æ®µå¯¹æ•°æ®åšå¤„ç†ï¼Œä¹‹åä½¿ç”¨ç›‘ç£å­¦ä¹ æ‰‹æ®µåšæ¨¡å‹çš„è®­ç»ƒå’Œé¢„æµ‹ã€‚\nå¢å¼ºå­¦ä¹  æ ¹æ®å‘¨å›´ç¯å¢ƒçš„æƒ…å†µï¼Œé‡‡å–è¡ŒåŠ¨ï¼Œæ ¹æ®é‡‡å–è¡ŒåŠ¨çš„ç»“æœï¼Œå­¦ä¹ è¡ŒåŠ¨æ–¹å¼ã€‚\næ— äººé©¾é©¶ æœºå™¨äºº åœ¨å¢å¼ºå­¦ä¹ ä¸­ï¼Œç›‘ç£å­¦ä¹ å’ŒåŠç›‘ç£å­¦ä¹ æ˜¯åŸºç¡€ã€‚\næœºå™¨å­¦ä¹ çš„å…¶ä»–åˆ†ç±» åœ¨çº¿å­¦ä¹ å’Œæ‰¹é‡å­¦ä¹  åœ¨çº¿å­¦ä¹  Online Learning\nä¼˜ç‚¹ï¼šåŠæ—¶åæ˜ æ–°çš„ç¯å¢ƒå˜åŒ–\né—®é¢˜ï¼šæ–°çš„æ•°æ®å¯èƒ½å¸¦æ¥ä¸å¥½çš„å˜åŒ–ï¼Œé”™è¯¯çš„æ•°æ®å¯èƒ½å¸¦æ¥é”™è¯¯çš„ç»“æœ\nè§£å†³æ–¹æ¡ˆï¼šéœ€è¦åŠ å¼ºå¯¹æ•°æ®çš„ç›‘æ§ ä¹Ÿé€‚ç”¨äºæ•°æ®é‡å·¨å¤§ï¼Œå®Œå…¨æ— æ³•æ‰¹é‡å­¦ä¹ çš„ç¯å¢ƒ\næ‰¹é‡å­¦ä¹ ï¼ˆç¦»çº¿å­¦ä¹ ï¼‰ Batch Learning / Offline Learning\nä¼˜ç‚¹ï¼šç®€å•\né—®é¢˜ï¼šè¦è€ƒè™‘å¦‚å¦‚ä½•é€‚åº”ç¯å¢ƒå˜åŒ–\nè§£å†³æ–¹æ¡ˆï¼šå®šæ—¶é‡æ–°æ‰¹é‡å­¦ä¹  ç¼ºç‚¹ï¼šæ¯æ¬¡é‡æ–°æ‰¹é‡å­¦ä¹ ï¼Œè¿è¡Œé‡å·¨å¤§ã€‚åœ¨æŸäº›ç¯å¢ƒå˜åŒ–éå¸¸å¿«çš„æƒ…å†µä¸‹ï¼Œç”šè‡³æ˜¯ä¸å¯èƒ½çš„ã€‚\nå‚æ•°å­¦ä¹ å’Œéå‚æ•°å­¦ä¹  å‚æ•°å­¦ä¹  Parametric Learning\nå¦‚å›¾æ‰€ç¤ºï¼Œä¸ºæˆ¿å±‹é¢ç§¯ä¸ä»·æ ¼çš„å…³ç³»æ›²çº¿ã€‚\nç‰¹ç‚¹ï¼šä¸€æ—¦å­¦ä¹ åˆ°äº†å‚æ•°ï¼Œå°±ä¸éœ€è¦åŸæœ‰çš„æ•°æ®é›†ã€‚\néå‚æ•°å­¦ä¹  Nonparametric Learning\nä¸å¯¹æ¨¡å‹è¿›è¡Œè¿‡å¤šå‡è®¾\néå‚æ•°ä¸ç­‰äºæ²¡æœ‰å‚æ•°ï¼Œè€Œæ˜¯å¯¹æ•´ä¸ªä¸è¿›è¡Œå»ºæ¨¡ï¼Œä¸å­¦ä¹ ä¸€äº›å‚æ•°\n","date":"2020-09-28T14:02:02+08:00","permalink":"https://emerywan.github.io/blog/p/mechine-learning-basics/","title":"æœºå™¨å­¦ä¹ åŸºç¡€"},{"content":"Spring Cloud Hystrix åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿæ‹†åˆ†æˆäº†ä¸€ä¸ªä¸ªçš„æœåŠ¡å•å…ƒï¼Œå„å•å…ƒåº”ç”¨é—´é€šè¿‡æœåŠ¡æ³¨å†Œä¸è®¢é˜…çš„æ–¹å¼äº’ç›¸ä¾èµ–ã€‚ç”±äºæ¯ä¸ªå•å…ƒéƒ½åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­è¿è¡Œï¼Œå¦‚æœæŸä¸ªæœåŠ¡ä¸å¯ç”¨ï¼Œå¯èƒ½å¯¼è‡´çº§è”æ•…éšœï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨çš„æƒ…å†µï¼ˆé›ªå´©æ•ˆåº”ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œäº§ç”Ÿäº†æ–­è·¯å™¨ç­‰ä¸€ç³»åˆ—çš„æœåŠ¡ä¿æŠ¤æœºåˆ¶ã€‚\nç®€ä»‹ Spring Cloud Hystrixï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº Netflix çš„å¼€æºæ¡†æ¶ï¼Œå…·æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š\næœåŠ¡é™çº§ ä¾èµ–éš”ç¦» æœåŠ¡ç†”æ–­ ç›‘æ§ï¼ˆHystrix Dashboardï¼‰ å®ç°ä¸€ä¸ª Hystrix Server æ·»åŠ ä¾èµ– 1 2 3 4 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-netflix-hystrix\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; æ·»åŠ æ³¨è§£ 1 2 3 4 5 6 7 8 @EnableCircuitBreaker @EnableDiscoveryClient @SpringBootApplication public class HystrixApplication { public static void main(String[] args) { SpringApplication.run(HystrixApplication.class, args); } } é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 spring: application: name: hystrix-server server: port: 8080 eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/ Hystrix åº”ç”¨ æœåŠ¡é™çº§ å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæ¥å£ /user/{id} è·å–ç”¨æˆ·ä¿¡æ¯ã€‚\n1 2 3 public ResultVo\u0026lt;UserInfo\u0026gt; getUserInfo(@PathVariable String id) { return userService.getUserInfo(id); } åœ¨ UserService ä¸­æ·»åŠ è°ƒç”¨æ–¹æ³•çš„æœåŠ¡é™çº§ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 @HystrixCommand(fallbackMethod = \u0026#34;userFallback\u0026#34;) public ResultVo\u0026lt;UserInfo\u0026gt; getUserInfo(String id) { // æ­£å¸¸çš„æœåŠ¡è°ƒç”¨å’Œä¸šåŠ¡ æ­¤å¤„ä»¥ restTemplate ä¸ºä¾‹ // ... return restTemplate.getForObject(url + \u0026#34;/user/{1}\u0026#34;, ResultVo.class, id); } public ResultVo\u0026lt;UserInfo\u0026gt; userFallback() { // ... // å¤„ç†æœåŠ¡é™çº§éœ€è¦è¿”å›çš„å†…å®¹ } æœåŠ¡é™çº§ OpenFiegn é…ç½®æ–‡ä»¶ 1 2 3 feign: hystrix: enabled: true OpenFeign Client ç«¯å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @FeignClient( name = \u0026#34;user\u0026#34;, // è¿œç¨‹æœåŠ¡å fallback = UserClientFallback.class // æŒ‡å®š å½“æœåŠ¡é™çº§æ—¶ï¼Œé‡‡ç”¨çš„æ–¹æ³• ) public interface UserClient { @GetMapping(\u0026#34;/user/{id}\u0026#34;) ResultVo\u0026lt;UserInfo\u0026gt; getUserInfo(@PathVariable String id); } --- // å®ç° UserClient æ¥å£ @Component public class UserClientFallback implements UserClient { @Override ResultVo\u0026lt;UserInfo\u0026gt; getUserInfo(@PathVariable String id) { // ... // å®ç°é™çº§å†…å®¹ } } ä¾èµ–éš”ç¦» SpringCloud Hystrix çš„ ä¾èµ–éš”ç¦» ç±»ä¼¼äºdockerçš„â€œèˆ±å£æ¨¡å¼â€ã€‚ dockeré€šè¿‡â€èˆ±å£æ¨¡å¼â€å®ç°è¿›ç¨‹éš”ç¦»ï¼Œä½¿å¾—å®¹å™¨ä¹‹é—´äº’ä¸å½±å“ã€‚ è€ŒHystrixä½¿ç”¨è¯¥æ¨¡å¼å®ç°ï¼šâ€œçº¿ç¨‹æ± éš”ç¦»â€ï¼Œä¼šä¸ºæ¯ä¸€ä¸ªHystrixCommandåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹æ± ï¼Œè¿™æ ·å°±ç®—æŸä¸ªåœ¨HystrixåŒ…è£…ä¸‹çš„ä¾èµ–æœåŠ¡å‡ºç°å»¶è¿Ÿè¿‡é«˜æƒ…å†µï¼Œä¹Ÿåªæ˜¯å¯¹è¯¥ä¾èµ–æœåŠ¡çš„è°ƒç”¨äº§ç”Ÿå½±å“ï¼Œå¹¶ä¸ä¼šæ‹–æ…¢å…¶ä»–æœåŠ¡ã€‚\nä½¿ç”¨ @HystrixCommand æ¥å°†æŸä¸ªå‡½æ•°åŒ…è£…æˆäº† Hystrix å‘½ä»¤æ—¶ï¼ŒHystrixæ¡†æ¶è‡ªåŠ¨åœ°ä¸ºè¿™ä¸ªå‡½æ•°å®ç°äº†ä¾èµ–éš”ç¦»ã€‚æ‰€ä»¥ä¾èµ–éš”ç¦»ï¼ŒæœåŠ¡é™çº§åœ¨ä½¿ç”¨æ—¶å€™éƒ½æ˜¯ä¸€ä½“åŒ–å®ç°çš„ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æœåŠ¡å®¹é”™ä¿æŠ¤ã€‚åœ¨ç¼–ç¨‹æ¨¡å‹ä¸Šå°±ä¼šéå¸¸æ–¹ä¾¿ã€‚\næœåŠ¡ç†”æ–­ ","date":"2020-07-29T21:14:45+08:00","permalink":"https://emerywan.github.io/blog/p/spring-cloud-hystrix/","title":"Spring Cloud Hystrix æœåŠ¡å®¹é”™"},{"content":"Spring Cloud Zuul åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œåç«¯æœåŠ¡å¾€å¾€ä¸ç›´æ¥å¼€æ”¾ç»™è°ƒç”¨ç«¯ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªAPIç½‘å…³æ ¹æ®è¯·æ±‚çš„urlï¼Œè·¯ç”±åˆ°ç›¸åº”çš„æœåŠ¡ã€‚ å½“æ·»åŠ APIç½‘å…³åï¼Œåœ¨ç¬¬ä¸‰æ–¹è°ƒç”¨ç«¯å’ŒæœåŠ¡æä¾›æ–¹ä¹‹é—´å°±åˆ›å»ºäº†ä¸€é¢å¢™ï¼Œè¿™é¢å¢™ç›´æ¥ä¸è°ƒç”¨æ–¹é€šä¿¡è¿›è¡Œæƒé™æ§åˆ¶ï¼Œåå°†è¯·æ±‚å‡è¡¡åˆ†å‘ç»™åå°æœåŠ¡ç«¯ã€‚ Spring Cloud Zuul æ˜¯ä¸€ä¸ªåŸºäºJVMè·¯ç”±å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæä¾›åŠ¨æ€è·¯ç”±ï¼Œç›‘æ§ï¼Œå¼¹æ€§ï¼Œå®‰å…¨ç­‰çš„è¾¹ç¼˜æœåŠ¡ã€‚\nç®€ä»‹ Zuul çš„ä¸»è¦åŠŸèƒ½æ˜¯è·¯ç”±è½¬å‘å’Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰ã€‚ä¸åŒç±»å‹çš„ Filter ç”¨äºå¤„ç†è¯·æ±‚ï¼Œå¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š\næƒé™æ§åˆ¶å’Œå®‰å…¨æ€§ï¼šå¯ä»¥è¯†åˆ«è®¤è¯éœ€è¦çš„ä¿¡æ¯å’Œæ‹’ç»ä¸æ»¡è¶³æ¡ä»¶çš„è¯·æ±‚ ç›‘æ§ï¼šç›‘æ§è¯·æ±‚ä¿¡æ¯ åŠ¨æ€è·¯ç”±ï¼šæ ¹æ®éœ€è¦åŠ¨æ€åœ°è·¯ç”±è¯·æ±‚åˆ°åå°çš„ä¸åŒæœåŠ¡é›†ç¾¤ å‹åŠ›æµ‹è¯•ï¼šé€æ¸å¢å¤§åˆ°é›†ç¾¤çš„æµé‡ï¼Œä»¥ä¾¿è¿›è¡Œæ€§èƒ½è¯„ä¼° è´Ÿè½½å‡è¡¡ï¼šä¸ºæ¯ç§ç±»å‹çš„è¯·æ±‚åˆ†é…å®¹é‡å¹¶ä¸¢å¼ƒè¶…è¿‡é™é¢çš„è¯·æ±‚ é™æµ é»‘ç™½åå•è¿‡æ»¤ é™æ€èµ„æºå¤„ç†ï¼šç›´æ¥åœ¨zuulå¤„ç†é™æ€èµ„æºçš„å“åº”è€Œä¸éœ€è¦è½¬å‘è¿™äº›è¯·æ±‚åˆ°å†…éƒ¨é›†ç¾¤ä¸­ åŸºç¡€ä½¿ç”¨ åˆ›å»ºä¸€ä¸ª api-gateway æ·»åŠ ä¾èµ– 1 2 3 4 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-zuul\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; æ·»åŠ æ³¨è§£ 1 2 3 4 5 6 7 8 @EnableZuulProxy @EnableDiscoveryClient @SpringBootApplication public class ApiGatewayApplication { public static void main(String[] args) { SpringApplication.run(ApiGatewayApplication.class, args); } } é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 spring: application: name: api-gateway server: port: 9000 # è‡ªå®šä¹‰è·¯ç”±è§„åˆ™ zuul: routes: user: path: /user/** serviceId: user æµ‹è¯• é€šè¿‡ä»¥ä¸Šé…ç½®æ–‡ä»¶é…ç½®ï¼Œå³å¯é€šè¿‡ api-gateway æœåŠ¡å»è¯·æ±‚ user æœåŠ¡ã€‚\nå‡è®¾ user æœåŠ¡çš„ç«¯å£ä¸º 8080ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª api ä¸º /infoã€‚ é€šè¿‡è®¿é—® http://localhost:9000/user/infoï¼Œå³å¯è®¿é—®è¯¥ apiã€‚ï¼ˆè‹¥åŸæ¥å£åŒ…å«è·¯ç”±å‰ç¼€ /userï¼Œéœ€è¦ä½¿ç”¨ /user/user/info è®¿é—®ï¼‰\nå¸¸ç”¨åŠŸèƒ½ ç»Ÿä¸€å‰ç¼€ 1 2 zuul: prefix: /proxy Header è¿‡æ»¤åŠé‡å®šå‘æ·»åŠ  Host 1 2 3 4 5 6 7 8 9 zuul: # é»˜è®¤ä¸ºè¯¥é…ç½®ï¼Œä¼šè¿‡æ»¤ Cookie Set-Cookie Authorization ä¿¡æ¯ # è®¾ç½®ä¸ºç©ºå³ä¸ä¼šè¿‡æ»¤ sensitive-headers: Cookie,Set-Cookie,Authorization --- zuul: add-host-header: true # é‡å®šå‘ä¼šæ·»åŠ  host è¯·æ±‚å¤´ æŸ¥çœ‹è·¯ç”±ä¿¡æ¯ æ·»åŠ ä¾èµ– 1 2 3 4 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-actuator\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 server: port: 9000 management: endpoints: web: exposure: include: \u0026#39;routes\u0026#39; è®¿é—®æ¥å£ è®¿é—® http://localhost:9000/actuator/routes è·å–ä¿¡æ¯ è®¿é—® http://localhost:9000/actuator/routes/details è·å–è¯¦ç»†ä¿¡æ¯ Zuul åº”ç”¨ Zuul Filter Filteræ˜¯Zuulçš„æ ¸å¿ƒï¼Œç”¨æ¥å®ç°å¯¹å¤–æœåŠ¡çš„æ§åˆ¶ã€‚Filteræœ‰4ä¸ªç”Ÿå‘½å‘¨æœŸã€‚\npre åœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡å‰æ‰§è¡Œã€‚ æ¯”å¦‚æƒé™æ ¡éªŒã€æ‰“å°æ—¥å¿—ç­‰åŠŸèƒ½ã€‚ routing åœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡æ—¶æ‰§è¡Œã€‚ ç”¨äºæ„å»ºå‘é€ç»™å¾®æœåŠ¡çš„è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ Apache HttpClient æˆ– Netfilx Ribbon è¯·æ±‚å¾®æœåŠ¡ã€‚ post è¿™ç§è¿‡æ»¤å™¨åœ¨è·¯ç”±åˆ°å¾®æœåŠ¡ä»¥åæ‰§è¡Œã€‚ ä¸ºå“åº”æ·»åŠ æ ‡å‡†çš„HTTP Headerã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯å’ŒæŒ‡æ ‡ã€å°†å“åº”ä»å¾®æœåŠ¡å‘é€ç»™å®¢æˆ·ç«¯ç­‰ã€‚ error å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œè¯¥è¿‡æ»¤å™¨ã€‚ è‡ªå®šä¹‰ Filter å®ç°è‡ªå®šä¹‰ Filterï¼Œéœ€ç»§æ‰¿ com.netflix.zuul.ZuulFilterï¼Œå¹¶è¦†ç›–ç»§æ‰¿çš„æ–¹æ³•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 @Component public class MyFilter extends ZuulFilter { @Override String filterType() { // å®šä¹‰filterçš„ç±»å‹ï¼Œpreã€routeã€postã€error return null; } @Override int filterOrder() { // å®šä¹‰filterçš„é¡ºåºï¼Œæ•°å­—è¶Šå°è¡¨ç¤ºé¡ºåºè¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ return 0; } @Override boolean shouldFilter() { // æ˜¯å¦éœ€è¦æ‰§è¡Œè¯¥filterï¼Œtrueè¡¨ç¤ºæ‰§è¡Œï¼Œfalseè¡¨ç¤ºä¸æ‰§è¡Œ return false; } @Override Object run() { // filteréœ€è¦æ‰§è¡Œçš„å…·ä½“æ“ä½œ return null; } } Zuul é™æµ é™æµåœ¨å‰ç½®è¿‡æ»¤å™¨ï¼ˆpreï¼‰å‰ä½¿ç”¨ï¼Œåœ¨è¯·æ±‚è¢«è½¬å‘å‰è°ƒç”¨ï¼Œä¸”ä¼˜å…ˆçº§æœ€é«˜ã€‚\nä»¤ç‰Œæ¡¶é™æµç¤ºä¾‹ã€‚ä»¤ç‰Œæ¡¶ç®—æ³•èƒ½å¤Ÿåœ¨é™åˆ¶æ•°æ®çš„å¹³å‡ä¼ è¾“é€Ÿç‡çš„åŒæ—¶è¿˜å…è®¸æŸç§ç¨‹åº¦çš„çªå‘ä¼ è¾“ã€‚\nä»¤ç‰Œæ¡¶ç®—æ³•ä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿåº¦å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼Œè€Œå¦‚æœè¯·æ±‚éœ€è¦è¢«å¤„ç†ï¼Œåˆ™éœ€è¦å…ˆä»æ¡¶é‡Œè·å–ä¸€ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œå¯å–æ—¶ï¼Œåˆ™æ‹’ç»æœåŠ¡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 import org.springframework.cloud.netflix.zuul.filters.support.FilterConstants; @Component public class RateLimiterFilter extends ZuulFilter { // ç›´æ¥ä½¿ç”¨ guava ä¸­çš„ RateLimiter å®ç° private static final RateLimiter RATE_LIMITER = RateLimiter.create(100); @Override public String filterType() { return FilterConstants.PRE_TYPE; } @Override public int filterOrder() { // é™æµæ˜¯æœ€é«˜ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥æ¯”æœ€é«˜ä¼˜å…ˆçº§ -3 è¿˜è¦å° return FilterConstants.SERVLET_DETECTION_FILTER_ORDER - 1; } @Override public boolean shouldFilter() { return true; } @Override public Object run() throws ZuulException { // å¦‚æœæ²¡æœ‰æ‹¿åˆ°ä»¤ç‰Œ if (!RATE_LIMITER.tryAcquire()) { throw new RuntimeException(); } return null; } } Zuul é‰´æƒ åœ¨è¯·æ±‚æœåŠ¡å‰ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æƒé™è®¿é—®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 @Component public class TokenFilter extends ZuulFilter { @Override public String filterType() { return FilterConstants.PRE_TYPE; } @Override public int filterOrder() { // è¶Šå°è¶Šé å‰ï¼Œæ”¾åœ¨ PRE_DECORATION_FILTER_ORDER ä¹‹å‰ return PRE_DECORATION_FILTER_ORDER - 1; } @Override public boolean shouldFilter() { return true; } // éœ€è¦å®šä¹‰çš„é€»è¾‘ @Override public Object run() throws ZuulException { RequestContext requestContext = RequestContext.getCurrentContext(); HttpServletRequest request = requestContext.getRequest(); // éœ€è¦æ ¹æ®å®é™…æƒ…å†µï¼Œä» header / cookie ä¸­è·å–ä¿¡æ¯ String token = ...; // æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæ ¡éªŒ if (...) { // é¦–å…ˆè®¾ç½® zuul requestContext.setSendZuulResponse(false); // è®¾ç½®è¿”å›ä¿¡æ¯ requestContext.setResponseStatusCode(HttpStatus.UNAUTHORIZED.value()); } return null; } } Zuul è·¨åŸŸ åœ¨æµè§ˆå™¨ä¸­çš„ ajax è¯·æ±‚æ˜¯æœ‰åŒæºç­–ç•¥çš„ï¼Œå¦‚æœè¿åäº†åŒæºç­–ç•¥ï¼Œå°±ä¼šæœ‰è·¨åŸŸé—®é¢˜ã€‚åœ¨ Zuul ä¸­æ·»åŠ  CorsFilter è¿‡æ»¤å™¨ï¼Œæ˜¯è·¨åŸŸé—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Configuration public class CorsConfig { @Bean public CorsFilter corsFilter() { final UrlBaseCorsConfigurationSource source = new UrlBaseCorsConfigrationSOurce(); final CorsConfiguration config = new CorsConfiguration(); config.setAllowCredentials(true); config.setAllowedOrigins(Collections.singletonList(\u0026#34;*\u0026#34;)); config.setAllowedHeaders(Collections.singletonList(\u0026#34;*\u0026#34;))ï¼› config.setAllowedMethods(Collections.singletonList(\u0026#34;*\u0026#34;)); config.setMaxAge(300L); source.registerCorsConfiguration(\u0026#34;/**\u0026#34;, config); return new CorsFilter(source); } } ","date":"2020-07-28T15:14:45+08:00","permalink":"https://emerywan.github.io/blog/p/spring-cloud-zuul/","title":"Spring Cloud Zuul æœåŠ¡ç½‘å…³"},{"content":"Spring Cloud Config Spring Cloud Config æ˜¯ä¸€ä¸ªè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ç®¡ç†æ–¹æ¡ˆã€‚\nServer æä¾›é…ç½®æ–‡ä»¶çš„å­˜å‚¨ï¼Œä»¥æ¥å£çš„å½¢å¼æä¾›é…ç½®æ–‡ä»¶çš„å†…å®¹ Client é€šè¿‡æ¥å£è·å–æ•°æ®ï¼Œå¹¶ä¾æ®æ­¤æ•°æ®åˆå§‹åŒ–åº”ç”¨ Config Server æ–°å»ºä¸€ä¸ª git ä»“åº“ åœ¨ git æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œç”¨æ¥å­˜æ”¾é…ç½®æ–‡ä»¶ã€‚\nå¹¶åœ¨ä»“åº“ä¸­æ·»åŠ ç›¸åº”çš„é…ç½®æ–‡ä»¶ã€‚\nuser-dev.yml user-test.yml user-prod.yml å…·ä½“å®ç° æ·»åŠ ä¾èµ– 1 2 3 4 5 6 \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-config-server\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; æ·»åŠ æ³¨è§£ 1 2 3 4 5 6 7 8 @EnableConfigServer @EnableDiscoveryClient @SpringBootApplication public class ConfigApplication { public static void main(String[] args) { SpringApplication.run(ConfigApplication.class, args); } } é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 spring: application: name: config cloud: config: server: git: uri: http://github.com/xxx/confg # é…ç½®æ–‡ä»¶ä»“åº“åœ°å€ username: ... password: ... searchpath: config-repo # gitä»“åº“åœ°å€ä¸‹çš„ç›¸å¯¹åœ°å€ï¼Œå¯é…ç½®å¤šä¸ª server: port: 8000 eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/ é€šè¿‡æ¥å£æŸ¥çœ‹é…ç½® ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ä¼šè¢«è½¬æ¢æˆwebæ¥å£ï¼Œå¯åŠ¨åº”ç”¨åï¼Œå¯åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼ˆè‹¥é…ç½®æ–‡ä»¶çš„æ ¼å¼æœ‰é”™è¯¯ï¼Œå°†æ— æ³•è®¿é—®ï¼‰ã€‚\nå¦‚è®¿é—® http://localhost:8000/user/dev å³å¯è¿”å› user-dev.yml çš„é…ç½®ä¿¡æ¯ã€‚\n/{application}/{profile}[/{label}] /{application}-{profile}.yml /{label}/{application}-{profile}.yml profileï¼šé…ç½®ç¯å¢ƒï¼Œlabelï¼šä»“åº“åˆ†æ”¯ã€‚\nConfig Client åœ¨é¡¹ç›®ä¸­åˆ›å»º bootstrap.yml åœ¨é¡¹ç›®ä¸­ï¼Œbootstrap.yml ä¼šä¼˜å…ˆäº application.yml åŠ è½½ã€‚\napplication.yml åº”ç”¨åœºæ™¯ ä¸»è¦ç”¨äº Spring Boot é¡¹ç›®çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚\nbootstrap.yml åº”ç”¨åœºæ™¯ ä»é¢å¤–çš„èµ„æºåŠ è½½é…ç½®ä¿¡æ¯ï¼ˆå¦‚ä½¿ç”¨ Spring Cloud Config æ—¶ï¼‰ ä¸€äº›å›ºå®šä¸èƒ½è¢«è¦†ç›–çš„å±æ€§ï¼ˆå…·æœ‰é«˜ä¼˜å…ˆçº§ï¼Œä¸€èˆ¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®æˆ–applicationä¸­åŒåé…ç½®è¦†ç›–ï¼‰ ä¸€äº› åŠ å¯†/è§£å¯† çš„åœºæ™¯ å…·ä½“å®ç° æ·»åŠ ä¾èµ– 1 2 3 4 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-config\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 spring: application: name: user # è¯¥åº”ç”¨è·å–ä¹‹å‰é…ç½®å¥½çš„ user-dev.yml cloud: config: url: http://localhost:8000/ profile: dev label: master --- spring: cloud: config: discovery: enable: true # å¯ç”¨æœåŠ¡å‘ç° (Eureka) service-id: config # spring cloud config server åº”ç”¨åç§° profile: dev label: master å¯åŠ¨æœåŠ¡ å¯åŠ¨æœåŠ¡æ—¶ï¼Œå³ä¼šå…ˆå» git ä»“åº“è·å–é…ç½®ä¿¡æ¯ã€‚\né…ç½®ä¿¡æ¯è‡ªåŠ¨æ›´æ–° å½“ git ä»“åº“ä¸­çš„é…ç½®ä¿¡æ¯æ›´æ–°åï¼Œä½¿ç”¨é…ç½®çš„å®¢æˆ·ç«¯å¹¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°é…ç½®ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€äº›æœºåˆ¶å»è§¦å‘é…ç½®çš„æ›´æ–°ã€‚\nactuator æ·»åŠ ä¾èµ– 1 2 3 4 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-actuator\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; æ·»åŠ æ³¨è§£ï¼Œæ‰“å¼€æ›´æ–°æœºåˆ¶ é€šè¿‡åœ¨éœ€è¦åŠ è½½æ›´æ–°é…ç½®çš„ç±»ä¸Šæ·»åŠ  @RefreshScopeï¼Œå½“å®¢æˆ·ç«¯é€šè¿‡è§¦å‘ POST æ–¹å¼çš„ /refresh æ—¶ï¼Œä¼šè‡ªåŠ¨å°†æ–°çš„é…ç½®æ›´æ–°åˆ°ç›¸åº”çš„å­—æ®µä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 @RefreshScope // è¯¥ç±»ä¸­é…ç½®ç›¸å…³ä¼šè‡ªåŠ¨åˆ·æ–° @RestController public class ActuatorController { @Value(\u0026#34;${env}\u0026#34;) private String env; @RequestMapping(\u0026#34;/env\u0026#34;) public String env { return this.env; } } é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # server ç«¯æ·»åŠ  management: endpoints: web: exposure: include: \u0026#34;*\u0026#34; --- # client ç«¯æ·»åŠ  management: endpoints: web: exposure: include: refresh æµ‹è¯•è‡ªåŠ¨åˆ·æ–° å½“ git ä»“åº“ä¸­é…ç½®æ–‡ä»¶æ›´æ–°åï¼Œé€šè¿‡å‘é€ POST è¯·æ±‚åˆ° /refresh åï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨è·å–æœ€æ–°é…ç½®ã€‚\n1 curl -v -X POST http://localhost:8080/actuator/refresh Spring Cloud Bus ï¼ˆæ¨èï¼‰ é€šè¿‡ spring cloud busï¼Œé€šè¿‡ POST è¯·æ±‚ /bus-refreshï¼Œå®ç°è‡ªåŠ¨è·å–æœ€æ–°é…ç½®ã€‚\nè‡³æ­¤ä¸¤ç§æ¶ˆæ¯ä»£ç†ï¼š\nRabbitMQ Kafka WebHook WebHook æ˜¯å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé€šè¿‡å‘é€ http post è¯·æ±‚çš„æ–¹å¼æ¥é€šçŸ¥ä¿¡æ¯æ¥æ”¶æ–¹ã€‚\né€šè¿‡åˆ›å»º WebHook å³å¯è‡ªåŠ¨è§¦å‘ POST è¯·æ±‚ï¼Œè®©å®¢æˆ·ç«¯åŠ¨æ€åˆ·æ–°é…ç½®ã€‚\n","date":"2020-07-27T12:14:45+08:00","permalink":"https://emerywan.github.io/blog/p/spring-cloud-config/","title":"Spring Cloud Config ç»Ÿä¸€é…ç½®ä¸­å¿ƒ"},{"content":"Spring Cloud æœåŠ¡é€šä¿¡ åŒæ­¥é€šä¿¡ï¼š\ndobbo é€šè¿‡ RPC è¿œç¨‹è°ƒç”¨ã€‚ spring cloud é€šè¿‡ REST æ¥å£è°ƒç”¨ã€‚ å¼‚æ­¥é€šä¿¡ï¼š\né€šè¿‡æ¶ˆæ¯å¯¹åˆ—ï¼Œå¦‚ï¼šRabbitMQï¼ŒKafkaï¼ŒActiveM ç­‰ã€‚ æœ¬æ–‡ä¸»è¦ä»‹ç» Spring Cloud ä½¿ç”¨ RestTemplate / OpenFeign è¿›è¡Œ REST æ¥å£è°ƒç”¨ã€‚\nRestTemplate é€šè¿‡ RestTemplate è¿›è¡Œè°ƒç”¨ 1 2 3 4 5 6 7 8 9 public ProductInfo getProductMsg(String id) { RestTemplate restTemplate = new RestTemplate(); ProductInfo response = restTemplate.getForObject( \u0026#34;http://example.com/product/info\u0026#34;, // è¿œç¨‹è°ƒç”¨åœ°å€ ProductInfo.class, // response ç±»å‹ id // éœ€è¦ä¼ é€’çš„å‚æ•° ); return response; } åˆ©ç”¨ LoadBalancerClient è·å–ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 @Autowired private LoadBalancerClient loadBalancerClient; public ProductInfo getProductMsg(String id) { RestTemplate restTemplate = new RestTemplate(); ServiceInstance serviceInstance = loadBalancerClient.choose(\u0026#34;PRODUCT\u0026#34;); // åˆ©ç”¨ loadBalancerClient é€šè¿‡åº”ç”¨åï¼ˆspring.application.nameï¼‰è·å–ä¿¡æ¯ String url = String.format(\u0026#34;http://%s:%s\u0026#34;, serviceInstance.getHost(), serviceInstance.getPort()) + \u0026#34;/product/info\u0026#34;; ProductInfo response = restTemplate.getForObject(url, ProductInfo.class, id); return response; } åˆ©ç”¨ LoadBalance åœ¨ RestTemplate ä¸­ç›´æ¥ä½¿ç”¨åº”ç”¨åç§° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 class RestTemplateConfig { @Bean @LoadBalance public RestTemplate restTemplate() { return new RestTemplate(); } } --- @Autowired private RestTemplate restTemplate; public ProductInfo getProductMsg(String id) { // åˆ©ç”¨ @LoadBalance å¯ä»¥åœ¨ RestTemplate ä¸­ä½¿ç”¨åº”ç”¨åç§° ProductInfo response = restTemplate.getForObject(\u0026#34;http://PRODUCT/product/msg\u0026#34;, ProductInfo.class, id); return response; } OpenFeign ï¼ˆæ¨èï¼‰ å¼•å…¥ä¾èµ– 1 2 3 4 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-openfeign\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; æ·»åŠ å¯åŠ¨æ³¨è§£ 1 2 3 4 5 6 7 8 9 10 import org.springframework.cloud.openfeign.EnableFeignClients; @EnableFeignClients @SpringBootApplication @EnableDiscoveryClient public class FeignApplication { public static void main(String[] args) { SpringApplication.run(FeignApplication.class, args); } } å…·ä½“å®ç° ç°åœ¨æœ‰ä¸¤ä¸ªæœåŠ¡ï¼Œåˆ†åˆ«ä¸º Prodcut å’Œ Order ã€‚ éœ€æ±‚ï¼š Order æœåŠ¡ä¸­ï¼Œå®¢æˆ·è¿›è¡Œäº†ä¸‹å•æ“ä½œåï¼Œè°ƒç”¨ Productï¼ˆFeignï¼‰ çš„è¿›è¡Œå‡åº“å­˜æ“ä½œã€‚\nProduct æœåŠ¡ä¸­ï¼Œå®šä¹‰è¿œç¨‹è°ƒç”¨ç«¯ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 public class DecreaseStockInput { // ... } --- @FeignClient(name = \u0026#34;product\u0026#34;) // name: è¿œç¨‹æœåŠ¡å(Spring.application.name) public interface ProductClient { @RequestMapping(value = \u0026#34;/product/decrease_stock\u0026#34;) void decreaseStock(@RequestBody List\u0026lt;DecreaseStockInput\u0026gt; decreaseStockInputList); } Order æœåŠ¡ä¸­ï¼Œå¯¹ Product Client è¿›è¡Œè°ƒç”¨ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Service public class OrderServiceImpl implements OrderService { // æ³¨å…¥çš„ä¸º Product ä¸­çš„ ProductClient // é€šè¿‡ä¾èµ–çš„æ–¹å¼ @Autowired private ProductClient productClient; public OrderDTO create(OrderDTO orderDTO) { // ... // è°ƒç”¨ Product æœåŠ¡ä¸­çš„ api è¿›è¡Œå‡åº“å­˜æ“ä½œ productClient.decreaseStock(decreaseStockInputList); // ... } } ","date":"2020-07-26T21:14:45+08:00","permalink":"https://emerywan.github.io/blog/p/spring-cloud-openfeign/","title":"Spring Cloud æœåŠ¡é€šä¿¡"},{"content":"Eureka æ‰¾åˆ°å•¦ï¼ æœåŠ¡æ³¨å†Œä¸å‘ç°\nç®€ä»‹ Spring Cloud å°è£…äº† Netflix å…¬å¸å¼€å‘çš„ Eureka æ¨¡å—æ¥å®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç°ã€‚é‡‡ç”¨äº† C-S çš„è®¾è®¡æ¶æ„ã€‚ç”¨æ¥ç®€åŒ–ä¸æœåŠ¡å™¨çš„äº¤äº’ã€ä½œä¸ºè½®è¯¢è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶æä¾›æœåŠ¡çš„æ•…éšœåˆ‡æ¢æ”¯æŒã€‚ ç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆã€‚ Ereka Serverã€‚ æ³¨å†Œä¸­å¿ƒ Ereka Clientã€‚ æœåŠ¡æ³¨å†Œ Eureka é‡‡ç”¨äº†å®¢æˆ·ç«¯å‘ç°çš„æ–¹å¼ï¼Œåœ¨æœåŠ¡è¿è¡Œæ—¶ï¼Œé€šè¿‡(è½®è®­ã€hashç­‰è´Ÿè½½å‡è¡¡æœºåˆ¶ç­‰æ–¹å¼)æ³¨å†Œä¸­å¿ƒæ‰¾åˆ°éœ€è¦æœåŠ¡ï¼ˆå³ A é€šè¿‡ æ³¨å†Œä¸­å¿ƒ æ‰¾ Bï¼Œéœ€è¦è°æ‰¾è°ï¼‰ã€‚\nEureka Server æ³¨å†Œä¸­å¿ƒè®°å½•ç€æ‰€æœ‰åº”ç”¨çš„ä¿¡æ¯å’ŒçŠ¶æ€(å¦‚ï¼šåº”ç”¨åï¼Œæ‰€åœ¨æœåŠ¡å™¨ï¼Œæ˜¯å¦æ­£å¸¸å·¥ä½œ)ã€‚\nå®ç°ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ 1. å¼•å…¥ä¾èµ– 1 2 3 4 5 6 7 8 9 10 \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-eureka-server\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; 2. æ·»åŠ å¯åŠ¨æ³¨è§£ 1 2 3 4 5 6 7 @EnableEurekaServer @SpringBootApplication public class EurekaServerApplication { public static void main(String[] args) { SpringApplication.run(EurekaServerApplication.class, args); } } 3. é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 spring: application: name: eureka-server Server: port: 8761 eureka: client: register-with-eureka: false # æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverï¼Œä½œä¸º Server ç«¯ä¸éœ€è¦ fetch-registry: false # æ˜¯å¦ä»Eureka Serverè·å–æ³¨å†Œä¿¡æ¯ï¼Œä½œä¸º Server ç«¯ä¸éœ€è¦ service-url: # æ¥æ”¶çš„æ˜¯ä¸€ä¸ª Map ç»“æ„ defaultZone: http://localhost:8761/eureka/ 4. å¯åŠ¨ç¨‹åº å¯åŠ¨åï¼Œè®¿é—® http://localhost:8761/ï¼Œå³å¯çœ‹åˆ° Spring Eureka ç•Œé¢ã€‚\nå®ç° Eureka é›†ç¾¤ åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯æœ€é‡è¦çš„åŸºç¡€éƒ¨åˆ†ï¼Œç†åº”éšæ—¶å¤„äºå¯ä»¥æä¾›æœåŠ¡çš„çŠ¶æ€ã€‚ä¸ºäº†ç»´æŒå…¶å¯ç”¨æ€§ï¼Œé€šå¸¸ä¼šé‡‡ç”¨é›†ç¾¤çš„æ–¹æ¡ˆã€‚Eurekaé€šè¿‡äº’ç›¸æ³¨å†Œçš„æ–¹å¼æ¥å®ç°é«˜å¯ç”¨çš„éƒ¨ç½²\nåŒèŠ‚ç‚¹æ³¨å†Œ åˆ›å»ºä¸¤å°æœåŠ¡å™¨ï¼Œç«¯å£åˆ†åˆ«ä¸º 8761 å’Œ 8762ã€‚\nå°† 8761 çš„æœåŠ¡å™¨é…ç½®æŒ‡å‘ 8761ï¼Œå°† 8762 çš„æœåŠ¡å™¨æŒ‡å‘ 8761ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 spring: application: name: eureka-server Server: port: 8761 eureka: client: register-with-eureka: false fetch-registry: false service-url: # å°† service-url æŒ‡å‘ 8762 defaultZone: http://localhost:8762/eureka/ --- spring: application: name: eureka-server Server: port: 8762 eureka: client: register-with-eureka: false fetch-registry: false service-url: # å°† service-url æŒ‡å‘ 8761 defaultZone: http://localhost:8761/eureka/ å¯åŠ¨ç¨‹åºåï¼Œé€šè¿‡ http://localhost:8761/ å’Œ http://localhost:8762/ éƒ½å¯è®¿é—® Eureka ç•Œé¢ã€‚å¹¶ä¸”å¯ä»¥çœ‹åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¿¡æ¯èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚\nå¤šèŠ‚ç‚¹æ³¨å†Œ åœ¨ç”Ÿäº§ä¸­æˆ‘ä»¬éœ€è¦ä¸‰å°æˆ–è€…å¤§äºä¸‰å°çš„æ³¨å†Œä¸­å¿ƒæ¥ä¿è¯æœåŠ¡çš„ç¨³å®šæ€§ï¼Œé…ç½®çš„åŸç†å…¶å®éƒ½ä¸€æ ·ï¼šå°†æ³¨å†Œä¸­å¿ƒåˆ†åˆ«æŒ‡å‘å…¶å®ƒçš„æ³¨å†Œä¸­å¿ƒã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 --- spring: application: name: eureka-server server: port: 8761 eureka: client: register-with-eureka: false fetch-registry: false serviceUrl: defaultZone: http://localhost:8762/eureka/,http://localhost:8763/eureka/ --- spring: application: name: eureka-server server: port: 8762 eureka: client: register-with-eureka: false fetch-registry: false serviceUrl: defaultZone: http://localhost:8761/eureka/,http://localhost:8763/eureka/ --- spring: application: name: eureka-server server: port: 8763 eureka: client: register-with-eureka: false fetch-registry: false serviceUrl: defaultZone: http://localhost:8761/eureka/,http://localhost:8762/eureka/ Eureka Client å®ç°ä¸€ä¸ªæœåŠ¡æ³¨å†Œ 1. ä¾èµ–é…ç½® 1 2 3 4 5 6 \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-eureka\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; 2. æ·»åŠ å¯åŠ¨æ³¨è§£ 1 2 3 4 5 6 7 8 9 import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer; @EnableDiscoveryClient @SpringBootApplication public class ClientApplication { public static void main(String[] args) { SpringApplication.run(ClientApplication.class, args); } } 3. é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 spring: application: name: eureka-client server: port: 8080 eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/ # instance: # è‡ªå®šä¹‰é“¾æ¥ # hostname: example.com 4. å¯åŠ¨ç¨‹åº å¯åŠ¨ç¨‹åºåï¼Œè¿›å…¥ Eureka é¡µé¢ http://localhost:8761/eureka/ï¼Œå³å¯çœ‹åˆ°æ³¨å†Œçš„æœåŠ¡ eureka-clientã€‚\næ€»ç»“ åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯æœ€é‡è¦çš„åŸºç¡€éƒ¨åˆ† @EnableEurekaServer @EnableEurekaClient å…·æœ‰ å¿ƒè·³æ£€æµ‹ï¼Œå¥åº·æ£€æŸ¥ï¼Œè´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ ä¸ºä¿è¯é«˜å¯ç”¨ï¼Œå»ºè®®é›†ç¾¤éƒ¨ç½² ","date":"2020-07-25T13:14:45+08:00","permalink":"https://emerywan.github.io/blog/p/spring-cloud-eureka/","title":"Spring Cloud Eureka æœåŠ¡æ³¨å†Œä¸å‘ç°"},{"content":"è­¦å‘Šï¼šè¯¥æ•™ç¨‹ä»…ä¸ºä¸ªäººè®°å½•ï¼Œè¯¥ç¬”è®°æœ¬å®‰è£…æ¶‰åŠè§£é”BIOSï¼Œå­˜åœ¨ä¸€å®šé£é™©ï¼Œå¦‚æ‚¨ä½¿ç”¨è¯¥æ•™ç¨‹å¯¹è®¡ç®—æœºè¿›è¡Œæ›´æ”¹ï¼Œæ‰€é€ æˆçš„çš„ä»»ä½•åæœæˆ‘æ¦‚ä¸è´Ÿè´£ã€‚\nå†™åœ¨æœ€å‰ å¼€å­¦åå¤ªå¿™ï¼Œå¹¶ä¸”ç”µè„‘æˆ‘æ¢äº†å—æ›´å¤§çš„ç¡¬ç›˜ï¼Œè¿™å°ç”µè„‘æˆ‘ä¸æ‰“ç®—å†å®‰è£…é»‘è‹¹æœäº†ï¼Œæœ¬æ•™ç¨‹å¯èƒ½ä¼šä¸å†æ›´æ–°ï¼Œæœ€æ–°ä¸Šä¼ çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ äº†å¯¹ type-C 4K 30Hz çš„æ”¯æŒï¼Œ4K 60Hz æ˜¾ç¤ºå™¨ä¼šé»‘å±ï¼Œæ— æ³•è¾“å‡ºä¿¡å·ã€‚\nå¦‚æœæƒ³è¦ä½¿ç”¨ Clover å®‰è£… 10.15 æˆ–ä»¥ä¸‹ç³»ç»Ÿçš„è¯ï¼Œå¯ä»¥ä¾æ—§æŒ‰ç…§æ­¤æ•™ç¨‹ï¼ˆè¯·å°† Clover å’Œ kext é€‰æ‹©åˆ°é€‚åº”ç‰ˆæœ¬ï¼‰ã€‚\nå¦‚æœæ‰“ç®—å®‰è£…æ–°ç³»ç»Ÿä½¿ç”¨çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ Opencore å®‰è£…ã€‚æ¨èå‚è€ƒ RazerBlade15-Base-Model-Hackintosh_macOS_Montereyï¼Œè¯¥æ•™ç¨‹å†™çš„éå¸¸è¯¦ç»†ï¼Œæ„Ÿè°¢ä»–çš„ä»˜å‡ºã€‚\nå»ºè®®ä¸è¦ä½¿ç”¨ ä¸œèŠï¼ˆé“ ä¾ ï¼‰çš„å›ºæ€ç¡¬ç›˜ï¼Œæˆ‘çš„ç¡¬ç›˜ä¸ºä¸œèŠ tr200ï¼Œåœ¨ macOS ä¸­è«åå¡é¡¿ï¼Œæˆ‘çš„ä¸œèŠUç›˜åœ¨ macOS ä¸­ä¹Ÿè«åå¡é¡¿ï¼Œå…¶ä»–ç³»ç»Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ï¼ˆç„å­¦é—®é¢˜ï¼Ÿï¼‰\nç¥ä½ ç©å¾—æ„‰å¿«ï¼\nGithub â¡ï¸\nå› ä¸ºç–«æƒ…åŸå› æ˜¥èŠ‚ä¸€ç›´å®…åœ¨å®¶ï¼Œå­¦æ ¡å‡æœŸä¹Ÿå»¶é•¿äº†ï¼Œæ‰¾åˆ°äº†åŒæ¬¾ç¬”è®°æœ¬çš„æ•™ç¨‹ï¼Œæ‰€ä»¥å…¥å‘å®‰è£…é»‘è‹¹æœï¼Œæœ€è¿‘æŠŠæ­¥éª¤æ•´ç†äº†ä¸€ä¸‹ã€‚\nå®‰è£…è¿‡ç¨‹æˆ‘ä¸»è¦å‚è€ƒäº† è¿™ç¯‡ å’Œ è¿™ç¯‡ æ•™ç¨‹ï¼Œæ„Ÿè°¢ä»–ä»¬çš„è¾›è‹¦ä»˜å‡ºã€‚éƒ¨åˆ†å†…å®¹ä¸ºä»–ä»¬æ‰€å†™æ•™ç¨‹çš„æ±‰åŒ–ï¼Œè¯¦ç»†æˆ–ç²¾ç®€ï¼Œæˆ‘çš„æ°´å¹³æœ‰é™ï¼Œåˆšæ¥è§¦é»‘è‹¹æœï¼Œå»ºè®®åŒæ—¶å‚è€ƒä»–ä»¬çš„æ•™ç¨‹ã€‚\nç¡¬ä»¶ä»‹ç» ç»“æœä»‹ç» è§£é”BIOS å®‰è£…å‰å‡†å¤‡ ç³»ç»Ÿå®‰è£… DSDTï¼ŒSSDTåˆ¶ä½œ ç½‘å¡ ä¸€äº›ä¼˜åŒ– å‚è€ƒ æ›´æ–° [1] ç¡¬ä»¶ä»‹ç» å‹å· æœ€ç»ˆæƒ…å†µ CPU i7-8750H å¯ç”¨ GPU Nvdia 1060 Max-Q é™¤ 10.13 High Sierra å®‰è£… WebDriver å¤–ä¸å¯ç”¨ ç¡¬ç›˜ æ›´æ¢äº† é‡‘å£«é¡¿ A2000 å¯ç”¨ ç½‘å¡ 9560NGW WIFI ç›®å‰æ— è§£ï¼Œè“ç‰™å¯ç”¨ æ˜¾ç¤ºå™¨ 1080P å¯ç”¨ æ‘„åƒå¤´ å¯ç”¨ æ‰¬å£°å™¨ å¯ç”¨ è€³æœº æ— æ³•æ£€æµ‹åˆ°éº¦å…‹é£ éº¦å…‹é£ ä¸å¯ç”¨ï¼Œå·²è¯†åˆ«ï¼Œä½†åœ¨è®¾ç½®ä¸­æœªçœ‹è§è¾“å…¥ç”µå¹³ è§¦æ§æ¿ æ‰‹åŠ¿å¯ç”¨ï¼ˆååº”ç¨æ…¢ï¼‰ HDMI æ¥å£ ç›´é€šæ˜¾å¡ï¼Œé™¤å®‰è£… High Sierra å¤–ä¸å¯ç”¨ Mini DP æ¥å£ ç›´é€šæ˜¾å¡ï¼Œé™¤å®‰è£… High Sierra å¤–ä¸å¯ç”¨ é›·ç”µ3 è¢«è¯†åˆ«æˆ USB3.1ï¼Œå¯å¤–æ¥æ‹“å±•åå¤–æ¥æ˜¾ç¤ºå™¨ï¼Œæˆ‘çš„ç”µè„‘ä¸­éœ€è¦åˆ é™¤SSDT-12-OptTabl.aml [2] å®‰è£…ç»“æœ ä¸€äº›å°é—®é¢˜ æˆ‘ä¹Ÿæ˜¯åˆšåˆšæ¥è§¦é»‘è‹¹æœï¼Œå¾ˆå¤šé—®é¢˜æˆ‘ä¹Ÿæ— æ³•è§£å†³ï¼Œæœ‰è°äº†è§£çš„è¯å¸Œæœ›èƒ½å¸®åŠ©ä¸€ä¸‹ï¼Œæ„Ÿè°¢ã€‚\néº¦å…‹é£æ— æ³•ä½¿ç”¨ï¼Œç³»ç»Ÿèƒ½æ‰¾åˆ°ä½†æ— æ³•ä½¿ç”¨ï¼Œè€³æœºéº¦å…‹é£æ— æ³•æ‰¾åˆ°ã€‚æƒ³è¦ä½¿ç”¨çš„è¯åªèƒ½é€šè¿‡è“ç‰™è€³æœºäº†ã€‚\nè€³æœºéº¦å…‹æ— æ³•è¯†åˆ«ã€‚\nè¾“å‡ºè®¾å¤‡é»˜è®¤è¯†åˆ«åˆ°äº†æ‰¬å£°å™¨å’Œè€³æœºï¼ˆå³ä½¿æœªæ’å…¥è€³æœºï¼‰ï¼Œæ— æ³•è‡ªåŠ¨åˆ‡æ¢ï¼Œéœ€æ‰‹åŠ¨åˆ‡æ¢ã€‚\næ›´æ–° ä»Šå¤©æœ¬æ¥æƒ³æ ¹æ® è¿™ç¯‡æ–‡ç«  å°è¯•è‡ªå·±å®šåˆ¶ä¸€ä¸‹ AppleALC ï¼Œå½“æˆ‘æŠŠæœ‰æ•ˆèŠ‚ç‚¹å’Œè·¯å¾„å¼„å®Œä¹‹åï¼Œå‡†å¤‡ä¸‹è½½ AppleALC-DEBUG ç¼–è¯‘çš„æ—¶å€™ï¼Œæ²¡æƒ³åˆ°æœ€æ–°ç‰ˆæœ¬å·²ç»æ·»åŠ äº†è¿™ä¸ªç¬”è®°æœ¬çš„ layout-id:23ã€‚\nè¯·æŒ‰ç…§å¦‚å›¾ä¿®æ”¹ï¼Œä¿å­˜åé‡å¯ã€‚æˆ‘çš„ç”µè„‘è€³æœºéº¦å…‹é£æ— æ³•è¯†åˆ«ï¼ˆæˆ‘åœ¨ Ubuntu ä¸‹ä¹Ÿæ— æ³•æ‰¾åˆ°è€³æœºéº¦å…‹é£çš„æœ‰æ•ˆèŠ‚ç‚¹ä¿¡æ¯ï¼‰\næ·»åŠ  type-c è¾“å‡º 4kï¼Œåªèƒ½æ”¯æŒåˆ°æœ€é«˜ 30Hzï¼Œè¾“å‡º 60Hz ä¼šç›´æ¥é»‘å±ã€‚å¯ä»¥å®‰è£…ä¸€ä¸ª RDM è¿›è¡Œç®¡ç†ã€‚\n[3] è§£é”BIOS è§£é”BIOSï¼Œå­˜åœ¨ä¸€å®šé£é™©ï¼Œå¦‚æ‚¨ä½¿ç”¨è¯¥æ•™ç¨‹å¯¹è®¡ç®—æœºè¿›è¡Œæ›´æ”¹ï¼Œæ‰€é€ æˆçš„çš„ä»»ä½•åæœæˆ‘æ¦‚ä¸è´Ÿè´£ï¼ï¼ï¼\né›·è›‡å›½å†…å®˜ç½‘æ²¡æœ‰æä¾›é©±åŠ¨å’ŒBIOSçš„ä¸‹è½½ï¼Œå¦‚æœ‰éœ€è¦ï¼Œéœ€è¦è®¿é—®ç¾å›½å®˜ç½‘ã€‚ç‚¹æˆ‘ã€‚\nè¯¥ç¬”è®°æœ¬ DVMT é¢„åˆ†é…é»˜è®¤ä¸º 32MBï¼Œä¸è¶³ä»¥å¯åŠ¨ MacOSï¼Œåœ¨ BIOS ä¸­è¯¥è®¾ç½®é¡¹é»˜è®¤éšè—ï¼Œæ‰€ä»¥è¦æå–æœ¬æœº BIOS å¹¶ä¸”è¿›è¡Œè§£é”ï¼Œå°† DVMT é¢„åˆ†é…é»˜è®¤è®¾ç½®ä¸º 64MBï¼ˆ1080Pï¼‰ï¼Œåˆ†è¾¨ç‡æ›´é«˜è¯·åˆ†é…æ›´å¤§ç©ºé—´ã€‚\nå»ºè®®åœ¨ windows ä¸‹æ“ä½œã€‚\n[3-1] æå–æœ¬æœº BIOS æ³¨æ„å¤‡ä»½å¥½ã€‚\næ‰“å¼€ AFUWINGUI.exeï¼Œç‚¹å‡» Save æŒ‰é’®ï¼Œå¯¼å‡ºæœ¬æœºå½“å‰ BIOS ã€‚\n[3-2] ä¿®æ”¹ BIOS æ‰“å¼€ AMIBCP.exe ï¼Œç‚¹å‡» File -\u0026gt; open æ‰“å¼€å¯¼å‡ºçš„ BIOSã€‚ å¦‚å›¾ï¼Œåœ¨å·¦ä¾§é€‰æ‹© / -\u0026gt; Setup -\u0026gt; Chipsetï¼Œå°†å·¦ä¾§çš„ System Agent Configuration çš„ Access ç”± Default ä¿®æ”¹ä¸º USER ä¿®æ”¹å®Œåç‚¹å‡» File -\u0026gt; Save asã€‚é‡å‘½åä¸ºæ–°çš„ BIOSã€‚ [3-3] åˆ·å…¥æ–° BIOS ï¼ï¼ï¼ æ³¨æ„ï¼Œè¯¥è¿‡ç¨‹è™½ç„¶ç®€å•ï¼Œä½†æœ‰ä¸€å®šé£é™©ï¼Œé€ æˆçš„ä»»ä½•ç»“æœä¸æœ¬äººæ— å…³ã€‚\né‡æ–°æ‰“å¼€ AFUWINGUI.exeï¼Œç‚¹å‡» Open æ‰“å¼€åˆšåˆšä¿®æ”¹åçš„ BIOSã€‚\nå°½å¯èƒ½çš„é€€å‡ºå…¶ä»–ç¨‹åºï¼Œå°½é‡ä¿æŒåå°å¹²å‡€ï¼Œå†ç‚¹å‡» Flash åˆ·å…¥æ–°çš„ BIOSã€‚\né‡å¯ [4] å®‰è£…å‰å‡†å¤‡ [4-1] å‡†å¤‡macOS Catalina å®‰è£…ç›˜ æ¨èä½¿ç”¨é»‘æœå°å…µåˆ¶ä½œçš„é•œåƒï¼Œä½¿ç”¨ TransMac åˆ¶ä½œï¼ˆè½¯ä»¶åœ¨æ–‡ä»¶å¤¹ä¸­å·²æä¾›ï¼‰ã€‚è¿™é‡Œæ˜¯10.15.3çš„é•œåƒã€‚\nå¦‚æœæ‚¨è¦å®‰è£…æ›´æ–°çš„ç³»ç»Ÿï¼Œè¯·å‡çº§ CLOVERï¼Œå’Œ kexts/ åˆ°å¯¹åº”å…¼å®¹æˆ–æ›´æ–°çš„ç‰ˆæœ¬ï¼Œå¯å°†åˆ¶ä½œå¥½çš„å®‰è£…ç›˜ä¸­ EFI/CLOVER çš„æ–‡ä»¶è¿›è¡ŒåŒåæ›¿æ¢ã€‚ï¼ˆæœªæ¥çš„æ–°ç‰ˆæœ¬å¯èƒ½ä¸å¯é¢„çŸ¥çš„é—®é¢˜ï¼Œè¯·é…Œæƒ…å‡çº§ï¼‰ã€‚\n[4-2] å¯åŠ¨ç›˜åˆ¶ä½œ è¯·å‚è€ƒï¼Œæˆ–è‡ªè¡Œæœç´¢ï¼Œç½‘ä¸Šæ•™ç¨‹å¾ˆå¤šã€‚ç‚¹æˆ‘ã€‚\n[5] ç³»ç»Ÿå®‰è£… [5-1] BIOS è®¾ç½® Advanced\nThunderbolt(TM) Configuration Security Level è®¾ç½®æˆ No Security Chipset\nSystem Agent (SA) Configuration Graphics Configuration DVMT Pre-Allocated è®¾ç½®æˆ 64 DVMT Total Gfx Mem è®¾ç½®æˆ MAX Security\nSecure Boot è®¾ç½®æˆ Disabled Boot\nFast Boot è®¾ç½®æˆ Disabled\nCSM Configuration\nCSM Support è®¾ç½®æˆ Disabled [5-2] å®‰è£…è¿‡ç¨‹ ç³»ç»Ÿå®‰è£…è¿‡ç¨‹å¤§è‡´ç›¸åŒï¼Œé€‰æ‹©Uç›˜å¯åŠ¨åè¿›å…¥å®‰è£…ã€‚å®‰è£…è¿‡ç¨‹ä¼šé‡å¯å‡ æ¬¡ã€‚\nå¯è‡ªè¡Œæœç´¢ï¼Œå‚è€ƒå…¶ä»–äººçš„æ­¥éª¤ã€‚\n[5-3] å®‰è£…æ—¶å¯èƒ½å‡ºç°çš„é—®é¢˜ æ˜¾ç¤ºç¨‹åºå‰¯æœ¬å·²æŸå\næ–­ç½‘ æ‰“å¼€ç»ˆç«¯ ä¿®æ”¹æ—¶é—´ä¸ºç³»ç»Ÿå‘å¸ƒå¯¹åº”çš„æ—¶é—´ã€‚ å¦‚ä¿®æ”¹ä¸º 2019å¹´ã€‚è¾“å…¥ date 000000002019ã€‚\n[6] DSDTï¼ŒSSDTåˆ¶ä½œ é€šè¿‡ä¿®è¡¥DSDTï¼ŒSSDTé©±åŠ¨è§¦æ§æ¿ï¼ŒéŸ³é¢‘ï¼Œç”µæ± çŠ¶æ€ï¼Œäº®åº¦æ§åˆ¶ç­‰ã€‚\n[6-1] å‡†å¤‡ä¿®è¡¥ [6-1-1]\nå¼€æœºåœ¨ Clover å¼•å¯¼ç•Œé¢ä¸­æŒ‰ F4ï¼Œæ‰€éœ€æ–‡ä»¶ä¼šåŠ è½½åˆ° EFI/Clover/ACPI/origin ä¸­ã€‚é€šè¿‡ Clover Configurator æŒ‚è½½å¯åŠ¨çš„ EFIï¼ˆé€šè¿‡Uç›˜å¯åŠ¨å°±æŒ‚è½½Uç›˜ï¼‰ã€‚\n[6-1-2]\nå°† origin æ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ¡Œé¢ï¼ŒåŒæ—¶å°† iasl è½¯ä»¶å¤åˆ¶åˆ°æ–‡ä»¶å¤¹ä¸­ã€‚\n[6-1-3]\næ‰“å¼€ç»ˆç«¯\n1 2 3 cd ~/Desktop mkdir patched ./origin/iasl -da -dl DSDT.aml [6-1-4]\næ‰“å¼€ originï¼Œä½¿ç”¨ MaciASL æ‰“å¼€ç”Ÿæˆçš„ DSDT.dsl æ–‡ä»¶ã€‚ç‚¹å‡» Compileï¼Œç¡®ä¿æ²¡æœ‰é”™è¯¯ã€‚ï¼ˆé»˜è®¤åº”è¯¥æ²¡æœ‰ errorï¼Œä½†æœ‰å¾ˆå¤š warningï¼Œwarning ä¸å¿…å…³ç³»ï¼Œè‹¥æœ‰ error è¯·å°† error å¤„ä»£ç æ³¨é‡Šæˆ–åˆ é™¤ï¼‰\n[6-1-5]\nç¡®ä¿æ²¡æœ‰ errors åï¼Œç‚¹å‡» Patchã€‚\n[6-2] ä¿®å¤ç”µæ±  [1] åœ¨å¼¹çª—çš„å·¦ä¾§ç‚¹å‡» _RehabMan Laptop/[bat]Razer Blade (2014) ï¼Œç­‰å¾…å³ä¾§è¿›è¡ŒåŒ¹é…åç‚¹å‡» Applyã€‚\nå¦‚æœç½‘ç»œä¸å¥½çš„è¯å¯èƒ½æ— æ³•åŠ è½½ï¼ˆgithubï¼‰ï¼Œè¯·åˆ‡æ¢åˆ°åˆé€‚çš„ç½‘ç»œï¼Œæˆ–è®¿é—® è¿™é‡Œï¼Œæˆ–å¤åˆ¶ä»¥ä¸‹ä»£ç ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 #Maintained by: RehabMan for: Laptop Patches #battery_Razer-Blade-2014.txt # created by sidelia 2016-01-17 # changes for Razer Blade Stealth (Kaby Lake) by BlenderSleuth (minor fixes by RehabMan) # works for: # Razer Blade (2014) # Razer Blade Stealth (Kaby Lake), per BlenderSleuth # Razer Blade (14\u0026#34;, late 2016) # Razer Blade Pro (2017) # Razer Blade 15 (2018), per JomanJi/blodtanner into method label B1B2 remove_entry; into definitionblock code_regex . insert begin Method (B1B2, 2, NotSerialized) { Return(Or(Arg0, ShiftLeft(Arg1, 8))) }\\n end; into device label EC0 code_regex BIF1,\\s+16, replace_matched begin IF10,8,IF11,8, end; into device label EC0 code_regex BIF2,\\s+16, replace_matched begin IF20,8,IF21,8, end; into device label EC0 code_regex BIF3,\\s+16, replace_matched begin IF30,8,IF31,8, end; into device label EC0 code_regex BIF4,\\s+16, replace_matched begin IF40,8,IF41,8, end; into device label EC0 code_regex BST0,\\s+16, replace_matched begin ST00,8,ST01,8, end; into device label EC0 code_regex BST1,\\s+16, replace_matched begin ST10,8,ST11,8, end; into device label EC0 code_regex BST2,\\s+16, replace_matched begin ST20,8,ST21,8, end; into device label EC0 code_regex BST3,\\s+16, replace_matched begin ST30,8,ST31,8, end; into method label _BIF code_regex \\^\\^EC0\\.BIF1, replaceall_matched begin B1B2(^^EC0.IF10,^^EC0.IF11), end; into method label _BIF code_regex \\^\\^EC0\\.BIF2, replaceall_matched begin B1B2(^^EC0.IF20,^^EC0.IF21), end; into method label _BIF code_regex \\^\\^EC0\\.BIF3, replaceall_matched begin B1B2(^^EC0.IF30,^^EC0.IF31), end; into method label _BIF code_regex \\^\\^EC0\\.BIF4, replaceall_matched begin B1B2(^^EC0.IF40,^^EC0.IF41), end; into method label _BST code_regex \\^\\^EC0\\.BST0, replaceall_matched begin B1B2(^^EC0.ST00,^^EC0.ST01), end; into method label _BST code_regex \\^\\^EC0\\.BST1, replaceall_matched begin B1B2(^^EC0.ST10,^^EC0.ST11), end; into method label _BST code_regex \\^\\^EC0\\.BST2, replaceall_matched begin B1B2(^^EC0.ST20,^^EC0.ST21), end; into method label _BST code_regex \\^\\^EC0\\.BST3, replaceall_matched begin B1B2(^^EC0.ST30,^^EC0.ST31), end; # added for Razer Blade 15 (2018), per JomanJi into device label EC0 code_regex BIF0,\\s+16, replace_matched begin IF00,8,IF01,8, end; into method label _BIF code_regex \\(\\^\\^EC0.BIF0, replaceall_matched begin (B1B2(\\^\\^EC0.IF00,\\^\\^EC0.IF01), end; # utility methods to read/write buffers from/to EC into method label RE1B parent_label EC0 remove_entry; into method label RECB parent_label EC0 remove_entry; into device label EC0 insert begin Method (RE1B, 1, NotSerialized)\\n {\\n OperationRegion(ERAM, EmbeddedControl, Arg0, 1)\\n Field(ERAM, ByteAcc, NoLock, Preserve) { BYTE, 8 }\\n Return(BYTE)\\n }\\n Method (RECB, 2, Serialized)\\n // Arg0 - offset in bytes from zero-based EC\\n // Arg1 - size of buffer in bits\\n {\\n ShiftRight(Add(Arg1,7), 3, Arg1)\\n Name(TEMP, Buffer(Arg1) { })\\n Add(Arg0, Arg1, Arg1)\\n Store(0, Local0)\\n While (LLess(Arg0, Arg1))\\n {\\n Store(RE1B(Arg0), Index(TEMP, Local0))\\n Increment(Arg0)\\n Increment(Local0)\\n }\\n Return(TEMP)\\n }\\n end; # buffer fields into device label EC0 code_regex (ECCM,)\\s+(256) replace_matched begin ECCX,%2,//%1%2 end; into method label _BIF code_regex \\(\\^\\^EC0.ECCM, replaceall_matched begin (^^EC0.RECB(0x60,256), end; [2] ç‚¹å‡» Compileï¼Œç¡®ä¿æ²¡æœ‰é”™è¯¯ã€‚ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰ï¼Œä¸åŒç‰ˆæœ¬BIOSå¯èƒ½æƒ…å†µä¸åŒï¼‰ã€‚\n[6-4] ä¿®å¤é‡å¯ä¿å­˜èƒŒå…‰äº®åº¦ [6-4-1]\nåœ¨å·¦ä¾§èœå•æ å‘ä¸‹æ»‘åŠ¨ï¼Œæ‰¾åˆ° [gfx0] Disable/Enable on _WAK/_PTS (DSDT)ï¼Œç‚¹å‡»éƒ½å•å‡» Applyã€‚\nç½‘ç»œä¸å¥½å¯ç‚¹å‡» è¿™é‡Œ æˆ–å¤åˆ¶ä»¥ä¸‹ä»£ç ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 #Maintained by: RehabMan for: Laptop Patches #graphics_PTS_WAK-disable.txt # # The purpose of this patch is to add code to to _WAK # that disables Radeon/nvidia on wake and add code # to _PTS that enables it on _PTS. # # The path of _OFF may have to be customized to match your SSDTs # The patch attempts to identify the correct _REG by using # the ACPI PNP identifier for the EC. # # Use this patch if you experience trouble shutting down # or restarting your laptop when disabling nvida/radeon. # into method label _PTS code_regex ([\\s\\S]*) replace_matched begin External(\\\\_SB.PCI0.PEG0.PEGP._ON, MethodObj)\\n If (CondRefOf(\\\\_SB.PCI0.PEG0.PEGP._ON)) { \\\\_SB.PCI0.PEG0.PEGP._ON() }\\n %1 end; into method label _WAK code_regex (Return\\s+\\(.*) replace_matched begin External(\\\\_SB.PCI0.PEG0.PEGP._OFF, MethodObj)\\n If (CondRefOf(\\\\_SB.PCI0.PEG0.PEGP._OFF)) { \\\\_SB.PCI0.PEG0.PEGP._OFF() }\\n %1 end; [6-4-2] æŒ‰ command + F æœç´¢ Device (ALSD)ï¼Œæ‰¾åˆ°å¦‚å›¾ä»£ç ï¼Œå°†å…¶æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ã€‚\n1 2 3 4 5 6 7 8 9 10 Device (_SB.ALS0) { Name (_HID, \u0026#34;ACPI0008\u0026#34;) // _HID: Hardware ID Name (_CID, \u0026#34;smc-als\u0026#34;) // _STA: Status Name (_ALI, 300) // _ALI: Ambient Light Illuminance Name (_ALR, Package () // _ALR: Ambient Light Response { Package () { 100, 300 }, }) } [6-3] ä¿®å¤è§¦æ§æ¿ çµåˆƒ 15 çš„æ ‡å‡†ç‰ˆå’Œç²¾è‹±ç‰ˆä½¿ç”¨çš„è§¦æ§æ¿ä¸åŒï¼Œè¯·æ ¹æ®è‡ªå·±çš„ç”µè„‘è¿›è¡Œé€‰æ‹©ä¿®å¤æ–¹æ¡ˆã€‚\n[6-3-1] æ ‡å‡†ç‰ˆ [6-3-1-1]\nç»§ç»­æœç´¢ SSCNã€‚æ‰¾åˆ° Scope ä¸º _SB.PCI0.I2C0 ä¸‹çš„ SSCN æ–¹æ³•ã€‚å¤åˆ¶ SSCN ä¸ FMCNï¼ˆåœ¨ SSCN ä¸‹æ–¹ï¼‰è¿™ ä¸¤ä¸ªæ–¹æ³•ã€‚å¹¶å°†è¿™ä¸¤ä¸ªæ–¹æ³•å¦‚å›¾é‡å‘½åï¼ˆä¹Ÿå¯é€‰æ‹©åˆ é™¤ï¼‰ã€‚\né‡å‘½åä¸ºï¼š\n[6-3-1-3]\næœç´¢ TPD0ã€‚å°†ä¹‹å‰å‰ªåˆ‡çš„ä¸¤ä¸ªæ–¹æ³•æ”¾åˆ° _INI æ–¹æ³•åã€‚\n[6-3-1-4]\nå‘ä¸‹æ‰¾åˆ°å¦‚ä¸‹ä»£ç ã€‚\nå°†å…¶æ›´æ”¹ä¸ºå¦‚å›¾ã€‚\n[6-3-2] ç²¾è‹±ç‰ˆ [6-3-2-1]\nåœ¨ Patch é¡µé¢ä¸­ç²˜è´´ä»¥ä¸‹ä»£ç ä»£ç ï¼Œç‚¹å‡» Applyã€‚\n[6-3-2-2]\nç‚¹å‡» Compile è¿›è¡Œç¼–è¯‘ç¡®å®šæ—  errorï¼ˆé»˜è®¤æ²¡æœ‰ï¼‰ã€‚\n1 2 3 4 5 6 7 into method label _STA parent_label GPI0 replace_content begin Return (0x0F) end; into_all method label _CRS parent_label TPD0 replace_content begin ConcatenateResTemplate (SBFB, SBFI) end; [6-4] ä¿å­˜ä¿®æ”¹å¥½çš„ DSDT.aml ç‚¹å‡» File -\u0026gt; save as ã€‚\nFile Format é€‰æ‹© ACPI Machine Language Binaryã€‚å‘½åä¸º DSDT.amlã€‚å­˜å…¥æ¡Œé¢ä¸­çš„ parched æ–‡ä»¶å¤¹ä¸­ã€‚\n[6-5] å±è”½ Nvdia æ˜¾å¡ å¦‚æœä½ é€‰æ‹©å®‰è£… High Sierra å®‰è£… WebDriver ä½¿ç”¨ Nvidia æ˜¾å¡çš„è¯ï¼Œä¸ç”¨è¯¥è¡¥ä¸ã€‚ [ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹æ”¯æŒé©±åŠ¨çš„ High Sierra ](https : //www.tonymacx86.com/nvidia-drivers/)\nåœ¨çš„ç¬”è®°æœ¬ä¸Šä½¿ç”¨è¯¥è¡¥ä¸ä¼šå¯¼è‡´ type-c è½¬è§†é¢‘æ¥å£æ— ä¿¡å·ï¼Œæ— æ³•æ‹“å±•æ˜¾ç¤ºå™¨ï¼Œè‹¥å‡ºç°ç›¸åŒæƒ…å†µè¯·åˆ é™¤è¯¥è¡¥ä¸ã€‚ [6-5-1]\nå†æ¬¡è¿›å…¥ origin æ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨ç»ˆç«¯è¾“å…¥\n1 ./origin/iasl -da -dl SSDT-12-OptTabl.aml [6-5-2]\næ ¹æ®ä¸Šæ–¹ä¿®è¡¥ç”µæ± çŠ¶æ€ï¼Œè§¦æ§æ¿çš„æ–¹å¼ç±»ä¼¼ï¼Œä½¿ç”¨ MaciASL æ‰“å¼€ SSDT-12-OptTabl.dsl\n[6-5-3]\næŒ‰ command + F æœç´¢ä»¥ä¸‹ä»£ç \n1 Method (_OFF, 0, Serialized) // _OFF: Power Off [6-5-4]\nåœ¨è¯¥ä»£ç ä¸Šæ–¹ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç \n1 Method (_INI) {_OFF() } // added to call _OFF [6-5-5]\nç‚¹å‡» patchï¼Œå°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ°å¼¹çª—ä¸­ï¼Œç‚¹å‡» applyã€‚\n1 2 3 4 5 6 into method label _INI parent_label \\_SB.PCI0.GFX0 insert begin //added to turn nvidia/radeon off\\n External(\\_SB.PCI0.PEG0.PEGP._OFF, MethodObj)\\n \\n end; [6-5-6]\nç‚¹å‡»ç¼–è¯‘ï¼Œå‡ºç°ä¸€ä¸ªé”™è¯¯ã€‚\n[6-5-7]\næœç´¢ä¸€ä¸‹ä»£ç ï¼Œå¹¶å°†å…¶åˆ é™¤ï¼Œå†æ¬¡ç¼–è¯‘ã€‚\n1 External (_SB_.PCI0.PEG0.TGPC, IntObj) // (from opcode) [6-5-8]\nç‚¹å‡» File -\u0026gt; Save Asã€‚å°†æœ€ç»ˆçš„ /aml æ–‡ä»¶ä¿å­˜ã€‚\n[6-6] åˆ¶ä½œ SSDT-USBX.aml å¦‚æœæƒ³åˆ¶ä½œè‡ªå·±çš„ SSDT-USBX.amlã€‚è¯·å‚è€ƒ ç‚¹æˆ‘ã€‚\nä½¿ç”¨ USBMapã€‚ç‚¹æˆ‘\n[6-7] å¤åˆ¶æä¾›çš„çš„ .aml æ–‡ä»¶ å°†æ–‡ä»¶å¤¹ä¸­çš„ SSDT-PNLF.amlï¼ŒSSDT-UIAC-ALL.amlï¼ŒSSDT-USBX.amlï¼ŒSSDT-XOSI.aml åŒä¸Šé¢ä¿®è¡¥çš„ä¸¤ä¸ªæ–‡ä»¶ä¸€åŒæ”¾å…¥ patched æ–‡ä»¶å¤¹ä¸­ï¼Œæœ€å patched æ–‡ä»¶å¤¹ä¸­åº”è¯¥æœ‰å¦‚ä¸‹6ä¸ªæ–‡ä»¶ã€‚\nå¦‚æœ type-c è½¬è§†é¢‘æ¥å£æ— ä¿¡å·ï¼Œè¯·åˆ é™¤SSDT-12-OptTabl.aml\n[7] ç½‘å¡ [7-1] æ›´æ¢åšé€šç½‘å¡ åœ¨ç½‘ä¸Šæ‰¾è¿‡æ‹†æœºå›¾ï¼Œç½‘å¡é™„è¿‘çš„ä½ç½®è¿˜æ˜¯æŒºå¤šçš„ï¼Œæˆ‘çš„é€‰æ‹©æ˜¯æ‹†æœºçš„ BCM94360cs2 + è½¬æ¥å¡ï¼Œå¯ç›´æ¥å…é©±ä½¿ç”¨ã€‚\nç›¸æ¯”ä½¿ç”¨åŸè£…çš„ç½‘å¡ä½ç½®ç¨æœ‰ç‚¹é«˜ï¼Œå‹åœ¨ä¸€æ ¹çš„æ’çº¿ä¸Šï¼Œä½†æ˜¯ä¸å½±å“ï¼Œå¦‚é€‰æ‹©åŒæ¬¾ç½‘å¡ï¼Œè¯·æ³¨æ„ç»ç¼˜ï¼Œå»ºè®®ä¸Šèºä¸çš„æ—¶å€™ä¸è¦æ‹§å¤ªç´§ï¼Œä¸æ¾åŠ¨å³å¯ã€‚è£…ä¸Šä¹‹åçš„æ•ˆæœå¦‚å›¾ã€‚\n**å°æç¤º: **æ‹§èºä¸å‰æœ€å¥½æŠŠæ˜“ç¢è´´ç»™æ¸…ç†å¹²å‡€ã€‚è¿™ä¸ªè´´çº¸åˆ†é‡å¤ªè¶³ï¼Œå¡åœ¨èºä¸å­”ä¸­å¯¼è‡´ä¸€ç›´æ»‘ä¸ã€‚\n**ä½¿ç”¨æ•ˆæœ: **2.4G WIFI å’Œ è“ç‰™æœ‰å¹²æ‰°ï¼Œå°¤å…¶æ˜¯ 2.4G WIFI ä½¿ç”¨å¸¦å®½é«˜çš„æ—¶å€™ï¼Œè“ç‰™å‡ ä¹ä¸èƒ½ç”¨ã€‚å…¶ä»–ä½¿ç”¨åœºæ™¯åŸºæœ¬è‰¯å¥½ã€‚\næƒ³æŠ˜è…¾çš„è¯å¯é€‰æ‹© DW1820Aï¼Œå¯å‚è€ƒ è¿™é‡Œã€‚\nåšé€š BCM94352Z ï¼Œç°åœ¨ä»·é’±è¢«ç‚’çš„å¾ˆé«˜ï¼Œç›®å‰å°†è¿‘ 300ï¼Œæœ‰é’±éšæ„ã€‚\n[7-2] ä½¿ç”¨è‡ªå¸¦ç½‘å¡ Intel è“ç‰™é»˜è®¤å…é©±ï¼ŒWiFi ç›®å‰æ— è§£ã€‚\nè“ç‰™ä» windows é‡å¯è¿›å…¥ macOS å¯ä½¿ç”¨ï¼ˆç½‘å¡æœªæ–­ç”µæ‰€ä»¥ä¸Šä¼ äº†é©±åŠ¨ï¼‰ã€‚\nå°† è¯¥é©±åŠ¨ æ”¾å…¥ EFI/CLOVER/kextsï¼Œå¯ä»¥å®ç°å†·å¯åŠ¨é©±åŠ¨è‡ªå¸¦ç½‘å¡è“ç‰™ã€‚\n**ä½¿ç”¨æ•ˆæœ: **è“ç‰™é”®ç›˜ï¼Œè“ç‰™éŸ³ç®±æ²¡æœ‰é—®é¢˜ï¼Œè“ç‰™é¼ æ ‡è²Œä¼¼ä¸èƒ½ç”¨ã€‚\n[7-3] ä½¿ç”¨USBç½‘å¡ usb ç½‘å¡é©±åŠ¨å®‰è£…ã€‚ç‚¹æˆ‘ã€‚\nCOMFAST CF-WU815N 150M å•é¢‘ COMFAST CF-811AC 650M åŒé¢‘ COMFAST CF-812AC 1300M åŒé¢‘ æ›´å¤šå…¶ä»–å‹å·è‡ªè¡Œæœç´¢ [8] ä¸€äº›ä¼˜åŒ– [8-1] HIDPI å¼€å¯ HIDPI åå¯èƒ½ä¼šå¯¼è‡´å¼€æœºç¬¬äºŒé˜¶æ®µ Logo å˜å¤§ï¼Œå› ä¸ºåˆ†è¾¨ç‡æ˜¯ä»¿å†’çš„ï¼Œä¸å½±å“ä½¿ç”¨ã€‚\nä½¿ç”¨ç»ˆç«¯æ‰§è¡Œï¼š\n1 sh -c \u0026#34;$(curl -fsSL https://raw.githubusercontent.com/xzhih/one-key-hidpi/master/hidpi.sh)\u0026#34; é€‰æ‹© \u0026ldquo;å¼€å¯ HIDPI\u0026rdquo;\næ˜¾ç¤ºçš„ ICON é€‰æ‹© Macbook Proï¼ˆåœ¨è®¾ç½®ç•Œé¢æ˜¾ç¤ºçš„æ ·å¼ï¼‰\né€‰æ‹©åˆ†è¾¨ç‡é…ç½® 1080P æ˜¾ç¤ºå™¨ï¼ˆæ ¹æ®è‡ªèº«æƒ…å†µé€‰æ‹©ï¼‰\næ›´å¤šè¯¦ç»†æƒ…å†µå¯å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ç‚¹æˆ‘ã€‚\n[8-2] æ‰“å¼€ TRIM å¦‚æœä½¿ç”¨ SSDï¼Œä¸€å®šè¦æ‰“å¼€ TRIMï¼Œé˜²æ­¢ç³»ç»Ÿå¤šæ¬¡æ“¦å†™ï¼Œç¡®ä¿ç¡¬ç›˜å¯¿å‘½ã€‚\n1 sudo trimforce enable å®Œæˆåç³»ç»Ÿä¼šè¿›è¡Œä¸€æ¬¡é‡å¯ã€‚\n[8-3] ç¦ç”¨ç¡çœ  åœ¨ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶åœ¨ è®¾ç½® -\u0026gt; èŠ‚èƒ½ ä¸­å…³é—­ç›¸åº”è®¾ç½®ã€‚\n1 2 3 4 5 sudo pmset -a hibernatemode 0 sudo rm /var/vm/sleepimage sudo mkdir /var/vm/sleepimage [8-4] â€œæ´—ç™½â€åºåˆ—å· ç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œè‡ªè¡Œæœä¸€ä¸‹ã€‚\nå‚è€ƒ https://github.com/stonevil/Razer_Blade_Advanced_early_2019_Hackintosh https://www.tonymacx86.com/threads/guide-razer-blade-15-2018-detailed-install-guide-high-sierra-10-13-6-17g2208-17g5019.264017/ https://blog.daliansky.net/ ","date":"2020-02-27T21:14:45+08:00","permalink":"https://emerywan.github.io/blog/p/razer-blade-base-hackintosh/","title":"é›·è›‡ çµåˆƒ 15 æ ‡å‡†ç‰ˆ 2018 é»‘è‹¹æœ"}]